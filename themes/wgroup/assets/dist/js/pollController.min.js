"use strict";app.controller("pollCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","SweetAlert","$http",function(t,n,i,e,a,o,l,r,c,s,d,p){var u=i,w={};u.info("entrando en... pollCtrl"),t.isAgent="agent"==s.currentUser().wg_type,t.isAdmin="system"==s.currentUser().wg_type,t.isCustomer="customerAdmin"==s.currentUser().wg_type||"customerUser"==s.currentUser().wg_type,t.isAgent?c.go("app.clientes.list"):t.isCustomer&&(u.info("Step 19"),c.go("app.clientes.view",{customerId:s.currentUser().company})),w.operation="poll",t.dtPollOptions=e.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:w,url:"api/poll",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){f()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(n,i,e){l(angular.element(n).contents())(t)}),t.dtPollColumns=[a.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,n,i,e){var a="",o='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar"  data-id="'+t.id+'" >   <i class="fa fa-edit"></i></a> ',l='<a class="btn btn-info btn-xs viewRow lnk" href="#" uib-tooltip="Ver" data-id="'+t.id+'" >   <i class="fa fa-eye"></i></a> ',r='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+t.id+'" >   <i class="fa fa-trash-o"></i></a> ';return s.can("poll_view")&&(a+=l),s.can("poll_edit")&&(a+=o),s.can("poll_delete")&&(a+=r),a}),a.newColumn("name").withTitle("Nombre").withOption("width",200),a.newColumn("description").withTitle("Descripción"),a.newColumn("startDateTime").withTitle("Fecha inicio",200),a.newColumn("endDateTime").withTitle("Fecha fin",200),a.newColumn(null).withTitle("Estado").withOption("width",200).renderWith(function(t,n,i,e){var a="",o="";t.isActive?(a="label label-success",o="Activo"):(a="label label-danger",o="Inactivo");var l='<span class="'+a+'">'+o+"</span>";return l})];var f=function(){$("#dtPoll a.editRow").on("click",function(){var t=$(this).data("id");c.go("app.poll.edit",{id:t})}),$("#dtPoll a.viewRow").on("click",function(){var t=$(this).data("id");c.go("app.poll.view",{id:t})}),$("#dtPoll a.delRow").on("click",function(){var n=$(this).data("id");u.info("intenta eliminar el registro: "+n),d.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(e){if(e){var a={};a.id=n,p({method:"POST",url:"api/poll/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){i.error(t),d.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){t.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};t.onCreate=function(){c.go("app.poll.create")},t.reloadData=function(){u.info("reloading..."),t.reloadDataEvent()},t.dtInstanceEvent={},t.dtEventOptions=e.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return JSON.stringify(t)},contentType:"application/json",url:"apiV1/event/index",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){h()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(n,i,e){l(angular.element(n).contents())(t)}),t.dtEventColumns=[a.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,n,i,e){var a="",o='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar"  data-id="'+t.id+'" >   <i class="fa fa-edit"></i></a> ',l='<a class="btn btn-info btn-xs viewRow lnk" href="#" uib-tooltip="Ver" data-id="'+t.id+'" >   <i class="fa fa-eye"></i></a> ',r='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+t.id+'" >   <i class="fa fa-trash-o"></i></a> ';return s.can("poll_view")&&(a+=l),s.can("poll_edit")&&(a+=o),s.can("poll_delete")&&(a+=r),a}),a.newColumn("name").withTitle("Nombre").withOption("width",200).withOption("defaultContent",""),a.newColumn("description").withTitle("Descripción").withOption("defaultContent",""),a.newColumn("startDateTime").withTitle("Fecha inicio",200).withOption("defaultContent",""),a.newColumn("endDateTime").withTitle("Fecha fin",200).withOption("defaultContent",""),a.newColumn(null).withTitle("Estado").withOption("width",200).renderWith(function(t,n,i,e){var a="",o="";t.isActive?(a="label label-success",o="Activo"):(a="label label-danger",o="Inactivo");var l='<span class="'+a+'">'+o+"</span>";return l})];var h=function(){$("#dtPoll a.editRow").on("click",function(){var t=$(this).data("id");c.go("app.poll.edit",{id:t})}),$("#dtPoll a.viewRow").on("click",function(){var t=$(this).data("id");c.go("app.poll.view",{id:t})}),$("#dtPoll a.delRow").on("click",function(){var n=$(this).data("id");u.info("intenta eliminar el registro: "+n),d.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(e){if(e){var a={};a.id=n,p({method:"POST",url:"api/poll/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){i.error(t),d.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){t.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};t.dtInstanceEventCallback=function(n){t.dtInstanceEvent=n},t.reloadDataEvent=function(){t.dtInstanceEvent.reloadData()}}]);
"use strict";app.controller("pollTabsCtrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout","$state","$filter","flowFactory","$http",function(t,e,l,a,o,r,i,p,s,n){i.is("app.poll.generate")?t.poll_title_tab="generate":i.is("app.poll.create")?t.poll_title_tab="create":i.is("app.poll.dynamically")?t.poll_title_tab="dynamically":t.poll_title_tab="edit";o.currentUser().company;t.isAgent="agent"==o.currentUser().wg_type,t.isAdmin="system"==o.currentUser().wg_type,t.isCustomer="customerAdmin"==o.currentUser().wg_type||"customerUser"==o.currentUser().wg_type,t.poll={},t.poll.id=t.iscreate?0:e.pollId,t.tabsloaded=["profile"],t.tabname="profile",t.titletab=t.poll_title_tab,t.switchTab=function(e,l){r(function(){t.tabname=e,t.titletab=l,t.tabsloaded.push(e)})},t.switchSubTab=function(e){r(function(){t.subtab=e})}}]);
"use strict";app.controller("pollEditCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","SweetAlert","$rootScope","$http","$timeout","$uibModal","flowFactory","cfpLoadingBar","$filter","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder",function(e,t,o,n,a,i,l,r,s,c,d,u,p,f,m,w,g){var h=o;if(e.loading=!0,e.isView=s.is("app.poll.view"),e.isCreate=s.is("app.poll.create"),e.format="dd-MM-yyyy",e.minDate=new Date-1,e.customers=[],e.collections=[],e.collectionsReport=[],e.poll={id:e.isCreate?0:t.id,collection:null,name:"",description:"",isActive:!0,startDateTime:new Date,endDateTime:new Date},e.openStart=function(t){t.preventDefault(),t.stopPropagation(),e.openedStart=!0},e.openEnd=function(t){t.preventDefault(),t.stopPropagation(),e.openedEnd=!0},e.dateOptions={formatYear:"yy",startingDay:1},e.poll.id){h.info("editando cliente con código: "+e.poll.id);var v={id:e.poll.id};u({method:"GET",url:"api/poll",params:v})["catch"](function(e,t){if(403==t){var o=null!==e.message&&void 0!==e.message?e.message:"app.asesores.list";c.swal("No Autorizado","No estas autorizado para ver esta información.","error"),p(function(){s.go(o)},3e3)}else 404==t?(c.swal("Información no disponible","Encuesta no encontrada","error"),p(function(){})):c.swal("Error","Se ha presentado un error al intentar acceder a la información del cliente","error")}).then(function(t){console.log(t),p(function(){e.poll=t.data.result,e.poll.startDateTime=new Date(e.poll.startDateTime),e.poll.endDateTime=new Date(e.poll.endDateTime)})})["finally"](function(){p(function(){C(),e.loading=!1},400)})}else h.info("creacion de nuevo asesor "),e.loading=!1;e.removeImage=function(){e.noImage=!0},e.master=e.poll,e.form={submit:function(t){var o=null;if(t.$invalid){var n=null,o=null;for(n in t)"$"!=n[0]&&(null!==o||t[n].$valid||(o=t[n].$name),t[n].$pristine&&(t[n].$dirty=!0));return h.info(e.poll),angular.element(".ng-invalid[name="+o+"]").focus(),void c.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}c.swal("Validación exitosa","Guardando información de la encuesta...","success"),h.info(e.poll),D()},reset:function(t){e.poll=angular.copy(e.master),t.$setPristine(!0)}};var D=function(){var t={},n=JSON.stringify(e.poll);return t.data=Base64.encode(n),u({method:"POST",url:"api/poll/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(e){p(function(){s.go("app.poll.edit",{id:e.data.result.id})})})["catch"](function(e){o.error(e),c.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};e.onCancel=function(){e.isview||c.swal({title:"Está seguro?",text:"Perderá todos los cambios realizados en este formulario.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, cancelar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(e){e?p(function(){s.go("app.poll.list")}):swal("Cancelación","La operación ha sido cancelada","error")})};var C=function(){var o={};o.poll_id=t.id?t.id:0,u({method:"POST",url:"api/collection-data",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)})["catch"](function(e,t){}).then(function(t){p(function(){e.collections=t.data.data,e.collectionsReport=g("filter")(e.collections,{type:"quote"})})})["finally"](function(){})};C(),e.onExport=function(){jQuery("#download")[0].src="api/poll/export?id="+t.id};var T={};T.operation="poll-summary",T.id=t.id,e.dtPollResultOptions=n.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:T,url:"api/poll/summary",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,o,n){l(angular.element(t).contents())(e)}),e.dtPollResultColumns=[a.newColumn("name").withTitle("Razón Social").withOption("width"),a.newColumn("questions").withTitle("Preguntas").withOption("width",200),a.newColumn("answers").withTitle("Respuestas").withOption("width",200),a.newColumn("avance").withTitle("% Avance").withOption("width",200),a.newColumn("status").withTitle("Estado").withOption("width",200)],e.data_sg=[],e.options_sg={responsive:!0,segmentShowStroke:!0,segmentStrokeColor:"#fff",segmentStrokeWidth:2,percentageInnerCutout:50,animationSteps:100,animationEasing:"easeOutBounce",animateRotate:!0,animateScale:!1,legendTemplate:'<ul class="tc-chart-js-legend"><% for (var i=0; i<segments.length; i++){%><li><span style="background-color:<%=segments[i].fillColor%>"></span><%if(segments[i].label){%><%=segments[i].label%><%}%></li><%}%></ul>'},e.totalAvg=0;var O=function(){var n={};n.operation="poll-dashboard",n.id=e.isCreate?0:t.id,u({method:"POST",url:"api/poll/dashboard",data:n}).then(function(t){p(function(){var o=["#46BFBD","#e0d653","#F7464A","#46BFBD"];e.data_sg=t.data.result.pie;var n=0;$.each(e.data_sg,function(e,t){t.color=o[n],t.highlight=o[n],t.value=parseFloat(t.value),n++}),e.totalAvg=t.data.result.totalAvg})})["catch"](function(e){o.error(e),c.swal("Error Cargando Reportes","Se ha presentado un error durante la consulta de los reportes para el diagnóstico por favor intentelo de nuevo","error")})["finally"](function(){})};O()}]);
"use strict";app.controller("pollQuestionCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","SweetAlert","$rootScope","$http","$timeout","$uibModal","flowFactory","cfpLoadingBar","$filter","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder",function(n,e,i,o,t,a,r,l,s,c,u,d,p,f,w,m,h){var v=i;n.questionTypes=u.parameters("poll_question_type"),n.question={id:0,poll:n.poll,title:"",isActive:!0,type:null,position:0,rangeFrom:0,rangeTo:0,answers:[]},n.clear=function(){p(function(){n.question={id:0,poll:n.poll,title:"",isActive:!0,type:null,position:0,rangeFrom:0,rangeTo:0,answers:[]}})},n.form={submit:function(e){var i=null;if(e.$invalid){var o=null,i=null;for(o in e)"$"!=o[0]&&(null!==i||e[o].$valid||(i=e[o].$name),e[o].$pristine&&(e[o].$dirty=!0));return v.info(n.poll),angular.element(".ng-invalid[name="+i+"]").focus(),void c.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}c.swal("Validación exitosa","Guardando información del asesor...","success"),v.info(n.poll),g()},reset:function(e){n.question=angular.copy(n.master),e.$setPristine(!0)}};var g=function(){var e={},o=JSON.stringify(n.question);return e.data=Base64.encode(o),d({method:"POST",url:"api/poll-question/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){p(function(){n.reloadData(),n.clear()})})["catch"](function(n){i.error(n),c.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};n.onCancel=function(){n.isview?s.go("app.poll.list"):c.swal({title:"Está seguro?",text:"Perderá todos los cambios realizados en este formulario.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, cancelar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(n){n?p(function(){s.go("app.poll.list")}):swal("Cancelación","La operación ha sido cancelada","error")})},n.onLoadRecord=function(){if(0!=n.question.id){v.info("editando campo calculado : "+n.question.id);var e={id:n.question.id,poll_id:n.question.poll.id};d({method:"GET",url:"api/poll-question",params:e})["catch"](function(n,e){}).then(function(e){p(function(){n.question=e.data.result})})["finally"](function(){p(function(){n.loading=!1},400),p(function(){$document.scrollTop(40,2e3)})})}else v.info("creacion de nuevo cliente"),n.loading=!1};var C={};C.operation="poll-question",C.poll_id=e.id,n.dtInstanceQuestion={},n.dtOptionsQuestion=o.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:C,url:"api/poll-question",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){O()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,i,o){r(angular.element(e).contents())(n)}),n.dtColumnsQuestion=[t.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(n,e,i,o){var t="",a="",r='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar"  data-id="'+n.id+'"'+a+' >   <i class="fa fa-edit"></i></a> ',l=('<a class="btn btn-info btn-xs viewRow lnk" href="#"  uib-tooltip="Ver" data-id="'+n.id+'" >   <i class="fa fa-eye"></i></a> ','<a class="btn btn-danger btn-xs delRow lnk" href="#"  uib-tooltip="Eliminar" data-id="'+n.id+'"'+a+' >   <i class="fa fa-trash-o"></i></a> ');return u.can("poll_edit")&&(t+=r),u.can("poll_delete")&&(t+=l),t}),t.newColumn("title").withTitle("Pregunta").withOption("width"),t.newColumn("typeParam.item").withTitle("Tipo Pregunta").withOption("width",200),t.newColumn(null).withTitle("Estado").withOption("width",200).renderWith(function(n,e,i,o){var t="",a="";n.isActive?(t="label label-success",a="Activo"):(t="label label-danger",a="Inactivo");var r='<span class="'+t+'">'+a+"</span>";return r})];var O=function(){$("#dtOptionsQuestion a.editRow").on("click",function(){var e=$(this).data("id");n.editQuestion(e)}),$("#dtOptionsQuestion a.delRow").on("click",function(){var e=$(this).data("id");v.info("intenta eliminar el registro: "+e),c.swal({title:"Está seguro?",text:"Eliminará la pregunta seleccionada.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(o){if(o){var t={};t.id=e,d({method:"POST",url:"api/poll-question/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(n){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(n){i.error(n),c.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){n.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};n.addAnswerValue=function(){null==n.question.answers&&(n.question.answers=[]),n.question.answers.push({id:0,value:"",isActive:1})},n.removeAnswerValue=function(e){c.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(o){o?p(function(){var o=n.question.answers[e];if(n.question.answers.splice(e,1),0!=o.id){var t={};t.id=o.id,d({method:"POST",url:"api/poll-question-answer/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(n){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(n){i.error(n),c.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})},n.reloadData=function(){n.dtInstanceQuestion.reloadData()},n.editQuestion=function(e){n.clear(),n.question.id=e,n.onLoadRecord()}}]);
"use strict";app.controller("pollCustomerCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","SweetAlert","$rootScope","$http","$timeout","$uibModal","flowFactory","cfpLoadingBar","$filter","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder",function(e,t,o,n,i,l,r,a,c,s,u,d,p,f,m,w,h){var C=o;e.request_collection={},e.fields=[],e.pollCustomer={id:0,poll:e.poll,filters:[],customers:[]},e.pollCustomer.filters.push({id:0,field:null,criteria:null,condition:null,value:""}),e.clear=function(){p(function(){e.pollCustomer={id:0,poll:e.poll,filters:[],customers:[]}})},e.criteria=[{name:"Igual",value:"="},{name:"Contiene",value:"LIKE"},{name:"Diferente",value:"<>"},{name:"Mayor que",value:">"},{name:"Menor que",value:"<"}],e.conditions=[{name:"Y",value:"AND"},{name:"O",value:"OR"}],e.form={submit:function(o){var n=null;if(o.$invalid){var i=null,n=null;for(i in o)"$"!=i[0]&&(null!==n||o[i].$valid||(n=o[i].$name),o[i].$pristine&&(o[i].$dirty=!0));return C.info(e.poll),angular.element(".ng-invalid[name="+n+"]").focus(),void s.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}s.swal("Validación exitosa","Generando información...","success"),C.info(e.poll);var l=JSON.stringify(e.pollCustomer);e.request_collection.operation="report-calculated",e.request_collection.report_id=t.reportId,e.request_collection.data=Base64.encode(l),e.dtPollCustomerResult.reloadData()},reset:function(t){e.pollCustomer=angular.copy(e.master),t.$setPristine(!0)}};e.onCancel=function(){e.isview?c.go("app.poll.list"):s.swal({title:"Está seguro?",text:"Perderá todos los cambios realizados en este formulario.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, cancelar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(e){e?p(function(){c.go("app.poll.list")}):swal("Cancelación","La operación ha sido cancelada","error")})},e.onLoadRecord=function(){},e.onLoadRecord(),e.addFilter=function(){null==e.pollCustomer.filters&&(e.pollCustomer.filters=[]),e.pollCustomer.filters.push({id:0,field:null,criteria:null,condition:null,value:""})},e.removeFilter=function(t){e.pollCustomer.filters.splice(t,1)};var v={};v.operation="poll-question",v.poll_id=t.id,e.dtInstanceCustomerPoll=null,e.dtPollCustomerOptions=n.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:v,url:"api/customer/poll/summary",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){O()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,o,n){r(angular.element(t).contents())(e)}),e.dtPollCustomerColumns=[i.newColumn(null).withTitle("Acción").withOption("width",100).notSortable().renderWith(function(e,t,o,n){var i="",l="",r='<a class="btn btn-danger btn-xs delRow lnk" href="#"  uib-tooltip="Eliminar participante" data-id="'+e.id+'"'+l+' >   <i class="fa fa-trash-o"></i></a> ';return u.can("poll_delete")&&(i+=r),i}),i.newColumn("customer.businessName").withOption("defaultContent","").withTitle("Razón Social").withOption("width"),i.newColumn("customer.type.item").withOption("defaultContent","").withTitle("Tipo de Cliente").withOption("width",200)];var O=function(){$("#dtPollCustomerOptions a.delRow").on("click",function(){var t=$(this).data("id");C.info("intenta eliminar el registro: "+t),s.swal({title:"Está seguro?",text:"Eliminará la pregunta seleccionada.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(n){if(n){var i={};i.id=t,d({method:"POST",url:"api/customer/poll/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){o.error(e),s.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){e.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};e.dtInstanceCustomerPollCallback=function(t){e.dtInstanceCustomerPoll=t},e.reloadData=function(){e.dtInstanceCustomerPoll.reloadData()};var g=JSON.stringify(e.pollCustomer);e.request_collection.operation="report-calculated",e.request_collection.report_id=t.reportId,e.request_collection.data=Base64.encode(g),e.dtPollCustomerResult=n.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:e.request_collection,url:"api/customer/poll/generate",type:"POST",beforeSend:function(){},complete:function(e){p(function(){})}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){b()}).withDOM("tr").withOption("language",{}).withOption("createdRow",function(t,o,n){r(angular.element(t).contents())(e)}),e.dtPollCustomerResultColumns=[i.newColumn("Nombre").withTitle("Cliente"),i.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,t,o,n){var i="",l="1"==e.Activo?"checked":"",r='<input bs-switch ng-model="isSelected" type="checkbox" switch-active="true" ng-click="edit('+e.Identificacion+')" name="'+e.Identificacion+'" ng-true-value="true" ng-false-value="false" switch-on-text="Si" switch-off-text="No"> ',r='<div class="checkbox clip-check check-success "><input class="editRow" type="checkbox" id="chk_'+e.Identificacion+'" data-id="'+e.Identificacion+'" data-value="'+e.Activo+'" '+l+' ><label for="chk_'+e.Identificacion+'"> Seleccionar </label></div>';return i+=r})];var b=function(){$("input[type=checkbox]").on("change",function(){var t=$(this).data("id"),n=($(this).data("value"),h("filter")(e.pollCustomer.customers,{id:t}));if(0==n.length){var i={id:t};e.pollCustomer.customers.push(i)}else angular.forEach(e.pollCustomer.customers,function(o,n){if(o.id===t)return void e.pollCustomer.customers.splice(n,1)});o.info(e.pollCustomer.customers)})};e.onGenerate=function(){if(0!=e.pollCustomer.customers.length){var t={},n=JSON.stringify(e.pollCustomer);return t.data=Base64.encode(n),d({method:"POST",url:"api/customer/poll/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){p(function(){a.pop("success","Operación Exitosa","Generación exitosa."),e.reloadData()})})["catch"](function(e){o.error(e),s.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})}p(function(){a.pop("error","Validación","Debe seleccionar al menos un cliente.")})}}]);
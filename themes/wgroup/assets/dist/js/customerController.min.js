"use strict";app.controller("customerCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","$compile","toaster","$state","$rootScope","SweetAlert","$http","$timeout","ListService","ngNotify","$uibModal",function(e,t,a,n,o,i,r,l,s,c,u,d,m,f,p){function h(){var t=[{name:"criteria_operators_productivity",value:null},{name:"customer_custom_filter_field",value:null}];m.getDataList(t).then(function(t){e.criteria=t.data.data.criteriaOperatorList,e.audit.fields=t.data.data.customerFilterField.filter(function(e){return b||!b&&"economicGroup"!=e.name})},function(t){e.status="Unable to load customer data: "+t.message})}var w=s.isCustomer(),v=s.isAgent(),b=!1,g=v?"api/customer-agent":"api/customer";e.audit={fields:[],filters:[]},e.showDataTable=!w;var C=function(e){l.go("app.clientes.edit",{customerId:e})},y=function(){var e=[o.newColumn(null).withTitle("Acciones").withOption("width",80).notSortable().renderWith(function(e,t,a,n){var o="",i='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar"  data-id="'+e.id+'" >   <i class="fa fa-edit"></i></a> ',r='<a class="btn btn-info btn-xs viewRow lnk" href="#" uib-tooltip="Ver" data-id="'+e.id+'" >   <i class="fa fa-eye"></i></a> ',l='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+e.id+'" >   <i class="fa fa-trash-o"></i></a> ',c=' | <a class="btn btn-success btn-xs exportRow lnk" href="#" uib-tooltip="Descargar anexos" data-id="'+e.id+'" >   <i class="fa fa-arrow-circle-o-down"></i></a> ';return s.can("clientes_view")&&(o+=r),s.can("clientes_edit")&&(o+=i),s.can("clientes_delete")&&(o+=l),s.can("clientes_documentos_export")&&(o+=c),o})];return e.push(D("documentType","Tipo de Documento","",200)),e.push(D("documentNumber","Nro Documento","",200)),e.push(D("businessName","Razón Social","",200)),e.push(D("type","Tipo de Cliente","",200)),e.push(D("classification","Clasificación","",200)),b&&e.push(D("economicGroup","Grupo Económico","",200)),e.push(D("status","Estado","",200).renderWith(function(e,t,a,n){var o="";switch(e){case"Activo":o="label label-success";break;case"Inactivo":o="label label-danger";break;case"Retirado":o="label label-warning"}var i='<span class="'+o+'">'+e+"</span>";return i})),e},D=function(e,t,a,n){return o.newColumn(e).withTitle(t).withOption("defaultContent",a).withOption("width",n)},T=function(){h(),e.dtOptionsCustomer=n.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.customerId=w?s.currentUser().company:null,angular.isDefined(e.audit)&&angular.isDefined(e.audit.filters)&&(t.filter={filters:e.audit.filters.filter(function(e){return null!=e&&null!=e.field&&null!=e.criteria}).map(function(e,t,a){return{field:e.field.name,operator:e.criteria.value,value:e.value,condition:{value:"and"}}})}),JSON.stringify(t)},url:g,contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){O()}).withPaginationType("full_numbers").withOption("createdRow",function(t,a,n){i(angular.element(t).contents())(e)}),e.dtColumnsCustomer=y()},O=function(){angular.element("#dtCustomer a.editRow").on("click",function(){var e=angular.element(this).data("id");l.go("app.clientes.edit",{customerId:e})}),angular.element("#dtCustomer a.viewRow").on("click",function(){var e=angular.element(this).data("id");l.go("app.clientes.view",{customerId:e})}),angular.element("#dtCustomer a.exportRow").on("click",function(){var e=angular.element(this).data("id"),t=p.open({templateUrl:s.app.views.urlRoot+"modules/common/modals/document_filter_modal.htm",controller:"ModalInstanceSideCustomerDownloadAttachmentCtrl",windowTopClass:"top-modal",resolve:{customerId:function(){return e},title:function(){return"Descargar anexos de cliente"}}});t.result.then(function(){},function(){})}),angular.element("#dtCustomer a.delRow").on("click",function(){var t=angular.element(this).data("id");c.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(n){if(n){var o={};o.id=t,u({method:"POST",url:"api/customer/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){a.error(e),c.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){e.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};if(e.dtInstanceCustomerCallback=function(t){e.dtInstanceCustomer=t},e.reloadData=function(){e.dtInstanceCustomer.DataTable.ajax.url(g),e.dtInstanceCustomer.reloadData()},e.createCustomer=function(){l.go("app.clientes.create")},e.addFilter=function(){null==e.audit.filters&&(e.audit.filters=[]),e.audit.filters.push({id:0,field:null,criteria:null,condition:null,value:""})},e.addFilter(),e.onFilter=function(){e.reloadData()},e.removeFilter=function(t){e.audit.filters.splice(t,1)},e.onCleanFilter=function(){e.audit.filters=[],e.reloadData()},w){if(s.currentUser().company){var S={id:s.currentUser().company};u({method:"GET",url:"api/customer",params:S})["catch"](function(e,t){if(403==t){null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";c.swal("No Autorizado","No estas autorizado para ver esta información.","error"),d(function(){},3e3)}else 404==t?(c.swal("Información no disponible","Cliente no encontrado","error"),d(function(){l.go("app.clientes.list")})):c.swal("Error","Se ha presentado un error al intentar acceder a la información del cliente","error")}).then(function(t){d(function(){t.data.result.classification&&"Contratante"==t.data.result.classification.value?t.data.result.hasEconomicGroup?(g="api/customer-contractor-economic-group",b=!0,T(),e.showDataTable=!0):(g="api/customer-contractor",T(),e.showDataTable=!0):t.data.result.hasEconomicGroup?(g="api/customer-economic-group",T(),e.showDataTable=!0):C(s.currentUser().company)})})["finally"](function(){})}}else T()}]),app.controller("ModalInstanceSideCustomerDownloadAttachmentCtrl",["$rootScope","$stateParams","$scope","$uibModal","$uibModalInstance","customerId","title","$log","$timeout","SweetAlert","$http","toaster","$filter","$aside","$document","DTColumnBuilder","DTOptionsBuilder","$compile","ListService","ngNotify",function(e,t,a,n,o,i,r,l,s,c,u,d,m,f,p,h,w,v,b,g){function C(){var e=a.filter.year?a.filter.year.value:null,t=[{name:"customer_document_type",value:i},{name:"customer_document_periods",value:i,year:e}];b.getDataList(t).then(function(e){a.documentType=e.data.data.customerDocumentType,a.years=e.data.data.customerDocumentPeriod.years,a.months=e.data.data.customerDocumentPeriod.months},function(e){a.status="Unable to load customer data: "+e.message})}a.loading=!0,a.title=r,a.onCloseModal=function(){o.close(1)},a.onCancel=function(){o.dismiss("cancel")},a.onSelectYear=function(){C()};var y=function(){a.filter={id:i}};y(),C(),a.form={submit:function(e){var t=null;if(e.$invalid){var n=null,t=null;for(n in e)"$"!=n[0]&&(null!==t||e[n].$valid||(t=e[n].$name),e[n].$pristine&&(e[n].$dirty=!0));return angular.element(".ng-invalid[name="+t+"]").focus(),void c.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}return a.filter.type||a.filter.year||a.filter.month?void D():void c.swal("El formulario contiene errores!","Por favor seleccione al menos un filtro e intentelo nuevamente.","error")},reset:function(e){}};var D=function(){g.set("El archivo se está generando.",{position:"bottom",sticky:!0,button:!1,html:!0});var e={customerId:a.filter.id,audit:a.filter},t={},n=JSON.stringify(e);t.data=Base64.encode(n),u({method:"POST",url:"api/customer-document/export",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(e){var t=(e.data.path+e.data.filename,'<div class="row"><div class="col-sm-12 text-center">Por favor espere y verifique su correo y la bandeja de mensajes!</div> </div>');g.set(t,{position:"bottom",sticky:!0,type:"success",button:!0,html:!0}),a.onCloseModal()})["catch"](function(e){g.set(e.data.message,{position:"bottom",sticky:!0,type:"error",button:!0,html:!0})})["finally"](function(){})}}]);
"use strict";app.controller("customerTabsCtrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout","$state","$filter","flowFactory","$http","SupportService","$analytics","ListService","SweetAlert",function(e,t,o,a,r,s,i,n,c,u,m,l,p,d){function f(){var o=[{name:"customer_parameter",criteria:{customerId:t.customerId,group:"employeesOrganizationalStructure"}}];p.getDataList(o).then(function(t){t.data.data.employeesOrganizationalStructure&&(e.structureOrganizational="1"==t.data.data.employeesOrganizationalStructure.value||!1)},function(t){e.status="Unable to load customer data: "+t.message})}e.active=0,e.profileTabActive=0,e.structureOrganizational=!1,e.IsLicenseActive=!1,e.contractorClassification=r.parameters("wg_contractor_classification_dashboard"),e.contractorClassification=n("filter")(e.contractorClassification,{code:"contractor"}),e.showContractor=!1;var g=function(){switch(m.getCurrentStep()){case 1:e.active=0,e.profileTabActive=0,e.profileTab="parameter";break;case 2:e.active=4;break;case 3:case 4:e.active=0,e.profileTabActive=9,e.profileTab="parameter"}},v=r.$on("hasEconomicGroup",function(t,o){e.hasEconomicGroup=o.newValue}),_=r.$on("hasClassification",function(t,o){e.showContractor=e.contractorClassification.length?e.contractorClassification.filter(function(e){return e.value==o.newValue}).length>0:"Contratante"==o.newValue}),w=r.$on("navigateToSupport",function(e,t){g()});e.$on("$destroy",function(){v(),_(),w()}),m.getShouldRedirect()&&g();var h=o;i.is("app.clientes.view")?e.customer_title_tab="view":i.is("app.clientes.create")?e.customer_title_tab="create":e.customer_title_tab="edit",e.isCreate=i.is("app.clientes.create"),e.canMatrixShowGTC45=!1,e.views=[{name:"profile",url:r.app.views.urlRoot+"modules/customer/profile/customer_profile_tabs.htm"},{name:"sgsst",url:r.app.views.urlRoot+"modules/customer/sgsst/customer_profile_config_sgsst_tabs.htm"},{name:"employee",url:r.app.views.urlRoot+"modules/customer/employee/customer_employee.htm"},{name:"tracking",url:r.app.views.urlRoot+"modules/customer/tracking/customer_tracking.htm"},{name:"guide",url:r.app.views.urlRoot+"modules/customer/diagnostic-guide/customer_diagnostic_prevention_document.htm"},{name:"diagnostic",url:r.app.views.urlRoot+"modules/customer/diagnostic/customer_diagnostic_tabs.htm"},{name:"management",url:r.app.views.urlRoot+"modules/customer/management/customer_management_tabs.htm"},{name:"occupational",url:r.app.views.urlRoot+"modules/customer/occupational/customer_occupational_medicine_tabs.htm"},{name:"medicine",url:r.app.views.urlRoot+"modules/customer/medicine/customer_work_medicine_tabs.htm"},{name:"attachments",url:r.app.views.urlRoot+"modules/customer/attachments/customer_attachment.htm"},{name:"poll",url:r.app.views.urlRoot+"modules/customer/poll/customer_poll.htm"},{name:"safety",url:r.app.views.urlRoot+"modules/customer/safety/customer_safety_inspection_tabs.htm"},{name:"audit",url:r.app.views.urlRoot+"modules/customer/log/customer_audit.htm"},{name:"contract",url:r.app.views.urlRoot+"modules/customer/contract/customer_contract.htm"},{name:"action-plan",url:r.app.views.urlRoot+"modules/customer/action-plan/customer_improvement_plan.htm"},{name:"certificate",url:r.app.views.urlRoot+"modules/customer/certificate/certificate_admin_tab.htm"},{name:"matrix",url:r.app.views.urlRoot+"modules/customer/matrix/customer_matrix.htm"},{name:"unsafe",url:r.app.views.urlRoot+"modules/customer/unsafe/customer_unsafe_act.htm"},{name:"vr_employee",url:r.app.views.urlRoot+"modules/customer/vr-employee/customer_vr_employee_tabs.htm"},{name:"reports_cyc",url:r.app.views.urlRoot+"modules/customer/reports-cyc/customer_reports_cyc_tabs.htm"},{name:"job_conditions",url:r.app.views.urlRoot+"modules/customer/job-conditions/job_condition_tabs.htm"}],e.section=e.views[0];var b=r.currentUser().company;e.isAgent="agent"==r.currentUser().wg_type,e.isAdmin="system"==r.currentUser().wg_type,e.isCustomer="customerAdmin"==r.currentUser().wg_type||"customerUser"==r.currentUser().wg_type,e.isCustomerContractor=!1,r.canEditRoot="customerAdmin"==r.currentUser().wg_type||!i.is("app.clientes.view")&&(e.isAgent||e.isAdmin),e.customer={},e.customer.id=e.iscreate?0:t.customerId,e.flowConfig={target:"/api/upload",singleFile:!0},e.uploader=new Flow,e.noImage=!0,e.tabsloaded=["profile"],e.tabname="profile",e.titletab=e.customer_title_tab,e.profileTab="basic",e.onLoadRecord=function(){var o=r.$on("dataCustomer",function(t,o){e.customer=o.newValue}),a=r.$on("customerMatrixUpdated",function(t,o){e.canMatrixShowGTC45="G"==o.newValue||"S"==o.newValue});if(e.$on("$destroy",function(){o(),a()}),e.customer.id){h.info("editando cliente con código: "+e.customer.id);var n={id:e.customer.id};u({method:"GET",url:"api/customer",params:n})["catch"](function(e,t){if(403==t){var o=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";d.swal("No Autorizado","No estas autorizado para ver esta información.","error"),s(function(){i.go(o)},3e3)}else 404==t?(d.swal("Información no disponible","Cliente no encontrado","error"),s(function(){i.go("app.clientes.list")})):d.swal("Error","Se ha presentado un error al intentar acceder a la información del cliente","error")}).then(function(o){console.log(o),s(function(){if(e.customer=o.data.result,e.canMatrixShowGTC45="G"==e.customer.matrixType||"S"==e.customer.matrixType,e.isCustomer&&b!=t.customerId&&b){var a={id:b};u({method:"GET",url:"api/customer",params:a})["catch"](function(e,t){403==t?s(function(){},3e3):404==t&&s(function(){i.go("app.clientes.list")})}).then(function(t){s(function(){e.customerContract=t.data.result,"Contratante"!=e.customerContract.classification.value&&"Empresa"!=e.customerContract.classification.value||(e.isCustomerContractor=!0)})})["finally"](function(){s(function(){},400)})}null!=e.customer.logo&&null!=e.customer.logo.path?e.noImage=!1:e.noImage=!0,e.loading=!1})})["finally"](function(){})}else h.info("creacion de nuevo cliente"),e.loading=!1},e.onLoadRecord(),e.getView=function(t){var o=n("filter")(e.views,{name:t});return o[0]},e.switchTab=function(t,o,a){s(function(){e.tabname=t,e.titletab=o,e.tabsloaded.push(t),e.section=e.getView(t),"bolivar"==r.app.instance&&(console.log("trackea bolivar events"),l.eventTrack("Clic módulo",{category:"Clientes",label:a,action:"Abre Pestaña"}))})},e.switchSubTab=function(t){s(function(){e.subtab=t})},f()}]);
"use strict";app.controller("ModalInstanceSideWorkplaceMatrixGTC45Ctrl",["$rootScope","$stateParams","$scope","$uibModalInstance","entity","isView","closeAfterCreate","$log","$timeout","SweetAlert","$http","toaster","$filter","$aside","$document","$compile","ListService",function(t,e,n,i,a,o,r,c,s,l,u,d,y,m,f,p,v){function g(){var t=[{name:"country",value:null},{name:"state",value:n.entity.country?n.entity.country.id:68},{name:"city",value:n.entity.state?n.entity.state.id:0},{name:"wg_structure_type",value:null},{name:"config_workplace_status",value:null}];v.getDataList(t).then(function(t){if(n.countryList=t.data.data.countryList,n.stateList=t.data.data.stateList,n.cityList=t.data.data.cityList,n.typeList=t.data.data.wg_structure_type,n.statusList=t.data.data.config_workplace_status,null==n.entity.country){var e=y("filter")(n.countryList,{code:"CO"},!0);n.entity.country=e.length>0?e[0]:null}},function(t){n.status="Unable to load customer data: "+t.message})}n.totalEmployee=0,n.isView=o,n.onCloseModal=function(){i.close(1)},n.onCancel=function(){i.dismiss("cancel")};var k=function(){n.entity={id:a.id,customerId:e.customerId,country:null,state:null,city:null,name:null,address:"",economicActivity:0,employeeDirect:0,employeeContractor:0,employeeMision:0,risk1:0,risk2:0,risk3:0,risk4:0,risk5:0,status:null},w()},w=function(){n.submitText=0==n.entity.id?"Crear Centro de Trabajo":"Guardar Centro de Trabajo"};k(),g();var C=function(){if(n.entity.id){var t={id:n.entity.id};u({method:"GET",url:"api/customer-config-workplace/get-gtc",params:t})["catch"](function(t,e){}).then(function(t){n.entity=t.data.result;var e=n.entity.economicActivity?n.entity.economicActivity.id:-1;n.disableEconomicActivity=null==n.customer.economicActivity||n.customer.economicActivity.id==e,n.onChangeEmployeeNumber(),g()})["finally"](function(){})}};C(),n.onChangeEmployeeNumber=function(){n.entity.total=parseInt(n.entity.risk1)+parseInt(n.entity.risk2)+parseInt(n.entity.risk3)+parseInt(n.entity.risk4)+parseInt(n.entity.risk5),n.totalEmployee=n.entity.total},n.onSelectCountry=function(){n.entity.state=null,n.entity.city=null,g()},n.onSelectState=function(){n.entity.city=null,g()},n.form={submit:function(t){var e=null;if(t.$invalid){var i=null,e=null;for(i in t)"$"!=i[0]&&(null!==e||t[i].$valid||(e=t[i].$name),t[i].$pristine&&(t[i].$dirty=!0));return log.info(n.standard),angular.element(".ng-invalid[name="+e+"]").focus(),void l.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}h()},reset:function(t){}};var h=function(t,e){var a={},o=JSON.stringify(n.entity);return a.data=Base64.encode(o),u({method:"POST",url:"api/customer-config-workplace/save-gtc",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(a){s(function(){t=void 0===t||t,e=void 0===e?"submitButtom":"nextButton",t&&l.swal("Registro","La información ha sido guardada satisfactoriamente","success"),n.entity=a.data.result,r&&i.close(a.data.result)})})["catch"](function(t){c.error(t),l.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})}}]);
"use strict";app.controller("customerEditCtrl",["$scope","$aside","$stateParams","$log","$state","SweetAlert","$rootScope","$http","$timeout","$uibModal","flowFactory","cfpLoadingBar","$filter","$document","SupportService",function(e,t,o,n,a,i,r,s,c,l,u,m,d,p,f){var w=n;e.currentUser=r.currentUser(),e.isAgent="agent"==e.currentUser.wg_type,e.isAdmin="system"==e.currentUser.wg_type,e.isCustomerAdmin="customerAdmin"==e.currentUser.wg_type,e.isCustomerUser="customerUser"==e.currentUser.wg_type,e.showContract=!1,e.canEdit=e.isCustomerAdmin||!a.is("app.clientes.view")&&(e.isAgent||e.isAdmin),r.canEditRoot=e.canEdit,e.flowConfig={target:"/api/upload",singleFile:!0},e.loading=!0,e.isView=a.is("app.clientes.view"),e.isCreate=a.is("app.clientes.create"),e.currentYear={id:"0",item:"-- Seleccionar --",value:(new Date).getFullYear()},e.dateConfig={culture:"es-CO",format:"dd/MM/yyyy"};var g=function(){e.customer={id:e.isCreate?0:o.customerId,logo:"",classification:null,hasEconomicGroup:!1,contacts:[{id:0,value:"",type:null}],maincontacts:[{id:0,name:"",firstname:"",lastname:"",value:"",info:[],role:null}],type:null,documentType:null,status:null,arl:null,country:null,state:null,town:null,group:null,size:null,temporalCompany:"",temporaryEmployees:0,contractNumber:0,contractStartDate:null,contractEndDate:null,totalEmployee:null,riskLevel:null,riskClass:null}};g(),e.onSelectClasification=function(){e.customer.classification&&(e.showContract="Contratista"==e.customer.classification.value,r.$emit("hasClassification",{newValue:e.customer.classification.value,message:"hasClassification Emit"}))},e.changeEconomicGroup=function(){r.$emit("hasEconomicGroup",{newValue:e.customer.hasEconomicGroup,message:"hasEconomicGroup Emit"})},e.tiposCliente=r.parameters("tipocliente"),e.estados=r.parameters("estado"),e.classifications=r.parameters("customer_classification"),e.arls=r.parameters("arl"),e.tiposdoc=r.parameters("tipodoc"),e.sizes=r.parameters("wg_customer_size"),e.totalEmployeeList=r.parameters("wg_customer_employee_number"),e.riskLevelList=r.parameters("wg_customer_risk_level"),e.riskClassList=r.parameters("wg_customer_risk_class"),e.countries=r.countries(),e.temporaryAgencies=r.temporaryAgencies(),e.groups=r.groups(),e.states=[],e.towns=[],e.uploader=new Flow,""==e.customer.logo&&(e.noImage=!0),e.onLoadRecord=function(){if(e.customer.id){var t={id:e.customer.id};s({method:"GET",url:"api/customer",params:t})["catch"](function(e){if(403==e.status){var t="app.clientes.list";i.swal("No Autorizado","No estas autorizado para ver esta información.","error"),c(function(){a.go(t)},3e3)}else 404==e.status?(i.swal("Información no disponible","Cliente no encontrado","error"),c(function(){a.go("app.clientes.list")})):i.swal("Error","Se ha presentado un error al intentar acceder a la información del cliente","error")}).then(function(t){c(function(){e.customer=t.data.result,r.attentionLines=e.customer.attentionLines,e.changeEconomicGroup(),e.isCustomerAdmin&&(e.currentUser.company!=e.customer.id?e.canEdit=!0:e.canEdit=!0),r.canEditRoot=e.canEdit,null!=e.customer.logo&&null!=e.customer.logo.path?e.noImage=!1:e.noImage=!0;var o=e.customer.state,n=e.customer.town;e.changeCountry(e.customer.country),e.changeState(o),e.customer.state=o,e.customer.town=n,e.onSelectClasification(),e.validateLicense(e.customer.id)})})["finally"](function(){c(function(){e.loading=!1},400)})}else e.loading=!1},e.onLoadRecord(),e.removeImage=function(){e.noImage=!0},e.master=e.customer,e.form={submit:function(t){var o=null;if(t.$invalid){var n=null,o=null;for(n in t)"$"!=n[0]&&(null!==o||t[n].$valid||(o=t[n].$name),t[n].$pristine&&(t[n].$dirty=!0));return w.info(e.customer),angular.element(".ng-invalid[name="+o+"]").focus(),void i.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}v()},reset:function(t){e.customer=angular.copy(e.master),t.$setPristine(!0)}};var v=function(){if(e.customer.documentType){if("N"==e.customer.documentType.code&&isNaN(e.customer.documentNumber))return void i.swal("El formulario contiene errores!","El campo Número de Documento debe contener caracteres numéricos.","error");var t=/^[a-zA-Z0-9]+$/;if("A"==e.customer.documentType.code&&!t.test(e.customer.documentNumber))return void i.swal("El formulario contiene errores!","El campo Número de Documento debe contener caracteres alfanuméricos.","error")}var o={},l=JSON.stringify(e.customer);return o.data=Base64.encode(l),s({method:"POST",url:"api/customer/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(t){i.swal("Operación exitosa","Información guardada satisfactoriamente","success"),w.info("uploader::",e.uploader),e.uploader.flow.opts.query.id=t.data.result.id,e.uploader.flow.resume(),c(function(){if(e.customer=t.data.result,r.app.supportHelp){var o=null!=e.customer.totalEmployee,n=null!=e.customer.riskClass;r.app.supportHelp.hasBasicInformation=o&&n}e.isCreate?a.go("app.clientes.edit",{customerId:e.customer.id}):null!=e.customer.logo&&null!=e.customer.logo.path?e.noImage=!1:e.noImage=!0})})["catch"](function(e){n.error(e),i.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};e.changeCountry=function(t,o){e.states=[],e.towns=[],e.customer.state=null,e.customer.town=null;var n={cid:t.id};s({method:"GET",url:"api/states",params:n})["catch"](function(e,t){}).then(function(t){e.states=t.data.result,e.towns=[]})["finally"](function(){})},e.changeState=function(t,o){e.towns=[];var n={sid:t.id};e.customer.town=null,s({method:"GET",url:"api/towns",params:n}).then(function(t){e.towns=t.data.result})["finally"](function(){})},e.cancelEdition=function(t){e.isView?a.go("app.clientes.list"):i.swal({title:"Está seguro?",text:"Perderá todos los cambios realizados en este formulario.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, cancelar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(e){e?c(function(){a.go("app.clientes.list")}):swal("Cancelación","La operación ha sido cancelada","error")})},e.onSearchEconomicActivity=function(){var o=t.open({templateUrl:r.app.views.urlRoot+"modules/customer/profile/customer_serch_list_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideCustomerEconomicActivityListCtrl",scope:e});o.result.then(function(t){e.customer.economicActivity=t},function(){n.info("Modal dismissed at: "+new Date)})},e.$watchCollection("customer.contractorTypeList",function(t,o,n){e.contractorTypeList=e.customer.contractorTypeList?d("filter")(e.customer.contractorTypeList,{isActive:!0},!0):[]}),e.onSelectRiskClass=function(){if(e.customer.riskClass){if(parseInt(e.customer.riskClass.value)>3)var t=d("filter")(e.riskLevelList,{value:"45"});else var t=d("filter")(e.riskLevelList,{value:"123"});e.customer.riskLevel=t&&t.length>0?t[0]:null}},e.validateLicense=function(t){if(e.isCustomerAdmin){var o=JSON.stringify({customerId:t}),a={data:Base64.encode(o)};return s({method:"POST",url:"api/customer-licenses/current-license/close-expire",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(e){e.data.result.closeExpire&&i.swal("Licencia pronto expira","La licencia está próxima a vencer, comuníquese con el asesor comercial para renovar la licencia.","info")})["catch"](function(e){n.error(e),i.swal("Error al guardar",e.data.message,"error")})}}}]),app.controller("ModalInstanceSideCustomerEconomicActivityListCtrl",["$rootScope","$stateParams","$scope","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile",function(e,t,o,n,a,i,r,s,c,l,u,m,d,p){o.title="ACTIVIDADES ECONÓMICAS",o.activity={id:0},o.onCloseModal=function(){n.close(o.activity)},o.onCancel=function(){n.dismiss("cancel")},o.onLoadRecord=function(){if(0!=o.activity.id){var e={id:o.activity.id};s({method:"GET",url:"api/investigation-al/economic-activity",params:e})["catch"](function(e){if(403==e.status){var t=null!==e.data.message&&void 0!==e.data.message?e.data.message:"app.clientes.list";r.swal("No Autorizado","No estas autorizado para ver esta información.","error"),i(function(){$state.go(t)},3e3)}else 404==e.status?r.swal("Información no disponible","Registro no encontrado","error"):r.swal("Error","Se ha presentado un error al intentar acceder a la información del cliente","error")}).then(function(e){i(function(){o.activity=e.data.result})})["finally"](function(){i(function(){o.onCloseModal()},400)})}else o.loading=!1};var f={operation:"restriction",data:""};o.dtInstanceDisabilityEmployeeList={},o.dtOptionsDisabilityEmployeeList=d.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:f,url:"api/investigation-al/economic-activity",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){w()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,t,n){p(angular.element(e).contents())(o)}),o.dtColumnsDisabilityEmployeeList=[m.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,t,o,n){var a="",i="",r='<a class="btn btn-success btn-xs editRow lnk" href="#" uib-tooltip="Adicionar actividad"  data-id="'+e.id+'"'+i+' >   <i class="fa fa-plus-square"></i></a> ';return a+=r}),m.newColumn("code").withTitle("Código").withOption("width",200).withOption("defaultContent",""),m.newColumn("name").withTitle("Actividad Económica").withOption("defaultContent","")];var w=function(){angular.element("#dtDisabilityEmployeeList a.editRow").on("click",function(){var e=angular.element(this).data("id");o.onEdit(e)})};o.reloadData=function(){o.dtInstanceDisabilityEmployeeList.reloadData()},o.onEdit=function(e){o.activity.id=e,o.isView=!1,o.onLoadRecord()}}]);
"use strict";app.controller("customerArlCtrl",["$scope","$aside","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","SweetAlert","$rootScope","$http","$timeout","$uibModal","flowFactory","cfpLoadingBar","$filter","$document","ChartService","ListService",function(e,t,n,r,i,o,a,l,c,s,u,d,m,f,p,h,w,v,g,C,b){function y(){var t=[{name:"customer_arl_years",criteria:{customerId:n.customerId}},{name:"customer_arl_service_years",criteria:{customerId:n.customerId}},{name:"customer_arl_service",criteria:{customerId:n.customerId}}];b.getDataList(t).then(function(t){e.filterYears=t.data.data.customerArlYears,e.filterServiceYears=t.data.data.customerArlServiceYears,e.services=t.data.data.customer_arl_service,e.filterYears.length&&(e.filteredYear=e.filterYears[0],e.onChangeFilteredYear()),e.filterServiceYears&&e.filterServiceYears.length&&(e.filteredServiceYear=e.filterServiceYears[0],e.onChangeFilteredServiceYear())},function(t){e.status="Unable to load customer data: "+t.message})}function S(){var t=[{name:"chart_line_options",criteria:null},{name:"chart_doughnut_options",criteria:null},{name:"customer_projects_arl_contributions",criteria:{customerId:n.customerId,year:e.filteredYear.year}}];C.getDataChart(t).then(function(t){e.chart.doughnut.options=t.data.data.chartDoughnutOptions,e.chart.doughnut.options.legend.position="top",e.chart.doughnut.options.maintainAspectRatio=!1,e.chart.doughnut.options.responsive=!1,e.chart.line.options=angular.copy(t.data.data.chartLineOptions),e.chart.line.options.scales.yAxes=[{ticks:{callback:function(e){return"$ "+v("number")(e,0)}}}],e.chart.line.options.tooltips={callbacks:{label:function(e,t){var n=v("number")(e.yLabel,2),r=t.datasets[e.datasetIndex].label;return r+":  $ "+n}}},e.chart.doughnut.options.tooltips={callbacks:{label:function(e,t){var n=t.datasets[e.datasetIndex].data[e.index],r=v("number")(n,2),i=t.labels[e.index];return i+":  $ "+r}}},e.chart.data.contributationsVsExecutions=t.data.data.customerProjectsArlContributions,e.chart.data.contributationsVsExecutionsByMonth=t.data.data.contributionsVsExec},function(t){e.status="Unable to load customer data: "+t.message})}function O(n){var r=t.open({templateUrl:d.app.views.urlRoot+"modules/customer/profile/arl/balance_modal.htm",placement:"right",windowTopClass:"top-modal",size:"lg",controller:"customerContributionBalanceModalCtrl",scope:e,resolve:{dataSource:{year:n}}});r.result.then()}var R=r;e.currentUser=d.currentUser(),e.isAgent="agent"==e.currentUser.wg_type,e.isAdmin="system"==e.currentUser.wg_type,e.isCustomerAdmin="customerAdmin"==e.currentUser.wg_type,e.isCustomerUser="customerUser"==e.currentUser.wg_type,e.filterYears=[],e.filterYears=[],e.services=[],e.filteredYear=null,e.filteredServiceYear=null,e.canEdit=!s.is("app.clientes.view")&&(e.isAgent||e.isAdmin),d.canEditRoot=e.canEdit,e.isView=s.is("app.clientes.view"),e.isCreate=s.is("app.clientes.create"),e.chart={line:{options:null},doughnut:{options:null},data:{contributationsVsExecutions:null,contributationsVsExecutionsByMonth:null}};var T=function(){e.contribution={id:0,customerId:e.customer.id,input:"",year:(new Date).getFullYear(),month:null,percentReinvestmentARL:0,percentReinvestmentWG:0,reinvestmentARL:0,reinvestmentWG:0,total:0}};T(),y(),e.months=d.parameters("month"),e.onLoadRecord=function(){if(0!=e.contribution.id){var t={id:e.contribution.id};m({method:"GET",url:"api/contribution",params:t})["catch"](function(e,t){if(403==t){var n=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";u.swal("No Autorizado","No estas autorizado para ver esta información.","error"),f(function(){s.go(n)},3e3)}else 404==t?(u.swal("Información no disponible","Aporte no encontrado","error"),f(function(){s.go("app.clientes.list")})):u.swal("Error","Se ha presentado un error al intentar acceder a la información del aporte","error")}).then(function(t){f(function(){e.contribution=t.data.result})})["finally"](function(){f(function(){e.loading=!1},400),f(function(){g.scrollTop(0,2e3)})})}else R.info("creacion de nuevo cliente"),e.loading=!1},e.master=e.contribution,e.form={submit:function(e){if(e.$invalid){var t=null,n=null;for(t in e)"$"!=t[0]&&(null!==n||e[t].$valid||(n=e[t].$name),e[t].$pristine&&(e[t].$dirty=!0));angular.element(".ng-invalid[name="+n+"]").focus(),u.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}else u.swal("Validación exitosa","Guardando información del cliente...","success"),A()},reset:function(t){e.customer=angular.copy(e.master),t.$setPristine(!0)}};var A=function(){var t={},n=JSON.stringify(e.contribution);return t.data=Base64.encode(n),m({method:"POST",url:"api/contribution/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){f(function(){u.swal("Validación exitosa","Guardando información del aporte...","success"),e.contribution=t.data.result,y(),e.reloadData(),e.clearContribution()})})["catch"](function(e){r.error(e),u.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})};e.cancelEdition=function(t){e.isView?s.go("app.clientes.list"):u.swal({title:"Está seguro?",text:"Perderá todos los cambios realizados en este formulario.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, cancelar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(e){e?f(function(){s.go("app.clientes.list")}):swal("Cancelación","La operación ha sido cancelada","error")})},e.dtInstanceContribution={},e.dtOptionsContribution=i.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.customer_id=e.customer.id,t.year=e.filteredYear.year,t},url:"api/contribution",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return null!=e.filteredYear}).withOption("fnDrawCallback",function(){E()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,n,r){l(angular.element(t).contents())(e)}),e.dtColumnsContribution=[o.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,n,r,i){var o="",a='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+t.id+'" >   <i class="fa fa-edit"></i></a> ',l='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+t.id+'" >   <i class="fa fa-trash-o"></i></a> ';return d.can("clientes_edit")&&e.canEdit&&(o+=a),d.can("clientes_delete")&&e.canEdit&&(o+=l),o}),o.newColumn("year").withTitle("Año"),o.newColumn("month").withTitle("Mes"),o.newColumn("input").withTitle("Aporte").renderWith(function(e){return"$ "+v("number")(e,2)}),o.newColumn("percent_reinvestment_arl").withTitle("% Comisión ARL"),o.newColumn("reinvestmentARL").withTitle("Comisión ARL").renderWith(function(e){return"$ "+v("number")(e,2)}),o.newColumn("percent_reinvestment_wg").withTitle("% Reinversión WG"),o.newColumn("reinvestmentWG").withTitle("Reinversión WG").renderWith(function(e){return"$ "+v("number")(e,2)}),o.newColumn("sales").withTitle("Ventas").renderWith(function(e){return"$ "+v("number")(e,2)}),o.newColumn("balance").withTitle("Balance").renderWith(function(e){return"$ "+v("number")(e,2)})];var E=function(){angular.element("#dtCustomerContribution a.editRow").on("click",function(){var t=angular.element(this).data("id");e.onEdit(t)}),angular.element("#dtCustomerContribution a.delRow").on("click",function(){var t=angular.element(this).data("id");u.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(n){if(n){var i={};i.id=t,m({method:"POST",url:"api/contribution/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){r.error(e),u.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){e.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};e.dtInstanceBalance={},e.dtOptionsBalance=i.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerId=n.customerId,JSON.stringify(e)},url:"api/customer-contributions/get-general-balanace",type:"POST"}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return null!=e.filteredYear}).withOption("fnDrawCallback",function(){_()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,n,r){l(angular.element(t).contents())(e)}),e.dtColumnsBalance=[o.newColumn(null).withTitle("Acciones").withOption("width",100).notSortable().renderWith(function(e){return'<a class="btn btn-primary btn-xs viewRow lnk" href="#" uib-tooltip="Ver" data-year="'+e.year+'" >   <i class="fa fa-eye"></i></a> '}),o.newColumn("year").withTitle("Año"),o.newColumn("previousBalance").withTitle("SALDO ANTERIOR").renderWith(function(e){return"$ "+v("number")(e,2)}),o.newColumn("contributions").withTitle("APORTE ACUMULADO").renderWith(function(e){return"$ "+v("number")(e,2)}),o.newColumn("commissions").withTitle("COMISIÓN ACUMULADA").renderWith(function(e){return"$ "+v("number")(e,2)}),o.newColumn("reinvesments").withTitle("REINVERSIÓN ACUMULADA").renderWith(function(e){return"$ "+v("number")(e,2)}),o.newColumn("sales").withTitle("VENTAS ACUMULADAS").renderWith(function(e){return"$ "+v("number")(e,2)}),o.newColumn("balance").withTitle("BALANCE TOTAL").renderWith(function(e){return"$ "+v("number")(e,2)})],e.onEdit=function(t){e.contribution.id=t,e.isView=!1,e.onLoadRecord()},e.onChangeFilteredYear=function(t){t&&(e.filteredYear=t),e.onRefresh()},e.onChangeFilteredServiceYear=function(t){t&&(e.filteredServiceYear=t),e.reloadServiceData()},e.onRefresh=function(){S(),e.reloadData()},e.onChangeInput=function(){e.calculateReinvestmentARL(),e.calculateReinvestmentWG()},e.onChangeReinvestmentARL=function(){e.calculateReinvestmentARL()},e.onChangeReinvestmentWG=function(){e.calculateReinvestmentWG()},e.calculateReinvestmentARL=function(){e.contribution.reinvestmentARL=e.contribution.input*e.contribution.percentReinvestmentARL/100,e.calculateReinvestmentWG()},e.calculateReinvestmentWG=function(){e.contribution.reinvestmentWG=e.contribution.reinvestmentARL*e.contribution.percentReinvestmentWG/100},e.dtInstanceContributionCallback=function(t){e.dtInstanceContribution=t},e.reloadData=function(){e.dtInstanceContribution.reloadData(),e.dtInstanceBalance.reloadData()},e.clearContribution=function(){T()};var D=function(){var t={};t.customer_id=n.customerId,t.year=e.currentYear.value,m({method:"GET",url:"api/customer/report",params:t}).then(function(t){f(function(){e.options.responsive=!0,e.data_rpt=t.data.result.report_contribution,e.years=t.data.result.report_years,$.each(e.data_rpt.datasets,function(e,t){var n="rgb("+t.fillColor.r+","+t.fillColor.g+","+t.fillColor.b+")";t.fillColor=n,t.highlightFill=n,t.highlightStroke=n}),0==e.years.length&&(e.years=[{id:"0",item:"-- Seleccionar --",value:"-S-"}])})})["catch"](function(e){r.error(e),u.swal("Error Cargando Reportes","Se ha presentado un error durante la consulta de los reportes para el diagnóstico por favor intentelo de nuevo","error")})["finally"](function(){})},_=function(){angular.element("#dtCustomerBalance a.viewRow").on("click",function(){var e=angular.element(this).data("year");O(e)})};e.changeReportYear=function(t,n){e.currentYear=t,f(function(){D()},3e3)};var I=null,B=function(){e.entity={id:0,customerId:e.customer.id,service:null,cost:0},null!=I&&I.$setPristine(!0)};B();var Y=function(t){var n={id:t};m({method:"GET",url:"api/customer-arl-service-cost/get",params:n})["catch"](function(e,t){if(403==t){var n=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";u.swal("No Autorizado","No estas autorizado para ver esta información.","error"),f(function(){s.go(n)},3e3)}else 404==t?(u.swal("Información no disponible","Aporte no encontrado","error"),f(function(){s.go("app.clientes.list")})):u.swal("Error","Se ha presentado un error al intentar acceder a la información del aporte","error")}).then(function(t){f(function(){e.entity=t.data.result,e.entity.registrationDate&&(e.entity.registrationDate=new Date(e.entity.registrationDate.date))})})["finally"](function(){})};e.formService={submit:function(t){if(I=t,t.$invalid){var n=null,r=null;for(n in t)"$"!=n[0]&&(null!==r||t[n].$valid||(r=t[n].$name),t[n].$pristine&&(t[n].$dirty=!0));angular.element(".ng-invalid[name="+r+"]").focus(),u.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}else{if(!e.entity.cost||e.entity.cost<=0)return void u.swal("Alerta","El costo es requerido","error");x()}},reset:function(t){e.customer=angular.copy(e.master),t.$setPristine(!0)}};var x=function(){var t={},n=JSON.stringify(e.entity);return t.data=Base64.encode(n),m({method:"POST",url:"api/customer-arl-service-cost/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){f(function(){u.swal("Operación exitosa","Registro agregado satisfactoriamente","success"),e.reloadServiceData(),e.onClearService()})})["catch"](function(e){r.error(e),u.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})};e.dtOptionsServiceCost=i.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.customerId=e.customer.id,e.filteredServiceYear&&(t.year=e.filteredServiceYear.value),JSON.stringify(t)},url:"api/customer-arl-service-cost",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){L()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,n,r){l(angular.element(t).contents())(e)}),e.dtColumnsServiceCost=[o.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,n,r,i){var o="",a='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+t.id+'" >   <i class="fa fa-edit"></i></a> ';return d.can("clientes_arl_service_edit")&&e.canEdit&&(o+=a),o}),o.newColumn("registrationDate").withTitle("Fecha").withOption("width",200).withOption("defaultContent",""),o.newColumn("service").withTitle("Servicio").withOption("defaultContent",""),o.newColumn("cost").withTitle("Costo").withOption("width",200).renderWith(function(e){return"$ "+v("number")(e,2)})];var L=function(){angular.element("#dtCustomerServiceCost a.editRow").on("click",function(){var t=angular.element(this).data("id");e.onEditService(t)}),angular.element("#dtCustomerServiceCost a.delRow").on("click",function(){var t=angular.element(this).data("id");u.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(n){if(n){var i={};i.id=t,m({method:"POST",url:"api/customer-arl-service-cost/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){r.error(e),u.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){e.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};e.onEditService=function(t){e.isView=!1,Y(t)},e.dtInstanceServiceCostCallback=function(t){e.dtInstanceServiceCost=t},e.reloadServiceData=function(){e.dtInstanceServiceCost.reloadData()},e.onClearService=function(){B()},e.onGenerateReport=function(){if(!e.filteredYear)return void u.swal("Error","Debe seleccionar el periodo.","error");var t={customerId:n.customerId,selectedYear:e.filteredYear?e.filteredYear.year:null};angular.element("#downloadDocument")[0].src="api/customer-contributions/generate-report-pdf?data="+Base64.encode(JSON.stringify(t))}}]);
"use strict";app.controller("customerContributionBalanceModalCtrl",["$rootScope","$stateParams","$scope","$log","$timeout","$uibModalInstance","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$http","$filter","toaster","$compile","$aside","ngNotify","ListService","dataSource",function(t,e,i,n,o,a,s,l,r,c,u,p,f,d,m,h,y){function C(){var t=[{name:"export_url",value:null},{name:"customer_contributions_detail_balance_months",criteria:{customerId:e.customerId,year:i.year}}];h.getDataList(t).then(function(t){i.monthList=t.data.data.customerContributionsDetailBalanceMonths,i.typeList=t.data.data.customerContributionsDetailBalanceTypes,i.exportUrl=t.data.data.exportUrl.item})}function w(){var o=JSON.stringify({userId:t.currentUser().id,customerId:e.customerId,year:i.year,month:i.filters.month?i.filters.month.value:null,type:i.filters.type?i.filters.type.item:null,concept:i.filters.concept?i.filters.concept.item:null,classification:i.filters.classification?i.filters.classification.item:null}),a={data:Base64.encode(o)},s=i.exportUrl+"api/v1/customer-contribution/detail-balance-export";return c({method:"POST",url:s,headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(t){var e=i.exportUrl+"storage/"+t.data.filename,n='<a class="btn btn-wide btn-default" href="'+e+'" target="_self"><i class="glyphicon glyphicon-download"></i> Descargar el reporte</a>';t.data.isQueue&&(e="app/user/messages",n=t.data.message+' <a  class="btn btn-wide btn-default" href="'+e+'" translate="Ver mensajes"> Ver mensajes </a>'),m.set(n,{position:"bottom",sticky:!0,type:t.data.isQueue?"info":"success",button:!0,html:!0})})["catch"](function(t){n.error(t),null!=response.data&&void 0!==response.data.message?m.set(response.data.message,{position:"bottom",sticky:!0,type:"error",button:!0,html:!0}):m.set("Lo sentimos, ha ocurrido un error en la generación del reporte",{position:"bottom",sticky:!0,type:"error",button:!0,html:!0})})}i.year=y.year,i.monthList=[],i.typeList=[],i.conceptList=[],i.classificationList=[],i.concepts=t.parameters("project_concepts"),i.classifications=t.parameters("project_classifications");var b=function(){i.filters={month:null,type:null,concept:null,classification:null},i.conceptList=[],i.classificationList=[]};b(),C(),i.onClose=function(){a.close(1)},i.onCancel=function(){b(),i.reloadData()},i.onChangeClassification=function(){console.log("on Change classification"),i.reloadData()},i.onChangeConcept=function(){i.filters.classification=null,i.classificationList=u("filter")(i.classifications,{code:i.filters.concept.value}),i.reloadData()},i.onChangeType=function(){i.filters.concept=null,i.filters.classification=null,i.classificationList=[],i.conceptList=u("filter")(i.concepts,{code:i.filters.type.value}),i.reloadData()},i.onChangeMonth=function(){i.reloadData()},i.onExport=function(){w()},i.dtInstanceCustomerContributionBalanceDetail={},i.dtOptionsCustomerContributionBalanceDetail=s.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.customerId=e.customerId,t.year=i.year,t.period=i.filters.month?i.filters.month.item:null,t.type=i.filters.type?i.filters.type.item:null,t.concept=i.filters.concept?i.filters.concept.item:null,t.classification=i.filters.classification?i.filters.classification.item:null,JSON.stringify(t)},url:"api/customer-contributions/get-detail-balanace",type:"POST"}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withPaginationType("full_numbers").withOption("createdRow",function(t){f(angular.element(t).contents())(i)}),i.dtColumnsCustomerContributionBalanceDetail=[l.newColumn("period").withTitle("Periodo"),l.newColumn("type").withTitle("Tipo"),l.newColumn("activity").withTitle("Actividad"),l.newColumn("concept").withTitle("Concepto"),l.newColumn("classification").withTitle("Clasificación"),l.newColumn("total").withTitle("Valor Total").renderWith(function(t){return"$ "+u("number")(t,2)})],i.reloadData=function(){i.dtInstanceCustomerContributionBalanceDetail.reloadData()}}]);
"use strict";app.controller("customerCertificateProgramCtrl",["$scope","$aside","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","SweetAlert","$rootScope","$http","$timeout","$uibModal","flowFactory","cfpLoadingBar","$filter","$document","ListService",function(e,t,i,a,r,n,o,c,l,s,u,d,f,m,p,w,g,h,v,C){function O(){var t=[{name:"certificate_program"}];C.getDataList(t).then(function(t){e.programs=t.data.data.certificateProgram},function(t){e.status="Unable to load customer data: "+t.message})}e.currentUser=d.currentUser(),e.isAgent="agent"==e.currentUser.wg_type,e.isAdmin="system"==e.currentUser.wg_type,e.isCustomerAdmin="customerAdmin"==e.currentUser.wg_type,e.isCustomerUser="customerUser"==e.currentUser.wg_type,e.canEdit=e.isCustomerAdmin||!s.is("app.clientes.view")&&(e.isAgent||e.isAdmin),d.canEditRoot=e.canEdit,O();var P=function(){e.certificate={id:0,customerId:i.customerId,program:null,amount:0,isActive:!0}};P(),e.isView=s.is("app.clientes.view"),e.isCreate=s.is("app.clientes.create"),e.onLoadRecord=function(){if(0!=e.certificate.id){var t={id:e.certificate.id};f({method:"GET",url:"api/customer/certificate-program",params:t})["catch"](function(e){if(403==e.status){var t=null!==e.data.message&&void 0!==e.data.message?e.data.message:"app.clientes.list";u.swal("No Autorizado","No estas autorizado para ver esta información.","error"),m(function(){s.go(t)},3e3)}else 404==code?(u.swal("Información no disponible","Aporte no encontrado","error"),m(function(){s.go("app.clientes.list")})):u.swal("Error","Se ha presentado un error al intentar acceder a la información del aporte","error")}).then(function(t){m(function(){e.certificate=t.data.result})})["finally"](function(){m(function(){v.scrollTop(0,2e3)})})}},e.master=e.certificate,e.form={submit:function(e){var t=null;if(e.$invalid){var i=null,t=null;for(i in e)"$"!=i[0]&&(null!==t||e[i].$valid||(t=e[i].$name),e[i].$pristine&&(e[i].$dirty=!0));return angular.element(".ng-invalid[name="+t+"]").focus(),void u.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}b()},reset:function(t){e.certificate=angular.copy(e.master),t.$setPristine(!0)}};var b=function(){if(null==e.certificate.program||0==e.certificate.amount)return void u.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error");var t={},i=JSON.stringify(e.certificate);return t.data=Base64.encode(i),f({method:"POST",url:"api/customer/certificate-program/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){m(function(){e.certificate=t.data.result,u.swal("Validación exitosa","Guardando información del aporte...","success"),e.reloadDataCertificate(),e.clearCertificateProgram()})})["catch"](function(e){u.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};e.cancelEdition=function(t){e.isView?s.go("app.clientes.list"):u.swal({title:"Está seguro?",text:"Se perderan todos los cambios realizados en esta vista.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, cancelar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(e){e?m(function(){s.go("app.clientes.list")}):swal("Cancelación","La operación ha sido cancelada","error")})};var T={customer_id:e.customer.id};e.dtInstanceCertificateProgram={},e.dtOptionsCertificateProgram=r.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:T,url:"api/customer/certificate-program",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){y()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,i,a){c(angular.element(t).contents())(e)}),e.dtColumnsCertificateProgram=[n.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,i,a,r){var n="",o='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+t.id+'" >   <i class="fa fa-edit"></i></a> ',c='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+t.id+'" >   <i class="fa fa-trash-o"></i></a> ';return d.can("clientes_edit")&&(n+=o),d.can("clientes_delete")&&(n+=c),!e.isAdmin&&!e.isAgent||e.isView?"":n}),n.newColumn("program.name").withTitle("Programa").withOption("width",200),n.newColumn("program.amount").withTitle("Valor Programa").withOption("width",200),n.newColumn("program.currency.item").withTitle("Moneda").withOption("width",200),n.newColumn("amount").withTitle("Valor Modificado").withOption("width",200),n.newColumn(null).withTitle("Estado").withOption("width",200).renderWith(function(e,t,i,a){var r="label label-danger",n="Inactivo";null==e.isActive&&void 0==e.isActive||(e.isActive?(r="label label-success",n="Activo"):(r="label label-danger",n="Inactivo"));var o='<span class="'+r+'">'+n+"</span>";return o})];var y=function(){angular.element("#dtCustomerCertificateProgram a.editRow").on("click",function(){var t=angular.element(this).data("id");e.onEdit(t)}),angular.element("#dtCustomerCertificateProgram a.delRow").on("click",function(){var t=angular.element(this).data("id");u.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(i){if(i){var r={};r.id=t,f({method:"POST",url:"api/customer/certificate-program/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(r)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){a.error(e),u.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){e.reloadDataCertificate()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};e.onEdit=function(t){e.certificate.id=t,e.isView=!1,e.onLoadRecord()},e.dtInstanceCertificateProgramCallback=function(t){e.dtInstanceCertificateProgram=t},e.reloadDataCertificate=function(){e.dtInstanceCertificateProgram.reloadData()},e.clearCertificateProgram=function(){P()}}]);
"use strict";app.controller("customerContactCtrl",["$scope","$aside","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","SweetAlert","$rootScope","$http","$timeout","$uibModal","flowFactory","cfpLoadingBar","$filter","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$document",function(e,n,o,t,a,i,r,c,l,s,u,d,m,f,p,C,w,v,g){var h=t;e.currentUser=d.currentUser(),e.isAgent="agent"==e.currentUser.wg_type,e.isAdmin="system"==e.currentUser.wg_type,e.isCustomerAdmin="customerAdmin"==e.currentUser.wg_type,e.isCustomerUser="customerUser"==e.currentUser.wg_type,e.canEdit=e.isCustomerAdmin||!s.is("app.clientes.view")&&(e.isAgent||e.isAdmin),d.canEditRoot=e.canEdit,e.isView=s.is("app.clientes.view"),e.isCreate=s.is("app.clientes.create"),e.extrainfo=d.parameters("extrainfo"),e.rolescontact=v("orderBy")(d.parameters("rolescontact"),"id",!1);var y=d.$on("dataCustomer",function(n,o){e.customer=o.newValue});e.$on("$destroy",function(){y()}),e.master=e.customer,e.form={submit:function(n){var o=null;if(n.$invalid){var t=null,o=null;for(t in n)"$"!=t[0]&&(null!==o||n[t].$valid||(o=n[t].$name),n[t].$pristine&&(n[t].$dirty=!0));return h.info(e.customer),angular.element(".ng-invalid[name="+o+"]").focus(),void u.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}B()},reset:function(n){e.customer=angular.copy(e.master),n.$setPristine(!0)}};var B=function(){var n={},o=JSON.stringify(e.customer);return n.data=Base64.encode(o),m({method:"POST",url:"api/customer/saveContacts",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(n){f(function(){u.swal("Validación exitosa","Guardando información del cliente...","success"),e.customer=n.data.result})})["catch"](function(e){t.error(e),u.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};e.addInfoContact=function(n,o){e.openModal(o)},e.openModal=function(n){var o=p.open({templateUrl:d.app.views.urlRoot+"modules/customer/profile/customer_modal_info_contact.htm",controller:"ModalContactInstanceCtrl",backdrop:"static",windowTopClass:"top-modal",scope:e,resolve:{mainContact:function(){return n},isView:function(){return e.isView}}});o.result.then(function(e){h.info("despues de cerrar....")},function(){t.info("Modal dismissed at: "+new Date)})},e.addMainContact=function(){null==e.customer.maincontacts&&(e.customer.maincontacts=[]),f(function(){e.customer.maincontacts.push({id:0,name:"",firstname:"",lastname:"",value:"",info:[],role:null})},500)},e.removeMainContact=function(n){u.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(o){o?f(function(){var o=e.customer.maincontacts[n];if(0==o.id)e.customer.maincontacts.splice(n,1);else{var a={};a.id=o.id,m({method:"POST",url:"api/customer/contact/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(o){l.pop("success","Operación Exitosa","Registro eliminado"),e.customer.maincontacts.splice(n,1)})["catch"](function(e){t.error(e),"Action plan related."==e.message?l.pop("error","Error","No se puede eliminar el registro. El contacto tiene planes de acción relacionados"):l.pop("error","Error","Por favor verifique los datos requeridos del formulario y vuelva a intentarlo")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})},e.cancelEdition=function(n){e.isView?s.go("app.clientes.list"):u.swal({title:"Está seguro?",text:"Perderá todos los cambios realizados en este formulario.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, cancelar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(e){e?f(function(){s.go("app.clientes.list")}):swal("Cancelación","La operación ha sido cancelada","error")})}}]),app.controller("ModalContactInstanceCtrl",["$scope","$uibModalInstance","mainContact","$log","$timeout","SweetAlert","isView","$http",function(e,n,o,t,a,i,r,c){null!==o.info&&void 0!==o.info&&0!==o.info.length||(o.info=[{id:0,value:"",type:{item:"-- Seleccionar --",value:"-S-"}}]),e.mainContact=o,e.isView=r,e.ok=function(){n.close(1)},e.cancel=function(){n.dismiss("cancel")},e.clone=function(){a(function(){e.mainContact.info.push({id:0,value:"",type:{item:"-- Seleccionar --",value:"-S-"}})})},e.addInfo=function(){o.info.push({id:0,value:"",type:{item:"-- Seleccionar --",value:"-S-"}})},e.removeContact=function(n){i.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(o){o?a(function(){var o=e.mainContact.info[n];if(0==o.id)e.mainContact.info.splice(n,1);else{var a={};a.id=o.id,c({method:"POST",url:"api/customer/info-detail/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(o){swal("Operación Exitosa","Registro eliminado","success"),e.mainContact.info.splice(n,1)})["catch"](function(e){t.error(e),"Action plan related."==e.message?swal("Cancelación","No se puede eliminar el registro. El contacto tiene planes de acción relacionados","error"):swal("Cancelación","Por favor verifique los datos requeridos del formulario y vuelva a intentarlo","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})}}]);
"use strict";app.controller("customerContractRequirementCtrl",["$scope","$aside","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","SweetAlert","$rootScope","$http","$timeout","$uibModal","flowFactory","cfpLoadingBar","$filter","$document",function(e,n,t,i,r,a,o,l,c,s,u,d,m,p,f,w,h,b,v){var g=i;e.currentUser=d.currentUser(),e.isAgent="agent"==e.currentUser.wg_type,e.isAdmin="system"==e.currentUser.wg_type,e.isCustomerAdmin="customerAdmin"==e.currentUser.wg_type,e.isCustomerUser="customerUser"==e.currentUser.wg_type,e.canEdit=e.isCustomerAdmin||!s.is("app.clientes.view")&&(e.isAgent||e.isAdmin),d.canEditRoot=e.canEdit,e.contractorTypeList=[],e.$watchCollection("customer.contractorTypeList",function(n,t,i){e.contractorTypeList=e.customer.contractorTypeList?b("filter")(e.customer.contractorTypeList,{isActive:!0},!0):[]});var C=function(){e.requirement={id:0,customerId:t.customerId,value:"",isActive:!0,jan:!1,feb:!1,mar:!1,apr:!1,may:!1,jun:!1,jul:!1,aug:!1,sep:!1,oct:!1,nov:!1,dec:!1,contractorTypeList:[]}};C(),e.isView=s.is("app.clientes.view"),e.isCreate=s.is("app.clientes.create"),e.onLoadRecord=function(){if(0!=e.requirement.id){g.info("editando cliente con código: "+e.requirement.id);var n={id:e.requirement.id};m({method:"GET",url:"api/customer/periodic-requirement",params:n})["catch"](function(e){if(403==e.status){var n=null!==e.data.message&&void 0!==e.data.message?e.data.message:"app.clientes.list";u.swal("No Autorizado","No estas autorizado para ver esta información.","error"),p(function(){s.go(n)},3e3)}else 404==e.status?(u.swal("Información no disponible","Aporte no encontrado","error"),p(function(){s.go("app.clientes.list")})):u.swal("Error","Se ha presentado un error al intentar acceder a la información del aporte","error")}).then(function(n){p(function(){e.requirement=n.data.result})})["finally"](function(){p(function(){v.scrollTop(0,2e3)})})}},e.master=e.requirement,e.form={submit:function(e){var n=null;if(e.$invalid){var t=null,n=null;for(t in e)"$"!=t[0]&&(null!==n||e[t].$valid||(n=e[t].$name),e[t].$pristine&&(e[t].$dirty=!0));return angular.element(".ng-invalid[name="+n+"]").focus(),void u.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}T()},reset:function(n){e.requirement=angular.copy(e.master),n.$setPristine(!0)}};var T=function(){if(""==e.requirement.value)return void u.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error");var n={},t=JSON.stringify(e.requirement);return n.data=Base64.encode(t),m({method:"POST",url:"api/customer/periodic-requirement/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(n){p(function(){e.requirement=n.data.result,u.swal("Validación exitosa","Guardando información del contratista...","success"),e.reloadDataPeriodicRequirement(),e.clearPeriodicRequirement()})})["catch"](function(e){i.error(e),u.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};e.cancelEdition=function(n){e.isView?s.go("app.clientes.list"):u.swal({title:"Está seguro?",text:"Perderá todos los cambios realizados en este formulario.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, cancelar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(e){e?p(function(){s.go("app.clientes.list")}):swal("Cancelación","La operación ha sido cancelada","error")})},e.onAddRequirementContractType=function(){p(function(){null==e.requirement.contractorTypeList&&(e.requirement.contractorTypeList=[]),e.requirement.contractorTypeList.push({id:0,customerContractorType:null})})},e.onRemoveRequirementContractType=function(n){u.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(t){t?p(function(){var t=e.requirement.contractorTypeList[n];if(e.requirement.contractorTypeList.splice(n,1),0!=t.id){var r={};r.id=t.id,m({method:"POST",url:"api/customer/periodic-requirement-contractor-type/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(r)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){i.error(e),u.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})};var q={customer_id:e.customer.id};e.dtInstancePeriodicRequirement={},e.dtOptionsPeriodicRequirement=r.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:q,url:"api/customer/periodic-requirement",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){y()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(n,t,i){l(angular.element(n).contents())(e)}),e.dtColumnsPeriodicRequirement=[a.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(n,t,i,r){var a="",o='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+n.id+'" >   <i class="fa fa-edit"></i></a> ',l='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+n.id+'" >   <i class="fa fa-trash-o"></i></a> ';return d.can("clientes_edit"),a+=o,d.can("clientes_delete"),a+=l,e.isAdmin||e.isAgent||e.isCustomerAdmin?a:""}),a.newColumn("value").withTitle("Requisito"),a.newColumn(null).withTitle("ENE").withOption("width",80).renderWith(function(e,n,t,i){var r="label label-danger",a="No";null==e.jan&&void 0==e.jan||(e.jan?(r="label label-success",a="Si"):(r="label label-danger",a="No"));var o='<span class="'+r+'">'+a+"</span>";return o}),a.newColumn(null).withTitle("FEB").withOption("width",80).renderWith(function(e,n,t,i){var r="label label-danger",a="No";null==e.feb&&void 0==e.feb||(e.feb?(r="label label-success",a="Si"):(r="label label-danger",a="No"));var o='<span class="'+r+'">'+a+"</span>";return o}),a.newColumn(null).withTitle("MAR").withOption("width",80).renderWith(function(e,n,t,i){var r="label label-danger",a="No";null==e.mar&&void 0==e.mar||(e.mar?(r="label label-success",a="Si"):(r="label label-danger",a="No"));var o='<span class="'+r+'">'+a+"</span>";return o}),a.newColumn(null).withTitle("ABR").withOption("width",80).renderWith(function(e,n,t,i){var r="label label-danger",a="No";null==e.apr&&void 0==e.apr||(e.apr?(r="label label-success",a="Si"):(r="label label-danger",a="No"));var o='<span class="'+r+'">'+a+"</span>";return o}),a.newColumn(null).withTitle("MAY").withOption("width",80).renderWith(function(e,n,t,i){var r="label label-danger",a="No";null==e.may&&void 0==e.may||(e.may?(r="label label-success",a="Si"):(r="label label-danger",a="No"));var o='<span class="'+r+'">'+a+"</span>";return o}),a.newColumn(null).withTitle("JUN").withOption("width",80).renderWith(function(e,n,t,i){var r="label label-danger",a="No";null==e.jun&&void 0==e.jun||(e.jun?(r="label label-success",a="Si"):(r="label label-danger",a="No"));var o='<span class="'+r+'">'+a+"</span>";return o}),a.newColumn(null).withTitle("JUL").withOption("width",80).renderWith(function(e,n,t,i){var r="label label-danger",a="No";null==e.jul&&void 0==e.jul||(e.jul?(r="label label-success",a="Si"):(r="label label-danger",a="No"));var o='<span class="'+r+'">'+a+"</span>";return o}),a.newColumn(null).withTitle("AGO").withOption("width",80).renderWith(function(e,n,t,i){var r="label label-danger",a="No";null==e.aug&&void 0==e.aug||(e.aug?(r="label label-success",a="Si"):(r="label label-danger",a="No"));var o='<span class="'+r+'">'+a+"</span>";return o}),a.newColumn(null).withTitle("SEP").withOption("width",80).renderWith(function(e,n,t,i){var r="label label-danger",a="No";null==e.sep&&void 0==e.sep||(e.sep?(r="label label-success",a="Si"):(r="label label-danger",a="No"));var o='<span class="'+r+'">'+a+"</span>";return o}),a.newColumn(null).withTitle("OCT").withOption("width",80).renderWith(function(e,n,t,i){var r="label label-danger",a="No";null==e.oct&&void 0==e.oct||(e.oct?(r="label label-success",a="Si"):(r="label label-danger",a="No"));var o='<span class="'+r+'">'+a+"</span>";return o}),a.newColumn(null).withTitle("NOV").withOption("width",80).renderWith(function(e,n,t,i){var r="label label-danger",a="No";null==e.nov&&void 0==e.nov||(e.nov?(r="label label-success",a="Si"):(r="label label-danger",a="No"));var o='<span class="'+r+'">'+a+"</span>";return o}),a.newColumn(null).withTitle("DIC").withOption("width",80).renderWith(function(e,n,t,i){var r="label label-danger",a="No";null==e.dec&&void 0==e.dec||(e.dec?(r="label label-success",a="Si"):(r="label label-danger",a="No"));var o='<span class="'+r+'">'+a+"</span>";return o}),a.newColumn(null).withTitle("Estado").withOption("width",200).renderWith(function(e,n,t,i){var r="label label-danger",a="Inactivo";null==e.isActive&&void 0==e.isActive||(e.isActive?(r="label label-success",a="Activo"):(r="label label-danger",a="Inactivo"));var o='<span class="'+r+'">'+a+"</span>";return o})];var y=function(){angular.element("#dtContractPeriodicRequirement a.editRow").on("click",function(){var n=angular.element(this).data("id");e.onEdit(n)}),angular.element("#dtContractPeriodicRequirement a.delRow").on("click",function(){var n=angular.element(this).data("id");u.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(t){if(t){var r={};r.id=n,m({method:"POST",url:"api/customer/periodic-requirement/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(r)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){i.error(e),u.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){e.reloadDataPeriodicRequirement()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};e.onEdit=function(n){e.requirement.id=n,e.isView=!1,e.onLoadRecord()},e.dtInstancePeriodicRequirementCallback=function(n){e.dtInstancePeriodicRequirement=n},e.reloadDataPeriodicRequirement=function(){e.dtInstancePeriodicRequirement.reloadData()},e.clearPeriodicRequirement=function(){C()}}]);
"use strict";app.controller("customerContractorCtrl",["$scope","$aside","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","SweetAlert","$rootScope","$http","$timeout","$uibModal","flowFactory","cfpLoadingBar","$filter","$document","ListService",function(t,n,o,r,a,i,c,l,s,u,d,m,f,p,w,h,C,g,v,b){function O(){var n=[{name:"contractor_customer",value:o.customerId}];b.getDataList(n).then(function(n){t.customers=n.data.data.contractorCustomer},function(n){t.status="Unable to load customer data: "+n.message})}t.currentUser=m.currentUser(),t.isAgent="agent"==t.currentUser.wg_type,t.isAdmin="system"==t.currentUser.wg_type,t.isCustomerAdmin="customerAdmin"==t.currentUser.wg_type,t.isCustomerUser="customerUser"==t.currentUser.wg_type,t.canEdit=t.isCustomerAdmin||!u.is("app.clientes.view")&&(t.isAgent||t.isAdmin),m.canEditRoot=t.canEdit,t.customers=[],t.contractorTypeList=[],O(),t.$watchCollection("customer.contractorTypeList",function(n,o,e){t.contractorTypeList=t.customer.contractorTypeList?g("filter")(t.customer.contractorTypeList,{isActive:!0},!0):[]});var y=function(){t.contractor={id:0,customerId:o.customerId,customer:null,contract:"",isActive:!0,type:null}};y(),t.onLoadRecord=function(){if(0!=t.contractor.id){var n={id:t.contractor.id};f({method:"GET",url:"api/customer/contractor",params:n})["catch"](function(t){if(403==t.status){var n=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";d.swal("No Autorizado","No estas autorizado para ver esta información.","error"),p(function(){u.go(n)},3e3)}else 404==t.status?(d.swal("Información no disponible","Aporte no encontrado","error"),p(function(){u.go("app.clientes.list")})):d.swal("Error","Se ha presentado un error al intentar acceder a la información del aporte","error")}).then(function(n){p(function(){t.contractor=n.data.result})})["finally"](function(){p(function(){v.scrollTop(0,2e3)})})}},t.master=t.contractor,t.form={submit:function(t){var n=null;if(t.$invalid){var o=null,n=null;for(o in t)"$"!=o[0]&&(null!==n||t[o].$valid||(n=t[o].$name),t[o].$pristine&&(t[o].$dirty=!0));return angular.element(".ng-invalid[name="+n+"]").focus(),void d.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}T()},reset:function(n){t.contractor=angular.copy(t.master),n.$setPristine(!0)}};var T=function(){var n="";if(null!=t.contractor.customer&&""!=t.contractor.customer||(n+="Debe seleccionar el cliente / razón social\n"),null!=t.contractor.type&&""!=t.contractor.type||(n+="Debe seleccionar el tipo de contratista \n"),null!=t.contractor.contract&&""!=t.contractor.contract||(n+="Debe ingresar el número del contrato \n"),""!=n)return void d.swal({html:!0,title:"Error de validación",text:n,type:"error"});var o={},e=JSON.stringify(t.contractor);return o.data=Base64.encode(e),f({method:"POST",url:"api/customer/contractor/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(n){p(function(){t.contractor=n.data.result,d.swal("Validación exitosa","Guardando información del contratista...","success"),t.reloadDataContractor(),t.clearContractor()})})["catch"](function(t){r.error(t),d.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};t.cancelEdition=function(n){t.isView?u.go("app.clientes.list"):d.swal({title:"Está seguro?",text:"Perderá todos los cambios realizados en este formulario.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, cancelar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(t){t?p(function(){u.go("app.clientes.list")}):swal("Cancelación","La operación ha sido cancelada","error")})};var D={customer_id:o.customerId};t.dtInstanceContractor={},t.dtOptionsContractor=a.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:D,url:"api/customer/contractor",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){E()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(n,o,e){l(angular.element(n).contents())(t)}),t.dtColumnsContractor=[i.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(n,o,e,r){var a="",i='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+n.id+'" >   <i class="fa fa-edit"></i></a> ',c='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+n.id+'" >   <i class="fa fa-trash-o"></i></a> ',l='<a class="btn btn-info btn-xs viewRow lnk" href="#" uib-tooltip="Ver" data-id="'+n.id+'" >   <i class="fa fa-eye"></i></a> ';return a+=i,a+=c,a+=l,m.can("cliente_contratista_manage")&&!t.isView?a:""}),i.newColumn("customer.documentType.item").withTitle("Tipo de Documento").withOption("width",200).withOption("defaultContent",""),i.newColumn("customer.documentNumber").withTitle("Documento").withOption("width",200).withOption("defaultContent",""),i.newColumn("customer.businessName").withTitle("Razón Social").withOption("width",200).withOption("defaultContent",""),i.newColumn("type.value").withTitle("Tipo de Contratista").withOption("width",200).withOption("defaultContent",""),i.newColumn("contract").withTitle("Contrato").withOption("width",200).withOption("defaultContent",""),i.newColumn(null).withTitle("Estado").withOption("width",200).renderWith(function(t,n,o,e){var r="label label-danger",a="Inactivo";null==t.isActive&&void 0==t.isActive||(t.isActive?(r="label label-success",a="Activo"):(r="label label-danger",a="Inactivo"));var i='<span class="'+r+'">'+a+"</span>";return i})];var E=function(){angular.element("#dtCustomerProfileContractor a.editRow").on("click",function(){var n=angular.element(this).data("id");t.onEdit(n)}),angular.element("#dtCustomerProfileContractor a.delRow").on("click",function(){var n=angular.element(this).data("id");d.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(o){if(o){var e={};e.id=n,f({method:"POST",url:"api/customer/contractor/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){r.error(t),d.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){t.reloadDataContractor()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};t.onEdit=function(n){t.contractor.id=n,t.isView=!1,t.onLoadRecord()},t.dtInstanceContractorCallback=function(n){t.dtInstanceContractor=n},t.reloadDataContractor=function(){t.dtInstanceContractor.reloadData()},t.clearContractor=function(){y(),t.isView=!1}}]);
"use strict";app.controller("customerDetailCtrl",["$scope","$aside","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","SweetAlert","$rootScope","$http","$timeout","$uibModal","flowFactory","cfpLoadingBar","$filter","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$document",function(e,t,o,r,n,i,a,c,s,l,u,d,m,f,p,g,w,v,C){var B=r;e.currentUser=d.currentUser(),e.isAgent="agent"==e.currentUser.wg_type,e.isAdmin="system"==e.currentUser.wg_type,e.isCustomerAdmin="customerAdmin"==e.currentUser.wg_type,e.isCustomerUser="customerUser"==e.currentUser.wg_type,e.canEdit=e.isCustomerAdmin||!l.is("app.clientes.view")&&(e.isAgent||e.isAdmin),e.isView=l.is("app.clientes.view"),e.isCreate=l.is("app.clientes.create"),d.canEditRoot=e.canEdit,e.master=e.customer,e.form={submit:function(t){var o=null;if(t.$invalid){var r=null,o=null;for(r in t)"$"!=r[0]&&(null!==o||t[r].$valid||(o=t[r].$name),t[r].$pristine&&(t[r].$dirty=!0));return B.info(e.customer),angular.element(".ng-invalid[name="+o+"]").focus(),void u.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}y()},reset:function(t){e.customer=angular.copy(e.master),t.$setPristine(!0)}};var y=function(){var t={},o=JSON.stringify(e.customer);return t.data=Base64.encode(o),m({method:"POST",url:"api/customer/saveInfoDetail",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){f(function(){e.customer=t.data.result,u.swal("Validación exitosa","Guardando información del cliente...","success")})})["catch"](function(e){u.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};e.cancelEdition=function(t){e.isView?l.go("app.clientes.list"):u.swal({title:"Está seguro?",text:"Perderá todos los cambios realizados en este formulario.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, cancelar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(e){e?f(function(){l.go("app.clientes.list")}):swal("Cancelación","La operación ha sido cancelada","error")})},e.addContact=function(){f(function(){null==e.customer.contacts&&(e.customer.contacts=[]),e.customer.contacts.push({id:0,value:"",type:null})})},e.removeContact=function(t){u.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(o){o?f(function(){var o=e.customer.contacts[t];if(0==o.id)e.customer.contacts.splice(t,1);else{var n={};n.id=o.id,m({method:"POST",url:"api/customer/info-detail/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(o){s.pop("success","Operación Exitosa","Registro eliminado"),e.customer.contacts.splice(t,1)})["catch"](function(e){r.error(e),"Action plan related."==e.message?s.pop("error","Error","No se puede eliminar el registro. El contacto tiene planes de acción relacionados"):s.pop("error","Error","Por favor verifique los datos requeridos del formulario y vuelva a intentarlo")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})}}]);
"use strict";app.controller("customerEconomicGroupCtrl",["$scope","$aside","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","SweetAlert","$rootScope","$http","$timeout","$uibModal","flowFactory","cfpLoadingBar","$filter","$document",function(o,n,t,i,a,r,c,l,s,u,d,m,p,f,w,h,g,v,C){o.currentUser=m.currentUser(),o.isAgent="agent"==o.currentUser.wg_type,o.isAdmin="system"==o.currentUser.wg_type,o.isCustomerAdmin="customerAdmin"==o.currentUser.wg_type,o.isCustomerUser="customerUser"==o.currentUser.wg_type,o.canEdit=o.isCustomerAdmin||!u.is("app.clientes.view")&&(o.isAgent||o.isAdmin),m.canEditRoot=o.canEdit,o.customerEconomicGroup=[];var b=function(){o.economicGroup={id:0,parentId:t.customerId,customer:null,isActive:!0}};b(),o.isView=u.is("app.clientes.view"),o.isCreate=u.is("app.clientes.create"),o.onLoadRecord=function(){if(0!=o.economicGroup.id){var n={id:o.economicGroup.id};p({method:"GET",url:"api/customer/economic-group",params:n})["catch"](function(o){if(403==o.status){var n=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";d.swal("No Autorizado","No estas autorizado para ver esta información.","error"),f(function(){u.go(n)},3e3)}else 404==o.status?(d.swal("Información no disponible","Aporte no encontrado","error"),f(function(){u.go("app.clientes.list")})):d.swal("Error","Se ha presentado un error al intentar acceder a la información del aporte","error")}).then(function(e){f(function(){o.economicGroup=e.data.result})})["finally"](function(){f(function(){C.scrollTop(0,2e3)})})}},o.master=o.economicGroup,o.form={submit:function(o){var e=null;if(o.$invalid){var n=null,e=null;for(n in o)"$"!=n[0]&&(null!==e||o[n].$valid||(e=o[n].$name),o[n].$pristine&&(o[n].$dirty=!0));return angular.element(".ng-invalid[name="+e+"]").focus(),void d.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}O()},reset:function(e){o.economicGroup=angular.copy(o.master),e.$setPristine(!0)}};var O=function(){if(null==o.economicGroup.customer)return void d.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error");var e={},n=JSON.stringify(o.economicGroup);return e.data=Base64.encode(n),p({method:"POST",url:"api/customer/economic-group/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){f(function(){o.economicGroup=e.data.result,d.swal("Validación exitosa","Guardando información del grupo economico...","success"),o.reloadDataEconomicGroup(),o.onClearCustomer()})})["catch"](function(o){i.error(o),d.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};o.cancelEdition=function(e){o.isView?u.go("app.clientes.list"):d.swal({title:"Está seguro?",text:"Perderá todos los cambios realizados en este formulario.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, cancelar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(o){o?f(function(){u.go("app.clientes.list")}):swal("Cancelación","La operación ha sido cancelada","error")})};var T={customer_id:t.customerId};o.dtInstanceEconomicGroup={},o.dtOptionsEconomicGroup=a.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:T,url:"api/customer/economic-group",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){E()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,n,t){l(angular.element(e).contents())(o)}),o.dtColumnsEconomicGroup=[r.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,n,t,i){var a="",r='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+e.id+'" >   <i class="fa fa-edit"></i></a> ',c='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+e.id+'" >   <i class="fa fa-trash-o"></i></a> ';return a+=r,a+=c,m.can("cliente_grupo_economico_manage")&&!o.isView?a:""}),r.newColumn("customer.documentType.item").withTitle("Tipo de Documento").withOption("width",200),r.newColumn("customer.documentNumber").withTitle("Documento").withOption("width",200),r.newColumn("customer.businessName").withTitle("Razón social").withOption("width",200),r.newColumn(null).withTitle("Estado").withOption("width",200).renderWith(function(o,e,n,t){var i="label label-danger",a="Inactivo";null==o.isActive&&void 0==o.isActive||(o.isActive?(i="label label-success",a="Activo"):(i="label label-danger",a="Inactivo"));var r='<span class="'+i+'">'+a+"</span>";return r})];var E=function(){angular.element("#dtEconomicGroup a.editRow").on("click",function(){var e=angular.element(this).data("id");o.onEdit(e)}),angular.element("#dtEconomicGroup a.delRow").on("click",function(){var e=angular.element(this).data("id");d.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(n){if(n){var t={};t.id=e,p({method:"POST",url:"api/customer/economic-group/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(o){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(o){i.error(o),d.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){o.reloadDataEconomicGroup()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};o.onEdit=function(e){o.economicGroup.id=e,o.isView=!1,o.onLoadRecord()},o.dtInstanceEconomicGroupCallback=function(e){o.dtInstanceEconomicGroup=e},o.reloadDataEconomicGroup=function(){o.dtInstanceEconomicGroup.reloadData()},o.onClearCustomer=function(){b(),o.isView=!1},o.onSearchCustomer=function(){var e=n.open({templateUrl:m.app.views.urlRoot+"modules/common/modals/data_table_list_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideEconomicGroupSearchCustomerCtrl",scope:o,windowTopClass:"top-modal",resolve:{}});e.result.then(function(e){var n=v("filter")(o.customerEconomicGroup,{id:e.id});0==n.length&&o.customerEconomicGroup.push(e),o.economicGroup.customer=e},function(){})}}]),app.controller("ModalInstanceSideEconomicGroupSearchCustomerCtrl",["$rootScope","$stateParams","$scope","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile",function(o,e,n,t,i,a,r,c,l,s,u,d,m,p){n.title="CLIENTES DISPONIBLES",n.entity={id:0},n.onCloseModal=function(){t.close(n.entity)},n.onCancel=function(){t.dismiss("cancel")};var f=function(o){if(0!=o){var e={id:o};c({method:"GET",url:"api/customer",params:e})["catch"](function(o,e){if(403==e){var n=null!==o.message&&void 0!==o.message?o.message:"app.clientes.list";r.swal("No Autorizado","No estas autorizado para ver esta información.","error"),a(function(){$state.go(n)},3e3)}else 404==e?r.swal("Información no disponible","Diagnóstico no encontrado","error"):r.swal("Error","Se ha presentado un error al intentar acceder a la información del proceso","error")}).then(function(o){a(function(){n.entity=o.data.result})})["finally"](function(){a(function(){n.onCloseModal()},400)})}else n.loading=!1};n.dtOptionsCommonDataTableList=m.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(o){return o.customerId=e.customerId,JSON.stringify(o)},url:"api/customer-economic-group-available",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){w()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(o,e,t){p(angular.element(o).contents())(n)}),n.dtColumnsCommonDataTableList=[d.newColumn(null).withTitle("Acciones").withOption("width",80).notSortable().renderWith(function(o,e,n,t){var i="",a="",r='<a class="btn btn-success btn-xs editRow lnk" href="#" uib-tooltip="Adicionar causa"  data-id="'+o.id+'"'+a+' >   <i class="fa fa-plus-square"></i></a> ';return i+=r}),d.newColumn("documentType").withTitle("Tipo de Documento").withOption("width",200),d.newColumn("documentNumber").withTitle("Documento").withOption("width",200),d.newColumn("businessName").withTitle("Razón Social").withOption("width",200),d.newColumn("type").withTitle("Tipo de Cliente").withOption("width",200),d.newColumn("classification").withTitle("Clasificación").withOption("width",200).renderWith(function(o,e,n,t){return null==o||void 0==o?"":o}),d.newColumn("status").withTitle("Estado").withOption("width",200).renderWith(function(o,e,n,t){var i="";switch(o){case"Activo":i="label label-success";break;case"Inactivo":i="label label-danger";break;case"Retirado":i="label label-warning"}var a='<span class="'+i+'">'+o+"</span>";return a})];var w=function(){angular.element("#dtCommonDataTableList a.editRow").on("click",function(){var o=angular.element(this).data("id");f(o)})};n.dtInstanceCommonDataTableListCallback=function(o){n.dtInstanceCommonDataTableList=o},n.reloadData=function(){n.dtInstanceCommonDataTableList.reloadData()}}]);
"use strict";app.controller("customerParameterCtrl",["$scope","$aside","$stateParams","$log","$compile","toaster","$state","SweetAlert","$rootScope","$http","$timeout","$uibModal","$filter","$document","ListService","SupportService",function(e,t,o,n,r,i,a,c,s,l,u,m,d,p,f,w){function g(){var t=[{name:"customer_related_agent_user",value:o.customerId},{name:"experience_vr",value:null}];f.getDataList(t).then(function(t){e.users=t.data.data.customerRelatedAgentAndUserList,e.experienceVRList=t.data.data.experience_vr},function(t){e.status="Unable to load customer data: "+t.message})}var v=n;e.$on("vAccordion:onReady",function(){console.log("vAccordion")});var y=function(){switch(w.getCurrentStep()){case 3:break;case 4:}},T=s.$on("navigateToSupport",function(e,t){y()});e.$on("$destroy",function(){T()}),w.getShouldRedirect()&&y(),e.currentUser=s.currentUser(),e.isAgent="agent"==e.currentUser.wg_type,e.isAdmin="system"==e.currentUser.wg_type,e.isCustomerAdmin="customerAdmin"==e.currentUser.wg_type,e.isCustomerUser="customerUser"==e.currentUser.wg_type,e.canEdit=e.isCustomerAdmin||!a.is("app.clientes.view")&&(e.isAgent||e.isAdmin),s.canEditRoot=e.canEdit,e.isView=a.is("app.clientes.view"),e.isCreate=a.is("app.clientes.create"),e.users=[],e.experienceVRList=[],e.hasMatrixSpecial="S"==e.customer.matrixType;var h=function(){var t=e.customer.matrixType,n=null;null!=e.customer&&e.customer.covidBolivarRegister&&e.customer.covidBolivarRegister.length&&(n=e.customer.covidBolivarRegister[0].item),e.canEditMatrix=null==e.customer.matrixType||""==e.customer.matrixType,null!=e.customer.matrixType&&""!=e.customer.matrixType||"G"!=e.customer.productivityMatrix||(t=e.customer.productivityMatrix,e.canEditMatrix=!1),e.entity={id:o.customerId,matrixType:t,covidBolivarRegister:n}};h(),g(),null!=e.customer.assignedHours&&0!=e.customer.assignedHours.length||(e.customer.assignedHours=[],e.customer.assignedHours.push({id:0,customerId:o.customerId,namespace:"wgroup",group:"economicGroupAssignedHours",isActive:!1,value:0})),e.master=e.customer,e.form={submit:function(t){var o=null;if(t.$invalid){var n=null,o=null;for(n in t)"$"!=n[0]&&(null!==o||t[n].$valid||(o=t[n].$name),t[n].$pristine&&(t[n].$dirty=!0));return v.info(e.customer),angular.element(".ng-invalid[name="+o+"]").focus(),void c.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}e.onUpdateCovidBolivarRegister(),x()},reset:function(t){e.customer=angular.copy(e.master),t.$setPristine(!0)}};var x=function(){var t={},o=JSON.stringify(e.customer);return t.data=Base64.encode(o),l({method:"POST",url:"api/customer/saveParameters",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){u(function(){e.customer=t.data.result,s.$emit("dataCustomer",{newValue:e.customer,id:e.customer.id,message:"Data Customer has been changed!"}),s.app.supportHelp&&(s.app.supportHelp.hasNotificationUser=e.customer.userNotificationList.length>0),c.swal("Validación exitosa","Guardando información del cliente...","success")})})["catch"](function(e){n.error(e),c.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};e.onUpdateMatrix=function(){c.swal({title:"Está seguro?",text:"Una vez seleccionado el tipo de matríz no será posible hacer cambio de matríz.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, continuar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(t){if(t){var o={},r=JSON.stringify(e.entity);return o.data=Base64.encode(r),l({method:"POST",url:"api/customer/update-matrix",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(t){u(function(){e.customer.matrixType=t.data.result.matrixType,e.canEditMatrix=null==e.customer.matrixType||""==e.customer.matrixType,s.app.supportHelp&&(s.app.supportHelp.hasMatrix=null!=e.customer.matrixType),s.$emit("customerMatrixUpdated",{newValue:e.customer.matrixType,id:e.customer.id,message:"Customer Matrix has been changed!"}),c.swal("Validación exitosa","Guardando información del cliente...","success")})})["catch"](function(e){n.error(e),c.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})}swal("Cancelación","La operación ha sido cancelada","error")})},e.onUpdateCovidBolivarRegister=function(){var t={id:e.customer.covidBolivarRegister.length?e.customer.covidBolivarRegister[0].id:0,namespace:"wgroup",group:"covidBolivarRegister",isActive:e.entity.covidBolivarRegister,value:null},r={},i=JSON.stringify(t);return r.data=Base64.encode(i),r.customerId=o.customerId,l({method:"POST",url:"api/customer-parameter/update/covid-register",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(r)}).then(function(e){})["catch"](function(e){n.error(e),c.swal("Error de guardado","Error guardando el registro.","error")})["finally"](function(){})},e.cancelEdition=function(t){e.isView?a.go("app.clientes.list"):c.swal({title:"Está seguro?",text:"Perderá todos los cambios realizados en este formulario.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, cancelar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(e){e?u(function(){a.go("app.clientes.list")}):swal("Cancelación","La operación ha sido cancelada","error")})},e.onAddOfficeTypeMatrixSpecial=function(){u(function(){null==e.customer.officeTypeMatrixSpecialList&&(e.customer.officeTypeMatrixSpecialList=[]),e.customer.officeTypeMatrixSpecialList.push({id:0,customerId:o.customerId,namespace:"wgroup",group:"officeTypeMatrixSpecial",isActive:!0,value:""})})},e.onRemoveOfficeTypeMatrixSpecial=function(t){c.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(o){o?u(function(){var o=e.customer.officeTypeMatrixSpecialList[t];if(0!=o.id){var n={};n.id=o.id,l({method:"POST",url:"api/customer-parameter/destroy",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(o){e.customer.officeTypeMatrixSpecialList.splice(t,1),swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){c.swal("Error en la eliminación",e.data.message,"error")})["finally"](function(){})}else e.customer.officeTypeMatrixSpecialList.splice(t,1)}):swal("Cancelación","La operación ha sido cancelada","error")})},e.onAddUnitBusinessMatrixSpecial=function(){u(function(){null==e.customer.businessUnitMatrixSpecialList&&(e.customer.businessUnitMatrixSpecialList=[]),e.customer.businessUnitMatrixSpecialList.push({id:0,customerId:o.customerId,namespace:"wgroup",group:"businessUnitMatrixSpecial",isActive:!0,value:""})})},e.onRemoveUnitBusinessMatrixSpecial=function(t){c.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(o){o?u(function(){var o=e.customer.businessUnitMatrixSpecialList[t];if(0!=o.id){var n={};n.id=o.id,l({method:"POST",url:"api/customer-parameter/destroy",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(o){e.customer.businessUnitMatrixSpecialList.splice(t,1),swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){c.swal("Error en la eliminación",e.data.message,"error")})["finally"](function(){})}else e.customer.businessUnitMatrixSpecialList.splice(t,1)}):swal("Cancelación","La operación ha sido cancelada","error")})},e.onAddEmployeeDocumentType=function(){u(function(){null==e.customer.employeeDocumentsTypeList&&(e.customer.employeeDocumentsTypeList=[]),e.customer.employeeDocumentsTypeList.push({id:0,customerId:0,namespace:"wgroup",group:"employeeDocumentType",isActive:!1,isVisible:!1,value:""})})},e.onRemoveEmployeeDocumentType=function(t){c.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(o){o?u(function(){var o=e.customer.employeeDocumentsTypeList[t];if(e.customer.employeeDocumentsTypeList.splice(t,1),0!=o.id){var r={};r.id=o.id,l({method:"POST",url:"api/customer-parameter/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(r)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){n.error(e),c.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})},e.onAddCustomerDocumentType=function(){u(function(){null==e.customer.documentsTypeList&&(e.customer.documentsTypeList=[]),e.customer.documentsTypeList.push({id:0,customerId:0,namespace:"wgroup",group:"customerDocumentType",isActive:!1,value:""})})},e.onRemoveCustomerDocumentType=function(t){c.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(o){o?u(function(){var o=e.customer.documentsTypeList[t];if(e.customer.documentsTypeList.splice(t,1),0!=o.id){var r={};r.id=o.id,l({method:"POST",url:"api/customer-parameter/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(r)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){n.error(e),c.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})},e.onAddExtraContactInformation=function(){u(function(){null==e.customer.extraContactInformation&&(e.customer.extraContactInformation=[]),e.customer.extraContactInformation.push({id:0,customerId:0,namespace:"wgroup",group:"extraContactInformation",isActive:!1,value:""})})},e.onRemoveExtraContactInformation=function(t){c.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(o){o?u(function(){var o=e.customer.extraContactInformation[t];if(e.customer.extraContactInformation.splice(t,1),0!=o.id){var r={};r.id=o.id,l({method:"POST",url:"api/customer-parameter/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(r)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){n.error(e),c.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})},e.onAddContactType=function(){u(function(){null==e.customer.contactTypeList&&(e.customer.contactTypeList=[]),e.customer.contactTypeList.push({id:0,customerId:0,namespace:"wgroup",group:"contactTypes",isActive:!1,value:""})})},e.onRemoveContactType=function(t){c.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(o){o?u(function(){var o=e.customer.contactTypeList[t];if(e.customer.contactTypeList.splice(t,1),0!=o.id){var r={};r.id=o.id,l({method:"POST",url:"api/customer-parameter/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(r)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){n.error(e),c.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})},e.onAddContractorType=function(){u(function(){null==e.customer.contractorTypeList&&(e.customer.contractorTypeList=[]),e.customer.contractorTypeList.push({id:0,customerId:0,namespace:"wgroup",group:"contractorTypes",isActive:!1,value:""})})},e.onRemoveContractorType=function(t){c.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(o){o?u(function(){var o=e.customer.contractorTypeList[t];if(e.customer.contractorTypeList.splice(t,1),0!=o.id){var r={};r.id=o.id,l({method:"POST",url:"api/customer-parameter/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(r)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){n.error(e),c.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})},e.onAddProjectType=function(){u(function(){null==e.customer.projectTypes&&(e.customer.projectTypes=[]),e.customer.projectTypes.push({id:0,customerId:0,namespace:"wgroup",group:"projectType",isActive:!0,value:""})})},e.onRemoveProjectType=function(t){c.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(o){o?u(function(){var o=e.customer.projectTypes[t];if(e.customer.projectTypes.splice(t,1),0!=o.id){var r={};r.id=o.id,l({method:"POST",url:"api/customer-parameter/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(r)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){n.error(e),c.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})},e.onAddProjectTaskType=function(){u(function(){null==e.customer.projectTaskTypes&&(e.customer.projectTaskTypes=[]),e.customer.projectTaskTypes.push({id:0,customerId:0,namespace:"wgroup",group:"projectTaskType",isActive:!0,value:"",data:0})})},e.onRemoveProjectTaskType=function(t){c.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(o){o?u(function(){var o=e.customer.projectTaskTypes[t];if(0!=o.id){var r={};r.id=o.id,l({method:"POST",url:"api/customer-parameter/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(r)}).then(function(o){swal("Eliminado","Registro eliminado satisfactoriamente","info"),e.customer.projectTaskTypes.splice(t,1)})["catch"](function(e){n.error(e),c.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}else e.customer.projectTaskTypes.splice(t,1)}):swal("Cancelación","La operación ha sido cancelada","error")})},e.onAddUserSkill=function(){u(function(){null==e.customer.userSkills&&(e.customer.userSkills=[]),e.customer.userSkills.push({id:0,customerId:0,namespace:"wgroup",group:"userSkill",isActive:!0,value:""})})},e.onRemoveUserSkill=function(t){c.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(o){o?u(function(){var o=e.customer.userSkills[t];if(e.customer.userSkills.splice(t,1),0!=o.id){var r={};r.id=o.id,l({method:"POST",url:"api/customer-parameter/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(r)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){n.error(e),c.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})},e.onAddUserNotification=function(){u(function(){null==e.customer.userNotificationList&&(e.customer.userNotificationList=[]),e.customer.userNotificationList.push({id:0,customerId:0,namespace:"wgroup",group:"userNotification",isActive:!1,value:null})})},e.onRemoveUserNotification=function(t){c.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(o){o?u(function(){var o=e.customer.userNotificationList[t];if(e.customer.userNotificationList.splice(t,1),0!=o.id){var r={};r.id=o.id,l({method:"POST",url:"api/customer-parameter/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(r)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){n.error(e),c.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})},e.onAddExperience=function(){u(function(){null==e.customer.experienceVRList&&(e.customer.experienceVRList=[]),e.customer.experienceVRList.push({id:0,customerId:0,namespace:"wgroup",group:"experienceVR",isActive:!1,value:null})})},e.onRemoveExperienceVR=function(t){c.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(o){o?u(function(){var o=e.customer.experienceVRList[t];if(e.customer.experienceVRList.splice(t,1),0!=o.id){var r={};r.id=o.id,l({method:"POST",url:"api/customer-parameter/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(r)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){n.error(e),c.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})},e.covidBolivarRegisterCandEdit=function(){return!!e.customer.covidBolivarRegisterCandEdit},e.valideSingle=function(t){var o=d("filter")(e.customer.experienceVRList,{value:t});return!!o.length}}]);
"use strict";app.controller("customerResourceCtrl",["$scope","$aside","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","SweetAlert","$rootScope","$http","$timeout","$uibModal","flowFactory","cfpLoadingBar","$filter","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$document",function(e,t,r,o,n,i,a,s,u,c,l,d,m,p,f,w,h,y,C){e.currentUser=d.currentUser(),e.isAgent="agent"==e.currentUser.wg_type,e.isAdmin="system"==e.currentUser.wg_type,e.isCustomerAdmin="customerAdmin"==e.currentUser.wg_type,e.isCustomerUser="customerUser"==e.currentUser.wg_type,e.canEdit=e.isCustomerAdmin||!c.is("app.clientes.view")&&(e.isAgent||e.isAdmin),d.canEditRoot=e.canEdit,e.isView=c.is("app.clientes.view"),e.isCreate=c.is("app.clientes.create"),e.onLoadRecord=function(){if(e.customer.id){var t={id:e.customer.id};m({method:"GET",url:"api/customer",params:t})["catch"](function(e){if(403==e.status){var t="app.clientes.list";l.swal("No Autorizado","No estas autorizado para ver esta información.","error"),p(function(){c.go(t)},3e3)}else 404==e.status?(l.swal("Información no disponible","Cliente no encontrado","error"),p(function(){c.go("app.clientes.list")})):l.swal("Error","Se ha presentado un error al intentar acceder a la información del cliente","error")}).then(function(t){p(function(){e.customer=t.data.result,e.isCustomerAdmin&&(e.currentUser.company!=e.customer.id?e.canEdit=!0:e.canEdit=!0),d.canEditRoot=e.canEdit})})["finally"](function(){})}};var g=function(e){for(var t="",r=0;r<e;r++){var o=Math.floor(62*Math.random()),n=o+=o>9?o<36?55:61:48;t+=String.fromCharCode(n)}return t};e.onInstall=function(t){var r={instanceId:g(20),planId:t.id,customerId:e.customer.id,users:t.featureList[0].min,contractors:t.featureList[1].min,disk:t.featureList[2].min,employees:t.featureList[3].min},n={},i=JSON.stringify(r);return n.data=Base64.encode(i),m({method:"POST",url:"api/nephos-integration/install-customer",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(t){p(function(){e.customer.resource=t.data.result})})["catch"](function(e){o.error(e),l.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){l.swal("Instalación exitosa","Se instaló correctamente el plan "+t.name,"success")})},e.onViewHistorical=function(){var r={},n=t.open({templateUrl:d.app.views.urlRoot+"modules/customer/profile/resource/customer_resource_historical_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideCustomerResourceHistoricalCtrl",scope:e,resolve:{filter:function(){return r}}});n.result.then(function(){e.reloadData()},function(){o.info("Modal dismissed at: "+new Date)})},e.onAddResource=function(r){var n={type:r,resource:e.customer.resource},i=t.open({templateUrl:d.app.views.urlRoot+"modules/customer/profile/resource/customer_resource_edit_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideCustomerResourceEditCtrl",scope:e,resolve:{filter:function(){return n}}});i.result.then(function(){e.reloadData()},function(){o.info("Modal dismissed at: "+new Date)})}}]),app.controller("ModalInstanceSideCustomerResourceHistoricalCtrl",["$rootScope","$stateParams","$scope","filter","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile",function(e,t,r,o,n,i,a,s,u,c,l,d,m,p,f){var w={};r.employee={id:0},r.onCloseModal=function(){n.close(r.employee)},r.onCancel=function(){n.dismiss("cancel")},w.operation="diagnostic",w.customer_id=t.customerId,w.data="",r.dtInstanceCustomerHealthDamageDisabilityDiagnosticHistorical={},r.dtOptionsCustomerHealthDamageDisabilityDiagnosticHistorical=p.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:w,url:"api/nephos-integration",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){h()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,t,o){f(angular.element(e).contents())(r)}),r.dtColumnsCustomerHealthDamageDisabilityDiagnosticHistorical=[m.newColumn("command").withTitle("Acción").withOption("width",200).withOption("defaultContent",""),m.newColumn("plan").withTitle("Plan").withOption("width",200).withOption("defaultContent",""),m.newColumn("users").withTitle("Usuarios").withOption("width",200).withOption("defaultContent",""),m.newColumn("contractors").withTitle("Contratistas").withOption("width",200).withOption("defaultContent",""),m.newColumn("disk").withTitle("Almacenamiento").withOption("width",200).withOption("defaultContent",""),m.newColumn("employees").withTitle("Empleados").withOption("width",200).withOption("defaultContent","")];var h=function(){};r.reloadData=function(){r.dtInstanceCustomerHealthDamageDisabilityDiagnosticHistorical.reloadData()}}]),app.controller("ModalInstanceSideCustomerResourceEditCtrl",["$rootScope","$stateParams","$scope","filter","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile",function(e,t,r,o,n,i,a,s,u,c,l,d,m,p,f){r.datePickerConfig={culture:"es-CO",format:"dd/MM/yyyy hh:mm tt"},r.current=o,r.type=o.type,"U"==o.type&&(r.current.type="Usuario",r.current.allowed=o.resource.features.user.allowed,r.current.max=o.resource.features.user.max,r.current.quantity=o.resource.features.user.quantity),"C"==o.type&&(r.current.type="Contratista",r.current.allowed=o.resource.features.contractor.allowed,r.current.max=o.resource.features.contractor.max,r.current.quantity=o.resource.features.contractor.quantity),"E"==o.type&&(r.current.type="Empleado",r.current.allowed=o.resource.features.employee.allowed,r.current.max=o.resource.features.employee.max,r.current.quantity=o.resource.features.employee.quantity),"H"==o.type&&(r.current.type="Espacio de almacenamiento",r.current.allowed=o.resource.features.disk.allowed,r.current.max=o.resource.features.disk.max,r.current.quantity=o.resource.features.disk.quantity),r.maxValue=parseFloat(r.current.allowed)-parseFloat(r.current.max),r.pending=parseFloat(r.current.max)-parseFloat(r.current.quantity),r.resource={instanceId:o.resource.instanceId,planId:o.resource.plan.id,customerId:r.customer.id,users:0,contractors:0,disk:0,employees:0,type:o.type},r.onClose=function(){n.close(1)},r.onCancel=function(){n.dismiss("cancel")},r.form={submit:function(e){var t=null;if(e.$invalid){var r=null,t=null;for(r in e)"$"!=r[0]&&(null!==t||e[r].$valid||(t=e[r].$name),e[r].$pristine&&(e[r].$dirty=!0));return angular.element(".ng-invalid[name="+t+"]").focus(),void s.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}w()},reset:function(e){r.resource=angular.copy(r.resource),e.$setPristine(!0)}};var w=function(){var e={},t=JSON.stringify(r.resource);return e.data=Base64.encode(t),u({method:"POST",url:"api/nephos-integration/configure-customer",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){a(function(){r.onClose()})})["catch"](function(e){i.error(e),s.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){s.swal("Configuración exitosa","Se configuró correctamente el plan "+o.resource.plan.name,"success")})}}]);
"use strict";app.controller("customerUnitCtrl",["$scope","$aside","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","SweetAlert","$rootScope","$http","$timeout","$uibModal","flowFactory","cfpLoadingBar","$filter","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$document",function(e,n,t,o,i,r,a,s,c,l,u,d,m,f,p,g,w,C,h){var v=o;e.currentUser=d.currentUser(),e.isAgent="agent"==e.currentUser.wg_type,e.isAdmin="system"==e.currentUser.wg_type,e.isCustomerAdmin="customerAdmin"==e.currentUser.wg_type,e.isCustomerUser="customerUser"==e.currentUser.wg_type,e.canEdit=e.isCustomerAdmin||!l.is("app.clientes.view")&&(e.isAgent||e.isAdmin),d.canEditRoot=e.canEdit,e.isView=l.is("app.clientes.view"),e.isCreate=l.is("app.clientes.create"),e.unities=d.parameters("bunit"),e.agents=d.agents();var B=function(){e.customer={id:e.isCreate?0:t.customerId}};B(),angular.forEach(e.customer.unities,function(e,n){e.agents=[{selected:null}]}),console.log(e.customer.unities),e.master=e.customer,e.form={submit:function(n){var t=null;if(n.$invalid){var o=null,t=null;for(o in n)"$"!=o[0]&&(null!==t||n[o].$valid||(t=n[o].$name),n[o].$pristine&&(n[o].$dirty=!0));return v.info(e.customer),angular.element(".ng-invalid[name="+t+"]").focus(),void u.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}E()},reset:function(n){e.customer=angular.copy(e.master),n.$setPristine(!0)}};var E=function(){var n={},t=JSON.stringify(e.customer);return n.data=Base64.encode(t),m({method:"POST",url:"api/customer/saveUnit",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(n){f(function(){u.swal("Validación exitosa","Guardando información del cliente...","success"),e.customer=n.data.result,y()})})["catch"](function(e){u.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};e.cancelEdition=function(n){e.isView?l.go("app.clientes.list"):u.swal({title:"Está seguro?",text:"Perderá todos los cambios realizados en este formulario.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, cancelar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(e){e?f(function(){l.go("app.clientes.list")}):swal("Cancelación","La operación ha sido cancelada","error")})},e.addAgent=function(e){var n=e;null==n.agents&&(n.agents=[]),n.agents.push({id:0,name:""})},e.removeAgent=function(e,n){u.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(t){t?f(function(){e.agents.splice(n,1)}):swal("Cancelación","La operación ha sido cancelada","error")})},e.cancelEdition=function(n){e.isView?l.go("app.clientes.list"):u.swal({title:"Está seguro?",text:"Perderá todos los cambios realizados en este formulario.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, cancelar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(e){e?f(function(){l.go("app.clientes.list")}):swal("Cancelación","La operación ha sido cancelada","error")})},e.onLoadRecord=function(){if(e.customer.id){var n={id:e.customer.id};m({method:"GET",url:"api/customer/unit",params:n})["catch"](function(e){if(403==e.status){var n="app.clientes.list";u.swal("No Autorizado","No estas autorizado para ver esta información.","error"),f(function(){l.go(n)},3e3)}else 404==e.status?(u.swal("Información no disponible","Cliente no encontrado","error"),f(function(){l.go("app.clientes.list")})):u.swal("Error","Se ha presentado un error al intentar acceder a la información del cliente","error")}).then(function(n){f(function(){e.customer=n.data.result,e.isCustomerAdmin&&(e.currentUser.company!=e.customer.id?e.canEdit=!0:e.canEdit=!0),d.canEditRoot=e.canEdit,y()})})["finally"](function(){f(function(){e.loading=!1},400)})}else e.loading=!1},e.onLoadRecord();var y=function(){null==e.customer.unities||0==e.customer.unities.length?(e.customer.unities=e.unities,angular.forEach(e.customer.unities,function(e,n){e.agents=[{selected:null}]})):e.customer.unities.length<e.unities.length&&angular.forEach(e.unities,function(n,t){var o=C("filter")(e.customer.unities,{id:n.id});0==o.length&&(e.customer.unities.push(n),n.agents=[{selected:null}])})}}]);
"use strict";app.controller("customerUserCtrl",["$scope","$aside","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","$compile","toaster","$state","SweetAlert","$rootScope","$http","$timeout","flowFactory","cfpLoadingBar","$filter","$document","ListService","$uibModal",function(t,n,o,a,i,r,l,s,u,c,d,m,p,f,w,h,C,g,b){function v(){var e=[{name:"wg_customer_user_profile",value:null},{name:"customer_admin_profile_remove",value:null},{name:"customer_user_role",value:null}];g.getDataList(e).then(function(e){t.userProfileList=e.data.data.wg_customer_user_profile,t.userRoleList=e.data.data.customer_user_role,console.log("roles"),console.log(t.userRoleList);var n=e.data.data.customerAdminProfileRemove;t.isCustomerAdmin&&n&&"1"==n.value&&(t.userProfileList=t.userProfileList.filter(function(e){return"customerAdmin"!=e.value}))},function(e){t.status="Unable to load customer data: "+e.message})}function O(){var e={customerId:o.customerId},n=[{name:"customer_user_customer_list",value:null,criteria:e}];g.getDataList(n).then(function(e){t.customerList=e.data.data.customerList},function(e){t.status="Unable to load customer data: "+e.message})}var y=a,T=null;t.currentUser=d.currentUser(),t.isAgent="agent"==t.currentUser.wg_type,t.isAdmin="system"==t.currentUser.wg_type,t.isCustomerAdmin="customerAdmin"==t.currentUser.wg_type,t.isCustomerUser="customerUser"==t.currentUser.wg_type,t.extrainfo=t.customer.extraContactInformationList,t.canEdit=t.isCustomerAdmin||!u.is("app.clientes.view")&&(t.isAgent||t.isAdmin),d.canEditRoot=t.canEdit,t.showRelatedUsersFilter=(t.isAdmin||t.isCustomerAdmin)&&(t.customer.classification&&"Contratante"==t.customer.classification.value||t.customer.hasEconomicGroup),t.filter={showRelatedUsers:!1},t.textProfile=null,t.textRole=null,v(),O();var I=function(){t.user={id:0,customerId:o.customerId,documentNumber:null,documentType:null,firstName:null,lastName:null,email:null,type:null,gender:null,availability:0,isActive:!0,skills:[],isEditMode:!1,profile:null,role:null,userId:null,isUserApp:!1,informationList:null,employeeId:null},null!==T&&T.$setPristine(!0)};I(),t.isView=u.is("app.clientes.view"),t.isCreate=u.is("app.clientes.create"),t.genders=d.parameters("gender"),t.types=d.parameters("agent_type"),t.userSkills=[];var U=function(){var e={};e.customer_id=t.customer.id,e.namespace="userSkill",m({method:"POST",url:"api/customer-parameter",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)})["catch"](function(e,t){}).then(function(e){p(function(){t.userSkills=e.data.data})})["finally"](function(){})};U(),t.onLoadRecord=function(n){0!=n.id&&m({method:"GET",url:"api/customer-user/get",params:n})["catch"](function(t){if(403==t.status){var n=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";c.swal("No Autorizado","No estas autorizado para ver esta información.","error"),p(function(){u.go(n)},3e3)}else 404==t.status?(c.swal("Información no disponible","Aporte no encontrado","error"),p(function(){u.go("app.clientes.list")})):c.swal("Error","Se ha presentado un error al intentar acceder a la información del aporte","error")}).then(function(e){p(function(){t.user=e.data.result})})["finally"](function(){p(function(){C.scrollTop(0,2e3)})})},t.onSearchEmployee=function(){var e=n.open({templateUrl:d.app.views.urlRoot+"modules/customer/common/modals/employee_list_modal.htm",placement:"right",windowTopClass:"top-modal",size:"lg",backdrop:!0,controller:"ModalInstanceSideUserModalEmployeeListCtrl",scope:t});e.result.then(function(e){e&&(t.user.documentNumber=e.entity.documentNumber,t.user.firstName=e.entity.firstName,t.user.lastName=e.entity.lastName,t.user.gender=e.entity.gender,t.user.email=e.email?e.email.value:null,t.user.employeeId=e.id)},function(){})},t.master=t.user,t.form={submit:function(e){var t=null;if(T=e,e.$invalid){var n=null,t=null;for(n in e)"$"!=n[0]&&(null!==t||e[n].$valid||(t=e[n].$name),e[n].$pristine&&(e[n].$dirty=!0));return angular.element(".ng-invalid[name="+t+"]").focus(),void c.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}R()},reset:function(e){t.user=angular.copy(t.master),e.$setPristine(!0),t.textProfile=null,t.textRole=null}};var R=function(){if(null==t.user.email||""==t.user.email.replace(/^\s+|\s+$/gm,""))return void c.swal("El formulario contiene errores!","Debe ingresar un E-mail válido.","error");t.user.informationList=h("filter")(t.extrainfo,{item:"Email"});var e={},n=JSON.stringify(t.user);return e.data=Base64.encode(n),m({method:"POST",url:"api/customer-user/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){p(function(){t.user=e.data.result,c.swal("Operación exitosa","Información guardada satisfactoriamente","success"),t.reloadDataUser(),t.onClearUser()})})["catch"](function(e){a.error(e),c.swal("Error de guardado",e.data.message,"error")})["finally"](function(){})};t.cancelEdition=function(e){t.isView?u.go("app.clientes.list"):c.swal({title:"Está seguro?",text:"Perderá todos los cambios realizados en este formulario.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, cancelar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(e){e?p(function(){u.go("app.clientes.list")}):swal("Cancelación","La operación ha sido cancelada","error")})},t.dtInstanceUser={},t.dtOptionsUser=i.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerId=o.customerId,JSON.stringify(e)},url:"api/customer-user",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){D()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,n,o){l(angular.element(e).contents())(t)}),t.dtColumnsUser=[r.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,n,o,a){var i="",r='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+e.id+'" data-relation="'+e.relationCode+'" data-module="'+e.module+'" >   <i class="fa fa-edit"></i></a> ',l='<a class="btn btn-info btn-xs relRow lnk" href="#" uib-tooltip="Relacionar empresas" data-id="'+e.id+'" data-user-id="'+e.userId+'" data-relation="'+e.relationCode+'" >   <i class="fa fa-sitemap"></i></a> ';return d.can("clientes_edit")&&(i+=r),t.showRelatedUsersFilter&&(i+=l),i}),r.newColumn("firstName").withTitle("Nombre").withOption("width",200),r.newColumn("lastName").withTitle("Apellidos").withOption("width",200),r.newColumn("email").withTitle("E-mail").withOption("width",200),r.newColumn("availability").withTitle("Disponibilidad").withOption("width",200),r.newColumn("profile").withTitle("Perfil").withOption("width",200),r.newColumn("businessName").withTitle("Empresa Ppal").withOption("width",200),r.newColumn("relation").withTitle("Relación").withOption("width",200),r.newColumn("module").notVisible(),r.newColumn(null).withTitle("Activo").withOption("width",200).renderWith(function(e,t,n,o){var a="label label-danger",i=e.status;null==e.statusCode&&void 0==e.statusCode||(a="1"==e.statusCode||1==e.statusCode?"label label-success":"label label-danger");var r='<span class="'+a+'">'+i+"</span>";return r})];var D=function(){angular.element("#dtUser a.editRow").on("click",function(){var e=angular.element(this).data("id"),n=angular.element(this).data("relation"),o=angular.element(this).data("module");return"RE"==o||"EA"==o?(console.log("Las cuentas de drummond no se pueden editar."),void swal("No Editable","Las cuentas creadas desde Responsables y Empleados App no se pueden editar.","error")):void t.onEdit({id:e,relation:n})}),angular.element("#dtUser a.relRow").on("click",function(){var e=angular.element(this).data("id"),t=angular.element(this).data("user-id"),n=angular.element(this).data("relation");S({customerId:o.customerId,userId:t,customerUserId:e,relation:n})}),angular.element("#dtUser a.delRow").on("click",function(){var e=angular.element(this).data("id");y.info("intenta eliminar el registro: "+e),c.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(n){if(n){var o={};o.id=e,m({method:"POST",url:"api/customer-user/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){a.error(e),c.swal("Error en la eliminación",e.data.message,"error")})["finally"](function(){t.reloadDataUser()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};t.onEdit=function(e){t.onLoadRecord(e)},t.dtInstanceUserCallback=function(e){t.dtInstanceUser=e},t.reloadDataUser=function(){var e=t.filter.showRelatedUsers?"api/customer-user-contractor-economic-group":"api/customer-user";t.dtInstanceUser.DataTable.ajax.url(e),t.dtInstanceUser.reloadData()},t.onShowRelatedUsers=function(){t.reloadDataUser()},t.onClearUser=function(){I(),t.isView=!1},t.onAddSkill=function(){p(function(){null==t.user.skills&&(t.user.skills=[]),t.user.skills.push({id:0,customerId:o.customerId,userId:0,skill:null})})},t.onRemoveSkill=function(e){c.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(n){n?p(function(){var n=t.user.skills[e];if(t.user.skills.splice(e,1),0!=n.id){var o={};o.id=n.id,m({method:"POST",url:"api/customer/user-skill/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){a.error(e),c.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})};var S=function(e){var o=n.open({templateUrl:d.app.views.urlRoot+"modules/customer/profile/user/customer_profile_user_relate_customer_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideCustomerUserCustomerRelatedCtrl",scope:t,resolve:{dataItem:function(){return e},isView:function(){return t.isView}}});o.result.then(function(){},function(){})};t.onImport=function(){var e=n.open({templateUrl:d.app.views.urlRoot+"modules/customer/profile/user/customer_profile_user_import_modal.htm",placement:"bottom",size:"lg",backdrop:!0,controller:"ModalInstanceSideCustomerUserImportCtrl",scope:t});e.result.then(function(e){t.reloadDataUser(),e.result&&e.result.errors&&e.result.errors.length>0&&A(e.result)},function(){})};var A=function(e){var t=b.open({templateUrl:d.app.views.urlRoot+"modules/common/modals/data_table_list_modal.htm",controller:"ModalInstanceSideCustomerUserImportMessagesCtrl",windowTopClass:"top-modal",size:"lg",resolve:{data:function(){return e}}});t.result.then(function(){},function(){})};t.loadText=function(e){var n={};n.type=1==e?"profile":"role",n.id=1==e?t.user.profile.value:t.user.role.value,1==e?t.textProfile=null:t.textRole=null,m({method:"POST",url:"api/help-roles-profile/gettext",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)})["catch"](function(e,t){}).then(function(n){p(function(){if(n.data.result&&n.data.result.text)if(1==e)t.textProfile=n.data.result.text;else{var o=" <a class='text-info' target='_blank' href='"+n.data.result.documentUrl+"'>haga clic aquí</a>",a=n.data.result.text+" "+o;t.textRole=a}})})["finally"](function(){})}}]),app.controller("ModalInstanceSideCustomerUserCustomerRelatedCtrl",["$scope","$uibModalInstance","dataItem","$timeout","SweetAlert","isView","$filter","FileUploader","$http","DTOptionsBuilder","DTColumnBuilder","$compile",function(e,t,n,o,a,i,r,l,s,u,c,d){e.isView=i,e.onCloseModal=function(){t.close(1)},e.onCancel=function(){t.dismiss("cancel")},e.dtOptionsCustomerUserRelateCustomer=u.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerId=n.customerId,e.customerUserId=n.customerUserId,e.userId=n.userId,e.relation=n.relation,JSON.stringify(e)},url:"api/customer-user-customer-related",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){m()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,n,o){d(angular.element(t).contents())(e)}),e.dtColumnsCustomerUserRelateCustomer=[c.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,t,n,o){var a="",i='<a class="btn btn-danger btn-xs delRow lnk" target="_blank" href="#" uib-tooltip="Eliminar relación" data-id="'+e.id+'" >   <i class="fa fa-trash-o"></i></a> ',r=' | <a class="btn btn-success btn-xs toggleRow lnk" target="_blank" href="#" uib-tooltip="Activar" data-id="'+e.id+'" >   <i class="fa fa-check"></i></a> ',l=' | <a class="btn btn-warning btn-xs toggleRow lnk" target="_blank" href="#" uib-tooltip="Inactivar" data-id="'+e.id+'" >   <i class="fa fa-ban"></i></a> ';return a+=i,a+="1"==e.statusCode||1==e.statusCode?l:r}),c.newColumn("documentNumber").withTitle("Nro Documento").withOption("width",200),c.newColumn("businessName").withTitle("Razón Social").withOption("width",200),c.newColumn("relation").withTitle("Relación").withOption("width",200),c.newColumn(null).withTitle("Activo").withOption("width",200).renderWith(function(e,t,n,o){var a="label label-danger",i=e.status;null==e.statusCode&&void 0==e.statusCode||(a="1"==e.statusCode||1==e.statusCode?"label label-success":"label label-danger");var r='<span class="'+a+'">'+i+"</span>";return r})];var m=function(){$("#dtCustomerUserRelateCustomer a.toggleRow").on("click",function(){var t=angular.element(this).data("id");s({method:"POST",url:"api/customer-user/toggle-active",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param({id:t})}).then(function(e){swal("Actualizado","Registro actualizado satisfactoriamente","info")})["catch"](function(e){a.swal("Error en la activación",e.data.message,"error")})["finally"](function(){e.reloadHistoricalData(),e.reloadData()})}),$("#dtCustomerUserRelateCustomer a.delRow").on("click",function(){var t=angular.element(this).data("id");a.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(n){n?s({method:"POST",url:"api/customer-user/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param({id:t})}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){a.swal("Error en la eliminación",e.data.message,"error")})["finally"](function(){e.reloadHistoricalData(),e.reloadData()}):swal("Cancelación","La operación ha sido cancelada","error")})})};e.dtInstanceCustomerUserRelateCustomerCallback=function(t){e.dtInstanceCustomerUserRelateCustomer=t},e.reloadData=function(){e.dtInstanceCustomerUserRelateCustomer.reloadData()},e.dtOptionsCustomerUserRelateCustomerAvailable=u.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerId=n.customerId,e.customerUserId=n.customerUserId,e.userId=n.userId,e.relation=n.relation,JSON.stringify(e)},url:"api/customer-user-customer-available",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){p()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,n,o){d(angular.element(t).contents())(e)}),e.dtColumnsCustomerUserRelateCustomerAvailable=[c.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,t,n,o){var a="",i='<a class="btn btn-success btn-xs addRow lnk" uib-tooltip="Adicionar" data-id="'+e.id+'" >   <i class="fa fa-plus"></i></a> ';return a+=i}),c.newColumn("documentNumber").withTitle("Nro Documento").withOption("width",200),c.newColumn("businessName").withTitle("Razón Social").withOption("width",200),c.newColumn("relation").withTitle("Relación").withOption("width",200),c.newColumn("status").withTitle("Estado").withOption("width",200).renderWith(function(e,t,n,o){var a="";switch(e){case"Activo":a="label label-success";break;case"Inactivo":a="label label-danger";break;case"Retirado":a="label label-warning"}var i='<span class="'+a+'">'+e+"</span>";return i})];var p=function(){$("#dtCustomerUserRelateCustomerAvailable a.addRow").on("click",function(){var e=$(this).data("id");f(e)})};e.dtInstanceCustomerUserRelateCustomerAvailableCallback=function(t){e.dtInstanceCustomerUserRelateCustomerAvailable=t},e.reloadHistoricalData=function(){e.dtInstanceCustomerUserRelateCustomerAvailable.reloadData()};var f=function(t){var i=JSON.stringify({customerId:t,customerUserId:n.customerUserId});return s({method:"POST",url:"api/customer-user/relate-customer",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param({data:Base64.encode(i)})}).then(function(t){o(function(){e.reloadHistoricalData(),e.reloadData()})})["catch"](function(e){a.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})}}]),app.controller("ModalInstanceSideCustomerUserImportCtrl",["$rootScope","ngNotify","$stateParams","$scope","FileUploader","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","ListService",function(e,t,n,o,a,i,r,l,s,u,c,d){var m="",p=null,f=o.uploader=new a({url:m+"api/customer-user/import",formData:[]});o.download=function(){angular.element("#downloadDocument")[0].src="api/customer-user/download-template?customerId="+n.customerId},f.filters.push({name:"customFilter",fn:function(e,t){return this.queue.length<10}}),f.onBeforeUploadItem=function(o){var a={id:n.customerId,user:e.currentUser().id};o.formData.push(a),t.set("El archivo se está importando.",{position:"bottom",sticky:!0,button:!1,html:!0})},f.onCompleteItem=function(e,t,n,o){p=t},f.onCompleteAll=function(){i.close(p),t.set("El proceso ha finalizado.",{position:"bottom",sticky:!0,type:"success",button:!0,html:!0})}}]),app.controller("ModalInstanceSideCustomerUserImportMessagesCtrl",["$rootScope","$stateParams","$scope","$uibModalInstance","data","$http","toaster","DTOptionsBuilder","DTColumnBuilder","$compile","$q",function(e,t,n,o,a,i,r,l,s,u,c){n.title="Errores Importación",n.onCloseModal=function(){o.close(1)},n.onCancel=function(){o.dismiss("cancel")},n.dtOptionsCommonDataTableList=l.fromFnPromise(function(){var e=c.defer();return e.resolve(a.errors.map(function(e){return{message:e}})),e.promise}).withBootstrap().withPaginationType("full_numbers").withOption("createdRow",function(e,t,o){u(angular.element(e).contents())(n)}),n.dtColumnsCommonDataTableList=[s.newColumn("message").withTitle("Mensaje").withOption("defaultContent","")],n.dtInstanceCommonDataTableListCallback=function(e){n.dtInstanceCommonDataTableList=e},n.reloadData=function(){n.dtInstanceCommonDataTableList.reloadData()}}]),app.controller("ModalInstanceSideUserModalEmployeeListCtrl",["$rootScope","$stateParams","$scope","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile",function(e,t,n,o,a,i,r,l,s,u,c,d,m,p){n.employee={id:0},n.onCloseModal=function(){o.close(n.employee)},n.onCancel=function(){o.dismiss("cancel")},n.onLoadRecord=function(){if(0!=n.employee.id){var e={id:n.employee.id};l({method:"GET",url:"api/customer-employee",params:e})["catch"](function(e,t){if(403==t){var n=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";r.swal("No Autorizado","No estas autorizado para ver esta información.","error"),i(function(){$state.go(n)},3e3)}else 404==t?r.swal("Información no disponible","Diagnóstico no encontrado","error"):r.swal("Error","Se ha presentado un error al intentar acceder a la información del proceso","error")}).then(function(e){i(function(){if(n.employee=e.data.result,n.employee.entity.details.length){var t=n.employee.entity.details.filter(function(e){return"email"==e.type.value});t.length&&(n.employee.email=t[0])}})})["finally"](function(){i(function(){n.onCloseModal()},400)})}else n.loading=!1},n.dtInstanceModalEmployeeList={},n.dtOptionsModalEmployeeList=m.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerId=t.customerId,JSON.stringify(e)},url:"api/customer-employee-modal-basic",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){f()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,t,o){p(angular.element(e).contents())(n)}),n.dtColumnsModalEmployeeList=[d.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,t,n,o){var a="",i="",r='<a class="btn btn-success btn-xs editRow lnk" href="#" uib-tooltip="Adicionar empleado" tooltip-placement="right"  data-id="'+e.id+'"'+i+' >   <i class="fa fa-plus-square"></i></a> ';return a+=r}),d.newColumn("documentNumber").withTitle("Número Identificación").withOption("width",200),d.newColumn("firstName").withTitle("Nombre").withOption("width",200),d.newColumn("lastName").withTitle("Apellidos").withOption("width",200),d.newColumn("workPlace").withTitle("Centro de Trabajo").withOption("width",200),d.newColumn("job").withTitle("Cargo").withOption("width",200),d.newColumn("neighborhood").withTitle("Centro de Costos").withOption("width",200),d.newColumn(null).withTitle("Estado").withOption("width",200).renderWith(function(e,t,n,o){var a="label label-danger",i="Inactivo";null==e.isActiveCode&&void 0==e.isActiveCode||("Activo"==e.isActiveCode?(a="label label-success",i="Activo"):(a="label label-danger",i="Inactivo"));var r='<span class="'+a+'">'+i+"</span>";return r}),d.newColumn(null).withTitle("Autorización").withOption("width",200).renderWith(function(e,t,n,o){var a="label label-danger",i="Inactivo";null==e.isAuthorized&&void 0==e.isAuthorized||("Autorizado"==e.isAuthorized?(a="label label-success",i="Autorizado"):"No Autorizado"==e.isAuthorized?(a="label label-danger",i="No Autorizado"):(a="label label-info",i="N/A"));var r='<span class="'+a+'">'+i+"</span>";return r})];var f=function(){angular.element("#dtModalEmployeeList a.editRow").on("click",function(){var e=angular.element(this).data("id");n.editDisabilityEmployee(e)})};n.reloadData=function(){n.dtInstanceModalEmployeeList.reloadData()},n.viewDisabilityEmployee=function(e){n.employee.id=e,n.isView=!0,n.onLoadRecord()},n.editDisabilityEmployee=function(e){n.employee.id=e,n.isView=!1,n.onLoadRecord()}}]);
"use strict";app.controller("customerManacleCtrl",["$scope","$aside","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","SweetAlert","$rootScope","$http","$timeout","$uibModal","flowFactory","cfpLoadingBar","$filter","$document",function(t,e,n,o,a,i,r,l,c,s,u,d,m,f,p,w,h,g,v){t.statusList=[{item:"Activo",value:1},{item:"Inactivo",value:0}],t.isView="view"==t.$parent.editMode,t.maxDate=new Date,t.datePickerConfig={culture:"es-CO",format:"dd/MM/yyyy"};var I=function(){t.entity={id:0,registrationDate:new Date,customerId:n.customerId,number:null,isActive:t.statusList[0]},t.entity.registrationDate=t.maxDate};I(),t.onLoadRecord=function(){if(0!=t.entity.id){var e={id:t.entity.id};m({method:"GET",url:"api/customer-manacle/get",params:e})["catch"](function(t){}).then(function(e){f(function(){t.entity=e.data.result,t.entity.registrationDate&&(t.entity.registrationDate=new Date(t.entity.registrationDate.date))})})["finally"](function(){})}},t.form={submit:function(t){var e=null;if(t.$invalid){var n=null,e=null;for(n in t)"$"!=n[0]&&(null!==e||t[n].$valid||(e=t[n].$name),t[n].$pristine&&(t[n].$dirty=!0));return angular.element(".ng-invalid[name="+e+"]").focus(),void u.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}C()},reset:function(t){t.$setPristine(!0)}};var C=function(){var e={},n=JSON.stringify(t.entity);return e.data=Base64.encode(n),m({method:"POST",url:"api/customer-manacle/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){f(function(){t.entity=e.data.result,I(),t.reloadDataManacle()})})["catch"](function(t){o.error(t),u.swal("Error de guardado",t.data.message,"error")})["finally"](function(){})};t.cancelEdition=function(t){I()},t.dtInstanceManacle={},t.dtOptionsManacle=a.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.customerId=n.customerId,JSON.stringify(t)},url:"api/customer-manacle",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){y()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,n,o){l(angular.element(e).contents())(t)}),t.dtColumnsManacle=[i.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,n,o,a){var i="",r='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+e.id+'" >   <i class="fa fa-edit"></i></a> ',l='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+e.id+'" >   <i class="fa fa-trash-o"></i></a> ';return t.isView||(i+=r,i+=l),i}),i.newColumn("registrationDate").withTitle("Fecha").withOption("width",200),i.newColumn("number").withTitle("Id Manilla").withOption("width",200),i.newColumn("isActive").withTitle("Estado").withOption("width",200).renderWith(function(t){var e="label label-success";"Inactivo"==t&&(e="label label-danger");var n='<span class="'+e+'">'+t+"</span>";return n})];var y=function(){angular.element("#dtManacle a.editRow").on("click",function(){var e=angular.element(this).data("id");t.onEdit(e)}),angular.element("#dtManacle a.delRow").on("click",function(){var e=angular.element(this).data("id");u.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(n){if(n){var a={};a.id=e,m({method:"POST",url:"api/customer-manacle/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){o.error(t),u.swal("Error de guardado",t.data.message,"error")})["finally"](function(){t.reloadDataManacle()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};t.onEdit=function(e){t.entity.id=e,t.onLoadRecord()},t.dtInstanceManacleCallback=function(e){t.dtInstanceManacle=e},t.reloadDataManacle=function(){t.dtInstanceManacle.reloadData()},t.onImport=function(){var n=e.open({templateUrl:d.app.views.urlRoot+"modules/customer/profile/manacle/customer_profile_manacle_import_modal.htm",placement:"bottom",size:"lg",backdrop:!0,controller:"ModalInstanceSideCustomerManacleImportCtrl",scope:t});n.result.then(function(e){t.reloadDataManacle()},function(){})}}]),app.controller("ModalInstanceSideCustomerManacleImportCtrl",["$rootScope","ngNotify","$stateParams","$scope","FileUploader","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","ListService",function(t,e,n,o,a,i,r,l,c,s,u,d){function m(){var t=[{name:"export_url",value:null}];d.getDataList(t).then(function(t){f=t.data.data.exportUrl.item,w.url=f+"api/v1/customer-manacle-import",o.uploader.url=f+"api/v1/customer-manacle-import"},function(t){o.status="Unable to load customer data: "+t.message})}var f="",p=null,w=o.uploader=new a({url:f+"api/v1/customer-manacle-import",formData:[]});m(),o.download=function(){angular.element("#downloadDocument")[0].src="api/customer-manacle/download-template?customerId="+n.customerId},w.filters.push({name:"customFilter",fn:function(t,e){return this.queue.length<10}}),w.onWhenAddingFileFailed=function(t,e,n){console.info("onWhenAddingFileFailed",t,e,n)},w.onAfterAddingFile=function(t){console.info("onAfterAddingFile",t)},w.onAfterAddingAll=function(t){console.info("onAfterAddingAll",t)},w.onBeforeUploadItem=function(e){console.info("onBeforeUploadItem",e);var o={id:n.customerId,user:t.currentUser().id};e.formData.push(o)},w.onProgressItem=function(t,e){console.info("onProgressItem",t,e)},w.onProgressAll=function(t){console.info("onProgressAll",t)},w.onSuccessItem=function(t,e,n,o){console.info("onSuccessItem",t,e,n,o)},w.onErrorItem=function(t,e,n,o){console.info("onErrorItem",t,e,n,o)},w.onCancelItem=function(t,e,n,o){console.info("onCancelItem",t,e,n,o)},w.onCompleteItem=function(t,e,n,o){console.info("onCompleteItem",t,e,n,o),p=e},w.onCompleteAll=function(){console.info("onCompleteAll"),i.close(p)}}]);
"use strict";app.controller("customerManacleEmployeeCtrl",["$scope","$aside","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","SweetAlert","$rootScope","$http","$timeout","$uibModal","flowFactory","cfpLoadingBar","$filter","$document",function(e,t,n,o,i,a,l,r,c,s,u,d,m,p,f,w,h,y,b){e.isView="view"==e.$parent.editMode,e.maxDate=new Date,e.datePickerConfig={culture:"es-CO",format:"dd/MM/yyyy"};var g=function(){e.entity={id:0,registrationDate:new Date,customerId:n.customerId,manacleNumber:null,manacleId:null,isActive:!0,customerEmployeeId:null,firstName:null,lastName:null,documentNumber:null,documentType:null},e.entity.registrationDate=e.maxDate};g(),e.onLoadRecord=function(){if(0!=e.entity.id){var t={id:e.entity.id};m({method:"GET",url:"api/customer-manacle-employee/get",params:t})["catch"](function(e){}).then(function(t){p(function(){e.entity=t.data.result,e.entity.registrationDate&&(e.entity.registrationDate=new Date(e.entity.registrationDate.date))})})["finally"](function(){})}},e.form={submit:function(e){var t=null;if(e.$invalid){var n=null,t=null;for(n in e)"$"!=n[0]&&(null!==t||e[n].$valid||(t=e[n].$name),e[n].$pristine&&(e[n].$dirty=!0));return angular.element(".ng-invalid[name="+t+"]").focus(),void u.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}C()},reset:function(e){e.$setPristine(!0)}};var C=function(){var t={},n=JSON.stringify(e.entity);return t.data=Base64.encode(n),m({method:"POST",url:"api/customer-manacle-employee/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){p(function(){e.entity=t.data.result,g(),e.reloadDataManacle()})})["catch"](function(e){o.error(e),u.swal("Error de guardado",e.data.message,"error")})["finally"](function(){})};e.cancelEdition=function(e){g()},e.dtInstanceManacle={},e.dtOptionsManacle=i.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerId=n.customerId,JSON.stringify(e)},url:"api/customer-manacle-employee",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){v()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,n,o){r(angular.element(t).contents())(e)}),e.dtColumnsManacle=[a.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,n,o,i){var a="",l='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+t.id+'" >   <i class="fa fa-edit"></i></a> ',r='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+t.id+'" >   <i class="fa fa-trash-o"></i></a> ';return e.isView||(a+=l,a+=r),a}),a.newColumn("registrationDate").withTitle("Fecha").withOption("width",200),a.newColumn("manacleNumber").withTitle("Id Manilla").withOption("width",200),a.newColumn("documentType").withTitle("Tipo Identificación").withOption("width",200),a.newColumn("documentNumber").withTitle("Identificación").withOption("width",200),a.newColumn("firstName").withTitle("Nombre(s)").withOption("width",200),a.newColumn("lastName").withTitle("Apellidos").withOption("width",200),a.newColumn("isActive").withTitle("Estado").withOption("width",200).renderWith(function(e){var t="label label-success";"Inactivo"==e&&(t="label label-danger");var n='<span class="'+t+'">'+e+"</span>";return n})];var v=function(){angular.element("#dtManacleEmployee a.editRow").on("click",function(){var t=angular.element(this).data("id");e.onEdit(t)}),angular.element("#dtManacleEmployee a.delRow").on("click",function(){var t=angular.element(this).data("id");u.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(n){if(n){var i={};i.id=t,m({method:"POST",url:"api/customer-manacle-employee/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){o.error(e),u.swal("Error de guardado",e.data.message,"error")})["finally"](function(){e.reloadDataManacle()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};e.onEdit=function(t){e.entity.id=t,e.onLoadRecord()},e.dtInstanceManacleCallback=function(t){e.dtInstanceManacle=t},e.reloadDataManacle=function(){e.dtInstanceManacle.reloadData()},e.onSearchManacle=function(){var n=t.open({templateUrl:d.app.views.urlRoot+"modules/common/modals/data_table_list_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceManacleCtrl",scope:e,windowTopClass:"top-modal",resolve:{}});n.result.then(function(t){e.entity.manacleId=t.id,e.entity.manacleNumber=t.number})},e.onSearchEmployee=function(){var n=t.open({templateUrl:d.app.views.urlRoot+"modules/customer/occupational/absenteeism/disability/customer_absenteeism_disability_employee_list_modal.htm",placement:"right",windowTopClass:"top-modal",size:"lg",backdrop:!0,controller:"ModalInstanceSideManacleEmployeeListCtrl",scope:e});n.result.then(function(t){e.entity.documentType=t.entity.documentType?t.entity.documentType.item:null,e.entity.documentNumber=t.entity.documentNumber,e.entity.firstName=t.entity.firstName,e.entity.lastName=t.entity.lastName,e.entity.customerEmployeeId=t.id})},e.onImport=function(){var n=t.open({templateUrl:d.app.views.urlRoot+"modules/customer/profile/manacle-employee/customer_profile_manacle_employee_import_modal.htm",placement:"bottom",size:"lg",backdrop:!0,controller:"ModalInstanceSideCustomerManacleEmployeeImportCtrl",scope:e});n.result.then(function(t){e.reloadDataManacle()},function(){})}}]),app.controller("ModalInstanceManacleCtrl",["$rootScope","$stateParams","$scope","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile",function(e,t,n,o,i,a,l,r,c,s,u,d,m,p){n.title="MANILLAS DISPONIBLES",n.entity={},n.onCloseModal=function(){o.close(n.entity)},n.onCancel=function(){o.dismiss("cancel")};var f=function(e){if(0!=e){var t={id:e};r({method:"GET",url:"api/customer-manacle/get",params:t})["catch"](function(e,t){l.swal("Error","Se ha presentado un error al intentar acceder a la información de la manilla","error")}).then(function(e){a(function(){n.entity=e.data.result})})["finally"](function(){a(function(){n.onCloseModal()})})}else n.loading=!1};n.dtOptionsCommonDataTableList=m.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerId=t.customerId,e.isActive="Activo",JSON.stringify(e)},url:"api/customer-manacle",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){w()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,t,o){p(angular.element(e).contents())(n)}),n.dtColumnsCommonDataTableList=[d.newColumn(null).withTitle("Acciones").withOption("width",80).notSortable().renderWith(function(e,t,n,o){var i="",a="",l='<a class="btn btn-success btn-xs editRow lnk" href="#" uib-tooltip="Adicionar manilla"  data-id="'+e.id+'"'+a+' >   <i class="fa fa-plus-square"></i></a> ';return i+=l}),d.newColumn("registrationDate").withTitle("Fecha").withOption("width",200),d.newColumn("number").withTitle("Id Manilla").withOption("width",200),d.newColumn("isActive").withTitle("Estado").withOption("width",200).renderWith(function(e){var t="label label-success",n='<span class="'+t+'">'+e+"</span>";return n})];var w=function(){angular.element("#dtCommonDataTableList a.editRow").on("click",function(){var e=angular.element(this).data("id");f(e)})};n.dtInstanceCommonDataTableListCallback=function(e){n.dtInstanceCommonDataTableList=e},n.reloadData=function(){n.dtInstanceCommonDataTableList.reloadData()}}]),app.controller("ModalInstanceSideManacleEmployeeListCtrl",["$rootScope","$stateParams","$scope","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile",function(e,t,n,o,i,a,l,r,c,s,u,d,m,p){n.employee={},n.onCloseModal=function(){o.close(n.employee)},n.onCancel=function(){o.dismiss("cancel")},n.onLoadRecord=function(){if(0!=n.employee.id){var e={id:n.employee.id};r({method:"GET",url:"api/customer-employee",params:e})["catch"](function(e,t){l.swal("Error","Se ha presentado un error al intentar acceder a la información del empleado","error")}).then(function(e){a(function(){n.employee=e.data.result})})["finally"](function(){a(function(){n.onCloseModal()})})}else n.loading=!1},n.dtInstanceDisabilityEmployeeList={},n.dtOptionsDisabilityEmployeeList=m.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerId=t.customerId,e.isActive=1,JSON.stringify(e)},url:"api/customer-employee-modal-basic",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){f()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,t,o){p(angular.element(e).contents())(n)}),n.dtColumnsDisabilityEmployeeList=[d.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,t,n,o){var i="",a="",l='<a class="btn btn-success btn-xs editRow lnk" href="#" uib-tooltip="Adicionar empleado" tooltip-placement="right"  data-id="'+e.id+'"'+a+' >   <i class="fa fa-plus-square"></i></a> ';return i+=l}),d.newColumn("documentNumber").withTitle("Número Identificación").withOption("width",200),d.newColumn("firstName").withTitle("Nombre").withOption("width",200),d.newColumn("lastName").withTitle("Apellidos").withOption("width",200),d.newColumn("workPlace").withTitle("Centro de Trabajo").withOption("width",200),d.newColumn("job").withTitle("Cargo").withOption("width",200),d.newColumn("neighborhood").withTitle("Centro de Costos").withOption("width",200),d.newColumn(null).withTitle("Estado").withOption("width",200).renderWith(function(e,t,n,o){var i="label label-danger",a="Inactivo";null==e.isActiveCode&&void 0==e.isActiveCode||("Activo"==e.isActiveCode?(i="label label-success",a="Activo"):(i="label label-danger",a="Inactivo"));var l='<span class="'+i+'">'+a+"</span>";return l}),d.newColumn(null).withTitle("Autorización").withOption("width",200).renderWith(function(e,t,n,o){var i="label label-danger",a="Inactivo";null==e.isAuthorized&&void 0==e.isAuthorized||("Autorizado"==e.isAuthorized?(i="label label-success",a="Autorizado"):"No Autorizado"==e.isAuthorized?(i="label label-danger",a="No Autorizado"):(i="label label-info",a="N/A"));var l='<span class="'+i+'">'+a+"</span>";return l})];var f=function(){angular.element("#dtDisabilityEmployeeList a.editRow").on("click",function(){var e=angular.element(this).data("id");n.editDisabilityEmployee(e)})};n.reloadData=function(){n.dtInstanceDisabilityEmployeeList.reloadData()},n.viewDisabilityEmployee=function(e){n.employee.id=e,n.isView=!0,n.onLoadRecord()},n.editDisabilityEmployee=function(e){n.employee.id=e,n.isView=!1,n.onLoadRecord()}}]),app.controller("ModalInstanceSideCustomerManacleEmployeeImportCtrl",["$rootScope","ngNotify","$stateParams","$scope","FileUploader","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","ListService",function(e,t,n,o,i,a,l,r,c,s,u,d){function m(){var e=[{name:"export_url",value:null}];d.getDataList(e).then(function(e){p=e.data.data.exportUrl.item,w.url=p+"api/v1/customer-manacle-employee-import",o.uploader.url=p+"api/v1/customer-manacle-employee-import"},function(e){o.status="Unable to load customer data: "+e.message})}var p="",f=null,w=o.uploader=new i({url:p+"api/v1/customer-manacle-employee-import",formData:[]});m(),o.download=function(){angular.element("#downloadDocument")[0].src="api/customer-manacle-employee/download-template?customerId="+n.customerId},w.filters.push({name:"customFilter",fn:function(e,t){return this.queue.length<10}}),w.onWhenAddingFileFailed=function(e,t,n){console.info("onWhenAddingFileFailed",e,t,n)},w.onAfterAddingFile=function(e){console.info("onAfterAddingFile",e)},w.onAfterAddingAll=function(e){console.info("onAfterAddingAll",e)},w.onBeforeUploadItem=function(t){console.info("onBeforeUploadItem",t);var o={id:n.customerId,user:e.currentUser().id};t.formData.push(o)},w.onProgressItem=function(e,t){console.info("onProgressItem",e,t)},w.onProgressAll=function(e){console.info("onProgressAll",e)},w.onSuccessItem=function(e,t,n,o){console.info("onSuccessItem",e,t,n,o)},w.onErrorItem=function(e,t,n,o){console.info("onErrorItem",e,t,n,o)},w.onCancelItem=function(e,t,n,o){console.info("onCancelItem",e,t,n,o)},w.onCompleteItem=function(e,t,n,o){console.info("onCompleteItem",e,t,n,o),f=t},w.onCompleteAll=function(){console.info("onCompleteAll"),a.close(f)}}]);
"use strict";app.controller("CustomerInfoStructureOrganizationalListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$aside","$document","ListService","$cookies",function(t,o,n,e,a,r,i,l,s,c,u,d,m,p,f,w,h){function g(o){var n=p.open({templateUrl:c.app.views.urlRoot+"modules/customer/profile/organizational-structure/organizational_structure_edit_modal.htm",placement:"right",windowTopClass:"top-modal",size:"md",backdrop:!0,controller:"ModalInstanceSideOrganizationStructureEditCtrl",scope:t,resolve:{data:function(){return o}}});n.result.then(function(o){t.dtInstancePositivaFgn.reloadData()})}function v(o){m.swal({title:"Estas seguro?",text:"Eliminará el esquema de la estructura organizacional.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(e){if(e){var a={data:Base64.encode(JSON.stringify({id:o}))};return d({method:"post",url:"api/customer-organizational-structure/destroy",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(o){t.dtInstancePositivaFgn.reloadData()})["catch"](function(t){n.error(t),m.swal("Error al consultar la información.",t.data.message,"error")})["finally"](function(){t.reloadData()})}swal("Cancelado","Operacion cancelada","error")})}t.reloadData=function(){t.dtInstancePositivaFgn.reloadData()},t.data={cleanEntity:JSON.stringify({_param_:o.customerId})},t.dtInstancePositivaFgn={},t.dtOptionsPositivaFgn=e.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.customerId=o.customerId,JSON.stringify(t)},url:"api/customer-organizational-structure/index",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("stateSave",!0).withOption("stateSaveCallback",function(t,o){h.putObject("consultantListCtrl-"+c.$id,o)}).withOption("stateLoadCallback",function(){return h.getObject("consultantListCtrl-"+c.$id)}).withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnDrawCallback",function(){C()}).withOption("fnPreDrawCallback",function(){return!0}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(o,n,e){i(angular.element(o).contents())(t)}),t.dtColumnsPositivaFgn=[a.newColumn(null).withTitle("Acciones").withOption("width",120).notSortable().renderWith(function(t){var o="",n="",e='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+t.id+'"'+n+' > <i class="fa fa-edit"></i></a> ',a='<a class="btn btn-danger btn-xs trashRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+t.id+'"'+n+'>  <i class="fa fa-trash"></i></a> ';return o+=e,o+=a}),a.newColumn("location").withTitle("Locación").withOption("width",200).withOption("defaultContent",""),a.newColumn("department").withTitle("Departamento").withOption("width",200).withOption("defaultContent",""),a.newColumn("area").withTitle("Área").withOption("width",200).withOption("defaultContent",""),a.newColumn("turn").withTitle("Turno").withOption("width",200).withOption("defaultContent","")];var C=function(){$("#dtPositivaFgn a.editRow").on("click",function(){var t=$(this).data("id");g(t)}),$("#dtPositivaFgn a.trashRow").on("click",function(){var t=$(this).data("id");v(t)})};t.onCreate=function(){g(0)},t.onImport=function(){var o=p.open({templateUrl:c.app.views.urlRoot+"modules/common/modals/import_modal.htm",placement:"bottom",size:"lg",backdrop:!0,controller:"ModalCustomerProfileOrganizationalStructureImportCtrl",scope:t});o.result.then(function(o){t.reloadData()})}}]),app.controller("ModalCustomerProfileOrganizationalStructureImportCtrl",["$rootScope","$stateParams","$scope","FileUploader","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","ngNotify","ListService",function(t,o,n,e,a,r,i,l,s,c,u,d){function m(){var t=[{name:"export_url",value:null}];d.getDataList(t).then(function(t){p=t.data.data.exportUrl.item,w.url=p+"api/v1/customer-organizational-structure/import",n.uploader.url=p+"api/v1/customer-organizational-structure/import"},function(t){n.status="Unable to load customer data: "+t.message})}var p="",f=null;n.showTemplate=!0;var w=n.uploader=new e({url:p+"api/v1/customer-organizational-structure/import",formData:[{customerId:o.customerId}]});m(),n.download=function(){jQuery("#downloadDocument")[0].src="api/customer-organizational-structure/download-template?customerId="+o.customerId},w.filters.push({name:"customFilter",fn:function(t,o){return this.queue.length<10}}),w.onWhenAddingFileFailed=function(t,o,n){console.info("onWhenAddingFileFailed",t,o,n)},w.onAfterAddingFile=function(t){console.info("onAfterAddingFile",t)},w.onAfterAddingAll=function(t){console.info("onAfterAddingAll",t)},w.onBeforeUploadItem=function(t){console.info("onBeforeUploadItem",t);var n={id:o.customerId};t.formData.push(n)},w.onProgressItem=function(t,o){console.info("onProgressItem",t,o)},w.onProgressAll=function(t){console.info("onProgressAll",t)},w.onSuccessItem=function(t,o,n,e){console.info("onSuccessItem",t,o,n,e)},w.onErrorItem=function(t,o,n,e){console.info("onErrorItem",t,o,n,e)},w.onCancelItem=function(t,o,n,e){console.info("onCancelItem",t,o,n,e)},w.onCompleteItem=function(t,o,n,e){console.info("onCompleteItem",t,o,n,e),f=o},w.onCompleteAll=function(){console.info("onCompleteAll"),a.close(f)}}]),app.controller("ModalInstanceSideOrganizationStructureEditCtrl",["$rootScope","$stateParams","$scope","$uibModalInstance","$log","$timeout","SweetAlert","$http","data","ModuleListService",function(t,o,n,e,a,r,i,l,s,c){function u(){var t={customerId:o.customerId};c.getDataList("/customer-organizational-structure/get-base-data",t).then(function(t){n.locations=t.data.result.locations,n.departments=t.data.result.departments,n.areas=t.data.result.areas,n.turns=t.data.result.turns},function(t){n.status="Unable to load protocol data: "+t.message})}function d(){if(n.entity.id){var t={customerId:n.entity.customerId,id:n.entity.id},o={data:Base64.encode(JSON.stringify(t))};return l({method:"post",url:"api/customer-organizational-structure/show",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(t){n.entity=t.data.result})["catch"](function(t){a.error(t),i.swal("Error al consultar la información.",t.data.message,"error")})}}n.locations=[],n.departments=[],n.areas=[],n.turns=[],n.onCancel=function(){e.dismiss("cancel")};var m=function(){n.entity={id:s||0,customerId:o.customerId,location:null,department:null,area:null,turn:null}};m(),u(),d(),n.form={submit:function(t){if(n.Form=t,t.$valid)return void p();var o=null,e=null;for(o in t)"$"!=o[0]&&(null!==e||t[o].$valid||(e=t[o].$name),t[o].$pristine&&(t[o].$dirty=!0));angular.element(".ng-invalid[name="+e+"]").focus(),i.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e intentalo de nuevo.","error")}};var p=function(){var t=JSON.stringify(n.entity),o={data:Base64.encode(t)};return l({method:"POST",url:"api/customer-organizational-structure/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(t){e.close(),i.swal("Proceso Exitoso","Se ha almacenado correctamente la información.","success")})["catch"](function(t){a.error(t),i.swal("Error de guardado",t.data.message,"error")})}}]);
"use strict";app.controller("CustomerInfoLicenseListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$http","SweetAlert","$aside","$document","$cookies","$filter","ModuleListService","ListService",function(t,e,i,n,o,a,s,r,l,c,u,d,w,m,p,h,f,C){function L(e,i){var n=w.open({templateUrl:c.app.views.urlRoot+"modules/customer/profile/licenses/license_edit_modal.htm",placement:"right",windowTopClass:"top-modal",size:"lg",backdrop:!1,controller:"ModalInstanceSideCustomerProfileLicenseEditCtrl",scope:t,resolve:{data:{id:e,isView:i,agentList:t.agentList}}});n.result.then(function(){O(),t.reloadData()})}function g(e){var i=w.open({templateUrl:c.app.views.urlRoot+"modules/customer/profile/licenses/license_finish_modal.htm",placement:"right",windowTopClass:"top-modal",size:"md",backdrop:!0,controller:"ModalInstanceSideCustomerProfileLicenseFinishCtrl",scope:t,resolve:{data:{id:e}}});i.result.then(function(){O(),t.reloadData()})}function O(){var i={customerId:e.customerId};f.getDataList("/customer-licenses/current-license",i).then(function(e){t.currentLicense=e.data.result},function(e){t.status="Unable to load protocol data: "+e.message})}function b(){var i=[{name:"customer_comercial_agents",criteria:{customerId:e.customerId}}];C.getDataList(i).then(function(e){t.agentList=e.data.data.CustomerComercialAgents})}t.currentLicense={license:null,startDate:null,endDate:null,state:null},t.agentList=[],O(),b(),t.reloadData=function(){t.dtInstanceCustomerProfileLicenseList.reloadData()},t.dtInstanceCustomerProfileLicenseList={},t.dtOptionsCustomerProfileLicenseList=n.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.customerId=e.customerId,JSON.stringify(t)},url:"api/customer-licenses",type:"POST"}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnDrawCallback",function(){v()}).withOption("fnPreDrawCallback",function(){return!0}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e){s(angular.element(e).contents())(t)}),t.dtColumnsCustomerProfileLicenseList=[o.newColumn(null).withTitle("Acciones").withOption("width",120).notSortable().renderWith(function(t){var e="",i="",n="",o="",a='<a class="btn btn-azure btn-xs viewRow lnk" href="#" uib-tooltip="Ver" data-id="'+t.id+'"'+i+' > <i class="fa fa-eye"></i></a> ';return"Finalizada"!=t.state&&(n='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+t.id+'"'+i+' > <i class="fa fa-edit"></i></a> ',o='<a class="btn btn-danger btn-xs trashRow lnk" href="#" uib-tooltip="Finalizar" data-id="'+t.id+'"'+i+'>  <i class="fa fa-gear"></i></a> '),e+=a,e+=n,e+=o}),o.newColumn("license").withTitle("Licencia").withOption("width",200),o.newColumn("startDate").withTitle("Fecha Inicio").withOption("width",200),o.newColumn("endDate").withTitle("Fecha Finalización").withOption("width",200),o.newColumn("agent").withTitle("Comercial Asignado").withOption("width",200),o.newColumn("value").withTitle("Valor").withOption("width",200).renderWith(function(t){return"$ "+h("number")(t,2)}),o.newColumn("state").withTitle("Estado").withOption("width",200)];var v=function(){$("#dtCustomerProfileLicenseList a.viewRow").on("click",function(){var t=$(this).data("id");L(t,!0)}),$("#dtCustomerProfileLicenseList a.editRow").on("click",function(){var t=$(this).data("id");L(t,!1)}),$("#dtCustomerProfileLicenseList a.trashRow").on("click",function(){var t=$(this).data("id");g(t)})};t.onCreate=function(){L(0,!1)}}]);
app.controller("ModalInstanceSideCustomerProfileLicenseEditCtrl",["$rootScope","$stateParams","$scope","$uibModalInstance","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","$log","SweetAlert","$http","ListService","$timeout","$filter","data",function(e,t,n,i,o,r,a,l,s,u,c,d,f,w,m){function p(){if(!n.entity.id)return void(n.agentList.length>0&&(n.entity.agentId=n.agentList[0]));var e={id:n.entity.id},t={data:Base64.encode(JSON.stringify(e))};return c({method:"post",url:"api/customer-licenses/show",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(e){n.entity=e.data.result,n.entity.reason=null,n.entity.agentId=n.agentList.find(function(e){return e.id==n.entity.agentId}),n.reloadData()})["catch"](function(e){s.error(e),u.swal("Error al consultar la información.",e.data.message,"error")})}function h(){n.stateList.length&&0==n.isView&&(n.stateList=n.stateList.filter(function(e){return"LS003"!=e.value}))}n.isView=m.isView,n.textProfile=null,n.agentList=m.agentList,n.licenseList=e.parameters("wg_customer_licenses_types"),n.stateList=e.parameters("wg_customer_licenses_states"),n.minDate=new Date,n.datePickerConfig={culture:"es-CO",format:"dd/MM/yyyy"},n.onCancel=function(){i.dismiss("cancel")};var g=function(){n.entity={id:m.id||0,customerId:t.customerId,license:null,startDate:null,endDate:null,agentId:null,value:null,state:n.stateList.find(function(e){return"LS001"==e.value}),reason:null}};g(),p(),h(),n.onSelectLicense=function(){f(function(){n.textProfile=n.entity.license.code})},n.form={submit:function(e){if(n.Form=e,e.$valid)return void L();var t=null,i=null;for(t in e)"$"!=t[0]&&(null!==i||e[t].$valid||(i=e[t].$name),e[t].$pristine&&(e[t].$dirty=!0));angular.element(".ng-invalid[name="+i+"]").focus(),u.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e intentalo de nuevo.","error")}};var L=function(){var e=JSON.stringify(n.entity),t={data:Base64.encode(e)};return c({method:"POST",url:"api/customer-licenses/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(){i.close(),u.swal("Proceso Exitoso","Se ha almacenado correctamente la información.","success")})["catch"](function(e){s.error(e),u.swal("Error de guardado",e.data.message,"error")})};n.reloadData=function(){n.dtInstanceCustomerInfoLicenseLogs.reloadData()},n.dtInstanceCustomerInfoLicenseLogs={},n.dtOptionsCustomerInfoLicenseLogs=o.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.licenseId=n.entity.id,JSON.stringify(e)},url:"api/customer-licenses/logs",type:"POST"}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return 0!=n.entity.id}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,t,i){l(angular.element(e).contents())(n)}),n.dtColumnsCustomerInfoLicenseLogs=[r.newColumn("date").withTitle("Fecha").withOption("width",200),r.newColumn("field").withTitle("Campo Modificado").withOption("width",200),r.newColumn(null).withTitle("Valor Anterior").withOption("width",200).renderWith(function(e){return"Valor Licencia"==e.field?"$ "+w("number")(e.beforeValue,2):e.beforeValue}),r.newColumn(null).withTitle("Valor Nuevo").withOption("width",200).renderWith(function(e){return"Valor Licencia"==e.field?"$ "+w("number")(e.afterValue,2):e.afterValue}),r.newColumn("user").withTitle("Usuario").withOption("width",200),r.newColumn("reason").withTitle("Motivo").withOption("width",200)]}]);
app.controller("ModalInstanceSideCustomerProfileLicenseFinishCtrl",["$rootScope","$stateParams","$scope","$uibModalInstance","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","$log","SweetAlert","$http","ListService","data",function(e,r,n,o,a,i,t,l,s,c,u,d,m){n.minDate=new Date,n.datePickerConfig={culture:"es-CO",format:"dd/MM/yyyy"},n.onCancel=function(){o.dismiss("cancel")};var f=function(){n.entity={id:m.id,finishDate:null,reason:null}};f(),n.form={submit:function(e){if(n.Form=e,e.$valid)return void p();var r=null,o=null;for(r in e)"$"!=r[0]&&(null!==o||e[r].$valid||(o=e[r].$name),e[r].$pristine&&(e[r].$dirty=!0));angular.element(".ng-invalid[name="+o+"]").focus(),c.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e intentalo de nuevo.","error")}};var p=function(){var e=JSON.stringify(n.entity),r={data:Base64.encode(e)};return u({method:"POST",url:"api/customer-licenses/finish",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(r)}).then(function(){o.close(),c.swal("Proceso Exitoso","Se ha almacenado correctamente la información.","success")})["catch"](function(e){s.error(e),c.swal("Error de guardado",e.data.message,"error")})}}]);
"use strict";app.controller("customernSignatureCertificateVRCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$aside","$document","flowFactory","ListService","FileUploader","$filter","bsLoadingOverlayService","$q",function(e,t,o,r,a,n,i,l,u,s,c,d,m,f,p,g,w,v,y,h,S){function T(){d({method:"GET",url:"api/customer/signature-certificate-vr/get/"+t.customerId}).then(function(t){console.log(t),e.entity=t.data.result})}e.customerId=t.customerId,e.uploader=new Flow,e.uploaderLogo=new Flow,e.dynamicPopover={templateUrl:"myPopoverTemplate.html"};var C=function(){e.entity={id:null,customerId:t.customerId,fullName:null,job:null,is_active:null,signature:null,logo:null}};C(),T(),e.form={submit:function(e){F()},reset:function(){e.Form.$setPristine(!0),C()}};var F=function(){var t=JSON.stringify(e.entity),o={data:Base64.encode(t)};return d({method:"POST",url:"api/customer/signature-certificate-vr/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(t){console.log(t),c(function(){m.swal("Registro","La información ha sido guardada satisfactoriamente","success"),e.entity=t.data.result,e.uploader.flow.resume(),e.uploaderLogo.flow.resume()})})["catch"](function(e){m.swal("Error de guardado",e.data.message,"error")})}}]);
"use strict";app.controller("customerEmployeeCtrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout",function(e,o,t,c,n,i){e.employee_section="list",e.currentEmployee=0,e.editMode="create",e.navToSection=function(o,t,c){i(function(){e.employee_section=o,e.editMode=t,e.$parent.switchSubTab(t),e.currentEmployee=c})}}]);
"use strict";app.factory("CustomerEmployeeService",["$http",function(t){var n="api/customer-employee/save-auth",e={},o=null,r=null,u=null;return e.setCanAuthorize=function(t){u=t},e.getCanAuthorize=function(){return o},e.setAuthorization=function(t){o=t},e.getAuthorization=function(){return o},e.setLastAuthorization=function(t){r=t},e.getLastAuthorization=function(){return r},e.saveAuth=function(e){var o=JSON.stringify(e),r={data:Base64.encode(o)};return t({method:"POST",url:n,headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(r)})},e}]);
"use strict";app.controller("customerEmployeeEditCtrl",["$scope","$location","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","SweetAlert","$rootScope","$http","$timeout","$uibModal","flowFactory","cfpLoadingBar","$filter","ListService","$aside","moment","CustomerEmployeeService",function(e,t,o,n,a,i,r,l,c,s,u,d,m,p,y,f,h,g,w,v,b,C){function D(){var t=[{name:"customer_employee_type_rh",criteria:{}},{name:"customer_employee_location",criteria:{customerId:o.customerId}},{name:"customer_parameter",criteria:{customerId:o.customerId,group:"employeesOrganizationalStructure"}}];w.getDataList(t).then(function(t){e.listRh=t.data.data.customer_employee_type_rh,e.locations=t.data.data.customerEmployeeLocation,e.structureOrganizational=t.data.data.employeesOrganizationalStructure&&"1"==t.data.data.employeesOrganizationalStructure.value},function(t){e.status="Unable to load customer data: "+t.message})}e.request={},e.flowConfig={target:"/api/customer-employee/upload",singleFile:!0},e.loading=!0,e.isView=!1,e.isNew=0==e.$parent.currentEmployee,e.customerId=o.customerId,e.tabname=null,e.showAuthorized=!1,e.isOnlyNumber=!0,e.pattern="\\d*",e.dateConfig={culture:"es-CO",format:"dd/MM/yyyy"},e.showAuthorized=d.can("empleado_authorize"),C.setCanAuthorize(e.showAuthorized),null!=e.$parent&&(e.isView="view"==e.$parent.$parent.$parent.editMode),e.arl=d.parameters("arl"),e.afp=d.parameters("afp"),e.eps=d.parameters("eps"),e.eps=d.parameters("eps"),e.genders=d.parameters("gender"),e.professions=d.parameters("employee_profession"),e.contractTypes=d.parameters("employee_contract_type"),e.documentTypes=d.parameters("employee_document_type"),e.docomentTypesAllowLetters=d.parameters("wg_employee_doc_type_allow_letter"),e.workShiftList=d.parameters("work_shifts"),e.extrainfo=e.customer.extraContactInformationList,e.countries=d.countries(),e.states=[],e.towns=[],e.structureOrganizational=!1,e.locations=[],e.departments=[],e.areas=[],e.turns=[];var A=function(){e.employee={id:e.$parent.currentEmployee,customerId:o.customerId,isActive:!1,contractType:null,occupation:"",job:null,workPlace:null,salary:0,isAuthorized:!1,entity:{id:0,documentType:null,documentNumber:"",expeditionPlace:"",expeditionDate:"",firstName:"",lastName:"",birthDate:"",gender:null,profession:null,eps:null,afp:null,arl:null,country:null,state:null,city:null,rh:null,riskLevel:0,neighborhood:"",observation:"",logo:"",details:[],isActive:!1,age:null},location:"",department:"",area:"",turn:"",validityList:[],workShift:null}};e.document={id:0,customerEmployeeId:0,jobId:0,activity:null};var I=d.$on("isAuthorizedChangeInDocument",function(t,o){e.employee.isAuthorized=o.newValue});e.$on("$destroy",function(){I()}),A(),D();var T=function(){var t={};return t.operation="diagnostic",t.customerId=e.customerId,m({method:"POST",url:"api/customer/config-sgsst/workplace/listProcess",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){p(function(){e.workPlaces=t.data.data})})["catch"](function(e){})["finally"](function(){})};if(T(),e.$watch("employee.workPlace",function(t,o,n){e.jobs=[],null==o||angular.equals(t,o)||(e.employee.job=null)}),e.$watch("employee.entity.birthDate",function(){if(null!==e.employee.entity.birthDate){var t=new b(e.employee.entity.birthDate);e.employee.entity.age=b().diff(t,"years",!1)}else e.employee.entity.age=0}),e.onSelectDocumentType=function(){e.pattern="N"==e.employee.entity.documentType.code?"\\d*":"^[a-zA-Z0-9]+$"},e.uploader=new Flow,""==e.employee.entity.logo&&(e.noImage=!0),e.employee.id){var S={id:e.employee.id};m({method:"GET",url:"api/customer-employee",params:S})["catch"](function(e,t){if(403==t){var o=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";u.swal("No Autorizado","No estas autorizado para ver esta información.","error"),p(function(){s.go(o)},3e3)}else 404==t?(u.swal("Información no disponible","Empleado no encontrado","error"),p(function(){s.go("app.clientes.list")})):u.swal("Error","Se ha presentado un error al intentar acceder a la información del cliente","error")}).then(function(t){p(function(){e.employee=t.data.result,C.setLastAuthorization(e.employee.isAuthorized),C.setAuthorization(e.employee.isAuthorized),e.$parent.currentEmployee=e.employee.id,null==e.employee.entity.details||0==e.employee.entity.details.length,null!=e.employee.entity.logo&&null!=e.employee.entity.logo.path?e.noImage=!1:e.noImage=!0,P(),e.onSelectDocumentType(),null!=e.employee.job&&(e.request.job_id=e.employee.job.id),e.changeJob();var o=e.employee.entity.state,n=e.employee.entity.town;e.changeCountry(e.employee.entity.country),e.changeState(o),e.employee.entity.state=o,e.employee.entity.town=n})})["finally"](function(){p(function(){e.loading=!1},400)})}else e.loading=!1;e.removeImage=function(){e.noImage=!0,e.employee.entity.removeLogo=!0,e.employee.entity.logo=null},e.onAuthChange=function(){if(console.log("onAuthChange"),C.setAuthorization(e.employee.isAuthorized),e.employee.reason=null,C.getLastAuthorization()!=C.getAuthorization()){var t=y.open({templateUrl:d.app.views.urlRoot+"modules/customer/employee/customer_employee_authorization_reason_modal.htm",controller:"customerEmployeeAuthorizationModalCtrl",windowTopClass:"top-modal",resolve:{}});t.result.then(function(t){e.employee.reason=t},function(){})}},e.master=e.employee,e.form={submit:function(e){var t=null;if(e.$invalid){var o=null,t=null;for(o in e)"$"!=o[0]&&(null!==t||e[o].$valid||(t=e[o].$name),e[o].$pristine&&(e[o].$dirty=!0));return angular.element(".ng-invalid[name="+t+"]").focus(),void u.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}O()},reset:function(t){e.employee=angular.copy(e.master),t.$setPristine(!0)}};var O=function(){if(e.employee.entity.documentType){if("N"==e.employee.entity.documentType.code&&isNaN(e.employee.entity.documentNumber))return void u.swal("El formulario contiene errores!","El campo Número de Documento debe contener caracteres numéricos.","error");var t=/^[a-zA-Z0-9]+$/;if("A"==e.employee.entity.documentType.code&&!t.test(e.employee.entity.documentNumber))return void u.swal("El formulario contiene errores!","El campo Número de Documento debe contener caracteres alfanuméricos.","error")}var o={},a=JSON.stringify(e.employee);return o.data=Base64.encode(a),m({method:"POST",url:"api/customer-employee/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(t){u.swal("Registro","La información ha sido guardada satisfactoriamente","success"),e.uploader.flow.opts.query.id=t.data.result.entity.id,e.uploader.flow.resume(),p(function(){e.isNew&&null!=e.$parent&&(e.$parent.navToSection("edit","edit",t.data.result.id),e.$parent.currentEmployee=t.data.result.id),e.employee=t.data.result,C.setLastAuthorization(e.employee.isAuthorized),C.setAuthorization(e.employee.isAuthorized),d.$emit("isAuthorizedChangeInBasic",{newValue:e.employee.isAuthorized}),null==e.employee.entity.details||0==e.employee.entity.details.length,null!=e.employee.entity.logo&&null!=e.employee.entity.logo.path?e.noImage=!1:e.noImage=!0,P();var o=e.employee.entity.state,n=e.employee.entity.town;e.changeCountry(e.employee.entity.country),e.changeState(o),e.employee.entity.state=o,e.employee.entity.town=n,null!=e.employee.job&&(e.request.job_id=e.employee.job.id),e.changeJob()})})["catch"](function(e){n.error(e),u.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){p(function(){if(e.uploader.flow.files.length){var t=_(e.uploader.flow.files[0].file);_(t)}},1e3)})},_=function(t){var o=new FileReader;o.onloadend=function(){e.uploader.flow.cancel(),e.employee.entity.logo={path:o.result},e.noImage=!1},t&&o.readAsDataURL(t)};e.changeCountry=function(t,o){if(null!=t){e.states=[],e.towns=[],e.employee.entity.state=null,e.employee.entity.town=null;var n={cid:t.id};m({method:"GET",url:"api/states",params:n})["catch"](function(e,t){}).then(function(t){e.states=t.data.result,e.towns=[]})["finally"](function(){})}},e.changeState=function(t,o){e.towns=[];var n={sid:t.id};e.employee.entity.town=null,m({method:"GET",url:"api/towns",params:n}).then(function(t){e.towns=t.data.result})["finally"](function(){})},e.cancelEdition=function(t){null!=e.$parent&&e.$parent.navToSection("list","list")},e.onAddValidity=function(){p(function(){null==e.employee.validityList&&(e.employee.validityList=[]),e.employee.validityList.push({id:0,startDate:"",endDate:"",description:""})})},e.onRemoveValidity=function(t){u.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(o){o?p(function(){var o=e.employee.validityList[t];if(0!=o.id){var a={};a.id=o.id,m({method:"POST",url:"api/customer-employee/validity/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(o){swal("Eliminado","Registro eliminado satisfactoriamente","info"),e.employee.validityList.splice(t,1)})["catch"](function(e){n.error(e),u.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})},e.onAddInfoDetail=function(){p(function(){null==e.employee.entity.details&&(e.employee.entity.details=[]),e.employee.entity.details.push({id:0,value:"",type:null})})},e.onRemoveInfoDetail=function(t){u.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(o){o?p(function(){var o=e.employee.entity.details[t];if(e.employee.entity.details.splice(t,1),0!=o.id){var a={};a.id=o.id,m({method:"POST",url:"api/customer-employee-contact/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){n.error(e),u.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})},e.changeJob=function(t,o){p(function(){if(null!=e.employee.job&&0!=e.employee.id){e.currentJobId=e.employee.job.id,e.request.job_id=e.currentJobId;var t={};return t.id=e.employee.id,t.job_id=e.currentJobId,m({method:"POST",url:"api/customer-employee/critical-activity/duplicate",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){e.reloadData()})["catch"](function(e){n.error(e),c.pop("error","Error","Error guardando el registro. Por favor verifique los datos ingresados!")})["finally"](function(){})}},400)},e.onAddActivity=function(){if(null==e.employee.job)return void u.swal("El formulario contiene errores!","Debe seleccionar un cargo ","error");var t=v.open({templateUrl:d.app.views.urlRoot+"modules/customer/employee/customer_employee_critical_activity_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideCustomerEmployeeCriticalActivityListCtrl",scope:e,resolve:{criteria:function(){return{customerId:o.customerId,jobId:e.employee.job.id,id:e.employee.id}}}});t.result.then(function(e){e&&e.length>0&&E(e)},function(){n.info("Modal dismissed at: "+new Date)})};var E=function(t){if(null==e.employee.job)return void u.swal("El formulario contiene errores!","Debe seleccionar un cargo ","error");var o={customerEmployeeId:e.employee.id,activities:t,jobId:e.employee.job.id},a={},i=JSON.stringify(o);return a.data=Base64.encode(i),m({method:"POST",url:"api/customer-employee-critical-activity/bulk",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(t){p(function(){u.swal("Registro","La información ha sido guardada satisfactoriamente","success"),e.reloadData()})})["catch"](function(e){n.error(e),u.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};e.dtInstanceCriticalActivity={},e.dtOptionsCriticalActivity=a.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.operation="document",t.customerEmployeeId=e.employee.id,t.customerId=e.customerId,t.jobId=e.currentJobId?e.currentJobId:0,JSON.stringify(t)},url:"api/customer-employee-critical-activity",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){k()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,o,n){l(angular.element(t).contents())(e)}),e.dtColumnsCriticalActivity=[i.newColumn(null).withTitle("Acciones").withOption("width",200).notSortable().renderWith(function(t,o,n,a){var i=null!=t.document?t.document.path:"",r="",l='<a target="_self" class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Descargar anexo" data-id="'+t.id+'" data-url="'+i+'" >   <i class="fa fa-download"></i></a> ',c='<a class="btn btn-info btn-xs viewRow lnk" target="_blank" href="'+i+'" uib-tooltip="Abrir anexo" data-id="'+t.id+'" >   <i class="fa fa-folder-open-o"></i></a> ',s='<a class="btn btn-light-red btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+t.id+'" data-criticalActivityId="'+t.criticalActivityId+'" >   <i class="fa fa-trash-o"></i></a> ',u=!e.isView;return d.can("empleado_documento_open")&&(r+=c),d.can("empleado_documento_download")&&(r+=l),d.can("empleado_documento_invalidate")&&"Vigente"==t.status&&(r+=s),u?s:""}),i.newColumn("job").withTitle("Cargo"),i.newColumn("activity").withTitle("Actividad Crítica")];var k=function(){$("#dtCriticalActivity a.delRow").on("click",function(){var t=$(this).data("criticalactivityid");u.swal({title:"Está seguro?",text:"El registro se eliminará.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(o){if(o){var a={};return a.id=t,m({method:"POST",url:"api/customer-employee/critical-activity/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(t){p(function(){u.swal("Operación exitosa","Registro eliminado satisfactoriamente","success"),e.reloadData()})})["catch"](function(e){n.error(e),u.swal("Error de guardado","Error eliminado el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})}swal("Cancelación","La operación ha sido cancelada","error")})})};e.dtInstanceCriticalActivityCallback=function(t){e.dtInstanceCriticalActivity=t},e.reloadData=function(){e.dtInstanceCriticalActivity.reloadData()};var P=function(){null!=e.employee.entity.expeditionDate&&(e.employee.entity.expeditionDate=new Date(e.employee.entity.expeditionDate.date)),null!=e.employee.entity.birthDate&&(e.employee.entity.birthDate=new Date(e.employee.entity.birthDate.date)),e.employee.validityList.length>0&&angular.forEach(e.employee.validityList,function(e){null!=e.startDate&&(e.startDate=new Date(e.startDate.date)),null!=e.endDate&&(e.endDate=new Date(e.endDate.date))})};e.onSearchJob=function(){if(!e.employee.workPlace)return void c.pop("error","Validación","Debe seleccionar un centro de trabajo válido");var t=v.open({templateUrl:d.app.views.urlRoot+"modules/common/modals/data_table_list_modal.htm",placement:"right",size:"lg",backdrop:!0,resolve:{workPlace:function(){return e.employee.workPlace}},controller:"ModalInstanceSideCustomerEmployeeJobListCtrl",scope:e});t.result.then(function(t){void 0!==e.jobs&&null!=e.jobs||(e.jobs=[]);var o=g("filter")(e.jobs,{id:t.id});0==o.length&&e.jobs.push(t),e.employee.job=t,e.changeJob()},function(){})},e.onSelectLocation=function(){e.employee.department=null,e.employee.area=null,e.employee.turn=null,e.departments=[],e.areas=[],e.turns=[];var t=[{name:"customer_employee_departments_by_location",criteria:{customerId:o.customerId,location:e.employee.location.value}}];w.getDataList(t).then(function(t){e.departments=t.data.data.customerEmployeeDepartmentsByLocation},function(t){e.status="Unable to load customer data: "+t.message})},e.onSelectDepartment=function(){e.employee.area=null,e.employee.turn=null,e.areas=[],e.turns=[];var t=[{name:"customer_employee_areas_by_department",criteria:{customerId:o.customerId,location:e.employee.location.value,department:e.employee.department.value}}];w.getDataList(t).then(function(t){e.areas=t.data.data.customerEmployeeAreasByDepartment},function(t){e.status="Unable to load customer data: "+t.message})},e.onSelectArea=function(){e.employee.turn=null,e.turns=[];var t=[{name:"customer_employee_turns_by_area",criteria:{customerId:o.customerId,location:e.employee.location.value,department:e.employee.department.value,area:e.employee.area.value}}];w.getDataList(t).then(function(t){e.turns=t.data.data.customerEmployeeTurnsByArea},function(t){e.status="Unable to load customer data: "+t.message})}}]),app.controller("ModalInstanceSideCustomerEmployeeJobListCtrl",["$rootScope","$stateParams","$scope","workPlace","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile",function(e,t,o,n,a,i,r,l,c,s,u,d,m,p,y){o.title="CARGOS DISPONIBLES",o.entity={},o.onCloseModal=function(){a.close(o.entity)},o.onCancel=function(){a.dismiss("cancel")};var f=function(e){if(0!=e){var t={id:e};c({method:"GET",url:"api/customer-config-job",params:t})["catch"](function(e){}).then(function(e){r(function(){o.entity=e.data.result})})["finally"](function(){r(function(){o.onCloseModal()},400)})}else o.loading=!1};o.dtInstanceCommonDataTableList={},o.dtOptionsCommonDataTableList=p.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerId=t.customerId,e.workPlaceId=n.id,JSON.stringify(e)},url:"api/customer-config-job",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){h()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,t,n){y(angular.element(e).contents())(o)}),o.dtColumnsCommonDataTableList=[m.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,t,o,n){var a="",i="",r='<a class="btn btn-success btn-xs editRow lnk" href="#" uib-tooltip="Adicionar"  data-id="'+e.id+'"'+i+' >   <i class="fa fa-plus-square"></i></a> ';return a+=r}),m.newColumn("work_place").withTitle("Centro de Trabajo").withOption("width",200),m.newColumn("macro_process").withTitle("Macro Proceso"),m.newColumn("process").withTitle("Proceso"),m.newColumn("job").withTitle("Cargo")];var h=function(){$("#dtCommonDataTableList a.editRow").on("click",function(){var e=$(this).data("id");f(e)})};o.dtInstanceCommonDataTableListCallback=function(e){o.dtInstanceCommonDataTableList=e},o.reloadData=function(){o.dtInstanceCommonDataTableList.reloadData()}}]),app.controller("ModalInstanceSideCustomerEmployeeCriticalActivityListCtrl",["$rootScope","$stateParams","$scope","criteria","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile",function(e,t,o,n,a,i,r,l,c,s,u,d,m,p,y){o.onCloseModal=function(){a.close()},o.onCancel=function(){a.dismiss("cancel")},o.canShowDataTable=!1,o.filter={selectedType:null},o.toggle={isChecked:!1,selectAll:!1},o.records={hasSelected:!1,countSelected:0,countSelectedAll:0};var f={},h={},g={},w=null,v="api/customer-employee-critical-activity/available",b=function(){var e=[m.newColumn(null).withOption("width",30).notSortable().withClass("center").renderWith(function(e,t,o,n){var a="",i=f[e.id].selected,r=i?"checked":"";return a='<div class="checkbox clip-check check-danger "><input class="selectedRow" type="checkbox" id="chk_employee_document_select_'+e.id+'" data-id="'+e.id+'" '+r+' ><label class="padding-left-10" for="chk_employee_document_select_'+e.id+'"> </label></div>'})];return e.push(C("job","Cargo","",200)),e.push(C("activity","Actividad Crítica","",200)),e},C=function(e,t,o,n){return m.newColumn(e).withTitle(t).withOption("defaultContent",o).withOption("width",n)},D=function(){o.canShowDataTable=!0;var e="";o.dtOptionsCustomerEmployeeCiriticalActivity=p.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerId=t.customerId,e.customerEmployeeId=n.id,e.jobId=n.jobId,w=e,JSON.stringify(e)},dataSrc:function(t){return g=t.data.map(function(e,t,o){return e.id}),h=t.extra,angular.forEach(h,function(e,t){void 0!==f[e]&&null!==f[e]||(f[e]={selected:!1})}),o.records.currentPage=g.length,o.records.total=h.length,e!==w.search.value&&(o.toggle.isChecked=!1,o.toggle.selectAll=!1,I(h,o.toggle.isChecked,!0),e=w.search.value),t.data},url:v,contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){A()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,t,n){y(angular.element(e).contents())(o)}),o.dtColumnsCustomerEmployeeCiriticalActivity=b()},A=function(){angular.element("#dtCustomerEmployeeCiriticalActivity input.selectedRow").on("change",function(){var e=angular.element(this).data("id");"selectedRow"==this.className&&(f[e].selected=this.checked),r(function(){var e=0;angular.forEach(f,function(t,o){e+=t.selected?1:0}),o.records.hasSelected=e>0,o.records.countSelected=e},100)})};o.dtInstanceCustomerEmployeeCiriticalActivityCallback=function(e){o.dtInstanceCustomerEmployeeCiriticalActivity=e,o.dtInstanceCustomerEmployeeCiriticalActivity.DataTable.on("page",function(){r(function(){o.toggle.isChecked=o.toggle.selectAll},300)}),o.dtInstanceCustomerEmployeeCiriticalActivity.DataTable.on("order",function(){r(function(){o.toggle.isChecked=o.toggle.selectAll},300)})},o.reloadData=function(){null!=o.dtInstanceCustomerEmployeeCiriticalActivity&&o.dtInstanceCustomerEmployeeCiriticalActivity.reloadData(null,!1)},o.onSelectType=function(){o.reloadData(),f={},o.toggle.isChecked=!1,o.toggle.selectAll=!1,o.records.hasSelected=!1,o.records.countSelected=0},o.onAccept=function(){var e=Object.keys(f).filter(function(e){return f[e].selected}).map(function(e){return e});a.close(e)},o.onToggle=function(){o.toggle.isChecked=!o.toggle.isChecked,I(g,o.toggle.isChecked)},o.onSelectCurrentPage=function(){o.toggle.isChecked=!0,o.toggle.selectAll&&(I(h,!1),o.toggle.selectAll=!1),I(g,o.toggle.isChecked)},o.onSelectAll=function(){o.toggle.isChecked=!0,o.toggle.selectAll=!0,I(h,o.toggle.selectAll)},o.onDeselectAll=function(){o.toggle.isChecked=!1,o.toggle.selectAll=!1,I(h,o.toggle.selectAll)};var I=function(e,t,n){var a=0;angular.forEach(f,function(o,i){void 0!==n&&n&&(f[i].selected=!1),e.indexOf(parseInt(i))!==-1&&(f[i].selected=t),a+=f[i].selected?1:0});var i=angular.element(".selectedRow");angular.forEach(i,function(e,t){var o=angular.element(e).data("id");angular.element(e).prop("checked",f[o].selected)}),o.records.hasSelected=a>0,o.records.countSelected=a};D()}]);
"use strict";app.controller("customerEmployeeListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$aside","ngNotify","ListService","$translate","$analytics","$localStorage","$uibModal",function(e,t,o,n,i,a,r,l,s,c,u,d,m,p,f,h,w,y,v,g){function b(){var o=[{name:"criteria_operators",value:null},{name:"criteria_conditions",value:null},{name:"customer_employee_custom_filter_field",value:null},{name:"customer_employee_backup_recovery",value:null},{name:"export_url",value:null},{name:"customer_parameter",criteria:{customerId:t.customerId,group:"employeesOrganizationalStructure"}}];h.getDataList(o).then(function(t){I=t.data.data.exportUrl.item,e.criteria=t.data.data.criteriaOperatorList,e.conditions=t.data.data.criteriaConditionList,e.audit.fields=t.data.data.customerEmployeeCustomFilterField,e.backupRecoveryEntities=t.data.data.customer_employee_backup_recovery.map(function(e){return{name:e.item,value:e.value,isActive:!1}})},function(t){e.status="Unable to load customer data: "+t.message})}var C=o,I="";e.showList=!0,e.backupRecoveryEntities=[],e.currentTab="",e.showImportOrganizationalStructure=!1,e.audit={fields:[],filters:[]},e.employee={id:0},e.canShowMoreActionButton=(c.can("empleado_export_excel")||c.can("empleado_export_pdf")||c.can("empleado_export_document"))&&c.canEditRoot,b(),e.addFilter=function(){e.audit.filters.push({id:0,field:null,criteria:e.criteria.length>0?e.criteria[1]:null,condition:e.conditions.length>0?e.conditions[0]:null,value:""})};var A="criteria-list-employe-"+window.currentUser.id+"-"+t.customerId;v[A]&&(e.audit.filters=v[A]),e.onFilter=function(){v[A]=e.audit.filters,v.customerId=t.customerId,e.reloadData()},e.removeFilter=function(t){e.audit.filters.splice(t,1)},e.onCleanFilter=function(){e.audit.filters=[],v[A]=[],e.reloadData()},e.onCancel=function(){e.audit.filters=[],e.reloadData()},e.onToggleShowList=function(){e.showList=!e.showList};var E="customerEmployeeList-"+window.currentUser.id+"-"+t.customerId;e.dtInstanceEmployee={},e.dtOptionsEmployee=n.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(o){return o.customerId=t.customerId,angular.isDefined(e.audit)&&angular.isDefined(e.audit.filters)&&(o.filter={filters:$.map(e.audit.filters,function(e){return{field:e.field.name,operator:e.criteria.value,condition:e.condition.value,value:e.value}})}),JSON.stringify(o)},url:"api/customer-employee-v2",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("stateSave",!0).withOption("stateSaveCallback",function(e,t){v[E]=t}).withOption("stateLoadCallback",function(){return v[E]}).withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){D()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,o,n){r(angular.element(t).contents())(e)}),e.dtColumnsEmployee=[i.newColumn(null).withTitle("Acciones").withOption("width",180).notSortable().renderWith(function(e,t,o,n){var i="",a="",r='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar"  data-id="'+e.id+'" >   <i class="fa fa-edit"></i></a> ',l='<a class="btn btn-info btn-xs viewRow lnk" href="#" uib-tooltip="Ver" data-id="'+e.id+'" >   <i class="fa fa-eye"></i></a> ',s='<a class="btn btn-danger btn-xs inactiveRow lnk" href="#" uib-tooltip="Inactivar" data-id="'+e.id+'" >   <i class="fa fa-ban"></i></a> ',u='<a class="btn btn-dark-red btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+e.id+'" >   <i class="fa fa-trash-o"></i></a> ',d='<a class="btn btn-success btn-xs uploadRow lnk" href="#"  uib-tooltip="Documentos de Soporte Obligatorios" data-id="'+e.id+'"'+a+' >   <i class="fa fa-paperclip"></i></a> ',m=' | <a class="btn btn-dark-azure btn btn-xs downloadRow lnk" href="#" uib-tooltip="Descargar Anexos" data-id="'+e.id+'" >   <i class="fa fa-download"></i></a>';return c.can("empleado_view")&&(i+=l),c.can("empleado_create")&&c.canEditRoot&&(i+=r),c.can("empleado_delete")&&c.canEditRoot&&(i+=s),c.can("empleado_destroy")&&c.canEditRoot&&(i+=u),c.can("empleado_documento_open")&&c.canEditRoot&&(i+=d),i+(e.countAttachment>0?m:"")}),i.newColumn("documentNumber").withTitle("Número Identificación").withOption("width",200),i.newColumn("firstName").withTitle("Nombre").withOption("width",200),i.newColumn("lastName").withTitle("Apellidos").withOption("width",200),i.newColumn("workPlace").withTitle(w.instant("grid.employee.WORK-PLACE")).withOption("width",200),i.newColumn("job").withTitle("Cargo").withOption("width",200),i.newColumn("neighborhood").withTitle("Centro de Costos").withOption("width",200),i.newColumn(null).withTitle("Anexos").withOption("width",200).renderWith(function(e,t,o,n){var i="label label-warning",a=0;null==e.countAttachment&&void 0==e.countAttachment||(a=e.countAttachment);var r='<span class="'+i+'">'+a+" Anexos </span>";return r}),i.newColumn(null).withTitle("Estado").withOption("width",200).renderWith(function(e,t,o,n){var i="label label-danger",a="Inactivo";null==e.isActiveCode&&void 0==e.isActiveCode||("Activo"==e.isActiveCode?(i="label label-success",a="Activo"):(i="label label-danger",a="Inactivo"));var r='<span class="'+i+'">'+a+"</span>";return r}),i.newColumn(null).withTitle("Autorización").withOption("width",200).renderWith(function(e,t,o,n){var i="label label-danger",a=e.isAuthorized;null==e.isAuthorized&&void 0==e.isAuthorized||(i="Autorizado"==e.isAuthorized?"label label-success":"No Autorizado"==e.isAuthorized?"label label-danger":"label label-info");var r='<span class="'+i+'">'+a+"</span>";return r})];var D=function(){$("#dtCustomerEmployee a.editRow").on("click",function(){var t=$(this).data("id");e.editEmployee(t)}),$("#dtCustomerEmployee a.viewRow").on("click",function(){var t=$(this).data("id");e.viewEmployee(t)}),$("#dtCustomerEmployee a.uploadRow").on("click",function(){var t=$(this).data("id");e.employee.id=t,e.onAddDocument()}),$("#dtCustomerEmployee a.downloadRow").on("click",function(){var t=$(this).data("id");e.onDownloadAttachment(t)}),$("#dtCustomerEmployee a.inactiveRow").on("click",function(){var t=$(this).data("id");C.info("intenta eliminar el registro: "+t),m.swal({title:"Está seguro?",text:"Inactivará el empleado seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, inactivar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(n){if(n){var i={};i.id=t,d({method:"POST",url:"api/customer-employee/inactive",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(e){swal("Inactivado","Registro inactivado satisfactoriamente","info")})["catch"](function(e){o.error(e),m.swal("Error en la inactivación","Se ha presentado un error durante la inactivación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){e.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})}),$("#dtCustomerEmployee a.delRow").on("click",function(){var t=$(this).data("id");m.swal({title:"Está seguro?",text:"Eliminará el empleado seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(n){if(n){var i={};i.id=t,d({method:"POST",url:"api/customer-employee/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(e){if(e.data.result.isSuccess)swal("Eliminación","Registro eliminado satisfactoriamente","info");else{var t=e.data.result.messages.map(function(e){return"<li>"+e+"</li>"});m.swal({html:!0,type:"error",title:"No es posible eliminar el registro, tiene relación en los siguientes módulos:",text:t.join("")})}})["catch"](function(e){o.error(e),m.swal("Eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){e.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};e.dtInstanceEmployeeCallback=function(t){e.dtInstanceEmployee=t},e.reloadData=function(){e.dtInstanceEmployee.reloadData()},e.editEmployee=function(t){null!=e.$parent&&("bolivar"==c.app.instance&&y.eventTrack("Clic módulo",{category:"Clientes",label:"Empleados",action:"Editar Empleado"}),e.$parent.navToSection("edit","edit",t))},e.viewEmployee=function(t){null!=e.$parent&&("bolivar"==c.app.instance&&y.eventTrack("Clic módulo",{category:"Clientes",label:"Empleados",action:"Ver Empleado"}),e.$parent.navToSection("edit","view",t))},e.onCreateNew=function(){null!=e.$parent&&("bolivar"==c.app.instance&&y.eventTrack("Clic módulo",{category:"Clientes",label:"Empleados",action:"Crear Empleado"}),e.$parent.navToSection("edit","edit",0))},e.switchTab=function(t,o,n){"bolivar"==c.app.instance&&y.eventTrack("Clic módulo",{category:"Clientes",label:n,action:"Abre Pestaña"}),e.currentTab=t},e.onUpload=function(){var t=p.open({templateUrl:c.app.views.urlRoot+"modules/customer/employee/customer_employee_import_modal.htm",placement:"bottom",size:"lg",backdrop:!0,controller:"ModalInstanceSideUploadEmployeeCtrl",scope:e});t.result.then(function(t){t&&t.sessionId&&(c.isAuthorizationTemplate=t.isAuthorizationTemplate,c.hasCustomerEmployeeId=t.hasCustomerEmployeeId,null!=e.$parent&&e.$parent.navToSection("stagingEmployee","stagingEmployee",t.sessionId))})},e.onUploadDemographic=function(){var t=p.open({templateUrl:c.app.views.urlRoot+"modules/customer/employee/customer_employee_import_modal.htm",placement:"bottom",size:"lg",backdrop:!0,controller:"ModalInstanceSideUploadEmployeeDemographicCtrl",scope:e});t.result.then(function(t){t&&t.sessionId&&null!=e.$parent&&e.$parent.navToSection("staging","staging",t.sessionId)})},e.onAddDocument=function(){var t=p.open({templateUrl:c.app.views.urlRoot+"modules/customer/employee/customer_employee_upload_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideUploadEmployeeDocumentCtrl",scope:e,resolve:{employee:function(){return e.employee}}});t.result.then(function(){e.reloadData()})},e.onExportExcel=function(){f.set("El archivo se está generando.",{position:"bottom",sticky:!0,button:!1,html:!0});var o={id:t.customerId,audit:e.audit},n={},i=JSON.stringify(o);n.data=Base64.encode(i),d({method:"POST",url:I+"api/v1/customer-employee-export",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(e){var t=I+"storage/"+e.data.filename,o='<a class="btn btn-wide btn-default" href="'+t+'" target="_self"><i class="glyphicon glyphicon-download"></i> Descargar el archivo</a>';f.set(o,{position:"bottom",sticky:!0,type:"success",button:!0,html:!0})})["catch"](function(e){f.set(e.data.message,{position:"bottom",sticky:!0,type:"error",button:!0,html:!0})})["finally"](function(){})},e.onExportAuthorizationTemplate=function(){f.set("El archivo se está generando.",{position:"bottom",sticky:!0,button:!1,html:!0});var o={id:t.customerId,audit:e.audit},n={},i=JSON.stringify(o);n.data=Base64.encode(i),d({method:"POST",url:I+"api/v1/customer-employee-authorization-export",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(e){var t=I+"storage/"+e.data.filename,o='<a class="btn btn-wide btn-default" href="'+t+'" target="_self"><i class="glyphicon glyphicon-download"></i> Descargar el archivo</a>';f.set(o,{position:"bottom",sticky:!0,type:"success",button:!0,html:!0})})["catch"](function(e){f.set(e.data.message,{position:"bottom",sticky:!0,type:"error",button:!0,html:!0})})["finally"](function(){})},e.onExportTemplate=function(){f.set('El archivo se está generando. <uib-progressbar value="100" class="progress-striped progress-xs active" type="info"></uib-progressbar>',{position:"bottom",sticky:!0,button:!1,html:!0});var o={id:t.customerId,audit:e.audit},n={},i=JSON.stringify(o);n.data=Base64.encode(i),d({method:"POST",url:I+"api/v1/customer-employee-export-template",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(e){var t=I+"storage/"+e.data.filename,o='<a class="btn btn-wide btn-default" href="'+t+'" target="_self"><i class="glyphicon glyphicon-download"></i> Descargar el archivo</a>';f.set(o,{position:"bottom",sticky:!0,type:"success",button:!0,html:!0})})["catch"](function(e){f.set(e.data.message,{position:"bottom",sticky:!0,type:"error",button:!0,html:!0})})["finally"](function(){})},e.onExportPdf=function(){angular.element("#downloadDocument")[0].src="api/customer-employee/exportPdf?id="+t.customerId+"&data="+Base64.encode(JSON.stringify(e.audit))},e.onExportDocument=function(){var e=g.open({templateUrl:c.app.views.urlRoot+"modules/common/modals/document_filter_modal.htm",controller:"ModalInstanceSideCustomerEmployeeDownloadAttachmentCtrl",windowTopClass:"top-modal",resolve:{title:function(){return"Descargar anexos de los empleados"}}});e.result.then(function(){},function(){})},e.onDownloadAttachment=function(e){f.set("El archivo se está generando.",{position:"bottom",sticky:!0,button:!1,html:!0});var o={customerId:t.customerId,customerEmployeeId:e},n={},i=JSON.stringify(o);n.data=Base64.encode(i),d({method:"POST",url:"api/customer-employee-document/export",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(e){var t=(e.data.path+e.data.filename,'<div class="row"><div class="col-sm-5"> </div> <div class="col-sm-6 text-left">Por favor espere y verifique su correo y la bandeja de mensajes!</div> </div>');f.set(t,{position:"bottom",sticky:!0,type:"info",button:!0,html:!0})})["catch"](function(e){f.set(e.data.message,{position:"bottom",sticky:!0,type:"error",button:!0,html:!0})})["finally"](function(){})},e.onImportOrganizationalStructure=function(){var t=p.open({templateUrl:c.app.views.urlRoot+"modules/common/modals/import_modal.htm",placement:"bottom",size:"lg",backdrop:!0,controller:"ModalInstanceSideImportEmployeeOrganizationalStructureCtrl",scope:e});t.result.then(function(t){e.reloadData()})},e.onConfigDocumentType=function(){var t=p.open({templateUrl:c.app.views.urlRoot+"modules/customer/employee/customer_employee_document_type_modal.htm",placement:"bottom",size:"lg",backdrop:!0,controller:"ModalInstanceSideCustomerDocumentTypeCtrl",scope:e});t.result.then(function(t){e.reloadData()})}}]),app.controller("ModalInstanceSideUploadEmployeeCtrl",["$rootScope","$stateParams","$scope","FileUploader","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","ngNotify","ListService",function(e,t,o,n,i,a,r,l,s,c,u,d){function m(){var e=[{name:"export_url",value:null}];d.getDataList(e).then(function(e){p=e.data.data.exportUrl.item,h.url=p+"api/v1/customer-employee-import",o.uploader.url=p+"api/v1/customer-employee-import"},function(e){o.status="Unable to load customer data: "+e.message})}var p="",f=null,h=o.uploader=new n({url:p+"api/v1/customer-employee-import",formData:[]});m(),o.title="Importar empleados",o.buttonDownloadTitle="Plantilla Creación de Empleados",o.download=function(){angular.element("#downloadDocument")[0].src="api/customer-employee-document/download-template"},h.filters.push({name:"customFilter",fn:function(e,t){return this.queue.length<10}}),h.onWhenAddingFileFailed=function(e,t,o){console.info("onWhenAddingFileFailed",e,t,o)},h.onAfterAddingFile=function(e){console.info("onAfterAddingFile",e)},h.onAfterAddingAll=function(e){console.info("onAfterAddingAll",e)},h.onBeforeUploadItem=function(o){console.info("onBeforeUploadItem",o);var n={id:t.customerId,userId:e.currentUser().id};o.formData.push(n)},h.onProgressItem=function(e,t){console.info("onProgressItem",e,t)},h.onProgressAll=function(e){console.info("onProgressAll",e)},h.onSuccessItem=function(e,t,o,n){console.info("onSuccessItem",e,t,o,n)},h.onErrorItem=function(e,t,o,n){console.info("onErrorItem",e,t,o,n)},h.onCancelItem=function(e,t,o,n){console.info("onCancelItem",e,t,o,n)},h.onCompleteItem=function(e,t,o,n){f=t},h.onCompleteAll=function(){i.close(f)}}]),app.controller("ModalInstanceSideUploadEmployeeDemographicCtrl",["$rootScope","$stateParams","$scope","FileUploader","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","ngNotify","ListService",function(e,t,o,n,i,a,r,l,s,c,u,d){function m(){var e=[{name:"export_url",value:null}];d.getDataList(e).then(function(e){p=e.data.data.exportUrl.item,h.url=p+"api/v1/customer-employee-demographic-import",o.uploader.url=p+"api/v1/customer-employee-demographic-import"},function(e){o.status="Unable to load customer data: "+e.message})}var p="",f=null,h=o.uploader=new n({url:p+"api/v1/customer-employee-demographic-import",formData:[]});o.title="Importar Perfíl Sociodemográfico",o.buttonDownloadTitle="Plantilla Perfíl Sociodemográfico",m(),o.download=function(){angular.element("#downloadDocument")[0].src="api/customer-employee-demographic-staging/download-template"},h.filters.push({name:"customFilter",fn:function(e,t){return this.queue.length<10}}),h.onBeforeUploadItem=function(e){var o={id:t.customerId};e.formData.push(o)},h.onCompleteItem=function(e,t,o,n){f=t},h.onCompleteAll=function(){i.close(f)}}]),app.controller("ModalInstanceSideUploadEmployeeDocumentCtrl",["$stateParams","$scope","FileUploader","$uibModalInstance","employee","DTOptionsBuilder","DTColumnBuilder","$compile","$log","$timeout","SweetAlert","$http","toaster",function(e,t,o,n,i,a,r,l,s,c,u,d,m){var p=t.uploader=new o({url:"api/customer-employee/import",formData:[]});p.filters.push({name:"customFilter",fn:function(e,t){return this.queue.length<10}}),p.onWhenAddingFileFailed=function(e,t,o){console.info("onWhenAddingFileFailed",e,t,o)},p.onAfterAddingFile=function(e){console.info("onAfterAddingFile",e)},p.onAfterAddingAll=function(e){console.info("onAfterAddingAll",e)},p.onBeforeUploadItem=function(t){console.info("onBeforeUploadItem",t);var o={id:e.customerId};t.formData.push(o)},p.onProgressItem=function(e,t){console.info("onProgressItem",e,t)},p.onProgressAll=function(e){console.info("onProgressAll",e)},p.onSuccessItem=function(e,t,o,n){console.info("onSuccessItem",e,t,o,n)},p.onErrorItem=function(e,t,o,n){console.info("onErrorItem",e,t,o,n)},p.onCancelItem=function(e,t,o,n){console.info("onCancelItem",e,t,o,n)},p.onCompleteItem=function(e,t,o,n){console.info("onCompleteItem",e,t,o,n)},p.onCompleteAll=function(){console.info("onCompleteAll"),n.close(1)};var f={};f.operation="document",f.customer_employee_id=i.id,t.dtInstanceUploadEmployeeDocument={},t.dtOptionsUploadEmployeeDocument=a.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:f,url:"api/customer-employee/document/required",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,o,n){l(angular.element(e).contents())(t)}),t.dtColumnsUploadEmployeeDocument=[r.newColumn("type").withTitle("Tipo Documento").withOption("width",200),r.newColumn(null).withTitle("Requerido").withOption("width",200).notSortable().renderWith(function(e,t,o,n){var i="",a=1==e.isRequired?"checked":"",r=1==e.isRequired?"Si":"No",l='<div class="checkbox clip-check check-success "><input class="editRow" ng-disabled="true" type="checkbox" id="chk_'+e.id+'" data-id="'+e.id+'" '+a+' ><label for="chk_'+e.id+'">'+r+"</label></div>";return i+=l}).notSortable(),r.newColumn(null).withTitle("Diligenciado").withOption("width",200).notSortable().renderWith(function(e,t,o,n){var i="",a=1==e.isApproved?"checked":"",r=1==e.isApproved?"Si":"No",l='<div class="checkbox clip-check check-success "><input class="editRow" ng-disabled="true" type="checkbox" id="chk_'+e.id+'" data-id="'+e.id+'" '+a+' ><label for="chk_'+e.id+'">'+r+"</label></div>";return i+=l}).notSortable(),r.newColumn(null).withTitle("Anexos").withOption("width",200).renderWith(function(e,t,o,n){var i="label label-warning",a=0;null==e.quantity&&void 0==e.quantity||(a=e.quantity);var r='<span class="'+i+'">'+a+" Anexos </span>";return r})]}]),app.controller("ModalInstanceSideImportEmployeeOrganizationalStructureCtrl",["$rootScope","$stateParams","$scope","FileUploader","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","ngNotify","ListService",function(e,t,o,n,i,a,r,l,s,c,u,d){function m(){var e=[{name:"export_url",value:null}];d.getDataList(e).then(function(e){p=e.data.data.exportUrl.item,h.url=p+"api/v1/customer-employee-import-organizational-structure",o.uploader.url=p+"api/v1/customer-employee-import-organizational-structure"},function(e){o.status="Unable to load customer data: "+e.message})}var p="",f=null;o.showTemplate=!0;var h=o.uploader=new n({url:p+"api/v1/customer-employee-import-organizational-structure",formData:[{customerId:t.customerId}]});m(),o.download=function(){jQuery("#downloadDocument")[0].src="api/event-customer-employee/download-template-import-organizational-structure?customerId="+t.customerId},h.filters.push({name:"customFilter",fn:function(e,t){return this.queue.length<10}}),h.onWhenAddingFileFailed=function(e,t,o){console.info("onWhenAddingFileFailed",e,t,o)},h.onAfterAddingFile=function(e){console.info("onAfterAddingFile",e)},h.onAfterAddingAll=function(e){console.info("onAfterAddingAll",e)},h.onBeforeUploadItem=function(e){console.info("onBeforeUploadItem",e);var o={id:t.customerId};e.formData.push(o)},h.onProgressItem=function(e,t){console.info("onProgressItem",e,t)},h.onProgressAll=function(e){console.info("onProgressAll",e)},h.onSuccessItem=function(e,t,o,n){console.info("onSuccessItem",e,t,o,n)},h.onErrorItem=function(e,t,o,n){console.info("onErrorItem",e,t,o,n)},h.onCancelItem=function(e,t,o,n){console.info("onCancelItem",e,t,o,n)},h.onCompleteItem=function(e,t,o,n){console.info("onCompleteItem",e,t,o,n),f=t},h.onCompleteAll=function(){console.info("onCompleteAll"),i.close(f)}}]),app.controller("ModalInstanceSideCustomerDocumentTypeCtrl",["$rootScope","$state","$stateParams","$scope","FileUploader","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","ngNotify","ListService",function(e,t,o,n,i,a,r,l,s,c,u,d,m){n.currentUser=e.currentUser(),n.isAgent="agent"==n.currentUser.wg_type,n.isAdmin="system"==n.currentUser.wg_type,n.isCustomerAdmin="customerAdmin"==n.currentUser.wg_type,n.isCustomerUser="customerUser"==n.currentUser.wg_type,n.canEdit=n.isCustomerAdmin||!t.is("app.clientes.view")&&(n.isAgent||n.isAdmin),e.canEditRoot=n.canEdit,n.isView=t.is("app.clientes.view"),n.isCreate=t.is("app.clientes.create"),n.onAddEmployeeDocumentType=function(){l(function(){null==n.customer.employeeDocumentsTypeList&&(n.customer.employeeDocumentsTypeList=[]),n.customer.employeeDocumentsTypeList.push({id:0,customerId:0,namespace:"wgroup",group:"employeeDocumentType",isActive:!1,isVisible:!1,value:""})})},n.onRemoveEmployeeDocumentType=function(e){s.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(t){t?l(function(){var t=n.customer.employeeDocumentsTypeList[e];if(n.customer.employeeDocumentsTypeList.splice(e,1),0!=t.id){var o={};o.id=t.id,c({method:"POST",url:"api/customer-parameter/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){r.error(e),s.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})},n.form={submit:function(e){var t=null;if(e.$invalid){var o=null,t=null;for(o in e)"$"!=o[0]&&(null!==t||e[o].$valid||(t=e[o].$name),e[o].$pristine&&(e[o].$dirty=!0));return log.info(n.customer),angular.element(".ng-invalid[name="+t+"]").focus(),void s.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}p()},reset:function(e){e.$setPristine(!0)}},n.onCancel=function(){a.dismiss("cancel")};var p=function(){var t={id:n.customer.id,employeeDocumentsTypeList:n.customer.employeeDocumentsTypeList},o={},i=JSON.stringify(t);return o.data=Base64.encode(i),c({method:"POST",url:"api/customer/save-document-type",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(t){l(function(){n.customer.employeeDocumentsTypeList=t.data.result.employeeDocumentsTypeList,e.$emit("dataCustomer",{newValue:n.customer,id:n.customer.id,message:"Data Customer has been changed!"}),e.app.supportHelp&&(e.app.supportHelp.hasNotificationUser=n.customer.userNotificationList.length>0),s.swal("Validación exitosa","Guardando información del cliente...","success")})})["catch"](function(e){r.error(e),s.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})}}]),app.controller("ModalInstanceSideCustomerEmployeeDownloadAttachmentCtrl",["$rootScope","$stateParams","$scope","$uibModal","$uibModalInstance","title","$log","$timeout","SweetAlert","$http","toaster","$filter","$aside","$document","DTColumnBuilder","DTOptionsBuilder","$compile","ListService","ngNotify",function(e,t,o,n,i,a,r,l,s,c,u,d,m,p,f,h,w,y,v){function g(){var e=o.filter.year?o.filter.year.value:null,n=[{name:"customer_employee_document_type",value:t.customerId},{name:"customer_employee_document_periods",value:t.customerId,year:e}];y.getDataList(n).then(function(e){o.documentType=e.data.data.customerEmployeeDocumentType,o.years=e.data.data.customerEmployeeDocumentPeriod.years,o.months=e.data.data.customerEmployeeDocumentPeriod.months},function(e){o.status="Unable to load customer data: "+e.message})}o.loading=!0,o.title=a,o.onCloseModal=function(){i.close(1)},o.onCancel=function(){i.dismiss("cancel")},o.onSelectYear=function(){g()};var b=function(){o.filter={id:t.customerId}};b(),g(),o.form={submit:function(e){var t=null;if(e.$invalid){var n=null,t=null;for(n in e)"$"!=n[0]&&(null!==t||e[n].$valid||(t=e[n].$name),e[n].$pristine&&(e[n].$dirty=!0));return angular.element(".ng-invalid[name="+t+"]").focus(),void s.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}return o.filter.type||o.filter.year||o.filter.month?void C():void s.swal("El formulario contiene errores!","Por favor seleccione al menos un filtro e intentelo nuevamente.","error")},reset:function(e){}};var C=function(){v.set("El archivo se está generando.",{position:"bottom",sticky:!0,button:!1,html:!0});var e={customerId:t.customerId,audit:o.filter},n={},i=JSON.stringify(e);n.data=Base64.encode(i),c({method:"POST",url:"api/customer-employee-document/export",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(e){var t=(e.data.path+e.data.filename,'<div class="row"><div class="col-sm-12 text-center">Por favor espere y verifique su correo y la bandeja de mensajes!</div> </div>');v.set(t,{position:"bottom",sticky:!0,type:"success",button:!0,html:!0}),o.onCloseModal()})["catch"](function(e){v.set(e.data.message,{position:"bottom",sticky:!0,type:"error",button:!0,html:!0})})["finally"](function(){})}}]);
"use strict";app.controller("customerEmployeeAuthorizationModalCtrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout","$uibModalInstance",function(o,n,e,r,l,t,i){o.onCloseModal=function(){i.close()},o.onCancel=function(){i.dismiss("cancel")};var a=function(){o.entity={reason:null}};a(),o.form={submit:function(o){var n=null;if(o.$invalid){var e=null,n=null;for(e in o)"$"!=e[0]&&(null!==n||o[e].$valid||(n=o[e].$name),o[e].$pristine&&(o[e].$dirty=!0));return angular.element(".ng-invalid[name="+n+"]").focus(),void SweetAlert.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}u()},reset:function(o){}};var u=function(){i.close(o.entity.description)}}]);
"use strict";app.controller("customerEmployeeDocumentExpirationSearchListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","SweetAlert","$http","$timeout","ListService","$localStorage",function(t,e,i,n,o,a,r,l,c,d,u,s,p,h,m){function w(){var e=[{name:"criteria_operators",value:null},{name:"criteria_conditions",value:null},{name:"customer_employee_document_expiration_custom_filter_field",value:null},{name:"month_options",value:null}];h.getDataList(e).then(function(e){t.criteria=e.data.data.criteriaOperatorList,t.conditions=e.data.data.criteriaConditionList,t.audit.fields=e.data.data.customerEmployeeDocumentExpirationCustomFilterField,t.months=e.data.data.monthOptions},function(e){t.status="Unable to load customer data: "+e.message})}t.isAgent="agent"==d.currentUser().wg_type,t.isAdmin="system"==d.currentUser().wg_type,t.isCustomer="customerAdmin"==d.currentUser().wg_type||"customerUser"==d.currentUser().wg_type,t.$storage=m.$default({hideExpiredAttachment:!0}),t.audit={fields:[],filters:[]},w(),t.addFilter=function(){null==t.audit.filters&&(t.audit.filters=[]),t.audit.filters.push({id:0,field:null,criteria:t.criteria.length>0?t.criteria[1]:null,condition:t.conditions.length>0?t.conditions[1]:null,value:""})},t.onFilter=function(){t.reloadData()},t.removeFilter=function(e){t.audit.filters.splice(e,1)},t.onCleanFilter=function(){t.audit.filters=[],t.reloadData()},t.onShowExpirtedChange=function(){t.reloadData()},t.dtInstanceCertificateExpiration={},t.dtOptionsCertificateExpiration=n.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(i){return i.operation="document",i.customerId=e.customerId,i.statusCode=["1","3"],t.$storage.hideExpiredAttachment&&(i.statusCode=["1"]),angular.isDefined(t.audit)&&angular.isDefined(t.audit.filters)&&(i.filter={filters:$.map(t.audit.filters,function(t){return{field:t.field.name,operator:t.criteria.value,condition:t.condition.value,value:t.value}})}),JSON.stringify(i)},url:"api/customer-employee-document-expiration",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){f()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,i,n){r(angular.element(e).contents())(t)}),t.dtColumnsCertificateExpiration=[o.newColumn(null).withTitle("").withOption("width",60).notSortable().renderWith(function(e,i,n,o){var a=null!=e.documentUrl?e.documentUrl:"",r="",l='<a target="_blank" class="btn btn-primary btn-xs editRow lnk" href="'+a+'" uib-tooltip="Descargar anexo" data-id="'+e.id+'" >   <i class="fa fa-download"></i></a> ';return a.length>0&&(r+=l),t.isView=!1,t.isView?"":r}),o.newColumn("documentType").withTitle("Tipo Identificación").withOption("width",200),o.newColumn("documentNumber").withTitle("Número Identificación").withOption("width",200),o.newColumn("fullName").withTitle("Nombre").withOption("width",250),o.newColumn("workplace").withTitle("Centro de Trabajo").withOption("width",250),o.newColumn("requirement").withTitle("Tipo Documento").withOption("width",200),o.newColumn("description").withTitle("Descripción").withOption("width",250),o.newColumn("startDate").withTitle("Fecha de Inicio Vigencia").withOption("width",200),o.newColumn("endDate").withTitle("Fecha de Expiración Vigencia").withOption("width",200),o.newColumn("version").withTitle("Versión").withOption("width",150),o.newColumn(null).withTitle("Requerido").withOption("width",150).notSortable().renderWith(function(t,e,i,n){var o="",a="1"==t.isRequiredCode||t.isRequiredCode?"checked":"",r="1"==t.isRequiredCode||t.isRequiredCode?"Si":"No",l='<div class="checkbox clip-check check-success "><input class="editRow" ng-disabled="true" type="checkbox" id="chk_'+t.id+'" data-id="'+t.id+'" '+a+' ><label for="chk_'+t.id+'">'+r+"</label></div>";return o+=l}).notSortable(),o.newColumn("status").withTitle("Estado").withOption("width",150).renderWith(function(t,e,i,n){var o="";switch(t){case"Vigente":o="label label-success";break;case"Vencido":o="label label-danger"}var a='<span class="'+o+'">'+t+"</span>";return a})],t.dtInstanceCertificateExpirationCallback=function(e){t.dtInstanceCertificateExpiration=e},t.reloadData=function(){t.dtInstanceCertificateExpiration.reloadData()};var f=function(){};t.onExportExcel=function(){jQuery("#downloadDocument")[0].src="api/customer-employee-document-expiration-export?id="+e.customerId+"&data="+Base64.encode(JSON.stringify(t.audit))},t.onExportPdf=function(){jQuery("#downloadDocument")[0].src="api/customer-employee/document/search-expiration-export-pdf?id="+e.customerId+"&data="+Base64.encode(JSON.stringify(t.audit))}}]);
"use strict";app.controller("customerEmployeeDocumentImportCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","SweetAlert","$http","$filter","$document","FileUploader","$uibModal","$localStorage","$aside","ListService",function(e,o,t,n,i,l,a,r,s,c,u,d,m,p,f,h,w,y,g,b){function v(){var t=[{name:"customer_employee_document_type",value:o.customerId}];b.getDataList(t).then(function(o){e.requirements=o.data.data.customerEmployeeDocumentType},function(o){e.status="Unable to load customer data: "+o.message})}var A=t,C=[];A.info("loading..customerEmployeeDocumentListCtrl DAB"),e.$storage=y.$default({hideCanceled:!0}),e.isAgent="agent"==c.currentUser().wg_type,e.isAdmin="system"==c.currentUser().wg_type,e.isCustomer="customerAdmin"==c.currentUser().wg_type||"customerUser"==c.currentUser().wg_type,e.canShowCheck=c.can("clientes_empleado_documentos_masivos_check"),e.documentStatus=c.parameters("customer_document_status"),e.isView="view"==e.$parent.editMode,e.isInvalidate=!1,e.customerId=o.customerId,e.downloadUrl="",v();var I=function(){e.attachment={id:0,customerId:e.customerId,requirement:null,status:e.documentStatus?e.documentStatus[0]:null,version:1,description:"",startDate:null,endDate:null,isApprove:!1,created_at:null,toApplyAll:!1,employeeList:[]},e.employeeList=[]};I(),e.master=e.attachment,e.form={submit:function(o){var t=null;if(o.$invalid){var n=null,t=null;for(n in o)"$"!=n[0]&&(null!==t||o[n].$valid||(t=o[n].$name),o[n].$pristine&&(o[n].$dirty=!0));return angular.element(".ng-invalid[name="+t+"]").focus(),void d.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}return 0==e.uploader.queue.length?void d.swal("El formulario contiene errores!","Por favor seleccione un anexo e Intentalo de nuevo.","error"):void E()},reset:function(o){e.attachment=angular.copy(e.master),o.$setPristine(!0)}};var E=function(){e.attachment.employeeList=[],angular.forEach(e.employeeList,function(o,t){console.log(o),e.attachment.employeeList.push(o.id)});var o={},n=JSON.stringify(e.attachment);return o.data=Base64.encode(n),m({method:"POST",url:"api/customer-employee/document/import",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(e){u(function(){C=e.data.result.id,D.uploadAll()})})["catch"](function(e){t.error(e),d.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})},D=e.uploader=new h({url:"api/customer-employee/document/upload-bulk",formData:[],removeAfterUpload:!0});D.filters.push({name:"customFilter",fn:function(e,o){return this.queue.length<10}}),D.onWhenAddingFileFailed=function(e,o,t){console.info("onWhenAddingFileFailed",e,o,t)},D.onAfterAddingFile=function(e){console.info("onAfterAddingFile",e)},D.onAfterAddingAll=function(e){console.info("onAfterAddingAll",e)},D.onBeforeUploadItem=function(e){console.info("onBeforeUploadItem",e);var o={id:C};e.formData.push(o)},D.onProgressItem=function(e,o){console.info("onProgressItem",e,o)},D.onProgressAll=function(e){console.info("onProgressAll",e)},D.onSuccessItem=function(e,o,t,n){console.info("onSuccessItem",e,o,t,n)},D.onErrorItem=function(e,o,t,n){console.info("onErrorItem",e,o,t,n)},D.onCancelItem=function(e,o,t,n){console.info("onCancelItem",e,o,t,n)},D.onCompleteItem=function(e,o,t,n){console.info("onCompleteItem",e,o,t,n)},D.onCompleteAll=function(){console.info("onCompleteAll"),I(),d.swal("Validación exitosa","Se guardó satisfactoriamente","success")},e.onAddEmployee=function(){var n=g.open({templateUrl:c.app.views.urlRoot+"modules/customer/employee/customer_absenteeism_disability_employee_list_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideCustomerEmployeeSearchListCtrl",scope:e,resolve:{customer:function(){return{id:o.customerId}}}});n.result.then(function(e){O(e)},function(){t.info("Modal dismissed at: "+new Date)})},e.onRemoveEmployee=function(o){d.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(t){t?u(function(){e.employeeList.splice(o,1)}):swal("Cancelación","La operación ha sido cancelada","error")})},e.onUpload=function(){var o=g.open({templateUrl:c.app.views.urlRoot+"modules/customer/common/modals/import_modal.htm",placement:"bottom",size:"lg",backdrop:!0,controller:"ModalInstanceSideImportEmployeeDocumentCtrl",scope:e});o.result.then(function(o){e.showEmployeeLessImport(o.result)})},e.showEmployeeLessImport=function(n){var i=g.open({templateUrl:c.app.views.urlRoot+"modules/customer/employee/customer_absenteeism_disability_employee_list_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideCustomerEmployeeLessImportCtrl",scope:e,resolve:{customer:function(){return{id:o.customerId}},documents:function(){return n}}});i.result.then(function(e){e.forEach(function(e){O(e)})},function(){t.info("Modal dismissed at: "+new Date)})};var O=function(o){var t=p("filter")(e.employeeList,{id:o.id},!0);0==t.length&&e.employeeList.push(o)};e.onToApplyAll=function(){console.log(e.attachment.toApplyAll),e.attachment.toApplyAll?e.employeeList=e.attachment.employeeList:e.attachment.employeeList=e.employeeList},A.info("loading..customerEmployeeDocumentListCtrl DAB"),e.afterEmployeeAdded=function(e){O(e)},e.onCancel=function(){I()}}]),app.controller("ModalInstanceDeniedCtrl",["$scope","$uibModalInstance","document","action","$log","$timeout","SweetAlert","$http",function(e,o,t,n,i,l,a,r){console.log(e.$parent),e.attachment.toApplyAll?(e.employeeList=e.attachment.employeeList,console.log(e.employeeList)):(e.attachment.employeeList=e.employeeList,console.log(e.attachment.employeeList)),e.document=t,e.document.tracking={action:n,description:""},e.onClose=function(){o.close(1)},e.onCancel=function(){o.dismiss("cancel")},e.onSave=function(){s()};var s=function(){var o={},t=JSON.stringify(e.document);return o.data=Base64.encode(t),r({method:"POST",url:"api/customer-employee/document/denied",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(o){l(function(){a.swal("Validación exitosa","Procediendo con el guardado...","success"),e.onCancel()})})["catch"](function(e){i.error(e),a.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})}}]),app.controller("ModalInstanceSideCustomerEmployeeSearchListCtrl",["$rootScope","$stateParams","$scope","customer","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile",function(e,o,t,n,i,l,a,r,s,c,u,d,m,p,f){console.log(t.$parent),t.title="Empleados";t.employee={id:0},t.onCloseModal=function(){i.close(t.employee)},t.onCancel=function(){i.dismiss("cancel")},t.onLoadRecord=function(){if(0!=t.employee.id){var e={id:t.employee.id};s({method:"GET",url:"api/customer-employee",params:e})["catch"](function(e,o){if(403==o){var t=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";r.swal("No Autorizado","No estas autorizado para ver esta información.","error"),a(function(){$state.go(t)},3e3)}else 404==o?r.swal("Información no disponible","Diagnóstico no encontrado","error"):r.swal("Error","Se ha presentado un error al intentar acceder a la información del proceso","error")}).then(function(e){a(function(){t.$parent.afterEmployeeAdded(e.data.result)})})["finally"](function(){a(function(){},400)})}else t.loading=!1},t.dtInstanceDisabilityEmployeeList={},t.dtOptionsDisabilityEmployeeList=p.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerId=n.id,JSON.stringify(e)},url:"api/customer-employee-modal-basic",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){h()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,o,n){f(angular.element(e).contents())(t)}),t.dtColumnsDisabilityEmployeeList=[m.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,o,t,n){console.log(e);var i="",l="",a='<a class="btn btn-success btn-xs editRow lnk" href="#" uib-tooltip="Adicionar empleado" tooltip-placement="right"  data-id="'+e.id+'"'+l+' >   <i class="fa fa-plus-square"></i></a> ';return i+=a}),m.newColumn("documentNumber").withTitle("Número Identificación").withOption("width",200),m.newColumn("firstName").withTitle("Nombre").withOption("width",200),m.newColumn("lastName").withTitle("Apellidos").withOption("width",200),m.newColumn("workPlace").withTitle("Centro de Trabajo").withOption("width",200),m.newColumn("job").withTitle("Cargo").withOption("width",200),m.newColumn("neighborhood").withTitle("Centro de Costos").withOption("width",200),m.newColumn(null).withTitle("Estado").withOption("width",200).renderWith(function(e,o,t,n){var i="label label-danger",l="Inactivo";null==e.isActiveCode&&void 0==e.isActiveCode||("Activo"==e.isActiveCode?(i="label label-success",l="Activo"):(i="label label-danger",l="Inactivo"));var a='<span class="'+i+'">'+l+"</span>";return a}),m.newColumn(null).withTitle("Autorización").withOption("width",200).renderWith(function(e,o,t,n){var i="label label-danger",l="Inactivo";null==e.isAuthorized&&void 0==e.isAuthorized||("Autorizado"==e.isAuthorized?(i="label label-success",l="Autorizado"):"No Autorizado"==e.isAuthorized?(i="label label-danger",l="No Autorizado"):(i="label label-info",l="N/A"));var a='<span class="'+i+'">'+l+"</span>";return a})];var h=function(){$("#dtDisabilityEmployeeList a.editRow").on("click",function(){var e=$(this).data("id");t.editDisabilityEmployee(e)})};t.reloadData=function(){t.dtInstanceDisabilityEmployeeList.reloadData()},t.viewDisabilityEmployee=function(e){t.employee.id=e,t.isView=!0,t.onLoadRecord()},t.editDisabilityEmployee=function(e){t.employee.id=e,t.isView=!1,t.onLoadRecord()}}]),app.controller("ModalInstanceSideCustomerEmployeeLessImportCtrl",["$rootScope","$q","$scope","customer","documents","$uibModalInstance","SweetAlert","$http","$filter","DTColumnBuilder","DTOptionsBuilder","$compile","$aside",function(e,o,t,n,i,l,a,r,s,c,u,d,m){t.title="Empleados Importados",t.messageInfo='Al presionar "Cargar", solo se procesaran los registros correctos.',t.showProcessBtn=!0,t.employees=[],t.onCloseModal=function(){var e=[];t.employees.forEach(function(o,t){o.id&&e.push({id:o.id,customerId:o.customer_id,entity:{documentNumber:o.documentNumber,fullName:o.firstName+" "+o.lastName},workPlace:{name:o.workPlace}})}),l.close(e)},t.onCancel=function(){l.dismiss("cancel")};var p={};p.operation="restriction",p.customerId=n.id,p.documentNumber=i;var f=function(){var e=o.defer();return t.employees.length?e.resolve(t.employees):r({method:"POST",url:"api/customer-employee-less",data:p}).then(function(o){console.log(o),t.employees=o.data.data,e.resolve(t.employees)}),e.promise};t.dtInstanceDisabilityEmployeeList={},t.dtOptionsDisabilityEmployeeList=u.fromFnPromise(f).withBootstrap().withOption("responsive",!0).withOption("order",[[0,"desc"]]).withOption("processing",!0).withDataProp("data").withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){h()}).withPaginationType("full_numbers").withOption("createdRow",function(e,o,n){d(angular.element(e).contents())(t)}),t.dtColumnsDisabilityEmployeeList=[c.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e){var o="",t="";if(null==e.id){var n='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar registro" tooltip-placement="right"  data-id="'+e.documentNumber+'"'+t+' >   <i class="fa fa-pencil"></i></a> ';o+=n}else{var i='<a class="btn btn-success btn-xs lnk" href="#" uib-tooltip="Registro correcto" tooltip-placement="right"  data-id="'+e.documentNumber+'"'+t+' >   <i class="fa fa-check-circle"></i></a> ';o+=i}var l='<a class="btn btn-danger btn-xs quitRow lnk" href="#" uib-tooltip="Quitar registro" tooltip-placement="right"  data-id="'+e.documentNumber+'"'+t+' >   <i class="fa fa-trash"></i></a> ';return o+=l}),c.newColumn("documentNumber").withTitle("Número Identificación").withOption("width",200),c.newColumn("firstName").withTitle("Nombre").withOption("width",200),c.newColumn("lastName").withTitle("Apellidos").withOption("width",200),c.newColumn("workPlace").withTitle("Centro de Trabajo").withOption("width",200),c.newColumn("job").withTitle("Cargo").withOption("width",200),c.newColumn("neighborhood").withTitle("Centro de Costos").withOption("width",200),c.newColumn(null).withTitle("Estado").withOption("width",200).renderWith(function(e,o,t,n){var i="label label-danger",l="Inactivo";null==e.isActiveCode&&void 0==e.isActiveCode||("Activo"==e.isActiveCode?(i="label label-success",l="Activo"):(i="label label-danger",l="Inactivo"));var a='<span class="'+i+'">'+l+"</span>";return a}),c.newColumn(null).withTitle("Autorización").withOption("width",200).renderWith(function(e,o,t,n){var i="",l="";null==e.isAuthorized&&void 0==e.isAuthorized||("Autorizado"==e.isAuthorized?(i="label label-success",l="Autorizado"):"No Autorizado"==e.isAuthorized?(i="label label-danger",l="No Autorizado"):(i="label label-info",l="N/A"));var a='<span class="'+i+'">'+l+"</span>";return a})];var h=function(){$("#dtDisabilityEmployeeList a.editRow").on("click",function(){var e=$(this).data("id");t.onEdit(e)}),$("#dtDisabilityEmployeeList a.quitRow").on("click",function(){var e=$(this).data("id");t.employees.forEach(function(o,n){if(o.documentNumber==e)return t.employees.splice(n,1),void t.reloadData()})})};t.reloadData=function(){t.dtInstanceDisabilityEmployeeList.reloadData()},t.onEdit=function(o){t.documemtEmployee=o;var n=m.open({templateUrl:e.app.views.urlRoot+"modules/customer/common/modals/employee_create_modal.htm",placement:"right",windowTopClass:"top-modal",size:"lg",backdrop:!0,controller:"ModalInstanceSideEmployeeLessImportEditCtrl",scope:t});n.result.then(function(e){t.employees.forEach(function(o,n){if(o.documentNumber==t.documemtEmployee)return t.employees[n]=t.parseDataEmployee(e),void t.reloadData()})})},t.parseDataEmployee=function(e){return{id:e.id,documentNumber:e.entity.documentNumber,firstName:e.entity.firstName,lastName:e.entity.lastName,workPlace:e.workPlace.name,job:e.job.name,neighborhood:e.entity.neighborhood,countAttachment:null,isActiveCode:null,isAuthorized:e.isAuthorized,employeeDocumentType:null,customerId:e.customerId,employeeId:e.entity.id,isActive:e.isActive}}}]),app.controller("ModalInstanceSideEmployeeLessImportEditCtrl",["$scope","$stateParams","$state","$rootScope","$timeout","$http","SweetAlert","$uibModalInstance",function(e,o,t,n,i,l,a,r){var s=null;e.genders=n.parameters("gender"),e.documentTypes=n.parameters("employee_document_type"),e.title="EDITAR REGISTRO EMPLEADO",e.filter=!0;var c=function(){e.employee={id:0,customerId:o.customerId,isActive:!1,contractType:null,occupation:"",job:null,workPlace:null,salary:0,isAuthorized:!1,entity:{id:0,documentType:null,documentNumber:e.documemtEmployee,expeditionPlace:"",expeditionDate:"",firstName:"",lastName:"",birthDate:"",gender:null,profession:null,eps:null,afp:null,arl:null,country:null,state:null,city:null,rh:"",riskLevel:0,neighborhood:"",observation:"",logo:"",details:[],isActive:!1,age:null},validityList:[]},s&&s.$setPristine(!0)};c(),e.onValide=function(){var o={documentNumber:e.employee.entity.documentNumber,customerId:e.employee.customerId};l({method:"GET",url:"api/customer-employee-v3",params:o}).then(function(o){var t=o.data.result;t.id&&(e.employee=t)})["catch"](function(e){a.swal("Empleado no existe!","Debes digitar un documento válido para continuar.","error")})},e.onCancel=function(){r.dismiss("cancel")},e.onContinue=function(){r.close(e.employee)}}]),app.controller("ModalInstanceSideImportEmployeeDocumentCtrl",["$rootScope","$stateParams","$scope","FileUploader","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","ngNotify","ListService",function(e,o,t,n,i,l,a,r,s,c,u,d){var m=null;t.title="- Adicionar Empleados Excel",console.log("entra 2");var p=t.uploader=new n({url:"api/customer-employee-less/import",formData:[]});t.download=function(){angular.element("#downloadDocument")[0].src="api/customer-employee-less/download-template"},p.filters.push({name:"customFilter",fn:function(e,o){return this.queue.length<10}}),p.onWhenAddingFileFailed=function(e,o,t){console.info("onWhenAddingFileFailed",e,o,t)},p.onAfterAddingFile=function(e){console.info("onAfterAddingFile",e)},p.onAfterAddingAll=function(e){console.info("onAfterAddingAll",e)},p.onBeforeUploadItem=function(t){console.info("onBeforeUploadItem",t);var n={id:o.customerId,user:e.currentUser().id};t.formData.push(n)},p.onProgressItem=function(e,o){console.info("onProgressItem",e,o)},p.onProgressAll=function(e){console.info("onProgressAll",e)},p.onSuccessItem=function(e,o,t,n){console.info("onSuccessItem",e,o,t,n)},p.onErrorItem=function(e,o,t,n){console.info("onErrorItem",e,o,t,n)},p.onCancelItem=function(e,o,t,n){console.info("onCancelItem",e,o,t,n)},p.onCompleteItem=function(e,o,t,n){console.info("onCompleteItem",e,o,t,n),m=o},p.onCompleteAll=function(){console.info("onCompleteAll"),i.close(m)}}]);
"use strict";app.controller("customerEmployeeStagingListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$document","$filter","$aside","ListService",function(t,e,n,o,i,a,l,r,s,u,c,d,p,w,m,h,f){function C(){var e=[{name:"export_url",value:null}];f.getDataList(e).then(function(t){O=t.data.data.exportUrl.item},function(e){t.status="Unable to load customer data: "+e.message})}var O="";C(),t.dtInstanceEmployeeStagingDT={},t.dtOptionsEmployeeStagingDT=o.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(n){return n.customer_id=e.customerId,n.session_id=t.$parent.currentEmployee,JSON.stringify(n)},url:"api/customer-employee-staging",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[1,"asc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){g()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,n,o){l(angular.element(e).contents())(t)}),t.dtColumnsEmployeeStagingDT=[i.newColumn(null).withTitle("").withOption("width",30).notSortable().renderWith(function(t,e,n,o){var i="",a='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar"  data-id="'+t.id+'"'+i+' >   <i class="fa fa-edit"></i></a> ',l=0!=t.isValid&&t.isValid?"":a;return l}),i.newColumn(null).withTitle("Fila").withOption("width",50).renderWith(function(t,e,n,o){if(1==t.isValid||t.isValid)var i="badge badge-success",a='<i class=" fa fa-check"></i>',l="Es correcto";else var i="badge badge-danger",a='<i class=" fa fa-ban"></i>',l=t.errors;return'<span uib-tooltip="'+l+'" class="'+i+'">'+t.index+a+"</span>"}),i.newColumn("documentType").withTitle("Tipo Documento").withOption("width",200).withOption("defaultContent",""),i.newColumn("documentNumber").withTitle("Nro Identificación").withOption("width",200).withOption("defaultContent",""),i.newColumn("expeditionPlace").withTitle("Lugar Expedición").withOption("width",200).withOption("defaultContent",""),i.newColumn("expeditionDate").withTitle("Fecha Expedición").withOption("width",200).withOption("defaultContent",""),i.newColumn("birthdate").withTitle("Fecha Nacimiento").withOption("width",200).withOption("defaultContent",""),i.newColumn("gender").withTitle("Género").withOption("width",200).withOption("defaultContent",""),i.newColumn("firstName").withTitle("Nombres").withOption("width",200).withOption("defaultContent",""),i.newColumn("lastName").withTitle("Apellidos").withOption("width",200).withOption("defaultContent",""),i.newColumn("contractType").withTitle("Tipo Contrato").withOption("width",200).withOption("defaultContent",""),i.newColumn("profession").withTitle("Profesión").withOption("width",200).withOption("defaultContent",""),i.newColumn("occupation").withTitle("Ocupación").withOption("width",200).withOption("defaultContent",""),i.newColumn("job").withTitle("Cargo").withOption("width",200).withOption("defaultContent",""),i.newColumn("workPlace").withTitle("Centro de Trabajo").withOption("width",200).withOption("defaultContent",""),i.newColumn("salary").withTitle("Salario").withOption("width",100).withOption("defaultContent",""),i.newColumn("eps").withTitle("EPS").withOption("width",100).withOption("defaultContent",""),i.newColumn("afp").withTitle("AFP").withOption("width",100).withOption("defaultContent",""),i.newColumn("arl").withTitle("ARL").withOption("width",100).withOption("defaultContent",""),i.newColumn("country_id").withTitle("Pais").withOption("width",100).withOption("defaultContent",""),i.newColumn("state_id").withTitle("Departamento").withOption("width",180).withOption("defaultContent",""),i.newColumn("city_id").withTitle("Ciudad").withOption("width",180).withOption("defaultContent",""),i.newColumn("rh").withTitle("RH").withOption("width",180).withOption("defaultContent",""),i.newColumn("riskLevel").withTitle("Nivel de Riesgo").withOption("width",280).withOption("defaultContent",""),i.newColumn("neighborhood").withTitle("Centro de Costos").withOption("width",280).withOption("defaultContent",""),i.newColumn("mobil").withTitle("Celular").withOption("width",280).withOption("defaultContent",""),i.newColumn("address").withTitle("Dirección").withOption("width",280).withOption("defaultContent",""),i.newColumn("telephone").withTitle("Teléfono").withOption("width",280).withOption("defaultContent",""),i.newColumn("email").withTitle("Email").withOption("width",280).withOption("defaultContent",""),i.newColumn("active").withTitle("Activo").withOption("width",280).withOption("defaultContent",""),i.newColumn("workShift").withTitle("Turno de Trabajo").withOption("width",280).withOption("defaultContent","")],u.isAuthorizationTemplate&&t.dtColumnsEmployeeStagingDT.push(i.newColumn("isAuthorized").withTitle("Autorizado").withOption("width",280).withOption("defaultContent",""));var g=function(){angular.element("#dataEmployeeStagingDT a.editRow").on("click",function(){var t=angular.element(this).data("id");y(t)})};t.dtInstanceEmployeeStagingDTCallback=function(e){t.dtInstanceEmployeeStagingDT=e},t.reloadData=function(){t.dtInstanceEmployeeStagingDT.reloadData()};var y=function(e){var n=h.open({templateUrl:u.app.views.urlRoot+"modules/customer/employee/customer_employee_staging_modal.htm",placement:"right",windowTopClass:"top-modal",size:"lg",backdrop:!0,controller:"ModalInstanceSideCustomerEmployeeStagingEditCtrl",scope:t,resolve:{dataItem:function(){return{id:e?e:0}},isView:function(){return t.isView}}});n.result.then(function(){t.reloadData()},function(){t.reloadData()})};t.onCancel=function(){null!=t.$parent&&t.$parent.navToSection("list","list")},t.onProcess=function(){p.swal({title:"Confirma la importación de los registros?",text:"Se importarán los registros válidos. Una vez realizado este proceso no se podrán realizar cambios.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, confirmar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(o){if(o)return d({method:"POST",url:O+"api/v1/customer-employee-import/confirm",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param({id:e.customerId,sessionId:t.$parent.currentEmployee,hasCustomerEmployeeId:u.hasCustomerEmployeeId})}).then(function(e){c(function(){p.swal("Registro","La información ha sido importada satisfactoriamente","success"),t.onCancel()})})["catch"](function(t){n.error(t),p.swal("Error de guardado",t.data.message,"error")})["finally"](function(){})})}}]),app.controller("ModalInstanceSideCustomerEmployeeStagingEditCtrl",["$rootScope","$stateParams","$scope","dataItem","isView","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","ngNotify","$document","$filter","$aside","ListService",function(t,e,n,o,i,a,l,r,s,u,c,d,p,w,m,h){function f(){var t=[{name:"customer_employee_type_rh",criteria:{}}];h.getDataList(t).then(function(t){n.listRh=t.data.data.customer_employee_type_rh},function(t){n.status="Unable to load customer data: "+t.message})}n.onCloseModal=function(){a.close(null)},n.onCancel=function(){a.dismiss("cancel")};var C=l;n.employees=[],n.arl=t.parameters("arl"),n.afp=t.parameters("afp"),n.eps=t.parameters("eps"),n.genders=t.parameters("gender"),n.professions=t.parameters("employee_profession"),n.contractTypes=t.parameters("employee_contract_type"),n.documentTypes=t.parameters("employee_document_type"),n.workShifts=t.parameters("work_shifts"),n.countries=t.countries(),n.states=[],n.towns=[],n.showAuthorized=t.isAuthorizationTemplate&&t.can("empleado_authorize"),n.dateConfig={culture:"es-CO",format:"dd/MM/yyyy"},f();var O=function(){var t={};return t.operation="diagnostic",t.customerId=e.customerId,u({method:"POST",url:"api/customer/config-sgsst/workplace/listProcess",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){r(function(){n.workPlaces=t.data.data})})["catch"](function(t){})["finally"](function(){})};O(),n.onSearchJob=function(){if(!n.employee.workPlace)return void s.swal("Validación!","Debe seleccionar un centro de trabajo válido.","error");var e=m.open({templateUrl:t.app.views.urlRoot+"modules/common/modals/data_table_list_modal.htm",placement:"right",windowTopClass:"top-modal",size:"lg",backdrop:"static",resolve:{workPlace:function(){return n.employee.workPlace}},controller:"ModalInstanceSideCustomerEmployeeJobListCtrl",scope:n});e.result.then(function(t){void 0!==n.jobs&&null!=n.jobs||(n.jobs=[]);var e=w("filter")(n.jobs,{id:t.id});0==e.length&&n.jobs.push(t),n.employee.job=t},function(){})},n.changeCountry=function(t,e){if(null!=t){n.states=[],n.towns=[],n.employee.state_id=null,n.employee.city_id=null;var o={cid:t.id};u({method:"GET",url:"api/states",params:o})["catch"](function(t,e){}).then(function(t){n.states=t.data.result,n.towns=[]})["finally"](function(){})}},n.changeState=function(t,e){n.towns=[];var o={sid:t.id};n.employee.city_id=null,u({method:"GET",url:"api/towns",params:o}).then(function(t){n.towns=t.data.result})["finally"](function(){})};var g=function(){n.employee={id:o.id,index:null,customerEmployeeId:null,documentType:null,documentNumber:null,expeditionPlace:null,expeditionDate:null,birthdate:null,gender:null,firstName:null,lastName:null,contractType:null,profession:null,occupation:null,job:null,workPlace:null,salary:null,eps:null,afp:null,arl:null,country_id:null,state_id:null,city_id:null,rh:null,riskLevel:null,neighborhood:null,observation:null,mobil:null,address:null,telephone:null,email:null,isActive:null,isAuthorized:null,workShift:null,errors:null}};g(),n.onLoadRecord=function(){0!=n.employee.id&&u({method:"GET",url:"api/customer-employee-staging/get",params:{id:n.employee.id}})["catch"](function(t,e){}).then(function(t){r(function(){n.employee=t.data.result;var e=n.employee.country_id,o=n.employee.state_id,i=n.employee.city_id;e&&n.changeCountry(e),o&&n.changeState(o),r(function(){n.employee.state_id=o,n.employee.city_id=i},1500)})})["finally"](function(){})},n.onLoadRecord(),n.form={submit:function(t){var e=null;if(t.$invalid){var o=null,e=null;for(o in t)"$"!=o[0]&&(null!==e||t[o].$valid||(e=t[o].$name),t[o].$pristine&&(t[o].$dirty=!0));return C.info(n.employee),angular.element(".ng-invalid[name="+e+"]").focus(),void s.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}y()},reset:function(t){}};var y=function(){var t={},e=JSON.stringify(n.employee);return t.data=Base64.encode(e),u({method:"POST",url:"api/customer-employee-staging/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){r(function(){s.swal("Registro","La información ha sido guardada satisfactoriamente","success"),n.onCloseModal()})})["catch"](function(t){l.error(t),s.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})}}]),app.controller("ModalInstanceSideCustomerEmployeeJobListCtrl",["$rootScope","$stateParams","$scope","workPlace","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile",function(t,e,n,o,i,a,l,r,s,u,c,d,p,w,m){n.title="CARGOS DISPONIBLES",n.employee={},n.onCloseModal=function(){i.close(n.employee)},n.onCancel=function(){i.dismiss("cancel")};var h=function(t){if(0!=t){var e={id:t};s({method:"GET",url:"api/customer-config-job",params:e})["catch"](function(t){}).then(function(t){l(function(){n.employee=t.data.result})})["finally"](function(){l(function(){n.onCloseModal()},400)})}else n.loading=!1};n.dtInstanceCommonDataTableList={},n.dtOptionsCommonDataTableList=w.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.customerId=e.customerId,t.workPlaceId=o.id,JSON.stringify(t)},url:"api/customer-config-job",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){f()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,e,o){m(angular.element(t).contents())(n)}),n.dtColumnsCommonDataTableList=[p.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,e,n,o){var i="",a="",l='<a class="btn btn-success btn-xs editRow lnk" href="#" uib-tooltip="Adicionar"  data-id="'+t.id+'"'+a+' >   <i class="fa fa-plus-square"></i></a> ';return i+=l}),p.newColumn("work_place").withTitle("Centro de Trabajo").withOption("width",200),p.newColumn("macro_process").withTitle("Macro Proceso"),p.newColumn("process").withTitle("Proceso"),p.newColumn("job").withTitle("Cargo")];var f=function(){$("#dtCommonDataTableList a.editRow").on("click",function(){var t=$(this).data("id");h(t)})};n.dtInstanceCommonDataTableListCallback=function(t){n.dtInstanceCommonDataTableList=t},n.reloadData=function(){n.dtInstanceCommonDataTableList.reloadData()}}]);
"use strict";app.controller("customerEmployeeDemographicStagingListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$document","$filter","$aside","ListService",function(t,e,n,i,a,o,r,l,s,u,c,d,p,m,h,w,f){function g(){var e=[{name:"export_url",value:null}];f.getDataList(e).then(function(t){y=t.data.data.exportUrl.item},function(e){t.status="Unable to load customer data: "+e.message})}var y="";g(),t.dtInstanceEmployeeDemographicStagingDT={},t.dtOptionsEmployeeDemographicStagingDT=i.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(n){return n.customerId=e.customerId,n.sessionId=t.$parent.currentEmployee,JSON.stringify(n)},url:"api/customer-employee-demographic-staging",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[1,"asc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){C()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,n,i){r(angular.element(e).contents())(t)}),t.dtColumnsEmployeeDemographicStagingDT=[a.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,e,n,i){var a="",o='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar"  data-id="'+t.id+'"'+a+' >   <i class="fa fa-edit"></i></a> ',r=0!=t.isValid&&t.isValid?"":o;return r}),a.newColumn(null).withTitle("Fila").withOption("width",50).renderWith(function(t,e,n,i){var a=1==t.isValid||t.isValid?"badge badge-success":"badge badge-danger",o=1==t.isValid||t.isValid?' <i class=" fa fa-check"></i>':' <i class=" fa fa-ban"></i>';return'<span class="'+a+'">'+t.index+o+"</span>"}),a.newColumn("documentNumber").withTitle("Nro Identificación").withOption("width",200).withOption("defaultContent",""),a.newColumn("firstName").withTitle("Nombres").withOption("width",200).withOption("defaultContent",""),a.newColumn("lastName").withTitle("Apellidos").withOption("width",200).withOption("defaultContent",""),a.newColumn("typeHousing").withTitle("Tipo Vivienda").withOption("width",100).withOption("defaultContent",""),a.newColumn("antiquityCompany").withTitle("Antiguedad Empresa").withOption("width",100).withOption("defaultContent",""),a.newColumn("antiquityJob").withTitle("Antiguedad Cargo").withOption("width",100).withOption("defaultContent",""),a.newColumn("averageIncome").withTitle("Ingresos").withOption("width",100).withOption("defaultContent",""),a.newColumn("stratum").withTitle("Estrato").withOption("width",100).withOption("defaultContent",""),a.newColumn("scholarship").withTitle("G. Escolaridad").withOption("width",180).withOption("defaultContent",""),a.newColumn("race").withTitle("Raza").withOption("width",180).withOption("defaultContent",""),a.newColumn("workArea").withTitle("Área de Trabajo").withOption("width",180).withOption("defaultContent",""),a.newColumn("observation").withTitle("Observación").withOption("width",280).withOption("defaultContent","")];var C=function(){angular.element("#dataEmployeeDemographicStagingDT a.editRow").on("click",function(){var t=angular.element(this).data("id");v(t)})};t.dtInstanceEmployeeDemographicStagingDTCallback=function(e){t.dtInstanceEmployeeDemographicStagingDT=e},t.reloadData=function(){t.dtInstanceEmployeeDemographicStagingDT.reloadData()};var v=function(e){var n=w.open({templateUrl:u.app.views.urlRoot+"modules/customer/employee/customer_employee_demographic_staging_modal.htm",placement:"right",windowTopClass:"top-modal",size:"lg",backdrop:!0,controller:"ModalInstanceSideCustomerEmployeeDemographicStagingEditCtrl",scope:t,resolve:{dataItem:function(){return{id:e?e:0}},isView:function(){return t.isView}}});n.result.then(function(){t.reloadData()},function(){t.reloadData()})};t.onCancel=function(){m.scrollTop(40,2e3),null!=t.$parent&&t.$parent.navToSection("list","list")},t.onProcess=function(){p.swal({title:"Confirma la importación de los registros?",text:"Se importarán los registros válidos. Una vez realizado este proceso no se podrán realizar cambios.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, confirmar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(i){if(i)return d({method:"POST",url:y+"api/v1/customer-employee-demographic-import/confirm",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param({id:e.customerId,sessionId:t.$parent.currentEmployee})}).then(function(e){c(function(){p.swal("Registro","La información ha sido importada satisfactoriamente","success"),t.onCancel()})})["catch"](function(t){n.error(t),p.swal("Error de guardado",t.data.message,"error")})["finally"](function(){})})}}]),app.controller("ModalInstanceSideCustomerEmployeeDemographicStagingEditCtrl",["$rootScope","$stateParams","$scope","dataItem","isView","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","ngNotify","$document","$filter","$aside","ListService",function(t,e,n,i,a,o,r,l,s,u,c,d,p,m,h,w){function f(){var t=[{name:"type_housing",value:null},{name:"antiquity",value:null},{name:"frequency",value:null},{name:"stratum",value:null},{name:"civil_status",value:null},{name:"scholarship",value:null},{name:"race",value:null},{name:"work_area",value:null}];w.getDataList(t).then(function(t){n.typeHousings=t.data.data.type_housing,n.antiquities=t.data.data.antiquity,n.frequencies=t.data.data.frequency,n.stratumList=t.data.data.stratum,n.civilStatusList=t.data.data.civil_status,n.scholarshipList=t.data.data.scholarship,n.raceList=t.data.data.race,n.workAreaList=t.data.data.work_area},function(t){n.status="Unable to load customer data: "+t.message})}n.onCloseModal=function(){o.close(null)},n.onCancel=function(){o.dismiss("cancel")};var g=r;n.employees=[],f();var y=function(){n.entity={id:i.id}};y(),n.onLoadRecord=function(){0!=n.entity.id&&u({method:"GET",url:"api/customer-employee-demographic-staging/get",params:{id:n.entity.id}})["catch"](function(t,e){}).then(function(t){l(function(){n.entity=t.data.result})})["finally"](function(){})},n.onLoadRecord(),n.form={submit:function(t){var e=null;if(t.$invalid){var i=null,e=null;for(i in t)"$"!=i[0]&&(null!==e||t[i].$valid||(e=t[i].$name),t[i].$pristine&&(t[i].$dirty=!0));return g.info(n.entity),angular.element(".ng-invalid[name="+e+"]").focus(),void s.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}C()},reset:function(t){}};var C=function(){var t={},e=JSON.stringify(n.entity);return t.data=Base64.encode(e),u({method:"POST",url:"api/customer-employee-demographic-staging/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){l(function(){s.swal("Registro","La información ha sido guardada satisfactoriamente","success"),n.onCloseModal()})})["catch"](function(t){r.error(t),s.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};n.onSearchEmployeeList=function(){var e=h.open({templateUrl:t.app.views.urlRoot+"modules/customer/occupational/absenteeism/disability/customer_absenteeism_disability_employee_list_modal.htm",placement:"left",windowTopClass:"top-modal",size:"lg",backdrop:!0,controller:"ModalInstanceSideDisabilityEmployeeListCtrl",scope:n});e.result.then(function(t){var e=m("filter")(n.employees,{id:t.id});0==e.length&&n.employees.push(t),n.entity.employee=t},function(){})}}]);
"use strict";app.controller("customerEmployeeAttachmentExportCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","$q","SweetAlert","$aside","ListService","$filter","ngNotify",function(e,t,n,o,l,c,a,i,r,s,u,d,p,m,g,h,f,y){function w(){var n=[{name:"customer_employee_document_type",value:t.customerId}];h.getDataList(n).then(function(t){e.requirements=t.data.data.customerEmployeeDocumentType,O()},function(t){e.status="Unable to load customer data: "+t.message})}e.canShowDataTable=!1,e.filter={selectedType:null},e.toggle={isChecked:!1,selectAll:!1},e.records={hasSelected:!1,countSelected:0,countSelectedAll:0};var C={},b={},v={},T=null,k="api/customer-employee-document-export";w();var D=function(){var e=[l.newColumn(null).withOption("width",30).notSortable().withClass("center").renderWith(function(e,t,n,o){var l="",c=C[e.id].selected,a=c?"checked":"";return l='<div class="checkbox clip-check check-danger "><input class="selectedRow" type="checkbox" id="chk_employee_document_select_'+e.id+'" data-id="'+e.id+'" '+a+' ><label class="padding-left-10" for="chk_employee_document_select_'+e.id+'"> </label></div>'})];return e.push(S("documentNumber","Número Identificación","",200)),e.push(S("fullName","Nombre Empleado","",200)),e.push(S("requirement","Tipo Documento","",200)),e.push(S("description","Descripción","",200)),e.push(S("startDate","Fecha Inicio","",200)),e.push(S("endDate","Fecha Fin","",200)),e.push(S("status","Estado","",200).notSortable().renderWith(function(e,t,n,o){var l="";switch(e){case"Vigente":l="label label-success";break;case"Anulado":l="label label-danger";break;case"Vencido":l="label label-warning"}var c='<span class="'+l+'">'+e+"</span>";return c})),e},S=function(e,t,n,o){return l.newColumn(e).withTitle(t).withOption("defaultContent",n).withOption("width",o)},O=function(){e.canShowDataTable=!0;var n="";e.dtOptionsCustomerEmployeeDocumentType=o.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(n){return n.customerId=t.customerId,n.requirementCode=e.filter.selectedType?e.filter.selectedType.value:0,n.requirementOrigin=e.filter.selectedType?e.filter.selectedType.origin:0,T=n,JSON.stringify(n)},dataSrc:function(t){return v=t.data.map(function(e,t,n){return e.id}),b=t.extra,angular.forEach(b,function(e,t){void 0!==C[e]&&null!==C[e]||(C[e]={selected:!1})}),e.records.currentPage=v.length,e.records.total=b.length,n!==T.search.value&&(e.toggle.isChecked=!1,e.toggle.selectAll=!1,A(b,e.toggle.isChecked,!0),n=T.search.value),t.data},url:k,contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){E()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,n,o){a(angular.element(t).contents())(e)}),e.dtColumnsCustomerEmployeeDocumentType=D()},E=function(){angular.element("#dtCustomerEmployeeDocumentType input.selectedRow").on("change",function(){var t=angular.element(this).data("id");"selectedRow"==this.className&&(C[t].selected=this.checked),u(function(){var t=0;angular.forEach(C,function(e,n){t+=e.selected?1:0}),e.records.hasSelected=t>0,e.records.countSelected=t},100)})};e.dtInstanceCustomerEmployeeDocumentTypeCallback=function(t){e.dtInstanceCustomerEmployeeDocumentType=t,e.dtInstanceCustomerEmployeeDocumentType.DataTable.on("page",function(){u(function(){e.toggle.isChecked=e.toggle.selectAll},300)}),e.dtInstanceCustomerEmployeeDocumentType.DataTable.on("order",function(){u(function(){e.toggle.isChecked=e.toggle.selectAll},300)})},e.reloadData=function(){null!=e.dtInstanceCustomerEmployeeDocumentType&&e.dtInstanceCustomerEmployeeDocumentType.reloadData(null,!1)},e.onSelectType=function(){e.reloadData(),C={},e.toggle.isChecked=!1,e.toggle.selectAll=!1,e.records.hasSelected=!1,e.records.countSelected=0},e.onDownload=function(t){y.set("El archivo se está generando.",{position:"bottom",sticky:!0,button:!1,html:!0});var n={id:Object.keys(C).filter(function(e){return C[e].selected}).map(function(e){return e}),filename:e.filter.selectedType.item},o={},l=JSON.stringify(n);o.data=Base64.encode(l),d({method:"POST",url:"api/customer-employee-document/export-by-type",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(e){var t=(e.data.path+e.data.filename,'<div class="row"><div class="col-sm-12 text-center">Por favor espere y verifique su correo y la bandeja de mensajes!</div> </div>');y.set(t,{position:"bottom",sticky:!0,type:"success",button:!0,html:!0})})["catch"](function(e){y.set(e.data.message,{position:"bottom",sticky:!0,type:"error",button:!0,html:!0})})["finally"](function(){})},e.onCancel=function(){e.onToggleShowList()},e.onToggle=function(){e.toggle.isChecked=!e.toggle.isChecked,A(v,e.toggle.isChecked)},e.onSelectCurrentPage=function(){e.toggle.isChecked=!0,e.toggle.selectAll&&(A(b,!1),e.toggle.selectAll=!1),A(v,e.toggle.isChecked)},e.onSelectAll=function(){e.toggle.isChecked=!0,e.toggle.selectAll=!0,A(b,e.toggle.selectAll)},e.onDeselectAll=function(){e.toggle.isChecked=!1,e.toggle.selectAll=!1,A(b,e.toggle.selectAll)};var A=function(t,n,o){var l=0;angular.forEach(C,function(e,c){void 0!==o&&o&&(C[c].selected=!1),t.indexOf(parseInt(c))!==-1&&(C[c].selected=n),l+=C[c].selected?1:0});var c=angular.element(".selectedRow");angular.forEach(c,function(e,t){var n=angular.element(e).data("id");angular.element(e).prop("checked",C[n].selected)}),e.records.hasSelected=l>0,e.records.countSelected=l}}]);
"use strict";app.factory("CustomerEmployeeDocumentService",function(){var t={},n=[],e=null;return t.setDocuments=function(t){e=0,n=t},t.getCurrentDocumentId=function(){return n[e]},t.isFirstDocument=function(){return 0==e},t.isLastDocument=function(){return e==n.length-1},t.goTo=function(t){return e=t-1,n[e]},t.getNextDocumentId=function(){return e+=1,n[e]},t.getPreviousDocumentId=function(){return e-=1,n[e]},t.getCurrentDocumentOrdinal=function(){return e+1},t.getTotalDocuments=function(){return n.length},t});
"use strict";app.controller("customerEmployeeDocumentCtrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout",function(e,o,t,n,c,i){e.employee_document_section="list",e.currentId=0,e.editMode="create";var u=c.$on("employeeDocumentNavigate",function(o,t){e.navToSection(t.newValue,"edit",0)});e.$on("$destroy",function(){u()}),e.navToSection=function(o,t,n){console.log(o),i(function(){e.employee_document_section=o,e.editMode=t,e.$parent.switchSubTab(t),e.currentId=n})}}]);
"use strict";app.controller("customerEmployeeDocumentListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","SweetAlert","$http","$filter","$document","FileUploader","$aside","$localStorage","$ngConfirm","ngNotify","ListService","$uibModal","CustomerEmployeeService",function(e,t,n,o,a,i,r,l,c,s,d,u,m,p,f,h,w,g,v,C,b,y,D){function A(){var n=[{name:"customer_employee_document_type",value:t.customerId}];b.getDataList(n).then(function(t){e.requirements=t.data.data.customerEmployeeDocumentType,e.requirements=e.requirements.filter(function(e){return 1==e.isVisible})},function(t){e.status="Unable to load customer data: "+t.message})}var _={},k=0;e.$storage=g.$default({hideCanceled:!0}),e.isAgent="agent"==s.currentUser().wg_type,e.isAdmin="system"==s.currentUser().wg_type,e.isCustomer="customerAdmin"==s.currentUser().wg_type||"customerUser"==s.currentUser().wg_type,e.isView=!s.canEditRoot||"view"==e.$parent.editMode,e.canValidateDocument=s.can("empleado_documento_approved_revised")||s.can("empleado_documento_reviewed_denied"),e.showAuthorized=s.can("empleado_documento_authorize"),e.documentStatus=s.parameters("customer_document_status"),e.isInvalidate=!1,e.customerId=t.customerId,e.downloadUrl="",A();var O=function(){e.attachment={id:0,customerEmployeeId:e.$parent.currentEmployee,requirement:null,status:e.documentStatus&&e.documentStatus.length>0?e.documentStatus[0]:null,version:1,description:"",startDate:null,endDate:null},e.employee={id:e.$parent.currentEmployee,isAuthorized:D.getAuthorization()}};O(),e.$watch("$parent.currentEmployee",function(){O()});var E=function(t){var n={id:t};m({method:"GET",url:"api/customer-employee/document",params:n})["catch"](function(e){}).then(function(t){d(function(){e.attachment=t.data.result,e.attachment.version=parseInt(e.attachment.version)+1,T()})})["finally"](function(){d(function(){e.loading=!1},400)})};e.master=e.attachment,e.form={submit:function(t){var n=null;if(t.$invalid){var o=null,n=null;for(o in t)"$"!=o[0]&&(null!==n||t[o].$valid||(n=t[o].$name),t[o].$pristine&&(t[o].$dirty=!0));return angular.element(".ng-invalid[name="+n+"]").focus(),void u.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}return 0==e.uploader.queue.length?void u.swal("El formulario contiene errores!","Por favor seleccione un anexo e Intentalo de nuevo.","error"):void S()},reset:function(t){e.attachment=angular.copy(e.master),t.$setPristine(!0)}};var S=function(){var t={},o=JSON.stringify(e.attachment);return t.data=Base64.encode(o),m({method:"POST",url:"api/customer-employee/document/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){d(function(){e.attachment=t.data.result,k=t.data.result.id,I.uploadAll()})})["catch"](function(e){n.error(e),u.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){e.reloadData()})},T=function(){null!=e.attachment.startDate&&(e.attachment.startDate=new Date(e.attachment.startDate.date)),null!=e.attachment.endDate&&(e.attachment.endDate=new Date(e.attachment.endDate.date))},I=e.uploader=new h({url:"api/customer-employee/document/upload",formData:[],removeAfterUpload:!0});I.filters.push({name:"customFilter",fn:function(e,t){return this.queue.length<10}}),I.onWhenAddingFileFailed=function(e,t,n){console.info("onWhenAddingFileFailed",e,t,n)},I.onAfterAddingFile=function(e){console.info("onAfterAddingFile",e)},I.onAfterAddingAll=function(e){console.info("onAfterAddingAll",e)},I.onBeforeUploadItem=function(e){console.info("onBeforeUploadItem",e);var t={id:k};e.formData.push(t)},I.onProgressItem=function(e,t){console.info("onProgressItem",e,t)},I.onProgressAll=function(e){console.info("onProgressAll",e)},I.onSuccessItem=function(e,t,n,o){console.info("onSuccessItem",e,t,n,o)},I.onErrorItem=function(e,t,n,o){console.info("onErrorItem",e,t,n,o)},I.onCancelItem=function(e,t,n,o){console.info("onCancelItem",e,t,n,o)},I.onCompleteItem=function(e,t,n,o){console.info("onCompleteItem",e,t,n,o)},I.onCompleteAll=function(){console.info("onCompleteAll"),e.reloadData(),e.clear(),u.swal("Acción exitosa","Se guardó satisfactoriamente","success")},e.clear=function(){O(),e.isInvalidate=!1},e.onAuthChange=function(){if(D.setAuthorization(e.employee.isAuthorized),e.employee.reason=null,D.getLastAuthorization()!=D.getAuthorization()){var t=y.open({templateUrl:s.app.views.urlRoot+"modules/customer/employee/customer_employee_authorization_reason_modal.htm",controller:"customerEmployeeAuthorizationModalCtrl",windowTopClass:"top-modal",resolve:{}});t.result.then(function(t){e.employee.reason=t,D.saveAuth(e.employee).then(function(t){D.setLastAuthorization(e.employee.isAuthorized),D.setAuthorization(e.employee.isAuthorized),s.$emit("isAuthorizedChangeInDocument",{newValue:e.employee.isAuthorized})},function(t){e.status="Unable to load customer data: "+t.message})},function(){})}};var x=s.$on("isAuthorizedChangeInBasic",function(t,n){e.employee.isAuthorized=n.newValue});e.$on("$destroy",function(){x()}),_.operation="document",_.customer_employee_id=e.$parent.currentEmployee,_.customer_id=e.customerId,_.hideCanceled=e.$storage.hideCanceled?1:0,e.dtInstanceCustomerEmployeeDocument={},e.dtOptionsCustomerEmployeeDocument=o.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.operation="document",t.customerEmployeeId=e.$parent.currentEmployee,e.$storage.hideCanceled&&(t.statusCode="2"),JSON.stringify(t)},url:"api/customer-employee-document",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){V()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,n,o){r(angular.element(t).contents())(e)}),e.dtColumnsCustomerEmployeeDocument=[a.newColumn(null).withTitle("Acciones").withOption("width",200).notSortable().renderWith(function(t,n,o,a){var i=null!=t.documentUrl?t.documentUrl:"",r="",l='<a target="_self" class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Descargar anexo" data-id="'+t.id+'" data-url="'+i+'" >   <i class="fa fa-download"></i></a> ',c='<a class="btn btn-info btn-xs viewRow lnk" target="_blank" href="'+i+'" uib-tooltip="Abrir anexo" data-id="'+t.id+'" >   <i class="fa fa-folder-open-o"></i></a> ',d='<a class="btn btn-light-red btn-xs delRow lnk" href="#" uib-tooltip="Anular anexo" data-id="'+t.id+'" >   <i class="fa fa-ban"></i></a> ',u=!e.isView;if(s.can("empleado_documento_open")&&""!=i&&(r+=c),s.can("empleado_documento_download")&&""!=i&&(r+=l),s.can("empleado_documento_invalidate")&&("Vigente"!=t.status&&"Vencido"!=t.status||(r+=d)),e.isAdmin||e.isAgent||e.$parent.isCustomerContractor){var m="",p="";"Aprobado"==t.isVerified?m="disabled='true' ":"Denegado"==t.isVerified&&(p="disabled='true' ");var f=' | <a class="btn btn-success btn-xs approve lnk" href="#" uib-tooltip="Revisado Aprobado" data-id="'+t.id+'"'+m+' >   <i class="fa fa-check"></i></a> ',h='<a class="btn btn-dark-yellow btn-xs noApprove lnk" href="#" uib-tooltip="Revisado Denegado" data-id="'+t.id+'"'+p+'  >   <i class="fa fa-trash-o"></i></a> ';s.can("empleado_documento_approved_revised")&&(r+=f),s.can("empleado_documento_reviewed_denied")&&(r+=h)}return u?r:c+l}),a.newColumn("requirement").withTitle("Tipo Documento").withOption("width",200),a.newColumn("description").withTitle("Descripción").withOption("width",200),a.newColumn("startDate").withTitle("Fecha de Inicio Vigencia").withOption("width",200),a.newColumn("endDate").withTitle("Fecha de Finalización Vigencia").withOption("width",200),a.newColumn("version").withTitle("Versión").withOption("width",200),a.newColumn(null).withTitle("Requerido").withOption("width",200).notSortable().renderWith(function(e,t,n,o){var a="",i="1"==e.isRequiredCode?"checked":"",r="1"==e.isRequiredCode?"Si":"No",l='<div class="checkbox clip-check check-success "><input class="editRow" ng-disabled="true" disabled="true" type="checkbox" id="chk_'+e.id+'" data-id="'+e.id+'" '+i+' ><label for="chk_'+e.id+'">'+r+"</label></div>";return a+=l}).notSortable(),a.newColumn("status").withTitle("Estado").withOption("width",200).renderWith(function(e,t,n,o){var a="";switch(e){case"Vigente":a="label label-success";break;case"Anulado":a="label label-danger";break;case"Vencido":a="label label-warning"}var i='<span class="'+a+'">'+e+"</span>";return i}),a.newColumn("isVerified").withTitle("Verificado").withOption("width",200).renderWith(function(e,t,n,o){var a="";switch(e){case"Aprobado":a="label label-success";break;case"Denegado":a="label label-danger"}var i='<span class="'+a+'">'+e+"</span>";return i}),a.newColumn("observation").withTitle("Motivo Denegado").withOption("width",200)];var V=function(){$("#dtCustomerEmployeeDocument a.editRow").on("click",function(){var e=$(this).data("id"),t=$(this).data("url");""==t?l.pop("error","Error en la descarga","No existe un anexo para descargar"):jQuery("#download")[0].src="api/customer-employee/document/download?id="+e}),$("#dtCustomerEmployeeDocument a.delRow").on("click",function(){var t=$(this).data("id");v({boxWidth:"35%",useBootstrap:!1,animation:"bottom",closeAnimation:"scale",title:"Está seguro?",content:"<strong>Anulará</strong> el anexo seleccionado",scope:e,type:"red",typeAnimated:!0,buttons:{cancel:{text:"Anular y cambiar versión",btnClass:"btn-primary",action:function(n,o){e.attachment.id=t,e.isView=!1,E(t),l.pop("info","Anulación Anexo","El anexo se cargó satisfactoriamente, seleccione una nueva versión del documento")}},fullCancel:{text:"Anular definitivamente",btnClass:"btn-red",action:function(o,a){var i={};i.id=t,m({method:"POST",url:"api/customer-employee/document/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(t){swal("Eliminado","Anexo anulado satisfactoriamente","info"),e.reloadData()})["catch"](function(e){n.error(e),u.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}},closeAll:{text:"Cancelar",btnClass:"btn-default",action:function(e,t){}}}})}),$("#dtCustomerEmployeeDocument a.approve").on("click",function(){var t=$(this).data("id");u.swal({title:"Está seguro?",text:"El documento sera marcado como revisado aprobado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, aprobar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(o){if(o){var a={},i={id:t},r=JSON.stringify(i);return a.data=Base64.encode(r),m({method:"POST",url:"api/customer-employee/document/approve",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(t){d(function(){u.swal("Validación exitosa","Documento revisado aprobado...","success"),e.reloadData()})})["catch"](function(e){n.error(e),u.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})}swal("Cancelación","La operación ha sido cancelada","error")})}),$("#dtCustomerEmployeeDocument a.noApprove").on("click",function(){var t=$(this).data("id"),o=($(this).data("url"),{id:t,tracking:{action:"",description:""}}),a=y.open({templateUrl:s.app.views.urlRoot+"modules/customer/employee/document/customer_employee_tab_attachment_denied_modal.htm",controller:"ModalInstanceDeniedCtrl",windowTopClass:"top-modal",resolve:{document:function(){return o},action:function(){return"Revisado Denegado"}}});a.result.then(function(t){e.selected=t},function(){n.info("Modal dismissed at: "+new Date),e.reloadData()})})};e.onValidateDocument=function(){var t=w.open({templateUrl:s.app.views.urlRoot+"modules/customer/employee/document/customer_employee_tab_attachment_filter_modal.htm",placement:"right",windowTopClass:"top-modal",size:"lg",backdrop:"static",controller:"ModalInstanceFilterdCtrl",resolve:{},scope:e});t.result.then(function(t){e.selected=t},function(){n.info("Modal dismissed at: "+new Date)})},e.dtInstanceCustomerEmployeeDocumentCallback=function(t){e.dtInstanceCustomerEmployeeDocument=t},e.reloadData=function(){e.dtInstanceCustomerEmployeeDocument.reloadData()},e.onShowCancelledChange=function(){_.hideCanceled=e.$storage.hideCanceled?1:0,e.reloadData()}}]),app.controller("ModalInstanceDeniedCtrl",["$scope","$uibModalInstance","document","action","$log","$timeout","SweetAlert","$http",function(e,t,n,o,a,i,r,l){e.document=n,e.document.tracking={action:o,description:""},e.onClose=function(){t.close(1)},e.onCancel=function(){t.dismiss("cancel")},e.onSave=function(){c()};var c=function(){var t={},n=JSON.stringify(e.document);return t.data=Base64.encode(n),l({method:"POST",url:"api/customer-employee/document/denied",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){i(function(){r.swal("Validación exitosa","Procediendo con el guardado...","success"),e.onCancel()})})["catch"](function(e){a.error(e),r.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})}}]),app.controller("ModalInstanceFilterdCtrl",["$rootScope","$scope","$uibModalInstance","$log","$timeout","SweetAlert","$http","DTColumnBuilder","DTOptionsBuilder","$compile","CustomerEmployeeDocumentService","ListService",function(e,t,n,o,a,i,r,l,c,s,d,u){function m(){var e=[{name:"customer_document_status",value:null},{name:"yes_no_options",value:null},{name:"customer_document_verified",value:null}];u.getDataList(e).then(function(e){t.statusList=e.data.data.customer_document_status.filter(function(e,t,n){return 2!=e.value}),t.requiredList=e.data.data.activeOptions.map(function(e,t,n){return{item:e.name,value:e.value}}),t.verifiedList=e.data.data.customer_document_verified.map(function(e,t,n){return{item:e.name,value:e.value}})},function(e){t.status="Unable to load customer data: "+e.message})}var p=null,f="";t.toggle={isChecked:!1,selectAll:!1},t.records={hasSelected:!1,countSelected:0,countSelectedAll:0};var h={},w={},g={},v=function(){t.filter={status:null,required:null,verified:null}};v(),m(),t.onClose=function(){n.close(1)},t.onCancel=function(){n.dismiss("cancel")},t.onClearFilter=function(){v(),t.reloadData()},t.onContinue=function(){var t=[];angular.forEach(h,function(e,n){h[n].selected&&t.push(n)}),d.setDocuments(t),e.$emit("employeeDocumentNavigate",{newValue:"validate"})},t.dtOptionsCustomerEmployeeDocumentFilter=c.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerEmployeeId=t.$parent.currentEmployee,e.statusCode="2",e.filter={filters:b()},p=e,JSON.stringify(e)},dataSrc:function(e){return g=e.data.map(function(e,t,n){return e.id}),w=e.extra,angular.forEach(w,function(e,t){void 0!==h[e]&&null!==h[e]||(h[e]={selected:!1})}),t.records.currentPage=g.length,t.records.total=w.length,f!==p.search.value&&(t.toggle.isChecked=!1,t.toggle.selectAll=!1,D(w,t.toggle.isChecked,!0),f=p.search.value),e.data},url:"api/customer-employee-document-filter",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){C()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,n,o){s(angular.element(e).contents())(t)}),t.dtColumnsCustomerEmployeeDocumentFilter=[l.newColumn(null).withOption("width",30).notSortable().withClass("center").renderWith(function(e,t,n,o){var a="";if("RT"!=e.statusCode){var i=h[e.id].selected,r=i?"checked":"";a='<div class="checkbox clip-check check-danger "><input class="selectedRow" type="checkbox" id="chk_participant_select_'+e.id+'" data-id="'+e.id+'" '+r+' ><label class="padding-left-10" for="chk_participant_select_'+e.id+'"> </label></div>'}return a}),l.newColumn("requirement").withTitle("Tipo Documento").withOption("width",200),l.newColumn("description").withTitle("Descripción").withOption("width",200),l.newColumn("startDate").withTitle("Fecha de Inicio Vigencia").withOption("width",200),l.newColumn("endDate").withTitle("Fecha de Finalización Vigencia").withOption("width",200),l.newColumn("version").withTitle("Versión").withOption("width",200),l.newColumn(null).withTitle("Requerido").withOption("width",200).notSortable().renderWith(function(e,t,n,o){var a="",i="1"==e.isRequiredCode?"checked":"",r="1"==e.isRequiredCode?"Si":"No",l='<div class="checkbox clip-check check-success "><input class="editRow" ng-disabled="true" type="checkbox" id="chk_'+e.id+'" data-id="'+e.id+'" '+i+' ><label for="chk_'+e.id+'">'+r+"</label></div>";return a+=l}).notSortable(),l.newColumn("status").withTitle("Estado").withOption("width",200).renderWith(function(e,t,n,o){var a="";switch(e){case"Vigente":a="label label-success";break;case"Anulado":a="label label-danger";break;case"Vencido":a="label label-warning"}var i='<span class="'+a+'">'+e+"</span>";return i}),l.newColumn("isVerified").withTitle("Verificado").withOption("width",200).renderWith(function(e,t,n,o){var a="";switch(e){case"Aprobado":a="label label-success";break;case"Denegado":a="label label-danger"}var i='<span class="'+a+'">'+e+"</span>";return i}),l.newColumn("observation").withTitle("Motivo Denegado").withOption("width",200)];var C=function(){angular.element("#dtCustomerEmployeeDocumentFilter input.selectedRow").on("change",function(){var e=angular.element(this).data("id");"selectedRow"==this.className&&(h[e].selected=this.checked),a(function(){var e=0;angular.forEach(h,function(t,n){e+=t.selected?1:0}),t.records.hasSelected=e>0,t.records.countSelected=e},100)})},b=function(){var e=[];return t.filter.status&&e.push(y("statusCode","eq","and",t.filter.status.value)),t.filter.required&&e.push(y("isRequiredCode","eq","and",t.filter.required.value)),t.filter.verified&&e.push(y("isVerified","eq","and",t.filter.verified.value)),e},y=function(e,t,n,o){return{field:e,operator:t,condition:n,value:o}};t.dtInstanceCustomerEmployeeDocumentFilter={},t.dtInstanceCustomerEmployeeDocumentFilterCallback=function(e){t.dtInstanceCustomerEmployeeDocumentFilter=e},t.reloadData=function(){t.dtInstanceCustomerEmployeeDocumentFilter.reloadData()},t.onToggle=function(){t.toggle.isChecked=!t.toggle.isChecked,D(g,t.toggle.isChecked)},t.onSelectCurrentPage=function(){t.toggle.isChecked=!0,t.toggle.selectAll&&(D(w,!1),t.toggle.selectAll=!1),D(g,t.toggle.isChecked)},t.onSelectAll=function(){t.toggle.isChecked=!0,t.toggle.selectAll=!0,D(w,t.toggle.selectAll)},t.onDeselectAll=function(){t.toggle.isChecked=!1,t.toggle.selectAll=!1,D(w,t.toggle.selectAll)};var D=function(e,n,o){var a=0;angular.forEach(h,function(t,i){void 0!==o&&o&&(h[i].selected=!1),e.indexOf(parseInt(i))!==-1&&(h[i].selected=n),a+=h[i].selected?1:0});var i=angular.element(".selectedRow");angular.forEach(i,function(e,t){var n=angular.element(e).data("id");angular.element(e).prop("checked",h[n].selected)}),t.records.hasSelected=a>0,t.records.countSelected=a}}]);
"use strict";app.controller("customerEmployeeDocumentValidateCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","SweetAlert","$http","$filter","$document","FileUploader","$aside","$localStorage","$ngConfirm","ngNotify","ListService","CustomerEmployeeDocumentService","pdfDelegate",function(t,e,n,a,o,r,i,c,u,s,l,d,m,f,p,g,v,h,D,y,w,_,S){function C(){var n=[{name:"customer_employee_document_type",value:e.customerId},{name:"customer_employee_document_management",value:null}];w.getDataList(n).then(function(e){t.originalStatusList=e.data.data.customer_employee_document_management,t.requirements=e.data.data.customerEmployeeDocumentType,E()},function(e){t.status="Unable to load customer data: "+e.message})}t.$storage=h.$default({hideCanceled:!0}),t.isAgent="agent"==s.currentUser().wg_type,t.isAdmin="system"==s.currentUser().wg_type,t.isCustomer="customerAdmin"==s.currentUser().wg_type||"customerUser"==s.currentUser().wg_type,t.queryStringExtra=null,t.isView=!0,t.isFirst=_.isFirstDocument(),t.isLast=_.isLastDocument(),t.currentDocumentOrdinal=_.getCurrentDocumentOrdinal(),t.totalDocuments=_.getTotalDocuments(),t.isBackNavigationVisible=!0,t.canValidateDocument=s.can("empleado_documento_approved_revised")||s.can("empleado_documento_reviewed_denied"),t.documentStatus=s.parameters("customer_document_status"),t.isInvalidate=!1,t.customerId=e.customerId,t.downloadUrl="",t.originalStatusList=[],C();var E=function(){t.statusList=t.originalStatusList.filter(function(e,n,a){if(t.isAdmin||t.isAgent||t.$parent.isCustomerContractor){var o=t.attachment&&t.attachment.isVerified?t.attachment.isVerified:null;return 1==e.value&&s.can("empleado_documento_approved_revised")&&"Aprobado"!=o||3==e.value&&s.can("empleado_documento_reviewed_denied")&&"Denegado"!=o}return!1})},x=function(){t.attachment={id:0,customerEmployeeId:t.$parent.currentEmployee,requirement:null,status:t.documentStatus&&t.documentStatus.length>0?t.documentStatus[0]:null,version:1,description:"",startDate:null,endDate:null,tracking:{action:null,description:""}}};x();var I=function(e){var n={},a=JSON.stringify({id:e,customerId:t.customerId});n.data=Base64.encode(a),t.queryStringExtra=null,t.isImage=!1,t.hasFile=!1,t.isLoading=!0,m({method:"POST",url:"api/customer-employee-document/get",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)})["catch"](function(t){}).then(function(e){t.isLoading=!1,l(function(){t.attachment=e.data.result,t.hasFile=null!=t.attachment.document,t.attachment.document&&"pdf"==t.attachment.document.extension?(t.queryStringExtra=s.app.rootUrl+"api/customer-employee/document/stream?id="+t.attachment.id,l(function(){S.$getByHandle("pdf-container").load(t.queryStringExtra)},100)):t.attachment.document&&t.attachment.document.content_type.startsWith("image")?t.isImage=!0:(t.isImage=!1,t.queryStringExtra=null),L(),E()})})["finally"](function(){l(function(){t.loading=!1},400)})};I(_.getCurrentDocumentId());var L=function(){null!=t.attachment.startDate&&(t.attachment.startDate=new Date(t.attachment.startDate.date)),null!=t.attachment.endDate&&(t.attachment.endDate=new Date(t.attachment.endDate.date))};t.$watch("$parent.currentEmployee",function(){x()}),t.form={submit:function(e){var n=null;if(e.$invalid){var a=null,n=null;for(a in e)"$"!=a[0]&&(null!==n||e[a].$valid||(n=e[a].$name),e[a].$pristine&&(e[a].$dirty=!0));return angular.element(".ng-invalid[name="+n+"]").focus(),void d.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}1==t.attachment.tracking.status.value?B():O()},reset:function(t){t.$setPristine(!0)}};var O=function(){var e={};t.attachment.tracking.action=t.attachment.tracking.status.item;var a=JSON.stringify(t.attachment);return e.data=Base64.encode(a),m({method:"POST",url:"api/customer-employee/document/denied",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){l(function(){d.swal("Validación exitosa","Documento revisado denegado...","success"),t.attachment.isVerified="Denegado",t.attachment.observation=t.attachment.tracking.description,E(),t.attachment.tracking=null})})["catch"](function(t){n.error(t),d.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})},B=function(){d.swal({title:"Está seguro?",text:"El documento sera marcado como revisado aprobado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, aprobar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(e){if(e){var a={},o={id:t.attachment.id},r=JSON.stringify(o);return a.data=Base64.encode(r),m({method:"POST",url:"api/customer-employee/document/approve",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(e){l(function(){d.swal("Validación exitosa","Documento revisado aprobado...","success"),t.attachment.isVerified="Aprobado",E(),t.attachment.tracking=null,t.attachment.observation=null})})["catch"](function(t){n.error(t),d.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})}swal("Cancelación","La operación ha sido cancelada","error")})};t.onBack=function(t){s.$emit("employeeDocumentNavigate",{newValue:"list"})},t.onContinue=function(e){if(e.$invalid){var n=null,a=null;for(n in e)"$"!=n[0]&&(null!==a||e[n].$valid||(a=e[n].$name),e[n].$pristine&&(e[n].$dirty=!0));return angular.element(".ng-invalid[name="+a+"]").focus(),void d.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}e.$dirty&&(1==t.attachment.tracking.status.value?B():O(),e.$setPristine(!0))},t.onNext=function(e){l(function(){I(_.getNextDocumentId()),t.isFirst=_.isFirstDocument(),t.isLast=_.isLastDocument(),t.currentDocumentOrdinal=_.getCurrentDocumentOrdinal()},100)},t.onPrevious=function(e){l(function(){I(_.getPreviousDocumentId()),t.isFirst=_.isFirstDocument(),t.isLast=_.isLastDocument(),t.currentDocumentOrdinal=_.getCurrentDocumentOrdinal()},100)},t.onDownload=function(){jQuery("#download")[0].src="api/customer-employee/document/download?id="+t.attachment.id},t.onSelectStatus=function(){t.attachment.tracking.description=null}}]);
"use strict";app.controller("customerEmployeeDocumentCriticalListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","SweetAlert","$http","$timeout","$aside",function(e,t,n,o,i,r,a,u,c,l,s,d,m,p){e.isView=e.$parent.isCustomerContractor||"view"==e.$parent.editMode,e.isAgent="agent"==l.currentUser().wg_type,e.isAdmin="system"==l.currentUser().wg_type,e.isCustomer="customerAdmin"==l.currentUser().wg_type||"customerUser"==l.currentUser().wg_type,e.document={id:0,customerEmployeeId:e.$parent.currentEmployee},e.dtInstanceDocumentCritical={},e.dtOptionsDocumentCritical=o.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.operation="document",t.customerEmployeeId=e.$parent.currentEmployee,t.criticalActivityCustomerEmployeeId=e.$parent.currentEmployee,JSON.stringify(t)},url:"api/customer-employee-document-required-critical",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){f()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,n,o){a(angular.element(t).contents())(e)}),e.dtColumnsDocumentCritical=[i.newColumn(null).withTitle("Acciones").withOption("width",80).notSortable().renderWith(function(t,n,o,i){var r='<a class="btn btn-info btn-xs viewRow lnk" href="#"  uib-tooltip="Adicionar documento" data-id="'+t.id+'" >   <i class="fa fa-plus"></i></a> ';return e.isView?"":r}),i.newColumn("documentType").withTitle("Tipo Documento").withOption("defaultContent","")];var f=function(){angular.element("#dtDocumentCritical a.viewRow").on("click",function(){var t=angular.element(this).data("id");e.document.id=t,e.onAddDocument()})};e.dtInstanceDocumentCriticalCallback=function(t){e.dtInstanceDocumentCritical=t},e.reloadData=function(){e.dtInstanceDocumentCritical.reloadData()},e.dtInstanceDocumentRequired={},e.dtOptionsDocumentRequired=o.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(n){return n.operation="document",n.customerEmployeeId=e.$parent.currentEmployee,n.customerId=t.customerId,n.isRequired=1,JSON.stringify(n)},url:"api/customer-employee-document-required",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){w()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,n,o){a(angular.element(t).contents())(e)}),e.dtColumnsDocumentRequired=[i.newColumn(null).withTitle("Acciones").withOption("width",80).notSortable().renderWith(function(t,n,o,i){var r='<a class="btn btn-info btn-xs viewRow lnk" href="#"  uib-tooltip="Adicionar documento" data-id="'+t.id+'" >   <i class="fa fa-plus"></i></a> ';return e.isView?"":r}),i.newColumn("documentType").withTitle("Tipo Documento").withOption("defaultContent","")];var w=function(){angular.element("#dtDocumentRequired a.viewRow").on("click",function(){var t=angular.element(this).data("id");e.document.id=t,e.onAddDocument()})};e.dtInstanceDocumentRequiredCallback=function(t){e.dtInstanceDocumentRequired=t},e.reloadRequiredData=function(){e.dtInstanceDocumentRequired.reloadData()},e.onAddDocument=function(){var t=p.open({templateUrl:l.app.views.urlRoot+"modules/customer/employee/document-critical-activity/customer_employee_tab_attachment_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideEmployeeDocumentCriticalCtrl",scope:e,resolve:{document:function(){return e.document},customert:function(){return e.customer}}});t.result.then(function(){e.reloadData(),e.reloadRequiredData()})}}]),app.controller("ModalInstanceSideEmployeeDocumentCriticalCtrl",["$stateParams","$rootScope","$scope","$uibModalInstance","customert","document","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile","$document","ListService",function(e,t,n,o,i,r,a,u,c,l,s,d,m,p,f,w,h,g){function v(){var t=[{name:"customer_employee_document_type",value:e.customerId}];g.getDataList(t).then(function(e){n.requirements=e.data.data.customerEmployeeDocumentType,C()},function(e){n.status="Unable to load customer data: "+e.message})}var y=a,D=0;y.info("loading..customerEmployeeDocumentListCtrl "),n.isAgent="agent"==t.currentUser().wg_type,n.isAdmin="system"==t.currentUser().wg_type,n.isCustomer="customerAdmin"==t.currentUser().wg_type||"customerUser"==t.currentUser().wg_type,n.documentStatus=t.parameters("customer_document_status"),n.isView=n.$parent.isCustomerContractor||"view"==n.$parent.editMode,n.isInvalidate=!1,n.customerId=e.customerId,n.downloadUrl="",n.onCloseModal=function(){o.close(1)},n.onCancelDocument=function(){o.dismiss("cancel")},v();var C=function(){n.attachment={id:0,customerEmployeeId:r.customerEmployeeId,requirement:null,status:n.documentStatus&&n.documentStatus.length>0?n.documentStatus[0]:null,version:1,description:"",startDate:null,endDate:null},angular.forEach(n.requirements,function(e,t){e.value==r.id&&(n.attachment.requirement=e)})};n.master=n.attachment,n.form={submit:function(e){var t=null;if(e.$invalid){var o=null,t=null;for(o in e)"$"!=o[0]&&(null!==t||e[o].$valid||(t=e[o].$name),e[o].$pristine&&(e[o].$dirty=!0));return angular.element(".ng-invalid[name="+t+"]").focus(),void c.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}return 0==n.uploader.queue.length?void c.swal("El formulario contiene errores!","Por favor seleccione un anexo e Intentalo de nuevo.","error"):(c.swal("Validación exitosa","Procediendo con el guardado...","success"),void I())},reset:function(e){n.attachment=angular.copy(n.master),e.$setPristine(!0)}};var I=function(){var e={},t=JSON.stringify(n.attachment);return e.data=Base64.encode(t),l({method:"POST",url:"api/customer-employee/document/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){u(function(){n.attachment=e.data.result,D=e.data.result.id,A.uploadAll()})})["catch"](function(e){a.error(e),c.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){n.onCloseModal()})},A=n.uploader=new m({url:"api/customer-employee/document/upload",formData:[],removeAfterUpload:!0});A.filters.push({name:"customFilter",fn:function(e,t){return this.queue.length<10}}),A.onWhenAddingFileFailed=function(e,t,n){console.info("onWhenAddingFileFailed",e,t,n)},A.onAfterAddingFile=function(e){console.info("onAfterAddingFile",e)},A.onAfterAddingAll=function(e){console.info("onAfterAddingAll",e)},A.onBeforeUploadItem=function(e){console.info("onBeforeUploadItem",e);var t={id:D};e.formData.push(t)},A.onProgressItem=function(e,t){console.info("onProgressItem",e,t)},A.onProgressAll=function(e){console.info("onProgressAll",e)},A.onSuccessItem=function(e,t,n,o){console.info("onSuccessItem",e,t,n,o)},A.onErrorItem=function(e,t,n,o){console.info("onErrorItem",e,t,n,o)},A.onCancelItem=function(e,t,n,o){console.info("onCancelItem",e,t,n,o)},A.onCompleteItem=function(e,t,n,o){console.info("onCompleteItem",e,t,n,o)},A.onCompleteAll=function(){console.info("onCompleteAll"),n.reloadData(),n.clear()},n.clear=function(){C(),n.isInvalidate=!1}}]);
"use strict";app.controller("customerEmployeeDemographicCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","SweetAlert","$http","$timeout","$aside",function(e,n,o,a,r,t,i,l,s,c,d,p,u,m){function f(){e.typeHousings=c.parameters("type_housing"),e.antiquities=c.parameters("antiquity"),e.frequencies=c.parameters("frequency"),e.genders=c.parameters("gender"),e.stratumList=c.parameters("stratum"),e.civilStatusList=c.parameters("civil_status"),e.scholarshipList=c.parameters("scholarship"),e.raceList=c.parameters("race"),e.workAreaList=c.parameters("work_area")}var h={employee_id:e.$parent.currentEmployee},w={employee_id:e.$parent.currentEmployee},g={employee_id:e.$parent.currentEmployee};e.dateConfig={culture:"es-CO",format:"dd/MM/yyyy"},e.isView=e.$parent.isCustomerContractor||"view"==e.$parent.editMode,e.demographic={id:e.$parent.currentEmployee,averageIncome:"",typeHousing:null,antiquityCompany:null,antiquityJob:null,hasPeopleInCharge:!1,qtyPeopleInCharge:0,hasChildren:!1,isPracticeSports:!1,frequencyPracticeSports:null,isDrinkAlcoholic:!1,frequencyDrinkAlcoholic:null,isSmokes:!1,frequencySmokes:null,isDiagnosedDisease:!0,gender:null,stratum:null,civilStatus:null,scholarship:null,race:null,workingHoursPerDay:null,workArea:null,age:null,country:null,state:null,city:null,illnesses:[]};var y=function(){e.hobby={name:""},e.disease={name:""},e.child={id:0,employeeId:e.$parent.currentEmployee,name:"",lastName:"",age:0},e.info={id:0,employeeId:e.$parent.currentEmployee,category:"",item:"",value:""}};y(),f(),e.form={submit:function(e){var n=null;if(e.$invalid){var o=null,n=null;for(o in e)"$"!=o[0]&&(null!==n||e[o].$valid||(n=e[o].$name),e[o].$pristine&&(e[o].$dirty=!0));return angular.element(".ng-invalid[name="+n+"]").focus(),void d.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}v()},reset:function(e){e.$setPristine(!0)}};var v=function(){var n={},a=JSON.stringify(e.demographic);return n.data=Base64.encode(a),p({method:"POST",url:"api/customer-employee/save-demographic",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(e){d.swal("Registro","La información ha sido guardada satisfactoriamente","success")})["catch"](function(e){o.error(e),l.pop("error","Error","Error guardando el registro. Por favor verifique los datos ingresados!")})["finally"](function(){e.onClear()})},C=function(n){if(n){var o={id:n};p({method:"GET",url:"api/customer-employee",params:o})["catch"](function(n,o){403==o?(l.pop("error","No Autorizado","No esta autorizado para ver esta informaci�n."),u(function(){e.onCancel()},3e3)):404==o?(l.pop("error","Informaci�n no disponible","Registro no encontrado."),u(function(){e.onCancel()})):l.pop("error","Error","Se ha presentado un error al intentar acceder a la informaci�n.")}).then(function(n){u(function(){e.demographic=n.data.result.entity,e.demographic.occupation=n.data.result.occupation})})["finally"](function(){e.onClear()})}};e.onClear=function(){y()},C(e.$parent.currentEmployee),e.onCancel=function(){s.go("app.employee")},e.onSaveChild=function(){if(""==e.child.name||""==e.child.lastName)return void d.swal("El formulario contiene errores!","Por favor ingrese el nombre y/o apellido de la persona a cargo.","error");var n={},a=JSON.stringify(e.child);return n.data=Base64.encode(a),p({method:"POST",url:"api/employee-children/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(e){})["catch"](function(e){o.error(e),l.pop("error","Error","Error guardando el registro. Por favor verifique los datos ingresados!")})["finally"](function(){e.onClear(),e.reloadDataPeopleInCharge()})},e.onSaveHobby=function(){var n={};if(""==e.hobby.name)return void d.swal("El formulario contiene errores!","Por favor ingrese la actividad.","error");e.info.category="hobby",e.info.value=e.hobby.name;var a=JSON.stringify(e.info);return n.data=Base64.encode(a),p({method:"POST",url:"api/employee-demographic/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(e){})["catch"](function(e){o.error(e),l.pop("error","Error","Error guardando el registro. Por favor verifique los datos ingresados!")})["finally"](function(){e.onClear(),e.reloadDataHobbies()})},e.onSaveDisease=function(){var n={};if(""==e.disease.name)return void d.swal("El formulario contiene errores!","Por favor ingrese la enfermedad.","error");e.info.category="disease",e.info.value=e.disease.name;var a=JSON.stringify(e.info);return n.data=Base64.encode(a),p({method:"POST",url:"api/employee-demographic/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(e){})["catch"](function(e){o.error(e),l.pop("error","Error","Error guardando el registro. Por favor verifique los datos ingresados!")})["finally"](function(){e.onClear(),e.reloadDataDiseases()})},e.dtInstanceEmployeePeopleInCharge={},e.dtOptionsEmployeePeopleInCharge=a.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:h,url:"api/employee-children",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){b()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(n,o,a){i(angular.element(n).contents())(e)}),e.dtColumnsEmployeePeopleInCharge=[r.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(n,o,a,r){var t="",i='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar registro" data-id="'+n.id+'" >   <i class="fa fa-trash-o"></i></a> ';return e.isView||(t+=i),t}),r.newColumn("name").withTitle("Nombre"),r.newColumn("lastName").withTitle("Apellidos"),r.newColumn("age").withTitle("Edad").withOption("width",200)];var b=function(){$("#dtEmployeePeopleInCharge a.delRow").on("click",function(){var n=$(this).data("id");e.onDeleteChildren(n)})};e.dtInstanceEmployeePeopleInChargeCallback=function(n){e.dtInstanceEmployeePeopleInCharge=n},e.reloadDataPeopleInCharge=function(){e.dtInstanceEmployeePeopleInCharge.reloadData()},w.category="hobby",e.dtInstanceEmployeeHobbies={},e.dtOptionsEmployeeHobbies=a.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:w,url:"api/employee-demographic",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){O()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(n,o,a){i(angular.element(n).contents())(e)}),e.dtColumnsEmployeeHobbies=[r.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(n,o,a,r){var t="",i='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar registro" data-id="'+n.id+'" >   <i class="fa fa-trash-o"></i></a> ';return e.isView||(t+=i),t}),r.newColumn("value").withTitle("Actividad")];var O=function(){$("#dtEmployeeHobbies a.delRow").on("click",function(){var n=$(this).data("id");e.onDeleteDemographic(n)})};e.dtInstanceEmployeeHobbiesCallback=function(n){e.dtInstanceEmployeeHobbies=n},e.reloadDataHobbies=function(){e.dtInstanceEmployeeHobbies.reloadData()},g.category="disease",e.dtInstanceEmployeeDiseases={},e.dtOptionsEmployeeDiseases=a.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:g,url:"api/employee-demographic",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){E()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(n,o,a){i(angular.element(n).contents())(e)}),e.dtColumnsEmployeeDiseases=[r.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(n,o,a,r){var t="",i='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar registro" data-id="'+n.id+'" >   <i class="fa fa-trash-o"></i></a> ';return e.isView||(t+=i),t}),r.newColumn("value").withTitle("Actividad")];var E=function(){$("#dtEmployeeDiseases a.delRow").on("click",function(){var n=$(this).data("id");e.onDeleteDemographic(n)})};e.dtInstanceEmployeeDiseasesCallback=function(n){e.dtInstanceEmployeeDiseases=n},e.reloadDataDiseases=function(){e.dtInstanceEmployeeDiseases.reloadData()},e.onDeleteChildren=function(n){d.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(a){if(a){var r={};r.id=n,p({method:"POST",url:"api/employee-children/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(r)}).then(function(n){swal("Eliminado","Registro eliminado satisfactoriamente"),e.reloadDataPeopleInCharge()})["catch"](function(e){o.error(e),l.pop("error","Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema")})["finally"](function(){})}else swal("Cancelación","La operación ha sido cancelada","error")})},e.onDeleteDemographic=function(n){d.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(a){if(a){var r={};r.id=n,p({method:"POST",url:"api/employee-demographic/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(r)}).then(function(n){swal("Eliminado","Registro eliminado satisfactoriamente"),e.reloadDataHobbies(),e.reloadDataDiseases()})["catch"](function(e){o.error(e),l.pop("error","Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema")})["finally"](function(){})}else swal("Cancelación","La operación ha sido cancelada","error")})},e.$watch("demographic.hasPeopleInCharge",function(){e.demographic.hasPeopleInCharge||(e.demographic.qtyPeopleInCharge=0)})}]);
"use strict";app.controller("customerEmployeeDocumentExpirationListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","SweetAlert","$http","$timeout","ListService",function(t,e,i,n,o,a,r,l,c,s,u,d,p,h){function w(){var e=[{name:"month_options",value:null}];h.getDataList(e).then(function(e){t.months=e.data.data.monthOptions},function(e){t.status="Unable to load customer data: "+e.message})}t.isAgent="agent"==s.currentUser().wg_type,t.isAdmin="system"==s.currentUser().wg_type,t.isCustomer="customerAdmin"==s.currentUser().wg_type||"customerUser"==s.currentUser().wg_type,t.isView=t.$parent.isCustomerContractor||"view"==t.$parent.editMode,t.filter={selectedMonth:null,selectedYear:null},w(),t.dtInstanceCertificateExpiration={},t.dtOptionsCertificateExpiration=n.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.operation="document",e.customerEmployeeId=t.$parent.currentEmployee,e.statusCode="2",null!==t.filter.selectedYear&&""!==t.filter.selectedYear.trim()&&(e.year=t.filter.selectedYear),null!==t.filter.selectedMonth&&(e.month=t.filter.selectedMonth.value),JSON.stringify(e)},url:"api/customer-employee-document",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){f()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,i,n){r(angular.element(e).contents())(t)}),t.dtColumnsCertificateExpiration=[o.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,i,n,o){var a=null!=e.documentUrl?e.documentUrl:"",r="",l='<a target="_blank" class="btn btn-primary btn-xs editRow lnk" href="'+a+'" uib-tooltip="Descargar anexo" data-id="'+e.id+'" >   <i class="fa fa-download"></i></a> ';return a.length>0&&(r+=l),t.isView?"":r}),o.newColumn("requirement").withTitle("Tipo Documento").withOption("width",200),o.newColumn("description").withTitle("Descripción").withOption("width",200),o.newColumn("startDate").withTitle("Fecha de Inicio Vigencia").withOption("width",200),o.newColumn("endDate").withTitle("Fecha de Expiración Vigencia").withOption("width",200),o.newColumn("version").withTitle("Versión").withOption("width",200),o.newColumn(null).withTitle("Requerido").withOption("width",200).notSortable().renderWith(function(t,e,i,n){var o="",a="1"==t.isRequiredCode||t.isRequiredCode?"checked":"",r="1"==t.isRequiredCode||t.isRequiredCode?"Si":"No",l='<div class="checkbox clip-check check-success "><input class="editRow" ng-disabled="true" type="checkbox" id="chk_'+t.id+'" data-id="'+t.id+'" '+a+' ><label for="chk_'+t.id+'">'+r+"</label></div>";return o+=l}).notSortable(),o.newColumn("status").withTitle("Estado").withOption("width",200).renderWith(function(t,e,i,n){var o="";switch(t){case"Vigente":o="label label-success";break;case"Anulado":o="label label-danger"}var a='<span class="'+o+'">'+t+"</span>";return a})];var f=function(){};t.dtInstanceCertificateExpirationCallback=function(e){t.dtInstanceCertificateExpiration=e},t.reloadData=function(){t.dtInstanceCertificateExpiration.reloadData()},t.onSelectMonth=function(e,i){p(function(){t.reloadData()})},t.onClearMonth=function(){p(function(){t.filter.selectedMonth=null,t.reloadData()})},t.onSearchYear=function(){p(function(){t.reloadData()})},t.onClearYear=function(){p(function(){t.filter.selectedYear=null,t.reloadData()})}}]);
"use strict";app.controller("customerEmployeeOccupationalExaminationCtrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout",function(e,o,t,n,c,i){var a=t;a.info("loading..customerEmployeeOccupationalExaminationCtrl!!! "),e.employee_section="list",e.currentId=0,e.editMode="create",e.navToSection=function(o,t,n){i(function(){e.employee_section=o,e.editMode=t,e.$parent.switchSubTab(t),e.currentId=n})}}]);
"use strict";app.controller("customerEmployeeOccupationalExaminationListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$aside",function(t,n,i,e,o,a,r,l,c,s,d,u,p,m){var w=i;t.isView=t.$parent.isCustomerContractor||t.$parent.$parent.$parent.isView,t.agents=s.agents(),t.dtInstanceEmployeeOccupationalExamination={},t.dtOptionsEmployeeOccupationalExamination=e.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(n){return n.customerEmployeeId=t.$parent.currentEmployee,JSON.stringify(n)},url:"api/customer-work-medicine",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){f()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(n,i,e){r(angular.element(n).contents())(t)}),t.dtColumnsEmployeeOccupationalExamination=[o.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(n,i,e,o){var a="",r="",l='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+n.id+'" >   <i class="fa fa-edit"></i></a> ',c='<a class="btn btn-info btn-xs viewRow lnk" href="#" uib-tooltip="Ver" data-id="'+n.id+'" >   <i class="fa fa-eye"></i></a> ',d='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+n.id+'" >   <i class="fa fa-trash-o"></i></a> ',u=!t.isView;return s.can("seguimiento_view")&&(a+=c),s.can("seguimiento_edit")&&(a+=l),s.can("seguimiento_delete")&&(a+=d),0==u&&(r+=c),u?a:r}),o.newColumn("examinationDate").withTitle("Fecha Exámen").withOption("width",200).withOption("defaultContent",""),o.newColumn("examinationType").withTitle("Tipo de Exámen").withOption("width",200).withOption("defaultContent",""),o.newColumn("firstName").withTitle("Nombre").withOption("width",200).withOption("defaultContent",""),o.newColumn("lastName").withTitle("Apellidos").withOption("width",200).withOption("defaultContent",""),o.newColumn("job").withTitle("Cargo").withOption("width",200).withOption("defaultContent","")];var f=function(){$("#dtOccupationalExamination a.editRow").on("click",function(){var n=$(this).data("id");t.onEdit(n)}),$("#dtOccupationalExamination a.viewRow").on("click",function(){var n=$(this).data("id");t.onView(n)}),$("#dtOccupationalExamination a.delRow").on("click",function(){var n=$(this).data("id");w.info("intenta eliminar el registro: "+n),p.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(e){if(e){var o={};o.id=n,u({method:"POST",url:"api/customer/work-medicine/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){i.error(t),p.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){t.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};t.dtInstanceEmployeeOccupationalExaminationCallback=function(n){t.dtInstanceEmployeeOccupationalExamination=n},t.reloadData=function(){t.dtInstanceEmployeeOccupationalExamination.reloadData()},t.onCreateNew=function(){null!=t.$parent&&t.$parent.navToSection("form","edit",0)},t.onEdit=function(n){null!=t.$parent&&t.$parent.navToSection("form","edit",n)},t.onView=function(n){null!=t.$parent&&t.$parent.navToSection("form","view",n)},t.onExportExcel=function(){var n={customerEmployeeId:t.$parent.currentEmployee};jQuery("#downloadDocument")[0].src="api/customer-work-medicine/export-excel?data="+Base64.encode(JSON.stringify(n))}}]);
"use strict";app.controller("customerEmployeeOccupationalExaminationEditCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","SweetAlert","$rootScope","$http","$timeout","$uibModal","flowFactory","cfpLoadingBar","$filter","ListService","$document",function(e,n,i,t,a,o,r,c,l,d,s,u,m,p,f,w,g,h,v){var k=i,y={},C=e.$parent.currentId;e.isAgent="agent"==s.currentUser().wg_type,e.isAdmin="system"==s.currentUser().wg_type,e.isCustomer="customerAdmin"==s.currentUser().wg_type||"customerUser"==s.currentUser().wg_type,k.info("loading..customerWorkMedicineEditCtrl con el id de tracking: ",C),e.examinationTypes=s.parameters("work_medicine_examination_type"),e.medicalConcepts=s.parameters("work_medicine_medical_concept"),e.complementaryTests=s.parameters("work_medicine_complementary_test"),e.sveTypes=s.parameters("work_medicine_sve_type"),e.trackingTypes=s.parameters("work_medicine_tracking_type"),e.contractTypes=s.parameters("employee_contract_type"),e.documentType=s.parameters("customer_document_type"),e.tiposdoc=s.parameters("tipodoc"),e.isView="view"==e.$parent.$parent.$parent.editMode,console.log(e.isView),e.canShow=!1,e.minDateCurrent=new Date,e.currentId=e.$parent.currentEmployee,e.maxDate=new Date,e.datePickerConfig={culture:"es-CO",format:"dd/MM/yyyy HH:mm"},e.employees=[],e.onLoadRecord=function(){if(0!=e.medicine.id){k.info("editando cliente con código: "+e.medicine.id);var n={id:e.medicine.id};u({method:"GET",url:"api/customer/work-medicine",params:n})["catch"](function(e,n){if(403==n){var i=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";d.swal("No Autorizado","No estas autorizado para ver esta información.","error"),m(function(){l.go(i)},3e3)}else 404==n?d.swal("Información no disponible","Centro de trabajo no encontrado","error"):d.swal("Error","Se ha presentado un error al intentar acceder a la información","error")}).then(function(n){m(function(){e.medicine=n.data.result,e.medicine.examinationDate=new Date(e.medicine.examinationDate.date),e.canShow=!0})})["finally"](function(){m(function(){e.loading=!1},400),m(function(){v.scrollTop(40,2e3)})})}else k.info("creacion de nuevo cliente"),e.loading=!1},e.medicine={id:C,employee:{id:e.currentId},examinationType:null,examinationDate:null,occupationalConclusion:"",occupationalBehavior:"",generalRecommendation:"",medicalConcept:null};var T=function(){e.complementary={id:0,customerWorkMedicineId:e.medicine.id,complementaryTest:null,result:null,interpretation:""},e.sve={id:0,customerWorkMedicineId:e.medicine.id,type:null,isActive:!1},e.tracking={id:0,customerWorkMedicineId:e.medicine.id,type:null,dateOf:null,observation:""}};T(),e.onLoadRecord(),e.form={submit:function(e){var n=null;if(e.$invalid){var i=null,n=null;for(i in e)"$"!=i[0]&&(null!==n||e[i].$valid||(n=e[i].$name),e[i].$pristine&&(e[i].$dirty=!0));return angular.element(".ng-invalid[name="+n+"]").focus(),void d.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}d.swal("Validación exitosa","Procediendo con el guardado...","success"),b()},reset:function(e){e.$setPristine(!0)}};var b=function(){var n={};e.medicine.examinationDate=e.medicine.examinationDate.toISOString();var t=JSON.stringify(e.medicine);return n.data=Base64.encode(t),u({method:"POST",url:"api/customer/work-medicine/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(n){m(function(){e.medicine=n.data.result,e.medicine.examinationDate=new Date(e.medicine.examinationDate.date),e.canShow=!0,y.customer_work_medicine_id=e.medicine.id,C=e.medicine.id,T()})})["catch"](function(e){i.error(e),d.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};e.cancelEdition=function(){null!=e.$parent&&e.$parent.navToSection("list","list")},e.dtInstanceWorkMedicineComplementary={},e.dtOptionsWorkMedicineComplementary=t.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customer_work_medicine_id=C,e},url:"api/customer/work-medicine/complementary-test",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){O()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(n,i,t){r(angular.element(n).contents())(e)}),e.dtColumnsWorkMedicineComplementary=[a.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(n,i,t,a){var o="",r='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+n.id+'" >   <i class="fa fa-edit"></i></a> ',c='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+n.id+'" >   <i class="fa fa-trash-o"></i></a> ';return s.can("seguimiento_edit")&&(o+=r),s.can("seguimiento_delete")&&(o+=c),e.isView?"":o}),a.newColumn("complementaryTest.item").withTitle("Prueba Complementaria").withOption("defaultContent",""),a.newColumn("result.item").withTitle("Resultado").withOption("defaultContent",""),a.newColumn("interpretation").withTitle("Interpretación").withOption("defaultContent","")];var O=function(){$("#dtWorkMedicineComplementary a.editRow").on("click",function(){var n=$(this).data("id");e.editWorkMedicineComplementary(n)}),$("#dtWorkMedicineComplementary a.delRow").on("click",function(){var n=$(this).data("id");k.info("intenta eliminar el registro: "+n),d.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(t){if(t){var a={};a.id=n,u({method:"POST",url:"api/customer/work-medicine/complementary-test/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){i.error(e),d.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){e.reloadDataComplementary()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};e.dtInstanceWorkMedicineComplementaryCallback=function(n){e.dtInstanceWorkMedicineComplementary=n},e.reloadDataComplementary=function(){e.dtInstanceWorkMedicineComplementary.reloadData()},e.editWorkMedicineComplementary=function(n){if(n){var i={id:n};u({method:"GET",url:"api/customer/work-medicine/complementary-test",params:i})["catch"](function(e,n){if(403==n){var i=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";d.swal("No Autorizado","No estas autorizado para ver esta información.","error"),m(function(){l.go(i)},3e3)}else 404==n?d.swal("Información no disponible","Centro de trabajo no encontrado","error"):d.swal("Error","Se ha presentado un error al intentar acceder a la información","error")}).then(function(n){console.log(n),m(function(){e.complementary=n.data.result;var i=e.complementary.result;e.onSelectComplementaryTest(null,null),e.complementary.result=i})})["finally"](function(){m(function(){e.loading=!1},400),m(function(){})})}else k.info("creacion de nuevo cliente"),e.loading=!1},e.saveWorkMedicineComplementary=function(){var n={},t="";if(null==e.complementary.complementaryTest&&(t+="Debe seleccionar la Prueba complementaria <br/>"),null==e.complementary.result&&(t+="Debe seleccionar el Resultado <br/>"),null!=e.complementary.interpretation&&""!=e.complementary.interpretation||(t+="Debe ingresar la Interpretación <br/>"),""!=t)return void d.swal({html:!0,title:"Error de validación",text:t,type:"error"});var a=JSON.stringify(e.complementary);return n.data=Base64.encode(a),u({method:"POST",url:"api/customer/work-medicine/complementary-test/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(n){m(function(){e.clearWorkMedicineComplementary(),e.reloadDataComplementary()})})["catch"](function(e){i.error(e),d.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})},e.clearWorkMedicineComplementary=function(){e.complementary={id:0,customerWorkMedicineId:e.medicine.id,complementaryTest:null,result:null,interpretation:""}},e.dtInstanceWorkMedicineSve={},e.dtOptionsWorkMedicineSve=t.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customer_work_medicine_id=C,e},url:"api/customer/work-medicine/sve",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){S()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(n,i,t){r(angular.element(n).contents())(e)}),e.dtColumnsWorkMedicineSve=[a.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(n,i,t,a){var o="",r='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+n.id+'" >   <i class="fa fa-edit"></i></a> ',c='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+n.id+'" >   <i class="fa fa-trash-o"></i></a> ';return s.can("seguimiento_edit")&&(o+=r),s.can("seguimiento_delete")&&(o+=c),e.isView?"":o}),a.newColumn("type.item").withTitle("SVE Tipo").withOption("defaultContent",""),a.newColumn("isActive").withTitle("Estado").withOption("defaultContent","").renderWith(function(e,n,i,t){var a="",o="";return e||"1"==e?(o="Si",a="label label-success"):(o="No",a="label label-danger"),'<span class="'+a+'">'+o+"</span>"})];var S=function(){$("#dtWorkMedicineSve a.editRow").on("click",function(){var n=$(this).data("id");e.editWorkMedicineSve(n)}),$("#dtWorkMedicineSve a.delRow").on("click",function(){var n=$(this).data("id");k.info("intenta eliminar el registro: "+n),d.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(t){if(t){var a={};a.id=n,u({method:"POST",url:"api/customer/work-medicine/sve/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){i.error(e),d.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){e.reloadDataSve()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};e.dtInstanceWorkMedicineSveCallback=function(n){e.dtInstanceWorkMedicineSve=n},e.reloadDataSve=function(){e.dtInstanceWorkMedicineSve.reloadData()},e.editWorkMedicineSve=function(n){if(n){var i={id:n};u({method:"GET",url:"api/customer/work-medicine/sve",params:i})["catch"](function(e,n){if(403==n){var i=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";d.swal("No Autorizado","No estas autorizado para ver esta información.","error"),m(function(){l.go(i)},3e3)}else 404==n?d.swal("Información no disponible","Centro de trabajo no encontrado","error"):d.swal("Error","Se ha presentado un error al intentar acceder a la información","error")}).then(function(n){m(function(){e.sve=n.data.result})})["finally"](function(){m(function(){e.loading=!1},400),m(function(){})})}else k.info("creacion de nuevo cliente"),e.loading=!1},e.saveWorkMedicineSve=function(){var n={},t="";if(null==e.sve.type&&(t+="Debe seleccionar la Prueba complementaria <br/>"),""!=t)return void d.swal({html:!0,title:"Error de validación",text:t,type:"error"});var a=JSON.stringify(e.sve);return n.data=Base64.encode(a),u({method:"POST",url:"api/customer/work-medicine/sve/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(n){m(function(){e.clearWorkMedicineSve(),e.reloadDataSve()})})["catch"](function(e){i.error(e),d.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})},e.clearWorkMedicineSve=function(){e.sve={id:0,customerWorkMedicineId:e.medicine.id,type:null,isActive:!1}},e.dtInstanceWorkMedicineTracking={},e.dtOptionsWorkMedicineTracking=t.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customer_work_medicine_id=C,e},url:"api/customer/work-medicine/tracking",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){D()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(n,i,t){r(angular.element(n).contents())(e)}),e.dtColumnsWorkMedicineTracking=[a.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(n,i,t,a){var o="",r='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+n.id+'" >   <i class="fa fa-edit"></i></a> ',c='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+n.id+'" >   <i class="fa fa-trash-o"></i></a> ';return s.can("seguimiento_edit")&&(o+=r),s.can("seguimiento_delete")&&(o+=c),e.isView?"":o}),a.newColumn("dateOfFormat").withTitle("Fecha Seguimiento").withOption("width",200).withOption("defaultContent",""),a.newColumn("type.item").withTitle("Tipo de Seguimiento").withOption("defaultContent",""),a.newColumn("observation").withTitle("Observación").withOption("defaultContent","")];var D=function(){$("#dtWorkMedicineTracking a.editRow").on("click",function(){var n=$(this).data("id");e.editWorkMedicineTracking(n)}),$("#dtWorkMedicineTracking a.delRow").on("click",function(){var n=$(this).data("id");k.info("intenta eliminar el registro: "+n),d.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(t){if(t){var a={};a.id=n,u({method:"POST",url:"api/customer/work-medicine/tracking/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){i.error(e),d.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){e.reloadDataTracking()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};e.dtInstanceWorkMedicineTrackingCallback=function(n){e.dtInstanceWorkMedicineTracking=n},e.reloadDataTracking=function(){e.dtInstanceWorkMedicineTracking.reloadData()},e.editWorkMedicineTracking=function(n){if(n){var i={id:n};u({method:"GET",url:"api/customer/work-medicine/tracking",params:i})["catch"](function(e,n){if(403==n){var i=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";d.swal("No Autorizado","No estas autorizado para ver esta información.","error"),m(function(){l.go(i)},3e3)}else 404==n?d.swal("Información no disponible","Centro de trabajo no encontrado","error"):d.swal("Error","Se ha presentado un error al intentar acceder a la información","error")}).then(function(n){e.tracking=n.data.result,e.tracking.dateOf=new Date(e.tracking.dateOf.date),console.log(e.tracking.dateOf),null!=e.tracking.dateOf})["finally"](function(){m(function(){e.loading=!1},400),m(function(){})})}else k.info("creacion de nuevo cliente"),e.loading=!1},e.saveWorkMedicineTracking=function(){var n={},t="";if(null==e.tracking.type&&(t+="Debe seleccionar el Tipo de seguimiento <br/>"),null!=e.tracking.dateOf&&""!=e.tracking.dateOf||(t+="Debe ingresar la Fecha del seguimiento <br/>"),null!=e.tracking.observation&&""!=e.tracking.observation||(t+="Debe ingresar la Observación <br/>"),""!=t)return void d.swal({html:!0,title:"Error de validación",text:t,type:"error"});var a=JSON.stringify(e.tracking);return n.data=Base64.encode(a),u({method:"POST",url:"api/customer/work-medicine/tracking/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(n){m(function(){e.clearWorkMedicineTracking(),e.reloadDataTracking()})})["catch"](function(e){i.error(e),d.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})},e.clearWorkMedicineTracking=function(){e.tracking={id:0,customerWorkMedicineId:e.medicine.id,type:null,dateOf:null,observation:""}},e.onSelectComplementaryTest=function(n,i){if(null!=e.complementary.complementaryTest){e.complementary.result=null;var t=[{name:"work_medicine_complementary_test_result",value:e.complementary.complementaryTest.value}];h.getDataList(t).then(function(n){e.complementaryTestResults=n.data.data.workMedicineComplementaryTestResult},function(n){e.status="Unable to load customer data: "+n.message})}}}]);
"use strict";app.controller("customerEmployeeAuditListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","SweetAlert","$http","$filter","$document",function(e,t,i,n,a,o,l,u,r,s,d,c,p,m,w){var f=i;e.request={},f.info("loading..customerEmployeeAuditListCtrl "),e.criteria=[{name:"Igual",value:"="},{name:"Contiene",value:"LIKE"},{name:"Diferente",value:"<>"},{name:"Mayor que",value:">"},{name:"Menor que",value:"<"}],e.conditions=[{name:"Y",value:"AND"},{name:"O",value:"OR"}],e.audit={fields:[{name:"date",alias:"Fecha"},{name:"fullName",alias:"Usurio"},{name:"userType",alias:"Tipo Usuario"},{name:"action",alias:"Acción"},{name:"observation",alias:"Descripción"}],filters:[]},e.dtInstanceCustomerEmployeeAudit=null,e.dtOptionsCustomerEmployeeAudit=n.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.operation="audit",t.customer_employee_id=e.$parent.currentEmployee,t.data=Base64.encode(JSON.stringify(e.audit)),t},url:"api/customer-employee/audit",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,i,n){l(angular.element(t).contents())(e)}),e.dtColumnsCustomerEmployeeAudit=[a.newColumn("date").withTitle("Fecha").withOption("width",200),a.newColumn("userType").withTitle("Tipo Usuario").withOption("width",200),a.newColumn("user").withTitle("Usuario").withOption("width",200),a.newColumn("action").withTitle("Acción").withOption("width",200),a.newColumn("shortObservation").withTitle("Descripción")],e.dtInstanceCustomerEmployeeAuditCallback=function(t){e.dtInstanceCustomerEmployeeAudit=t},e.reloadData=function(){e.dtInstanceCustomerEmployeeAudit.reloadData()},e.addFilter=function(){null==e.audit.filters&&(e.audit.filters=[]),e.audit.filters.push({id:0,field:null,criteria:null,condition:null,value:""})},e.onFilter=function(){e.reloadData()},e.removeFilter=function(t){e.audit.filters.splice(t,1)},e.onCleanFilter=function(){e.audit.filters=[],e.reloadData()}}]);
"use strict";app.controller("customerEmployeeIndicatorsTabsCtrl",["$scope","$rootScope","$timeout","$filter",function(t,e,a,n){t.loading=!1,t.tabname="tab1",t.activeTab=1,t.loadedOther=["tab1"],t.getView=function(e){var a=n("filter")(t.views,{name:e});return a[0]},t.switchTab=function(e){a(function(){t.tabname=e,t.loadedOther.push(e)})},t.switchSubTab=function(e){a(function(){t.subtab=e})}}]);
"use strict";app.controller("customerEmployeeIndicatorsDocumentsCtrl",["$scope","$stateParams","ListService","ChartService","$http","$log","SweetAlert",function(t,a,o,e,s,r,n){function c(){var e=[{name:"customer_employee_indicators_years",criteria:{customerId:a.customerId}}];o.getDataList(e).then(function(a){t.yearList=a.data.data.customerEmployeeIndicatorsYears,t.yearList.length&&(t.filters.year=t.yearList[0],l())},function(a){t.status="Unable to load customer data: "+a.message})}function u(){var o={customerId:a.customerId};return s({method:"POST",url:"api/customer/config-sgsst/workplace/listProcess",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(a){t.workplaces=a.data.data})}function i(a){t.chart.line.options=a.chartLineOptions,t.chart.line.options.legend.position="top",t.chart.line.options.scales.xAxes=[{ticks:{autoSkip:!1}}],t.chart.doughnut.options=a.chartDoughnutOptions,t.chart.doughnut.options.legend.position="top",t.chart.doughnut.options.maintainAspectRatio=!1,t.chart.doughnut.options.responsive=!1,t.chart.barWithScales.options=a.chartBarOptionsWithScales,t.chart.barWithScales.options.legend.position="top";var o=t.chart.barWithScales.options.scales.xAxes;o[0].ticks={autoSkip:!1},t.chart.barWithScales.options.scales.xAxes=o}function l(){var o=[{name:"chart_line_options",criteria:null},{name:"chart_doughnut_options",criteria:null},{name:"chart_bar_with_scales_options",criteria:null},{name:"customer_employee_documents_indicators",criteria:{customerId:a.customerId,year:t.filters.year.year,workplace:null==t.filters.workplace?null:t.filters.workplace.id}}];e.getDataChart(o).then(function(a){i(a.data.data),t.totalDocuments=a.data.data.customerEmployeeIndicatorsDocumentsTotal,t.chart.data.documentsByStatus=a.data.data.customerEmployeeIndicatorsDocumentsByStatus,t.chart.data.authorizedDocuments=a.data.data.customerEmployeeIndicatorsDocumentsAuthorized,t.chart.data.documentsByWorkplaces=a.data.data.customerEmployeeIndicatorsDocumentsByWorkplaces,t.chart.data.statusDocumentsByWorkplaces=a.data.data.customerEmployeeIndicatorsStatusDocumentsByWorkplaces,t.chart.data.authorizedDocumentsByWorkplaces=a.data.data.customerEmployeeIndicatorsAuthorizedByWorkplaces,t.chart.data.amountDocumentsByPeriod=a.data.data.customerEmployeeIndicatorsDocumentsByPeriod,t.chart.data.amountDocumentsByStatusByPeriod=a.data.data.customerEmployeeIndicatorsDocumentsByStatusByPeriod,t.chart.data.amountApprovedVsDeniedDocumentsByPeriod=a.data.data.customerEmployeeIndicatorsAuthorizedDocumentsByPeriod},function(a){t.status="Unable to load customer data: "+a.message})}t.yearList=[],t.workplaces=[],t.totalDocuments=0,t.filters={year:null,workplace:null},t.chart={line:{options:null},doughnut:{options:null},barWithScales:{options:null},data:{documentsByStatus:null,authorizedDocuments:null,documentsByWorkplaces:null,statusDocumentsByWorkplaces:null,authorizedDocumentsByWorkplaces:null,amountDocumentsByPeriod:null,amountDocumentsByStatusByPeriod:null,amountApprovedVsDeniedDocumentsByPeriod:null}},c(),u(),t.onChangeWorkplace=function(){l()},t.onClearFilterWorkplace=function(){t.filters.workplace=null,l()},t.onConsolidate=function(){var t={customerId:a.customerId};return s({method:"POST",url:"api/customer-employee-indicators/consolidateSupportDocuments",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(){c(),n.swal("Proceso Exitoso",".","success")})["catch"](function(t){r.error(t),n.swal("Error al consolidar",t.data.message,"error")})}}]);
"use strict";app.controller("customerEmployeeIndicatorsEmployeeIndicatorsTabsCtrl",["$scope",function(o){o.section="summary",o.navToSection=function(t){o.section=t}}]);
"use strict";app.controller("customerEmployeeIndicatorsEmployeesCtrl",["$scope","$stateParams","ListService","ChartService","$http","SweetAlert","$log","$timeout",function(a,t,o,r,e,n,i,c){function s(){var o={customerId:t.customerId};return e({method:"POST",url:"api/customer/config-sgsst/workplace/listProcess",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(t){a.workplaces=t.data.data})}function l(){var o=[{name:"chart_bar_options",criteria:null},{name:"chart_doughnut_options",criteria:null},{name:"customer_employee_demographic_indicators",criteria:{customerId:t.customerId,workplace:null==a.filters.workplace?null:a.filters.workplace.id}}];r.getDataChart(o).then(function(t){c(function(){a.chart.bar.options=angular.copy(t.data.data.chartBarOptions),a.chart.bar.options.legend.position="top",a.chart.horizontalBar.options=angular.copy(t.data.data.chartBarOptions),a.chart.horizontalBar.options.legend.position="top",a.chart.horizontalBar.options.scales.yAxes[0].ticks.display=!1,a.chart.horizontalBar.options.scales.xAxes[0].ticks.display=!1,a.chart.doughnut.options=t.data.data.chartDoughnutOptions,a.chart.doughnut.options.legend.position="top",a.chart.doughnut.options.maintainAspectRatio=!1,a.chart.doughnut.options.responsive=!1}),a.chart.data.typeHousing=t.data.data.customerEmployeeDemographicIndicatorsTypeHousing,a.chart.data.antiquityCompany=t.data.data.customerEmployeeDemographicIndicatorsAntiquityCompany,a.chart.data.antiquityJob=t.data.data.customerEmployeeDemographicIndicatorsAntiquityJob,a.chart.data.hasChildren=t.data.data.customerEmployeeDemographicIndicatorsHasChildren,a.chart.data.stratum=t.data.data.customerEmployeeDemographicIndicatorsStratum,a.chart.data.civilStatus=t.data.data.customerEmployeeDemographicIndicatorsCivilStatus,a.chart.data.gender=t.data.data.customerEmployeeDemographicIndicatorsGender,a.chart.data.scholarship=t.data.data.customerEmployeeDemographicIndicatorsScholarship,a.chart.data.age=t.data.data.customerEmployeeDemographicIndicatorsAge,a.chart.data.practiceSports=t.data.data.customerEmployeeDemographicIndicatorsPracticeSports,a.chart.data.drinkAlcoholic=t.data.data.customerEmployeeDemographicIndicatorsDrinkAlcoholic,a.chart.data.smokes=t.data.data.customerEmployeeDemographicIndicatorsSmokes,a.chart.data.diagnosedDisease=t.data.data.customerEmployeeDemographicIndicatorsDiagnosedDisease,a.chart.data.workArea=t.data.data.customerEmployeeDemographicIndicatorsWorkArea,a.chart.data.workShift=t.data.data.customerEmployeeDemographicIndicatorsWorkShift},function(t){a.status="Unable to load customer data: "+t.message})}a.workplaces=[],a.filters={workplace:null},a.chart={bar:{options:null},horizontalBar:{options:null},doughnut:{options:null},data:{typeHousing:null,antiquityCompany:null,antiquityJob:null,hasChildren:null,stratum:null,civilStatus:null,gender:null,scholarship:null,age:null,practiceSports:null,drinkAlcoholic:null,smokes:null,diagnosedDisease:null,workArea:null,workShift:null}},s(),l(),a.onGoToSummary=function(){null!=a.$parent&&a.$parent.navToSection("summary")},a.onChangeWorkplace=function(){l()},a.onClearFilterWorkplace=function(){a.filters.workplace=null,l()},a.onConsolidate=function(){var a={customerId:t.customerId};return e({method:"POST",url:"api/customer-employee-indicators/consolidateDemographic",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(){l(),n.swal("Proceso Exitoso",".","success")})["catch"](function(a){i.error(a),n.swal("Error al consolidar",a.data.message,"error")})}}]);
"use strict";app.controller("customerEmployeeIndicatorsSummaryCtrl",["$scope","$stateParams","ListService","ChartService","$http","$log","SweetAlert","$timeout",function(t,e,a,o,r,s,n,i){function c(){var o=[{name:"customer_employee_indicators_years",criteria:{customerId:e.customerId}}];a.getDataList(o).then(function(e){t.yearList=e.data.data.customerEmployeeIndicatorsYears,t.yearList.length&&(t.filters.year=t.yearList[0],d())},function(e){t.status="Unable to load customer data: "+e.message})}function l(){var a={customerId:e.customerId};return r({method:"POST",url:"api/customer/config-sgsst/workplace/listProcess",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(e){t.workplaces=e.data.data})}function u(e){i(function(){t.chart.line.options=e.chartLineOptions,t.chart.line.options.legend.position="top",t.chart.line.options.scales.xAxes=[{ticks:{autoSkip:!1}}],t.chart.doughnut.options=e.chartDoughnutOptions,t.chart.doughnut.options.legend.position="top",t.chart.doughnut.options.maintainAspectRatio=!1,t.chart.doughnut.options.responsive=!1,t.chart.barWithScales.options=e.chartBarOptionsWithScales,t.chart.barWithScales.options.legend.position="top";var a=t.chart.barWithScales.options.scales.xAxes;a[0].ticks={autoSkip:!1},t.chart.barWithScales.options.scales.xAxes=a})}function d(){var a=[{name:"chart_line_options",criteria:null},{name:"chart_doughnut_options",criteria:null},{name:"chart_bar_with_scales_options",criteria:null},{name:"customer_employee_indicators_summary",criteria:{customerId:e.customerId,year:t.filters.year.year,workplace:null==t.filters.workplace?null:t.filters.workplace.id}}];o.getDataChart(a).then(function(e){u(e.data.data),t.totalEmployees=e.data.data.customerEmployeeIndicatorsSummaryTotal,t.chart.data.activeEmployees=e.data.data.customerEmployeeIndicatorsSummaryActive,t.chart.data.autorizedEmployees=e.data.data.customerEmployeeIndicatorsSummaryAuthorized,t.chart.data.employeesByWorkplaces=e.data.data.customerEmployeeIndicatorsEmployeesByWorkplaces,t.chart.data.activeEmployeesByWorkplaces=e.data.data.customerEmployeeIndicatorsActiveEmployees,t.chart.data.autorizedEmployeesByWorkplaces=e.data.data.customerEmployeeIndicatorsAutorizedEmployees,t.chart.data.amountEmployeesByPeriod=e.data.data.customerEmployeeIndicatorsAmountEmployeesByPeriod,t.chart.data.amountEmployeesVsActiveVsInactiveByPeriod=e.data.data.customerEmployeeIndicatorsAmountEmployeesVsActiveVsInactiveByPeriod,t.chart.data.amountActiveVsAutorizedVsUnautorizedEmployeesByPeriod=e.data.data.customerEmployeeIndicatorsAmountamountActiveVsAutorizedVsUnautorizedEmployeesByPeriodByPeriod},function(e){t.status="Unable to load customer data: "+e.message})}t.yearList=[],t.workplaces=[],t.totalEmployees=0,t.totalDocuments=0,t.filters={year:null,workplace:null},t.chart={line:{options:null},doughnut:{options:null},barWithScales:{options:null},data:{activeEmployees:null,autorizedEmployees:null,employeesByWorkplaces:null,activeEmployeesByWorkplaces:null,autorizedEmployeesByWorkplaces:null,amountEmployeesByPeriod:null,amountEmployeesVsActiveVsInactiveByPeriod:null,amountActiveVsAutorizedVsUnautorizedEmployeesByPeriod:null}},c(),l(),t.onGoToEmployeeIndicators=function(){null!=t.$parent&&t.$parent.navToSection("employeeIndicators")},t.onChangeWorkplace=function(){d()},t.onClearFilterWorkplace=function(){t.filters.workplace=null,d()},t.onConsolidate=function(){var t={customerId:e.customerId};return r({method:"POST",url:"api/customer-employee-indicators/consolidateStatusEmployees",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(){c(),n.swal("Proceso Exitoso",".","success")})["catch"](function(t){s.error(t),n.swal("Error al consolidar",t.data.message,"error")})}}]);
"use strict";app.controller("customerTrackingCtrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout",function(t,n,o,c,i,r){var e=o;e.info("loading..customerTrackingCtrl!!! "),t.tracking_section="list",t.currentTraking=0,t.actionMode="edit",t.navToSection=function(n,o,c){r(function(){t.tracking_section=n,t.actionMode=o,t.$parent.switchSubTab(o),t.currentTraking=c})}}]);
"use strict";app.controller("customerTrackingEditCtrl",["$scope","$stateParams","$log","$compile","$state","SweetAlert","DTOptionsBuilder","DTColumnBuilder","$rootScope","$http","$timeout","$uibModal","flowFactory","cfpLoadingBar","$filter","ListService",function(t,n,e,a,i,r,o,c,l,s,u,d,m,f,g,p){function w(){var n=[{name:"current_datetime",value:null}];p.getDataList(n).then(function(n){t.tracking.createdAt=n.data.data.currentDateTime},function(n){t.status="Unable to load customer data: "+n.message})}var k=e,h=t.$parent.currentTraking?t.$parent.currentTraking:0;t.isAgent="agent"==l.currentUser().wg_type,t.isAdmin="system"==l.currentUser().wg_type,t.isCustomer="customerAdmin"==l.currentUser().wg_type||"customerUser"==l.currentUser().wg_type,t.agents=l.agents(),t.typesTraking=l.parameters("tracking_tiposeg"),t.statusTracking=l.parameters("tracking_status"),t.isView="view"==t.$parent.actionMode,t.minDateCurrent=new Date,t.customerId=n.customerId,t.users=[],t.typesAlert=g("orderBy")(l.parameters("tracking_alert_type"),"id",!1),t.typesTime=l.parameters("tracking_alert_timeType"),t.statusAlert=l.parameters("tracking_alert_status"),t.perferencesAlert=l.parameters("tracking_alert_preference");var C=function(){t.tracking={id:h,customerId:t.customerId,agent:null,type:null,status:null,isVisible:t.isCustomer,isEventSchedule:0,isCustomer:t.isCustomer,module:"tracking",observation:"",comment:[],comments:[],eventDate:new Date,alerts:[],notifications:[],createdAt:null},T(),v(),w()},T=function(){null!=t.tracking.alerts&&0!=t.tracking.alerts.length||(t.tracking.alerts=[{id:0,type:null,timeType:null,time:0,preference:null,sent:0,status:null}])},v=function(){null!=t.tracking.notifications&&0!=t.tracking.notifications.length||(t.tracking.notifications=[{id:0,trackingId:t.$parent.currentTraking,user:null}])};C(),t.datePickerConfig={culture:"es-CO",format:"dd/MM/yyyy HH:mm"},t.cancelEdition=function(n){t.isView?null!=t.$parent&&t.$parent.navToSection("list","list"):r.swal({title:"Está seguro?",text:"Perderá todos los cambios realizados en este formulario.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, cancelar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(n){n?u(function(){null!=t.$parent&&t.$parent.navToSection("list","list")}):swal("Cancelación","La operación ha sido cancelada","error")})};var y=function(){if(t.tracking.id){var n={id:h};s({method:"GET",url:"api/tracking",params:n})["catch"](function(t,n){if(403==n){var e=null!==t.message&&void 0!==t.message?t.message:"app.clientes.list";r.swal("No Autorizado","No estas autorizado para ver esta información.","error"),u(function(){i.go(e)},3e3)}else 404==n?(r.swal("Información no disponible","Seguimiento no encontrado","error"),u(function(){i.go("app.clientes.list")})):r.swal("Error","Se ha presentado un error al intentar acceder a la información del seguimiento","error")}).then(function(n){u(function(){t.tracking=n.data.result,t.tracking.module="tracking",O(),T(),v()})})["finally"](function(){u(function(){t.loading=!1},400)})}},O=function(){null!=t.tracking.eventDate&&(t.tracking.eventDate=new Date(t.tracking.eventDate.date))};y(),t.removeAlert=function(n){r.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(e){e?u(function(){t.tracking.alerts.splice(n,1)}):swal("Cancelación","La operación ha sido cancelada","error")})},t.master=t.tracking,t.form={submit:function(n){var e=null;if(n.$invalid){var a=null,e=null;for(a in n)"$"!=a[0]&&(null!==e||n[a].$valid||(e=n[a].$name),n[a].$pristine&&(n[a].$dirty=!0));return k.info(t.customer),angular.element(".ng-invalid[name="+e+"]").focus(),void r.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}r.swal("Validación exitosa","Procediendo con el guardado...","success"),k.info(t.customer),D()},reset:function(n){t.tracking=angular.copy(t.master),n.$setPristine(!0)}};var D=function(){var n={},a=JSON.stringify(t.tracking);return n.data=Base64.encode(a),s({method:"POST",url:"api/tracking/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(n){u(function(){t.tracking=n.data.result,O(),0==t.tracking.id?t.$parent.navToSection("list","list"):t.reloadData()})})["catch"](function(t){e.error(t)})["finally"](function(){console.log(t.tracking.id),0==t.tracking.id?t.$parent.navToSection("list","list"):t.reloadData()})},B=function(){var n={};return n.customerId=t.customerId,s({method:"POST",url:"api/tracking/agent",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(n){u(function(){n.data.data.length>0&&(t.agents=n.data.data,t.users=n.data.data)})})["catch"](function(t){e.error(t),r.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};B(),t.onAddNotification=function(){u(function(){null==t.tracking.notifications&&(t.tracking.notifications=[]),t.tracking.notifications.push({id:0,trackingId:t.$parent.currentTraking,user:null})})},t.onAddAlert=function(){u(function(){null==t.tracking.alerts&&(t.tracking.alerts=[]),t.tracking.alerts.push({id:0,type:null,timeType:null,time:0,preference:null,sent:0,status:null})},500)},t.onRemoveNotification=function(n){r.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(a){a?u(function(){var a=t.tracking.notifications[n];if(0!=a.id){var i={};i.id=a.id,s({method:"POST",url:"api/tracking-notification/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info"),t.tracking.notifications.splice(n,1)})["catch"](function(t){e.error(t),r.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}else t.tracking.notifications.splice(n,1)}):swal("Cancelación","La operación ha sido cancelada","error")})},t.onAddComment=function(){u(function(){null==t.tracking.comments&&(t.tracking.comments=[]),t.tracking.comments.push({id:0,customerTrackingId:0,comment:"",responsible:"",date:null})})},t.dtInstanceCustomerTrackingComment={},t.dtOptionsCustomerTrackingComment=o.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.isDeleted=0,t.customerTrackingId=h,JSON.stringify(t)},url:"api/customer-tracking-comment",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(n,e,i){a(angular.element(n).contents())(t)}),t.dtColumnsCustomerTrackingComment=[c.newColumn("comment").withTitle("Comentario").withOption("defaultContent",""),c.newColumn("createdBy").withTitle("Usuario").withOption("width",200).withOption("defaultContent",""),c.newColumn("createdAt").withTitle("Fecha").withOption("width",200).withOption("defaultContent","")],t.dtInstanceCustomerTrackingCommentCallback=function(n){t.dtInstanceCustomerTrackingComment=n},t.reloadData=function(){null!=t.dtInstanceCustomerTrackingComment&&t.dtInstanceCustomerTrackingComment.reloadData()}}]);
"use strict";app.controller("customerTrackingListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","SweetAlert","$http","$filter","$document","$aside","$uibModal",function(t,e,n,i,o,a,r,l,c,s,u,d,m,p,w,f,h){var g=n;t.agents=s.agents();var v=s.isCustomer();t.dtInstanceTracking={},t.dtOptionsTracking=i.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(n){return n.customerId=e.customerId,v&&(n.isVisible=1),angular.isDefined(t.audit)&&angular.isDefined(t.audit.filters)&&(n.filter={filters:$.map(t.audit.filters,function(t){return{field:t.field.name,operator:t.criteria.value,condition:t.condition.value,value:t.value}})}),JSON.stringify(n)},url:"api/customer-tracking",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){C()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,n,i){r(angular.element(e).contents())(t)}),t.dtColumnsTracking=[o.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,e,n,i){var o="",a='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+t.id+'" >   <i class="fa fa-edit"></i></a> ',r='<a class="btn btn-info btn-xs viewRow lnk" href="#" uib-tooltip="Ver" data-id="'+t.id+'" >   <i class="fa fa-eye"></i></a> ',l='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+t.id+'" >   <i class="fa fa-trash-o"></i></a> ',c='<a class="btn btn-success btn-xs documentRow lnk" href="#" uib-tooltip="Anexos" data-id="'+t.id+'" >   <i class="fa fa-paperclip"></i></a> ';return s.can("seguimiento_view")&&(o+=r),s.can("seguimiento_edit")&&(o+=a),s.can("seguimiento_delete")&&(o+=l),s.can("seguimiento_document")&&(o+=c),o}),o.newColumn("id").withTitle("ID").withOption("width",200).withOption("defaultContent",""),o.newColumn("type").withTitle("Tipo de Seguimiento").withOption("width",200).withOption("defaultContent",""),o.newColumn("responsible").withTitle("Responsable").withOption("width",200).withOption("defaultContent",""),o.newColumn("eventDateTime").withTitle("Fecha Evento").withOption("width",200).withOption("defaultContent",""),o.newColumn("observation").withTitle("Observación").withOption("width",200).withOption("defaultContent",""),o.newColumn("createdBy").withTitle("Usuario").withOption("width",200).withOption("defaultContent",""),o.newColumn("status").withTitle("Estado").withOption("width",200).renderWith(function(t,e,n,i){var o="";switch(t){case"Iniciado":o="label label-success";break;case"Cancelado":o="label label-danger";break;case"Retirado":o="label label-warning";break;case"Completado":o="label label-info"}return'<span class="'+o+'">'+t+"</span>"}),o.newColumn(null).withTitle("Anexos").withOption("width",200).renderWith(function(t,e,n,i){var o="label label-warning",a=0;null==t.countAttachment&&void 0==t.countAttachment||(a=t.countAttachment);var r='<span class="'+o+'">'+a+" Anexos </span>";return r})];var C=function(){angular.element("#dtCustomerTracking a.editRow").on("click",function(){var e=angular.element(this).data("id");t.editTracking(e)}),angular.element("#dtCustomerTracking a.viewRow").on("click",function(){var e=angular.element(this).data("id");t.viewTracking(e)}),angular.element("#dtCustomerTracking a.documentRow").on("click",function(){var e=angular.element(this).data("id");t.onAddAttachment(e)}),t.onAttachment=function(e){null!=t.$parent&&t.$parent.navToSection("attachment","attachment",e)},angular.element("#dtCustomerTracking a.delRow").on("click",function(){var e=angular.element(this).data("id");g.info("intenta eliminar el registro: "+e),d.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(i){if(i){var o={};o.id=e,m({method:"POST",url:"api/tracking/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){n.error(t),d.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){t.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};t.reloadData=function(){t.dtInstanceTracking.reloadData()},t.editTracking=function(e){null!=t.$parent&&t.$parent.navToSection("form","edit",e)},t.viewTracking=function(e){null!=t.$parent&&t.$parent.navToSection("form","view",e)},t.onAddAttachment=function(e){var i=f.open({templateUrl:s.app.views.urlRoot+"modules/customer/tracking/customer_tracking_document_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideCustomerTrackingAttachmentCtrl",scope:t,resolve:{dataItem:function(){return{id:e}},isView:function(){return"view"==t.$parent.editMode}}});i.result.then(function(){t.reloadData()},function(){t.reloadData(),n.info("Modal dismissed at: "+new Date)})},t.onDownloadAttachment=function(){var e=h.open({templateUrl:s.app.views.urlRoot+"modules/common/modals/document_filter_modal.htm",controller:"ModalInstanceSideCustomerTrackingDownloadAttachmentCtrl",windowTopClass:"top-modal",resolve:{improvement:function(){return{id:0}},title:function(){return"Descargar anexos de seguimiento"},action:function(){return"Cancelar"}}});e.result.then(function(){t.reloadData()},function(){})}}]),app.controller("ModalInstanceSideCustomerTrackingAttachmentCtrl",["$stateParams","$rootScope","$scope","$uibModalInstance","dataItem","isView","$log","$timeout","SweetAlert","$filter","FileUploader","$http","DTColumnBuilder","DTOptionsBuilder","$compile","ListService",function(t,e,n,i,o,a,r,l,c,s,u,d,m,p,w,f){function h(){var e=[{name:"customer_document_type",value:t.customerId}];f.getDataList(e).then(function(t){n.documentType=t.data.data.customerDocumentType},function(t){n.status="Unable to load customer data: "+t.message})}var g=0,v="M",C=e.isCustomer();n.isView=!C&&a,n.documentClassification=e.parameters("customer_document_classification"),n.documentStatus=e.parameters("customer_document_status"),h();var b=function(){n.attachment={id:0,customerTrackingId:o.id,type:null,classification:null,description:"",status:n.documentStatus?n.documentStatus[0]:null,version:1,label:v}};b(),n.onCloseModal=function(){i.close(1)},n.onCancel=function(){i.dismiss("cancel")},n.onClear=function(){b()};var T=n.uploader=new u({url:"api/customer-tracking-document/upload",formData:[],removeAfterUpload:!0});T.filters.push({name:"customFilter",fn:function(t,e){return this.queue.length<10}}),T.onBeforeUploadItem=function(t){var e={id:g};t.formData.push(e)},T.onCompleteAll=function(){n.reloadData(),n.onClear()},n.form={submit:function(t){var e=null;if(t.$invalid){var n=null,e=null;for(n in t)"$"!=n[0]&&(null!==e||t[n].$valid||(e=t[n].$name),t[n].$pristine&&(t[n].$dirty=!0));return angular.element(".ng-invalid[name="+e+"]").focus(),void c.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}c.swal("Validación exitosa","Procediendo con el guardado...","success"),O()},reset:function(t){t.$setPristine(!0)}};var O=function(){v=n.attachment.label;var t={},e=JSON.stringify(n.attachment);return t.data=Base64.encode(e),d({method:"POST",url:"api/customer-tracking-document/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){l(function(){T.queue.length>0?(g=t.data.result.id,T.uploadAll()):(n.reloadData(),n.onClear())})})["catch"](function(t){c.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){n.reloadData()})};n.dtOptionsCustomerDocumentModal=p.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.customerTrackingId=o.id,t.statusCode="2",JSON.stringify(t)},url:"api/customer-tracking-document",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){D()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,e,i){w(angular.element(t).contents())(n)}),n.dtColumnsCustomerDocumentModal=[m.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,n,i,o){var a=t.documentUrl?t.documentUrl:"",r="api/customer-tracking-document/download?id="+t.id,l="",c='<a target="_self" class="btn btn-primary btn-xs downloadDocumentRow lnk" href="'+r+'" uib-tooltip="Descargar anexo" data-id="'+t.id+'" >   <i class="fa fa-download"></i></a> ',s='<a class="btn btn-info btn-xs openDocumentRow lnk" target="_blank" href="'+a+'" uib-tooltip="Abrir anexo" data-id="'+t.id+'" >   <i class="fa fa-folder-open-o"></i></a> ',u=!1;return null==t.protectionType?u=!0:"public"==t.protectionType?u=!0:"private"==t.protectionType&&1==t.hasPermission&&(u=!0),e.can("clientes_anexo_open")&&""!=a&&(l+=s),e.can("clientes_anexo_download")&&""!=a&&(l+=c),u?l:""}),m.newColumn("documentType").withTitle("Tipo de documento").withOption("width",200),m.newColumn("classification").withTitle("Clasificación").withOption("width",200),m.newColumn("description").withTitle("Descripción").withOption("width",200),m.newColumn("version").withTitle("Versión").withOption("width",200),m.newColumn("createdAt").withTitle("Fecha Creación").withOption("width",200).withOption("defaultContent",""),m.newColumn("status").withTitle("Estado").withOption("width",200).renderWith(function(t,e,n,i){var o="";switch(t){case"Vigente":o="label label-success";break;case"Anulado":o="label label-danger"}var a='<span class="'+o+'">'+t+"</span>";return a}),m.newColumn("label").withTitle("Origen").withOption("width",200).withOption("defaultContent","")];var D=function(){$("#dtCustomerDocumentModal a.editRow").on("click",function(){var t=$(this).data("id"),e=$(this).data("url");""==e?c.swal("Error en la descarga","No existe un anexo para descargar","error"):jQuery("#downloadDocument")[0].src="api/customer-tracking-document/download?id="+t})};n.dtInstanceCustomerDocumentModalCallback=function(t){n.dtInstanceCustomerDocumentModal=t},n.reloadData=function(){n.dtInstanceCustomerDocumentModal.reloadData()},n.dtOptionsCustomerMinimunStandardItemDocumentModal=p.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerId=t.customerId,e.roadSafetyItemId=o.roadSafetyItemId,e.customerId=t.customerId,e.statusCode="2",JSON.stringify(e)},url:"api/customer-tracking-document-available-previous",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){k()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,e,i){w(angular.element(t).contents())(n)}),n.dtColumnsCustomerMinimunStandardItemDocumentModal=[m.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,n,i,o){var a=t.documentUrl?t.documentUrl:"",r=("api/customer-tracking-document/download?id="+t.id,""),l='<a class="btn btn-success btn-xs addRow lnk" uib-tooltip="Adicionar" data-id="'+t.id+'" >   <i class="fa fa-plus"></i></a> ',c=!1;return null==t.protectionType?c=!0:"public"==t.protectionType?c=!0:"private"==t.protectionType&&1==t.hasPermission&&(c=!0),e.can("clientes_anexo_open")&&""!=a&&(r+=l),c?r:""}),m.newColumn("period").withTitle("Periodo").withOption("width",200),m.newColumn("documentType").withTitle("Tipo de documento").withOption("width",200),m.newColumn("classification").withTitle("Clasificación").withOption("width",200),m.newColumn("description").withTitle("Descripción").withOption("width",200),m.newColumn("version").withTitle("Versión").withOption("width",200),m.newColumn("createdAt").withTitle("Fecha Creación").withOption("width",200).withOption("defaultContent",""),m.newColumn("status").withTitle("Estado").withOption("width",200).renderWith(function(t,e,n,i){var o="";switch(t){case"Vigente":o="label label-success";break;case"Anulado":o="label label-danger"}var a='<span class="'+o+'">'+t+"</span>";return a})];var k=function(){$("#dtCustomerMinimunStandardItemDocumentModal a.addRow").on("click",function(){var t=$(this).data("id");y(t)})};n.dtInstanceCustomerMinimunStandardItemDocumentModalCallback=function(t){n.dtInstanceCustomerMinimunStandardItemDocumentModal=t},n.reloadHistoricalData=function(){n.dtInstanceCustomerMinimunStandardItemDocumentModal.reloadData()};var y=function(t){v=n.attachment.label;var e=JSON.stringify({id:t,customerTrackingId:o.id});return d({method:"POST",url:"api/customer-tracking-document/import-historical",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param({data:Base64.encode(e)})}).then(function(t){l(function(){b(),n.reloadHistoricalData(),n.reloadData()})})["catch"](function(t){c.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})}}]),app.controller("ModalInstanceSideCustomerTrackingDownloadAttachmentCtrl",["$rootScope","$stateParams","$scope","$uibModal","$uibModalInstance","improvement","title","$log","$timeout","SweetAlert","$http","toaster","$filter","$aside","$document","DTColumnBuilder","DTOptionsBuilder","$compile","ListService","ngNotify",function(t,e,n,i,o,a,r,l,c,s,u,d,m,p,w,f,h,g,v,C){function b(){var t=n.filter.year?n.filter.year.value:null,i=[{name:"customer_document_type",value:e.customerId},{name:"customer_tracking_document_periods",value:e.customerId,year:t}];v.getDataList(i).then(function(t){n.documentType=t.data.data.customerDocumentType,n.years=t.data.data.customerTrackingDocumentPeriod.years,n.months=t.data.data.customerTrackingDocumentPeriod.months},function(t){n.status="Unable to load customer data: "+t.message})}n.loading=!0,n.title=r,n.onCloseModal=function(){o.close(1)},n.onCancel=function(){o.dismiss("cancel")},n.onSelectYear=function(){b()};var T=function(){n.filter={id:e.customerId}};T(),b(),n.form={submit:function(t){var e=null;if(t.$invalid){var i=null,e=null;for(i in t)"$"!=i[0]&&(null!==e||t[i].$valid||(e=t[i].$name),t[i].$pristine&&(t[i].$dirty=!0));return angular.element(".ng-invalid[name="+e+"]").focus(),void s.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}return n.filter.type||n.filter.year||n.filter.month?void O():void s.swal("El formulario contiene errores!","Por favor seleccione al menos un filtro e intentelo nuevamente.","error")},reset:function(t){}};var O=function(){C.set("El archivo se está generando.",{position:"bottom",sticky:!0,button:!1,html:!0});var t={customerId:e.customerId,audit:n.filter},i={},o=JSON.stringify(t);i.data=Base64.encode(o),u({method:"POST",url:"api/customer-tracking-document/export",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(t){var e=(t.data.path+t.data.filename,'<div class="row"> <div class="col-sm-12 text-center">Por favor espere y verifique su correo y la bandeja de mensajes!</div> </div>');C.set(e,{position:"bottom",sticky:!0,type:"success",button:!0,html:!0}),n.onCloseModal()})["catch"](function(t){C.set(t.data.message,{position:"bottom",sticky:!0,type:"error",button:!0,html:!0})})["finally"](function(){})}}]);
"use strict";app.controller("customerTrackingAttachmentCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","SweetAlert","$rootScope","$http","$timeout","$uibModal","flowFactory","cfpLoadingBar","$filter","$document","FileUploader","$localStorage","$aside","ListService","$ngConfirm",function(n,t,e,o,a,i,r,l,c,s,u,d,m,f,p,h,w,g,v,b,C,A,T){function D(){var e=[{name:"customer_document_type",value:t.customerId}];A.getDataList(e).then(function(t){n.documentType=t.data.data.customerDocumentType},function(t){n.status="Unable to load customer data: "+t.message})}console.log("editMode attachment",n.$parent.editMode),n.isVisible="view"!=n.$parent.editMode;var y=null,I=0;n.currentId=n.$parent.currentId,n.documentClassification=u.parameters("customer_document_classification"),n.documentStatus=u.parameters("customer_document_status"),n.$storage=b.$default({hideMinimumStandardAttachmentCanceled:!0}),D(),n.onCancel=function(){null!=n.$parent&&n.$parent.navToSection("list","list",n.currentId)},n.onClear=function(){k()};var k=function(){n.attachment={id:0,customerImprovementPlanItemId:0,type:null,classification:null,description:"",status:n.documentStatus?n.documentStatus[0]:null,version:1},y&&y.$setPristine(!0)};k();var O=function(t){var e={id:t};d({method:"GET",url:"api/customer-tracking-document/get",params:e})["catch"](function(n,t){}).then(function(t){m(function(){n.attachment=t.data.result,n.attachment.version=parseInt(n.attachment.version)+1})})["finally"](function(){})},x=n.uploader=new v({url:"api/customer-tracking-document/upload",formData:[],removeAfterUpload:!0});x.filters.push({name:"customFilter",fn:function(n,t){return this.queue.length<10}}),x.onWhenAddingFileFailed=function(n,t,e){console.info("onWhenAddingFileFailed",n,t,e)},x.onAfterAddingFile=function(n){console.info("onAfterAddingFile",n)},x.onAfterAddingAll=function(n){console.info("onAfterAddingAll",n)},x.onBeforeUploadItem=function(n){console.info("onBeforeUploadItem",n);var t={id:I};n.formData.push(t)},x.onProgressItem=function(n,t){console.info("onProgressItem",n,t)},x.onProgressAll=function(n){console.info("onProgressAll",n)},x.onSuccessItem=function(n,t,e,o){console.info("onSuccessItem",n,t,e,o)},x.onErrorItem=function(n,t,e,o){console.info("onErrorItem",n,t,e,o)},x.onCancelItem=function(n,t,e,o){console.info("onCancelItem",n,t,e,o)},x.onCompleteItem=function(n,t,e,o){console.info("onCompleteItem",n,t,e,o)},x.onCompleteAll=function(){console.info("onCompleteAll"),n.reloadData(),n.onClear()},n.form={submit:function(n){y=n;var t=null;if(n.$invalid){var e=null,t=null;for(e in n)"$"!=e[0]&&(null!==t||n[e].$valid||(t=n[e].$name),n[e].$pristine&&(n[e].$dirty=!0));return angular.element(".ng-invalid[name="+t+"]").focus(),void s.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}s.swal("Validación exitosa","Procediendo con el guardado...","success"),S()},reset:function(n){n.$setPristine(!0)}};var S=function(){var t={},e=JSON.stringify(n.attachment);return t.data=Base64.encode(e),d({method:"POST",url:"api/customer-tracking-document/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){m(function(){x.queue.length>0?(I=t.data.result.id,x.uploadAll()):(n.reloadData(),n.onClear())})})["catch"](function(n){s.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){n.reloadData()})};n.dtOptionsTrackingDocument=o.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerId=t.customerId,n.$storage.hideMinimumStandardAttachmentCanceled&&(e.statusCode="2"),JSON.stringify(e)},url:"api/customer-tracking-document",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){P()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,e,o){r(angular.element(t).contents())(n)}),n.dtColumnsTrackingDocument=[a.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,e,o,a){var i=t.documentUrl?t.documentUrl:"",r="api/customer-tracking-document/download?id="+t.id,l="",c='<a target="_self" class="btn btn-primary btn-xs downloadDocumentRow lnk" href="'+r+'" uib-tooltip="Descargar anexo" data-id="'+t.id+'" >   <i class="fa fa-download"></i></a> ',s='<a class="btn btn-info btn-xs openDocumentRow lnk" target="_blank" href="'+i+'" uib-tooltip="Abrir anexo" data-id="'+t.id+'" >   <i class="fa fa-folder-open-o"></i></a> ',d='<a class="btn btn-danger btn-xs delDocumentRow lnk" href="#" uib-tooltip="Anular anexo" data-id="'+t.id+'" >   <i class="fa fa-ban"></i></a> ',m=!1;return null==t.protectionType?m=!0:"public"==t.protectionType?m=!0:"private"==t.protectionType&&1==t.hasPermission&&(m=!0),u.can("clientes_anexo_open")&&""!=i&&(l+=s),u.can("clientes_anexo_download")&&""!=i&&(l+=c),u.can("clientes_anexo_invalidate")&&n.isVisible&&"2"!=t.statusCode&&(l+=d),m?l:""}),a.newColumn("documentType").withTitle("Tipo de documento").withOption("width",200),a.newColumn("classification").withTitle("Clasificación").withOption("width",200),a.newColumn("description").withTitle("Descripción").withOption("width",200),a.newColumn("version").withTitle("Versión").withOption("width",200),a.newColumn("createdAt").withTitle("Fecha Creación").withOption("width",200).withOption("defaultContent",""),a.newColumn("status").withTitle("Estado").withOption("width",200).renderWith(function(n,t,e,o){var a="";switch(n){case"Vigente":a="label label-success";break;case"Anulado":a="label label-danger"}var i='<span class="'+a+'">'+n+"</span>";return i})];var P=function(){$("#dtTrackingDocument a.editRow").on("click",function(){var n=$(this).data("id"),t=$(this).data("url");""==t?s.swal("Error en la descarga","No existe un anexo para descargar","error"):jQuery("#downloadDocument")[0].src="api/customer-tracking-document/download?id="+n}),angular.element("#dtTrackingDocument a.delDocumentRow").on("click",function(){var t=angular.element(this).data("id");T({boxWidth:"35%",useBootstrap:!1,animation:"bottom",closeAnimation:"scale",title:"Está seguro?",content:"<strong>Anulará</strong> el anexo seleccionado",scope:n,type:"red",typeAnimated:!0,buttons:{cancel:{text:"Anular y cambiar versión",btnClass:"btn-primary",action:function(e,o){n.attachment.id=t,n.isView=!1,O(t),l.pop("info","Anulación Anexo","El anexo se cargó satisfactoriamente, seleccione una nueva versión del documento")}},fullCancel:{text:"Anular definitivamente",btnClass:"btn-red",action:function(o,a){var i={};i.id=t,d({method:"POST",url:"api/customer-tracking-document/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(t){swal("Eliminado","Anexo anulado satisfactoriamente","info"),n.reloadData()})["catch"](function(n){e.error(n),s.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}},closeAll:{text:"Cancelar",btnClass:"btn-default",action:function(n,t){}}}})})};n.dtInstanceTrackingDocumentCallback=function(t){n.dtInstanceTrackingDocument=t},n.reloadData=function(){n.dtInstanceTrackingDocument.reloadData()},n.onShowCancelledChange=function(){n.reloadData()}}]);
"use strict";app.controller("customerDiagnosticPreventionDocumentCtrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout",function(t,n,o,i,c,e){var a=o;t.diagnostic_section="list",t.currentId=0,t.navToSection=function(n,o,i){a.info("cambiando la vista a... section:",n," titlenav:",o," currentId:",i),e(function(){t.diagnostic_section=n,t.$parent.switchSubTab(o),t.currentId=i})}}]);
"use strict";app.controller("customerDiagnosticPreventionDocumentListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","SweetAlert","$http",function(t,n,e,i,o,a,r,s,c,l,d,u){var w=e,p={};t.isAgent="agent"==l.currentUser().wg_type,t.isAdmin="system"==l.currentUser().wg_type,t.isCustomer="customerAdmin"==l.currentUser().wg_type||"customerUser"==l.currentUser().wg_type,t.isAgent?c.go("app.clientes.list"):t.isCustomer&&(w.info("Step 15"),c.go("app.clientes.view",{customerId:l.currentUser().company})),p.operation="quotes",p.customer_id=n.customerId?n.customerId:0,t.dtInstanceCustomerDiagnosticPreventionDocument={},t.dtOptionsCustomerDiagnosticPreventionDocument=i.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:p,url:"api/customer/diagnostic-prevention-document",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){m()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(n,e,i){r(angular.element(n).contents())(t)}),t.dtColumnsCustomerDiagnosticPreventionDocument=[o.newColumn(null).withTitle("Acciones").withOption("width",200).notSortable().renderWith(function(n,e,i,o){var a=null!=n.document?n.document.path:"",r="api/customer/diagnostic-prevention-document/download?id="+n.id,s="",c='<a target="_self" class="btn btn-primary btn-xs editRow lnk" href="#" tooltip="Editar" data-id="'+n.id+'">   <i class="fa fa-edit"></i></a> ',l='<a target="_self" class="btn btn-info btn-xs downloadRow lnk" href="'+r+'" tooltip="Descargar anexo" data-id="'+n.id+'" data-url="'+a+'" >   <i class="fa fa-download"></i></a> ',d='<a class="btn btn-light-red btn-xs delRow lnk" href="#" tooltip="Eliminar" data-id="'+n.id+'" >   <i class="fa fa-trash"></i></a> ';return""!=a&&(s+=l),s+=c,s+=d,t.isAdmin||t.isAgent||t.$parent.isCustomerContractor,s}),o.newColumn("classification").withTitle("Clasificación").withOption("width",200),o.newColumn("name").withTitle("Nombre").withOption("width",200),o.newColumn("description").withTitle("Descripción").withOption("width",200),o.newColumn("startDate").withTitle("Fecha de Inicio Vigencia").withOption("width",200),o.newColumn("endDate").withTitle("Fecha de Finalización Vigencia").withOption("width",200),o.newColumn("version").withTitle("Versión").withOption("width",200),o.newColumn("status").withTitle("Estado").withOption("width",200).renderWith(function(t,n,e,i){var o="";switch(t){case"Vigente":o="label label-success";break;case"Anulado":o="label label-danger"}var a='<span class="'+o+'">'+t+"</span>";return a})];var m=function(){$("#dtCustomerDiagnosticPreventionDocument a.editRow").on("click",function(){var n=$(this).data("id");t.onEdit(n)}),$("#dtCustomerDiagnosticPreventionDocument a.downloadRow").on("click",function(){}),$("#dtCustomerDiagnosticPreventionDocument a.delRow").on("click",function(){var n=$(this).data("id");d.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(i){if(i){var o={};o.id=n,u({method:"POST",url:"api/customer/diagnostic-prevention-document/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(t){swal("Eliminado","asesor eliminado satisfactoriamente","info")})["catch"](function(t){e.error(t),d.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro por favor intentelo de nuevo","error")})["finally"](function(){t.reloadData()})}else swal("Cancelado","Operacion cancelada","error")})})};t.onCreate=function(){null!=t.$parent&&t.$parent.navToSection("edit","edit",0)},t.onEdit=function(n){null!=t.$parent&&t.$parent.navToSection("edit","edit",n)},t.reloadData=function(){t.dtInstanceCustomerDiagnosticPreventionDocument.reloadData()}}]);
"use strict";app.controller("customerDiagnosticPreventionDocumentEditCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","SweetAlert","$rootScope","$http","$timeout","$uibModal","flowFactory","cfpLoadingBar","$filter","$document","FileUploader","$localStorage",function(e,t,n,o,a,i,r,c,l,s,u,d,m,f,p,h,w,g,v,D){var C=n,O={},S=0,P=e.$parent.currentId;e.loading=!0,e.isView=l.is("app.program-prevention-document.view"),e.isCreate=l.is("app.program-prevention-document.create"),e.format="dd-MM-yyyy",e.minDate=new Date-1,e.classifications=u.parameters("program_prevention_document_classification"),e.documentStatus=u.parameters("customer_document_status");var b=function(){e.attachment={id:P,customerId:t.customerId?t.customerId:0,classification:null,name:"",code:"",description:"",status:e.documentStatus.length>0?e.documentStatus[0]:null,version:1,startDate:null,endDate:null,questions:[]}};b();var T=function(){if(e.attachment.id){var t={id:e.attachment.id};d({method:"GET",url:"api/customer/diagnostic-prevention-document",params:t})["catch"](function(e,t){if(403==t){var n=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";s.swal("No Autorizado","No estas autorizado para ver esta información.","error"),m(function(){l.go(n)},3e3)}else 404==t?(s.swal("Información no disponible","Anexo no encontrado","error"),m(function(){l.go("app.clientes.list")})):s.swal("Error","Se ha presentado un error al intentar acceder a la información del anexo","error")}).then(function(t){m(function(){e.attachment=t.data.result,I()})})["finally"](function(){m(function(){e.loading=!1},400)})}},I=function(){null!=e.attachment.startDate&&""!=e.attachment.startDate&&(e.attachment.startDate=new Date(e.attachment.startDate.date)),null!=e.attachment.endDate&&""!=e.attachment.endDate&&(e.attachment.endDate=new Date(e.attachment.endDate.date))};T(),e.master=e.attachment,e.form={submit:function(t){var n=null;if(t.$invalid){var o=null,n=null;for(o in t)"$"!=o[0]&&(null!==n||t[o].$valid||(n=t[o].$name),t[o].$pristine&&(t[o].$dirty=!0));return angular.element(".ng-invalid[name="+n+"]").focus(),void s.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}0==e.uploader.queue.length,A()},reset:function(t){e.attachment=angular.copy(e.master),t.$setPristine(!0)}};var A=function(){var t={},n=JSON.stringify(e.attachment);return t.data=Base64.encode(n),d({method:"POST",url:"api/customer/diagnostic-prevention-document/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){m(function(){e.attachment=t.data.result,S=t.data.result.id,O.customer_diagnostic_prevention_document_id=S,I(),e.uploader.queue.length>0?y.uploadAll():(s.swal("Registro","La información ha sido guardada satisfactoriamente","success"),e.reloadData(),e.reloadDataSelected(),e.onClear())})})["catch"](function(e){s.swal("Error de guardado","Error guardando el anexo por favor verifique los datos ingresados!","error")})["finally"](function(){e.reloadData()})},y=e.uploader=new v({url:"api/customer/diagnostic-prevention-document/upload",formData:[],removeAfterUpload:!0});y.filters.push({name:"customFilter",fn:function(e,t){return this.queue.length<10}}),y.onWhenAddingFileFailed=function(e,t,n){console.info("onWhenAddingFileFailed",e,t,n)},y.onAfterAddingFile=function(e){console.info("onAfterAddingFile",e)},y.onAfterAddingAll=function(e){console.info("onAfterAddingAll",e)},y.onBeforeUploadItem=function(e){console.info("onBeforeUploadItem",e);var t={id:S};e.formData.push(t)},y.onProgressItem=function(e,t){console.info("onProgressItem",e,t)},y.onProgressAll=function(e){console.info("onProgressAll",e)},y.onSuccessItem=function(e,t,n,o){console.info("onSuccessItem",e,t,n,o)},y.onErrorItem=function(e,t,n,o){console.info("onErrorItem",e,t,n,o)},y.onCancelItem=function(e,t,n,o){console.info("onCancelItem",e,t,n,o)},y.onCompleteItem=function(e,t,n,o){console.info("onCompleteItem",e,t,n,o)},y.onCompleteAll=function(){s.swal("Registro","La información ha sido guardada satisfactoriamente","success"),e.reloadData(),e.reloadDataSelected(),e.onClear()},e.onClear=function(){null!=e.$parent&&e.$parent.$parent.navToSection("edit","edit",e.attachment.id)},e.onCancel=function(){null!=e.$parent&&e.$parent.$parent.navToSection("list","list",0)},O.operation="management",O.customer_diagnostic_prevention_document_id=P?P:0,e.dtInstanceCustomerDiagnosticPreventionDocumentQuestionSelected={},e.dtOptionsCustomerDiagnosticPreventionDocumentQuestionSelected=o.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:O,url:"api/customer/diagnostic-prevention-document-question/selected",type:"POST",beforeSend:function(){},complete:function(e){m(function(){})}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){k()}).withDOM("tr").withOption("language",{}).withOption("createdRow",function(t,n,o){r(angular.element(t).contents())(e)}),e.dtColumnsCustomerDiagnosticPreventionDocumentQuestionSelected=[a.newColumn(null).withTitle("").withOption("width",100).notSortable().renderWith(function(t,n,o,a){var i="",r="",c='<a class="btn btn-light-red btn-xs delRow lnk" href="#" tooltip="Remover anexo" data-id="'+t.id+'" >   <i class="fa fa-trash"></i></a> ';'<a class="btn btn-purple btn-xs configureRow lnk" href="#" tooltip="Configurar pregunta"  data-id="'+t.id+'"'+r+' >   <i class="fa fa-gear"></i></a> ';return e.isAdmin,i+=c}),a.newColumn("program").withTitle("Programa").withOption("width",400),a.newColumn("category").withTitle("Categoría"),a.newColumn("article").withTitle("Artículo"),a.newColumn("question").withTitle("Pregunta"),a.newColumn("guide").withTitle("Guía").withOption("width",200).renderWith(function(e,t,n,o){var a="",i="";null!=e&&""!=e?(i="Tiene",a="label label-success"):(i="No tiene",a="label label-danger");var r='<span class="'+a+'">'+i+"</span>";return r})];var k=function(){$("#dtCustomerDiagnosticPreventionDocumentQuestionSelected a.editRow").on("click",function(){}),$("#dtCustomerDiagnosticPreventionDocumentQuestionSelected a.delRow").on("click",function(){var t=$(this).data("id");s.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(n){if(n){var o={};o.id=t,d({method:"POST",url:"api/customer/diagnostic-prevention-document-question/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){s.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro por favor intentelo de nuevo","error")})["finally"](function(){e.reloadDataSelected(),e.reloadData()})}else swal("Cancelado","Operacion cancelada","error")})})};e.reloadDataSelected=function(){e.dtInstanceCustomerDiagnosticPreventionDocumentQuestionSelected.reloadData()},e.dtInstanceCustomerDiagnosticPreventionDocumentQuestion={},e.dtOptionsCustomerDiagnosticPreventionDocumentQuestion=o.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:O,url:"api/customer/diagnostic-prevention-document-question",type:"POST",beforeSend:function(){},complete:function(e){m(function(){})}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){x()}).withDOM("tr").withOption("language",{}).withOption("createdRow",function(t,n,o){r(angular.element(t).contents())(e)}),e.dtColumnsCustomerDiagnosticPreventionDocumentQuestion=[a.newColumn("program").withTitle("Programa").withOption("width",400),a.newColumn("category").withTitle("Categoría"),a.newColumn("article").withTitle("Artículo"),a.newColumn("question").withTitle("Pregunta"),a.newColumn("guide").withTitle("Guía").withOption("width",200).renderWith(function(e,t,n,o){var a="",i="";null!=e&&""!=e?(i="Tiene",a="label label-success"):(i="No tiene",a="label label-danger");var r='<span class="'+a+'">'+i+"</span>";return r}),a.newColumn(null).withTitle("Acciones").notSortable().renderWith(function(e,t,n,o){var a="",i="1"==e.selected?"checked":"",r='<input bs-switch ng-model="isSelected" type="checkbox" switch-active="true" ng-click="edit('+e.id+')" name="'+e.id+'" ng-true-value="true" ng-false-value="false" switch-on-text="Si" switch-off-text="No"> ',r='<div class="checkbox clip-check check-success "><input class="editRow" type="checkbox" id="chk_'+e.customerDiagnosticPreventionQuestionId+'" data-id="'+e.customerDiagnosticPreventionQuestionId+'" data-value="'+e.selected+'" '+i+' ><label for="chk_'+e.customerDiagnosticPreventionQuestionId+'"> Seleccionar </label></div>';return a+=r}).notSortable()];var x=function(){$("input[type=checkbox]").on("change",function(){var t=$(this).data("id"),n=($(this).data("value"),$(this).is(":checked"));if(n){var o={programPreventionQuestionId:t};e.attachment.questions.push(o)}else e.attachment.questions=w("filter")(e.attachment.questions,{programPreventionQuestionId:"!"+t});C.info(e.attachment.questions)})};e.reloadData=function(){e.dtInstanceCustomerDiagnosticPreventionDocumentQuestion.reloadData()}}]);
"use strict";app.controller("customerDiagnosticTabsCtrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout","$state","$filter","flowFactory","$http",function(t,s,e,a,i,o,r,m,n,u){t.views=[{name:"tab_minimum_standard",url:i.app.views.urlRoot+"modules/customer/diagnostic/tab-minimum-standard/customer_evaluation_minimum_standard.htm"},{name:"tab_minimum_standard_0312",url:i.app.views.urlRoot+"modules/customer/diagnostic/tab-minimum-standard-0312/customer_evaluation_minimum_standard.htm"},{name:"tab_road_safety",url:i.app.views.urlRoot+"modules/customer/diagnostic/tab-road-safety/customer_road_safety.htm"},{name:"tab_matrix",url:i.app.views.urlRoot+"modules/customer/diagnostic/tab-matrix/customer_diagnostic_risk_matrix.htm"},{name:"tab_express_matrix",url:i.app.views.urlRoot+"modules/customer/diagnostic/tab-express-matrix/customer_diagnostic_express_matrix.htm"},{name:"tab_sg_sst",url:i.app.views.urlRoot+"modules/customer/diagnostic/sg-sst/customer_diagnostic.htm"},{name:"tab_observation",url:i.app.views.urlRoot+"modules/customer/diagnostic/observation/customer_diagnostic_observation_list.htm"}],t.section=t.views[0],t.isAgent="agent"==i.currentUser().wg_type,t.isAdmin="system"==i.currentUser().wg_type,t.isCustomer="customerAdmin"==i.currentUser().wg_type||"customerUser"==i.currentUser().wg_type,t.tabActive=i.can("estandares_minimos_0312_open")?0:1,t.tabname="tab_minimum_standard",t.matrixType=t.customer.matrixType,t.getView=function(s){var e=m("filter")(t.views,{name:s});return e[0]},t.switchTab=function(s,e){o(function(){t.tabname=s,t.titletab=e,t.tabsloaded.push(s),t.section=t.getView(s)})},t.switchSubTab=function(s){o(function(){t.subtab=s})}}]);
"use strict";app.controller("customerEvaluationMinimumStandardCtrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout",function(t,n,a,o,r,i){var c=a;c.info("loading..customerEvaluationMinimumStandard!!! "),t.standard_section="summary",t.currentId=0,t.navToSection=function(n,a,o){i(function(){t.standard_section=n,t.$parent.switchSubTab(a),t.currentId=o})}}]);
"use strict";app.controller("customerEvaluationMinimumStandardSummaryCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","ChartService",function(t,n,a,i,o,e,r,d,u,l,m,c,s,p){function h(){var a={customerId:n.customerId,evaluationMinimumStandardId:t.currentId},i=[{name:"chart_bar_options",criteria:null},{name:"chart_doughnut_options",criteria:null},{name:"customer_evaluation_minimum_standard",criteria:a}];p.getDataChart(i).then(function(n){t.chart.bar.options=n.data.data.chartBarOptions,t.chart.doughnut.options=n.data.data.chartLineOptions,t.chart.programs.data=n.data.data.customerEvaluationMinimumStandardCycle,t.chart.progress.data=n.data.data.customerEvaluationMinimumStandardProgress,t.chart.progress.total=n.data.data.customerEvaluationMinimumStandardAverage,t.currentId=n.data.data.customerEvaluationMinimumStandardId,t.$parent.currentId=n.data.data.customerEvaluationMinimumStandardId},function(n){t.status="Unable to load customer data: "+n.message})}t.currentId=0,t.chart={bar:{options:null},doughnut:{options:null},programs:{data:null},progress:{data:null,total:0}},t.dtInstanceEvaluationMinimumStandardSummary={},t.dtOptionsEvaluationMinimumStandardSummary=i.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(a){return a.operation="standard",a.customer_id=n.customerId,a.standard_id=t.currentId,a},url:"api/customer/evaluation-minimum-standard/summary",type:"POST",beforeSend:function(){},complete:function(t){h()}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withDOM("tr").withOption("language",{}).withOption("createdRow",function(n,a,i){r(angular.element(n).contents())(t)}),t.dtColumnsEvaluationMinimumStandardSummary=[o.newColumn("name").withTitle("Ciclo").withOption("width",200),o.newColumn("description").withTitle("Estándar").withOption("width",400),o.newColumn("items").withTitle("Items").withOption("width",200),o.newColumn("checked").withTitle("Evaluados").withOption("width",200),o.newColumn("advance").withTitle("Valor Estándar (%)").withOption("width",200),o.newColumn("total").withTitle("Valoración Items (%)").withOption("width",200),o.newColumn(null).withTitle("Estado").withOption("width",200).renderWith(function(t,n,a,i){var o="label label-danger",e="Sin Iniciar";parseInt(t.checked)==parseInt(t.items)?(e="Completado",o="label label-info"):parseInt(t.checked)>0&&(e="Iniciado",o="label label-success");var r='<span class="'+o+'">'+e+"</span>";return r}).notSortable()],t.dtInstanceEvaluationMinimumStandardSummaryCallback=function(n){t.dtInstanceEvaluationMinimumStandardSummary=n},t.reloadData=function(){t.dtInstanceEvaluationMinimumStandardSummary.reloadData()},t.onContinue=function(){null!=t.$parent&&t.$parent.navToSection("edit","edit",t.currentId)},t.onConfig=function(){null!=t.$parent&&t.$parent.navToSection("config","config",t.currentId)},t.onViewReport=function(){null!=t.$parent&&t.$parent.navToSection("report","report",t.currentId)},t.onViewMonthlyReport=function(){null!=t.$parent&&t.$parent.navToSection("monthlyReport","monthlyReport",t.currentId)},t.onExportPdf=function(){kendo.drawing.drawDOM($(".minimun-standard-export-pdf")).then(function(t){return kendo.drawing.exportPDF(t,{paperSize:"auto",margin:{left:"1cm",top:"1cm",right:"1cm",bottom:"1cm"}})}).done(function(t){kendo.saveAs({dataURI:t,fileName:"Estandares-Minimos-Auto-Evaluacion.pdf",proxyURL:"//demos.telerik.com/kendo-ui/service/export"})})},t.onExportExcel=function(){jQuery("#download")[0].src="api/customer/evaluation-minimum-standard/summary-export-excel?id="+t.currentId},t.onReportExportPdf=function(){jQuery("#download")[0].src="api/customer/evaluation-minimum-standard-item/export-pdf?id="+t.currentId}}]);
"use strict";app.controller("customerEvaluationMinimumStandardEditCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","SweetAlert","$rootScope","$http","$timeout","$uibModal","flowFactory","cfpLoadingBar","$document","$filter","$aside","FileUploader","ChartService","ListService",function(t,e,n,a,i,o,r,l,s,c,d,u,m,p,f,v,h,g,w,y,b,C){function S(){var n={customerId:e.customerId,evaluationMinimumStandardId:x},a=[{name:"chart_bar_options",criteria:null},{name:"chart_doughnut_options",criteria:null},{name:"customer_evaluation_minimum_standard",criteria:n}];b.getDataChart(a).then(function(e){t.chart.bar.options=e.data.data.chartBarOptions,t.chart.doughnut.options=e.data.data.chartLineOptions,t.chart.programs.data=e.data.data.customerEvaluationMinimumStandardCycle,t.chart.progress.data=e.data.data.customerEvaluationMinimumStandardProgress,t.chart.progress.total=e.data.data.customerEvaluationMinimumStandardAverage},function(e){t.status="Unable to load customer data: "+e.message})}function I(){var e=[{name:"customer_evaluation_minimum_stardard_cycle",value:x}];C.getDataList(e).then(function(e){t.cycles=e.data.data.customerEvaluationMinimumStandardCycle,E()},function(e){t.status="Unable to load customer data: "+e.message})}t.currentStep=-1,t.isView=!0;var O=n,x=t.$parent.currentId,T={refresh:!0,index:0},D={id:0,code:null},P={model:null};t.chart={bar:{options:null},doughnut:{options:null},programs:{data:null},progress:{data:null,total:0}},S(),I();var A=function(){var n={};n.customer_id=e.customerId,n.standard_id=x,u({method:"POST",url:"api/customer/evaluation-minimum-standard/list-data",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(e){m(function(){t.rateList=e.data.data.rate,t.rateRealList=e.data.data.rateReal})})["catch"](function(t){c.swal("Error Cargando Reportes","Se ha presentado un error durante la consulta de los reportes para el diagnóstico por favor intentelo de nuevo","error")})["finally"](function(){})};A();var E=function(){if(0==D.id){var e=g("filter")(t.cycles,function(t){return parseFloat(t.advance)<100});t.currentStep=e.length>0?t.cycles.indexOf(e[0]):t.cycles.length-1,D.id=t.cycles[t.currentStep].id,D.code=t.cycles[t.currentStep].abbreviation,t.grid.dataSource.read()}},_=function(){I(),S(),t.grid.dataSource.read()};m(function(){t.mainGridOptions={dataSource:{type:"odata",transport:{read:{url:"api/customer-evaluation-minimum-standard-item",dataType:"json",type:"POST",data:function(){var t={evaluationMinimumStandardId:x,cycleId:D.id};return t}},parameterMap:function(t,e){return JSON.stringify(t)}},schema:{model:{id:"id",fields:{description:{editable:!1,nullable:!0}}},data:function(t){return t.data||t},total:function(t){return t.recordsTotal||t.data.length||0}},pageSize:10,serverPaging:!0,serverFiltering:!0,serverSorting:!0},sortable:{mode:"multiple"},pageable:{change:function(t){T.index=t.index,O.info("page.index",T.index)}},filterable:{mode:"row"},dataBound:function(t){this.expandRow(this.tbody.find("tr.k-master-row"))},columns:[{field:"description",title:"Estandar Hijo",attributes:{"class":"text-orange text-large"},filterable:{cell:{operator:"contains",suggestionOperator:"contains"}}},{field:null,title:"Avance",width:"150px",attributes:{style:"text-align: center"},filterable:!1,template:function(t){var e='<h4 class="no-margin">'+t.advance+"%</h4>";return e+='<uib-progressbar value="'+t.advance+'" class="progress-xs no-radius no-margin" type="success"></uib-progressbar>',e+=t.checked+" de "+t.items}},{field:null,title:"Promedio",width:"150px",attributes:{style:"text-align: center"},filterable:!1,template:function(t){var e='<h4 class="no-margin">'+t.average+"%</h4>";return e+='<uib-progressbar value="'+t.total+'" class="progress-xs no-radius no-margin" type="success"></uib-progressbar>',e+="Promedio Total"}}]},t.detailGridOptions=function(t){return{dataSource:{type:"odata",transport:{read:{url:"api/customer-evaluation-minimum-standard-item-question",dataType:"json",type:"POST",data:function(){var e={minimumStandardId:t.id,evaluationMinimumStandardId:x,cycleId:D.id};return e}},parameterMap:function(t,e){return JSON.stringify(t)}},requestEnd:function(t){},schema:{model:{id:"id",fields:{description:{editable:!1,nullable:!0},article:{editable:!1,nullable:!0},rate:{editable:!1,defaultValue:{id:0,text:null,code:null}}}},data:function(t){return t.data||t},total:function(t){return t.recordsTotal||t.data.length||0}},serverPaging:!1,serverSorting:!1,serverFiltering:!1,filter:{field:"minimumStandardId",operator:"eq",value:t.id}},editable:"incell",edit:function(t){P.model=t.model},scrollable:!1,sortable:!1,pageable:!1,columns:[{command:[{text:" ",template:"<a class='btn btn-dark-azure btn btn-sm' ng-click='onAddVerificationList(dataItem)' uib-tooltip='Lista de verificación' tooltip-placement='right'><i class='fa fa-list'></i></a> "},{text:" ",template:"<a class='btn btn-light-red btn btn-sm' ng-click='onAddComment(dataItem)' uib-tooltip='Comentarios' tooltip-placement='right'><i class='fa fa-comments'></i></a> "},{text:" ",template:"<a class='btn btn-warning btn btn-sm' ng-click='onAddImprovementPlan(dataItem)' uib-tooltip='Plan Mejoramiento' tooltip-placement='right'><i class='fa fa-plus-square'></i></a> "},{text:" ",template:"<a class='btn btn-info btn btn-sm' ng-click='onAddAttachment(dataItem)' uib-tooltip='Anexos' tooltip-placement='right'><i class='fa fa-paperclip'></i></a> "}],width:"160px",headerAttributes:{style:"display: none"}},{field:"description",title:"Descripción",headerAttributes:{style:"display: none"}},{field:"numeral",title:"Numeral",width:"150px",headerAttributes:{style:"display: none"},attributes:{style:"text-align: center"}},{field:"rate",title:"Calificación",width:"220px",editor:'<input kendo-drop-down-list k-value-primitive="true" k-options="rateOptions"  />',template:function(t){return t.rate?t.rate.text:"-Seleccionar-"},headerAttributes:{style:"display: none"},attributes:{style:"text-align: center;font-weight: bold;","class":"text-capitalize text-dark"}},{title:"icon",width:"70px",headerAttributes:{style:"display: none"},template:function(t){var e="";switch(t.rateCode){case"nac":e='<i class="fa fa-ban text-yellow text-extra-extra-large"></i>';break;case"nas":e='<i class="fa fa-minus-circle text-danger text-extra-extra-large"></i>';break;case"cp":e='<i class="fa fa-check-circle-o text-green text-extra-extra-large"></i>';break;case"nc":e='<i class="fa fa-circle-o text-red text-extra-extra-large"></i>';break;default:e='<i class="fa fa-question-circle text-orange text-extra-extra-large"></i>'}return e},attributes:{style:"text-align: center;font-weight: bold;"}}]}}}),t.$on("kendoWidgetCreated",function(e,n){void 0!==t.grid&&null!==t.grid||(t.grid=n)}),t.form={next:function(e){if(t.toTheTop(),e.$valid)M();else{var n=null,a=null;for(n in e)"$"!=n[0]&&(null!==a||e[n].$valid||(a=e[n].$name),e[n].$pristine&&(e[n].$dirty=!0));angular.element(".ng-invalid[name="+a+"]").focus(),R()}},prev:function(t){k()},goTo:function(e,n){parseInt(t.currentStep)>parseInt(n)?L(n):e.$valid?L(n):R()},submit:function(){},reset:function(){}};var M=function(){t.currentStep++,D.id=t.cycles[t.currentStep].id,D.code=t.cycles[t.currentStep].abbreviation,t.grid.dataSource.page(1)},k=function(){t.currentStep--,D.id=t.cycles[t.currentStep].id,D.code=t.cycles[t.currentStep].abbreviation,t.grid.dataSource.page(1)},L=function(e){t.currentStep=e,D.id=t.cycles[t.currentStep].id,D.code=t.cycles[t.currentStep].abbreviation,t.grid.dataSource.page(1)},R=function(t){l.pop("error","Error","Por favor complete este ciclo antes de continuar.")};t.onCancel=function(e){null!=t.$parent&&t.$parent.navToSection("summary","summary",x)},t.onAddComment=function(e){var a=w.open({templateUrl:d.app.views.urlRoot+"modules/customer/common/modals/customer_questions_comment_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideCustomerEvaluationMinimumStandardItemCommentCtrl",scope:t,resolve:{item:function(){return e}}});a.result.then(function(){},function(){n.info("Modal dismissed at: "+new Date)})},t.onAddAttachment=function(e){var a=w.open({templateUrl:d.app.views.urlRoot+"modules/customer/common/modals/customer_document_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideCustomerEvaluationMinimumStandardItemAttachmentCtrl",scope:t,resolve:{item:function(){return e},isView:function(){return t.isView},cycle:function(){return t.cycles[t.currentStep]}}});a.result.then(function(){},function(){n.info("Modal dismissed at: "+new Date)})},t.onAddImprovementPlan=function(e){var a=w.open({templateUrl:d.app.views.urlRoot+"modules/customer/common/modals/customer_improvement_plan_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideCustomerEvaluationMinimumStandardItemImprovementPlanCtrl",scope:t,resolve:{item:function(){return e},isView:function(){return t.isView},cycle:function(){return t.cycles[t.currentStep]}}});a.result.then(function(){},function(){n.info("Modal dismissed at: "+new Date)})},t.onAddVerificationList=function(e){var a=w.open({templateUrl:d.app.views.urlRoot+"modules/customer/diagnostic/tab-minimum-standard/customer_evaluation_minimum_standard_items_detail_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideCustomerEvaluationMinimumStandardItemDetailCtrl",scope:t,resolve:{item:function(){return e},isView:function(){return t.isView}}});a.result.then(function(){_()},function(){n.info("Modal dismissed at: "+new Date)})},t.onSummaryExportExcel=function(){jQuery("#download")[0].src="api/customer/evaluation-minimum-standard-item/export-excel?id="+t.$parent.currentId}}]),app.controller("ModalInstanceSideCustomerEvaluationMinimumStandardItemAttachmentCtrl",["$stateParams","$rootScope","$scope","$uibModalInstance","cycle","item","$log","$timeout","SweetAlert","isView","$filter","FileUploader","$http","DTColumnBuilder","DTOptionsBuilder","$compile","ListService",function(t,e,n,a,i,o,r,l,s,c,d,u,m,p,f,v,h){function g(){var e=[{name:"customer_document_type",value:t.customerId}];h.getDataList(e).then(function(t){n.documentType=t.data.data.customerDocumentType},function(t){n.status="Unable to load customer data: "+t.message})}var w=0;n.documentClassification=e.parameters("customer_document_classification"),n.documentStatus=e.parameters("customer_document_status"),n.isView=c,g();var y=function(){n.attachment={id:0,customerId:t.customerId,program:i.abbreviation,agent:null,type:null,classification:null,status:n.documentStatus?n.documentStatus[0]:null,version:1,description:""}};y(),n.onCloseModal=function(){a.close(1)},n.onCancel=function(){a.dismiss("cancel")},n.onClear=function(){y()};var b=n.uploader=new u({url:"api/document/upload",formData:[],removeAfterUpload:!0});b.filters.push({name:"customFilter",fn:function(t,e){return this.queue.length<10}}),b.onWhenAddingFileFailed=function(t,e,n){console.info("onWhenAddingFileFailed",t,e,n)},b.onAfterAddingFile=function(t){console.info("onAfterAddingFile",t)},b.onAfterAddingAll=function(t){console.info("onAfterAddingAll",t)},b.onBeforeUploadItem=function(t){console.info("onBeforeUploadItem",t);var e={id:w};t.formData.push(e)},b.onProgressItem=function(t,e){console.info("onProgressItem",t,e)},b.onProgressAll=function(t){console.info("onProgressAll",t)},b.onSuccessItem=function(t,e,n,a){console.info("onSuccessItem",t,e,n,a)},b.onErrorItem=function(t,e,n,a){console.info("onErrorItem",t,e,n,a)},b.onCancelItem=function(t,e,n,a){console.info("onCancelItem",t,e,n,a)},b.onCompleteItem=function(t,e,n,a){console.info("onCompleteItem",t,e,n,a)},b.onCompleteAll=function(){console.info("onCompleteAll"),n.reloadData(),n.onClear()},n.form={submit:function(t){var e=null;if(t.$invalid){var n=null,e=null;for(n in t)"$"!=n[0]&&(null!==e||t[n].$valid||(e=t[n].$name),t[n].$pristine&&(t[n].$dirty=!0));return angular.element(".ng-invalid[name="+e+"]").focus(),void s.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}s.swal("Validación exitosa","Procediendo con el guardado...","success"),C()},reset:function(t){t.$setPristine(!0)}};var C=function(){var t={},e=JSON.stringify(n.attachment);return t.data=Base64.encode(e),m({method:"POST",url:"api/document/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){l(function(){b.queue.length>0?(w=t.data.result.id,b.uploadAll()):(n.reloadData(),n.onClear())})})["catch"](function(t){s.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){n.reloadData()})};n.dtInstanceCustomerDocumentModal={},n.dtOptionsCustomerDocumentModal=f.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.operation="document",e.customerId=t.customerId,e.program=i.abbreviation,e.statusCode="2",JSON.stringify(e)},url:"api/customer-document",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){S()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,e,a){v(angular.element(t).contents())(n)}),n.dtColumnsCustomerDocumentModal=[p.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,n,a,i){var o=t.documentUrl?t.documentUrl:"",r="api/document/download?id="+t.id,l="",s='<a target="_self" class="btn btn-primary btn-xs downloadDocumentRow lnk" href="'+r+'" uib-tooltip="Descargar anexo" data-id="'+t.id+'" >   <i class="fa fa-download"></i></a> ',c='<a class="btn btn-info btn-xs openDocumentRow lnk" target="_blank" href="'+o+'" uib-tooltip="Abrir anexo" data-id="'+t.id+'" >   <i class="fa fa-folder-open-o"></i></a> ',d=!1;return null==t.protectionType?d=!0:"public"==t.protectionType?d=!0:"private"==t.protectionType&&1==t.hasPermission&&(d=!0),e.can("clientes_anexo_open")&&""!=o&&(l+=c),e.can("clientes_anexo_download")&&""!=o&&(l+=s),d?l:""}),p.newColumn("documentType").withTitle("Tipo de documento").withOption("width",200),p.newColumn("classification").withTitle("Clasificación").withOption("width",200),p.newColumn("description").withTitle("Descripción").withOption("width",200),p.newColumn("version").withTitle("Versión").withOption("width",200),p.newColumn("dateOfCreation").withTitle("Fecha Creación").withOption("width",200).withOption("defaultContent",""),p.newColumn("status").withTitle("Estado").withOption("width",200).renderWith(function(t,e,n,a){var i="";switch(t){case"Vigente":i="label label-success";break;case"Anulado":i="label label-danger"}var o='<span class="'+i+'">'+t+"</span>";return o})];var S=function(){$("#dtCustomerDocumentModal a.editRow").on("click",function(){var t=$(this).data("id"),e=$(this).data("url");""==e?s.swal("Error en la descarga","No existe un anexo para descargar","error"):jQuery("#downloadDocument")[0].src="api/document/download?id="+t})};n.dtInstanceCustomerDocumentModalCallback=function(t){n.dtInstanceCustomerDocumentModal=t},n.reloadData=function(){n.dtInstanceCustomerDocumentModal.reloadData()}}]),app.controller("ModalInstanceSideCustomerEvaluationMinimumStandardItemImprovementPlanCtrl",["$stateParams","$rootScope","$scope","$uibModalInstance","item","cycle","$log","$timeout","SweetAlert","isView","$filter","FileUploader","$http","DTOptionsBuilder","DTColumnBuilder","$compile",function(t,e,n,a,i,o,r,l,s,c,d,u,m,p,f,v){n.maxDate=new Date,n.datePickerConfig={culture:"es-CO",format:"dd/MM/yyyy HH:mm"},n.responsibleList=[],n.typesAlert=d("orderBy")(e.parameters("tracking_alert_type"),"id",!1),n.typesTime=e.parameters("tracking_alert_timeType"),n.statusAlert=e.parameters("tracking_alert_status"),n.preferencesAlert=e.parameters("tracking_alert_preference"),n.typeList=e.parameters("improvement_plan_type");var h=function(){n.improvement={id:0,customerId:t.customerId,classificationName:o.name,classificationId:o.abbreviation,entityName:"EM",entityId:i.id,type:null,endDate:null,description:"",observation:"",responsible:null,isRequiresAnalysis:!1,status:{id:0,value:"CR",item:"Creada"},trackingList:[],alertList:[]}};h(),n.onLoadRecord=function(t){if(0!=t){var e={id:t};m({method:"GET",url:"api/customer/improvement-plan",params:e})["catch"](function(t,e){if(403==e){var n=null!==t.message&&void 0!==t.message?t.message:"app.clientes.list";s.swal("No Autorizado","No estas autorizado para ver esta información.","error"),l(function(){$state.go(n)},3e3)}else 404==e?s.swal("Información no disponible","Registro no encontrado","error"):s.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(t){console.log(t),l(function(){null!=t.data.result&&""!=t.data.result&&(n.improvement=t.data.result,y())},400)})["finally"](function(){})}else n.loading=!1},n.onCloseModal=function(){a.close(1)},n.onCancel=function(){a.dismiss("cancel")},n.onClear=function(){};var g=function(){var e={customer_id:t.customerId};return m({method:"POST",url:"api/customer/improvement-plan/list-data",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(t){l(function(){n.responsibleList=t.data.data.responsible})})["catch"](function(t){s.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};g(),n.master=n.improvement,n.form={submit:function(t){var e=null;if(t.$invalid){var n=null,e=null;for(n in t)"$"!=n[0]&&(null!==e||t[n].$valid||(e=t[n].$name),t[n].$pristine&&(t[n].$dirty=!0));return angular.element(".ng-invalid[name="+e+"]").focus(),void s.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}s.swal("Validación exitosa","Procediendo con el guardado...","success"),w()},reset:function(t){n.improvement=angular.copy(n.master),t.$setPristine(!0)}};var w=function(){var t={},e=JSON.stringify(n.improvement);return t.data=Base64.encode(e),m({method:"POST",url:"api/customer/improvement-plan/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){l(function(){h()})})["catch"](function(t){s.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){n.reloadData()})},y=function(){null!=n.improvement.endDate&&(n.improvement.endDate=new Date(n.improvement.endDate.date)),angular.forEach(n.improvement.trackingList,function(t,e){null!=t.startDate&&(t.startDate=new Date(t.startDate.date))})};n.onAddTracking=function(){l(function(){null==n.improvement.trackingList&&(n.improvement.trackingList=[]),n.improvement.trackingList.push({id:0,customerImprovementPlanId:0,responsible:null,startDate:null})})},n.onRemoveTracking=function(t){s.swal({title:"Está seguro?",text:"Desea confirmar la eliminación de este registro ?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(e){e?l(function(){var e=n.improvement.trackingList[t];if(n.improvement.trackingList.splice(t,1),0!=e.id){var a={};a.id=e.id,m({method:"POST",url:"api/customer/improvement-plan-tracking/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){r.error(t),s.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})},n.onAddAlert=function(){l(function(){null==n.improvement.alertList&&(n.improvement.alertList=[]),n.improvement.alertList.push({id:0,customerImprovementPlanId:0,type:null,preference:null,time:0,timeType:null,status:null})})},n.onRemoveAlert=function(t){s.swal({title:"Está seguro?",text:"Desea confirmar la eliminación de este registro ?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(e){e?l(function(){var e=n.improvement.alertList[t];if(n.improvement.alertList.splice(t,1),0!=e.id){var a={};a.id=e.id,m({method:"POST",url:"api/customer/improvement-plan-alert/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){r.error(t),s.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})},n.dtInstanceImprovementPlan={},n.dtOptionsImprovementPlan=p.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.customerId=n.improvement.customerId,t.entityId=n.improvement.entityId,t.entityName=n.improvement.entityName,JSON.stringify(t)},url:"api/customer-improvement-plan-entity",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){b()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,e,a){v(angular.element(t).contents())(n)}),n.dtColumnsImprovementPlan=[f.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,a,i,o){var r="",l='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+t.id+'" >   <i class="fa fa-edit"></i></a> ',s='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+t.id+'" >   <i class="fa fa-trash-o"></i></a> ';return e.can("cliente_plan_mejoramiento_edit")&&(r+=l),e.can("cliente_plan_mejoramiento_delete")&&(r+=s),n.isView?null:r}),f.newColumn("origin").withTitle("Origen").withOption("width",200).withOption("defaultContent",""),f.newColumn("classification").withTitle("Clasificación").withOption("width",200).withOption("defaultContent",""),f.newColumn("type").withTitle("Tipo").withOption("width",200).withOption("defaultContent",""),f.newColumn("description").withTitle("Hallazgo").withOption("width",200).withOption("defaultContent",""),f.newColumn("responsibleName").withTitle("Responsable").withOption("defaultContent",""),f.newColumn(null).withTitle("Fecha Cierre").withOption("width",200).renderWith(function(t,e,n,a){return"object"==typeof t.endDate&&null!=t.endDate?moment(t.endDate.date).format("DD/MM/YYYY"):null!=t.endDate?moment(t.endDate).format("DD/MM/YYYY"):""}),f.newColumn(null).withTitle("Estado").withOption("width",200).withOption("defaultContent","").renderWith(function(t,e,n,a){var i="label label-success",o=t.status;switch(t.statusCode){case"AB":i="label label-info";break;case"CO":i="label label-success";break;case"CA":i="label label-danger"}return'<span class="'+i+'">'+o+"</span>"})];var b=function(){$("#dtImprovementPlan a.editRow").on("click",function(){var t=$(this).data("id");n.onLoadRecord(t)}),$("#dtImprovementPlan a.delRow").on("click",function(){var t=$(this).data("id");s.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(e){if(e){var a={};a.id=t,m({method:"POST",url:"api/customer/improvement-plan/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){r.error(t),s.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){n.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};n.dtInstanceImprovementPlanCallback=function(t){n.dtInstanceImprovementPlan=t},n.reloadData=function(){n.dtInstanceImprovementPlan.reloadData()}}]),app.controller("ModalInstanceSideCustomerEvaluationMinimumStandardItemCommentCtrl",["$stateParams","$rootScope","$scope","$uibModalInstance","item","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile","$document",function(t,e,n,a,i,o,r,l,s,c,d,u,m,p,f,v){var h=function(){n.entity={id:0,customerEvaluationMinimumStandardItemId:i.id,comment:""}};h(),n.onCloseModal=function(){a.close(1)},n.onCancel=function(){a.dismiss("cancel")},n.onClear=function(){h()},n.form={submit:function(t){var e=null;if(t.$invalid){var a=null,e=null;for(a in t)"$"!=a[0]&&(null!==e||t[a].$valid||(e=t[a].$name),t[a].$pristine&&(t[a].$dirty=!0));return angular.element(".ng-invalid[name="+e+"]").focus(),void r(function(){c.pop("error","Error","Por favor verifique los datos requeridos del formulario y vuelva a intentarlo")},500)}n.onSave()},reset:function(t){t.$setPristine(!0)}},n.onSave=function(){var t={},e=JSON.stringify(n.entity);return t.data=Base64.encode(e),s({method:"POST",url:"api/customer/evaluation-minimum-standard-item-comment/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){r(function(){c.pop("success","Operación Exitosa","Actualización exitosa."),n.onClear(),n.reloadData()})})["catch"](function(t){c.pop("Error","Error inesperado",t)})["finally"](function(){})};var g={};g.operation="document",g.customer_evaluation_minimum_standard_item_id=i.id,n.dtInstanceQuestionComment={},n.dtOptionsQuestionComment=p.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:g,url:"api/customer/evaluation-minimum-standard-item-comment",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,e,a){f(angular.element(t).contents())(n)}),n.dtColumnsQuestionComment=[m.newColumn("comment").withTitle("Comentario"),m.newColumn("user.name").withTitle("Usuario").withOption("width",200).withOption("defaultContent",200),m.newColumn("createdAt").withTitle("Fecha").withOption("width",200).withOption("defaultContent",200)],n.dtInstanceQuestionCommentCallback=function(t){n.dtInstanceQuestionComment=t},n.reloadData=function(){n.dtInstanceQuestionComment.reloadData()}}]),app.controller("ModalInstanceSideCustomerEvaluationMinimumStandardItemDetailCtrl",["$rootScope","$stateParams","$scope","$uibModalInstance","item","$log","$timeout","SweetAlert","$http","toaster","$filter","$aside","$document","DTColumnBuilder","DTOptionsBuilder","$compile",function(t,e,n,a,i,o,r,l,s,c,d,u,m,p,f,v){var h=o;n.isView=!0,n.entity=null,n.config={customerId:e.customerId,customerEvaluationMinimumStandardItemId:i.id,customerEvaluationMinimumStandardId:i.customerEvaluationMinimumStandardId,comment:"",rate:null,realRate:null,verificationList:[]},n.maxDate=new Date,n.datePickerConfig={culture:"es-CO",format:"dd/MM/yyyy HH:mm"},n.loading=!0,n.onCloseModal=function(){a.close(1)},n.onCancel=function(){a.dismiss("cancel")};var g=function(){n.standard={id:i.minimumStandardItemId,minimumStandard:null,minimumStandardParent:null,numeral:"",description:"",value:0,criterion:"",isActive:!0,legalFrameworkList:[],verificationModeList:[]}};g();var w=function(){var t={};return s({method:"POST",url:"api/minimum-standard/list-data",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){r(function(){n.parentList=t.data.data.parent,n.standardListAll=t.data.data.standard})})["catch"](function(t){l.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};w();var y=function(){angular.forEach(n.config.verificationList,function(t,e){t.isActive=1==t.isActive})},b=function(){var t={customer_id:e.customerId,customer_evaluation_minimum_standard_item_id:i.id};return s({method:"POST",url:"api/customer/evaluation-minimum-standard-item-detail/list-data",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){r(function(){n.config.verificationList=t.data.data.verificationList,n.config.questionList=t.data.data.questionList,y(),n.onLoadConfigRecord()})})["catch"](function(t){l.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};b(),n.onLoadRecord=function(){if(n.standard.id){var t={id:n.standard.id};s({method:"GET",url:"api/minimum-standard-item",params:t})["catch"](function(t,e){if(403==e){var n=null!==t.message&&void 0!==t.message?t.message:"app.clientes.list";l.swal("No Autorizado","No estas autorizado para ver esta información.","error"),r(function(){$state.go(n)},3e3)}else 404==e?(l.swal("Información no disponible","Anexo no encontrado","error"),r(function(){$state.go("app.clientes.list")})):l.swal("Error","Se ha presentado un error al intentar acceder a la información del anexo","error")}).then(function(t){r(function(){n.standard=t.data.result})})["finally"](function(){r(function(){n.loading=!1},400)})}},n.onLoadConfigRecord=function(){if(n.config.customerEvaluationMinimumStandardItemId){var t={id:n.config.customerEvaluationMinimumStandardItemId};s({method:"GET",url:"api/customer/evaluation-minimum-standard-item",params:t})["catch"](function(t,e){if(403==e){var n=null!==t.message&&void 0!==t.message?t.message:"app.clientes.list";l.swal("No Autorizado","No estas autorizado para ver esta información.","error"),r(function(){$state.go(n)},3e3)}else 404==e&&(l.swal("Información no disponible","Anexo no encontrado","error"),r(function(){$state.go("app.clientes.list")}))}).then(function(t){r(function(){n.entity=t.data.result,void 0!==n.entity.realRate&&null!=n.entity.realRate?(n.config.realRate=n.entity.realRate,"cp"==n.entity.realRate.code&&angular.forEach(n.config.verificationList,function(t,e){t.isActive=!0})):void 0!==n.entity.rate&&null!=n.entity.rate?n.config.rate=n.entity.rate:n.onVerificationChange()})})["finally"](function(){r(function(){n.loading=!1},400)})}},n.$watch("standard.minimumStandardParent",function(t,e,a){n.standardList=[],null==e||angular.equals(t,e)||(n.standard.minimumStandard=null),null!=n.standard.minimumStandardParent&&(n.standardList=d("filter")(n.standardListAll,{parentId:n.standard.minimumStandardParent.id}))}),n.onVerificationChange=function(){o.info("Verification mode's item has change"),n.config.comment="",angular.forEach(n.config.verificationList,function(t,e){t.isActive||(n.config.comment+=t.description+"\n")}),C()},n.clearRate=function(){n.config.rate=null,C()};var C=function(){var t=d("filter")(n.entity.verificationModeList,{isActive:!1});null==n.entity.rate?0==t.length?n.entity.realRate=n.rateRealList[0]:t.length<=n.entity.verificationModeList.length&&(n.entity.realRate=n.rateRealList[1]):n.entity.realRate=null};n.changeRate=function(t,e,a){r(function(){n.config.realRate=null})},n.onLoadRecord(),n.$watch("standard.cycle",function(t,e,a){n.parentList=[],null==e||angular.equals(t,e)||(n.standard.parent=null),
null!=n.standard.cycle&&(n.parentList=d("filter")(n.parentListAll,{cycleId:n.standard.cycle.id}))}),n.master=n.config,n.form={submit:function(t){var e=null;if(t.$invalid){var a=null,e=null;for(a in t)"$"!=a[0]&&(null!==e||t[a].$valid||(e=t[a].$name),t[a].$pristine&&(t[a].$dirty=!0));return h.info(n.standard),angular.element(".ng-invalid[name="+e+"]").focus(),void l.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}l.swal("Validación exitosa","Guardando información...","success"),S()},reset:function(t){n.clear()}};var S=function(){var t={},e=JSON.stringify(n.config);return t.data=Base64.encode(e),s({method:"POST",url:"api/customer/evaluation-minimum-standard-item-detail/insert",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){r(function(){n.onCloseModal()})})["catch"](function(t){o.error(t),l.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})}}]);
"use strict";app.controller("customerConfigurationMinimumStandardItemListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$aside",function(t,n,i,a,e,r,o,d,l,u,s,c,m,f){var p=i,w={};p.info("loading..configurationMinimumStandardItemItemListCtrl "),t.isNewMinimumStandardItem=!0,w.operation="diagnostic",t.dtInstanceCustomerConfigMinimumStandardItem={},t.dtOptionsCustomerConfigMinimumStandardItem=a.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:w,url:"api/minimum-standard-item",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){h()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(n,i,a){o(angular.element(n).contents())(t)}),t.dtColumnsCustomerConfigMinimumStandardItem=[e.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,n,i,a){var e="",r="",o='<a class="btn btn-danger btn-xs editRow lnk" href="#" uib-tooltip="Configurar"  data-id="'+t.id+'"'+r+' >   <i class="fa fa-cog"></i></a> ';'<a class="btn btn-danger btn-xs delRow lnk" href="#"  uib-tooltip="Eliminar" data-id="'+t.id+'"'+r+' >   <i class="fa fa-trash-o"></i></a> ';return u.can("diagnostico_continue"),e+=o,u.can("clientes_delete"),e}),e.newColumn("minimumStandard.cycle.name").withTitle("Ciclo").withOption("width",200).withOption("defaultContent",""),e.newColumn("minimumStandard.parent.numeral").withTitle("Numeral (Padre)").withOption("width",200).withOption("defaultContent",""),e.newColumn("minimumStandard.parent.description").withTitle("Estándar (Padre)").withOption("width",200).withOption("defaultContent",""),e.newColumn("minimumStandard.numeral").withTitle("Numeral (Hijo)").withOption("width",200).withOption("defaultContent",""),e.newColumn("minimumStandard.description").withTitle("Estandar (Hijo)").withOption("width",200).withOption("defaultContent",""),e.newColumn("numeral").withTitle("Numeral").withOption("width",200).withOption("defaultContent",""),e.newColumn("description").withTitle("Item").withOption("width",200).withOption("defaultContent",""),e.newColumn("value").withTitle("Valor").withOption("width",200).withOption("defaultContent",""),e.newColumn("isActive").withTitle("Estado").withOption("width",200).renderWith(function(t,n,i,a){var e="",r="";t||1==t?(e="label label-success",r="Activo"):(e="label label-danger",r="Inactivo");var o='<span class="'+e+'">'+r+"</span>";return o})];var h=function(){$("#dtCustomerConfigMinimumStandardItem a.editRow").on("click",function(){var n=$(this).data("id");t.editMinimumStandardItem(n)}),$("#dtCustomerConfigMinimumStandardItem a.delRow").on("click",function(){var n=$(this).data("id");m.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(a){if(a){var e={};e.id=n,c({method:"POST",url:"api/minimum-standard-item/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){i.error(t),m.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){t.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};t.reloadData=function(){t.dtInstanceCustomerConfigMinimumStandardItem.reloadData()},t.editMinimumStandardItem=function(t){g(t)};var g=function(n){var i={id:n?n:0},a=f.open({templateUrl:u.app.views.urlRoot+"modules/customer/diagnostic/tab-minimum-standard/customer_configuration_minimum_standard_item_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideCustomerConfigurationMinimumStandardItemEditCtrl",scope:t,resolve:{standard:function(){return i}}});a.result.then(function(){t.reloadData()})};t.onReturn=function(){null!=t.$parent&&t.$parent.navToSection("summary","summary",t.$parent.currentId)}}]),app.controller("ModalInstanceSideCustomerConfigurationMinimumStandardItemEditCtrl",["$rootScope","$stateParams","$scope","$uibModalInstance","standard","$log","$timeout","SweetAlert","$http","toaster","$filter","$aside","$document","DTColumnBuilder","DTOptionsBuilder","$compile",function(t,n,i,a,e,r,o,d,l,u,s,c,m,f,p,w){var h=r;i.isView=!0,i.config={customerId:n.customerId,minimumStandardItemId:e.id,verificationList:[]},i.maxDate=new Date,i.datePickerConfig={culture:"es-CO",format:"dd/MM/yyyy HH:mm"},i.loading=!0,i.onCloseModal=function(){a.close(1)},i.onCancel=function(){a.dismiss("cancel")};var g=function(){i.standard={id:e.id,minimumStandard:null,minimumStandardParent:null,numeral:"",description:"",value:0,criterion:"",isActive:!0,legalFrameworkList:[],verificationModeList:[]}};g();var C=function(){var t={};return l({method:"POST",url:"api/minimum-standard/list-data",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){o(function(){i.parentList=t.data.data.parent,i.standardListAll=t.data.data.standard})})["catch"](function(t){d.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};C();var v=function(){angular.forEach(i.config.verificationList,function(t,n){t.isActive=1==t.isActive})},S=function(){var t={minimum_standard_item_id:e.id,customer_id:n.customerId};return l({method:"POST",url:"api/customer/configuration-minimum-standard-item-detail/list-data",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){o(function(){i.config.verificationList=t.data.data.verificationList,v()})})["catch"](function(t){d.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};S(),i.onLoadRecord=function(){if(i.standard.id){var t={id:i.standard.id};l({method:"GET",url:"api/minimum-standard-item",params:t})["catch"](function(t,n){if(403==n){var i=null!==t.message&&void 0!==t.message?t.message:"app.clientes.list";d.swal("No Autorizado","No estas autorizado para ver esta información.","error"),o(function(){$state.go(i)},3e3)}else 404==n?(d.swal("Información no disponible","Anexo no encontrado","error"),o(function(){$state.go("app.clientes.list")})):d.swal("Error","Se ha presentado un error al intentar acceder a la información del anexo","error")}).then(function(t){o(function(){i.standard=t.data.result})})["finally"](function(){o(function(){i.loading=!1},400)})}},i.$watch("standard.minimumStandardParent",function(t,n,a){i.standardList=[],null==n||angular.equals(t,n)||(i.standard.minimumStandard=null),null!=i.standard.minimumStandardParent&&(i.standardList=s("filter")(i.standardListAll,{parentId:i.standard.minimumStandardParent.id}))}),i.onLoadRecord(),i.$watch("standard.cycle",function(t,n,a){i.parentList=[],null==n||angular.equals(t,n)||(i.standard.parent=null),null!=i.standard.cycle&&(i.parentList=s("filter")(i.parentListAll,{cycleId:i.standard.cycle.id}))}),i.master=i.config,i.form={submit:function(t){var n=null;if(t.$invalid){var a=null,n=null;for(a in t)"$"!=a[0]&&(null!==n||t[a].$valid||(n=t[a].$name),t[a].$pristine&&(t[a].$dirty=!0));return h.info(i.standard),angular.element(".ng-invalid[name="+n+"]").focus(),void d.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}d.swal("Validación exitosa","Guardando información del centro de trabajo...","success"),O()},reset:function(t){i.clear()}};var O=function(){var t={},n=JSON.stringify(i.config);return t.data=Base64.encode(n),l({method:"POST",url:"api/customer/configuration-minimum-standard-item-detail/insert",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){o(function(){i.standard=t.data.result})})["catch"](function(t){r.error(t),d.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){i.reloadData()})};i.onSelectAll=function(){angular.forEach(i.config.verificationList,function(t,n){t.isActive=!0})},i.onClearAll=function(){angular.forEach(i.config.verificationList,function(t,n){t.isActive=!1})}}]);
"use strict";app.controller("customerEvaluationMinimumStandardReportCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert",function(t,e,r,a,n,o,i,d,u,c,l,s,m){var p=r,f={};t.question={rate:null},t.currentId=t.$parent.currentId,f.operation="diagnostic",f.customer_id=e.customerId,f.standard_id=t.$parent.currentId,t.rate_id=0,t.categories=[],t.rates=[],t.totalAvg=0;var v=function(){var r={};r.customer_id=e.customerId,r.standard_id=t.$parent.currentId,s({method:"POST",url:"api/customer/evaluation-minimum-standard/list-data",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(r)}).then(function(e){l(function(){t.cycles=e.data.data.cycle,t.rates=e.data.data.rateReal})})["catch"](function(t){m.swal("Error Cargando Reportes","Se ha presentado un error durante la consulta de los reportes para el diagnóstico por favor intentelo de nuevo","error")})["finally"](function(){})};v(),t.changeRate=function(e,r,a){p.info(e),p.info(r),l(function(){t.rate_id=e.id,h()})};var h=function(){var r={};r.customer_id=e.customerId,r.standard_id=t.currentId,r.rate_id=t.rate_id,s({method:"POST",url:"api/customer/evaluation-minimum-standard-item-report",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(r)}).then(function(e){t.cycles=e.data.data.standards,t.loaded=!0})["catch"](function(t){m.swal("Error Consultando Preguntas","Se ha presentado un error durante la consulta del cuestionario, por favor intentelo de nuevo.","error")})["finally"](function(){})};h(),t.onContinue=function(e){null!=t.$parent&&t.$parent.navToSection("edit","edit",t.currentId)},t.cancelEdition=function(e){null!=t.$parent&&t.$parent.navToSection("summary","summary",t.currentId)},t.clearFilter=function(){t.question={rate:null},t.rate_id=0,h()},t.onSummaryExportPdf=function(){kendo.drawing.drawDOM($(".export-pdf")).then(function(t){return kendo.drawing.exportPDF(t,{paperSize:"auto",margin:{left:"1cm",top:"1cm",right:"1cm",bottom:"1cm"}})}).done(function(t){kendo.saveAs({dataURI:t,fileName:"Auto-Evaluacion-Estandares-Minimos-Reporte.pdf",proxyURL:"//demos.telerik.com/kendo-ui/service/export"})})},t.onSummaryExportExcel=function(){jQuery("#downloadDocument")[0].src="api/customer/evaluation-minimum-standard-item/export-excel?id="+t.currentId+"&rate="+t.rate_id}}]);
"use strict";app.controller("customerEvaluationMinimumStandardMonthlyReportCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","ChartService",function(t,n,i,a,e,o,r,d,u,l,m,c,w,h){function s(){var i={customerId:n.customerId,evaluationMinimumStandardId:t.currentId,year:t.filter.selectedYear?t.filter.selectedYear.value:0},a=[{name:"chart_bar_options",criteria:null},{name:"chart_line_options",criteria:null},{name:"customer_evaluation_minimum_standard_monthly",criteria:i}];h.getDataChart(a).then(function(n){t.chart.bar.options=n.data.data.chartBarOptions,t.chart.line.options=n.data.data.chartLineOptions,t.chart.bar.options.legend.position="bottom",t.chart.line.options.legend.position="bottom",t.chart.status.data=n.data.data.customerEvaluationMinimumStandardMonthlyStatus,t.chart.average.data=n.data.data.customerEvaluationMinimumStandardMonthlyAverage,t.chart.total.data=n.data.data.customerEvaluationMinimumStandardMonthlyTotal,t.chart.advance.data=n.data.data.customerEvaluationMinimumStandardMonthlyAdvance,p=n.data.data.customerEvaluationMinimumStandardId},function(n){t.status="Unable to load customer data: "+n.message})}var p=0;t.chart={bar:{options:null},line:{options:null},status:{data:null},average:{data:null},total:{data:null},advance:{data:null}},t.audit={},t.audit.operation="info",t.audit.year=0,t.audit.standardId=t.currentId,t.filter={selectedYear:null},t.years=[];var f=function(){var i={};i.customer_id=n.customerId,i.standard_id=p,c({method:"POST",url:"api/customer/evaluation-minimum-standard/list-data",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(n){m(function(){t.cycles=n.data.data.cycle,t.rates=n.data.data.rateReal,t.years=n.data.data.years,t.years.length>0&&(t.filter.selectedYear=t.years[0],t.audit.year=t.filter.selectedYear.value,t.audit.standardId=t.currentId,t.reloadData(),t.reloadIndicatorData(),s())})})["catch"](function(t){w.swal("Error Cargando Reportes","Se ha presentado un error durante la consulta de los reportes para el diagnóstico por favor intentelo de nuevo","error")})["finally"](function(){})};f(),t.dtInstanceMinimumStandardSummaryProgram={},t.dtOptionsMinimumStandardSummaryProgram=a.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(n){return n.data=Base64.encode(JSON.stringify(t.audit)),n},url:"api/customer/evaluation-minimum-standard/summary-program",type:"POST",beforeSend:function(){},complete:function(t){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withDOM("tr").withOption("language",{}).withOption("createdRow",function(n,i,a){r(angular.element(n).contents())(t)}),t.dtColumnsMinimumStandardSummaryProgram=[e.newColumn("abbreviation").withTitle("Código").withOption("width",100),e.newColumn("name").withTitle("Ciclo").withOption("width",400),e.newColumn("ENE").withTitle("ENE").withOption("width",200),e.newColumn("FEB").withTitle("FEB").withOption("width",200),e.newColumn("MAR").withTitle("MAR").withOption("width",200),e.newColumn("ABR").withTitle("ABR").withOption("width",200),e.newColumn("MAY").withTitle("MAY").withOption("width",200),e.newColumn("JUN").withTitle("JUN").withOption("width",200),e.newColumn("JUL").withTitle("JUL").withOption("width",200),e.newColumn("AGO").withTitle("AGO").withOption("width",200),e.newColumn("SEP").withTitle("SEP").withOption("width",200),e.newColumn("OCT").withTitle("OCT").withOption("width",200),e.newColumn("NOV").withTitle("NOV").withOption("width",200),e.newColumn("DIC").withTitle("DIC").withOption("width",200)],t.dtInstanceMinimumStandardSummaryIndicator={},t.dtOptionsMinimumStandardSummaryIndicator=a.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(n){return n.data=Base64.encode(JSON.stringify(t.audit)),n},url:"api/customer/evaluation-minimum-standard/summary-indicator",type:"POST",beforeSend:function(){},complete:function(t){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withDOM("tr").withOption("language",{}).withOption("createdRow",function(n,i,a){r(angular.element(n).contents())(t)}),t.dtColumnsMinimumStandardSummaryIndicator=[e.newColumn("indicator").withTitle("Indicador").withOption("width",400),e.newColumn(null).withTitle("ENE").withOption("width",200).renderWith(function(t,n,i,a){return"Promedio Total %"!=t.indicator?O(t.ENE):t.ENE}),e.newColumn(null).withTitle("FEB").withOption("width",200).renderWith(function(t,n,i,a){return"Promedio Total %"!=t.indicator?O(t.FEB):t.FEB}),e.newColumn(null).withTitle("MAR").withOption("width",200).renderWith(function(t,n,i,a){return"Promedio Total %"!=t.indicator?O(t.MAR):t.MAR}),e.newColumn(null).withTitle("ABR").withOption("width",200).renderWith(function(t,n,i,a){return"Promedio Total %"!=t.indicator?O(t.ABR):t.ABR}),e.newColumn(null).withTitle("MAY").withOption("width",200).renderWith(function(t,n,i,a){return"Promedio Total %"!=t.indicator?O(t.MAY):t.MAY}),e.newColumn(null).withTitle("JUN").withOption("width",200).renderWith(function(t,n,i,a){return"Promedio Total %"!=t.indicator?O(t.JUN):t.JUN}),e.newColumn(null).withTitle("JUL").withOption("width",200).renderWith(function(t,n,i,a){return"Promedio Total %"!=t.indicator?O(t.JUL):t.JUL}),e.newColumn(null).withTitle("AGO").withOption("width",200).renderWith(function(t,n,i,a){return"Promedio Total %"!=t.indicator?O(t.AGO):t.AGO}),e.newColumn(null).withTitle("SEP").withOption("width",200).renderWith(function(t,n,i,a){return"Promedio Total %"!=t.indicator?O(t.SEP):t.SEP}),e.newColumn(null).withTitle("OCT").withOption("width",200).renderWith(function(t,n,i,a){return"Promedio Total %"!=t.indicator?O(t.OCT):t.OCT}),e.newColumn(null).withTitle("NOV").withOption("width",200).renderWith(function(t,n,i,a){return"Promedio Total %"!=t.indicator?O(t.NOV):t.NOV}),e.newColumn(null).withTitle("DIC").withOption("width",200).renderWith(function(t,n,i,a){return"Promedio Total %"!=t.indicator?O(t.DIC):t.DIC})];var O=function(t){return null!=t?parseInt(t):""};t.dtInstanceMinimumStandardSummaryProgramCallback=function(n){t.dtInstanceMinimumStandardSummaryProgram=n},t.reloadData=function(){t.dtInstanceMinimumStandardSummaryProgram.reloadData()},t.dtInstanceMinimumStandardSummaryIndicatorCallback=function(n){t.dtInstanceMinimumStandardSummaryIndicator=n},t.reloadIndicatorData=function(){t.dtInstanceMinimumStandardSummaryIndicator.reloadData()},t.onContinue=function(){null!=t.$parent&&t.$parent.navToSection("edit","edit",t.currentId)},t.cancelEdition=function(n){null!=t.$parent&&t.$parent.navToSection("summary","summary",t.currentId)},t.changeYear=function(n,i){m(function(){t.audit.operation="info",t.audit.standardId=t.currentId,t.audit.year=n.value,t.reloadData(),t.reloadIndicatorData(),s()})},t.clearYear=function(){m(function(){t.audit.operation="info",t.audit.standardId=t.currentId,t.audit.year=0,t.filter.selectedYear=null,t.reloadData(),t.reloadIndicatorData(),s()})},t.onSummaryByProgramExportExcel=function(){jQuery("#downloadDocument")[0].src="api/customer/evaluation-minimum-standard/summary-program-export?data="+Base64.encode(JSON.stringify(t.audit))},t.onSummaryByProgramExportPdf=function(){kendo.drawing.drawDOM($(".export-pdf-program")).then(function(t){return kendo.drawing.exportPDF(t,{paperSize:"auto",margin:{left:"1cm",top:"1cm",right:"1cm",bottom:"1cm"}})}).done(function(t){kendo.saveAs({dataURI:t,fileName:"Diagnóstico Reporte Mensual Program.pdf",proxyURL:"//demos.telerik.com/kendo-ui/service/export"})})},t.onSummaryByIndicatorExportExcel=function(){jQuery("#downloadDocument")[0].src="api/customer/evaluation-minimum-standard/summary-indicator-export?data="+Base64.encode(JSON.stringify(t.audit))},t.onSummaryByIndicatorExportPdf=function(){kendo.drawing.drawDOM($(".export-pdf-indicator")).then(function(t){return kendo.drawing.exportPDF(t,{paperSize:"auto",margin:{left:"1cm",top:"1cm",right:"1cm",bottom:"1cm"}})}).done(function(t){kendo.saveAs({dataURI:t,fileName:"Diagnóstico Reporte Mensual Indicadores.pdf",proxyURL:"//demos.telerik.com/kendo-ui/service/export"})})}}]);
"use strict";app.controller("customerEvaluationMinimumStandard0312Ctrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout",function(t,n,o,e,i,c){t.standard_section="list",t.currentId=0,t.editMode="continue",t.navToSection=function(n,o,e){c(function(){t.standard_section=n,t.$parent.switchSubTab(o),t.currentId=e})},t.setEditMode=function(n){t.editMode=n}}]);
"use strict";app.controller("customerEvaluationMinimumStandardList0312Ctrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","ChartService",function(t,a,n,i,e,o,r,s,u,d,l,c,m,p){t.canCreate=!1,t.dtOptionsEvaluationMinimumStandardList0312=i.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.operation="standard",t.customerId=a.customerId,JSON.stringify(t)},dataSrc:function(a){return t.canCreate=a.extra,a.data},url:"api/customer-evaluation-minimum-standard-0312",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(t){}}).withDataProp("data").withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){f()}).withPaginationType("full_numbers").withOption("createdRow",function(a,n,i){r(angular.element(a).contents())(t)}),t.dtColumnsEvaluationMinimumStandardList0312=[e.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,a,n,i){var e="",o='<a class="btn btn-success btn-xs continueRow lnk" href="#" uib-tooltip="Continuar"  data-id="'+t.id+'" >   <i class="fa fa-play"></i></a> ',r='<a class="btn btn-info btn-xs viewRow lnk" href="#" uib-tooltip="Ver"  data-id="'+t.id+'" >   <i class="fa fa-eye"></i></a> ',s=' | <a class="btn btn-dark-azure btn-xs migrateRow lnk" href="#" uib-tooltip="Migrar Calificaciones Periodo Anterior"  data-id="'+t.id+'" data-from-id="'+t.migrateFromId+'" >   <i class="fa fa-share-square-o"></i></a> ';return d.can("em_0312_historico_view")&&(e+=r),d.can("em_0312_historico_continue")&&"A"==t.statusCode&&(e+=o),1==t.canMigrate&&(e+=s),e}),e.newColumn("unique").withTitle("ID").withOption("width",100),e.newColumn("period").withTitle("Periodo").withOption("width",100),e.newColumn("createdAt").withTitle("Fecha Creación").withOption("width",150),e.newColumn(null).withTitle("Estado").withOption("width",200).renderWith(function(t,a,n,i){var e="label label-warning";return"A"==t.statusCode?e="label label-success":"C"==t.statusCode&&(e="label label-danger"),'<span class="'+e+'">'+t.status+"</span>"}).notSortable()];var f=function(){angular.element("#dtEvaluationMinimumStandardList0312 a.continueRow").on("click",function(){var a=angular.element(this).data("id");t.onContinue(a)}),angular.element("#dtEvaluationMinimumStandardList0312 a.viewRow").on("click",function(){var a=angular.element(this).data("id");t.onView(a)}),angular.element("#dtEvaluationMinimumStandardList0312 a.migrateRow").on("click",function(){var n=angular.element(this).data("id"),i=angular.element(this).data("from-id");t.onMigrate({id:n,fromId:i,customerId:a.customerId})})};t.dtInstanceEvaluationMinimumStandardList0312Callback=function(a){t.dtInstanceEvaluationMinimumStandardList0312=a},t.reloadData=function(){t.dtInstanceEvaluationMinimumStandardList0312.reloadData()},t.onContinue=function(a){null!=t.$parent&&(t.setEditMode("continue"),t.$parent.navToSection("summary","summary",a))},t.onView=function(a){null!=t.$parent&&(t.setEditMode("view"),t.$parent.navToSection("summary","summary",a))},t.onCreate=function(){var i=JSON.stringify({customerId:a.customerId}),e={data:Base64.encode(i)};return c({method:"POST",url:"api/customer-evaluation-minimum-standard-0312/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(a){m.swal("Registro","La información ha sido guardada satisfactoriamente","success"),d.app.supportHelp&&(d.app.supportHelp.hasMinimumStandard0312=!0),t.reloadData()})["catch"](function(t){n.error(t),m.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})},t.onMigrate=function(a){var i=JSON.stringify(a),e={data:Base64.encode(i)};return c({method:"POST",url:"api/customer-evaluation-minimum-standard-0312/migrate",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(a){m.swal("Registro","La información ha sido migrada satisfactoriamente","success"),t.reloadData()})["catch"](function(t){n.error(t),m.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})}}]);
"use strict";app.controller("customerEvaluationMinimumStandardSummary0312Ctrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","ChartService",function(t,n,a,o,e,i,r,u,d,c,l,m,s,p){function h(){var a={customerId:n.customerId,customerEvaluationMinimumStandardId:t.currentId},o=[{name:"chart_bar_options",criteria:null},{name:"chart_doughnut_options",criteria:null},{name:"customer_evaluation_minimum_standard_0312",criteria:a}];p.getDataChart(o).then(function(n){t.chart.bar.options=n.data.data.chartBarOptions,t.chart.doughnut.options=n.data.data.chartDoughnutOptions,t.chart.programs.data=n.data.data.customerEvaluationMinimumStandardCycle,t.chart.progress.data=n.data.data.customerEvaluationMinimumStandardProgress,t.chart.progress.total=n.data.data.customerEvaluationMinimumStandardAverage},function(n){t.status="Unable to load customer data: "+n.message})}t.currentId=t.$parent.currentId,t.isView="view"==t.$parent.editMode,t.chart={bar:{options:null},doughnut:{options:null},programs:{data:null},progress:{data:null,total:0}},t.dtOptionsEvaluationMinimumStandardSummary0312=o.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(a){return a.operation="standard",a.customerId=n.customerId,a.customerEvaluationMinimumStandardId=t.currentId,JSON.stringify(a)},url:"api/customer-evaluation-minimum-standard-0312-summary",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(t){h()}}).withDataProp("data").withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withOption("bFilter",!1).withOption("paging",!1).withOption("createdRow",function(n,a,o){r(angular.element(n).contents())(t)}),t.dtColumnsEvaluationMinimumStandardSummary0312=[e.newColumn("name").withTitle("Ciclo").withOption("width",200),e.newColumn("description").withTitle("Estándar").withOption("width",400),e.newColumn("items").withTitle("Items").withOption("width",200),e.newColumn("checked").withTitle("Evaluados").withOption("width",200),e.newColumn("advance").withTitle("Valor Estándar (%)").withOption("width",200),e.newColumn("total").withTitle("Valoración Items (%)").withOption("width",200),e.newColumn(null).withTitle("Estado").withOption("width",200).renderWith(function(t,n,a,o){var e="label label-danger",i="Sin Iniciar";parseInt(t.checked)==parseInt(t.items)?(i="Completado",e="label label-info"):parseInt(t.checked)>0&&(i="Iniciado",e="label label-success");var r='<span class="'+e+'">'+i+"</span>";return r}).notSortable()],t.dtInstanceEvaluationMinimumStandardSummary0312Callback=function(n){t.dtInstanceEvaluationMinimumStandardSummary0312=n},t.reloadData=function(){t.dtInstanceEvaluationMinimumStandardSummary0312.reloadData()},t.onContinue=function(){null!=t.$parent&&t.$parent.navToSection("edit","edit",t.currentId)},t.onConfig=function(){null!=t.$parent&&t.$parent.navToSection("config","config",t.currentId)},t.onImport=function(){null!=t.$parent&&t.$parent.navToSection("import","import",t.currentId)},t.onAttachment=function(){null!=t.$parent&&t.$parent.navToSection("attachment","attachment",t.currentId)},t.onViewReport=function(){null!=t.$parent&&t.$parent.navToSection("report","report",t.currentId)},t.onViewMonthlyReport=function(){null!=t.$parent&&t.$parent.navToSection("monthlyReport","monthlyReport",t.currentId)},t.onExportPdf=function(){l(function(){kendo.drawing.drawDOM($(".minimun-standard-0312-export-pdf")).then(function(t){return kendo.drawing.exportPDF(t,{paperSize:"auto",margin:{left:"1cm",top:"1cm",right:"1cm",bottom:"1cm"}})}).done(function(t){kendo.saveAs({dataURI:t,fileName:"Estandares-Minimos-Auto-Evaluacion.pdf",proxyURL:"//demos.telerik.com/kendo-ui/service/export"})})},200)},t.onExportExcel=function(){var a=JSON.stringify({customerId:n.customerId,customerEvaluationMinimumStandardId:t.currentId});angular.element("#download")[0].src="api/customer-evaluation-minimum-standard-0312-summary/export-excel?data="+Base64.encode(a)},t.onReportExportPdf=function(){var a=JSON.stringify({customerId:n.customerId,customerEvaluationMinimumStandardId:t.currentId});angular.element("#download")[0].src="api/customer-evaluation-minimum-standard-0312/export-pdf?data="+Base64.encode(a)},t.onCancel=function(){null!=t.$parent&&t.$parent.navToSection("list","list",0)}}]);
"use strict";app.controller("customerEvaluationMinimumStandard0312EditCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","SweetAlert","$rootScope","$http","$timeout","$uibModal","flowFactory","cfpLoadingBar","$document","$filter","$aside","FileUploader","ChartService","ListService",function(t,e,n,a,i,o,r,l,s,c,d,u,m,p,f,h,w,v,g,b,C,y){function S(){var n={customerId:e.customerId,customerEvaluationMinimumStandardId:$},a=[{name:"chart_bar_options",criteria:null},{name:"chart_doughnut_options",criteria:null},{name:"customer_evaluation_minimum_standard_0312",criteria:n}];C.getDataChart(a).then(function(e){t.chart.bar.options=e.data.data.chartBarOptions,t.chart.doughnut.options=e.data.data.chartLineOptions,t.chart.programs.data=e.data.data.customerEvaluationMinimumStandardCycle,t.chart.progress.data=e.data.data.customerEvaluationMinimumStandardProgress,t.chart.progress.total=e.data.data.customerEvaluationMinimumStandardAverage},function(e){t.status="Unable to load customer data: "+e.message})}function O(){var n={customerId:e.customerId,customerEvaluationMinimumStandardId:$},a=[{name:"customer_evaluation_minimum_stardard_cycle_0312",value:null,criteria:n},{name:"minimum_stardard_rate_0312",value:e.customerId}];y.getDataList(a).then(function(e){t.cycles=e.data.data.customerEvaluationMinimumStandardCycle,t.rateList=e.data.data.rate,t.rateRealList=e.data.data.rateReal,M()},function(e){t.status="Unable to load customer data: "+e.message})}console.log("editMode",t.$parent.editMode),t.currentStep=-1;var I=n,$=t.$parent.currentId,T={refresh:!0,index:0},D={id:0,code:null},x={model:null};t.chart={bar:{options:null},doughnut:{options:null},programs:{data:null},progress:{data:null,total:0}},S(),O();var M=function(){if(0==D.id){var e=v("filter")(t.cycles,function(t){return parseFloat(t.advance)<100});t.currentStep=e.length>0?t.cycles.indexOf(e[0]):t.cycles.length-1,D.id=t.cycles[t.currentStep].id,D.code=t.cycles[t.currentStep].abbreviation,t.grid.dataSource.read()}},P=function(){O(),S(),t.grid.dataSource.read()};m(function(){t.mainGridOptions={dataSource:{type:"odata",transport:{read:{url:"api/customer-evaluation-minimum-standard-item-0312",dataType:"json",type:"POST",data:function(){var t={customerEvaluationMinimumStandardId:$,customerId:e.customerId,cycleId:D.id};return t}},parameterMap:function(t,e){return JSON.stringify(t)}},schema:{model:{id:"id",fields:{description:{editable:!1,nullable:!0}}},data:function(t){return t.data||t},total:function(t){return t.recordsTotal||t.data.length||0}},pageSize:10,serverPaging:!0,serverFiltering:!0,serverSorting:!0},sortable:{mode:"multiple"},pageable:{change:function(t){T.index=t.index,I.info("page.index",T.index)}},filterable:{mode:"row"},dataBound:function(t){this.expandRow(this.tbody.find("tr.k-master-row"))},columns:[{field:"description",title:"Estandar Hijo",attributes:{"class":"text-orange text-large"},filterable:{cell:{operator:"contains",suggestionOperator:"contains"}}},{field:null,title:"Avance",width:"150px",attributes:{style:"text-align: center"},filterable:!1,template:function(t){var e='<h4 class="no-margin">'+t.advance+"%</h4>";return e+='<uib-progressbar value="'+t.advance+'" class="progress-xs no-radius no-margin" type="success"></uib-progressbar>',e+=t.checked+" de "+t.items}},{field:null,title:"Promedio",width:"150px",attributes:{style:"text-align: center"},filterable:!1,template:function(t){var e='<h4 class="no-margin">'+t.average+"%</h4>";return e+='<uib-progressbar value="'+t.total+'" class="progress-xs no-radius no-margin" type="success"></uib-progressbar>',e+="Promedio Total"}}]},t.detailGridOptions=function(t){return{dataSource:{type:"odata",transport:{read:{url:"api/customer-evaluation-minimum-standard-item-0312-question",dataType:"json",type:"POST",data:function(){var n={minimumStandardId:t.id,customerEvaluationMinimumStandardId:$,customerId:e.customerId,cycleId:D.id};return n}},parameterMap:function(t,e){return JSON.stringify(t)}},requestEnd:function(t){},schema:{model:{id:"id",fields:{description:{editable:!1,nullable:!0},article:{editable:!1,nullable:!0},rate:{editable:!1,defaultValue:{id:0,text:null,code:null}}}},data:function(t){return t.data||t},total:function(t){return t.recordsTotal||t.data.length||0}},serverPaging:!1,serverSorting:!1,serverFiltering:!1,filter:{field:"minimumStandardId",operator:"eq",value:t.id}},editable:"incell",edit:function(t){x.model=t.model},scrollable:!1,sortable:!1,pageable:!1,columns:[{command:[{text:" ",template:"<a class='btn btn-dark-azure btn btn-sm' ng-click='onAddVerificationList(dataItem)' uib-tooltip='Lista de verificación' tooltip-placement='right'><i class='fa fa-list'></i></a> "},{text:" ",template:"<a class='btn btn-light-red btn btn-sm' ng-click='onAddComment(dataItem)' uib-tooltip='Comentarios' tooltip-placement='right'><i class='fa fa-comments'></i></a> "},{text:" ",template:"<a class='btn btn-warning btn btn-sm' ng-click='onAddImprovementPlan(dataItem)' uib-tooltip='Plan Mejoramiento' tooltip-placement='right'><i class='fa fa-plus-square'></i></a> "},{text:" ",template:"<a class='btn btn-info btn btn-sm' ng-click='onAddAttachment(dataItem)' uib-tooltip='Anexos' tooltip-placement='right'><i class='fa fa-paperclip'></i></a> "}],width:"160px",headerAttributes:{style:"display: none"}},{field:"description",title:"Descripción",headerAttributes:{style:"display: none"}},{field:"numeral",title:"Numeral",width:"150px",headerAttributes:{style:"display: none"},attributes:{style:"text-align: center"}},{field:"rate",title:"Calificación",width:"220px",editor:'<input kendo-drop-down-list k-value-primitive="true" k-options="rateOptions"  />',template:function(t){return t.rate?t.rate.text:"-Seleccionar-"},headerAttributes:{style:"display: none"},attributes:{style:"text-align: center;font-weight: bold;","class":"text-capitalize text-dark"}},{title:"icon",width:"70px",headerAttributes:{style:"display: none"},template:function(t){var e="";switch(t.rateCode){case"nac":e='<i class="fa fa-ban text-yellow text-extra-extra-large"></i>';break;case"nas":e='<i class="fa fa-minus-circle text-danger text-extra-extra-large"></i>';break;case"cp":e='<i class="fa fa-check-circle-o text-green text-extra-extra-large"></i>';break;case"nc":e='<i class="fa fa-circle-o text-red text-extra-extra-large"></i>';break;default:e='<i class="fa fa-question-circle text-orange text-extra-extra-large"></i>'}return e},attributes:{style:"text-align: center;font-weight: bold;"}}]}}}),t.$on("kendoWidgetCreated",function(e,n){void 0!==t.grid&&null!==t.grid||(t.grid=n)}),t.form={next:function(e){if(t.toTheTop(),e.$valid)E();else{var n=null,a=null;for(n in e)"$"!=n[0]&&(null!==a||e[n].$valid||(a=e[n].$name),e[n].$pristine&&(e[n].$dirty=!0));angular.element(".ng-invalid[name="+a+"]").focus(),A()}},prev:function(t){_()},goTo:function(e,n){parseInt(t.currentStep)>parseInt(n)?k(n):e.$valid?k(n):A()},submit:function(){},reset:function(){}};var E=function(){t.currentStep++,D.id=t.cycles[t.currentStep].id,D.code=t.cycles[t.currentStep].abbreviation,t.grid.dataSource.page(1)},_=function(){t.currentStep--,D.id=t.cycles[t.currentStep].id,D.code=t.cycles[t.currentStep].abbreviation,t.grid.dataSource.page(1)},k=function(e){t.currentStep=e,D.id=t.cycles[t.currentStep].id,D.code=t.cycles[t.currentStep].abbreviation,t.grid.dataSource.page(1)},A=function(t){l.pop("error","Error","Por favor complete este ciclo antes de continuar.")};t.onCancel=function(e){null!=t.$parent&&t.$parent.navToSection("summary","summary",$)},t.onAddComment=function(e){var a=g.open({templateUrl:d.app.views.urlRoot+"modules/customer/common/modals/customer_questions_comment_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideCustomerEvaluationMinimumStandardItemComment0312Ctrl",scope:t,resolve:{dataItem:function(){return e},isView:function(){return"view"==t.$parent.editMode}}});a.result.then(function(){},function(){n.info("Modal dismissed at: "+new Date)})},t.onAddAttachment=function(e){var a=g.open({templateUrl:d.app.views.urlRoot+"modules/customer/diagnostic/tab-minimum-standard-0312/customer_evaluation_minimum_standard_items_document_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideCustomerEvaluationMinimumStandardItemAttachment0312Ctrl",scope:t,resolve:{dataItem:function(){return e},isView:function(){return"view"==t.$parent.editMode},cycle:function(){return t.cycles[t.currentStep]}}});a.result.then(function(){},function(){n.info("Modal dismissed at: "+new Date)})},t.onAddImprovementPlan=function(e){var a=g.open({templateUrl:d.app.views.urlRoot+"modules/customer/common/modals/customer_improvement_plan_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideCustomerEvaluationMinimumStandardItemImprovementPlan0312Ctrl",scope:t,resolve:{item:function(){return e},isView:function(){return"view"==t.$parent.editMode},cycle:function(){return t.cycles[t.currentStep]}}});a.result.then(function(){},function(){n.info("Modal dismissed at: "+new Date)})},t.onAddVerificationList=function(e){var a=g.open({templateUrl:d.app.views.urlRoot+"modules/customer/diagnostic/tab-minimum-standard-0312/customer_evaluation_minimum_standard_items_detail_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideCustomerEvaluationMinimumStandardItemDetail0312Ctrl",scope:t,resolve:{item:function(){return e},isView:function(){return"view"==t.$parent.editMode}}});a.result.then(function(){P()},function(){n.info("Modal dismissed at: "+new Date)})},t.onSummaryExportExcel=function(){var t=JSON.stringify({customerId:e.customerId,customerEvaluationMinimumStandardId:$});angular.element("#download")[0].src="api/customer-evaluation-minimum-standard-item-0312/export-excel?data="+Base64.encode(t)}}]),app.controller("ModalInstanceSideCustomerEvaluationMinimumStandardItemAttachment0312Ctrl",["$stateParams","$rootScope","$scope","$uibModalInstance","cycle","dataItem","isView","$log","$timeout","SweetAlert","$filter","FileUploader","$http","DTColumnBuilder","DTOptionsBuilder","$compile","ListService",function(t,e,n,a,i,o,r,l,s,c,d,u,m,p,f,h,w){function v(){var e=[{name:"customer_document_type",value:t.customerId}];w.getDataList(e).then(function(t){n.documentType=t.data.data.customerDocumentType},function(t){n.status="Unable to load customer data: "+t.message})}var g=0,b="M",C=e.isCustomer();n.isView=!C&&r,n.documentClassification=e.parameters("customer_document_classification"),n.documentStatus=e.parameters("customer_document_status"),v();var y=function(){n.attachment={id:0,customerEvaluationMinimumStandardItemId:o.id,type:null,classification:null,description:"",status:n.documentStatus?n.documentStatus[0]:null,version:1,program:i.abbreviation,label:b}};y(),n.onCloseModal=function(){a.close(1)},n.onCancel=function(){a.dismiss("cancel")},n.onClear=function(){y()};var S=n.uploader=new u({url:"api/customer-evaluation-minimum-standard-item-document-0312/upload",formData:[],removeAfterUpload:!0});S.filters.push({name:"customFilter",fn:function(t,e){return this.queue.length<10}}),S.onBeforeUploadItem=function(t){var e={id:g};t.formData.push(e)},S.onCompleteAll=function(){n.reloadData(),n.onClear()},n.form={submit:function(t){var e=null;if(t.$invalid){var n=null,e=null;for(n in t)"$"!=n[0]&&(null!==e||t[n].$valid||(e=t[n].$name),t[n].$pristine&&(t[n].$dirty=!0));return angular.element(".ng-invalid[name="+e+"]").focus(),void c.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}c.swal("Validación exitosa","Procediendo con el guardado...","success"),O()},reset:function(t){t.$setPristine(!0)}};var O=function(){b=n.attachment.label;var t={},e=JSON.stringify(n.attachment);return t.data=Base64.encode(e),m({method:"POST",url:"api/customer-evaluation-minimum-standard-item-document-0312/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){s(function(){S.queue.length>0?(g=t.data.result.id,S.uploadAll()):(n.reloadData(),n.onClear())})})["catch"](function(t){c.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){n.reloadData()})};n.dtOptionsCustomerDocumentModal=f.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.customerEvaluationMinimumStandardItemId=o.id,t.statusCode="2",JSON.stringify(t)},url:"api/customer-evaluation-minimum-standard-item-document-0312",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){I()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,e,a){h(angular.element(t).contents())(n)}),n.dtColumnsCustomerDocumentModal=[p.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,n,a,i){var o=t.documentUrl?t.documentUrl:"",r="api/customer-evaluation-minimum-standard-item-document-0312/download?id="+t.id,l="",s='<a target="_self" class="btn btn-primary btn-xs downloadDocumentRow lnk" href="'+r+'" uib-tooltip="Descargar anexo" data-id="'+t.id+'" >   <i class="fa fa-download"></i></a> ',c='<a class="btn btn-info btn-xs openDocumentRow lnk" target="_blank" href="'+o+'" uib-tooltip="Abrir anexo" data-id="'+t.id+'" >   <i class="fa fa-folder-open-o"></i></a> ',d=!1;return null==t.protectionType?d=!0:"public"==t.protectionType?d=!0:"private"==t.protectionType&&1==t.hasPermission&&(d=!0),e.can("clientes_anexo_open")&&""!=o&&(l+=c),e.can("clientes_anexo_download")&&""!=o&&(l+=s),d?l:""}),p.newColumn("documentType").withTitle("Tipo de documento").withOption("width",200),p.newColumn("classification").withTitle("Clasificación").withOption("width",200),p.newColumn("description").withTitle("Descripción").withOption("width",200),p.newColumn("version").withTitle("Versión").withOption("width",200),p.newColumn("createdAt").withTitle("Fecha Creación").withOption("width",200).withOption("defaultContent",""),p.newColumn("status").withTitle("Estado").withOption("width",200).renderWith(function(t,e,n,a){var i="";switch(t){case"Vigente":i="label label-success";break;case"Anulado":i="label label-danger"}var o='<span class="'+i+'">'+t+"</span>";return o}),p.newColumn("label").withTitle("Origen").withOption("width",200).withOption("defaultContent","")];var I=function(){$("#dtCustomerDocumentModal a.editRow").on("click",function(){var t=$(this).data("id"),e=$(this).data("url");""==e?c.swal("Error en la descarga","No existe un anexo para descargar","error"):jQuery("#downloadDocument")[0].src="api/customer-evaluation-minimum-standard-item-document-0312/download?id="+t})};n.dtInstanceCustomerDocumentModalCallback=function(t){n.dtInstanceCustomerDocumentModal=t},n.reloadData=function(){n.dtInstanceCustomerDocumentModal.reloadData()},n.dtOptionsCustomerMinimunStandardItemDocumentModal=f.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerId=t.customerId,e.minimumStandardItemId=o.minimumStandardItemId,e.customerId=t.customerId,e.statusCode="2",JSON.stringify(e)},url:"api/customer-evaluation-minimum-standard-item-document-0312-available-previous",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){T()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,e,a){h(angular.element(t).contents())(n)}),n.dtColumnsCustomerMinimunStandardItemDocumentModal=[p.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,n,a,i){var o=t.documentUrl?t.documentUrl:"",r=("api/customer-evaluation-minimum-standard-item-document-0312/download?id="+t.id,""),l='<a class="btn btn-success btn-xs addRow lnk" uib-tooltip="Adicionar" data-id="'+t.id+'" >   <i class="fa fa-plus"></i></a> ',s=!1;return null==t.protectionType?s=!0:"public"==t.protectionType?s=!0:"private"==t.protectionType&&1==t.hasPermission&&(s=!0),e.can("clientes_anexo_open")&&""!=o&&(r+=l),s?r:""}),p.newColumn("period").withTitle("Periodo").withOption("width",200),p.newColumn("documentType").withTitle("Tipo de documento").withOption("width",200),p.newColumn("classification").withTitle("Clasificación").withOption("width",200),p.newColumn("description").withTitle("Descripción").withOption("width",200),p.newColumn("version").withTitle("Versión").withOption("width",200),p.newColumn("createdAt").withTitle("Fecha Creación").withOption("width",200).withOption("defaultContent",""),p.newColumn("status").withTitle("Estado").withOption("width",200).renderWith(function(t,e,n,a){var i="";switch(t){case"Vigente":i="label label-success";break;case"Anulado":i="label label-danger"}var o='<span class="'+i+'">'+t+"</span>";return o})];var T=function(){$("#dtCustomerMinimunStandardItemDocumentModal a.addRow").on("click",function(){var t=$(this).data("id");D(t)})};n.dtInstanceCustomerMinimunStandardItemDocumentModalCallback=function(t){n.dtInstanceCustomerMinimunStandardItemDocumentModal=t},n.reloadHistoricalData=function(){n.dtInstanceCustomerMinimunStandardItemDocumentModal.reloadData()};var D=function(t){b=n.attachment.label;var e=JSON.stringify({id:t,customerEvaluationMinimumStandardItemId:o.id});return m({method:"POST",url:"api/customer-evaluation-minimum-standard-item-document-0312/import-historical",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param({data:Base64.encode(e)})}).then(function(t){s(function(){y(),n.reloadHistoricalData(),n.reloadData()})})["catch"](function(t){c.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})}}]),app.controller("ModalInstanceSideCustomerEvaluationMinimumStandardItemImprovementPlan0312Ctrl",["$stateParams","$rootScope","$scope","$uibModalInstance","item","cycle","$log","$timeout","SweetAlert","isView","$filter","FileUploader","$http","DTOptionsBuilder","DTColumnBuilder","$compile",function(t,e,n,a,i,o,r,l,s,c,d,u,m,p,f,h){var w=e.isCustomer(),v=e.isAgent();n.isView=!w&&!v&&c,n.maxDate=new Date,n.datePickerConfig={culture:"es-CO",format:"dd/MM/yyyy HH:mm"},n.responsibleList=[],n.typesAlert=d("orderBy")(e.parameters("tracking_alert_type"),"id",!1),n.typesTime=e.parameters("tracking_alert_timeType"),n.statusAlert=e.parameters("tracking_alert_status"),n.preferencesAlert=e.parameters("tracking_alert_preference"),n.typeList=e.parameters("improvement_plan_type");var g=function(){n.improvement={id:0,customerId:t.customerId,classificationName:o.name,classificationId:o.abbreviation,entityName:"EM_0312",entityId:i.id,type:null,endDate:null,description:"cp"!=i.rateCode?i.comment:null,observation:"",responsible:null,isRequiresAnalysis:!1,status:{id:0,value:"CR",item:"Creada"},trackingList:[],alertList:[],period:i.period}};g(),n.onLoadRecord=function(t){if(0!=t){var e={id:t};m({method:"GET",url:"api/customer/improvement-plan",params:e})["catch"](function(t,e){if(403==e){var n=null!==t.message&&void 0!==t.message?t.message:"app.clientes.list";s.swal("No Autorizado","No estas autorizado para ver esta información.","error"),l(function(){$state.go(n)},3e3)}else 404==e?s.swal("Información no disponible","Registro no encontrado","error"):s.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(t){console.log(t),l(function(){null!=t.data.result&&""!=t.data.result&&(n.improvement=t.data.result,y())},400)})["finally"](function(){})}else n.loading=!1},n.onCloseModal=function(){a.close(1)},n.onCancel=function(){a.dismiss("cancel")},n.onClear=function(){};var b=function(){var e={customer_id:t.customerId};return m({method:"POST",url:"api/customer/improvement-plan/list-data",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(t){l(function(){n.responsibleList=t.data.data.responsible})})["catch"](function(t){s.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};b(),n.master=n.improvement,n.form={submit:function(t){var e=null;if(t.$invalid){var n=null,e=null;for(n in t)"$"!=n[0]&&(null!==e||t[n].$valid||(e=t[n].$name),t[n].$pristine&&(t[n].$dirty=!0));return angular.element(".ng-invalid[name="+e+"]").focus(),void s.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}s.swal("Validación exitosa","Procediendo con el guardado...","success"),C()},reset:function(t){n.improvement=angular.copy(n.master),t.$setPristine(!0)}};var C=function(){var t={},e=JSON.stringify(n.improvement);return t.data=Base64.encode(e),m({method:"POST",url:"api/customer/improvement-plan/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){l(function(){g()})})["catch"](function(t){s.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){n.reloadData()})},y=function(){null!=n.improvement.endDate&&(n.improvement.endDate=new Date(n.improvement.endDate.date)),angular.forEach(n.improvement.trackingList,function(t,e){null!=t.startDate&&(t.startDate=new Date(t.startDate.date))})};n.onAddTracking=function(){l(function(){null==n.improvement.trackingList&&(n.improvement.trackingList=[]),n.improvement.trackingList.push({id:0,customerImprovementPlanId:0,responsible:null,startDate:null})})},n.onRemoveTracking=function(t){s.swal({title:"Está seguro?",text:"Desea confirmar la eliminación de este registro ?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(e){e?l(function(){var e=n.improvement.trackingList[t];if(n.improvement.trackingList.splice(t,1),0!=e.id){var a={};a.id=e.id,m({method:"POST",url:"api/customer/improvement-plan-tracking/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){r.error(t),s.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})},n.onAddAlert=function(){l(function(){null==n.improvement.alertList&&(n.improvement.alertList=[]),n.improvement.alertList.push({id:0,customerImprovementPlanId:0,type:null,preference:null,time:0,timeType:null,status:null})})},n.onRemoveAlert=function(t){s.swal({title:"Está seguro?",text:"Desea confirmar la eliminación de este registro ?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(e){e?l(function(){var e=n.improvement.alertList[t];if(n.improvement.alertList.splice(t,1),0!=e.id){var a={};a.id=e.id,m({method:"POST",url:"api/customer/improvement-plan-alert/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){r.error(t),s.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})},n.dtInstanceImprovementPlan={},n.dtOptionsImprovementPlan=p.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.customerId=n.improvement.customerId,t.entityId=n.improvement.entityId,t.entityName=n.improvement.entityName,JSON.stringify(t)},url:"api/customer-improvement-plan-entity",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){S()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,e,a){h(angular.element(t).contents())(n)}),n.dtColumnsImprovementPlan=[f.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,a,i,o){var r="",l='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+t.id+'" >   <i class="fa fa-edit"></i></a> ',s='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+t.id+'" >   <i class="fa fa-trash-o"></i></a> ';return e.can("cliente_plan_mejoramiento_edit")&&(r+=l),e.can("cliente_plan_mejoramiento_delete")&&(r+=s),n.isView?null:r}),f.newColumn("origin").withTitle("Origen").withOption("width",200).withOption("defaultContent",""),f.newColumn("classification").withTitle("Clasificación").withOption("width",200).withOption("defaultContent",""),f.newColumn("type").withTitle("Tipo").withOption("width",200).withOption("defaultContent",""),f.newColumn("description").withTitle("Hallazgo").withOption("width",200).withOption("defaultContent",""),f.newColumn("responsibleName").withTitle("Responsable").withOption("defaultContent",""),f.newColumn(null).withTitle("Fecha Cierre").withOption("width",200).renderWith(function(t,e,n,a){return"object"==typeof t.endDate&&null!=t.endDate?moment(t.endDate.date).format("DD/MM/YYYY"):null!=t.endDate?moment(t.endDate).format("DD/MM/YYYY"):""}),f.newColumn(null).withTitle("Estado").withOption("width",200).withOption("defaultContent","").renderWith(function(t,e,n,a){var i="label label-success",o=t.status;switch(t.statusCode){case"AB":i="label label-info";break;case"CO":i="label label-success";break;case"CA":i="label label-danger"}return'<span class="'+i+'">'+o+"</span>"})];var S=function(){$("#dtImprovementPlan a.editRow").on("click",function(){var t=$(this).data("id");n.onLoadRecord(t)}),$("#dtImprovementPlan a.delRow").on("click",function(){var t=$(this).data("id");s.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(e){if(e){var a={};a.id=t,m({method:"POST",url:"api/customer/improvement-plan/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){r.error(t),s.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){n.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};n.dtInstanceImprovementPlanCallback=function(t){n.dtInstanceImprovementPlan=t},n.reloadData=function(){n.dtInstanceImprovementPlan.reloadData()}}]),app.controller("ModalInstanceSideCustomerEvaluationMinimumStandardItemComment0312Ctrl",["$stateParams","$rootScope","$scope","$uibModalInstance","dataItem","isView","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile","$document",function(t,e,n,a,i,o,r,l,s,c,d,u,m,p,f,h,w){var v=e.isCustomer(),g=e.isAgent();n.isView=!v&&!g&&o;var b=function(){n.entity={id:0,customerEvaluationMinimumStandardItemId:i.id,type:"M",comment:""}};b(),n.onCloseModal=function(){a.close(1)},n.onCancel=function(){a.dismiss("cancel")},n.onClear=function(){b()},n.form={submit:function(t){var e=null;if(t.$invalid){var a=null,e=null;for(a in t)"$"!=a[0]&&(null!==e||t[a].$valid||(e=t[a].$name),t[a].$pristine&&(t[a].$dirty=!0));return angular.element(".ng-invalid[name="+e+"]").focus(),void l(function(){d.pop("error","Error","Por favor verifique los datos requeridos del formulario y vuelva a intentarlo")},500)}n.onSave()},reset:function(t){t.$setPristine(!0)}},n.onSave=function(){var t={},e=JSON.stringify(n.entity);return t.data=Base64.encode(e),c({method:"POST",url:"api/customer-evaluation-minimum-standard-item-comment-0312/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){l(function(){d.pop("success","Operación Exitosa","Actualización exitosa."),n.onClear(),n.reloadData()})})["catch"](function(t){d.pop("Error","Error inesperado",t)})["finally"](function(){})},n.dtInstanceQuestionComment={},n.dtOptionsQuestionComment=f.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.customerEvaluationMinimumStandardItemId=i.id,JSON.stringify(t)},url:"api/customer-evaluation-minimum-standard-item-comment-0312",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,e,a){h(angular.element(t).contents())(n)}),n.dtColumnsQuestionComment=[p.newColumn("comment").withTitle("Comentario"),p.newColumn("type").withTitle("Tipo").withOption("width",200).withOption("defaultContent",""),p.newColumn("createdBy").withTitle("Usuario").withOption("width",200).withOption("defaultContent",""),p.newColumn("createdAt").withTitle("Fecha").withOption("width",200).withOption("defaultContent","")],n.dtInstanceQuestionCommentCallback=function(t){n.dtInstanceQuestionComment=t},n.reloadData=function(){n.dtInstanceQuestionComment.reloadData()}}]),app.controller("ModalInstanceSideCustomerEvaluationMinimumStandardItemDetail0312Ctrl",["$rootScope","$stateParams","$scope","$uibModalInstance","item","isView","$log","$timeout","SweetAlert","$http","toaster","$filter","$aside","$document","DTColumnBuilder","DTOptionsBuilder","$compile",function(t,e,n,a,i,o,r,l,s,c,d,u,m,p,f,h,w){var v=r;n.isView=!0,n.isVisible=!o,n.loading=!0,n.onCloseModal=function(){a.close(1)},n.onCancel=function(){a.dismiss("cancel")};var g=function(){n.entity={id:i.id},n.standard={id:i.minimumStandardItemId}};g();var b=function(){if(n.standard.id){var t={id:n.standard.id};c({method:"GET",url:"api/minimum-standard-item-0312/get",params:t})["catch"](function(t,e){if(403==e){var n=null!==t.message&&void 0!==t.message?t.message:"app.clientes.list";s.swal("No Autorizado","No estas autorizado para ver esta información.","error"),l(function(){$state.go(n)},3e3)}else 404==e?(s.swal("Información no disponible","Anexo no encontrado","error"),l(function(){$state.go("app.clientes.list")})):s.swal("Error","Se ha presentado un error al intentar acceder a la información del anexo","error")}).then(function(t){l(function(){n.standard=t.data.result})})["finally"](function(){l(function(){n.loading=!1},400)})}};b();var C=function(){if(n.entity.id){var t={id:n.entity.id};c({method:"GET",url:"api/customer-evaluation-minimum-standard-item-0312/get",params:t})["catch"](function(t,e){}).then(function(t){l(function(){n.entity=t.data.result,null==n.entity.realRate&&null==n.entity.rate&&n.onVerificationChange()})})["finally"](function(){})}};C(),n.onVerificationChange=function(){r.info("Verification mode's item has change"),null==n.entity.rate&&(n.entity.comment="",
angular.forEach(n.entity.verificationModeList,function(t,e){t.isActive||(n.entity.comment+=t.description+"\n")}),y())},n.onClearRate=function(){n.entity.rate=null,y()};var y=function(){var t=u("filter")(n.entity.verificationModeList,{isActive:!1});null==n.entity.rate?0==t.length?n.entity.realRate=n.rateRealList[0]:t.length<=n.entity.verificationModeList.length&&(n.entity.realRate=n.rateRealList[1]):n.entity.realRate=null};n.onSelectRate=function(){l(function(){n.entity.realRate=null,angular.forEach(n.entity.verificationModeList,function(t,e){t.isActive=!1}),n.entity.comment=null})},n.form={submit:function(t){var e=null;if(t.$invalid){var a=null,e=null;for(a in t)"$"!=a[0]&&(null!==e||t[a].$valid||(e=t[a].$name),t[a].$pristine&&(t[a].$dirty=!0));return v.info(n.standard),angular.element(".ng-invalid[name="+e+"]").focus(),void s.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}s.swal("Validación exitosa","Guardando información...","success"),S()},reset:function(t){n.clear()}};var S=function(){var t={},e=JSON.stringify(n.entity);return t.data=Base64.encode(e),c({method:"POST",url:"api/customer-evaluation-minimum-standard-item-0312/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){l(function(){n.onCloseModal()})})["catch"](function(t){r.error(t),s.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})}}]);
"use strict";app.controller("customerConfigurationMinimumStandardItem0312ListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$aside",function(t,n,i,a,e,r,o,d,l,u,s,c,m,f){var p=i;p.info("loading..configurationMinimumStandardItemItemListCtrl "),t.isNewMinimumStandardItem=!0,t.dtOptionsCustomerConfigMinimumStandardItem0312=a.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t},url:"api/minimum-standard-item",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){w()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(n,i,a){o(angular.element(n).contents())(t)}),t.dtColumnsCustomerConfigMinimumStandardItem0312=[e.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,n,i,a){var e="",r="",o='<a class="btn btn-danger btn-xs editRow lnk" href="#" uib-tooltip="Configurar"  data-id="'+t.id+'"'+r+' >   <i class="fa fa-cog"></i></a> ';'<a class="btn btn-danger btn-xs delRow lnk" href="#"  uib-tooltip="Eliminar" data-id="'+t.id+'"'+r+' >   <i class="fa fa-trash-o"></i></a> ';return u.can("diagnostico_continue"),e+=o,u.can("clientes_delete"),e}),e.newColumn("minimumStandard.cycle.name").withTitle("Ciclo").withOption("width",200).withOption("defaultContent",""),e.newColumn("minimumStandard.parent.numeral").withTitle("Numeral (Padre)").withOption("width",200).withOption("defaultContent",""),e.newColumn("minimumStandard.parent.description").withTitle("Estándar (Padre)").withOption("width",200).withOption("defaultContent",""),e.newColumn("minimumStandard.numeral").withTitle("Numeral (Hijo)").withOption("width",200).withOption("defaultContent",""),e.newColumn("minimumStandard.description").withTitle("Estandar (Hijo)").withOption("width",200).withOption("defaultContent",""),e.newColumn("numeral").withTitle("Numeral").withOption("width",200).withOption("defaultContent",""),e.newColumn("description").withTitle("Item").withOption("width",200).withOption("defaultContent",""),e.newColumn("value").withTitle("Valor").withOption("width",200).withOption("defaultContent",""),e.newColumn("isActive").withTitle("Estado").withOption("width",200).renderWith(function(t,n,i,a){var e="",r="";t||1==t?(e="label label-success",r="Activo"):(e="label label-danger",r="Inactivo");var o='<span class="'+e+'">'+r+"</span>";return o})];var w=function(){$("#dtCustomerConfigMinimumStandardItem0312 a.editRow").on("click",function(){var t=$(this).data("id");h(t)}),$("#dtCustomerConfigMinimumStandardItem0312 a.delRow").on("click",function(){var n=$(this).data("id");m.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(a){if(a){var e={};e.id=n,c({method:"POST",url:"api/minimum-standard-item/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){i.error(t),m.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){t.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};t.dtInstanceCustomerConfigMinimumStandardItem0312Callback=function(n){t.dtInstanceCustomerConfigMinimumStandardItem0312=n},t.reloadData=function(){t.dtInstanceCustomerConfigMinimumStandardItem0312.reloadData()};var h=function(t){g(t)},g=function(n){var i={id:n?n:0},a=f.open({templateUrl:u.app.views.urlRoot+"modules/customer/diagnostic/tab-minimum-standard-0312/customer_configuration_minimum_standard_item_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideCustomerConfigurationMinimumStandardItemEditCtrl",scope:t,resolve:{standard:function(){return i}}});a.result.then(function(){t.reloadData()},function(){})};t.onReturn=function(){null!=t.$parent&&t.$parent.navToSection("summary","summary",t.$parent.currentId)}}]),app.controller("ModalInstanceSideCustomerConfigurationMinimumStandardItem0312EditCtrl",["$rootScope","$stateParams","$scope","$uibModalInstance","standard","$log","$timeout","SweetAlert","$http","toaster","$filter","$aside","$document","DTColumnBuilder","DTOptionsBuilder","$compile",function(t,n,i,a,e,r,o,d,l,u,s,c,m,f,p,w){var h=r;i.isView=!0,i.config={customerId:n.customerId,minimumStandardItemId:e.id,verificationList:[]},i.maxDate=new Date,i.datePickerConfig={culture:"es-CO",format:"dd/MM/yyyy HH:mm"},i.loading=!0,i.onCloseModal=function(){a.close(1)},i.onCancel=function(){a.dismiss("cancel")};var g=function(){i.standard={id:e.id,minimumStandard:null,minimumStandardParent:null,numeral:"",description:"",value:0,criterion:"",isActive:!0,legalFrameworkList:[],verificationModeList:[]}};g();var C=function(){var t={};return l({method:"POST",url:"api/minimum-standard/list-data",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){o(function(){i.parentList=t.data.data.parent,i.standardListAll=t.data.data.standard})})["catch"](function(t){d.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};C();var v=function(){angular.forEach(i.config.verificationList,function(t,n){t.isActive=1==t.isActive})},S=function(){var t={minimum_standard_item_id:e.id,customer_id:n.customerId};return l({method:"POST",url:"api/customer/configuration-minimum-standard-item-detail/list-data",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){o(function(){i.config.verificationList=t.data.data.verificationList,v()})})["catch"](function(t){d.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};S(),i.onLoadRecord=function(){if(i.standard.id){var t={id:i.standard.id};l({method:"GET",url:"api/minimum-standard-item",params:t})["catch"](function(t,n){if(403==n){var i=null!==t.message&&void 0!==t.message?t.message:"app.clientes.list";d.swal("No Autorizado","No estas autorizado para ver esta información.","error"),o(function(){$state.go(i)},3e3)}else 404==n?(d.swal("Información no disponible","Anexo no encontrado","error"),o(function(){$state.go("app.clientes.list")})):d.swal("Error","Se ha presentado un error al intentar acceder a la información del anexo","error")}).then(function(t){o(function(){i.standard=t.data.result})})["finally"](function(){o(function(){i.loading=!1},400)})}},i.$watch("standard.minimumStandardParent",function(t,n,a){i.standardList=[],null==n||angular.equals(t,n)||(i.standard.minimumStandard=null),null!=i.standard.minimumStandardParent&&(i.standardList=s("filter")(i.standardListAll,{parentId:i.standard.minimumStandardParent.id}))}),i.onLoadRecord(),i.$watch("standard.cycle",function(t,n,a){i.parentList=[],null==n||angular.equals(t,n)||(i.standard.parent=null),null!=i.standard.cycle&&(i.parentList=s("filter")(i.parentListAll,{cycleId:i.standard.cycle.id}))}),i.master=i.config,i.form={submit:function(t){var n=null;if(t.$invalid){var a=null,n=null;for(a in t)"$"!=a[0]&&(null!==n||t[a].$valid||(n=t[a].$name),t[a].$pristine&&(t[a].$dirty=!0));return h.info(i.standard),angular.element(".ng-invalid[name="+n+"]").focus(),void d.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}d.swal("Validación exitosa","Guardando información del centro de trabajo...","success"),O()},reset:function(t){i.clear()}};var O=function(){var t={},n=JSON.stringify(i.config);return t.data=Base64.encode(n),l({method:"POST",url:"api/customer/configuration-minimum-standard-item-detail/insert",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){o(function(){i.standard=t.data.result})})["catch"](function(t){r.error(t),d.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){i.reloadData()})};i.onSelectAll=function(){angular.forEach(i.config.verificationList,function(t,n){t.isActive=!0})},i.onClearAll=function(){angular.forEach(i.config.verificationList,function(t,n){t.isActive=!1})}}]);
"use strict";app.controller("customerEvaluationMinimumStandardReport0312Ctrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","ListService",function(e,t,a,n,r,o,i,u,d,c,l,m,s,p){function f(){var a={customerId:t.customerId,customerEvaluationMinimumStandardId:e.currentId,rateId:e.filter.selectedRate?e.filter.selectedRate.id:null},n=[{name:"customer_evaluation_minimum_stardard_report_0312",value:null,criteria:a},{name:"minimum_stardard_rate_0312",value:t.customerId}];p.getDataList(n).then(function(t){e.rates=t.data.data.rateReal,e.cycles=t.data.data.customerEvaluationMinimumStandardReport},function(t){e.status="Unable to load customer data: "+t.message})}e.filter={selectedRate:null},e.rates=[],e.currentId=e.$parent.currentId,f(),e.onSelectRate=function(){f()},e.onClearRate=function(){e.filter.selectedRate=null,f()},e.onContinue=function(t){null!=e.$parent&&e.$parent.navToSection("edit","edit",e.currentId)},e.cancelEdition=function(t){null!=e.$parent&&e.$parent.navToSection("summary","summary",e.currentId)},e.onSummaryExportPdf=function(){kendo.drawing.drawDOM($(".export-pdf-em-report-0312")).then(function(e){return kendo.drawing.exportPDF(e,{paperSize:"auto",margin:{left:"1cm",top:"1cm",right:"1cm",bottom:"1cm"}})}).done(function(e){kendo.saveAs({dataURI:e,fileName:"Auto-Evaluacion-Estandares-Minimos-Reporte.pdf",proxyURL:"//demos.telerik.com/kendo-ui/service/export"})})},e.onSummaryExportExcel=function(){var a=JSON.stringify({customerId:t.customerId,customerEvaluationMinimumStandardId:e.currentId,rateId:e.filter.selectedRate?e.filter.selectedRate.id:null});angular.element("#downloadDocument")[0].src="api/customer-evaluation-minimum-standard-item-0312/export-excel?data="+Base64.encode(a)}}]);
"use strict";app.controller("customerEvaluationMinimumStandardMonthlyReport0312Ctrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","ChartService","ListService",function(t,n,e,i,a,r,o,u,d,l,c,m,s,p,h){function w(){var e={customerId:n.customerId,customerEvaluationMinimumStandardId:t.currentId,year:t.filter.selectedYear?t.filter.selectedYear.value:0},i=[{name:"chart_bar_options",criteria:null},{name:"chart_line_options",criteria:null},{name:"customer_evaluation_minimum_standard_monthly_0312",criteria:e}];p.getDataChart(i).then(function(n){t.chart.bar.options=n.data.data.chartBarOptions,t.chart.line.options=n.data.data.chartLineOptions,t.chart.bar.options.legend.position="bottom",t.chart.line.options.legend.position="bottom",t.chart.status.data=n.data.data.customerEvaluationMinimumStandardMonthlyStatus,t.chart.average.data=n.data.data.customerEvaluationMinimumStandardMonthlyAverage,t.chart.total.data=n.data.data.customerEvaluationMinimumStandardMonthlyTotal,t.chart.advance.data=n.data.data.customerEvaluationMinimumStandardMonthlyAdvance},function(n){t.status="Unable to load customer data: "+n.message})}function f(){var e={customerId:n.customerId,customerEvaluationMinimumStandardId:t.currentId},i=[{name:"customer_evaluation_minimum_stardard_year_0312",value:null,criteria:e},{name:"minimum_stardard_rate_0312",value:n.customerId}];h.getDataList(i).then(function(n){t.years=n.data.data.customerEvaluationMinimumStandardYear,t.years.length>0&&(t.filter.selectedYear=t.years[0],w()),t.canShowDatatable=!0},function(n){t.status="Unable to load customer data: "+n.message})}t.currentId=t.$parent.currentId,t.canShowDatatable=!1,t.chart={bar:{options:null},line:{options:null},status:{data:null},average:{data:null},total:{data:null},advance:{data:null}},f(),t.audit={},t.audit.operation="info",t.audit.year=0,t.audit.standardId=t.currentId,t.filter={selectedYear:null};var O=function(t,n,e,i,a){var r={field:t,title:n,width:e,attributes:{style:"text-align: center"},headerAttributes:{"class":"text-bold"},template:"function"==typeof a?a:null};return void 0===i||i||(r.headerAttributes={style:"display: none"}),r};c(function(){t.mainGridOptions={dataSource:{type:"odata",transport:{read:{url:"api/customer-evaluation-minimum-standard-tracking-0312-summary-cycle",dataType:"json",type:"POST",data:function(){var n={customerEvaluationMinimumStandardId:t.currentId,year:t.filter.selectedYear?t.filter.selectedYear.value:0};return n}},parameterMap:function(t,n){return JSON.stringify(t)}},schema:{model:{id:"id",fields:{description:{editable:!1,nullable:!0}}},data:function(t){return t.data||t},total:function(t){return t.recordsTotal||t.data.length||0}},pageSize:10,serverPaging:!0,serverFiltering:!0,serverSorting:!0},sortable:!1,pageable:!1,filterable:!1,dataBound:function(t){var n=this;this.tbody.find(".k-hierarchy-cell").each(function(){var t=n.dataItem($(this).closest("tr"));"PUNTAJE"==t.abbreviation&&$(this).find("a.k-icon").remove()})},columns:[{field:"abbreviation",title:"Código",attributes:{"class":"text-orange text-large"}},{field:"name",title:"Ciclo",attributes:{"class":"text-orange text-large"}},O("JAN","ENE","70px",!0,function(t){return null!=t.JAN?t.JAN+" %":""}),O("FEB","FEB","70px",!0,function(t){return null!=t.FEB?t.FEB+" %":""}),O("MAR","MAR","70px",!0,function(t){return null!=t.MAR?t.MAR+" %":""}),O("APR","ABR","70px",!0,function(t){return null!=t.APR?t.APR+" %":""}),O("MAY","MAY","70px",!0,function(t){return null!=t.MAY?t.MAY+" %":""}),O("JUN","JUN","70px",!0,function(t){return null!=t.JUN?t.JUN+" %":""}),O("JUL","JUL","70px",!0,function(t){return null!=t.JUL?t.JUL+" %":""}),O("AUG","AGO","70px",!0,function(t){return null!=t.AUG?t.AUG+" %":""}),O("SEP","SEP","70px",!0,function(t){return null!=t.SEP?t.SEP+" %":""}),O("OCT","OCT","70px",!0,function(t){return null!=t.OCT?t.OCT+" %":""}),O("NOV","NOV","70px",!0,function(t){return null!=t.NOV?t.NOV+" %":""}),O("DEC","DIC","70px",!0,function(t){return null!=t.DEC?t.DEC+" %":""})]},t.detailGridOptions=function(n){return{dataSource:{type:"odata",transport:{read:{url:"api/customer-evaluation-minimum-standard-tracking-0312-summary-cycle-detail",dataType:"json",type:"POST",data:function(){var e={customerEvaluationMinimumStandardId:t.currentId,year:t.filter.selectedYear?t.filter.selectedYear.value:0,cycle:n.cycle};return e}},parameterMap:function(t,n){return JSON.stringify(t)}},requestEnd:function(t){},schema:{model:{id:"id",fields:{indicator:{editable:!1,nullable:!0}}},data:function(t){return t.data||t},total:function(t){return t.recordsTotal||t.data.length||0}},serverPaging:!1,serverSorting:!1,serverFiltering:!1},scrollable:!1,sortable:!1,pageable:!1,columns:[{field:"indicator",title:"Indicador",headerAttributes:{style:"display: none"}},O("JAN","ENE","70px",!1,function(t){return S(t.JAN)}),O("FEB","FEB","70px",!1,function(t){return S(t.FEB)}),O("MAR","MAR","70px",!1,function(t){return S(t.MAR)}),O("APR","ABR","70px",!1,function(t){return S(t.APR)}),O("MAY","MAY","70px",!1,function(t){return S(t.MAY)}),O("JUN","JUN","70px",!1,function(t){return S(t.JUN)}),O("JUL","JUL","70px",!1,function(t){return S(t.JUL)}),O("AUG","AGO","70px",!1,function(t){return S(t.AUG)}),O("SEP","SEP","70px",!1,function(t){return S(t.SEP)}),O("OCT","OCT","70px",!1,function(t){return S(t.OCT)}),O("NOV","NOV","70px",!1,function(t){return S(t.NOV)}),O("DEC","DIC","60px",!1,function(t){return S(t.DEC)})]}}}),t.$on("kendoWidgetCreated",function(n,e){void 0!==t.grid&&null!==t.grid||(t.grid=e)}),t.dtOptionsMinimumStandardSummaryProgram0312=i.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(n){return n.customerEvaluationMinimumStandardId=t.currentId,n.year=t.filter.selectedYear?t.filter.selectedYear.value:0,JSON.stringify(n)},url:"api/customer-evaluation-minimum-standard-tracking-0312-summary-cycle",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(t){}}).withDataProp("data").withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withOption("bFilter",!1).withOption("paging",!1).withOption("createdRow",function(n,e,i){o(angular.element(n).contents())(t)}),t.dtColumnsMinimumStandardSummaryProgram0312=[a.newColumn("abbreviation").withTitle("Código").withOption("width",100),a.newColumn("name").withTitle("Ciclo").withOption("width",400),a.newColumn("JAN").withTitle("ENE").withOption("width",200),a.newColumn("FEB").withTitle("FEB").withOption("width",200),a.newColumn("MAR").withTitle("MAR").withOption("width",200),a.newColumn("APR").withTitle("ABR").withOption("width",200),a.newColumn("MAY").withTitle("MAY").withOption("width",200),a.newColumn("JUN").withTitle("JUN").withOption("width",200),a.newColumn("JUL").withTitle("JUL").withOption("width",200),a.newColumn("AUG").withTitle("AGO").withOption("width",200),a.newColumn("SEP").withTitle("SEP").withOption("width",200),a.newColumn("OCT").withTitle("OCT").withOption("width",200),a.newColumn("NOV").withTitle("NOV").withOption("width",200),a.newColumn("DEC").withTitle("DIC").withOption("width",200)],t.dtOptionsMinimumStandardSummaryIndicator0312=i.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(n){return n.customerEvaluationMinimumStandardId=t.currentId,n.year=t.filter.selectedYear?t.filter.selectedYear.value:0,JSON.stringify(n)},url:"api/customer-evaluation-minimum-standard-tracking-0312-summary-indicator",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(t){}}).withDataProp("data").withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withOption("bFilter",!1).withOption("paging",!1).withOption("createdRow",function(n,e,i){o(angular.element(n).contents())(t)}),t.dtColumnsMinimumStandardSummaryIndicator0312=[a.newColumn("indicator").withTitle("Indicador").withOption("width",400),a.newColumn(null).withTitle("ENE").withOption("width",200).renderWith(function(t,n,e,i){return"Promedio Total %"!=t.indicator?S(t.JAN):t.JAN}),a.newColumn(null).withTitle("FEB").withOption("width",200).renderWith(function(t,n,e,i){return"Promedio Total %"!=t.indicator?S(t.FEB):t.FEB}),a.newColumn(null).withTitle("MAR").withOption("width",200).renderWith(function(t,n,e,i){return"Promedio Total %"!=t.indicator?S(t.MAR):t.MAR}),a.newColumn(null).withTitle("ABR").withOption("width",200).renderWith(function(t,n,e,i){return"Promedio Total %"!=t.indicator?S(t.APR):t.APR}),a.newColumn(null).withTitle("MAY").withOption("width",200).renderWith(function(t,n,e,i){return"Promedio Total %"!=t.indicator?S(t.MAY):t.MAY}),a.newColumn(null).withTitle("JUN").withOption("width",200).renderWith(function(t,n,e,i){return"Promedio Total %"!=t.indicator?S(t.JUN):t.JUN}),a.newColumn(null).withTitle("JUL").withOption("width",200).renderWith(function(t,n,e,i){return"Promedio Total %"!=t.indicator?S(t.JUL):t.JUL}),a.newColumn(null).withTitle("AGO").withOption("width",200).renderWith(function(t,n,e,i){return"Promedio Total %"!=t.indicator?S(t.AUG):t.AUG}),a.newColumn(null).withTitle("SEP").withOption("width",200).renderWith(function(t,n,e,i){return"Promedio Total %"!=t.indicator?S(t.SEP):t.SEP}),a.newColumn(null).withTitle("OCT").withOption("width",200).renderWith(function(t,n,e,i){return"Promedio Total %"!=t.indicator?S(t.OCT):t.OCT}),a.newColumn(null).withTitle("NOV").withOption("width",200).renderWith(function(t,n,e,i){return"Promedio Total %"!=t.indicator?S(t.NOV):t.NOV}),a.newColumn(null).withTitle("DIC").withOption("width",200).renderWith(function(t,n,e,i){return"Promedio Total %"!=t.indicator?S(t.DEC):t.DEC})];var S=function(t){return null!=t?parseInt(t):""};t.dtInstanceMinimumStandardSummaryProgram0312Callback=function(n){t.dtInstanceMinimumStandardSummaryProgram0312=n},t.reloadData=function(){t.dtInstanceMinimumStandardSummaryProgram0312.reloadData()},t.dtInstanceMinimumStandardSummaryIndicator0312Callback=function(n){t.dtInstanceMinimumStandardSummaryIndicator0312=n},t.reloadIndicatorData=function(){t.dtInstanceMinimumStandardSummaryIndicator0312.reloadData()},t.onContinue=function(){null!=t.$parent&&t.$parent.navToSection("edit","edit",t.currentId)},t.cancelEdition=function(n){null!=t.$parent&&t.$parent.navToSection("summary","summary",t.currentId)},t.onSelectYear=function(){c(function(){t.reloadData(),t.reloadIndicatorData(),w()})},t.onClearYear=function(){c(function(){t.audit.operation="info",t.audit.standardId=t.currentId,t.audit.year=0,t.filter.selectedYear=null,t.reloadData(),t.reloadIndicatorData(),w()})},t.onSummaryByProgramExportExcel=function(){var e=JSON.stringify({customerId:n.customerId,customerEvaluationMinimumStandardId:t.currentId,year:t.filter.selectedYear?t.filter.selectedYear.value:0});angular.element("#downloadDocument")[0].src="api/customer-evaluation-minimum-standard-tracking-0312-summary-cycle/export-excel?data="+Base64.encode(e)},t.onSummaryByProgramExportPdf=function(){kendo.drawing.drawDOM($(".export-pdf-program-em-0312")).then(function(t){return kendo.drawing.exportPDF(t,{paperSize:"auto",margin:{left:"1cm",top:"1cm",right:"1cm",bottom:"1cm"}})}).done(function(t){kendo.saveAs({dataURI:t,fileName:"EM Reporte Mensual Ciclos.pdf",proxyURL:"//demos.telerik.com/kendo-ui/service/export"})})},t.onSummaryByIndicatorExportExcel=function(){var e=JSON.stringify({customerId:n.customerId,customerEvaluationMinimumStandardId:t.currentId,year:t.filter.selectedYear?t.filter.selectedYear.value:0});angular.element("#downloadDocument")[0].src="api/customer-evaluation-minimum-standard-tracking-0312-summary-indicator/export-excel?data="+Base64.encode(e)},t.onSummaryByIndicatorExportPdf=function(){kendo.drawing.drawDOM($(".export-pdf-indicator-em-0312")).then(function(t){return kendo.drawing.exportPDF(t,{paperSize:"auto",margin:{left:"1cm",top:"1cm",right:"1cm",bottom:"1cm"}})}).done(function(t){kendo.saveAs({dataURI:t,fileName:"EM 0312 Reporte Mensual Indicadores.pdf",proxyURL:"//demos.telerik.com/kendo-ui/service/export"})})}}]);
"use strict";app.controller("customerEvaluationMinimumStandardImport0312Ctrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","SweetAlert","$rootScope","$http","$timeout","$uibModal","flowFactory","cfpLoadingBar","$filter","$document","FileUploader","$localStorage","$aside","ListService",function(t,n,a,i,e,r,o,d,u,l,m,c,s,p,f,w,h,v,S,I,y,M){function g(){var a={customerId:n.customerId,customerEvaluationMinimumStandardId:t.currentId},i=[{name:"customer_evaluation_minimum_stardard_parent_0312",value:null,criteria:a},{name:"customer_evaluation_minimum_stardard_0312",value:null,criteria:a},{name:"customer_evaluation_minimum_stardard_item_0312",value:null,criteria:a}];M.getDataList(i).then(function(n){t.parentList=n.data.data.customerEvaluationMinimumStardardParent,t.standardListAll=n.data.data.customerEvaluationMinimumStardard,t.standardItemListAll=n.data.data.customerEvaluationMinimumStardardItem,O()},function(n){t.status="Unable to load customer data: "+n.message})}console.log("editMode Import",t.$parent.editMode);var b=null;t.isCreate=0==t.$parent.currentId,t.currentId=t.$parent.currentId,t.parentList=[],t.standardList=[],t.standardItemList=[],t.standardListAll=[],t.standardItemListAll=[],g();var L=function(){t.entity={id:t.$parent.currentId?t.$parent.currentId:0,customerEvaluationMinimumStardardParent:null,customerEvaluationMinimumStardard:null,customerEvaluationMinimumStardardItem:null,documentList:[]},null!=b&&b.$setPristine(!0)};L(),t.onSelectParent=function(){O(),t.entity.customerEvaluationMinimumStardard=null,t.entity.customerEvaluationMinimumStardardItem=null,t.reloadData(),t.entity.documentList=[]},t.onSelectStandard=function(){D(),t.entity.customerEvaluationMinimumStardardItem=null,t.reloadData(),t.entity.documentList=[]},t.onSelectStandardItem=function(){t.reloadData(),t.entity.documentList=[]};var O=function(){null!=t.entity.customerEvaluationMinimumStardardParent&&(t.standardList=h("filter")(t.standardListAll,{minimumStandardParentId:t.entity.customerEvaluationMinimumStardardParent.minimumStandardParentId},!0))},D=function(){null!=t.entity.customerEvaluationMinimumStardard&&(t.standardItemList=h("filter")(t.standardItemListAll,{minimumStandardParentId:t.entity.customerEvaluationMinimumStardard.minimumStandardId},!0))};t.form={submit:function(t){b=t;var n=null;if(t.$invalid){var a=null,n=null;for(a in t)"$"!=a[0]&&(null!==n||t[a].$valid||(n=t[a].$name),t[a].$pristine&&(t[a].$dirty=!0));return angular.element(".ng-invalid[name="+n+"]").focus(),void l.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}E()},reset:function(t){t.$setPristine(!0)}};var E=function(){if(null==t.entity.documentList||void 0===t.entity.documentList||0==t.entity.documentList.length)return void l.swal("Información requerida!","Debes seleccionar al menos 1 anexo para importar.","warning");var n={},a=JSON.stringify(t.entity);return n.data=Base64.encode(a),c({method:"POST",url:"api/customer-evaluation-minimum-standard-item-document-0312/import",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(n){l.swal("Registro","La información ha sido importada satisfactoriamente","success"),s(function(){L(),t.reloadData()})})["catch"](function(t){l.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};t.onCancel=function(){null!=t.$parent&&t.$parent.navToSection("summary","summary",t.currentId)},t.dtOptionsMinimumStandardItemDocument0312=i.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(a){return a.customerEvaluationMinimumStandardItemId=t.entity.customerEvaluationMinimumStardardItem?t.entity.customerEvaluationMinimumStardardItem.customerEvaluationMinimumStandardItemId:0,a.customerId=t.entity.customerEvaluationMinimumStardardItem?n.customerId:-1,a.statusCode="2",JSON.stringify(a)},url:"api/customer-evaluation-minimum-standard-item-document-0312-available",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){C()}).withOption("bFilter",!1).withOption("paging",!1).withOption("createdRow",function(n,a,i){o(angular.element(n).contents())(t)}),t.dtColumnsMinimumStandardItemDocument0312=[e.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,n,a,i){var e=t.documentUrl?t.documentUrl:"",r="",o='<a target="_self" class="btn btn-primary btn-xs downloadDocumentRow lnk" uib-tooltip="Descargar anexo" data-id="'+t.id+'" >   <i class="fa fa-download"></i></a> ',d=!0;return""!=e&&(r+=o),d?r:""}),e.newColumn("documentType").withTitle("Tipo de documento").withOption("width",200),e.newColumn("classification").withTitle("Clasificación").withOption("width",200),e.newColumn("description").withTitle("Descripción").withOption("width",200),e.newColumn("version").withTitle("Versión").withOption("width",200),e.newColumn("dateOfCreation").withTitle("Fecha Creación").withOption("width",200).withOption("defaultContent",""),e.newColumn("status").withTitle("Estado").withOption("width",200).renderWith(function(t,n,a,i){var e="";switch(t){case"Vigente":e="label label-success";break;case"Anulado":e="label label-danger"}var r='<span class="'+e+'">'+t+"</span>";return r}),e.newColumn(null).withTitle("Acciones").notSortable().renderWith(function(t,n,a,i){var e="",r="",o='<div class="checkbox clip-check check-success "><input class="checkRow" type="checkbox" id="chk_'+t.id+'" data-id="'+t.id+'" data-value="'+t.selected+'" '+r+' ><label for="chk_'+t.id+'"> Seleccionar </label></div>';return e+=o}).notSortable()];var C=function(){$("#dtMinimumStandardItemDocument0312 a.downloadDocumentRow").on("click",function(){var t=$(this).data("id");angular.element("#download")[0].src="api/customer-document/download?id="+t}),$("input[type=checkbox]").on("change",function(){var n=$(this).data("id"),a=($(this).data("value"),$(this).is(":checked"));a?t.entity.documentList.push({id:n}):t.entity.documentList=h("filter")(t.entity.documentList,{id:"!"+n})})};t.dtInstanceMinimumStandardItemDocument0312Callback=function(n){t.dtInstanceMinimumStandardItemDocument0312=n},t.reloadData=function(){t.dtInstanceMinimumStandardItemDocument0312.reloadData()}}]);
"use strict";app.controller("customerEvaluationMinimumStandardAttachment0312Ctrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","SweetAlert","$rootScope","$http","$timeout","$uibModal","flowFactory","cfpLoadingBar","$filter","$document","FileUploader","$localStorage","$aside","ListService","$ngConfirm",function(n,t,e,o,a,i,r,l,c,u,d,s,m,f,p,h,w,v,g,b,C,A,D){function S(){var e=[{name:"customer_document_type",value:t.customerId}];A.getDataList(e).then(function(t){n.documentType=t.data.data.customerDocumentType},function(t){n.status="Unable to load customer data: "+t.message})}console.log("editMode attachment",n.$parent.editMode),n.isVisible="view"!=n.$parent.editMode;var y=null,T=0;n.currentId=n.$parent.currentId,n.documentClassification=d.parameters("customer_document_classification"),n.documentStatus=d.parameters("customer_document_status"),n.$storage=b.$default({hideMinimumStandardAttachmentCanceled:!0}),S(),n.onCancel=function(){null!=n.$parent&&n.$parent.navToSection("summary","summary",n.currentId)},n.onClear=function(){I()};var I=function(){n.attachment={id:0,customerEvaluationMinimumStandardItemId:0,type:null,classification:null,description:"",status:n.documentStatus?n.documentStatus[0]:null,version:1},y&&y.$setPristine(!0)};I();var O=function(t){var e={id:t};s({method:"GET",url:"api/customer-evaluation-minimum-standard-item-document-0312/get",params:e})["catch"](function(n,t){}).then(function(t){m(function(){n.attachment=t.data.result,n.attachment.version=parseInt(n.attachment.version)+1})})["finally"](function(){})},x=n.uploader=new g({url:"api/customer-evaluation-minimum-standard-item-document-0312/upload",formData:[],removeAfterUpload:!0});x.filters.push({name:"customFilter",fn:function(n,t){return this.queue.length<10}}),x.onWhenAddingFileFailed=function(n,t,e){console.info("onWhenAddingFileFailed",n,t,e)},x.onAfterAddingFile=function(n){console.info("onAfterAddingFile",n)},x.onAfterAddingAll=function(n){console.info("onAfterAddingAll",n)},x.onBeforeUploadItem=function(n){console.info("onBeforeUploadItem",n);var t={id:T};n.formData.push(t)},x.onProgressItem=function(n,t){console.info("onProgressItem",n,t)},x.onProgressAll=function(n){console.info("onProgressAll",n)},x.onSuccessItem=function(n,t,e,o){console.info("onSuccessItem",n,t,e,o)},x.onErrorItem=function(n,t,e,o){console.info("onErrorItem",n,t,e,o)},x.onCancelItem=function(n,t,e,o){console.info("onCancelItem",n,t,e,o)},x.onCompleteItem=function(n,t,e,o){console.info("onCompleteItem",n,t,e,o)},x.onCompleteAll=function(){console.info("onCompleteAll"),n.reloadData(),n.onClear()},n.form={submit:function(n){y=n;var t=null;if(n.$invalid){var e=null,t=null;for(e in n)"$"!=e[0]&&(null!==t||n[e].$valid||(t=n[e].$name),n[e].$pristine&&(n[e].$dirty=!0));return angular.element(".ng-invalid[name="+t+"]").focus(),void u.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}u.swal("Validación exitosa","Procediendo con el guardado...","success"),P()},reset:function(n){n.$setPristine(!0)}};var P=function(){var t={},e=JSON.stringify(n.attachment);return t.data=Base64.encode(e),s({method:"POST",url:"api/customer-evaluation-minimum-standard-item-document-0312/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){m(function(){x.queue.length>0?(T=t.data.result.id,x.uploadAll()):(n.reloadData(),n.onClear())})})["catch"](function(n){u.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){n.reloadData()})};n.dtOptionsMinimumStandardDocument0312=o.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.customerEvaluationMinimumStandardId=n.currentId,n.$storage.hideMinimumStandardAttachmentCanceled&&(t.statusCode="2"),JSON.stringify(t)},url:"api/customer-evaluation-minimum-standard-item-document-0312",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){M()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,e,o){r(angular.element(t).contents())(n)}),n.dtColumnsMinimumStandardDocument0312=[a.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,e,o,a){var i=t.documentUrl?t.documentUrl:"",r="api/customer-evaluation-minimum-standard-item-document-0312/download?id="+t.id,l="",c='<a target="_self" class="btn btn-primary btn-xs downloadDocumentRow lnk" href="'+r+'" uib-tooltip="Descargar anexo" data-id="'+t.id+'" >   <i class="fa fa-download"></i></a> ',u='<a class="btn btn-info btn-xs openDocumentRow lnk" target="_blank" href="'+i+'" uib-tooltip="Abrir anexo" data-id="'+t.id+'" >   <i class="fa fa-folder-open-o"></i></a> ',s='<a class="btn btn-danger btn-xs delDocumentRow lnk" href="#" uib-tooltip="Anular anexo" data-id="'+t.id+'" >   <i class="fa fa-ban"></i></a> ',m=!1;return null==t.protectionType?m=!0:"public"==t.protectionType?m=!0:"private"==t.protectionType&&1==t.hasPermission&&(m=!0),d.can("clientes_anexo_open")&&""!=i&&(l+=u),d.can("clientes_anexo_download")&&""!=i&&(l+=c),d.can("clientes_anexo_invalidate")&&n.isVisible&&"2"!=t.statusCode&&(l+=s),m?l:""}),a.newColumn("documentType").withTitle("Tipo de documento").withOption("width",200),a.newColumn("classification").withTitle("Clasificación").withOption("width",200),a.newColumn("description").withTitle("Descripción").withOption("width",200),a.newColumn("version").withTitle("Versión").withOption("width",200),a.newColumn("createdAt").withTitle("Fecha Creación").withOption("width",200).withOption("defaultContent",""),a.newColumn("status").withTitle("Estado").withOption("width",200).renderWith(function(n,t,e,o){var a="";switch(n){case"Vigente":a="label label-success";break;case"Anulado":a="label label-danger"}var i='<span class="'+a+'">'+n+"</span>";return i})];var M=function(){$("#dtMinimumStandardDocument0312 a.editRow").on("click",function(){var n=$(this).data("id"),t=$(this).data("url");""==t?u.swal("Error en la descarga","No existe un anexo para descargar","error"):jQuery("#downloadDocument")[0].src="api/customer-evaluation-minimum-standard-item-document-0312/download?id="+n}),angular.element("#dtMinimumStandardDocument0312 a.delDocumentRow").on("click",function(){var t=angular.element(this).data("id");D({boxWidth:"35%",useBootstrap:!1,animation:"bottom",closeAnimation:"scale",title:"Está seguro?",content:"<strong>Anulará</strong> el anexo seleccionado",scope:n,type:"red",typeAnimated:!0,buttons:{cancel:{text:"Anular y cambiar versión",btnClass:"btn-primary",action:function(e,o){n.attachment.id=t,n.isView=!1,O(t),l.pop("info","Anulación Anexo","El anexo se cargó satisfactoriamente, seleccione una nueva versión del documento")}},fullCancel:{text:"Anular definitivamente",btnClass:"btn-red",action:function(o,a){var i={};i.id=t,s({method:"POST",url:"api/customer-evaluation-minimum-standard-item-document-0312/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(t){swal("Eliminado","Anexo anulado satisfactoriamente","info"),n.reloadData()})["catch"](function(n){e.error(n),u.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}},closeAll:{text:"Cancelar",btnClass:"btn-default",action:function(n,t){}}}})})};n.dtInstanceMinimumStandardDocument0312Callback=function(t){n.dtInstanceMinimumStandardDocument0312=t},n.reloadData=function(){n.dtInstanceMinimumStandardDocument0312.reloadData()},n.onShowCancelledChange=function(){n.reloadData()}}]);
"use strict";app.controller("customerRoadSafetyTabsCtrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout","$state","$filter","flowFactory","$http",function(t,e,a,s,r,o,i,n,c,u){t.views=[{name:"tab_road_safety_1565",url:r.app.views.urlRoot+"modules/customer/diagnostic/tab-road-safety/1565/customer_road_safety.htm"},{name:"tab_road_safety_40595",url:r.app.views.urlRoot+"modules/customer/diagnostic/tab-road-safety/40595/customer_road_safety.htm"}],t.section=t.views[0],t.isAgent="agent"==r.currentUser().wg_type,t.isAdmin="system"==r.currentUser().wg_type,t.isCustomer="customerAdmin"==r.currentUser().wg_type||"customerUser"==r.currentUser().wg_type,t.tabActive=r.can("road_safety_40595_open")?0:1,t.tabname="tab_road_safety_40595",t.matrixType=t.customer.matrixType,t.getView=function(e){var a=n("filter")(t.views,{name:e});return a[0]},t.switchTab=function(e,a){o(function(){t.tabname=e,t.titletab=a,t.tabsloaded.push(e),t.section=t.getView(e)})},t.switchSubTab=function(e){o(function(){t.subtab=e})}}]);
"use strict";app.controller("customerRoadSafetyCtrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout",function(t,o,a,n,e,r){var c=a;c.info("loading..customerRoadSafety!!! "),t.standard_section="summary",t.currentId=0,t.navToSection=function(o,a,n){r(function(){t.standard_section=o,t.$parent.switchSubTab(a),t.currentId=n})}}]);
"use strict";app.controller("customerRoadSafetySummaryCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","ChartService",function(t,e,a,n,o,r,i,d,u,l,c,s,p,m){function h(){var a={customerId:e.customerId,customerRoadSafetyId:t.currentId},n=[{name:"chart_bar_options",criteria:null},{name:"chart_doughnut_options",criteria:null},{name:"customer_road_safety",criteria:a}];m.getDataChart(n).then(function(e){t.chart.bar.options=e.data.data.chartBarOptions,t.chart.doughnut.options=e.data.data.chartLineOptions,t.chart.programs.data=e.data.data.customerRoadSafetyCycle,t.chart.progress.data=e.data.data.customerRoadSafetyProgress,t.chart.progress.total=e.data.data.customerRoadSafetyAverage,t.currentId=e.data.data.customerRoadSafetyId,t.$parent.currentId=e.data.data.customerRoadSafetyId},function(e){t.status="Unable to load customer data: "+e.message})}t.currentId=0,t.chart={bar:{options:null},doughnut:{options:null},programs:{data:null},progress:{data:null,total:0}},h(),t.dtInstanceRoadSafetySummary={},t.dtOptionsRoadSafetySummary=n.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(a){return a.customer_id=e.customerId,a.road_safety_id=t.currentId,a},url:"api/customer/road-safety/summary",type:"POST",beforeSend:function(){},complete:function(t){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){w()}).withDOM("tr").withOption("language",{}).withOption("createdRow",function(e,a,n){i(angular.element(e).contents())(t)}),t.dtColumnsRoadSafetySummary=[o.newColumn("name").withTitle("Módulo").withOption("width",200),o.newColumn("description").withTitle("Parámetro").withOption("width",400),o.newColumn("items").withTitle("Criterios").withOption("width",200),o.newColumn("checked").withTitle("Evaluados").withOption("width",200),o.newColumn("advance").withTitle("Valor Criterio (%)").withOption("width",200),o.newColumn("total").withTitle("Valoración Items (%)").withOption("width",200),o.newColumn(null).withTitle("Estado").withOption("width",200).renderWith(function(t,e,a,n){var o="label label-danger",r="Sin Iniciar";parseInt(t.checked)==parseInt(t.items)?(r="Completado",o="label label-info"):parseInt(t.checked)>0&&(r="Iniciado",o="label label-success");var i='<span class="'+o+'">'+r+"</span>";return i}).notSortable()],t.dtInstanceRoadSafetySummaryCallback=function(e){t.dtInstanceRoadSafetySummary=e};var w=function(){};t.reloadData=function(){t.dtInstanceRoadSafetySummary.reloadData()},t.dtInstanceRoadSafetySummaryWeighted={},t.dtOptionsRoadSafetySummaryWeighted=n.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(a){return a.customer_id=e.customerId,a.road_safety_id=t.currentId,a},url:"api/customer/road-safety/summary-weighted",type:"POST",beforeSend:function(){},complete:function(t){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){w()}).withOption("footerCallback",function(e,a){a.length>0&&(t.sumTotal=0,t.sumWeightedValue=0,t.$apply(function(){angular.forEach(a,function(e,a){t.sumTotal+=parseFloat(e.result),t.sumWeightedValue+=parseFloat(e.weightedValue)})}))}).withDOM("tr").withOption("language",{}).withOption("createdRow",function(e,a,n){i(angular.element(e).contents())(t)}),t.dtColumnsRoadSafetySummaryWeighted=[o.newColumn("name").withTitle("Módulo").withOption("width",200),o.newColumn("total").withTitle("Valor Obtenido").withOption("width",200),o.newColumn("weightedValue").withTitle("Valoración Ponderado (%)").withOption("width",200),o.newColumn("result").withTitle("Resultado").withOption("width",200)],t.dtInstanceRoadSafetySummaryWeightedCallback=function(e){t.dtInstanceRoadSafetySummaryWeighted=e},t.reloadDataWeighted=function(){t.dtInstanceRoadSafetySummaryWeighted.reloadData()},t.onContinue=function(){null!=t.$parent&&t.$parent.navToSection("edit","edit",t.currentId)},t.onConfig=function(){null!=t.$parent&&t.$parent.navToSection("config","config",t.currentId)},t.onViewReport=function(){null!=t.$parent&&t.$parent.navToSection("report","report",t.currentId)},t.onViewMonthlyReport=function(){null!=t.$parent&&t.$parent.navToSection("monthlyReport","monthlyReport",t.currentId)},t.onSummaryExportPdf=function(){kendo.drawing.drawDOM($(".road-safety-export-pdf")).then(function(t){return kendo.drawing.exportPDF(t,{paperSize:"auto",margin:{left:"1cm",top:"1cm",right:"1cm",bottom:"1cm"}})}).done(function(t){kendo.saveAs({dataURI:t,fileName:"Seguridad-Vial-Auto-Evaluacion.pdf",proxyURL:"//demos.telerik.com/kendo-ui/service/export"})})},t.onSummaryExportExcel=function(){angular.element("#download")[0].src="api/customer/road-safety/summary-export-excel?id="+t.currentId},t.onReportExportPdf=function(){angular.element("#download")[0].src="api/customer/road-safety-item/export-pdf?id="+t.currentId}}]);
"use strict";app.controller("customerRoadSafetyEditCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","SweetAlert","$rootScope","$http","$timeout","$uibModal","flowFactory","cfpLoadingBar","$document","$filter","$aside","FileUploader","ChartService","ListService",function(e,t,n,a,o,i,r,l,c,s,d,u,m,f,p,g,h,w,v,y,b,S){function C(){var n={customerId:t.customerId,customerRoadSafetyId:O},a=[{name:"chart_bar_options",criteria:null},{name:"chart_doughnut_options",criteria:null},{name:"customer_road_safety",criteria:n}];b.getDataChart(a).then(function(t){e.chart.bar.options=t.data.data.chartBarOptions,e.chart.doughnut.options=t.data.data.chartLineOptions,e.chart.programs.data=t.data.data.customerRoadSafetyCycle,e.chart.progress.data=t.data.data.customerRoadSafetyProgress,e.chart.progress.total=t.data.data.customerRoadSafetyAverage},function(t){e.status="Unable to load customer data: "+t.message})}function I(){var t=[{name:"customer_road_safety_cycle",value:O}];S.getDataList(t).then(function(t){e.cycles=t.data.data.customerRoadSafetyCycle,T()},function(t){e.status="Unable to load customer data: "+t.message})}e.currentStep=-1;var O=e.$parent.currentId,x={id:0,code:null};e.chart={bar:{options:null},doughnut:{options:null},programs:{data:null},progress:{data:null,total:0}},C(),I();var D=function(){var n={};n.customer_id=t.customerId,n.road_safety_id=e.$parent.currentId,u({method:"POST",url:"api/customer/road-safety/list-data",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(t){m(function(){e.rateList=t.data.data.rate,e.rateRealList=t.data.data.rateReal})})["catch"](function(e){s.swal("Error Cargando Reportes","Se ha presentado un error durante la consulta de los reportes para el diagnóstico por favor intentelo de nuevo","error")})["finally"](function(){})};D();var T=function(){if(0==x.id){var t=w("filter")(e.cycles,function(e){return parseFloat(e.advance)<100});e.currentStep=t.length>0?e.cycles.indexOf(t[0]):e.cycles.length-1,x.id=e.cycles[e.currentStep].id,x.code=e.cycles[e.currentStep].abbreviation,e.grid.dataSource.read()}},P=function(){I(),C(),e.grid.dataSource.read()};m(function(){e.mainGridOptions={dataSource:{type:"odata",transport:{read:{url:"api/customer-road-safety-item",dataType:"json",type:"POST",data:function(){var e={customerRoadSafetyId:O,cycleId:x.id,isDeleted:0};return e}},parameterMap:function(e,t){return JSON.stringify(e)}},schema:{model:{id:"id",fields:{description:{editable:!1,nullable:!0},documentNumber:{editable:!1,nullable:!0},businessName:{editable:!1,nullable:!0},isActive:{editable:!1,nullable:!0,type:"boolean"}}},data:function(e){return e.data||e},total:function(e){return e.recordsTotal||e.data.length||0}},pageSize:10,serverPaging:!0,serverFiltering:!0,serverSorting:!0},sortable:{mode:"multiple"},pageable:{change:function(e){}},filterable:{mode:"row"},dataBound:function(e){},columns:[{field:"description",title:"Variable",attributes:{"class":"text-orange text-large"},filterable:{cell:{operator:"contains",suggestionOperator:"contains"}}},{field:null,title:"Avance",width:"150px",attributes:{style:"text-align: center"},filterable:!1,template:function(e){var t='<h4 class="no-margin">'+e.advance+"%</h4>";return t+='<uib-progressbar value="'+e.advance+'" class="progress-xs no-radius no-margin" type="success"></uib-progressbar>',t+=e.checked+" de "+e.items}},{field:null,title:"Promedio",width:"150px",attributes:{style:"text-align: center"},filterable:!1,template:function(e){var t='<h4 class="no-margin">'+e.average+"%</h4>";return t+='<uib-progressbar value="'+e.total+'" class="progress-xs no-radius no-margin" type="success"></uib-progressbar>',t+="Promedio Total"}}]},e.detailGridOptions=function(e){return{dataSource:{type:"odata",transport:{read:{url:"api/customer-road-safety-item-question",dataType:"json",type:"POST",data:function(){var t={customerRoadSafetyId:O,cycleId:x.id,roadSafetyId:e.id,isDeleted:0};return t}},parameterMap:function(e,t){return JSON.stringify(e)}},requestEnd:function(e){},schema:{model:{id:"id",fields:{criterion:{editable:!1,nullable:!0},numeral:{editable:!1,nullable:!0},rate:{editable:!1,nullable:!0}}},data:function(e){return e.data||e},total:function(e){return e.recordsTotal||e.data.length||0}},serverPaging:!1,serverSorting:!0,serverFiltering:!1,filter:{field:"roadSafetyId",operator:"eq",value:e.id}},editable:!0,scrollable:!1,sortable:!0,pageable:!1,columns:[{command:[{text:" ",template:"<a class='btn btn-dark-azure btn btn-sm' ng-click='onAddVerificationList(dataItem)' uib-tooltip='Lista de verificación' tooltip-placement='right'><i class='fa fa-list'></i></a> "},{text:" ",template:"<a class='btn btn-light-red btn btn-sm' ng-click='onAddComment(dataItem)' uib-tooltip='Comentarios' tooltip-placement='right'><i class='fa fa-comments'></i></a> "},{text:" ",template:"<a class='btn btn-warning btn btn-sm' ng-click='onAddImprovementPlan(dataItem)' uib-tooltip='Plan Mejoramiento' tooltip-placement='right'><i class='fa fa-plus-square'></i></a> "},{text:" ",template:"<a class='btn btn-info btn btn-sm' ng-click='onAddAttachment(dataItem)' uib-tooltip='Anexos' tooltip-placement='right'><i class='fa fa-paperclip'></i></a> "}],width:"160px",headerAttributes:{style:"display: none"}},{field:"criterion",title:"Criterio",headerAttributes:{style:"display: none"}},{field:"numeral",title:"Numeral",width:"150px",headerAttributes:{style:"display: none"}},{field:"rate",title:"Calificación",width:"220px",editor:'<input kendo-drop-down-list k-value-primitive="true" k-options="rateOptions"  />',template:function(e){return e.rate?e.rate.text:"-Seleccionar-"},headerAttributes:{style:"display: none"},attributes:{style:"text-align: center;font-weight: bold;","class":"text-capitalize text-dark"}},{title:"icon",width:"70px",headerAttributes:{style:"display: none"},template:function(e){var t="";switch(e.rateCode){case"nac":t='<i class="fa fa-ban text-yellow text-extra-extra-large"></i>';break;case"nas":t='<i class="fa fa-minus-circle text-danger text-extra-extra-large"></i>';break;case"cp":t='<i class="fa fa-check-circle-o text-green text-extra-extra-large"></i>';break;case"nc":t='<i class="fa fa-circle-o text-red text-extra-extra-large"></i>';break;default:t='<i class="fa fa-question-circle text-orange text-extra-extra-large"></i>'}return t},attributes:{style:"text-align: center;font-weight: bold;"}}]}}}),e.$on("kendoWidgetCreated",function(t,n){void 0!==e.grid&&null!==e.grid||(e.grid=n)}),e.form={next:function(t){if(e.toTheTop(),t.$valid)A();else{var n=null,a=null;for(n in t)"$"!=n[0]&&(null!==a||t[n].$valid||(a=t[n].$name),t[n].$pristine&&(t[n].$dirty=!0));angular.element(".ng-invalid[name="+a+"]").focus(),R()}},prev:function(e){_()},goTo:function(t,n){parseInt(e.currentStep)>parseInt(n)?k(n):t.$valid?k(n):R()},submit:function(){},reset:function(){}};var A=function(){e.currentStep++,x.id=e.cycles[e.currentStep].id,x.code=e.cycles[e.currentStep].abbreviation,e.grid.dataSource.page(1)},_=function(){e.currentStep--,x.id=e.cycles[e.currentStep].id,x.code=e.cycles[e.currentStep].abbreviation,e.grid.dataSource.page(1)},k=function(t){e.currentStep=t,x.id=e.cycles[e.currentStep].id,x.code=e.cycles[e.currentStep].abbreviation,e.grid.dataSource.page(1)},R=function(e){l.pop("error","Error","Por favor complete este ciclo antes de continuar.")};e.onCancel=function(t){null!=e.$parent&&e.$parent.navToSection("summary","summary",O)},e.onAddComment=function(t){var a=v.open({templateUrl:d.app.views.urlRoot+"modules/customer/common/modals/customer_questions_comment_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideCustomerRoadSafetyItemCommentCtrl",scope:e,resolve:{item:function(){return t}}});a.result.then(function(){},function(){n.info("Modal dismissed at: "+new Date)})},e.onAddAttachment=function(t){var a=v.open({templateUrl:d.app.views.urlRoot+"modules/customer/common/modals/customer_document_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideCustomerRoadSafetyItemAttachmentCtrl",scope:e,resolve:{item:function(){return t},isView:function(){return e.isView},cycle:function(){return e.cycles[e.currentStep]}}});a.result.then(function(){},function(){n.info("Modal dismissed at: "+new Date)})},e.onAddImprovementPlan=function(t){var a=v.open({templateUrl:d.app.views.urlRoot+"modules/customer/common/modals/customer_improvement_plan_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideCustomerRoadSafetyItemImprovementPlanCtrl",scope:e,resolve:{item:function(){return t},isView:function(){return e.isView},cycle:function(){return e.cycles[e.currentStep]}}});a.result.then(function(){},function(){n.info("Modal dismissed at: "+new Date)})},e.onAddVerificationList=function(t){var a=v.open({templateUrl:d.app.views.urlRoot+"modules/customer/diagnostic/tab-road-safety/customer_road_safety_items_detail_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideCustomerRoadSafetyItemDetailCtrl",scope:e,resolve:{item:function(){return t},isView:function(){return e.isView}}});a.result.then(function(){P()},function(){n.info("Modal dismissed at: "+new Date)})},e.onSummaryExportPdf=function(){kendo.drawing.drawDOM($(".export-pdf")).then(function(e){return kendo.drawing.exportPDF(e,{paperSize:"auto",margin:{left:"1cm",top:"1cm",right:"1cm",bottom:"1cm"}})}).done(function(e){kendo.saveAs({dataURI:e,fileName:"Seguridad-Vial-Auto-Evaluacion.pdf",proxyURL:"//demos.telerik.com/kendo-ui/service/export"})})},e.onSummaryExportExcel=function(){jQuery("#download")[0].src="api/customer/road-safety-item/export-excel?id="+e.$parent.currentId}}]),app.controller("ModalInstanceSideCustomerRoadSafetyItemAttachmentCtrl",["$stateParams","$rootScope","$scope","$uibModalInstance","cycle","item","$log","$timeout","SweetAlert","isView","$filter","FileUploader","$http","DTColumnBuilder","DTOptionsBuilder","$compile","ListService",function(e,t,n,a,o,i,r,l,c,s,d,u,m,f,p,g,h){function w(){var t=[{name:"customer_document_type",value:e.customerId}];h.getDataList(t).then(function(e){n.documentType=e.data.data.customerDocumentType},function(e){n.status="Unable to load customer data: "+e.message})}var v=0;n.documentClassification=t.parameters("customer_document_classification"),n.documentStatus=t.parameters("customer_document_status"),n.isView=s,w();var y=function(){n.attachment={id:0,customerId:e.customerId,program:o.abbreviation,agent:null,type:null,classification:null,status:n.documentStatus?n.documentStatus[0]:null,version:1,description:""}};y(),n.onCloseModal=function(){a.close(1)},n.onCancel=function(){a.dismiss("cancel")},n.onClear=function(){y()};var b=n.uploader=new u({url:"api/document/upload",formData:[],removeAfterUpload:!0});b.filters.push({name:"customFilter",fn:function(e,t){return this.queue.length<10}}),b.onWhenAddingFileFailed=function(e,t,n){console.info("onWhenAddingFileFailed",e,t,n)},b.onAfterAddingFile=function(e){console.info("onAfterAddingFile",e)},b.onAfterAddingAll=function(e){console.info("onAfterAddingAll",e)},b.onBeforeUploadItem=function(e){console.info("onBeforeUploadItem",e);var t={id:v};e.formData.push(t)},b.onProgressItem=function(e,t){console.info("onProgressItem",e,t)},b.onProgressAll=function(e){console.info("onProgressAll",e)},b.onSuccessItem=function(e,t,n,a){console.info("onSuccessItem",e,t,n,a)},b.onErrorItem=function(e,t,n,a){console.info("onErrorItem",e,t,n,a)},b.onCancelItem=function(e,t,n,a){console.info("onCancelItem",e,t,n,a)},b.onCompleteItem=function(e,t,n,a){console.info("onCompleteItem",e,t,n,a)},b.onCompleteAll=function(){console.info("onCompleteAll"),n.reloadData(),n.onClear()},n.form={submit:function(e){var t=null;if(e.$invalid){var n=null,t=null;for(n in e)"$"!=n[0]&&(null!==t||e[n].$valid||(t=e[n].$name),e[n].$pristine&&(e[n].$dirty=!0));return angular.element(".ng-invalid[name="+t+"]").focus(),void c.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}c.swal("Validación exitosa","Procediendo con el guardado...","success"),S()},reset:function(e){e.$setPristine(!0)}};var S=function(){var e={},t=JSON.stringify(n.attachment);return e.data=Base64.encode(t),m({method:"POST",url:"api/document/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){l(function(){b.queue.length>0?(v=e.data.result.id,b.uploadAll()):(n.reloadData(),n.onClear())})})["catch"](function(e){c.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){n.reloadData()})};n.dtInstanceCustomerDocumentModal={},n.dtOptionsCustomerDocumentModal=p.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.operation="document",t.customerId=e.customerId,t.program=o.abbreviation,t.statusCode="2",JSON.stringify(t)},url:"api/customer-document",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){C()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,t,a){g(angular.element(e).contents())(n)}),n.dtColumnsCustomerDocumentModal=[f.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,n,a,o){var i=e.documentUrl?e.documentUrl:"",r="api/document/download?id="+e.id,l="",c='<a target="_self" class="btn btn-primary btn-xs downloadDocumentRow lnk" href="'+r+'" uib-tooltip="Descargar anexo" data-id="'+e.id+'" >   <i class="fa fa-download"></i></a> ',s='<a class="btn btn-info btn-xs openDocumentRow lnk" target="_blank" href="'+i+'" uib-tooltip="Abrir anexo" data-id="'+e.id+'" >   <i class="fa fa-folder-open-o"></i></a> ',d=!1;return null==e.protectionType?d=!0:"public"==e.protectionType?d=!0:"private"==e.protectionType&&1==e.hasPermission&&(d=!0),t.can("clientes_anexo_open")&&""!=i&&(l+=s),t.can("clientes_anexo_download")&&""!=i&&(l+=c),d?l:""}),f.newColumn("documentType").withTitle("Tipo de documento").withOption("width",200),f.newColumn("classification").withTitle("Clasificación").withOption("width",200),f.newColumn("description").withTitle("Descripción").withOption("width",200),f.newColumn("version").withTitle("Versión").withOption("width",200),f.newColumn("dateOfCreation").withTitle("Fecha Creación").withOption("width",200).withOption("defaultContent",""),f.newColumn("status").withTitle("Estado").withOption("width",200).renderWith(function(e,t,n,a){var o="";switch(e){case"Vigente":o="label label-success";break;case"Anulado":o="label label-danger"}var i='<span class="'+o+'">'+e+"</span>";return i})];var C=function(){$("#dtCustomerDocumentModal a.editRow").on("click",function(){var e=$(this).data("id"),t=$(this).data("url");""==t?c.swal("Error en la descarga","No existe un anexo para descargar","error"):jQuery("#downloadDocument")[0].src="api/document/download?id="+e})};n.dtInstanceCustomerDocumentModalCallback=function(e){n.dtInstanceCustomerDocumentModal=e},n.reloadData=function(){n.dtInstanceCustomerDocumentModal.reloadData()}}]),app.controller("ModalInstanceSideCustomerRoadSafetyItemImprovementPlanCtrl",["$stateParams","$rootScope","$scope","$uibModalInstance","item","cycle","toaster","$log","$timeout","SweetAlert","isView","$filter","FileUploader","$http","DTOptionsBuilder","DTColumnBuilder","$compile","$document",function(e,t,n,a,o,i,r,l,c,s,d,u,m,f,p,g,h,w){n.maxDate=new Date,n.datePickerConfig={culture:"es-CO",format:"dd/MM/yyyy HH:mm"},n.responsibleList=[],n.typesAlert=u("orderBy")(t.parameters("tracking_alert_type"),"id",!1),n.typesTime=t.parameters("tracking_alert_timeType"),n.statusAlert=t.parameters("tracking_alert_status"),n.preferencesAlert=t.parameters("tracking_alert_preference"),n.typeList=t.parameters("improvement_plan_type");var v=function(){n.improvement={id:0,customerId:e.customerId,classificationName:i.name,classificationId:i.abbreviation,entityName:"SV",entityId:o.id,type:null,endDate:null,description:"",observation:"",responsible:null,isRequiresAnalysis:!1,status:{id:0,value:"CR",item:"Creada"},trackingList:[],alertList:[]}};v(),n.onLoadRecord=function(e){if(0!=e){var t={id:e};f({method:"GET",url:"api/customer/improvement-plan",params:t})["catch"](function(e,t){if(403==t){var n=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";s.swal("No Autorizado","No estas autorizado para ver esta información.","error"),c(function(){$state.go(n)},3e3)}else 404==t?s.swal("Información no disponible","Registro no encontrado","error"):s.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(e){c(function(){null!=e.data.result&&""!=e.data.result&&(n.improvement=e.data.result,S(),r.pop("success","Operación Exitosa","El registro se cargó satisfactoriamente"))},400)})["finally"](function(){})}else n.loading=!1},n.onCloseModal=function(){a.close(1)},n.onCancel=function(){a.dismiss("cancel")},n.onClear=function(){};var y=function(){var t={customer_id:e.customerId};return f({method:"POST",url:"api/customer/improvement-plan/list-data",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(e){c(function(){n.responsibleList=e.data.data.responsible})})["catch"](function(e){s.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};y(),n.form={submit:function(e){var t=null;if(e.$invalid){var a=null,t=null;for(a in e)"$"!=a[0]&&(null!==t||e[a].$valid||(t=e[a].$name),e[a].$pristine&&(e[a].$dirty=!0));return angular.element(".ng-invalid[name="+t+"]").focus(),void s.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}return null==n.improvement.endDate?void r.pop("error","Validación","Debe seleccionar la fecha de cierre"):void b()},reset:function(e){e.$setPristine(!0)}};var b=function(){var e={},t=JSON.stringify(n.improvement);return e.data=Base64.encode(t),f({method:"POST",url:"api/customer/improvement-plan/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){r.pop("success","Operación Exitosa","Registro ingresado satisfactoriamente"),c(function(){v()})})["catch"](function(e){r.pop("error","Ingreso","Ha ocurrido un error. Informar al administrador del sistema")})["finally"](function(){n.reloadData()})},S=function(){null!=n.improvement.endDate&&(n.maxDate=new Date(n.improvement.endDate.date),n.improvement.endDate=new Date(n.improvement.endDate.date)),angular.forEach(n.improvement.trackingList,function(e,t){null!=e.startDate&&(e.startDate=new Date(e.startDate.date))})};n.onAddTracking=function(){c(function(){null==n.improvement.trackingList&&(n.improvement.trackingList=[]),n.improvement.trackingList.push({id:0,customerImprovementPlanId:0,responsible:null,startDate:null})})},n.onRemoveTracking=function(e){s.swal({title:"Está seguro?",text:"Desea confirmar la eliminación de este registro ?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(t){t?c(function(){var t=n.improvement.trackingList[e];if(n.improvement.trackingList.splice(e,1),0!=t.id){var a={};a.id=t.id,f({method:"POST",url:"api/customer/improvement-plan-tracking/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){l.error(e),s.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})},n.onAddAlert=function(){c(function(){null==n.improvement.alertList&&(n.improvement.alertList=[]),n.improvement.alertList.push({id:0,customerImprovementPlanId:0,type:null,preference:null,time:0,timeType:null,status:null})})},n.onRemoveAlert=function(e){s.swal({title:"Está seguro?",text:"Desea confirmar la eliminación de este registro ?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(t){t?c(function(){var t=n.improvement.alertList[e];if(n.improvement.alertList.splice(e,1),0!=t.id){var a={};a.id=t.id,f({method:"POST",url:"api/customer/improvement-plan-alert/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){l.error(e),s.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})},n.dtInstanceImprovementPlan={},n.dtOptionsImprovementPlan=p.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerId=n.improvement.customerId,e.entityId=n.improvement.entityId,e.entityName=n.improvement.entityName,JSON.stringify(e)},url:"api/customer-improvement-plan-entity",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){C()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,t,a){h(angular.element(e).contents())(n)}),n.dtColumnsImprovementPlan=[g.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,a,o,i){var r="",l='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+e.id+'" >   <i class="fa fa-edit"></i></a> ',c='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+e.id+'" >   <i class="fa fa-trash-o"></i></a> ';return t.can("cliente_plan_mejoramiento_edit")&&(r+=l),t.can("cliente_plan_mejoramiento_delete")&&(r+=c),n.isView?null:r}),g.newColumn("origin").withTitle("Origen").withOption("width",200).withOption("defaultContent",""),g.newColumn("classification").withTitle("Clasificación").withOption("width",200).withOption("defaultContent",""),g.newColumn("type").withTitle("Tipo").withOption("width",200).withOption("defaultContent",""),g.newColumn("description").withTitle("Hallazgo").withOption("width",200).withOption("defaultContent",""),g.newColumn("responsibleName").withTitle("Responsable").withOption("defaultContent",""),g.newColumn(null).withTitle("Fecha Cierre").withOption("width",200).renderWith(function(e,t,n,a){return"object"==typeof e.endDate&&null!=e.endDate?moment(e.endDate.date).format("DD/MM/YYYY"):null!=e.endDate?moment(e.endDate).format("DD/MM/YYYY"):""}),g.newColumn(null).withTitle("Estado").withOption("width",200).withOption("defaultContent","").renderWith(function(e,t,n,a){var o="label label-success",i=e.status;switch(e.statusCode){case"AB":o="label label-info";break;case"CO":o="label label-success";break;case"CA":o="label label-danger"}return'<span class="'+o+'">'+i+"</span>"})];var C=function(){$("#dtImprovementPlan a.editRow").on("click",function(){var e=$(this).data("id");n.onLoadRecord(e)}),$("#dtImprovementPlan a.delRow").on("click",function(){var e=$(this).data("id");s.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(t){if(t){var a={};a.id=e,f({method:"POST",url:"api/customer/improvement-plan/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){l.error(e),s.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){n.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};n.dtInstanceImprovementPlanCallback=function(e){n.dtInstanceImprovementPlan=e},n.reloadData=function(){n.dtInstanceImprovementPlan.reloadData()}}]),app.controller("ModalInstanceSideCustomerRoadSafetyItemCommentCtrl",["$stateParams","$rootScope","$scope","$uibModalInstance","item","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile","$document",function(e,t,n,a,o,i,r,l,c,s,d,u,m,f,p,g){var h=function(){n.entity={id:0,customerRoadSafetyItemId:o.id,comment:""}};h(),n.onCloseModal=function(){a.close(1)},n.onCancel=function(){a.dismiss("cancel")},n.onClear=function(){h()},n.form={submit:function(e){var t=null;if(e.$invalid){var a=null,t=null;for(a in e)"$"!=a[0]&&(null!==t||e[a].$valid||(t=e[a].$name),e[a].$pristine&&(e[a].$dirty=!0));return angular.element(".ng-invalid[name="+t+"]").focus(),void r(function(){s.pop("error","Error","Por favor verifique los datos requeridos del formulario y vuelva a intentarlo")},500)}n.onSave()},reset:function(e){e.$setPristine(!0)}},n.onSave=function(){var e={},t=JSON.stringify(n.entity);return e.data=Base64.encode(t),c({method:"POST",url:"api/customer/road-safety-item-comment/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){r(function(){s.pop("success","Operación Exitosa","Actualización exitosa."),n.onClear(),n.reloadData()})})["catch"](function(e){s.pop("Error","Error inesperado",e)})["finally"](function(){})},n.dtInstanceQuestionComment={},n.dtOptionsQuestionComment=f.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customer_road_safety_item_id=o.id,e},url:"api/customer/road-safety-item-comment",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,t,a){p(angular.element(e).contents())(n)}),n.dtColumnsQuestionComment=[m.newColumn("comment").withTitle("Comentario"),m.newColumn("user.name").withTitle("Usuario").withOption("width",200).withOption("defaultContent",200),m.newColumn("createdAt").withTitle("Fecha").withOption("width",200).withOption("defaultContent",200)],n.dtInstanceQuestionCommentCallback=function(e){n.dtInstanceQuestionComment=e},n.reloadData=function(){n.dtInstanceQuestionComment.reloadData()}}]),app.controller("ModalInstanceSideCustomerRoadSafetyItemDetailCtrl",["$rootScope","$stateParams","$scope","$uibModalInstance","item","$log","$timeout","SweetAlert","$http","toaster","$filter","$aside","$document","DTColumnBuilder","DTOptionsBuilder","$compile",function(e,t,n,a,o,i,r,l,c,s,d,u,m,f,p,g){var h=i;n.isView=!0,n.optionList=e.parameters("safety_road_detail_option"),n.config={customerId:t.customerId,customerRoadSafetyItemId:o.id,customerRoadSafetyId:o.customerRoadSafetyId,comment:"",rate:null,apply:null,evidence:null,requirement:null,verificationList:[]},n.maxDate=new Date,n.datePickerConfig={culture:"es-CO",format:"dd/MM/yyyy HH:mm"},n.loading=!0,n.onCloseModal=function(e){a.close(e)},n.onCancel=function(){a.dismiss("cancel")};var w=function(){n.roadSafety={id:o.roadSafetyItemId,roadSafety:null,roadSafetyParent:null,numeral:"",description:"",value:0,criterion:"",isActive:!0,legalFrameworkList:[],verificationModeList:[]}};w();var v=function(){var e={};return c({method:"POST",url:"api/road-safety/list-data",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){r(function(){n.parentList=e.data.data.parent,n.roadSafetyListAll=e.data.data.roadSafety,n.rateList=e.data.data.rate})})["catch"](function(e){l.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};v(),n.onLoadRecord=function(){if(n.roadSafety.id){var e={id:n.roadSafety.id};c({method:"GET",url:"api/road-safety-item",params:e})["catch"](function(e,t){if(403==t){var n=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";l.swal("No Autorizado","No estas autorizado para ver esta información.","error"),r(function(){$state.go(n)},3e3)}else 404==t?(l.swal("Información no disponible","Anexo no encontrado","error"),r(function(){$state.go("app.clientes.list")})):l.swal("Error","Se ha presentado un error al intentar acceder a la información del anexo","error")}).then(function(e){r(function(){n.roadSafety=e.data.result})})["finally"](function(){r(function(){n.loading=!1},400)})}},n.onLoadSafetyItem=function(){if(n.config.customerRoadSafetyItemId){var e={id:n.config.customerRoadSafetyItemId};c({method:"GET",url:"api/customer/road-safety-item",params:e})["catch"](function(e,t){if(403==t){var n=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";l.swal("No Autorizado","No estas autorizado para ver esta información.","error"),r(function(){$state.go(n)},3e3)}else 404==t&&(l.swal("Información no disponible","Anexo no encontrado","error"),r(function(){$state.go("app.clientes.list")}))}).then(function(e){r(function(){n.config.rate=e.data.result.rate,n.config.apply=e.data.result.apply,n.config.evidence=e.data.result.evidence,n.config.requirement=e.data.result.requirement})})["finally"](function(){r(function(){n.loading=!1},400)})}},n.onLoadSafetyItem(),n.$watch("roadSafety.roadSafetyParent",function(e,t,a){n.roadSafetyList=[],null==t||angular.equals(e,t)||(n.roadSafety.roadSafety=null),null!=n.roadSafety.roadSafetyParent&&(n.roadSafetyList=d("filter")(n.roadSafetyListAll,{parentId:n.roadSafety.roadSafetyParent.id}))}),n.onLoadRecord(),n.$watch("roadSafety.cycle",function(e,t,a){n.parentList=[],null==t||angular.equals(e,t)||(n.roadSafety.parent=null),null!=n.roadSafety.cycle&&(n.parentList=d("filter")(n.parentListAll,{cycleId:n.roadSafety.cycle.id}))}),n.master=n.config,n.form={submit:function(e){var t=null;if(e.$invalid){var a=null,t=null;for(a in e)"$"!=a[0]&&(null!==t||e[a].$valid||(t=e[a].$name),e[a].$pristine&&(e[a].$dirty=!0));return h.info(n.roadSafety),angular.element(".ng-invalid[name="+t+"]").focus(),void l.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}y()},reset:function(e){n.clear()}};var y=function(){var e={},t=JSON.stringify(n.config);return e.data=Base64.encode(t),c({method:"POST",url:"api/customer/road-safety-item-detail/insert",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){r(function(){s.pop("success","Operación Exitosa","Criterio actualizado correctamente"),n.onCloseModal(e.data.result)})})["catch"](function(e){i.error(e),l.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};n.onSelectApply=function(e,t,a){if(null!=n.config.apply&&"0"==n.config.apply.value){var o=d("filter")(n.optionList,{value:"0"}),i=d("filter")(n.optionList,{value:"1"});o.length>0&&(n.config.evidence=o[0]),i.length>0&&(n.config.requirement=i[0])}b()},n.onSelectEvidence=function(e,t,a){if(null!=n.config.evidence&&"0"==n.config.evidence.value){
var o=d("filter")(n.optionList,{value:"0"});o.length>0&&(n.config.requirement=o[0])}b()},n.onSelectRequirement=function(e,t,n){b()},n.clearApply=function(){n.config.apply=null,b()},n.clearEvidence=function(){n.config.evidence=null,b()},n.clearRequirement=function(){n.config.requirement=null,b()};var b=function(){var e=d("filter")(n.rateList,{code:"cp"}),t=d("filter")(n.rateList,{code:"nc"});n.config.rate=t.length>0?t[0]:null,null!=n.config.requirement&&"1"==n.config.requirement.value&&(n.config.rate=e.length>0?e[0]:null)}}]);
"use strict";app.controller("customerConfigurationRoadSafetyItemListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$aside",function(t,n,a,i,e,o,r,d,l,s,c,u,f,m){var p=a,w={};p.info("loading..configurationRoadSafetyItemItemListCtrl "),t.isNewRoadSafetyItem=!0,w.operation="diagnostic",t.dtInstanceCustomerConfigRoadSafetyItem={},t.dtOptionsCustomerConfigRoadSafetyItem=i.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:w,url:"api/road-safety-item",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){h()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(n,a,i){r(angular.element(n).contents())(t)}),t.dtColumnsCustomerConfigRoadSafetyItem=[e.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,n,a,i){var e="",o="",r='<a class="btn btn-danger btn-xs editRow lnk" href="#" uib-tooltip="Configurar"  data-id="'+t.id+'"'+o+' >   <i class="fa fa-cog"></i></a> ';'<a class="btn btn-danger btn-xs delRow lnk" href="#"  uib-tooltip="Eliminar" data-id="'+t.id+'"'+o+' >   <i class="fa fa-trash-o"></i></a> ';return s.can("diagnostico_continue"),e+=r,s.can("clientes_delete"),e}),e.newColumn("minimumStandard.cycle.name").withTitle("Ciclo").withOption("width",200).withOption("defaultContent",""),e.newColumn("minimumStandard.parent.numeral").withTitle("Numeral (Padre)").withOption("width",200).withOption("defaultContent",""),e.newColumn("minimumStandard.parent.description").withTitle("Estándar (Padre)").withOption("width",200).withOption("defaultContent",""),e.newColumn("minimumStandard.numeral").withTitle("Numeral (Hijo)").withOption("width",200).withOption("defaultContent",""),e.newColumn("minimumStandard.description").withTitle("Estandar (Hijo)").withOption("width",200).withOption("defaultContent",""),e.newColumn("numeral").withTitle("Numeral").withOption("width",200).withOption("defaultContent",""),e.newColumn("description").withTitle("Item").withOption("width",200).withOption("defaultContent",""),e.newColumn("value").withTitle("Valor").withOption("width",200).withOption("defaultContent",""),e.newColumn("isActive").withTitle("Estado").withOption("width",200).renderWith(function(t,n,a,i){var e="",o="";t||1==t?(e="label label-success",o="Activo"):(e="label label-danger",o="Inactivo");var r='<span class="'+e+'">'+o+"</span>";return r})];var h=function(){$("#dtCustomerConfigRoadSafetyItem a.editRow").on("click",function(){var n=$(this).data("id");t.editRoadSafetyItem(n)}),$("#dtCustomerConfigRoadSafetyItem a.delRow").on("click",function(){var n=$(this).data("id");f.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(i){if(i){var e={};e.id=n,u({method:"POST",url:"api/road-safety-item/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){a.error(t),f.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){t.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};t.dtInstanceCustomerConfigRoadSafetyItemCallback=function(n){t.dtInstanceCustomerConfigRoadSafetyItem=n},t.reloadData=function(){t.dtInstanceCustomerConfigRoadSafetyItem.reloadData()},t.editRoadSafetyItem=function(t){g(t)};var g=function(n){var a={id:n?n:0},i=m.open({templateUrl:s.app.views.urlRoot+"modules/customer/diagnostic/tab-road-safety/customer_configuration_minimum_standard_item_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideCustomerConfigurationRoadSafetyItemEditCtrl",scope:t,resolve:{standard:function(){return a}}});i.result.then(function(){t.reloadData()})};t.onReturn=function(){null!=t.$parent&&t.$parent.navToSection("summary","summary",t.$parent.currentId)}}]),app.controller("ModalInstanceSideCustomerConfigurationRoadSafetyItemEditCtrl",["$rootScope","$stateParams","$scope","$uibModalInstance","standard","$log","$timeout","SweetAlert","$http","toaster","$filter","$aside","$document","DTColumnBuilder","DTOptionsBuilder","$compile",function(t,n,a,i,e,o,r,d,l,s,c,u,f,m,p,w){var h=o;a.isView=!0,a.config={customerId:n.customerId,minimumStandardItemId:e.id,verificationList:[]},a.maxDate=new Date,a.datePickerConfig={culture:"es-CO",format:"dd/MM/yyyy HH:mm"},a.loading=!0,a.onCloseModal=function(){i.close(1)},a.onCancel=function(){i.dismiss("cancel")};var g=function(){a.standard={id:e.id,minimumStandard:null,minimumStandardParent:null,numeral:"",description:"",value:0,criterion:"",isActive:!0,legalFrameworkList:[],verificationModeList:[]}};g();var C=function(){var t={};return l({method:"POST",url:"api/road-safety/list-data",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){r(function(){a.parentList=t.data.data.parent,a.standardListAll=t.data.data.standard})})["catch"](function(t){d.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};C();var v=function(){angular.forEach(a.config.verificationList,function(t,n){t.isActive=1==t.isActive})},y=function(){var t={minimum_standard_item_id:e.id,customer_id:n.customerId};return l({method:"POST",url:"api/customer/configuration-road-safety-item-detail/list-data",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){r(function(){a.config.verificationList=t.data.data.verificationList,v()})})["catch"](function(t){d.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};y(),a.onLoadRecord=function(){if(a.standard.id){var t={id:a.standard.id};l({method:"GET",url:"api/road-safety-item",params:t})["catch"](function(t,n){if(403==n){var a=null!==t.message&&void 0!==t.message?t.message:"app.clientes.list";d.swal("No Autorizado","No estas autorizado para ver esta información.","error"),r(function(){$state.go(a)},3e3)}else 404==n?(d.swal("Información no disponible","Anexo no encontrado","error"),r(function(){$state.go("app.clientes.list")})):d.swal("Error","Se ha presentado un error al intentar acceder a la información del anexo","error")}).then(function(t){r(function(){a.standard=t.data.result})})["finally"](function(){r(function(){a.loading=!1},400)})}},a.$watch("standard.minimumStandardParent",function(t,n,i){a.standardList=[],null==n||angular.equals(t,n)||(a.standard.minimumStandard=null),null!=a.standard.minimumStandardParent&&(a.standardList=c("filter")(a.standardListAll,{parentId:a.standard.minimumStandardParent.id}))}),a.onLoadRecord(),a.$watch("standard.cycle",function(t,n,i){a.parentList=[],null==n||angular.equals(t,n)||(a.standard.parent=null),null!=a.standard.cycle&&(a.parentList=c("filter")(a.parentListAll,{cycleId:a.standard.cycle.id}))}),a.master=a.config,a.form={submit:function(t){var n=null;if(t.$invalid){var i=null,n=null;for(i in t)"$"!=i[0]&&(null!==n||t[i].$valid||(n=t[i].$name),t[i].$pristine&&(t[i].$dirty=!0));return h.info(a.standard),angular.element(".ng-invalid[name="+n+"]").focus(),void d.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}d.swal("Validación exitosa","Guardando información del centro de trabajo...","success"),S()},reset:function(t){a.clear()}};var S=function(){var t={},n=JSON.stringify(a.config);return t.data=Base64.encode(n),l({method:"POST",url:"api/customer/configuration-road-safety-item-detail/insert",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){r(function(){a.standard=t.data.result})})["catch"](function(t){o.error(t),d.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){a.reloadData()})};a.onSelectAll=function(){angular.forEach(a.config.verificationList,function(t,n){t.isActive=!0})},a.onClearAll=function(){angular.forEach(a.config.verificationList,function(t,n){t.isActive=!1})}}]);
"use strict";app.controller("customerRoadSafetyReportCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert",function(e,t,r,a,o,n,i,d,c,u,l,s,p){var m=r,f={};e.question={rate:null},e.currentId=e.$parent.currentId,f.operation="diagnostic",f.customer_id=t.customerId,f.road_safety_id=e.$parent.currentId,e.rate_id=0,e.categories=[],e.rates=[],e.totalAvg=0;var y=function(){var r={};r.customer_id=t.customerId,r.road_safety_id=e.$parent.currentId,s({method:"POST",url:"api/customer/road-safety/list-data",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(r)}).then(function(t){l(function(){e.cycles=t.data.data.cycle,e.rates=t.data.data.rateReal})})["catch"](function(e){p.swal("Error Cargando Reportes","Se ha presentado un error durante la consulta de los reportes para el diagnóstico por favor intentelo de nuevo","error")})["finally"](function(){})};y(),e.changeRate=function(t,r,a){m.info(t),m.info(r),l(function(){e.rate_id=t.id,v()})};var v=function(){var r={};r.customer_id=t.customerId,r.road_safety_id=e.currentId,r.rate_id=e.rate_id,s({method:"POST",url:"api/customer/road-safety-item-report",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(r)}).then(function(t){e.cycles=t.data.data.roadSafetyList,e.loaded=!0})["catch"](function(e){p.swal("Error Consultando Preguntas","Se ha presentado un error durante la consulta del cuestionario, por favor intentelo de nuevo.","error")})["finally"](function(){})};v(),e.onContinue=function(t){null!=e.$parent&&e.$parent.navToSection("edit","edit",e.currentId)},e.cancelEdition=function(t){null!=e.$parent&&e.$parent.navToSection("summary","summary",e.currentId)},e.clearFilter=function(){e.question={rate:null},e.rate_id=0,v()},e.onSummaryExportPdf=function(){kendo.drawing.drawDOM($("#content")).then(function(e){return kendo.drawing.exportPDF(e,{paperSize:"auto",margin:{left:"1cm",top:"1cm",right:"1cm",bottom:"1cm"}})}).done(function(e){kendo.saveAs({dataURI:e,fileName:"Auto-Evaluacion-Seguridad-Vial-Reporte.pdf",proxyURL:"//demos.telerik.com/kendo-ui/service/export"})})},e.onSummaryExportExcel=function(){jQuery("#downloadDocument")[0].src="api/customer/road-safety-item/export-excel?id="+e.currentId+"&rate="+e.rate_id}}]);
"use strict";app.controller("customerRoadSafetyMonthlyReportCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert",function(t,a,o,e,r,n,i,l,d,u,s,c,m){var p=o;p.info("loading..customerRoadSafetyMonthlyReportCtrl "),t.currentId=t.$parent.currentId,t.request={},t.audit={},t.audit.operation="info",t.audit.roadSafetyId=t.$parent.currentId,t.audit.year=0,t.filter={selectedYear:null},t.years=[],t.dataProgram=null,t.dataEvolutionProgram=null,t.dataEvolutionTotal=null,t.dataEvolutionAvg=null,t.optionsLine={responsive:!0,scaleShowGridLines:!0,scaleGridLineColor:"rgba(0,0,0,.05)",scaleGridLineWidth:1,bezierCurve:!0,bezierCurveTension:.4,pointDot:!0,pointDotRadius:4,pointDotStrokeWidth:1,pointHitDetectionRadius:20,datasetStroke:!0,datasetStrokeWidth:2,datasetFill:!0,onAnimationProgress:function(){},onAnimationComplete:function(){},legendTemplate:'<ul class="tc-chart-js-legend"><% for (var i=0; i<datasets.length; i++){%><li><span style="background-color:<%=datasets[i].strokeColor%>"></span><%if(datasets[i].label){%><%=datasets[i].label%><%}%></li><%}%></ul>'},t.optionsBar={responsive:!0,scaleBeginAtZero:!0,scaleShowGridLines:!0,scaleGridLineColor:"rgba(0,0,0,.05)",scaleGridLineWidth:1,barShowStroke:!0,barStrokeWidth:2,barValueSpacing:5,barDatasetSpacing:1,legendTemplate:'<ul class="tc-chart-js-legend"><% for (var i=0; i<datasets.length; i++){%><li><span style="background-color:<%=datasets[i].fillColor%>"></span><%if(datasets[i].label){%><%=datasets[i].label%><%}%></li><%}%></ul>'};var h=function(){var o={};o.customer_id=a.customerId,o.road_safety_id=t.currentId,c({method:"POST",url:"api/customer/road-safety/list-data",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(a){s(function(){t.cycles=a.data.data.cycle,t.rates=a.data.data.rateReal,t.years=a.data.data.years,t.years.length>0&&(t.filter.selectedYear=t.years[0],t.audit.year=t.filter.selectedYear.value,t.request.data=Base64.encode(JSON.stringify(t.audit)),t.reloadData(),t.reloadIndicatorData(),w())})})["catch"](function(t){m.swal("Error Cargando Reportes","Se ha presentado un error durante la consulta de los reportes para el diagnóstico por favor intentelo de nuevo","error")})["finally"](function(){})};h();var w=function(){var e={};e.customer_id=a.customerId,e.road_safety_id=t.currentId,e.year=t.audit.year,c({method:"POST",url:"api/customer/road-safety/monthly-report",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(a){s(function(){t.dataProgram=a.data.result.report_programs,t.dataEvolutionProgram=a.data.result.line_programs,t.dataEvolutionTotal=a.data.result.line_total,t.dataEvolutionAvg=a.data.result.line_avg,console.log(t.dataProgram),t.datasetEvolutionAvgData=[];for(var o=0;o<a.data.result.line_avg.datasets.length;o++)t.datasetEvolutionAvgData.push({label:a.data.result.line_avg.datasets[o].label,backgroundColor:a.data.result.line_avg.datasets[o].pointColor,hoverBackgroundColor:a.data.result.line_avg.datasets[o].pointColor,data:a.data.result.line_avg.datasets[o].data});t.dataEvolutionAvg={labels:t.dataEvolutionAvg.labels,datasets:t.datasetEvolutionAvgData},t.datasetEvolutionTotalData=[];for(var o=0;o<a.data.result.line_total.datasets.length;o++)t.datasetEvolutionTotalData.push({label:a.data.result.line_total.datasets[o].label,backgroundColor:a.data.result.line_total.datasets[o].pointColor,hoverBackgroundColor:a.data.result.line_total.datasets[o].pointColor,data:a.data.result.line_total.datasets[o].data});t.dataEvolutionTotal={labels:t.dataEvolutionTotal.labels,datasets:t.datasetEvolutionTotalData},t.datasetEvolutionProgramColors=["rgba(92,184,92,0.1)","rgba(224,214,83,0.1)","rgba(247,70,74,0.1)","rgba(70,191,189,0.1)","rgba(56,75,86,0.1)"],t.datasetEvolutionProgramData=[];for(var o=0;o<a.data.result.line_programs.datasets.length;o++)t.datasetEvolutionProgramData.push({label:a.data.result.line_programs.datasets[o].label,backgroundColor:t.datasetEvolutionProgramColors[o],hoverBackgroundColor:t.datasetEvolutionProgramColors[o],data:a.data.result.line_programs.datasets[o].data});t.dataEvolutionProgram={labels:t.dataEvolutionProgram.labels,datasets:t.datasetEvolutionProgramData},t.datasetProgramColors=["#FF6384","#36A2EB","#FFCE56","#8BC34A","#FF5722"],t.datasetProgramData=[];for(var o=0;o<a.data.result.report_programs.datasets.length;o++)t.datasetProgramData.push({label:a.data.result.report_programs.datasets[o].label,backgroundColor:t.datasetProgramColors[o],hoverBackgroundColor:t.datasetProgramColors[o],data:a.data.result.report_programs.datasets[o].data});t.dataProgram={labels:t.dataProgram.labels,datasets:t.datasetProgramData}})})["catch"](function(t){o.error(t),m.swal("Error Cargando Reportes","Se ha presentado un error durante la consulta de los reportes para el diagnóstico por favor intentelo de nuevo","error")})["finally"](function(){})};t.request.data=Base64.encode(JSON.stringify(t.audit)),t.dtInstanceRoadSafetySummaryProgram={},t.dtOptionsRoadSafetySummaryProgram=e.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:t.request,url:"api/customer/road-safety/summary-program",type:"POST",beforeSend:function(){},complete:function(t){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withDOM("tr").withOption("language",{}).withOption("createdRow",function(a,o,e){i(angular.element(a).contents())(t)}),t.dtColumnsRoadSafetySummaryProgram=[r.newColumn("abbreviation").withTitle("Ccde").withOption("width",100),r.newColumn("name").withTitle("Ciclo").withOption("width",400),r.newColumn("ENE").withTitle("ENE").withOption("width",200),r.newColumn("FEB").withTitle("FEB").withOption("width",200),r.newColumn("MAR").withTitle("MAR").withOption("width",200),r.newColumn("ABR").withTitle("ABR").withOption("width",200),r.newColumn("MAY").withTitle("MAY").withOption("width",200),r.newColumn("JUN").withTitle("JUN").withOption("width",200),r.newColumn("JUL").withTitle("JUL").withOption("width",200),r.newColumn("AGO").withTitle("AGO").withOption("width",200),r.newColumn("SEP").withTitle("SEP").withOption("width",200),r.newColumn("OCT").withTitle("OCT").withOption("width",200),r.newColumn("NOV").withTitle("NOV").withOption("width",200),r.newColumn("DIC").withTitle("DIC").withOption("width",200)],t.dtInstanceRoadSafetySummaryIndicator={},t.dtOptionsRoadSafetySummaryIndicator=e.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:t.request,url:"api/customer/road-safety/summary-indicator",type:"POST",beforeSend:function(){},complete:function(t){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withDOM("tr").withOption("language",{}).withOption("createdRow",function(a,o,e){i(angular.element(a).contents())(t)}),t.dtColumnsRoadSafetySummaryIndicator=[r.newColumn("indicator").withTitle("Indicador").withOption("width",400),r.newColumn(null).withTitle("ENE").withOption("width",200).renderWith(function(t,a,o,e){return"Promedio Total %"!=t.indicator?f(t.ENE):t.ENE}),r.newColumn(null).withTitle("FEB").withOption("width",200).renderWith(function(t,a,o,e){return"Promedio Total %"!=t.indicator?f(t.FEB):t.FEB}),r.newColumn(null).withTitle("MAR").withOption("width",200).renderWith(function(t,a,o,e){return"Promedio Total %"!=t.indicator?f(t.MAR):t.MAR}),r.newColumn(null).withTitle("ABR").withOption("width",200).renderWith(function(t,a,o,e){return"Promedio Total %"!=t.indicator?f(t.ABR):t.ABR}),r.newColumn(null).withTitle("MAY").withOption("width",200).renderWith(function(t,a,o,e){return"Promedio Total %"!=t.indicator?f(t.MAY):t.MAY}),r.newColumn(null).withTitle("JUN").withOption("width",200).renderWith(function(t,a,o,e){return"Promedio Total %"!=t.indicator?f(t.JUN):t.JUN}),r.newColumn(null).withTitle("JUL").withOption("width",200).renderWith(function(t,a,o,e){return"Promedio Total %"!=t.indicator?f(t.JUL):t.JUL}),r.newColumn(null).withTitle("AGO").withOption("width",200).renderWith(function(t,a,o,e){return"Promedio Total %"!=t.indicator?f(t.AGO):t.AGO}),r.newColumn(null).withTitle("SEP").withOption("width",200).renderWith(function(t,a,o,e){return"Promedio Total %"!=t.indicator?f(t.SEP):t.SEP}),r.newColumn(null).withTitle("OCT").withOption("width",200).renderWith(function(t,a,o,e){return"Promedio Total %"!=t.indicator?f(t.OCT):t.OCT}),r.newColumn(null).withTitle("NOV").withOption("width",200).renderWith(function(t,a,o,e){return"Promedio Total %"!=t.indicator?f(t.NOV):t.NOV}),r.newColumn(null).withTitle("DIC").withOption("width",200).renderWith(function(t,a,o,e){return"Promedio Total %"!=t.indicator?f(t.DIC):t.DIC})];var f=function(t){return null!=t?parseInt(t):""};t.dtInstanceRoadSafetySummaryProgramCallback=function(a){t.dtInstanceRoadSafetySummaryProgram=a},t.reloadData=function(){t.dtInstanceRoadSafetySummaryProgram.reloadData()},t.dtInstanceRoadSafetySummaryIndicatorCallback=function(a){t.dtInstanceRoadSafetySummaryIndicator=a},t.reloadIndicatorData=function(){t.dtInstanceRoadSafetySummaryIndicator.reloadData()},t.onContinue=function(){null!=t.$parent&&t.$parent.navToSection("edit","edit",t.currentId)},t.cancelEdition=function(a){null!=t.$parent&&t.$parent.navToSection("summary","summary",t.currentId)},t.changeYear=function(a,o){s(function(){t.audit.operation="info",t.audit.roadSafetyId=t.currentId,t.audit.year=a.value,t.request.data=Base64.encode(JSON.stringify(t.audit)),t.reloadData(),t.reloadIndicatorData(),w()})},t.clearYear=function(){s(function(){t.audit.operation="info",t.audit.roadSafetyId=t.currentId,t.audit.year=0,t.request.data=Base64.encode(JSON.stringify(t.audit)),t.filter.selectedYear=null,t.reloadData(),t.reloadIndicatorData(),w()})},t.onSummaryByProgramExportExcel=function(){jQuery("#downloadDocument")[0].src="api/customer/road-safety/summary-program-export?data="+Base64.encode(JSON.stringify(t.audit)),console.log(t.audit)},t.onSummaryByProgramExportPdf=function(){kendo.drawing.drawDOM($(".export-pdf-program")).then(function(t){return kendo.drawing.exportPDF(t,{paperSize:"auto",margin:{left:"1cm",top:"1cm",right:"1cm",bottom:"1cm"}})}).done(function(t){kendo.saveAs({dataURI:t,fileName:"Diagnóstico Reporte Mensual Program.pdf",proxyURL:"//demos.telerik.com/kendo-ui/service/export"})})},t.onSummaryByIndicatorExportExcel=function(){jQuery("#downloadDocument")[0].src="api/customer/road-safety/summary-indicator-export?data="+Base64.encode(JSON.stringify(t.audit))},t.onSummaryByIndicatorExportPdf=function(){kendo.drawing.drawDOM($(".export-pdf-indicator")).then(function(t){return kendo.drawing.exportPDF(t,{paperSize:"auto",margin:{left:"1cm",top:"1cm",right:"1cm",bottom:"1cm"}})}).done(function(t){kendo.saveAs({dataURI:t,fileName:"Diagnóstico Reporte Mensual Indicadores.pdf",proxyURL:"//demos.telerik.com/kendo-ui/service/export"})})}}]);
"use strict";app.controller("customerRoadSafety40595Ctrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout",function(t,o,e,n,c,i){t.safety_road_section="summary",t.currentId=0,t.editMode="continue",t.navToSection=function(o,e,n){i(function(){t.safety_road_section=o,t.$parent.switchSubTab(e),t.currentId=n})},t.setEditMode=function(o){t.editMode=o}}]);
"use strict";app.controller("customerRoadSafetySummary40595Ctrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","ChartService","$uibModal","$document",function(t,n,e,o,a,i,r,l,c,s,u,d,m,p,f,y){function h(){if(t.currentId>0){var e={customerId:n.customerId,customerRoadSafetyId:t.currentId},o=[{name:"chart_bar_options",criteria:null},{name:"chart_doughnut_options",criteria:null},{name:"customer_road_safety_40595",criteria:e}];p.getDataChart(o).then(function(n){t.chart.bar.options=n.data.data.chartBarOptions,t.chart.doughnut.options=n.data.data.chartDoughnutOptions,t.chart.programs.data=n.data.data.customerRoadSafetyCycle,t.chart.progress.data=n.data.data.customerRoadSafetyProgress,t.chart.progress.total=n.data.data.customerRoadSafetyAverage},function(n){t.status="Unable to load customer data: "+n.message})}}t.canShowBody=!1,t.isView="view"==t.$parent.editMode,t.currentId=0,t.misionallyty=null,t.misionallitySize=null,t.chart={bar:{options:null},doughnut:{options:null},programs:{data:null},progress:{data:null,total:0}};var w=function(t){var n=t.split(" ");return n.length>0?n[0]:null},S=function(){t.currentId=t.entity.id,t.misionallyty="M1"==t.entity.misionallity?"Misionalidad 1":"Misionalidad 2",t.misionallitySize=w(t.entity.size.item),t.canShowBody=!0,h(),t.reloadData()},g=function(){t.entity={id:0,customerId:n.customerId,misionallity:null,companySize:null},d({method:"GET",url:"api/customer-road-safety-40595/find",params:{id:t.entity.customerId}})["catch"](function(t,n){}).then(function(n){u(function(){t.entity=n.data.result,t.entity?S():t.onOpenConfigModal()})})["finally"](function(){u(function(){t.loading=!1},400),u(function(){y.scrollTop(40,2e3)})})};g(),t.dtOptionsRoadSafetySummary40595=o.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerId=n.customerId,e.customerRoadSafetyId=t.currentId,JSON.stringify(e)},url:"api/customer-road-safety-40595-summary",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(t){h()}}).withDataProp("data").withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withOption("bFilter",!1).withOption("paging",!1).withOption("createdRow",function(n,e,o){r(angular.element(n).contents())(t)}),t.dtColumnsRoadSafetySummary40595=[a.newColumn("name").withTitle("Ciclo").withOption("width",200),a.newColumn("description").withTitle("Parámetro - Definición").withOption("width",400),a.newColumn("items").withTitle("Variables").withOption("width",200),a.newColumn("checked").withTitle("Evaluados").withOption("width",200),a.newColumn("advance").withTitle("Avance Ciclo (%)").withOption("width",200),a.newColumn("total").withTitle("Valoración Variables (%)").withOption("width",200),a.newColumn(null).withTitle("Estado").withOption("width",200).renderWith(function(t,n,e,o){var a="label label-danger",i="Sin Iniciar";parseInt(t.checked)==parseInt(t.items)?(i="Completado",a="label label-info"):parseInt(t.checked)>0&&(i="Iniciado",a="label label-success");var r='<span class="'+a+'">'+i+"</span>";return r}).notSortable()],t.dtInstanceRoadSafetySummary40595Callback=function(n){t.dtInstanceRoadSafetySummary40595=n},t.reloadData=function(){t.dtInstanceRoadSafetySummary40595&&t.dtInstanceRoadSafetySummary40595.reloadData()},t.onContinue=function(){null!=t.$parent&&t.$parent.navToSection("edit","edit",t.currentId)},t.onImport=function(){null!=t.$parent&&t.$parent.navToSection("import","import",t.currentId)},t.onAttachment=function(){null!=t.$parent&&t.$parent.navToSection("attachment","attachment",t.currentId)},t.onViewReport=function(){null!=t.$parent&&t.$parent.navToSection("report","report",t.currentId)},t.onViewMonthlyReport=function(){null!=t.$parent&&t.$parent.navToSection("monthlyReport","monthlyReport",t.currentId)},t.onExportPdf=function(){u(function(){kendo.drawing.drawDOM($(".minimun-standard-40595-export-pdf")).then(function(t){return kendo.drawing.exportPDF(t,{paperSize:"auto",margin:{left:"1cm",top:"1cm",right:"1cm",bottom:"1cm"}})}).done(function(n){kendo.saveAs({dataURI:n,fileName:"PESV_40595_"+t.entity.misionallity+"_"+t.entity.size.item+".pdf",proxyURL:"//demos.telerik.com/kendo-ui/service/export"})})},200)},t.onExportExcel=function(){var e=JSON.stringify({customerId:n.customerId,customerRoadSafetyId:t.currentId});angular.element("#download")[0].src="api/customer-road-safety-40595-summary/export-excel?data="+Base64.encode(e)},t.onReportExportPdf=function(){var e=JSON.stringify({customerId:n.customerId,customerRoadSafetyId:t.currentId});angular.element("#download")[0].src="api/customer-road-safety-40595/export-pdf?data="+Base64.encode(e)},t.onCancel=function(){null!=t.$parent&&t.$parent.navToSection("list","list",0)},t.onOpenConfigModal=function(){var n=f.open({templateUrl:s.app.views.urlRoot+"modules/customer/diagnostic/tab-road-safety/40595/customer_safety_road_config_modal.htm",placement:"right",size:"lg",backdrop:"static",controller:"ModalInstanceSideCustomerRoadSafetyConfig40595Ctrl",scope:t,keyboard:!1,resolve:{entity:function(){return t.entity},isView:function(){return t.isView}}});n.result.then(function(n){n.isSaved&&(t.entity=n,S())},function(){})}}]),app.controller("ModalInstanceSideCustomerRoadSafetyConfig40595Ctrl",["$stateParams","$rootScope","$scope","entity","isView","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","$filter","$compile","ListService",function(t,n,e,o,a,i,r,l,c,s,u,d,m,p){function f(){var n=[{name:"wg_customer_road_safety_company_size",criteria:{customerId:t.customerId}}];p.getDataList(n).then(function(t){e.originalCompanySizeList=t.data.data.wg_customer_road_safety_company_size,e.onChangeMisionallity(!1)},function(t){e.status="Unable to load customer data: "+t.message})}var y=n.isCustomer(),h=n.isAgent(),w=null;e.isView=!y&&!h&&a,e.originalCompanySizeList=[],e.companySizeList=[];var S=function(){e.entity=o?o:{id:0,customerId:t.customerId,misionallity:null,companySize:null},w=e.entity.size};S(),f(),e.onContinue=function(){e.entity.size=e.entity.isSaved?e.entity.size:w,e.entity.isSaved||(u.pop("warning","Advertencia","No se guardó la configuración. No se generaron cambios"),e.entity.size=w),i.close(e.entity)},e.onClear=function(){S()},e.onChangeMisionallity=function(t){e.entity&&e.entity.misionallity&&(e.companySizeList=e.originalCompanySizeList.filter(function(t){return t.code==e.entity.misionallity}),t&&(e.entity.size=null))},e.form={submit:function(t){var n=null;if(t.$invalid){var o=null,n=null;for(o in t)"$"!=o[0]&&(null!==n||t[o].$valid||(n=t[o].$name),t[o].$pristine&&(t[o].$dirty=!0));return angular.element(".ng-invalid[name="+n+"]").focus(),void l(function(){u.pop("error","Error","Por favor verifique los datos requeridos del formulario y vuelva a intentarlo")},500)}e.onSave()},reset:function(t){t.$setPristine(!0)}},e.onSave=function(){var t={},n=JSON.stringify(e.entity);return t.data=Base64.encode(n),s({method:"POST",url:"api/customer-road-safety-40595/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){l(function(){e.entity=t.data.result,e.entity.isSaved=!0,u.pop("success","Operación Exitosa","Configuración exitosa.")})})["catch"](function(t){u.pop("Error","Error inesperado",t)})["finally"](function(){})}}]);
"use strict";app.controller("customerRoadSafety40595EditCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","SweetAlert","$rootScope","$http","$timeout","$uibModal","flowFactory","cfpLoadingBar","$document","$filter","$aside","FileUploader","ChartService","ListService",function(t,e,n,a,i,o,r,l,c,s,d,u,m,p,f,h,w,v,y,g,b,C){function S(){var n={customerId:e.customerId,customerRoadSafetyId:$},a=[{name:"chart_bar_options",criteria:null},{name:"chart_doughnut_options",criteria:null},{name:"customer_road_safety_40595",criteria:n}];b.getDataChart(a).then(function(e){t.chart.bar.options=e.data.data.chartBarOptions,t.chart.doughnut.options=e.data.data.chartLineOptions,t.chart.programs.data=e.data.data.customerRoadSafetyCycle,t.chart.progress.data=e.data.data.customerRoadSafetyProgress,t.chart.progress.total=e.data.data.customerRoadSafetyAverage},function(e){t.status="Unable to load customer data: "+e.message})}function O(){var n={customerId:e.customerId,customerRoadSafetyId:$},a=[{name:"customer_road_safety_cycle_40595",value:null,criteria:n},{name:"road_safety_rate_40595",value:e.customerId}];C.getDataList(a).then(function(e){t.cycles=e.data.data.customerRoadSafetyCycle,t.rateList=e.data.data.rate,t.rateRealList=e.data.data.rateReal,M()},function(e){t.status="Unable to load customer data: "+e.message})}console.log("editMode",t.$parent.editMode),t.currentStep=-1;var I=n,$=t.$parent.currentId,T={refresh:!0,index:0},D={id:0,code:null},x={model:null},P=function(t){var e=t.split(" ");return e.length>0?e[0]:null},_=function(){t.entity={id:0,customerId:e.customerId,misionallity:null,companySize:null},u({method:"GET",url:"api/customer-road-safety-40595/find",params:{id:t.entity.customerId}})["catch"](function(t,e){}).then(function(e){m(function(){t.entity=e.data.result,t.entity&&(t.currentId=t.entity.id,t.misionallyty="M1"==t.entity.misionallity?"Misionalidad 1":"Misionalidad 2",t.misionallitySize=P(t.entity.size.item))})})["finally"](function(){m(function(){t.loading=!1},400),m(function(){w.scrollTop(40,2e3)})})};_(),t.chart={bar:{options:null},doughnut:{options:null},programs:{data:null},progress:{data:null,total:0}},S(),O();var M=function(){if(0==D.id){var e=v("filter")(t.cycles,function(t){return parseFloat(t.advance)<100});t.currentStep=e.length>0?t.cycles.indexOf(e[0]):t.cycles.length-1,D.id=t.cycles[t.currentStep].id,D.code=t.cycles[t.currentStep].abbreviation,t.grid.dataSource.read()}},R=function(){O(),S(),t.grid.dataSource.read()};m(function(){t.mainGridOptions={dataSource:{type:"odata",transport:{read:{url:"api/customer-road-safety-item-40595",dataType:"json",type:"POST",data:function(){var t={customerRoadSafetyId:$,customerId:e.customerId,cycleId:D.id};return t}},parameterMap:function(t,e){return JSON.stringify(t)}},schema:{model:{id:"id",fields:{description:{editable:!1,nullable:!0}}},data:function(t){return t.data||t},total:function(t){return t.recordsTotal||t.data.length||0}},pageSize:10,serverPaging:!0,serverFiltering:!0,serverSorting:!0},sortable:{mode:"multiple"},pageable:{change:function(t){T.index=t.index,I.info("page.index",T.index)}},filterable:{mode:"row"},dataBound:function(t){this.expandRow(this.tbody.find("tr.k-master-row"))},columns:[{field:"description",title:"Parámetro",attributes:{"class":"text-orange text-large"},filterable:{cell:{operator:"contains",suggestionOperator:"contains"}}},{field:null,title:"Avance",width:"150px",attributes:{style:"text-align: center"},filterable:!1,template:function(t){var e='<h4 class="no-margin">'+t.advance+"%</h4>";return e+='<uib-progressbar value="'+t.advance+'" class="progress-xs no-radius no-margin" type="success"></uib-progressbar>',e+=t.checked+" de "+t.items}},{field:null,title:"Promedio",width:"150px",attributes:{style:"text-align: center"},filterable:!1,template:function(t){var e='<h4 class="no-margin">'+t.average+"%</h4>";return e+='<uib-progressbar value="'+t.total+'" class="progress-xs no-radius no-margin" type="success"></uib-progressbar>',e+="Promedio Total"}}]},t.detailGridOptions=function(t){return{dataSource:{type:"odata",transport:{read:{url:"api/customer-road-safety-item-40595-question",dataType:"json",type:"POST",data:function(){var n={roadSafetyId:t.id,customerRoadSafetyId:$,customerId:e.customerId,cycleId:D.id};return n}},parameterMap:function(t,e){return JSON.stringify(t)}},requestEnd:function(t){},schema:{model:{id:"id",fields:{description:{editable:!1,nullable:!0},numeral:{editable:!1,nullable:!0},rate:{editable:!1,defaultValue:{id:0,text:null,code:null}}}},data:function(t){return t.data||t},total:function(t){return t.recordsTotal||t.data.length||0}},serverPaging:!1,serverSorting:!1,serverFiltering:!1,filter:{field:"cycleId",operator:"eq",value:t.cycle_id}},editable:"incell",edit:function(t){x.model=t.model},scrollable:!1,sortable:!1,pageable:!1,columns:[{command:[{text:" ",template:"<a class='btn btn-dark-azure btn btn-sm' ng-click='onAddVerificationList(dataItem)' uib-tooltip='Lista de verificación' tooltip-placement='right'><i class='fa fa-list'></i></a> "},{text:" ",template:"<a class='btn btn-light-red btn btn-sm' ng-click='onAddComment(dataItem)' uib-tooltip='Comentarios' tooltip-placement='right'><i class='fa fa-comments'></i></a> "},{text:" ",template:"<a class='btn btn-warning btn btn-sm' ng-click='onAddImprovementPlan(dataItem)' uib-tooltip='Plan Mejoramiento' tooltip-placement='right'><i class='fa fa-plus-square'></i></a> "},{text:" ",template:"<a class='btn btn-info btn btn-sm' ng-click='onAddAttachment(dataItem)' uib-tooltip='Anexos' tooltip-placement='right'><i class='fa fa-paperclip'></i></a> "}],width:"160px",headerAttributes:{style:"display: none"}},{field:"description",title:"Descripción",headerAttributes:{style:"display: none"}},{field:"numeral",title:"Numeral",width:"150px",headerAttributes:{style:"display: none"},attributes:{style:"text-align: center"}},{field:"rate",title:"Calificación",width:"220px",editor:'<input kendo-drop-down-list k-value-primitive="true" k-options="rateOptions"  />',template:function(t){return t.rate?t.rate.text:"-Seleccionar-"},headerAttributes:{style:"display: none"},attributes:{style:"text-align: center;font-weight: bold;","class":"text-capitalize text-dark"}},{title:"icon",width:"70px",headerAttributes:{style:"display: none"},template:function(t){var e="";switch(t.rateCode){case"nac":e='<i class="fa fa-ban text-yellow text-extra-extra-large"></i>';break;case"nas":e='<i class="fa fa-minus-circle text-danger text-extra-extra-large"></i>';break;case"cp":e='<i class="fa fa-check-circle-o text-green text-extra-extra-large"></i>';break;case"nc":e='<i class="fa fa-circle-o text-red text-extra-extra-large"></i>';break;default:e='<i class="fa fa-question-circle text-orange text-extra-extra-large"></i>'}return e},attributes:{style:"text-align: center;font-weight: bold;"}}]}}}),t.$on("kendoWidgetCreated",function(e,n){void 0!==t.grid&&null!==t.grid||(t.grid=n)}),t.form={next:function(e){if(t.toTheTop(),e.$valid)k();else{var n=null,a=null;for(n in e)"$"!=n[0]&&(null!==a||e[n].$valid||(a=e[n].$name),e[n].$pristine&&(e[n].$dirty=!0));angular.element(".ng-invalid[name="+a+"]").focus(),B()}},prev:function(t){A()},goTo:function(e,n){parseInt(t.currentStep)>parseInt(n)?E(n):e.$valid?E(n):B()},submit:function(){},reset:function(){}};var k=function(){t.currentStep++,D.id=t.cycles[t.currentStep].id,D.code=t.cycles[t.currentStep].abbreviation,t.grid.dataSource.page(1)},A=function(){t.currentStep--,D.id=t.cycles[t.currentStep].id,D.code=t.cycles[t.currentStep].abbreviation,t.grid.dataSource.page(1)},E=function(e){t.currentStep=e,D.id=t.cycles[t.currentStep].id,D.code=t.cycles[t.currentStep].abbreviation,t.grid.dataSource.page(1)},B=function(t){l.pop("error","Error","Por favor complete este ciclo antes de continuar.")};t.onCancel=function(e){null!=t.$parent&&t.$parent.navToSection("summary","summary",$)},t.onAddComment=function(e){var a=y.open({templateUrl:d.app.views.urlRoot+"modules/customer/common/modals/customer_questions_comment_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideCustomerRoadSafetyItemComment40595Ctrl",scope:t,resolve:{dataItem:function(){return e},isView:function(){return"view"==t.$parent.editMode}}});a.result.then(function(){},function(){n.info("Modal dismissed at: "+new Date)})},t.onAddAttachment=function(e){var a=y.open({templateUrl:d.app.views.urlRoot+"modules/customer/diagnostic/tab-road-safety/40595/customer_road_safety_items_document_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideCustomerRoadSafetyItemAttachment40595Ctrl",scope:t,resolve:{dataItem:function(){return e},isView:function(){return"view"==t.$parent.editMode},cycle:function(){return t.cycles[t.currentStep]}}});a.result.then(function(){},function(){n.info("Modal dismissed at: "+new Date)})},t.onAddImprovementPlan=function(e){var a=y.open({templateUrl:d.app.views.urlRoot+"modules/customer/common/modals/customer_improvement_plan_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideCustomerRoadSafetyItemImprovementPlan40595Ctrl",scope:t,resolve:{item:function(){return e},isView:function(){return"view"==t.$parent.editMode},cycle:function(){return t.cycles[t.currentStep]}}});a.result.then(function(){},function(){n.info("Modal dismissed at: "+new Date)})},t.onAddVerificationList=function(e){var a=y.open({templateUrl:d.app.views.urlRoot+"modules/customer/diagnostic/tab-road-safety/40595/customer_road_safety_items_detail_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideCustomerRoadSafetyItemDetail40595Ctrl",scope:t,resolve:{item:function(){return e},cycleList:function(){return t.cycles},isView:function(){return"view"==t.$parent.editMode}}});a.result.then(function(){R()},function(){n.info("Modal dismissed at: "+new Date)})},t.onSummaryExportExcel=function(){var t=JSON.stringify({customerId:e.customerId,customerRoadSafetyId:$});angular.element("#download")[0].src="api/customer-road-safety-item-40595/export-excel?data="+Base64.encode(t)}}]),app.controller("ModalInstanceSideCustomerRoadSafetyItemAttachment40595Ctrl",["$stateParams","$rootScope","$scope","$uibModalInstance","cycle","dataItem","isView","$log","$timeout","SweetAlert","$filter","FileUploader","$http","DTColumnBuilder","DTOptionsBuilder","$compile","ListService",function(t,e,n,a,i,o,r,l,c,s,d,u,m,p,f,h,w){function v(){var e=[{name:"customer_document_type",value:t.customerId}];w.getDataList(e).then(function(t){n.documentType=t.data.data.customerDocumentType},function(t){n.status="Unable to load customer data: "+t.message})}var y=0,g="M",b=e.isCustomer();n.isView=!b&&r,n.documentClassification=e.parameters("customer_document_classification"),n.documentStatus=e.parameters("customer_document_status"),v();var C=function(){n.attachment={id:0,customerRoadSafetyItemId:o.id,type:null,classification:null,description:"",status:n.documentStatus?n.documentStatus[0]:null,version:1,program:i.abbreviation,label:g}};C(),n.onCloseModal=function(){a.close(1)},n.onCancel=function(){a.dismiss("cancel")},n.onClear=function(){C()};var S=n.uploader=new u({url:"api/customer-road-safety-item-document-40595/upload",formData:[],removeAfterUpload:!0});S.filters.push({name:"customFilter",fn:function(t,e){return this.queue.length<10}}),S.onBeforeUploadItem=function(t){var e={id:y};t.formData.push(e)},S.onCompleteAll=function(){n.reloadData(),n.onClear()},n.form={submit:function(t){var e=null;if(t.$invalid){var n=null,e=null;for(n in t)"$"!=n[0]&&(null!==e||t[n].$valid||(e=t[n].$name),t[n].$pristine&&(t[n].$dirty=!0));return angular.element(".ng-invalid[name="+e+"]").focus(),void s.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}s.swal("Validación exitosa","Procediendo con el guardado...","success"),O()},reset:function(t){t.$setPristine(!0)}};var O=function(){g=n.attachment.label;var t={},e=JSON.stringify(n.attachment);return t.data=Base64.encode(e),m({method:"POST",url:"api/customer-road-safety-item-document-40595/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){c(function(){S.queue.length>0?(y=t.data.result.id,S.uploadAll()):(n.reloadData(),n.onClear())})})["catch"](function(t){s.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){n.reloadData()})};n.dtOptionsCustomerDocumentModal=f.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.customerRoadSafetyItemId=o.id,t.statusCode="2",JSON.stringify(t)},url:"api/customer-road-safety-item-document-40595",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){I()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,e,a){h(angular.element(t).contents())(n)}),n.dtColumnsCustomerDocumentModal=[p.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,n,a,i){var o=t.documentUrl?t.documentUrl:"",r="api/customer-road-safety-item-document-40595/download?id="+t.id,l="",c='<a target="_self" class="btn btn-primary btn-xs downloadDocumentRow lnk" href="'+r+'" uib-tooltip="Descargar anexo" data-id="'+t.id+'" >   <i class="fa fa-download"></i></a> ',s='<a class="btn btn-info btn-xs openDocumentRow lnk" target="_blank" href="'+o+'" uib-tooltip="Abrir anexo" data-id="'+t.id+'" >   <i class="fa fa-folder-open-o"></i></a> ',d=!1;return null==t.protectionType?d=!0:"public"==t.protectionType?d=!0:"private"==t.protectionType&&1==t.hasPermission&&(d=!0),e.can("clientes_anexo_open")&&""!=o&&(l+=s),e.can("clientes_anexo_download")&&""!=o&&(l+=c),d?l:""}),p.newColumn("documentType").withTitle("Tipo de documento").withOption("width",200),p.newColumn("classification").withTitle("Clasificación").withOption("width",200),p.newColumn("description").withTitle("Descripción").withOption("width",200),p.newColumn("version").withTitle("Versión").withOption("width",200),p.newColumn("createdAt").withTitle("Fecha Creación").withOption("width",200).withOption("defaultContent",""),p.newColumn("status").withTitle("Estado").withOption("width",200).renderWith(function(t,e,n,a){var i="";switch(t){case"Vigente":i="label label-success";break;case"Anulado":i="label label-danger"}var o='<span class="'+i+'">'+t+"</span>";return o}),p.newColumn("label").withTitle("Origen").withOption("width",200).withOption("defaultContent","")];var I=function(){$("#dtCustomerDocumentModal a.editRow").on("click",function(){var t=$(this).data("id"),e=$(this).data("url");""==e?s.swal("Error en la descarga","No existe un anexo para descargar","error"):jQuery("#downloadDocument")[0].src="api/customer-road-safety-item-document-40595/download?id="+t})};n.dtInstanceCustomerDocumentModalCallback=function(t){n.dtInstanceCustomerDocumentModal=t},n.reloadData=function(){n.dtInstanceCustomerDocumentModal.reloadData()},n.dtOptionsCustomerMinimunStandardItemDocumentModal=f.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerId=t.customerId,e.roadSafetyItemId=o.roadSafetyItemId,e.customerId=t.customerId,e.statusCode="2",JSON.stringify(e)},url:"api/customer-road-safety-item-document-40595-available-previous",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){T()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,e,a){h(angular.element(t).contents())(n)}),n.dtColumnsCustomerMinimunStandardItemDocumentModal=[p.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,n,a,i){var o=t.documentUrl?t.documentUrl:"",r=("api/customer-road-safety-item-document-40595/download?id="+t.id,""),l='<a class="btn btn-success btn-xs addRow lnk" uib-tooltip="Adicionar" data-id="'+t.id+'" >   <i class="fa fa-plus"></i></a> ',c=!1;return null==t.protectionType?c=!0:"public"==t.protectionType?c=!0:"private"==t.protectionType&&1==t.hasPermission&&(c=!0),e.can("clientes_anexo_open")&&""!=o&&(r+=l),c?r:""}),p.newColumn("period").withTitle("Periodo").withOption("width",200),p.newColumn("documentType").withTitle("Tipo de documento").withOption("width",200),p.newColumn("classification").withTitle("Clasificación").withOption("width",200),p.newColumn("description").withTitle("Descripción").withOption("width",200),p.newColumn("version").withTitle("Versión").withOption("width",200),p.newColumn("createdAt").withTitle("Fecha Creación").withOption("width",200).withOption("defaultContent",""),p.newColumn("status").withTitle("Estado").withOption("width",200).renderWith(function(t,e,n,a){var i="";switch(t){case"Vigente":i="label label-success";break;case"Anulado":i="label label-danger"}var o='<span class="'+i+'">'+t+"</span>";return o})];var T=function(){$("#dtCustomerMinimunStandardItemDocumentModal a.addRow").on("click",function(){var t=$(this).data("id");D(t)})};n.dtInstanceCustomerMinimunStandardItemDocumentModalCallback=function(t){n.dtInstanceCustomerMinimunStandardItemDocumentModal=t},n.reloadHistoricalData=function(){n.dtInstanceCustomerMinimunStandardItemDocumentModal.reloadData()};var D=function(t){g=n.attachment.label;var e=JSON.stringify({id:t,customerRoadSafetyItemId:o.id});return m({method:"POST",url:"api/customer-road-safety-item-document-40595/import-historical",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param({data:Base64.encode(e)})}).then(function(t){c(function(){C(),n.reloadHistoricalData(),n.reloadData()})})["catch"](function(t){s.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})}}]),app.controller("ModalInstanceSideCustomerRoadSafetyItemImprovementPlan40595Ctrl",["$stateParams","$rootScope","$scope","$uibModalInstance","item","cycle","$log","$timeout","SweetAlert","isView","$filter","FileUploader","$http","DTOptionsBuilder","DTColumnBuilder","$compile",function(t,e,n,a,i,o,r,l,c,s,d,u,m,p,f,h){var w=e.isCustomer(),v=e.isAgent();n.isView=!w&&!v&&s,n.maxDate=new Date,n.datePickerConfig={culture:"es-CO",format:"dd/MM/yyyy HH:mm"},n.responsibleList=[],n.typesAlert=d("orderBy")(e.parameters("tracking_alert_type"),"id",!1),n.typesTime=e.parameters("tracking_alert_timeType"),n.statusAlert=e.parameters("tracking_alert_status"),n.preferencesAlert=e.parameters("tracking_alert_preference"),n.typeList=e.parameters("improvement_plan_type");var y=function(){n.improvement={id:0,customerId:t.customerId,classificationName:o.name,classificationId:o.abbreviation,entityName:"PESV_40595",entityId:i.id,type:null,endDate:null,description:"cp"!=i.rateCode?i.comment:null,observation:"",responsible:null,isRequiresAnalysis:!1,status:{id:0,value:"CR",item:"Creada"},trackingList:[],alertList:[],period:i.period}};y(),n.onLoadRecord=function(t){if(0!=t){var e={id:t};m({method:"GET",url:"api/customer/improvement-plan",params:e})["catch"](function(t,e){if(403==e){var n=null!==t.message&&void 0!==t.message?t.message:"app.clientes.list";c.swal("No Autorizado","No estas autorizado para ver esta información.","error"),l(function(){$state.go(n)},3e3)}else 404==e?c.swal("Información no disponible","Registro no encontrado","error"):c.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(t){console.log(t),l(function(){null!=t.data.result&&""!=t.data.result&&(n.improvement=t.data.result,C())},400)})["finally"](function(){})}else n.loading=!1},n.onCloseModal=function(){a.close(1)},n.onCancel=function(){a.dismiss("cancel")},n.onClear=function(){};var g=function(){var e={customer_id:t.customerId};return m({method:"POST",url:"api/customer/improvement-plan/list-data",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(t){l(function(){n.responsibleList=t.data.data.responsible})})["catch"](function(t){c.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};g(),n.master=n.improvement,n.form={submit:function(t){var e=null;if(t.$invalid){var n=null,e=null;for(n in t)"$"!=n[0]&&(null!==e||t[n].$valid||(e=t[n].$name),t[n].$pristine&&(t[n].$dirty=!0));return angular.element(".ng-invalid[name="+e+"]").focus(),void c.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}c.swal("Validación exitosa","Procediendo con el guardado...","success"),b()},reset:function(t){n.improvement=angular.copy(n.master),t.$setPristine(!0)}};var b=function(){var t={},e=JSON.stringify(n.improvement);return t.data=Base64.encode(e),m({method:"POST",url:"api/customer/improvement-plan/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){l(function(){y()})})["catch"](function(t){c.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){n.reloadData()})},C=function(){null!=n.improvement.endDate&&(n.improvement.endDate=new Date(n.improvement.endDate.date)),angular.forEach(n.improvement.trackingList,function(t,e){null!=t.startDate&&(t.startDate=new Date(t.startDate.date))})};n.onAddTracking=function(){l(function(){null==n.improvement.trackingList&&(n.improvement.trackingList=[]),n.improvement.trackingList.push({id:0,customerImprovementPlanId:0,responsible:null,startDate:null})})},n.onRemoveTracking=function(t){c.swal({title:"Está seguro?",text:"Desea confirmar la eliminación de este registro ?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(e){e?l(function(){var e=n.improvement.trackingList[t];if(n.improvement.trackingList.splice(t,1),0!=e.id){var a={};a.id=e.id,m({method:"POST",url:"api/customer/improvement-plan-tracking/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){r.error(t),c.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})},n.onAddAlert=function(){l(function(){null==n.improvement.alertList&&(n.improvement.alertList=[]),n.improvement.alertList.push({id:0,customerImprovementPlanId:0,type:null,preference:null,time:0,timeType:null,status:null})})},n.onRemoveAlert=function(t){c.swal({title:"Está seguro?",text:"Desea confirmar la eliminación de este registro ?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(e){e?l(function(){var e=n.improvement.alertList[t];if(n.improvement.alertList.splice(t,1),0!=e.id){var a={};a.id=e.id,m({method:"POST",url:"api/customer/improvement-plan-alert/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){r.error(t),c.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})},n.dtInstanceImprovementPlan={},n.dtOptionsImprovementPlan=p.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.customerId=n.improvement.customerId,t.entityId=n.improvement.entityId,t.entityName=n.improvement.entityName,JSON.stringify(t)},url:"api/customer-improvement-plan-entity",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){S()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,e,a){h(angular.element(t).contents())(n)}),n.dtColumnsImprovementPlan=[f.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,a,i,o){var r="",l='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+t.id+'" >   <i class="fa fa-edit"></i></a> ',c='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+t.id+'" >   <i class="fa fa-trash-o"></i></a> ';return e.can("cliente_plan_mejoramiento_edit")&&(r+=l),e.can("cliente_plan_mejoramiento_delete")&&(r+=c),n.isView?null:r}),f.newColumn("origin").withTitle("Origen").withOption("width",200).withOption("defaultContent",""),f.newColumn("classification").withTitle("Clasificación").withOption("width",200).withOption("defaultContent",""),f.newColumn("type").withTitle("Tipo").withOption("width",200).withOption("defaultContent",""),f.newColumn("description").withTitle("Hallazgo").withOption("width",200).withOption("defaultContent",""),f.newColumn("responsibleName").withTitle("Responsable").withOption("defaultContent",""),f.newColumn(null).withTitle("Fecha Cierre").withOption("width",200).renderWith(function(t,e,n,a){return"object"==typeof t.endDate&&null!=t.endDate?moment(t.endDate.date).format("DD/MM/YYYY"):null!=t.endDate?moment(t.endDate).format("DD/MM/YYYY"):""}),f.newColumn(null).withTitle("Estado").withOption("width",200).withOption("defaultContent","").renderWith(function(t,e,n,a){var i="label label-success",o=t.status;switch(t.statusCode){case"AB":i="label label-info";break;case"CO":i="label label-success";break;case"CA":i="label label-danger"}return'<span class="'+i+'">'+o+"</span>"})];var S=function(){$("#dtImprovementPlan a.editRow").on("click",function(){var t=$(this).data("id");n.onLoadRecord(t)}),$("#dtImprovementPlan a.delRow").on("click",function(){var t=$(this).data("id");c.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(e){if(e){var a={};a.id=t,m({method:"POST",url:"api/customer/improvement-plan/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){r.error(t),c.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){n.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};n.dtInstanceImprovementPlanCallback=function(t){n.dtInstanceImprovementPlan=t},n.reloadData=function(){n.dtInstanceImprovementPlan.reloadData()}}]),app.controller("ModalInstanceSideCustomerRoadSafetyItemComment40595Ctrl",["$stateParams","$rootScope","$scope","$uibModalInstance","dataItem","isView","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile","$document",function(t,e,n,a,i,o,r,l,c,s,d,u,m,p,f,h,w){var v=e.isCustomer(),y=e.isAgent();n.isView=!v&&!y&&o;var g=function(){n.entity={id:0,customerRoadSafetyItemId:i.id,type:"M",comment:""}};g(),n.onCloseModal=function(){a.close(1)},n.onCancel=function(){a.dismiss("cancel")},n.onClear=function(){g()},n.form={submit:function(t){var e=null;if(t.$invalid){var a=null,e=null;for(a in t)"$"!=a[0]&&(null!==e||t[a].$valid||(e=t[a].$name),t[a].$pristine&&(t[a].$dirty=!0));return angular.element(".ng-invalid[name="+e+"]").focus(),void l(function(){d.pop("error","Error","Por favor verifique los datos requeridos del formulario y vuelva a intentarlo")},500)}n.onSave()},reset:function(t){t.$setPristine(!0)}},n.onSave=function(){var t={},e=JSON.stringify(n.entity);return t.data=Base64.encode(e),s({method:"POST",url:"api/customer-road-safety-item-comment-40595/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){l(function(){d.pop("success","Operación Exitosa","Actualización exitosa."),n.onClear(),n.reloadData()})})["catch"](function(t){d.pop("Error","Error inesperado",t)})["finally"](function(){})},n.dtInstanceQuestionComment={},n.dtOptionsQuestionComment=f.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.customerRoadSafetyItemId=i.id,JSON.stringify(t)},url:"api/customer-road-safety-item-comment-40595",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,e,a){h(angular.element(t).contents())(n)}),n.dtColumnsQuestionComment=[p.newColumn("comment").withTitle("Comentario"),p.newColumn("type").withTitle("Tipo").withOption("width",200).withOption("defaultContent",""),p.newColumn("createdBy").withTitle("Usuario").withOption("width",200).withOption("defaultContent",""),p.newColumn("createdAt").withTitle("Fecha").withOption("width",200).withOption("defaultContent","")],n.dtInstanceQuestionCommentCallback=function(t){n.dtInstanceQuestionComment=t},n.reloadData=function(){n.dtInstanceQuestionComment.reloadData()}}]),app.controller("ModalInstanceSideCustomerRoadSafetyItemDetail40595Ctrl",["$rootScope","$stateParams","$scope","$uibModalInstance","cycleList","item","isView","$log","$timeout","SweetAlert","$http","toaster","$filter","$aside","$document","DTColumnBuilder","DTOptionsBuilder","$compile",function(t,e,n,a,i,o,r,l,c,s,d,u,m,p,f,h,w,v){n.isView=!0,n.isVisible=!r,n.cycleList=i,n.loading=!0,n.onCloseModal=function(){a.close(1)},n.onCancel=function(){a.dismiss("cancel")};var y=function(){n.entity={id:o.id}};y();var g=function(){if(n.entity.id){var t={id:n.entity.id};d({method:"GET",url:"api/customer-road-safety-item-40595/get",params:t})["catch"](function(t,e){}).then(function(t){c(function(){n.entity=t.data.result,n.entity.cycle={id:o.cycleId,description:o.cycleDescription},n.entity.description=o.description,n.entity.numeral=o.numeral,n.entity.value=o.value,null==n.entity.realRate&&null==n.entity.rate&&n.onVerificationChange()})})["finally"](function(){})}};g(),n.onVerificationChange=function(){l.info("Verification mode's item has change"),null==n.entity.rate&&(n.entity.comment="",angular.forEach(n.entity.verificationModeList,function(t,e){t.isActive||(n.entity.comment+=t.description+"\n")}),b())},n.onClearRate=function(){n.entity.rate=null,b()};var b=function(){var t=m("filter")(n.entity.verificationModeList,{isActive:!1});null==n.entity.rate?0==t.length?n.entity.realRate=n.rateRealList[0]:t.length<=n.entity.verificationModeList.length&&(n.entity.realRate=n.rateRealList[1]):n.entity.realRate=null};n.onSelectRate=function(){c(function(){n.entity.realRate=null,angular.forEach(n.entity.verificationModeList,function(t,e){t.isActive=!1}),n.entity.comment=null;
})},n.form={submit:function(t){var e=null;if(t.$invalid){var n=null,e=null;for(n in t)"$"!=n[0]&&(null!==e||t[n].$valid||(e=t[n].$name),t[n].$pristine&&(t[n].$dirty=!0));return angular.element(".ng-invalid[name="+e+"]").focus(),void s.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}s.swal("Validación exitosa","Guardando información...","success"),C()},reset:function(t){n.clear()}};var C=function(){var t={},e=JSON.stringify(n.entity);return t.data=Base64.encode(e),d({method:"POST",url:"api/customer-road-safety-item-40595/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){c(function(){n.onCloseModal()})})["catch"](function(t){l.error(t),s.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})}}]);
"use strict";app.controller("customerConfigurationMinimumStandardItem40595ListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$aside",function(t,n,a,i,e,o,r,d,l,s,c,u,f,m){var p=a;p.info("loading..configurationMinimumStandardItemItemListCtrl "),t.isNewMinimumStandardItem=!0,t.dtOptionsCustomerConfigMinimumStandardItem40595=i.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t},url:"api/road-safety-item",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){w()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(n,a,i){r(angular.element(n).contents())(t)}),t.dtColumnsCustomerConfigMinimumStandardItem40595=[e.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,n,a,i){var e="",o="",r='<a class="btn btn-danger btn-xs editRow lnk" href="#" uib-tooltip="Configurar"  data-id="'+t.id+'"'+o+' >   <i class="fa fa-cog"></i></a> ';'<a class="btn btn-danger btn-xs delRow lnk" href="#"  uib-tooltip="Eliminar" data-id="'+t.id+'"'+o+' >   <i class="fa fa-trash-o"></i></a> ';return s.can("diagnostico_continue"),e+=r,s.can("clientes_delete"),e}),e.newColumn("roadSafety.cycle.name").withTitle("Ciclo").withOption("width",200).withOption("defaultContent",""),e.newColumn("roadSafety.parent.numeral").withTitle("Numeral (Padre)").withOption("width",200).withOption("defaultContent",""),e.newColumn("roadSafety.parent.description").withTitle("Estándar (Padre)").withOption("width",200).withOption("defaultContent",""),e.newColumn("roadSafety.numeral").withTitle("Numeral (Hijo)").withOption("width",200).withOption("defaultContent",""),e.newColumn("roadSafety.description").withTitle("Estandar (Hijo)").withOption("width",200).withOption("defaultContent",""),e.newColumn("numeral").withTitle("Numeral").withOption("width",200).withOption("defaultContent",""),e.newColumn("description").withTitle("Item").withOption("width",200).withOption("defaultContent",""),e.newColumn("value").withTitle("Valor").withOption("width",200).withOption("defaultContent",""),e.newColumn("isActive").withTitle("Estado").withOption("width",200).renderWith(function(t,n,a,i){var e="",o="";t||1==t?(e="label label-success",o="Activo"):(e="label label-danger",o="Inactivo");var r='<span class="'+e+'">'+o+"</span>";return r})];var w=function(){$("#dtCustomerConfigMinimumStandardItem40595 a.editRow").on("click",function(){var t=$(this).data("id");h(t)}),$("#dtCustomerConfigMinimumStandardItem40595 a.delRow").on("click",function(){var n=$(this).data("id");f.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(i){if(i){var e={};e.id=n,u({method:"POST",url:"api/road-safety-item/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){a.error(t),f.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){t.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};t.dtInstanceCustomerConfigMinimumStandardItem40595Callback=function(n){t.dtInstanceCustomerConfigMinimumStandardItem40595=n},t.reloadData=function(){t.dtInstanceCustomerConfigMinimumStandardItem40595.reloadData()};var h=function(t){g(t)},g=function(n){var a={id:n?n:0},i=m.open({templateUrl:s.app.views.urlRoot+"modules/customer/diagnostic/tab-road-safety/40595/customer_configuration_road_safety_item_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideCustomerConfigurationMinimumStandardItemEditCtrl",scope:t,resolve:{standard:function(){return a}}});i.result.then(function(){t.reloadData()},function(){})};t.onReturn=function(){null!=t.$parent&&t.$parent.navToSection("summary","summary",t.$parent.currentId)}}]),app.controller("ModalInstanceSideCustomerConfigurationMinimumStandardItem40595EditCtrl",["$rootScope","$stateParams","$scope","$uibModalInstance","standard","$log","$timeout","SweetAlert","$http","toaster","$filter","$aside","$document","DTColumnBuilder","DTOptionsBuilder","$compile",function(t,n,a,i,e,o,r,d,l,s,c,u,f,m,p,w){var h=o;a.isView=!0,a.config={customerId:n.customerId,roadSafetyItemId:e.id,verificationList:[]},a.maxDate=new Date,a.datePickerConfig={culture:"es-CO",format:"dd/MM/yyyy HH:mm"},a.loading=!0,a.onCloseModal=function(){i.close(1)},a.onCancel=function(){i.dismiss("cancel")};var g=function(){a.standard={id:e.id,roadSafety:null,roadSafetyParent:null,numeral:"",description:"",value:0,criterion:"",isActive:!0,legalFrameworkList:[],verificationModeList:[]}};g();var C=function(){var t={};return l({method:"POST",url:"api/road-safety/list-data",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){r(function(){a.parentList=t.data.data.parent,a.standardListAll=t.data.data.standard})})["catch"](function(t){d.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};C();var v=function(){angular.forEach(a.config.verificationList,function(t,n){t.isActive=1==t.isActive})},y=function(){var t={road_safety_item_id:e.id,customer_id:n.customerId};return l({method:"POST",url:"api/customer/configuration-road-safety-item-detail/list-data",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){r(function(){a.config.verificationList=t.data.data.verificationList,v()})})["catch"](function(t){d.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};y(),a.onLoadRecord=function(){if(a.standard.id){var t={id:a.standard.id};l({method:"GET",url:"api/road-safety-item",params:t})["catch"](function(t,n){if(403==n){var a=null!==t.message&&void 0!==t.message?t.message:"app.clientes.list";d.swal("No Autorizado","No estas autorizado para ver esta información.","error"),r(function(){$state.go(a)},3e3)}else 404==n?(d.swal("Información no disponible","Anexo no encontrado","error"),r(function(){$state.go("app.clientes.list")})):d.swal("Error","Se ha presentado un error al intentar acceder a la información del anexo","error")}).then(function(t){r(function(){a.standard=t.data.result})})["finally"](function(){r(function(){a.loading=!1},400)})}},a.$watch("standard.roadSafetyParent",function(t,n,i){a.standardList=[],null==n||angular.equals(t,n)||(a.standard.roadSafety=null),null!=a.standard.roadSafetyParent&&(a.standardList=c("filter")(a.standardListAll,{parentId:a.standard.roadSafetyParent.id}))}),a.onLoadRecord(),a.$watch("standard.cycle",function(t,n,i){a.parentList=[],null==n||angular.equals(t,n)||(a.standard.parent=null),null!=a.standard.cycle&&(a.parentList=c("filter")(a.parentListAll,{cycleId:a.standard.cycle.id}))}),a.master=a.config,a.form={submit:function(t){var n=null;if(t.$invalid){var i=null,n=null;for(i in t)"$"!=i[0]&&(null!==n||t[i].$valid||(n=t[i].$name),t[i].$pristine&&(t[i].$dirty=!0));return h.info(a.standard),angular.element(".ng-invalid[name="+n+"]").focus(),void d.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}d.swal("Validación exitosa","Guardando información del centro de trabajo...","success"),S()},reset:function(t){a.clear()}};var S=function(){var t={},n=JSON.stringify(a.config);return t.data=Base64.encode(n),l({method:"POST",url:"api/customer/configuration-road-safety-item-detail/insert",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){r(function(){a.standard=t.data.result})})["catch"](function(t){o.error(t),d.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){a.reloadData()})};a.onSelectAll=function(){angular.forEach(a.config.verificationList,function(t,n){t.isActive=!0})},a.onClearAll=function(){angular.forEach(a.config.verificationList,function(t,n){t.isActive=!1})}}]);
"use strict";app.controller("customerRoadSafetyReport40595Ctrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","ListService",function(e,t,r,a,o,n,c,d,u,i,l,s,m,f){function p(){var r={customerId:t.customerId,customerRoadSafetyId:e.currentId,rateId:e.filter.selectedRate?e.filter.selectedRate.id:null},a=[{name:"customer_road_safety_report_40595",value:null,criteria:r},{name:"road_safety_rate_40595",value:t.customerId}];f.getDataList(a).then(function(t){e.rates=t.data.data.rateReal,e.cycles=t.data.data.customerRoadSafetyReport},function(t){e.status="Unable to load customer data: "+t.message})}e.filter={selectedRate:null},e.rates=[],e.currentId=e.$parent.currentId,p(),e.onSelectRate=function(){p()},e.onClearRate=function(){e.filter.selectedRate=null,p()},e.onContinue=function(t){null!=e.$parent&&e.$parent.navToSection("edit","edit",e.currentId)},e.cancelEdition=function(t){null!=e.$parent&&e.$parent.navToSection("summary","summary",e.currentId)},e.onSummaryExportPdf=function(){kendo.drawing.drawDOM($(".export-pdf-em-report-40595")).then(function(e){return kendo.drawing.exportPDF(e,{paperSize:"auto",margin:{left:"1cm",top:"1cm",right:"1cm",bottom:"1cm"}})}).done(function(e){kendo.saveAs({dataURI:e,fileName:"Auto-Evaluacion-Estandares-Minimos-Reporte.pdf",proxyURL:"//demos.telerik.com/kendo-ui/service/export"})})},e.onSummaryExportExcel=function(){var r=JSON.stringify({customerId:t.customerId,customerRoadSafetyId:e.currentId,rateId:e.filter.selectedRate?e.filter.selectedRate.id:null});angular.element("#downloadDocument")[0].src="api/customer-road-safety-item-40595/export-excel?data="+Base64.encode(r)}}]);
"use strict";app.controller("customerRoadSafetyMonthlyReport40595Ctrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","ChartService","ListService",function(t,n,e,r,i,a,o,u,d,l,c,m,s,p,f){function h(){var e={customerId:n.customerId,customerRoadSafetyId:t.currentId,year:t.filter.selectedYear?t.filter.selectedYear.value:0},r=[{name:"chart_bar_options",criteria:null},{name:"chart_line_options",criteria:null},{name:"customer_road_safety_monthly_40595",criteria:e}];p.getDataChart(r).then(function(n){t.chart.bar.options=n.data.data.chartBarOptions,t.chart.line.options=n.data.data.chartLineOptions,t.chart.bar.options.legend.position="bottom",t.chart.line.options.legend.position="bottom",t.chart.status.data=n.data.data.customerRoadSafetyMonthlyStatus,t.chart.average.data=n.data.data.customerRoadSafetyMonthlyAverage,t.chart.total.data=n.data.data.customerRoadSafetyMonthlyTotal,t.chart.advance.data=n.data.data.customerRoadSafetyMonthlyAdvance},function(n){t.status="Unable to load customer data: "+n.message})}function w(){var e={customerId:n.customerId,customerRoadSafetyId:t.currentId},r=[{name:"customer_road_safety_year_40595",value:null,criteria:e},{name:"road_safety_rate_40595",value:n.customerId}];f.getDataList(r).then(function(n){t.years=n.data.data.customerRoadSafetyYear,t.years.length>0&&(t.filter.selectedYear=t.years[0],h()),t.canShowDatatable=!0},function(n){t.status="Unable to load customer data: "+n.message})}t.currentId=t.$parent.currentId,t.canShowDatatable=!1,t.chart={bar:{options:null},line:{options:null},status:{data:null},average:{data:null},total:{data:null},advance:{data:null}},w(),t.audit={},t.audit.operation="info",t.audit.year=0,t.audit.standardId=t.currentId,t.filter={selectedYear:null};var y=function(t,n,e,r,i){var a={field:t,title:n,width:e,attributes:{style:"text-align: center"},headerAttributes:{"class":"text-bold"},template:"function"==typeof i?i:null};return void 0===r||r||(a.headerAttributes={style:"display: none"}),a};c(function(){t.mainGridOptions={dataSource:{type:"odata",transport:{read:{url:"api/customer-road-safety-tracking-40595-summary-cycle",dataType:"json",type:"POST",data:function(){var n={customerRoadSafetyId:t.currentId,year:t.filter.selectedYear?t.filter.selectedYear.value:0};return n}},parameterMap:function(t,n){return JSON.stringify(t)}},schema:{model:{id:"id",fields:{description:{editable:!1,nullable:!0}}},data:function(t){return t.data||t},total:function(t){return t.recordsTotal||t.data.length||0}},pageSize:10,serverPaging:!0,serverFiltering:!0,serverSorting:!0},sortable:!1,pageable:!1,filterable:!1,dataBound:function(t){var n=this;this.tbody.find(".k-hierarchy-cell").each(function(){var t=n.dataItem($(this).closest("tr"));"PUNTAJE"==t.abbreviation&&$(this).find("a.k-icon").remove()})},columns:[{field:"name",title:"Ciclo",attributes:{"class":"text-orange text-large"}},y("JAN","ENE","70px",!0,function(t){return null!=t.JAN?t.JAN+" %":""}),y("FEB","FEB","70px",!0,function(t){return null!=t.FEB?t.FEB+" %":""}),y("MAR","MAR","70px",!0,function(t){return null!=t.MAR?t.MAR+" %":""}),y("APR","ABR","70px",!0,function(t){return null!=t.APR?t.APR+" %":""}),y("MAY","MAY","70px",!0,function(t){return null!=t.MAY?t.MAY+" %":""}),y("JUN","JUN","70px",!0,function(t){return null!=t.JUN?t.JUN+" %":""}),y("JUL","JUL","70px",!0,function(t){return null!=t.JUL?t.JUL+" %":""}),y("AUG","AGO","70px",!0,function(t){return null!=t.AUG?t.AUG+" %":""}),y("SEP","SEP","70px",!0,function(t){return null!=t.SEP?t.SEP+" %":""}),y("OCT","OCT","70px",!0,function(t){return null!=t.OCT?t.OCT+" %":""}),y("NOV","NOV","70px",!0,function(t){return null!=t.NOV?t.NOV+" %":""}),y("DEC","DIC","70px",!0,function(t){return null!=t.DEC?t.DEC+" %":""})]},t.detailGridOptions=function(n){return{dataSource:{type:"odata",transport:{read:{url:"api/customer-road-safety-tracking-40595-summary-cycle-detail",dataType:"json",type:"POST",data:function(){var e={customerRoadSafetyId:t.currentId,year:t.filter.selectedYear?t.filter.selectedYear.value:0,cycle:n.cycle};return e}},parameterMap:function(t,n){return JSON.stringify(t)}},requestEnd:function(t){},schema:{model:{id:"id",fields:{indicator:{editable:!1,nullable:!0}}},data:function(t){return t.data||t},total:function(t){return t.recordsTotal||t.data.length||0}},serverPaging:!1,serverSorting:!1,serverFiltering:!1},scrollable:!1,sortable:!1,pageable:!1,columns:[{field:"indicator",title:"Indicador",headerAttributes:{style:"display: none"}},y("JAN","ENE","70px",!1,function(t){return O(t.JAN)}),y("FEB","FEB","70px",!1,function(t){return O(t.FEB)}),y("MAR","MAR","70px",!1,function(t){return O(t.MAR)}),y("APR","ABR","70px",!1,function(t){return O(t.APR)}),y("MAY","MAY","70px",!1,function(t){return O(t.MAY)}),y("JUN","JUN","70px",!1,function(t){return O(t.JUN)}),y("JUL","JUL","70px",!1,function(t){return O(t.JUL)}),y("AUG","AGO","70px",!1,function(t){return O(t.AUG)}),y("SEP","SEP","70px",!1,function(t){return O(t.SEP)}),y("OCT","OCT","70px",!1,function(t){return O(t.OCT)}),y("NOV","NOV","70px",!1,function(t){return O(t.NOV)}),y("DEC","DIC","60px",!1,function(t){return O(t.DEC)})]}}}),t.$on("kendoWidgetCreated",function(n,e){void 0!==t.grid&&null!==t.grid||(t.grid=e)}),t.dtOptionsMinimumStandardSummaryProgram40595=r.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(n){return n.customerRoadSafetyId=t.currentId,n.year=t.filter.selectedYear?t.filter.selectedYear.value:0,JSON.stringify(n)},url:"api/customer-road-safety-tracking-40595-summary-cycle",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(t){}}).withDataProp("data").withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withOption("bFilter",!1).withOption("paging",!1).withOption("createdRow",function(n,e,r){o(angular.element(n).contents())(t)}),t.dtColumnsMinimumStandardSummaryProgram40595=[i.newColumn("abbreviation").withTitle("Código").withOption("width",100),i.newColumn("name").withTitle("Ciclo").withOption("width",400),i.newColumn("JAN").withTitle("ENE").withOption("width",200),i.newColumn("FEB").withTitle("FEB").withOption("width",200),i.newColumn("MAR").withTitle("MAR").withOption("width",200),i.newColumn("APR").withTitle("ABR").withOption("width",200),i.newColumn("MAY").withTitle("MAY").withOption("width",200),i.newColumn("JUN").withTitle("JUN").withOption("width",200),i.newColumn("JUL").withTitle("JUL").withOption("width",200),i.newColumn("AUG").withTitle("AGO").withOption("width",200),i.newColumn("SEP").withTitle("SEP").withOption("width",200),i.newColumn("OCT").withTitle("OCT").withOption("width",200),i.newColumn("NOV").withTitle("NOV").withOption("width",200),i.newColumn("DEC").withTitle("DIC").withOption("width",200)],t.dtOptionsMinimumStandardSummaryIndicator40595=r.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(n){return n.customerRoadSafetyId=t.currentId,n.year=t.filter.selectedYear?t.filter.selectedYear.value:0,JSON.stringify(n)},url:"api/customer-road-safety-tracking-40595-summary-indicator",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(t){}}).withDataProp("data").withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withOption("bFilter",!1).withOption("paging",!1).withOption("createdRow",function(n,e,r){o(angular.element(n).contents())(t)}),t.dtColumnsMinimumStandardSummaryIndicator40595=[i.newColumn("indicator").withTitle("Indicador").withOption("width",400),i.newColumn(null).withTitle("ENE").withOption("width",200).renderWith(function(t,n,e,r){return"Promedio Total %"!=t.indicator?O(t.JAN):t.JAN}),i.newColumn(null).withTitle("FEB").withOption("width",200).renderWith(function(t,n,e,r){return"Promedio Total %"!=t.indicator?O(t.FEB):t.FEB}),i.newColumn(null).withTitle("MAR").withOption("width",200).renderWith(function(t,n,e,r){return"Promedio Total %"!=t.indicator?O(t.MAR):t.MAR}),i.newColumn(null).withTitle("ABR").withOption("width",200).renderWith(function(t,n,e,r){return"Promedio Total %"!=t.indicator?O(t.APR):t.APR}),i.newColumn(null).withTitle("MAY").withOption("width",200).renderWith(function(t,n,e,r){return"Promedio Total %"!=t.indicator?O(t.MAY):t.MAY}),i.newColumn(null).withTitle("JUN").withOption("width",200).renderWith(function(t,n,e,r){return"Promedio Total %"!=t.indicator?O(t.JUN):t.JUN}),i.newColumn(null).withTitle("JUL").withOption("width",200).renderWith(function(t,n,e,r){return"Promedio Total %"!=t.indicator?O(t.JUL):t.JUL}),i.newColumn(null).withTitle("AGO").withOption("width",200).renderWith(function(t,n,e,r){return"Promedio Total %"!=t.indicator?O(t.AUG):t.AUG}),i.newColumn(null).withTitle("SEP").withOption("width",200).renderWith(function(t,n,e,r){return"Promedio Total %"!=t.indicator?O(t.SEP):t.SEP}),i.newColumn(null).withTitle("OCT").withOption("width",200).renderWith(function(t,n,e,r){return"Promedio Total %"!=t.indicator?O(t.OCT):t.OCT}),i.newColumn(null).withTitle("NOV").withOption("width",200).renderWith(function(t,n,e,r){return"Promedio Total %"!=t.indicator?O(t.NOV):t.NOV}),i.newColumn(null).withTitle("DIC").withOption("width",200).renderWith(function(t,n,e,r){return"Promedio Total %"!=t.indicator?O(t.DEC):t.DEC})];var O=function(t){return null!=t?parseInt(t):""};t.dtInstanceMinimumStandardSummaryProgram40595Callback=function(n){t.dtInstanceMinimumStandardSummaryProgram40595=n},t.reloadData=function(){t.dtInstanceMinimumStandardSummaryProgram40595.reloadData()},t.dtInstanceMinimumStandardSummaryIndicator40595Callback=function(n){t.dtInstanceMinimumStandardSummaryIndicator40595=n},t.reloadIndicatorData=function(){t.dtInstanceMinimumStandardSummaryIndicator40595.reloadData()},t.onContinue=function(){null!=t.$parent&&t.$parent.navToSection("edit","edit",t.currentId)},t.cancelEdition=function(n){null!=t.$parent&&t.$parent.navToSection("summary","summary",t.currentId)},t.onSelectYear=function(){c(function(){t.reloadData(),t.reloadIndicatorData(),h()})},t.onClearYear=function(){c(function(){t.audit.operation="info",t.audit.standardId=t.currentId,t.audit.year=0,t.filter.selectedYear=null,t.reloadData(),t.reloadIndicatorData(),h()})},t.onSummaryByProgramExportExcel=function(){var e=JSON.stringify({customerId:n.customerId,customerRoadSafetyId:t.currentId,year:t.filter.selectedYear?t.filter.selectedYear.value:0});angular.element("#downloadDocument")[0].src="api/customer-road-safety-tracking-40595-summary-cycle/export-excel?data="+Base64.encode(e)},t.onSummaryByProgramExportPdf=function(){kendo.drawing.drawDOM($(".export-pdf-program-em-40595")).then(function(t){return kendo.drawing.exportPDF(t,{paperSize:"auto",margin:{left:"1cm",top:"1cm",right:"1cm",bottom:"1cm"}})}).done(function(t){kendo.saveAs({dataURI:t,fileName:"PESV 40595 Reporte Mensual Ciclos.pdf",proxyURL:"//demos.telerik.com/kendo-ui/service/export"})})},t.onSummaryByIndicatorExportExcel=function(){var e=JSON.stringify({customerId:n.customerId,customerRoadSafetyId:t.currentId,year:t.filter.selectedYear?t.filter.selectedYear.value:0});angular.element("#downloadDocument")[0].src="api/customer-road-safety-tracking-40595-summary-indicator/export-excel?data="+Base64.encode(e)},t.onSummaryByIndicatorExportPdf=function(){kendo.drawing.drawDOM($(".export-pdf-indicator-em-40595")).then(function(t){return kendo.drawing.exportPDF(t,{paperSize:"auto",margin:{left:"1cm",top:"1cm",right:"1cm",bottom:"1cm"}})}).done(function(t){kendo.saveAs({dataURI:t,fileName:"PESV 40595 Reporte Mensual Indicadores.pdf",proxyURL:"//demos.telerik.com/kendo-ui/service/export"})})}}]);
"use strict";app.controller("customerRoadSafetyAttachment40595Ctrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","SweetAlert","$rootScope","$http","$timeout","$uibModal","flowFactory","cfpLoadingBar","$filter","$document","FileUploader","$localStorage","$aside","ListService","$ngConfirm",function(t,n,e,o,a,i,r,l,c,s,d,u,m,f,p,h,w,g,v,b,C,y,A){function D(){var e=[{name:"customer_document_type",value:n.customerId}];y.getDataList(e).then(function(n){t.documentType=n.data.data.customerDocumentType},function(n){t.status="Unable to load customer data: "+n.message})}console.log("editMode attachment",t.$parent.editMode),t.isVisible="view"!=t.$parent.editMode;var S=null,T=0;t.currentId=t.$parent.currentId,t.documentClassification=d.parameters("customer_document_classification"),t.documentStatus=d.parameters("customer_document_status"),t.$storage=b.$default({hideMinimumStandardAttachmentCanceled:!0}),D(),t.onCancel=function(){null!=t.$parent&&t.$parent.navToSection("summary","summary",t.currentId)},t.onClear=function(){I()};var I=function(){t.attachment={id:0,customerRoadSafetyItemId:0,type:null,classification:null,description:"",status:t.documentStatus?t.documentStatus[0]:null,version:1},S&&S.$setPristine(!0)};I();var O=function(n){var e={id:n};u({method:"GET",url:"api/customer-road-safety-item-document-40595/get",params:e})["catch"](function(t,n){}).then(function(n){m(function(){t.attachment=n.data.result,t.attachment.version=parseInt(t.attachment.version)+1})})["finally"](function(){})},x=t.uploader=new v({url:"api/customer-road-safety-item-document-40595/upload",formData:[],removeAfterUpload:!0});x.filters.push({name:"customFilter",fn:function(t,n){return this.queue.length<10}}),x.onWhenAddingFileFailed=function(t,n,e){console.info("onWhenAddingFileFailed",t,n,e)},x.onAfterAddingFile=function(t){console.info("onAfterAddingFile",t)},x.onAfterAddingAll=function(t){console.info("onAfterAddingAll",t)},x.onBeforeUploadItem=function(t){console.info("onBeforeUploadItem",t);var n={id:T};t.formData.push(n)},x.onProgressItem=function(t,n){console.info("onProgressItem",t,n)},x.onProgressAll=function(t){console.info("onProgressAll",t)},x.onSuccessItem=function(t,n,e,o){console.info("onSuccessItem",t,n,e,o)},x.onErrorItem=function(t,n,e,o){console.info("onErrorItem",t,n,e,o)},x.onCancelItem=function(t,n,e,o){console.info("onCancelItem",t,n,e,o)},x.onCompleteItem=function(t,n,e,o){console.info("onCompleteItem",t,n,e,o)},x.onCompleteAll=function(){console.info("onCompleteAll"),t.reloadData(),t.onClear()},t.form={submit:function(t){S=t;var n=null;if(t.$invalid){var e=null,n=null;for(e in t)"$"!=e[0]&&(null!==n||t[e].$valid||(n=t[e].$name),t[e].$pristine&&(t[e].$dirty=!0));return angular.element(".ng-invalid[name="+n+"]").focus(),void s.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}s.swal("Validación exitosa","Procediendo con el guardado...","success"),P()},reset:function(t){t.$setPristine(!0)}};var P=function(){var n={},e=JSON.stringify(t.attachment);return n.data=Base64.encode(e),u({method:"POST",url:"api/customer-road-safety-item-document-40595/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(n){m(function(){x.queue.length>0?(T=n.data.result.id,x.uploadAll()):(t.reloadData(),t.onClear())})})["catch"](function(t){s.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){t.reloadData()})};t.dtOptionsMinimumStandardDocument40595=o.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(n){return n.customerRoadSafetyId=t.currentId,t.$storage.hideMinimumStandardAttachmentCanceled&&(n.statusCode="2"),JSON.stringify(n)},url:"api/customer-road-safety-item-document-40595",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){_()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(n,e,o){r(angular.element(n).contents())(t)}),t.dtColumnsMinimumStandardDocument40595=[a.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(n,e,o,a){var i=n.documentUrl?n.documentUrl:"",r="api/customer-road-safety-item-document-40595/download?id="+n.id,l="",c='<a target="_self" class="btn btn-primary btn-xs downloadDocumentRow lnk" href="'+r+'" uib-tooltip="Descargar anexo" data-id="'+n.id+'" >   <i class="fa fa-download"></i></a> ',s='<a class="btn btn-info btn-xs openDocumentRow lnk" target="_blank" href="'+i+'" uib-tooltip="Abrir anexo" data-id="'+n.id+'" >   <i class="fa fa-folder-open-o"></i></a> ',u='<a class="btn btn-danger btn-xs delDocumentRow lnk" href="#" uib-tooltip="Anular anexo" data-id="'+n.id+'" >   <i class="fa fa-ban"></i></a> ',m=!1;return null==n.protectionType?m=!0:"public"==n.protectionType?m=!0:"private"==n.protectionType&&1==n.hasPermission&&(m=!0),d.can("clientes_anexo_open")&&""!=i&&(l+=s),d.can("clientes_anexo_download")&&""!=i&&(l+=c),d.can("clientes_anexo_invalidate")&&t.isVisible&&"2"!=n.statusCode&&(l+=u),m?l:""}),a.newColumn("documentType").withTitle("Tipo de documento").withOption("width",200),a.newColumn("classification").withTitle("Clasificación").withOption("width",200),a.newColumn("description").withTitle("Descripción").withOption("width",200),a.newColumn("version").withTitle("Versión").withOption("width",200),a.newColumn("createdAt").withTitle("Fecha Creación").withOption("width",200).withOption("defaultContent",""),a.newColumn("status").withTitle("Estado").withOption("width",200).renderWith(function(t,n,e,o){var a="";switch(t){case"Vigente":a="label label-success";break;case"Anulado":a="label label-danger"}var i='<span class="'+a+'">'+t+"</span>";return i})];var _=function(){$("#dtMinimumStandardDocument40595 a.editRow").on("click",function(){var t=$(this).data("id"),n=$(this).data("url");""==n?s.swal("Error en la descarga","No existe un anexo para descargar","error"):jQuery("#downloadDocument")[0].src="api/customer-road-safety-item-document-40595/download?id="+t}),angular.element("#dtMinimumStandardDocument40595 a.delDocumentRow").on("click",function(){var n=angular.element(this).data("id");A({boxWidth:"35%",useBootstrap:!1,animation:"bottom",closeAnimation:"scale",title:"Está seguro?",content:"<strong>Anulará</strong> el anexo seleccionado",scope:t,type:"red",typeAnimated:!0,buttons:{cancel:{text:"Anular y cambiar versión",btnClass:"btn-primary",action:function(e,o){t.attachment.id=n,t.isView=!1,O(n),l.pop("info","Anulación Anexo","El anexo se cargó satisfactoriamente, seleccione una nueva versión del documento")}},fullCancel:{text:"Anular definitivamente",btnClass:"btn-red",action:function(o,a){var i={};i.id=n,u({method:"POST",url:"api/customer-road-safety-item-document-40595/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(n){swal("Eliminado","Anexo anulado satisfactoriamente","info"),t.reloadData()})["catch"](function(t){e.error(t),s.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}},closeAll:{text:"Cancelar",btnClass:"btn-default",action:function(t,n){}}}})})};t.dtInstanceMinimumStandardDocument40595Callback=function(n){t.dtInstanceMinimumStandardDocument40595=n},t.reloadData=function(){t.dtInstanceMinimumStandardDocument40595.reloadData()},t.onShowCancelledChange=function(){t.reloadData()}}]);
"use strict";app.controller("customerRoadSafetyImport40595Ctrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","SweetAlert","$rootScope","$http","$timeout","$uibModal","flowFactory","cfpLoadingBar","$filter","$document","FileUploader","$localStorage","$aside","ListService",function(t,n,a,e,i,r,o,d,u,l,c,s,m,f,p,w,h,v,S,y,I,g){function b(){var a={customerId:n.customerId,customerRoadSafetyId:t.currentId},e=[{name:"customer_road_safety_parent_40595",value:null,criteria:a},{name:"customer_road_safety_40595",value:null,criteria:a},{name:"customer_road_safety_item_40595",value:null,criteria:a}];g.getDataList(e).then(function(n){t.parentList=n.data.data.customerEvaluationMinimumStardardParent,t.standardListAll=n.data.data.customerEvaluationMinimumStardard,t.standardItemListAll=n.data.data.customerEvaluationMinimumStardardItem,D()},function(n){t.status="Unable to load customer data: "+n.message})}console.log("editMode Import",t.$parent.editMode);var L=null;t.isCreate=0==t.$parent.currentId,t.currentId=t.$parent.currentId,t.parentList=[],t.standardList=[],t.standardItemList=[],t.standardListAll=[],t.standardItemListAll=[],b();var O=function(){t.entity={id:t.$parent.currentId?t.$parent.currentId:0,customerEvaluationMinimumStardardParent:null,customerEvaluationMinimumStardard:null,customerEvaluationMinimumStardardItem:null,documentList:[]},null!=L&&L.$setPristine(!0)};O(),t.onSelectParent=function(){D(),t.entity.customerEvaluationMinimumStardard=null,t.entity.customerEvaluationMinimumStardardItem=null,t.reloadData(),t.entity.documentList=[]},t.onSelectStandard=function(){M(),t.entity.customerEvaluationMinimumStardardItem=null,t.reloadData(),t.entity.documentList=[]},t.onSelectStandardItem=function(){t.reloadData(),t.entity.documentList=[]};var D=function(){null!=t.entity.customerEvaluationMinimumStardardParent&&(t.standardList=h("filter")(t.standardListAll,{roadSafetyParentId:t.entity.customerEvaluationMinimumStardardParent.roadSafetyParentId},!0))},M=function(){null!=t.entity.customerEvaluationMinimumStardard&&(t.standardItemList=h("filter")(t.standardItemListAll,{roadSafetyParentId:t.entity.customerEvaluationMinimumStardard.roadSafetyId},!0))};t.form={submit:function(t){L=t;var n=null;if(t.$invalid){var a=null,n=null;for(a in t)"$"!=a[0]&&(null!==n||t[a].$valid||(n=t[a].$name),t[a].$pristine&&(t[a].$dirty=!0));return angular.element(".ng-invalid[name="+n+"]").focus(),void l.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}C()},reset:function(t){t.$setPristine(!0)}};var C=function(){if(null==t.entity.documentList||void 0===t.entity.documentList||0==t.entity.documentList.length)return void l.swal("Información requerida!","Debes seleccionar al menos 1 anexo para importar.","warning");var n={},a=JSON.stringify(t.entity);return n.data=Base64.encode(a),s({method:"POST",url:"api/customer-road-safety-item-document-40595/import",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(n){l.swal("Registro","La información ha sido importada satisfactoriamente","success"),m(function(){O(),t.reloadData()})})["catch"](function(t){l.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};t.onCancel=function(){null!=t.$parent&&t.$parent.navToSection("summary","summary",t.currentId)},t.dtOptionsMinimumStandardItemDocument40595=e.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(a){return a.customerRoadSafetyItemId=t.entity.customerEvaluationMinimumStardardItem?t.entity.customerEvaluationMinimumStardardItem.customerRoadSafetyItemId:0,a.customerId=t.entity.customerEvaluationMinimumStardardItem?n.customerId:-1,a.statusCode="2",JSON.stringify(a)},url:"api/customer-road-safety-item-document-40595-available",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){E()}).withOption("bFilter",!1).withOption("paging",!1).withOption("createdRow",function(n,a,e){o(angular.element(n).contents())(t)}),t.dtColumnsMinimumStandardItemDocument40595=[i.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,n,a,e){var i=t.documentUrl?t.documentUrl:"",r="",o='<a target="_self" class="btn btn-primary btn-xs downloadDocumentRow lnk" uib-tooltip="Descargar anexo" data-id="'+t.id+'" >   <i class="fa fa-download"></i></a> ',d=!0;return""!=i&&(r+=o),d?r:""}),i.newColumn("documentType").withTitle("Tipo de documento").withOption("width",200),i.newColumn("classification").withTitle("Clasificación").withOption("width",200),i.newColumn("description").withTitle("Descripción").withOption("width",200),i.newColumn("version").withTitle("Versión").withOption("width",200),i.newColumn("dateOfCreation").withTitle("Fecha Creación").withOption("width",200).withOption("defaultContent",""),i.newColumn("status").withTitle("Estado").withOption("width",200).renderWith(function(t,n,a,e){var i="";switch(t){case"Vigente":i="label label-success";break;case"Anulado":i="label label-danger"}var r='<span class="'+i+'">'+t+"</span>";return r}),i.newColumn(null).withTitle("Acciones").notSortable().renderWith(function(t,n,a,e){var i="",r="",o='<div class="checkbox clip-check check-success "><input class="checkRow" type="checkbox" id="chk_'+t.id+'" data-id="'+t.id+'" data-value="'+t.selected+'" '+r+' ><label for="chk_'+t.id+'"> Seleccionar </label></div>';return i+=o}).notSortable()];var E=function(){$("#dtMinimumStandardItemDocument40595 a.downloadDocumentRow").on("click",function(){var t=$(this).data("id");angular.element("#download")[0].src="api/customer-document/download?id="+t}),$("input[type=checkbox]").on("change",function(){var n=$(this).data("id"),a=($(this).data("value"),$(this).is(":checked"));a?t.entity.documentList.push({id:n}):t.entity.documentList=h("filter")(t.entity.documentList,{id:"!"+n})})};t.dtInstanceMinimumStandardItemDocument40595Callback=function(n){t.dtInstanceMinimumStandardItemDocument40595=n},t.reloadData=function(){t.dtInstanceMinimumStandardItemDocument40595.reloadData()}}]);
"use strict";app.controller("customerRoadSafetyList40595Ctrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","ChartService",function(t,a,e,n,i,o,r,s,d,l,u,c,f,p){t.canCreate=!1,t.dtOptionsRoadSafetyList40595=n.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.operation="standard",t.customerId=a.customerId,JSON.stringify(t)},dataSrc:function(a){return t.canCreate=a.extra,a.data},url:"api/customer-road-safety-40595",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(t){}}).withDataProp("data").withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){m()}).withPaginationType("full_numbers").withOption("createdRow",function(a,e,n){r(angular.element(a).contents())(t)}),t.dtColumnsRoadSafetyList40595=[i.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,a,e,n){var i="",o='<a class="btn btn-success btn-xs continueRow lnk" href="#" uib-tooltip="Continuar"  data-id="'+t.id+'" >   <i class="fa fa-play"></i></a> ',r='<a class="btn btn-info btn-xs viewRow lnk" href="#" uib-tooltip="Ver"  data-id="'+t.id+'" >   <i class="fa fa-eye"></i></a> ',s=' | <a class="btn btn-dark-azure btn-xs migrateRow lnk" href="#" uib-tooltip="Migrar Calificaciones Periodo Anterior"  data-id="'+t.id+'" data-from-id="'+t.migrateFromId+'" >   <i class="fa fa-share-square-o"></i></a> ';return l.can("em_40595_historico_view")&&(i+=r),l.can("em_40595_historico_continue")&&"A"==t.statusCode&&(i+=o),1==t.canMigrate&&(i+=s),i}),i.newColumn("unique").withTitle("ID").withOption("width",100),i.newColumn("period").withTitle("Periodo").withOption("width",100),i.newColumn("createdAt").withTitle("Fecha Creación").withOption("width",150),i.newColumn(null).withTitle("Estado").withOption("width",200).renderWith(function(t,a,e,n){var i="label label-warning";return"A"==t.statusCode?i="label label-success":"C"==t.statusCode&&(i="label label-danger"),'<span class="'+i+'">'+t.status+"</span>"}).notSortable()];var m=function(){angular.element("#dtRoadSafetyList40595 a.continueRow").on("click",function(){var a=angular.element(this).data("id");t.onContinue(a)}),angular.element("#dtRoadSafetyList40595 a.viewRow").on("click",function(){var a=angular.element(this).data("id");t.onView(a)}),angular.element("#dtRoadSafetyList40595 a.migrateRow").on("click",function(){var e=angular.element(this).data("id"),n=angular.element(this).data("from-id");t.onMigrate({id:e,fromId:n,customerId:a.customerId})})};t.dtInstanceRoadSafetyList40595Callback=function(a){t.dtInstanceRoadSafetyList40595=a},t.reloadData=function(){t.dtInstanceRoadSafetyList40595.reloadData()},t.onContinue=function(a){null!=t.$parent&&(t.setEditMode("continue"),t.$parent.navToSection("summary","summary",a))},t.onView=function(a){null!=t.$parent&&(t.setEditMode("view"),t.$parent.navToSection("summary","summary",a))},t.onCreate=function(){var n=JSON.stringify({customerId:a.customerId}),i={data:Base64.encode(n)};return c({method:"POST",url:"api/customer-road-safety-40595/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(a){f.swal("Registro","La información ha sido guardada satisfactoriamente","success"),l.app.supportHelp&&(l.app.supportHelp.hasMinimumStandard40595=!0),t.reloadData()})["catch"](function(t){e.error(t),f.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})},t.onMigrate=function(a){var n=JSON.stringify(a),i={data:Base64.encode(n)};return c({method:"POST",url:"api/customer-road-safety-40595/migrate",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(a){f.swal("Registro","La información ha sido migrada satisfactoriamente","success"),t.reloadData()})["catch"](function(t){e.error(t),f.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})}}]);
"use strict";app.controller("customerDiagnosticRiskMatrixCtrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout","$filter",function(t,i,a,r,o,s,e){t.views=[{name:"summary",url:o.app.views.urlRoot+"modules/customer/diagnostic/tab-matrix/customer_diagnostic_risk_matrix_summary.htm"},{name:"priorization",url:o.app.views.urlRoot+"modules/customer/diagnostic/tab-matrix/customer_diagnostic_risk_matrix_priorization.htm"},{name:"historical",url:o.app.views.urlRoot+"modules/customer/diagnostic/tab-matrix/customer_diagnostic_risk_matrix_historical.htm"},{name:"characterization",url:o.app.views.urlRoot+"modules/customer/diagnostic/tab-matrix/customer_diagnostic_risk_matrix_characterization.htm"}],t.loading=!1,t.tabname="basic",t.getView=function(i){var a=e("filter")(t.views,{name:i});return a[0]},t.switchTab=function(i){s(function(){t.tabname=i})}}]);
"use strict";app.controller("customerDiagnosticRiskMatrixSummaryCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$aside","$filter","$translate","ListService",function(e,t,a,n,i,o,r,l,s,c,d,u,p,m,f,h,v){function g(){var t=[{name:"criteria_operators",value:null},{name:"criteria_conditions",value:null},{name:"customer_config_acitivty_hazard_filter_field",value:null}];v.getDataList(t).then(function(t){e.criteria=t.data.data.criteriaOperatorList,e.conditions=t.data.data.criteriaConditionList,e.audit.fields=t.data.data.customerAbsenteeismDisabilityFilterField},function(t){e.status="Unable to load customer data: "+t.message})}var w=a,b={refresh:!0,index:0};e.audit={fields:[],filters:[]},e.isView="G"!=e.customer.matrixType,g(),e.addFilter=function(){null==e.audit.filters&&(e.audit.filters=[]),e.audit.filters.push({id:0,field:null,criteria:e.criteria.length>0?e.criteria[1]:null,condition:e.conditions.length>0?e.conditions[0]:null,value:""})},e.onFilter=function(){e.grid.dataSource.read()},e.removeFilter=function(t){e.audit.filters.splice(t,1)},e.onCleanFilter=function(){e.audit.filters=[],e.grid.dataSource.read()},d(function(){var n=function(){var e=[{command:[{text:" ",template:"<a class='btn btn-info btn btn-xs' ng-click='onAddHazard(dataItem)' uib-tooltip='Ver' tooltip-placement='right'><i class='fa fa-eye'></i></a> "},{text:" ",template:"<a class='btn btn-success btn btn-xs' ng-click='onAddHazard(dataItem)' uib-tooltip='Editar' tooltip-placement='right'><i class='fa fa-edit'></i></a> "},{text:" ",template:"<a class='btn btn-dark-azure btn btn-xs' ng-click='onAddHazard(dataItem)' uib-tooltip='Adicionar Nuevo Peligro' tooltip-placement='right'><i class='fa fa-plus-circle'></i></a> "},{text:" ",template:"<a class='btn btn-warning btn btn-xs' ng-click='onConfigHazard(dataItem)' uib-tooltip='Adicionar Peligro Existente' tooltip-placement='right'><i class='fa fa-cog'></i></a> "}],width:"80px"}];return e.push(i("workPlace",h.instant("grid.matrix.WORK-PLACE"),"250px")),e.push(i("macroProcess",h.instant("grid.matrix.MACROPROCESS"),"200px")),e.push(i("process",h.instant("grid.matrix.PROCESS"),"200px")),e.push(i("job","Cargo","200px")),e.push(i("activity",h.instant("grid.matrix.ACTIVITY"),"200px")),e.push(i("isRoutine","Rutinaria","200px")),e.push(i("classification","Clasificación","200px")),e.push(i("type","Tipo Peligro","200px")),e.push(i("description","Descripción Peligro","200px")),e.push(i("effect","Efectos a la Salud","200px")),e.push(i("timeExposure","T. Expuesto","200px")),e.push(i("controlMethodSourceText",h.instant("grid.matrix.CONTROL-METHOD-SOURCE"),"200px")),e.push(i("controlMethodMediumText",h.instant("grid.matrix.CONTROL-METHOD-MEDIUM"),"200px")),e.push(i("controlMethodPersonText",h.instant("grid.matrix.CONTROL-METHOD-PERSON"),"200px")),"isa"==c.app.instance&&e.push(i("controlMethodAdministrativeText","M. Control Señalización / Control Administrativo","200px")),e.push(i("measureND","N. Deficiencia","200px")),e.push(i("measureNE","N. Exposición","200px")),e.push(i("measureNC","N. Consecuencia","200px")),e.push(i("levelP","N. Probabilidad","200px")),e.push(i("levelIP","Interp N. Probabilidad","200px")),e.push(i("levelR","Nivel Riesgo","200px")),e.push(i(null,"Interp Riesgo","200px",!1,o)),e.push(i(null,"Valoracion riesgo","200px",!1,r)),e.push(i("exposed","Trabajadores Vinculados o en Misión","200px")),e.push(i("contractors","Trabajadores Contratistas","200px")),e.push(i("visitors","Visitantes","200px")),e.push(i("status","Verificado","200px",!1,l)),e.push(i("reason","Motivo","200px")),e},i=function(e,t,a,n,i){return{field:e,title:t,width:a,headerAttributes:{"class":"text-bold"},filterable:void 0!==n&&n,template:"function"==typeof i?i:null}},o=function(e){return s(e.levelIR,e.levelIR)},r=function(e){return s(e.riskValue,e.levelIR)},l=function(e){var t="",a=null!=e.status?e.status:"";switch(e.status){case"Denegado":t="label label-danger";break;case"Pendiente":t="label label-warning";break;case"Aprobado":t="label label-success"}return'<span class="'+t+'">'+a+"</span>"},s=function(e,t){var a="",e=null!=e?e:"";switch(t){case"I":a="label label-danger";break;case"II":a="label label-warning";break;case"III":a="label label-info";break;case"IV":a="label label-success"}return'<span class="'+a+'">'+e+"</span>"};e.mainGridOptions={dataSource:{type:"odata",transport:{read:{url:"api/customer-config-activity-hazard",dataType:"json",type:"POST",data:function(){var a={customerId:t.customerId};return angular.isDefined(e.audit)&&angular.isDefined(e.audit.filters)&&(a.filter={filters:$.map(e.audit.filters,function(e){if(null!=e.field)return{field:e.field.name,operator:e.criteria.value,condition:e.condition.value,value:e.value}})}),a}},parameterMap:function(e,t){return JSON.stringify(e)}},schema:{model:{id:"id",fields:{}},data:function(e){return e.data||e},total:function(e){return e.recordsTotal||e.data.length||0}},pageSize:10,serverPaging:!0,serverFiltering:!0,serverSorting:!0},scrollable:!0,sortable:{mode:"multiple"},pageable:{change:function(e){b.index=e.index,w.info("page.index",b.index)}},filterable:!1,dataBinding:function(e){a.info("dataBinding")},dataBound:function(t){a.info("dataBound"),e.grid.tbody.find("tr").each(function(){var t=e.grid.dataItem(this),a=void 0!==t&&null!=t.id&&""!=t.id,n=void 0!==t&&null==t.id&&null!=t.activityId,i=void 0!==t&&null!=t.activityId&&t.hasHazards>0;a?e.isView?$(this).find(".btn-success").remove():$(this).find(".btn-info").remove():($(this).find(".btn-info").remove(),$(this).find(".btn-success").remove()),n&&!e.isView||$(this).find(".btn-dark-azure").remove(),i&&!e.isView||$(this).find(".btn-warning").remove()})},columns:n()},e.detailGridOptions=function(e){return{dataSource:{type:"odata",transport:{read:{url:"api/customer-config-activity-hazard-intervention",dataType:"json",type:"POST",data:function(){var t={jobActivityHazardId:e.id};return t}},parameterMap:function(e,t){return JSON.stringify(e)}},requestEnd:function(e){},schema:{model:{id:"id",fields:{}},data:function(e){return e.data||e},total:function(e){return e.recordsTotal||e.data.length||0}},serverPaging:!0,serverSorting:!0,serverFiltering:!1,pageSize:10,filter:{field:"jobActivityHazardId",operator:"eq",value:e.id}},noRecords:!0,scrollable:!1,sortable:!0,pageable:!1,dataBound:function(e){a.info("dataBound child"),this.wrapper.css({width:this.wrapper.closest("div.k-parent")[0].offsetWidth-90+"px"})},columns:[{command:[{text:" ",template:"<a class='btn btn-warning btn btn-xs' ng-click='onAddImprovementPlan(dataItem)' uib-tooltip='Plan Mejoramiento' tooltip-placement='right'><i class='fa fa-plus-square'></i></a> "}],width:"50px"},i("type","Medida de Intervención","300px"),i("description","Descripción Medida de Intervención","300px"),i("tracking","Seguimiento y Medición","300px"),i("observation","Observación","300px")]}}}),e.$on("kendoWidgetCreated",function(t,a){void 0!==e.grid&&null!==e.grid||(e.grid=a)}),e.onSummaryExportExcel=function(){jQuery("#downloadDocument")[0].src="api/customer-config-activity-hazard/export?id="+t.customerId},e.onAddHazard=function(t){var a=m.open({templateUrl:c.app.views.urlRoot+"modules/customer/common/modals/customer_config_sgsst_activity_hazard_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideConfigMatrixJobActivityHazardCtrl",scope:e,resolve:{activity:function(){return{activityHazardId:t.id,activityId:t.activityId,jobActivityId:t.jobActivityId}},isView:function(){return e.isView}}});a.result.then(function(){e.grid.dataSource.read()},function(){e.grid.dataSource.read()})},e.onConfigHazard=function(t){var a=m.open({templateUrl:c.app.views.urlRoot+"modules/customer/sgsst/hazard/customer_profile_config_sgsst_job_activity_hazard_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideCustomerConfigJobActivityHazardCtrl",scope:e,resolve:{activity:function(){return{id:t.jobActivityId}}}});a.result.then(function(){e.grid.dataSource.read()},function(){e.grid.dataSource.read()})},e.onAddImprovementPlan=function(t){var a=m.open({templateUrl:c.app.views.urlRoot+"modules/customer/common/modals/customer_improvement_plan_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideCustomerMatrixDetailImprovementPlanCtrl",scope:e,resolve:{entity:function(){return t},isView:function(){return e.isView},program:function(){return{code:"Matri"}}}});a.result.then(function(){},function(){})}}]),app.controller("ModalInstanceSideConfigMatrixJobActivityHazardCtrl",["$rootScope","$scope","$location","$uibModalInstance","activity","isView","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile","$document","$stateParams","$translate","ListService",function(e,t,a,n,i,o,r,l,s,c,d,u,p,m,f,h,v,g,w,b){function y(){var e=[{name:"customer_config_activity_hazard_reason",value:null}];b.getDataList(e).then(function(e){t.reasonList=e.data.data.customer_config_activity_hazard_reason},function(e){t.status="Unable to load customer data: "+e.message})}t.isView=o,y(),t.controlMethods=e.parameters("config_control_method"),t.typesMeasure=e.parameters("config_type_measure"),t.trackingList=e.parameters("hazard_tracking"),t.activity={id:i.activityId};a.absUrl();"isa"==e.app.instance?(t.matrixTabLabel1="Grupo Ocupacional o Instalación",t.matrixTabLabel2="Subestación",t.matrixTabLabel3="Ubicación, Sitio o Área",t.matrixTabLabel4="Labor / Tarea",t.controlMethodSourceLabel="Eliminación / Sustitución",t.controlMethodMediumLabel="Control de Ingeniería",t.controlMethodAdministrativeLabel="Señalización / Control Administrativo",t.controlMethodPersonLabel="Equipos de Protección Personal"):(t.matrixTabLabel1="Centros de Trabajo",t.matrixTabLabel2="Macroprocesos",t.matrixTabLabel3="Procesos",t.matrixTabLabel4="Actividades",t.controlMethodSourceLabel="Fuente",t.controlMethodMediumLabel="Medio",t.controlMethodAdministrativeLabel="",t.controlMethodPersonLabel="Persona");var C=function(){t.hazard={id:i.activityHazardId?i.activityHazardId:0,jobActivityId:t.activity.id,customerConfigJobActivityId:i.jobActivityId,type:null,classification:null,description:null,health:null,exposure:0,controlMethodSourceText:"",controlMethodMediumText:"",controlMethodPersonText:"",measureND:null,measureNE:null,measureNC:null,levelP:null,levelIP:null,levelR:null,riskValue:null,riskText:null,interventions:[],reason:null,reasonObservation:null}};C(),t.types=[],t.onLoadRecordHazard=function(){if(0!=t.hazard.id){var e={id:t.hazard.id};c({method:"GET",url:"api/customer/config-sgsst/job-activity-hazard/get",params:e})["catch"](function(e,t){}).then(function(e){l(function(){t.hazard=e.data.result,t.reloadDataReason()})})["finally"](function(){})}},t.onLoadRecordActivity=function(){if(0!=t.activity.id){var e={id:t.activity.id};c({method:"GET",url:"api/customer/config-sgsst/activity/get",params:e})["catch"](function(e,t){}).then(function(e){l(function(){t.activity=e.data.result})})["finally"](function(){})}else t.loading=!1},t.onLoadRecordHazard(),t.onLoadRecordActivity();var x=function(){var e={};return e.operation="diagnostic",e.customerId=t.customerId,c({method:"POST",url:"api/customer/config-sgsst/wizard/listClassification",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){l(function(){t.classifications=e.data.data})})["catch"](function(e){r.error(e),s.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})},z=function(){var e={};return e.operation="diagnostic",e.customerId=t.customerId,c({method:"POST",url:"api/customer/config-sgsst/wizard/listLevel",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){l(function(){t.measuresND=e.data.data.ND,t.measuresNE=e.data.data.NE,t.measuresNC=e.data.data.NC})})["catch"](function(e){r.error(e),s.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};x(),z(),t.$watch("hazard.classification",function(){if(null!=t.hazard.classification){var e={};return e.operation="diagnostic",e.classificationId=t.hazard.classification.id,c({method:"POST",url:"api/customer/config-sgsst/wizard/listType",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){l(function(){t.types=e.data.data})})["catch"](function(e){})["finally"](function(){})}}),t.$watch("hazard.type",function(){if(null!=t.hazard.classification){var e={};e.operation="diagnostic",e.typeId=t.hazard.type.id,c({method:"POST",url:"api/customer/config-sgsst/wizard/listDescription",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){l(function(){t.descriptions=e.data.data})})["catch"](function(e){})["finally"](function(){}),c({method:"POST",url:"api/customer/config-sgsst/wizard/listEffect",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){l(function(){t.healthEffects=e.data.data})})["catch"](function(e){})["finally"](function(){})}});var T=function(){t.hazard.riskValue=null,t.hazard.riskText=null,null!=t.hazard.measureND&&null!=t.hazard.measureNE&&(t.hazard.levelP=parseFloat(t.hazard.measureND.value)*parseFloat(t.hazard.measureNE.value),t.hazard.levelP>20?t.hazard.levelIP="Muy Alto":t.hazard.levelP>=10&&t.hazard.levelP<=20?t.hazard.levelIP="Alto":t.hazard.levelP>=6&&t.hazard.levelP<=8?t.hazard.levelIP="Medio":t.hazard.levelP>=1&&t.hazard.levelP<=4?t.hazard.levelIP="Bajo":t.hazard.levelIP="",null!=t.hazard.measureNC&&(t.hazard.levelR=parseFloat(t.hazard.levelP)*parseFloat(t.hazard.measureNC.value),t.hazard.levelR>=600&&t.hazard.levelR<=4e3?(t.hazard.riskValue="No Aceptable",t.hazard.riskText="Situación crítica. Suspender actividades hasta que el riesgo esté bajo control. Intervención urgente"):t.hazard.levelR>=150&&t.hazard.levelR<=500?(t.hazard.riskValue="No Aceptable o Aceptable con control especifico",t.hazard.riskText="Corregir y adoptar medidas de control de inmediato. Sin embargo, suspenda actividades si el nivel de riesgo está por encima o igual de 360"):t.hazard.levelR>=40&&t.hazard.levelR<=120?(t.hazard.riskValue="Mejorable",t.hazard.riskText="Mejorar si es posible. Sería conveniente justificar la intervención y su rentabilidad"):t.hazard.levelR>=10&&t.hazard.levelR<=39&&(t.hazard.riskValue="Aceptable",t.hazard.riskText="Mantener las medidas de control existentes, pero se deberían considerar soluciones o mejoras y se deben hacer comprobaciones periódicas para asegurar que el riesgo aún es aceptable")))};t.$watch("hazard.measureND",function(){T()}),t.$watch("hazard.measureNE",function(){T()}),t.$watch("hazard.measureNC",function(){T()}),t.onCloseModal=function(){n.close(1)},t.onCancel=function(){n.dismiss("cancel")},t.onClear=function(){C(),t.hazard.id=0},t.form={submit:function(e){var a=null;if(e.$invalid){var n=null,a=null;for(n in e)"$"!=n[0]&&(null!==a||e[n].$valid||(a=e[n].$name),e[n].$pristine&&(e[n].$dirty=!0));return angular.element(".ng-invalid[name="+a+"]").focus(),void l(function(){d.pop("error","Error","Por favor verifique los datos requeridos del formulario y vuelva a intentarlo")},500)}t.onSave()},reset:function(e){e.$setPristine(!0)}},t.onSave=function(){var e={},a=JSON.stringify(t.hazard);return e.data=Base64.encode(a),c({method:"POST",url:"api/customer/config-sgsst/job-activity-hazard/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){l(function(){s.swal("Validación exitosa","Procediendo con el guardado...","success"),t.onClear(),t.reloadData()})})["catch"](function(e){r.error(e),s.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};var O=function(){var a=[m.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,a,n,i){var o=null!=e.document?e.document.path:"",r="",l='<a target="_self" class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+e.customerConfigJobActivityHazardId+'" data-url="'+o+'" >   <i class="fa fa-edit"></i></a> ',s='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+e.customerConfigJobActivityHazardId+'" >   <i class="fa fa-ban"></i></a> ';return r+=l,r+=s,t.isView?"":r})];return a.push(I("classification","Clasificación","",200)),a.push(I("type","Tipo Peligro","",200)),a.push(I("description","Descripción Peligro","",200)),a.push(I("effect","Efectos a la salud","",200)),a.push(I("timeExposure","T Expuesto","",200)),a.push(I("controlMethodSourceText",w.instant("grid.matrix.CONTROL-METHOD-SOURCE"),"",200)),a.push(I("controlMethodMediumText",w.instant("grid.matrix.CONTROL-METHOD-MEDIUM"),"",200)),a.push(I("controlMethodPersonText",w.instant("grid.matrix.CONTROL-METHOD-PERSON"),"",200)),"isa"==e.app.instance&&a.push(I("controlMethodAdministrativeText","M Control Señalización / Control Administrativo","",200)),a.push(I("measureND","ND","",200)),a.push(I("measureNE","NE","",200)),a.push(I("measureNC","NC","",200)),a},I=function(e,t,a,n){return m.newColumn(e).withTitle(t).withOption("defaultContent",a).withOption("width",n)};t.dtInstanceConfigJobActivityHazard={},t.dtOptionsConfigJobActivityHazard=f.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerConfigJobActivityId=i.jobActivityId,JSON.stringify(e)},url:"api/customer-config-job-activity-hazard-relation",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){P()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,a,n){h(angular.element(e).contents())(t)}),t.dtColumnsConfigJobActivityHazard=O();var P=function(){$("#dtConfigJobActivityHazard a.editRow").on("click",function(){var e=$(this).data("id");t.hazard.id=e,t.onLoadRecordHazard()}),$("#dtConfigJobActivityHazard a.delRow").on("click",function(){var e=$(this).data("id");s.swal({title:"Está seguro?",text:"Anularás el anexo seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, anular!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(a){if(a){var n={};n.id=e,c({method:"POST",url:"api/customer/config-sgsst/job-activity-hazard/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){r.error(e),s.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){t.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};t.reloadData=function(){t.dtInstanceConfigJobActivityHazard.reloadData()},t.onAddIntervention=function(){l(function(){null==t.hazard.interventions&&(t.hazard.interventions=[]),t.hazard.interventions.push({id:0,hazardId:t.hazard.id,type:null,description:""})})},t.onRemoveIntervention=function(e){s.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(a){a?l(function(){var a=t.hazard.interventions[e];if(0!=a.id){var n={};n.id=a.id,c({method:"POST",url:"api/customer/config-sgsst/job-activity-hazard/intervention/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(a){swal("Eliminado","Registro eliminado satisfactoriamente","info"),t.hazard.interventions.splice(e,1)})["catch"](function(e){r.error(e),s.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}else t.hazard.interventions.splice(e,1)}):swal("Cancelación","La operación ha sido cancelada","error")})};var S=function(){var e=[];return e.push(I("createdAt","Fecha","",200)),e.push(I("name","Usuario","",200)),e.push(I("reason","Motivo","",200)),e.push(I("reasonObservation","Observación","",200)),e};t.dtOptionsConfigJobActivityHazardReason=f.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.jobActivityHazardId=t.hazard.id,JSON.stringify(e)},url:"api/customer-config-activity-hazard-historical-reason",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,a,n){h(angular.element(e).contents())(t)}),t.dtColumnsConfigJobActivityHazardReason=S(),t.dtInstanceConfigJobActivityHazardReasonCallback=function(e){t.dtInstanceConfigJobActivityHazardReason=e},t.reloadDataReason=function(){t.dtInstanceConfigJobActivityHazardReason.reloadData()}}]),app.controller("ModalInstanceSideCustomerMatrixDetailImprovementPlanCtrl",["$stateParams","$rootScope","$scope","$uibModalInstance","entity","program","$log","$timeout","SweetAlert","isView","$filter","FileUploader","$http","DTOptionsBuilder","DTColumnBuilder","$compile",function(e,t,a,n,i,o,r,l,s,c,d,u,p,m,f,h){a.maxDate=new Date,a.datePickerConfig={culture:"es-CO",format:"dd/MM/yyyy HH:mm"},a.responsibleList=[],a.typesAlert=d("orderBy")(t.parameters("tracking_alert_type"),"id",!1),a.typesTime=t.parameters("tracking_alert_timeType"),a.statusAlert=t.parameters("tracking_alert_status"),a.preferencesAlert=t.parameters("tracking_alert_preference"),a.typeList=t.parameters("improvement_plan_type");var v=function(){a.improvement={id:0,customerId:e.customerId,classificationName:o.code,classificationId:o.code,entityName:"MT",entityId:i.id,type:null,endDate:null,description:"",observation:"",responsible:null,isRequiresAnalysis:!1,status:{id:0,value:"CR",item:"Creada"},trackingList:[],alertList:[]}};v(),a.onLoadRecord=function(e){if(0!=e){var t={id:e};p({method:"GET",url:"api/customer/improvement-plan",params:t})["catch"](function(e,t){if(403==t){var a=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";s.swal("No Autorizado","No estas autorizado para ver esta información.","error"),l(function(){$state.go(a)},3e3)}else 404==t?s.swal("Información no disponible","Centro de trabajo no encontrado","error"):s.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(e){l(function(){null!=e.data.result&&""!=e.data.result&&(a.improvement=e.data.result,b())},400)})["finally"](function(){})}else a.loading=!1},a.onCloseModal=function(){n.close(1)},a.onCancel=function(){n.dismiss("cancel")},a.onClear=function(){};var g=function(){var t={customer_id:e.customerId};return p({method:"POST",url:"api/customer/improvement-plan/list-data",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(e){l(function(){a.responsibleList=e.data.data.responsible})})["catch"](function(e){s.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};g(),a.master=a.improvement,a.form={submit:function(e){var t=null;if(e.$invalid){var a=null,t=null;for(a in e)"$"!=a[0]&&(null!==t||e[a].$valid||(t=e[a].$name),e[a].$pristine&&(e[a].$dirty=!0));return angular.element(".ng-invalid[name="+t+"]").focus(),void s.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}s.swal("Validación exitosa","Procediendo con el guardado...","success"),w()},reset:function(e){a.improvement=angular.copy(a.master),e.$setPristine(!0)}};var w=function(){var e={},t=JSON.stringify(a.improvement);return e.data=Base64.encode(t),p({method:"POST",url:"api/customer/improvement-plan/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){l(function(){v()})})["catch"](function(e){s.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){a.reloadData()})},b=function(){null!=a.improvement.endDate&&(a.improvement.endDate=new Date(a.improvement.endDate.date)),angular.forEach(a.improvement.trackingList,function(e,t){null!=e.startDate&&(e.startDate=new Date(e.startDate.date))})};a.onAddTracking=function(){l(function(){null==a.improvement.trackingList&&(a.improvement.trackingList=[]),a.improvement.trackingList.push({id:0,customerImprovementPlanId:0,responsible:null,startDate:null})})},a.onRemoveTracking=function(e){s.swal({title:"Está seguro?",text:"Desea confirmar la eliminación de este registro ?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(t){t?l(function(){var t=a.improvement.trackingList[e];if(a.improvement.trackingList.splice(e,1),0!=t.id){var n={};n.id=t.id,p({method:"POST",url:"api/customer/improvement-plan-tracking/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){r.error(e),s.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})},a.onAddAlert=function(){l(function(){null==a.improvement.alertList&&(a.improvement.alertList=[]),a.improvement.alertList.push({id:0,customerImprovementPlanId:0,type:null,preference:null,time:0,timeType:null,status:null})})},a.onRemoveAlert=function(e){s.swal({title:"Está seguro?",text:"Desea confirmar la eliminación de este registro ?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(t){t?l(function(){var t=a.improvement.alertList[e];if(a.improvement.alertList.splice(e,1),0!=t.id){var n={};n.id=t.id,p({method:"POST",url:"api/customer/improvement-plan-alert/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){r.error(e),s.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})},a.dtInstanceImprovementPlan={},a.dtOptionsImprovementPlan=m.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerId=a.improvement.customerId,e.entityId=a.improvement.entityId,e.entityName=a.improvement.entityName,JSON.stringify(e)},url:"api/customer-improvement-plan-entity",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){y()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,t,n){h(angular.element(e).contents())(a)}),a.dtColumnsImprovementPlan=[f.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,n,i,o){var r="",l='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+e.id+'" >   <i class="fa fa-edit"></i></a> ',s='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+e.id+'" >   <i class="fa fa-trash-o"></i></a> ';return t.can("cliente_plan_mejoramiento_edit")&&(r+=l),t.can("cliente_plan_mejoramiento_delete")&&(r+=s),a.isView?null:r}),f.newColumn("origin").withTitle("Origen").withOption("width",200).withOption("defaultContent",""),f.newColumn("classification").withTitle("Clasificación").withOption("width",200).withOption("defaultContent",""),f.newColumn("type").withTitle("Tipo").withOption("width",200).withOption("defaultContent",""),f.newColumn("description").withTitle("Hallazgo").withOption("width",200).withOption("defaultContent",""),f.newColumn("responsibleName").withTitle("Responsable").withOption("defaultContent",""),f.newColumn(null).withTitle("Fecha Cierre").withOption("width",200).renderWith(function(e,t,a,n){return"object"==typeof e.endDate&&null!=e.endDate?moment(e.endDate.date).format("DD/MM/YYYY"):null!=e.endDate?moment(e.endDate).format("DD/MM/YYYY"):""}),f.newColumn(null).withTitle("Estado").withOption("width",200).withOption("defaultContent","").renderWith(function(e,t,a,n){var i="label label-success",o=e.status;switch(e.statusCode){case"AB":i="label label-info";break;case"CO":i="label label-success";break;case"CA":i="label label-danger"}return'<span class="'+i+'">'+o+"</span>"})];var y=function(){$("#dtImprovementPlan a.editRow").on("click",function(){var e=$(this).data("id");a.onLoadRecord(e)}),$("#dtImprovementPlan a.delRow").on("click",function(){var e=$(this).data("id");s.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(t){if(t){var n={};n.id=e,p({method:"POST",url:"api/customer/improvement-plan/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){r.error(e),s.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){a.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};a.dtInstanceImprovementPlanCallback=function(e){a.dtInstanceImprovementPlan=e},a.reloadData=function(){a.dtInstanceImprovementPlan.reloadData()}}]);
"use strict";app.controller("customerDiagnosticRiskMatrixPriorizationCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$translate","ListService",function(e,t,r,a,i,n,o,s,l,c,d,u,p,f,x){var g=r,m={refresh:!0,index:0};e.isView="G"!=e.customer.matrixType,e.risks=c.parameters("config_acceptance_risks"),e.filter={selectedWorkPlace:null,selectedRisk:null};var h=function(){var a={};return a.operation="diagnostic",a.customerId=t.customerId,u({method:"POST",url:"api/customer/config-sgsst/workplace/list",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(t){d(function(){e.workplaces=t.data.data})})["catch"](function(e){r.error(e),p.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};h(),d(function(){var a=function(){var e=[];return e.push(i("workPlace",f.instant("grid.matrix.WORK-PLACE"),"250px")),e.push(i("macroProcess",f.instant("grid.matrix.MACROPROCESS"),"200px")),e.push(i("process",f.instant("grid.matrix.PROCESS"),"200px")),e.push(i("job","Cargo","200px")),e.push(i("activity",f.instant("grid.matrix.ACTIVITY"),"200px")),e.push(i("isRoutine","Rutinaria","200px")),e.push(i("classification","Clasificación","200px")),e.push(i("type","Tipo Peligro","200px")),e.push(i("description","Descripción Peligro","200px")),e.push(i("effect","Efectos a la Salud","200px")),e.push(i("timeExposure","T. Expuesto","200px")),e.push(i("controlMethodSourceText",f.instant("grid.matrix.CONTROL-METHOD-SOURCE"),"200px")),e.push(i("controlMethodMediumText",f.instant("grid.matrix.CONTROL-METHOD-MEDIUM"),"200px")),e.push(i("controlMethodPersonText",f.instant("grid.matrix.CONTROL-METHOD-PERSON"),"200px")),"isa"==c.app.instance&&e.push(i("controlMethodAdministrativeText","M. Control Señalización / Control Administrativo","200px")),e.push(i("measureND","N. Deficiencia","200px")),e.push(i("measureNE","N. Exposición","200px")),e.push(i("measureNC","N. Consecuencia","200px")),e.push(i("levelP","N. Probabilidad","200px")),e.push(i("levelIP","Interp N. Probabilidad","200px")),e.push(i("levelR","Nivel Riesgo","200px")),e.push(i(null,"Interp Riesgo","200px",!1,n)),e.push(i(null,"Valoracion riesgo","200px",!1,o)),e.push(i("interventionType","Medida de Intervención","200px")),e.push(i("interventionDescription","Descripción Medida de Intervención","200px")),e.push(i("interventionTracking","Seguimiento y Medición","200px")),e.push(i("interventionObservation","Observación","200px")),e.push(i("exposed","Trabajadores Vinculados o en Misión","200px")),e.push(i("contractors","Trabajadores Contratistas","200px")),e.push(i("visitors","Visitantes","200px")),e.push(i("status","Verificado","200px",!1,s)),e.push(i("reason","Motivo","200px")),e},i=function(e,t,r,a,i){return{field:e,title:t,width:r,headerAttributes:{"class":"text-bold"},filterable:void 0!==a&&a,template:"function"==typeof i?i:null}},n=function(e){return l(e.levelIR,e.levelIR)},o=function(e){return l(e.riskValue,e.levelIR)},s=function(e){var t="",r=null!=e.status?e.status:"";switch(e.status){case"Denegado":t="label label-danger";break;case"Pendiente":t="label label-warning";break;case"Aprobado":t="label label-success"}return'<span class="'+t+'">'+r+"</span>"},l=function(e,t){var r="",e=null!=e?e:"";switch(t){case"I":r="label label-danger";break;case"II":r="label label-warning";break;case"III":r="label label-info";break;case"IV":r="label label-success"}return'<span class="'+r+'">'+e+"</span>"};e.mainGridOptions={dataSource:{type:"odata",transport:{read:{url:"api/customer-config-activity-hazard-priorization",dataType:"json",type:"POST",data:function(){var r={customerId:t.customerId};return null!==e.filter.selectedWorkPlace&&(r.workPlaceId=e.filter.selectedWorkPlace.id),null!==e.filter.selectedRisk&&(r.levelIR=e.filter.selectedRisk.value),r}},parameterMap:function(e,t){return JSON.stringify(e)}},schema:{model:{id:"id",fields:{}},data:function(e){return e.data||e},total:function(e){return e.recordsTotal||e.data.length||0}},pageSize:10,serverPaging:!0,serverFiltering:!0,serverSorting:!0},noRecords:!0,scrollable:!0,sortable:{mode:"multiple"},pageable:{change:function(e){m.index=e.index,g.info("page.index",m.index)}},filterable:!1,dataBinding:function(e){r.info("dataBinding")},dataBound:function(e){r.info("dataBound")},columns:a()},e.detailGridOptions=function(e){return{dataSource:{type:"odata",transport:{read:{url:"api/customer-improvement-plan-matrix",dataType:"json",type:"POST",data:function(){var r={customerId:t.customerId,entityId:e.id,entityName:"MT"};return r}},parameterMap:function(e,t){return JSON.stringify(e)}},requestEnd:function(e){},schema:{model:{id:"id",fields:{}},data:function(e){return e.data||e},total:function(e){return e.recordsTotal||e.data.length||0}},serverPaging:!0,serverSorting:!0,serverFiltering:!1,pageSize:10,filter:{field:"entityId",operator:"eq",value:e.id}},noRecords:!0,scrollable:!1,sortable:!0,pageable:!1,dataBound:function(e){r.info("dataBound child"),this.wrapper.css({width:this.wrapper.closest("div.k-parent")[0].offsetWidth-90+"px"})},columns:[i("endDate","Fecha de Cierre","150px"),i("type","Tipo Plan de Mejoramiento","200px"),i("description","Hallazgo","300px"),i("observation","Observación","300px"),i("responsibleName","Nombre Responsable","300px"),i("responsibleEmail","E-mail Responsable",null)]}}}),e.$on("kendoWidgetCreated",function(t,r){void 0!==e.grid&&null!==e.grid||(e.grid=r)}),e.onSelectWorkPlace=function(){e.grid.dataSource.read()},e.onSelectRisk=function(){e.grid.dataSource.read()},e.onClearWorkPlace=function(){e.filter.selectedWorkPlace=null,e.grid.dataSource.read()},e.onClearRisk=function(){e.filter.selectedRisk=null,e.grid.dataSource.read()},e.onExportExcel=function(){jQuery("#downloadDocument")[0].src="api/customer-config-activity-hazard-priorization/export?id="+t.customerId}}]);
"use strict";app.controller("customerDiagnosticRiskMatrixHistoricalCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$translate","ListService","$aside","moment",function(e,t,a,i,r,o,n,s,l,c,d,u,p,f,m,g,x){var h=a,b={refresh:!0,index:0};e.isView="G"!=e.customer.matrixType,e.risks=c.parameters("config_acceptance_risks"),e.filter={selectedWorkPlace:null,selectedRisk:null};var v=function(){var i={};return i.operation="diagnostic",i.customerId=t.customerId,u({method:"POST",url:"api/customer/config-sgsst/workplace/list",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(t){d(function(){e.workplaces=t.data.data})})["catch"](function(e){a.error(e),p.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};v(),d(function(){var i=function(){var e=[];return e.push(r("workPlace",f.instant("grid.matrix.WORK-PLACE"),"250px")),e.push(r("macroProcess",f.instant("grid.matrix.MACROPROCESS"),"200px")),e.push(r("process",f.instant("grid.matrix.PROCESS"),"200px")),e.push(r("job","Cargo","200px")),e.push(r("activity",f.instant("grid.matrix.ACTIVITY"),"200px")),e.push(r("isRoutine","Rutinaria","200px")),e.push(r("classification","Clasificación","200px")),e.push(r("type","Tipo Peligro","200px")),e.push(r("description","Descripción Peligro","200px")),e.push(r("effect","Efectos a la Salud","200px")),e.push(r("timeExposure","T. Expuesto","200px")),e.push(r("controlMethodSourceText",f.instant("grid.matrix.CONTROL-METHOD-SOURCE"),"200px")),e.push(r("controlMethodMediumText",f.instant("grid.matrix.CONTROL-METHOD-MEDIUM"),"200px")),e.push(r("controlMethodPersonText",f.instant("grid.matrix.CONTROL-METHOD-PERSON"),"200px")),"isa"==c.app.instance&&e.push(r("controlMethodAdministrativeText","M. Control Señalización / Control Administrativo","200px")),e.push(r("measureND","N. Deficiencia","200px")),e.push(r("measureNE","N. Exposición","200px")),e.push(r("measureNC","N. Consecuencia","200px")),e.push(r("levelP","N. Probabilidad","200px")),e.push(r("levelIP","Interp N. Probabilidad","200px")),e.push(r("levelR","Nivel Riesgo","200px")),e.push(r(null,"Interp Riesgo","200px",!1,o)),e.push(r(null,"Valoracion riesgo","200px",!1,n)),e.push(r("exposed","Trabajadores Vinculados o en Misión","200px")),e.push(r("contractors","Trabajadores Contratistas","200px")),e.push(r("visitors","Visitantes","200px")),e.push(r("status","Verificado","200px",!1,s)),e.push(r("reason","Motivo","200px")),e},r=function(e,t,a,i,r){return{field:e,title:t,width:a,headerAttributes:{"class":"text-bold"},filterable:void 0!==i&&i,template:"function"==typeof r?r:null}},o=function(e){return d(e.levelIR,e.levelIR)},n=function(e){return d(e.riskValue,e.levelIR)},s=function(e){var t="",a=null!=e.status?e.status:"";switch(e.status){case"Denegado":t="label label-danger";break;case"Pendiente":t="label label-warning";break;case"Aprobado":t="label label-success"}return'<span class="'+t+'">'+a+"</span>"},l=function(e){var t=new x(e.createdAt.date);return t.format("DD-MM-YYYY HH:mm")},d=function(e,t){var a="",e=null!=e?e:"";switch(t){case"I":a="label label-danger";break;case"II":a="label label-warning";break;case"III":a="label label-info";break;case"IV":a="label label-success"}return'<span class="'+a+'">'+e+"</span>"};e.mainGridOptions={dataSource:{type:"odata",transport:{read:{url:"api/customer-config-activity-hazard",dataType:"json",type:"POST",data:function(){var a={customerId:t.customerId};return null!==e.filter.selectedWorkPlace&&(a.workPlaceId=e.filter.selectedWorkPlace.id),null!==e.filter.selectedRisk&&(a.levelIR=e.filter.selectedRisk.value),a}},parameterMap:function(e,t){return JSON.stringify(e)}},schema:{model:{id:"id",fields:{}},data:function(e){return e.data||e},total:function(e){return e.recordsTotal||e.data.length||0}},pageSize:10,serverPaging:!0,serverFiltering:!0,serverSorting:!0},noRecords:!0,scrollable:!0,sortable:{mode:"multiple"},pageable:{change:function(e){b.index=e.index,h.info("page.index",b.index)}},filterable:!1,dataBinding:function(e){a.info("dataBinding")},dataBound:function(e){a.info("dataBound")},columns:i()},e.detailGridOptions=function(e){return{dataSource:{type:"odata",transport:{read:{url:"api/customer-config-activity-hazard-historical",dataType:"json",type:"POST",data:function(){var t={jobActivityHazardId:e.id};return t}},parameterMap:function(e,t){return JSON.stringify(e)}},requestEnd:function(e){},schema:{model:{id:"id",fields:{}},data:function(e){return e.data||e},total:function(e){return e.recordsTotal||e.data.length||0}},serverPaging:!0,serverSorting:!0,serverFiltering:!1,pageSize:10,filter:{field:"jobActivityHazardId",operator:"eq",value:e.id}},noRecords:!0,scrollable:!1,sortable:!0,pageable:!1,dataBound:function(e){a.info("dataBound child"),this.wrapper.css({width:this.wrapper.closest("div.k-parent")[0].offsetWidth-90+"px"})},columns:[{command:[{text:" ",template:"<a class='btn btn-info btn btn-xs' ng-click='onView(dataItem)' uib-tooltip='Ver Cambios' tooltip-placement='right'><i class='fa fa-eye'></i></a> "}],width:"50px"},r("type","Acción","100px"),r("source","Origen","200px"),r("name","Realizado Por",null),r("reason","Motivo de Actualización","300px"),r("reasonObservation","Observación del Motivo",null),r("createdAt","Fecha","150px",!1,l)]}}}),e.$on("kendoWidgetCreated",function(t,a){void 0!==e.grid&&null!==e.grid||(e.grid=a)}),e.onSelectWorkPlace=function(){e.grid.dataSource.read()},e.onSelectRisk=function(){e.grid.dataSource.read()},e.onClearWorkPlace=function(){e.filter.selectedWorkPlace=null,e.grid.dataSource.read()},e.onClearRisk=function(){e.filter.selectedRisk=null,e.grid.dataSource.read()},e.onView=function(t){var a=g.open({templateUrl:c.app.views.urlRoot+"modules/customer/diagnostic/tab-matrix/customer_diagnostic_risk_matrix_historical_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideMatrixJobActivityHazardHistoricalCtrl",scope:e,resolve:{entity:function(){return t}}});a.result.then(function(){},function(){})},e.onExportExcel=function(){jQuery("#downloadDocument")[0].src="api/customer-config-activity-hazard-historical/export?id="+t.customerId}}]),app.controller("ModalInstanceSideMatrixJobActivityHazardHistoricalCtrl",["$rootScope","$scope","$location","$uibModalInstance","entity","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile","$document","$stateParams",function(e,t,a,i,r,o,n,s,l,c,d,u,p,f,m,g,x){o.info("Historical Open"),t.entity=r,t.onCloseModal=function(){i.close(1)},t.onCancel=function(){i.dismiss("cancel")}}]);
"use strict";app.controller("customerDiagnosticRiskMatrixCharacterizationCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$translate","ListService","$aside","moment","ChartService",function(t,e,a,i,o,r,n,c,l,s,d,u,p,f,m,h,g,v){function b(){var a=[{name:"customer_config_acitivty_hazard_workplace_list",criteria:{customerId:e.customerId}}];m.getDataList(a).then(function(e){t.workplaceList=e.data.data.customerConfigAcitivtyHazardWorkplaceList,t.statusList=e.data.data.config_workplace_status},function(e){t.status="Unable to load customer data: "+e.message})}function y(){var a=[{name:"customer_config_acitivty_hazard_process_list",criteria:{customerId:e.customerId,workplace:t.filter.selectedWorkPlace?t.filter.selectedWorkPlace:null}},{name:"customer_config_acitivty_hazard_classification_list",criteria:{customerId:e.customerId,workplace:t.filter.selectedWorkPlace?t.filter.selectedWorkPlace:null,process:t.filter.selectedProcess?t.filter.selectedProcess:null}}];m.getDataList(a).then(function(e){t.processList=e.data.data.customerConfigAcitivtyHazardProcessList,t.classificationList=e.data.data.customerConfigAcitivtyHazardClassificationList},function(e){t.status="Unable to load customer data: "+e.message})}function C(){var a={customerId:e.customerId,workplace:t.filter.selectedWorkPlace?t.filter.selectedWorkPlace:null,process:t.filter.selectedProcess?t.filter.selectedProcess:null,classification:t.filter.selectedClassification?t.filter.selectedClassification:null},i=[{name:"chart_bar_options",criteria:null},{name:"chart_pie_options",criteria:null},{name:"customer_config_activity_hazard_characterization",criteria:a}];v.getDataChart(i).then(function(e){t.chart.bar.options=e.data.data.chartBarOptions,t.chart.pie.options=angular.copy(e.data.data.chartPieOptions),t.chart.pie.options.tooltips={callbacks:{label:function(t,e){x.info(e),x.info(t);var a=e.labels[t.index]||"";return a}}},t.chart.bar.options.legend.position="bottom",t.chart.pie.options.legend.position="bottom",t.chart.bar.options.maintainAspectRatio=!1,t.chart.bar.options.responsive=!1,t.chart.pie.options.maintainAspectRatio=!1,t.chart.pie.options.responsive=!1,t.chart.classification.data=e.data.data.matrixCharacterizationClassification,t.chart.acceptability.total.data=e.data.data.matrixCharacterizationAcceptability,t.chart.acceptability.classification.data=e.data.data.matrixCharacterizationAcceptabilityClassification,t.chart.acceptability.type.data=e.data.data.matrixCharacterizationAcceptabilityType,t.chart.intervention.data=e.data.data.matrixCharacterizationIntervention,t.chart.improvementPlan.data=e.data.data.matrixCharacterizationImprovement},function(e){t.status="Unable to load customer data: "+e.message})}var x=a,P={refresh:!0,index:0};t.filter={selectedWorkPlace:null,selectedProcess:null,selectedClassification:null},b(),y(),t.chart={bar:{options:null},pie:{options:null},classification:{data:null},acceptability:{total:{data:null},classification:{data:null},type:{data:null}},intervention:{data:null},improvementPlan:{data:null}},C(),d(function(){var i=function(){var t=[];return t.push(o("classification","Clasificación",null)),t.push(o("total","Total","100px",null)),t.push(o("acceptable","Aceptable","200px","success-header")),t.push(o("improvable","Mejorable","200px","info-header")),t.push(o("noAcceptableControl","No Aceptable o Aceptable con control especifico","200px","warning-header")),t.push(o("noAcceptable","No Aceptable","200px","danger-header")),t},o=function(t,e,a,i,o,r){return{field:t,title:e,width:a,headerAttributes:{"class":i,style:""==e?"display: none":""},filterable:void 0!==o&&o,template:"function"==typeof r?r:null}};t.mainGridOptions={dataSource:{type:"odata",transport:{read:{url:"api/customer-config-activity-hazard-characterization",dataType:"json",type:"POST",data:function(){var a={customerId:e.customerId};return null!==t.filter.selectedWorkPlace&&(a.workplaceId=t.filter.selectedWorkPlace.id),a}},parameterMap:function(t,e){return JSON.stringify(t)}},schema:{model:{id:"id",fields:{}},data:function(t){return t.data||t},total:function(t){return t.recordsTotal||t.data.length||0}},pageSize:10,serverPaging:!0,serverFiltering:!0,serverSorting:!0},noRecords:!0,scrollable:!0,sortable:{mode:"multiple"},pageable:{change:function(t){P.index=t.index,x.info("page.index",P.index)}},filterable:!1,dataBinding:function(t){a.info("dataBinding")},dataBound:function(e){a.info("dataBound"),t.grid.tbody.find("tr").each(function(){var e=t.grid.dataItem(this);void 0===e||null!=e.id&&""!=e.id?void 0!==e&&null!=e.id&&""!=e.id&&$(this).find(".btn-dark-azure").remove():$(this).find(".btn-success").remove()})},columns:i()},t.detailGridOptions=function(i){return{dataSource:{type:"odata",transport:{read:{url:"api/customer-config-activity-hazard-characterization-detail",dataType:"json",type:"POST",data:function(){var a={customerId:e.customerId,classificationId:i.id};return null!==t.filter.selectedWorkPlace&&(a.workplaceId=t.filter.selectedWorkPlace.id),a}},parameterMap:function(t,e){return JSON.stringify(t)}},requestEnd:function(t){},schema:{model:{id:"id",fields:{}},data:function(t){return t.data||t},total:function(t){return t.recordsTotal||t.data.length||0}},serverPaging:!1,serverSorting:!0,serverFiltering:!1,filter:{field:"classificationId",operator:"eq",value:i.id}},noRecords:!0,scrollable:!1,sortable:!0,pageable:!1,dataBound:function(t){a.info("dataBound child"),this.wrapper.css({width:this.wrapper.closest("div.k-parent")[0].offsetWidth-90+"px"})},columns:[{field:"type",title:"Tipo de Peligro",headerAttributes:{style:"display: none"}},o("total","","100px"),o("acceptable","","200px"),o("improvable","","200px"),o("noAcceptableControl","","200px"),o("noAcceptable","","200px")]}}}),t.$on("kendoWidgetCreated",function(e,a){void 0!==t.grid&&null!==t.grid||(t.grid=a)}),t.onSelectWorkPlace=function(){t.filter.selectedProcess=null,t.filter.selectedClassification=null,k()},t.onClearWorkPlace=function(){t.filter.selectedWorkPlace=null,k()},t.onSelectProcess=function(){k()},t.onClearProcess=function(){t.filter.selectedProcess=null,k()},t.onSelectClassification=function(){k()},t.onClearClassification=function(){t.filter.selectedClassification=null,k()};var k=function(){y(),C(),t.grid.dataSource.read()};t.onView=function(e){var a=h.open({templateUrl:s.app.views.urlRoot+"modules/customer/diagnostic/tab-matrix/customer_diagnostic_risk_matrix_historical_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideMatrixJobActivityHazardHistoricalCtrl",scope:t,resolve:{entity:function(){return e}}});a.result.then(function(){},function(){})},t.onExportExcel=function(){jQuery("#downloadDocument")[0].src="api/customer-config-activity-hazard-characterization/export?id="+e.customerId},t.onExportPdf=function(){kendo.drawing.drawDOM($(".characterization-export-pdf")).then(function(t){return kendo.drawing.exportPDF(t,{paperSize:"auto",margin:{left:"1cm",top:"1cm",right:"1cm",bottom:"1cm"}})}).done(function(t){kendo.saveAs({dataURI:t,fileName:"Caracterización.pdf",proxyURL:"//demos.telerik.com/kendo-ui/service/export"})})}}]),app.controller("ModalInstanceSideMatrixJobActivityHazardHistoricalCtrl",["$rootScope","$scope","$location","$uibModalInstance","entity","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile","$document","$stateParams",function(t,e,a,i,o,r,n,c,l,s,d,u,p,f,m,h,g){r.info("Historical Open"),e.entity=o,e.onCloseModal=function(){i.close(1)},e.onCancel=function(){i.dismiss("cancel")}}]);
"use strict";app.factory("ExpressMatrixService",function(){var n={},t=null,e=null,r=null;return n.setWorkplaceId=function(n){t=n},n.getWorkplaceId=function(){return t},n.setIsBackInNavigation=function(n){e=n},n.getIsBackInNavigation=function(){return t},n.setShouldCreateNewWorkplace=function(n){r=n},n.getShouldCreateNewWorkplace=function(){return r},n});
"use strict";app.controller("customerDiagnosticExoressMatrixCtrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout","$filter","ExpressMatrixService",function(t,e,r,o,i,a,n,c){t.views=[{name:"workplace",url:i.app.views.urlRoot+"modules/customer/diagnostic/tab-express-matrix/work-place/customer_diagnostic_express_matrix_work_place.htm"},{name:"priorization",url:i.app.views.urlRoot+"modules/customer/diagnostic/tab-matrix/customer_diagnostic_risk_matrix_priorization.htm"},{name:"historical",url:i.app.views.urlRoot+"modules/customer/diagnostic/tab-matrix/customer_diagnostic_risk_matrix_historical.htm"},{name:"characterization",url:i.app.views.urlRoot+"modules/customer/diagnostic/tab-matrix/customer_diagnostic_risk_matrix_characterization.htm"}],t.loading=!1,t.currentStep=0,t.getView=function(e){var r=n("filter")(t.views,{name:e});return r[0]},t.switchTab=function(e){a(function(){t.tabname=e})};var s=i.$on("wizardGoTo",function(t,e){p(e.newValue)});t.$on("$destroy",function(){s()}),t.form={next:function(e){t.toTheTop(),u()},prev:function(e){t.toTheTop(),l()},goTo:function(e,r){parseInt(t.currentStep)>parseInt(r)?(t.toTheTop(),c.setWorkplaceId(null),p(r)):e.$valid?(t.toTheTop(),c.setWorkplaceId(null),p(r)):errorMessage()},reset:function(t){t.$setPristine(!0)}};var u=function(){var e=t.currentStep;t.currentStep++,i.$emit("wizardNavigate",{newValue:t.currentStep,oldValue:e})},l=function(){var e=t.currentStep;t.currentStep--,i.$emit("wizardNavigate",{newValue:t.currentStep,oldValue:e})},p=function(e){var r=t.currentStep;t.currentStep=e,i.$emit("wizardNavigate",{newValue:t.currentStep,oldValue:r})}}]);
"use strict";app.controller("customerDiagnosticExpressMatrixWorkplaceCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$document","$location","$translate","$aside","ExpressMatrixService","$uibModal","ListService",function(t,e,a,n,i,o,r,s,l,c,u,p,d,w,m,f,h,x,k,g){function C(){var a=[{name:"customer_express_matrix_workplace_list",value:null,criteria:{customerId:e.customerId,isFullyConfigured:1}}];g.getDataList(a).then(function(e){t.workplaceList=e.data.data.customerExpressMatrixWorkplaceList,x.getShouldCreateNewWorkplace()&&(x.setShouldCreateNewWorkplace(null),t.onCreate())},function(e){t.status="Unable to load customer data: "+e.message})}t.customerId=e.customerId,t.isView="E"!=t.customer.matrixType;var b=c.$on("wizardNavigate",function(e,a){0==a.newValue&&(x.getIsBackInNavigation()||t.onRefresh(),x.setIsBackInNavigation(null),null!=x.getWorkplaceId()&&O({id:x.getWorkplaceId()},t.isView))});t.$on("$destroy",function(){b()}),C(),t.dtOptionsExpressMatrixWorkplace=n.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.customerId=e.customerId,JSON.stringify(t)},url:"api/customer-config-workplace-express",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){v()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,a,n){r(angular.element(e).contents())(t)}),t.dtColumnsExpressMatrixWorkplace=[i.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,a,n,i){var o="",r="",s='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar"  data-id="'+e.id+'"'+r+' >   <i class="fa fa-edit"></i></a> ',l='<a class="btn btn-info btn-xs viewRow lnk" href="#"  uib-tooltip="Ver" data-id="'+e.id+'" >   <i class="fa fa-eye"></i></a> ',c='<a class="btn btn-success btn-xs continueRow lnk" href="#"  uib-tooltip="Continuar" data-id="'+e.id+'" data-process="'+e.hasProcess+'" data-address="'+e.address+'" >   <i class="fa fa-play"></i></a> ';return o=l+s,"En Proceso"==e.status&&(o+=c),t.isView?l:o}),i.newColumn("name").withTitle(f.instant("grid.matrix.WORK-PLACE")).withOption("width",200).withOption("defaultContent",""),i.newColumn("country").withTitle("País").withOption("width",200).withOption("defaultContent",""),i.newColumn("state").withTitle("Departamento").withOption("width",200).withOption("defaultContent",""),i.newColumn("city").withTitle("Ciudad").withOption("width",200).withOption("defaultContent",""),i.newColumn(null).withTitle("Estado").withOption("width",200).renderWith(function(t,e,a,n){var i="";switch(t.status){case"Activo":i="label label-success";break;case"Inactivo":i="label label-danger";break;case"En Proceso":i="label label-inverse"}return'<span class="'+i+'">'+t.status+"</span>"})];var v=function(){angular.element("#dtExpressMatrixWorkplace a.editRow").on("click",function(){var e=angular.element(this).data("id");O({id:e},t.isView)}),angular.element("#dtExpressMatrixWorkplace a.viewRow").on("click",function(){var t=angular.element(this).data("id");O({id:t},!0)}),angular.element("#dtExpressMatrixWorkplace a.continueRow").on("click",function(){var e=angular.element(this).data("id"),a=angular.element(this).data("process"),n=angular.element(this).data("address");"Si"==a&&""!=n?(x.setWorkplaceId(e),c.$emit("wizardGoTo",{newValue:1})):O({id:e},t.isView)})};t.dtInstanceExpressMatrixWorkplaceCallback=function(e){t.dtInstanceExpressMatrixWorkplace=e},t.reloadData=function(){t.dtInstanceExpressMatrixWorkplace.reloadData()},t.onRefresh=function(){t.reloadData(),C()},t.onCreate=function(){t.workplaceList.length>0?d.swal({title:"¿Desea duplicar algún Centro de Trabajo? ",text:"",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Duplicar",cancelButtonText:"Cancelar",closeOnConfirm:!0,closeOnCancel:!0},function(e){e?D():O({id:0},t.isView)}):O({id:0},t.isView)};var O=function(e,a){var n=h.open({templateUrl:c.app.views.urlRoot+"modules/customer/diagnostic/tab-express-matrix/work-place/customer_diagnostic_express_matrix_work_place_modal.htm",placement:"right",size:"lg",backdrop:"static",controller:"ModalInstanceSideCustomerDiagnosticExpressMatrixWorkplaceCtrl",scope:t,resolve:{entity:function(){return e},isView:function(){return a},closeAfterCreate:function(){return!1}}});n.result.then(function(){t.onRefresh()},function(){t.onRefresh()})},D=function(){var e=k.open({templateUrl:c.app.views.urlRoot+"modules/customer/diagnostic/tab-express-matrix/work-place/customer_diagnostic_express_matrix_work_place_duplicate_modal.htm",controller:"ModalInstanceSideCustomerDiagnosticExpressMatrixWorkplaceDuplicateCtrl",windowTopClass:"top-modal",resolve:{isView:function(){return t.isView},workplaceList:function(){return t.workplaceList}}});e.result.then(function(e){t.onRefresh()},function(){t.onRefresh()})}}]);
"use strict";app.controller("ModalInstanceSideCustomerDiagnosticExpressMatrixWorkplaceCtrl",["$rootScope","$stateParams","$scope","$uibModalInstance","entity","isView","closeAfterCreate","$log","$timeout","SweetAlert","$http","toaster","$filter","$aside","$document","$compile","ListService","ExpressMatrixService",function(t,e,i,n,o,a,r,c,s,l,u,d,m,y,f,p,v,g){function w(){var t=[{name:"country",value:null},{name:"state",value:i.entity.country?i.entity.country.id:68},{name:"city",value:i.entity.state?i.entity.state.id:0},{name:"economic_activity",value:null},{name:"customer_express_matrix_process_list",criteria:{customerId:e.customerId}}];v.getDataList(t).then(function(t){if(i.countryList=t.data.data.countryList,i.stateList=t.data.data.stateList,i.cityList=t.data.data.cityList,i.economicActivityList=t.data.data.economicActivityList,i.availableProcessList=t.data.data.customerExpressMatrixProcessList,null==i.entity.country){var e=m("filter")(i.countryList,{code:"CO"},!0);i.entity.country=e.length>0?e[0]:null}if(null==i.entity.economicActivity){var n=i.economicActivityList.find(function(t){return t.id==(i.customer.economicActivity?i.customer.economicActivity.id:0)});i.entity.economicActivity=n?n:null,i.disableEconomicActivity=null!=n}},function(t){i.status="Unable to load customer data: "+t.message})}i.totalEmployee=0,i.isView=a,i.onNext=function(e){e.$dirty?A(!1,"nextButtom"):(i.onCancel(),g.setWorkplaceId(i.entity.id),t.$emit("wizardGoTo",{newValue:1}))},i.onCloseModal=function(){n.close(1)},i.onCancel=function(){n.dismiss("cancel")};var C=function(){i.entity={id:o.id,customerId:e.customerId,country:null,state:null,city:null,name:null,economicActivity:null,address:"",employeeDirect:0,employeeContractor:0,employeeMision:0,isActive:!0,processList:[]},L()},L=function(){i.submitText=0==i.entity.id?"Crear Centro de Trabajo":"Guardar Centro de Trabajo"};C(),w();var h=function(){if(i.entity.id){var t={id:i.entity.id};u({method:"GET",url:"api/customer-config-workplace/get",params:t})["catch"](function(t,e){}).then(function(t){i.entity=t.data.result;var e=i.entity.economicActivity?i.entity.economicActivity.id:-1;i.disableEconomicActivity=null==i.customer.economicActivity||i.customer.economicActivity.id==e,i.onChangeEmployeeNumber(),w()})["finally"](function(){})}};h(),i.onChangeEmployeeNumber=function(){var t=parseInt(i.entity.employeeDirect),e=parseInt(i.entity.employeeContractor),n=parseInt(i.entity.employeeMision);i.totalEmployee=t+e+n},i.onSelectCountry=function(){i.entity.state=null,i.entity.city=null,w()},i.onSelectState=function(){i.entity.city=null,w()},i.onAddProcess=function(){s(function(){null==i.entity.processList&&(i.entity.processList=[]),i.entity.processList.push({id:0,customerId:e.customerId,name:null})})},i.onRemoveProcess=function(t){l.swal({title:"¿Está seguro de eliminar el registro seleccionado?",text:"Esta acción no se podrá deshacer.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Eliminar",cancelButtonText:"Cancelar",closeOnConfirm:!0,closeOnCancel:!0},function(e){e?s(function(){var e=i.entity.processList[t];if(0!=e.id){var n={id:e.id};u({method:"POST",url:"api/customer-config-process-express-relation/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info"),i.entity.processList.splice(t,1)})["catch"](function(t){c.error(t),l.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}else i.entity.processList.splice(t,1)}):swal("Cancelación","La operación ha sido cancelada","error")})},i.form={submit:function(t){var e=null;if(t.$invalid){var n=null,e=null;for(n in t)"$"!=n[0]&&(null!==e||t[n].$valid||(e=t[n].$name),t[n].$pristine&&(t[n].$dirty=!0));return log.info(i.standard),angular.element(".ng-invalid[name="+e+"]").focus(),void l.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}A()},reset:function(t){}};var A=function(e,o){var a={},d=JSON.stringify(i.entity);return a.data=Base64.encode(d),u({method:"POST",url:"api/customer-config-workplace/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(a){s(function(){e=void 0===e||e,o=void 0===o?"submitButtom":"nextButton",i.customer.economicActivity=i.entity.economicActivity,e&&l.swal("Registro","La información ha sido guardada satisfactoriamente","success"),i.entity=a.data.result,L(),"nextButton"==o&&(i.onCancel(),g.setWorkplaceId(i.entity.id),t.$emit("wizardGoTo",{newValue:1})),r&&n.close(a.data.result)})})["catch"](function(t){c.error(t),l.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})}}]);
"use strict";app.controller("ModalInstanceSideCustomerDiagnosticExpressMatrixWorkplaceDuplicateCtrl",["$rootScope","$stateParams","$scope","$uibModalInstance","isView","$log","$timeout","SweetAlert","$http","toaster","$filter","$aside","$document","$compile","ListService","ExpressMatrixService","workplaceList",function(e,o,r,n,a,t,i,l,s,c,u,d,f,m,p,v,g){r.workplaceList=g,r.onCloseModal=function(){n.close(1)},r.onCancel=function(){n.dismiss("cancel")};var w=function(){r.entity={workplace:null,customer:o.customerId,module:null}};w(),r.form={submit:function(e){var o=null;if(e.$invalid){var n=null,o=null;for(n in e)"$"!=n[0]&&(null!==o||e[n].$valid||(o=e[n].$name),e[n].$pristine&&(e[n].$dirty=!0));return log.info(r.standard),angular.element(".ng-invalid[name="+o+"]").focus(),void l.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}y()},reset:function(e){}};var y=function(){var e={},o=JSON.stringify(r.entity);return e.data=Base64.encode(o),s({method:"POST",url:"api/customer-config-workplace/copy",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){i(function(){l.swal("Registro","La información ha sido duplicada satisfactoriamente","success"),r.onCloseModal()})})["catch"](function(e){t.error(e),l.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})}}]);
"use strict";app.controller("customerDiagnosticExpressMatrixJobCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$document","$location","$translate","$aside","ListService","ExpressMatrixService",function(e,t,a,r,o,i,s,c,l,n,u,d,p,m,f,k,$,x,W){function g(){var a=[{name:"customer_express_matrix_workplace_process_list",criteria:{customerId:t.customerId}},{name:"customer_express_matrix_job_list",criteria:{customerId:t.customerId}}];x.getDataList(a).then(function(t){if(e.workplaceList=t.data.data.customerExpressMatrixWorkplaceList,e.availableJobList=t.data.data.customerExpressMatrixJobList,e.isWorkplaceDisabled=null!=W.getWorkplaceId(),null!=W.getWorkplaceId()){var a=e.workplaceList.find(function(e){return e.id==W.getWorkplaceId()});a&&(e.filter.selectedWorkPlace=a,e.onSelectWorkPlace())}},function(t){e.status="Unable to load customer data: "+t.message})}e.isView="E"!=e.customer.matrixType;var v=n.$on("wizardNavigate",function(e,t){1==t.newValue&&(w(),g())});e.$on("$destroy",function(){v()}),e.filter={selectedWorkPlace:null};var w=function(){e.entity={id:0,processList:[]}};w();var L=function(t){if(t){var a={id:t};d({method:"GET",url:"api/customer-config-workplace/get",params:a})["catch"](function(e,t){}).then(function(t){e.entity=t.data.result,n.$emit("loadWorkplace",{newValue:t.data.result,message:"onLoad Workplace"})})["finally"](function(){})}};e.onSelectWorkPlace=function(){var t=e.filter.selectedWorkPlace?e.filter.selectedWorkPlace.id:0;L(t)}}]);
"use strict";app.controller("customerDiagnosticExpressMatrixJobDetailCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$document","$location","$translate","$aside","ListService","ExpressMatrixService","$filter","$sce",function(i,t,e,o,n,a,r,s,c,l,u,d,f,v,p,m,g,y,b,L,w){i.htmlTooltip=w.trustAsHtml("Actividad Rutinaria: Actividad que forma parte de un proceso de la organización, que se ha planificado y es estandarizable.<br><br>Actividad No Rutinaria: Actividad que no se ha planificado ni estandarizado dentro de un proceso de la organización o actividad que la organización determine como no rutinaria por  su baja frecuencia de ejecución."),i.isLoaded=!1,i.isNavigationButtonsDisabled=!0,i.isContinueButtonsDisabled=!0,i.isNavigationButtonsClicked=!1;var h=l.$on("wizardNavigate",function(t,e){1==e.newValue&&(i.isBackNavigationVisible=null!=b.getWorkplaceId())}),C=l.$on("loadWorkplace",function(t,e){i.workplace=e.newValue,i.availableActivityList=i.workplace.availableActivityList;var o=i.workplace.processList.findIndex(function(i){return 0==i.isFullyConfigured});u(function(){i.tabActive=o!=-1?o:0,A(i.workplace.processList[i.tabActive].id)},100)});i.$on("$destroy",function(){h(),C()});var B=function(){i.entity={id:0,customerId:t.customerId,name:null,jobList:[]}};B();var A=function(t){if(i.isLoaded=!1,t){var e={id:t};d({method:"GET",url:"api/customer-config-process-express-relation/get",params:e})["catch"](function(i,t){}).then(function(t){i.isLoaded=!0,i.entity=t.data.result,x(),E(),k()})["finally"](function(){})}},x=function(){i.processListToDuplicate=i.workplace.processList.filter(function(t,e){return 1==t.isFullyConfigured&&e<i.tabActive})},E=function(){i.isNavigationButtonsDisabled=0==i.entity.jobList.length,angular.forEach(i.entity.jobList,function(t,e){i.isNavigationButtonsDisabled||(i.isNavigationButtonsDisabled=void 0===t.activityList||null==t.activityList||!t.activityList.length>0)}),i.workplace.processList[i.tabActive].isFullyConfigured=i.isNavigationButtonsDisabled?0:1},k=function(){i.isContinueButtonsDisabled=0==i.workplace.processList.length,angular.forEach(i.workplace.processList,function(t,e){i.isContinueButtonsDisabled||(i.isContinueButtonsDisabled=1==!t.isFullyConfigured)})},D=function(t){angular.forEach(t.jobList,function(t){var e=i.availableJobList.findIndex(function(i){return i.name.trim().toUpperCase()==t.name.trim().toUpperCase()});e==-1&&i.availableJobList.push({id:0,name:t.name}),T(t)}),i.availableJobList=L("orderBy")(i.availableJobList,"name")},T=function(t){angular.forEach(t.activityList,function(t){var e=i.availableActivityList.findIndex(function(i){return i.name.trim().toUpperCase()==t.name.trim().toUpperCase()});e==-1&&i.availableActivityList.push({id:0,name:t.name})}),i.availableActivityList=L("orderBy")(i.availableActivityList,"name")};i.onSelectProcess=function(i){console.log(i),u(function(){A(i.id)},100)},i.onAddJob=function(){u(function(){null==i.entity.jobList&&(i.entity.jobList=[]),i.entity.jobList.push({id:0,customerId:t.customerId,processExpressRelationId:i.entity.id,jobExpressId:0,name:null,isActive:!0}),E(),k()})},i.onRemoveJob=function(t){f.swal({title:"¿Está seguro de eliminar el registro seleccionado?",text:"Esta acción no se podrá deshacer.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Eliminar",cancelButtonText:"Cancelar",closeOnConfirm:!0,closeOnCancel:!0},function(o){o?u(function(){var o=i.entity.jobList[t];if(0!=o.id){var n={id:o.id};d({method:"POST",url:"api/customer-config-job-express-relation/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info"),i.entity.jobList.splice(t,1),0==i.entity.jobList.length&&(i.workplace.processList[i.tabActive].isFullyConfigured=0),E(),k()})["catch"](function(i){e.error(i),f.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}else i.entity.jobList.splice(t,1),E(),k()}):swal("Cancelación","La operación ha sido cancelada","error")})},i.onAddActivity=function(i){u(function(){null==i.activityList&&(i.activityList=[]),i.activityList.push({id:(Math.floor(Math.random()*Math.floor(1e4))+1)*-1,customerId:t.customerId,jobExpressRelationId:i.id,activityExpressId:0,name:null,isRoutine:"0"}),E(),k()})},i.onRemoveActivity=function(i,t){f.swal({title:"¿Está seguro de eliminar el registro seleccionado?",text:"Esta acción no se podrá deshacer.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Eliminar",cancelButtonText:"Cancelar",closeOnConfirm:!0,closeOnCancel:!0},function(o){o?u(function(){var o=i.activityList[t];if(o.id>0){var n={id:o.id};d({method:"POST",url:"api/customer-config-activity-express-relation/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info"),i.activityList.splice(t,1),E(),k()})["catch"](function(i){e.error(i),f.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}else i.activityList.splice(t,1),E(),k()}):swal("Cancelación","La operación ha sido cancelada","error")})},i.onDuplicate=function(t){var o=i.workplace.processList[i.tabActive];o.processFromId=t.id,o.module="A";var n={data:Base64.encode(JSON.stringify(o))};return d({method:"POST",url:"api/customer-config-process-express-relation/copy",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(t){u(function(){i.entity=t.data.result,N(t.data.result,i.tabActive),E(),k(),x()})})["catch"](function(i){e.error(i),f.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})},i.onBack=function(t){console.log(t),b.setIsBackInNavigation(!0),l.$emit("wizardGoTo",{newValue:0}),t.$dirty&&I(!1,i.tabActive)},i.onContinue=function(t){console.log(t),t.$dirty&&I(!1,i.tabActive),l.$emit("wizardGoTo",{newValue:2})},i.onNext=function(t){console.log(t),t.$dirty&&(i.isNavigationButtonsClicked=!0,I(!1,i.tabActive,"navigationButtons")),u(function(){i.tabActive++,A(i.workplace.processList[i.tabActive].id)},100)},i.onPrevious=function(t){console.log(t),t.$dirty&&(i.isNavigationButtonsClicked=!0,I(!1,i.tabActive,"navigationButtons")),u(function(){i.tabActive--,A(i.workplace.processList[i.tabActive].id)},100)},i.onLeavingTab=function(t,e,o){console.log(t),console.log(e),console.log(o),o.$dirty&&!i.isNavigationButtonsClicked&&I(!1,e,"tabs")},i.form={submit:function(i){var t=null;if(i.$invalid){var e=null,t=null;for(e in i)"$"!=e[0]&&(null!==t||i[e].$valid||(t=i[e].$name),i[e].$pristine&&(i[e].$dirty=!0));return angular.element(".ng-invalid[name="+t+"]").focus(),void f.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}I()},reset:function(i){}};var I=function(t,e,o){var n={},a=JSON.stringify(i.entity);return n.data=Base64.encode(a),d({method:"POST",url:"api/customer-config-process-express-relation/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(n){u(function(){t=void 0===t||t,e=void 0===e||i.tabActive,o=void 0===o?null:o,"navigationButtons"==o&&(i.isNavigationButtonsClicked=!1),t&&(f.swal("Registro","La información ha sido guardada satisfactoriamente","success"),i.entity=n.data.result),N(n.data.result,e),D(n.data.result),x()})})["catch"](function(i){f.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})},N=function(t,e){i.workplace.processList[e].isFullyConfigured=t.isFullyConfigured}}]);
"use strict";app.controller("customerDiagnosticExpressMatrixHazardCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$document","$location","$translate","$aside","ListService","ExpressMatrixService",function(e,t,a,r,o,i,s,n,l,c,u,d,p,m,f,k,x,W,g){function w(){var a=[{name:"customer_express_matrix_workplace_list",criteria:{customerId:t.customerId,isFullyConfigured:1}}];W.getDataList(a).then(function(t){if(e.workplaceList=t.data.data.customerExpressMatrixWorkplaceList,e.isWorkplaceDisabled=null!=g.getWorkplaceId(),null!=g.getWorkplaceId()){var a=e.workplaceList.find(function(e){return e.id==g.getWorkplaceId()});a&&(e.filter.selectedWorkPlace=a,e.onSelectWorkPlace())}},function(t){e.status="Unable to load customer data: "+t.message})}function h(){var a={customerId:t.customerId,workplaceId:e.filter.selectedWorkPlace?e.filter.selectedWorkPlace.id:0,canExecuteBulkOperation:e.filter.selectedWorkPlace?e.filter.selectedWorkPlace.canExecuteBulkOperation:0},r=[{name:"customer_express_matrix_hazard_list",criteria:a},{name:"customer_express_matrix_workplace_stats",criteria:a}];W.getDataList(r).then(function(t){e.hazardList=t.data.data.customerExpressMatrixHazardList,e.stats=t.data.data.customerExpressMatrixWorkplaceStats;var a=e.hazardList.filter(function(e){return e.isActive&&e.questions==e.answers});e.isButtonContinueDisable=a.length!=e.hazardList.length,e.filter.selectedWorkPlace&&(e.filter.selectedWorkPlace.canExecuteBulkOperation=0)},function(t){e.status="Unable to load customer data: "+t.message})}e.isView="E"!=e.customer.matrixType,e.isButtonContinueDisable=!0;var $=c.$on("wizardNavigate",function(t,a){2==a.newValue&&(w(),e.isBackNavigationVisible=null!=g.getWorkplaceId())}),v=c.$on("modalClosedEvent",function(t){null!=e.filter.selectedWorkPlace&&e.onSelectWorkPlace()});e.$on("$destroy",function(){$(),v()}),e.filter={selectedWorkPlace:null},e.options={unit:"%",readOnly:!0,displayPrevious:!0,barCap:25,trackWidth:20,barWidth:20,trackColor:"rgba(92,184,92,.1)",barColor:"#5BC01E",textColor:"#000"};var _=function(){e.entity={id:0,processList:[]}};_(),e.onSelectWorkPlace=function(){h()},e.onAnswerQuestions=function(t){if(t.isActive){var a=x.open({templateUrl:c.app.views.urlRoot+"modules/customer/diagnostic/tab-express-matrix/hazard/customer_diagnostic_express_matrix_hazard_modal.htm",placement:"right",backdrop:"static",controller:"ModalInstanceSideCustomerDiagnosticExpressMatrixHazardCtrl",scope:e,resolve:{entity:function(){return t},isView:function(){return e.isView},hazardList:function(){return e.hazardList}}});a.result.then(function(){console.info("Modal closed at: "+new Date)},function(){console.info("Modal dismissed at: "+new Date)})}},e.onBack=function(){c.$emit("wizardGoTo",{newValue:1})},e.onContinue=function(){c.$emit("wizardGoTo",{newValue:3})}}]);
"use strict";app.controller("ModalInstanceSideCustomerDiagnosticExpressMatrixHazardCtrl",["$rootScope","$stateParams","$scope","$uibModalInstance","entity","hazardList","isView","$log","$timeout","SweetAlert","$http","toaster","$filter","$aside","$document","$compile","ListService",function(t,n,e,r,i,o,a,s,u,d,c,l,f,h,m,p,g){e.totalEmployee=0,e.isNavigationButtonsDisabled=!0,e.hazardListLength=o.length,e.currentHazardIndex=0,e.onCloseModal=function(){r.close(1)},e.onCancel=function(){r.dismiss("cancel")},r.closed.then(function(){e.isView||x(!1)});var v=function(){e.entity={id:i.id,name:i.name,customerId:n.customerId,workplaceId:i.workplaceId,questionMasterList:[],questionList:[],child:[]}};v();var y=function(){if(e.entity.id){var t={id:e.entity.id,customerId:e.entity.customerId,workplaceId:e.entity.workplaceId};c({method:"POST",url:"api/customer-config-question-express-hazard",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param({data:JSON.stringify(t)})}).then(function(t){u(function(){e.entity=t.data.result,q()})})["catch"](function(t){d.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})}};y();var I=function(t){var n=[],r=null;return e.entity.questionMasterList.forEach(function(e){r=e,t&&n.push(e)}),e.entity.questionList.forEach(function(t){r&&"N"==r.rate&&(t.rate="NA"),n.push(t)}),e.entity.child.forEach(function(e){var i=null;e.questionMasterList.forEach(function(e){i=e,t&&n.push(e)}),e.questionList.forEach(function(t){(r&&"N"==r.rate||i&&"N"==i.rate)&&(t.rate="NA"),n.push(t)})}),n},w=function(t){e.currentHazardIndex=o.findIndex(function(n){return n.id==t.id})};w(i);var q=function(){e.isNavigationButtonsDisabled=!0;var t=I(!1);e.isNavigationButtonsDisabled=i.questions!=t.filter(function(t){return null!=t.rate}).length};e.form={submit:function(t){var n=null;if(t.$invalid){var r=null,n=null;for(r in t)"$"!=r[0]&&(null!==n||t[r].$valid||(n=t[r].$name),t[r].$pristine&&(t[r].$dirty=!0));return log.info(e.standard),angular.element(".ng-invalid[name="+n+"]").focus(),void d.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}x()},reset:function(t){}};var x=function(n){var r=I(!0),i=JSON.stringify({id:e.entity.id,customerId:e.entity.customerId,workplaceId:e.entity.workplaceId,questions:r}),o={data:Base64.encode(i)};return c({method:"POST",url:"api/customer-config-question-express/batch",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(e){u(function(){n=void 0===n||n,n&&d.swal("Registro","La información ha sido guardada satisfactoriamente","success"),t.$emit("modalClosedEvent")})})["catch"](function(t){s.error(t),d.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};e.onChangeQuestionMaster=function(t){var n=t.questionMasterList.length,e=t.questionMasterList.filter(function(t){return"S"==t.rate}).length;t.showQuestions=0==n||n==e,q()},e.onChangeQuestion=function(){q()},e.onNext=function(t){t.$dirty&&x(!1),u(function(){e.currentHazardIndex++,i=o[e.currentHazardIndex],v(),y()},100)},e.onPrevious=function(t){t.$dirty&&x(!1),u(function(){e.currentHazardIndex--,i=o[e.currentHazardIndex],v(),y()},100)}}]);
"use strict";app.factory("ExpressDashboardService",function(){var n={},t=null,e=null,u=null,r=null,i=null,c=null,o=null;return n.setWorkplace=function(n){t=n},n.setHazard=function(n){e=n},n.setQuestion=function(n){u=n},n.setView=function(n){r=n},n.setIsBack=function(n){i=n},n.setHazardList=function(n){c=n},n.setTabIndex=function(n){o=n},n.getWorkplace=function(){return t},n.getHazard=function(){return e},n.getQuestion=function(){return u},n.getView=function(){return r},n.getIsBack=function(){return i},n.getHazardList=function(){return c},n.getTabIndex=function(){return o},n});
"use strict";app.controller("customerDiagnosticExpressMatrixDashboardCtrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout",function(t,e,o,r,a,c){t.view_section="hazard",t.currentHazardId=0,t.editMode="create",t.navToSection=function(e,o,r){c(function(){t.view_section=e,t.editMode=o,t.currentHazardId=r})}}]);
"use strict";app.controller("customerDiagnosticExpressMatrixDashboardHazardCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$document","$location","$translate","$aside","ListService","ExpressDashboardService","ExpressMatrixService",function(e,t,a,r,s,i,l,o,n,c,d,u,f,p,m,x,k,z,g,I){function L(){var a=[{name:"customer_express_matrix_workplace_with_qa",criteria:{customerId:t.customerId}}];null!=g.getWorkplace()&&(e.filter.selectedWorkPlace=g.getWorkplace()),z.getDataList(a).then(function(t){if(e.workplaceList=t.data.data.customerExpressMatrixWorkplaceList,e.isWorkplaceDisabled=null!=I.getWorkplaceId(),g.getIsBack())g.setIsBack(null),null!=g.getWorkplace()&&(e.filter.selectedWorkPlace=g.getWorkplace(),e.hazardList=g.getHazardList(),e.tabIndex=g.getTabIndex(),e.filter.selectedHazard=e.hazardList[e.tabIndex],h());else if(null!=I.getWorkplaceId()){var a=e.workplaceList.find(function(e){return e.id==I.getWorkplaceId()});a&&(e.filter.selectedWorkPlace=a,e.onSelectWorkPlace())}},function(t){e.status="Unable to load customer data: "+t.message})}function W(){var a={customerId:t.customerId,workplaceId:e.filter.selectedWorkPlace?e.filter.selectedWorkPlace.id:0,id:e.filter.selectedHazard?e.filter.selectedHazard.id:0,canExecuteBulkOperation:0},r=[{name:"customer_express_matrix_hazard_list",criteria:a}];z.getDataList(r).then(function(t){e.hazardList=t.data.data.customerExpressMatrixHazardList,g.setHazardList(t.data.data.customerExpressMatrixHazardList),void 0!==e.hazardStatsList&&null!=e.hazardStatsList&&0!=e.hazardStatsList.length||(g.setTabIndex(e.tabIndex),e.filter.selectedHazard=e.hazardList[e.tabIndex],h())},function(t){e.status="Unable to load customer data: "+t.message})}function h(){var a={customerId:t.customerId,workplaceId:e.filter.selectedWorkPlace?e.filter.selectedWorkPlace.id:0,id:e.filter.selectedHazard?e.filter.selectedHazard.id:0,year:e.filter.selectedYear?e.filter.selectedYear.value:null},r=[{name:"customer_express_matrix_hazard_stats_list",criteria:a}];z.getDataList(r).then(function(t){e.hazardStatsList=t.data.data.customerExpressMatrixHazardStatsList,e.yearList=t.data.data.customerExpressMatrixQuestionInterventionYearList,null==e.filter.selectedYear&&(e.filter.selectedYear=e.yearList.length>0?e.yearList[0]:null)},function(t){e.status="Unable to load customer data: "+t.message})}e.tabIndex=0,e.isView="E"!=e.customer.matrixType,e.filter={selectedWorkPlace:null,selectedHazard:null,selectedYear:null};var v=c.$on("wizardNavigate",function(e,t){3==t.newValue&&L()});e.$on("$destroy",function(){v()}),g.getIsBack()&&L(),e.onSelectWorkPlace=function(){W(),g.setWorkplace(e.filter.selectedWorkPlace)},e.onSelectYear=function(){h()},e.onSelectHazard=function(t,a){g.setTabIndex(a),e.filter.selectedHazard=t,h()},e.onAddIntervention=function(t){g.setHazard(t),null!=e.$parent&&e.$parent.navToSection("intervention","edit",0)},e.onViewSummary=function(){null!=e.$parent&&e.$parent.navToSection("summary","edit",0)},e.onExportPdf=function(e,t){kendo.drawing.drawDOM($(".express-matrix-hazard-export-pdf-"+t)).then(function(e){return kendo.drawing.exportPDF(e,{paperSize:"auto",margin:{left:"1cm",top:"1cm",right:"1cm",bottom:"1cm"}})}).done(function(t){kendo.saveAs({dataURI:t,fileName:"TABLERO_DE_PELIGRO_"+e.name+".pdf",proxyURL:"//demos.telerik.com/kendo-ui/service/export"})})},e.onExportExcel=function(a){var r={customerId:t.customerId,workplaceId:e.filter.selectedWorkPlace?e.filter.selectedWorkPlace.id:0,id:a.id,isHistorical:0};angular.element("#downloadHazardExcel")[0].src="api/customer-config-question-express-intervention/export-excel?data="+Base64.encode(JSON.stringify(r))}}]);
"use strict";app.controller("customerDiagnosticExpressMatrixInterventionCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$document","$location","$translate","$aside","ListService","ExpressDashboardService",function(e,t,n,i,r,o,s,a,c,l,u,d,f,p,m,v,I,g,x){console.log("customerDiagnosticExpressMatrixInterventionCtrl"),e.isView="E"!=e.customer.matrixType,e.currentIndex=-1,e.filter={view:"C",selectedWorkplace:x.getWorkplace(),selectedHazard:x.getHazard()},x.setView(e.filter.view);var w=l.$on("refreshHazardList",function(e,t){console.log("customerDiagnosticExpressMatrixInterventionCtrl refreshHazardList"),h()});e.$on("$destroy",function(){w()});var y=function(){e.entity={id:e.filter.selectedHazard?e.filter.selectedHazard.id:0,name:null,customerId:t.customerId,workplaceId:e.filter.selectedWorkplace?e.filter.selectedWorkplace.id:0,questionList:[]}};y();var h=function(){if(e.entity.id){var t={id:e.entity.id,customerId:e.entity.customerId,workplaceId:e.entity.workplaceId,isHistorical:"H"==e.filter.view};d({method:"POST",url:"api/customer-config-question-express-hazard-intervention",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param({data:JSON.stringify(t)})}).then(function(t){u(function(){if(null!=t.data.result)if(e.entity=t.data.result,e.entity.questionList.length>0)if(e.currentIndex==-1)e.onSelectQuestion(e.entity.questionList[0],0);else{var n=x.getQuestion(),i=e.entity.questionList.findIndex(function(e){return e.id==n.id});i==-1&&e.onSelectQuestion(e.entity.questionList[0],0)}else e.currentIndex=-1,l.$emit("clearIntervention",{message:"onClearIntervention"});else e.currentIndex=-1,e.entity.questionList=[],l.$emit("clearIntervention",{message:"onClearIntervention"})})})["catch"](function(e){f.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})}};h(),e.onSelectQuestion=function(t,n){e.currentIndex=n,x.setQuestion(t),l.$emit("selectQuestion",{message:"onSelect Question"})},e.onChangeView=function(){e.currentIndex=-1,x.setView(e.filter.view),h()},e.onBack=function(){null!=e.$parent&&(x.setIsBack(!0),e.$parent.navToSection("hazard","list",0))}}]);
"use strict";app.controller("customerDiagnosticExpressMatrixInterventionDetailCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$document","$location","$translate","$aside","ListService","ExpressDashboardService","FileUploader",function(e,t,n,i,o,r,a,s,l,u,c,d,f,m,p,v,g,D,x,h){function L(){var n={id:e.entity.id,customerId:e.entity.customerId,workplaceId:e.entity.workplaceId,isHistorical:"H"==e.filter.selectedView},i=[{name:"customer_express_matrix_question_intervention_list",criteria:n},{name:"customer_related_agent_user",value:t.customerId}];D.getDataList(i).then(function(t){e.interventionList=t.data.data.customerExpressMatrixQuestionInterventionList,e.responsibleList=t.data.data.customerRelatedAgentAndUserList,y()},function(t){e.status="Unable to load customer data: "+t.message})}console.log("customerDiagnosticExpressMatrixInterventionDetailCtrl");var I=0;e.minDate=new Date,e.minDate.setDate(e.minDate.getDate()-1),e.datePickerConfig={culture:"es-CO",format:"dd/MM/yyyy"};var w=u.$on("selectQuestion",function(e,t){console.log("customerDiagnosticExpressMatrixInterventionDetailCtrl selectQuestion"),C(),L()}),U=u.$on("clearIntervention",function(t,n){console.log("customerDiagnosticExpressMatrixInterventionDetailCtrl clearIntervention"),e.interventionList=[],e.filter.selectedQuestion=null});e.$on("$destroy",function(){w(),U()});var C=function(){e.filter={selectedView:x.getView(),selectedWorkplace:x.getWorkplace(),selectedHazard:x.getHazard(),selectedQuestion:x.getQuestion()},e.entity={id:e.filter.selectedQuestion?e.filter.selectedQuestion.id:0,name:null,customerId:t.customerId,workplaceId:e.filter.selectedWorkplace?e.filter.selectedWorkplace.id:0,questionList:[]}},y=function(){void 0!==e.interventionList&&null!==e.interventionList&&angular.forEach(e.interventionList,function(e,t){null!=e.executionDate&&(e.executionDate=new Date(e.executionDate.date)),E()})},E=function(){void 0!==e.fileUploader&&null!=e.fileUploader||(e.fileUploader=[]);var t=new h({url:"api/customer-config-question-express-intervention/upload",formData:[],removeAfterUpload:!0});t.filters.push({name:"enforceMaxFileSize",fn:function(e){return e.size<=10485760}}),t.filters.push({name:"enforceExtension",fn:function(e){return/\.(jpg|jpeg|png|pdf|doc|docx|xls|xlsx)$/i.test(e.name)}}),e.fileUploader.push(t),e.fileUploader[e.fileUploader.length-1].onBeforeUploadItem=function(e){console.info("onBeforeUploadItem",e);var t={id:I};e.formData.push(t)},e.fileUploader[e.fileUploader.length-1].onCompleteItem=function(t,n,i,o){if(n&&n.result){var r=e.interventionList.findIndex(function(e){return e.id==n.result.id});r!=-1&&(e.interventionList[r]=n.result,null!=e.interventionList[r].executionDate&&(e.interventionList[r].executionDate=new Date(e.interventionList[r].executionDate.date)))}},e.fileUploader[e.fileUploader.length-1].onCompleteAll=function(){console.info("onCompleteAll"),u.$emit("refreshHazardList",{message:"onRefresh Hazard List"})},e.fileUploader[e.fileUploader.length-1].filters.push({name:"customFilter",fn:function(e,t){return this.queue.length<10}})};e.onAddIntervention=function(){null==e.interventionList&&(e.interventionList=[]),e.interventionList.push({id:0,customerId:t.customerId,customerQuestionExpressId:e.entity.id,name:"",description:"",responsible:null,amount:0,executionDate:null,isClosed:!1,status:!1,files:[],isOpen:!0}),E()},e.onDownload=function(e){angular.element("#downloadIntervention")[0].src="api/customer-config-question-express-intervention/download?id="+e},e.onChangeExecutionDate=function(){},e.onChangeView=function(){},e.onSubmit=function(e,t,n){var i=e["FormIntervention"+t];if(i.$invalid){var o=null,r=null;for(o in i)"$"!=o[0]&&(null!==r||i[o].$valid||(r=i[o].$name),i[o].$pristine&&(i[o].$dirty=!0));return angular.element(".ng-invalid[name="+r+"]").focus(),void f.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}Q(t,n)},e.getForm=function(e){return this["Form"+e]};var Q=function(t,n){if(null==n.executionDate||""==n.executionDate)return void f.swal("El formulario contiene errores!","Por favor selecciona la fecha de ejecución.","error");var i=JSON.stringify(n),o={data:Base64.encode(i)};return d({method:"POST",url:"api/customer-config-question-express-intervention/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(n){c(function(){e.interventionList[t]=n.data.result,null!=e.interventionList[t].executionDate&&(e.interventionList[t].executionDate=new Date(e.interventionList[t].executionDate.date)),e.fileUploader[t].queue.length>0?(I=n.data.result.id,e.fileUploader[t].uploadAll()):u.$emit("refreshHazardList",{message:"onRefresh Hazard List"}),f.swal("Registro","La información ha sido guardada satisfactoriamente","success")})})["catch"](function(e){f.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})}}]);
"use strict";app.controller("ModalInstanceSideCustomerDiagnosticExpressMatrixInterventionDetailCtrl",["$rootScope","$stateParams","$scope","$uibModalInstance","entity","isView","$log","$timeout","SweetAlert","$http","toaster","$filter","$aside","$document","$compile","ListService","ExpressMatrixService","FileUploader",function(e,t,n,o,r,a,i,l,s,u,c,d,f,m,p,v,g,y){function h(){var e=[{name:"customer_related_agent_user",value:t.customerId}];v.getDataList(e).then(function(e){n.responsibleList=e.data.data.customerRelatedAgentAndUserList},function(e){n.status="Unable to load customer data: "+e.message})}var x=null;n.datePickerConfig={culture:"es-CO",format:"dd/MM/yyyy"},n.onCloseModal=function(){o.close(1)},n.onCancel=function(){o.dismiss("cancel")};var w=function(){n.entity=r};w(),h();var U=function(){var t=new y({url:"api/customer-config-question-express-intervention/upload",formData:[],removeAfterUpload:!0});t.filters.push({name:"enforceMaxFileSize",fn:function(e){return e.size<=10485760}}),t.filters.push({name:"enforceExtension",fn:function(e){return/\.(jpg|jpeg|png|pdf|doc|docx|xls|xlsx)$/i.test(e.name)}}),n.fileUploader=t,n.fileUploader.onBeforeUploadItem=function(e){console.info("onBeforeUploadItem",e);var t={id:x};e.formData.push(t)},n.fileUploader.onCompleteItem=function(e,t,o,r){t&&t.result&&(n.entity=t.result,D())},n.fileUploader.onCompleteAll=function(){console.info("onCompleteAll"),e.$emit("refreshHazardList",{message:"onRefresh Hazard List"})},n.fileUploader.filters.push({name:"customFilter",fn:function(e,t){return this.queue.length<10}})};U();var D=function(){null!=n.entity.executionDate&&(n.entity.executionDate=new Date(n.entity.executionDate.date))};n.form={submit:function(e){var t=null;if(e.$invalid){var o=null,t=null;for(o in e)"$"!=o[0]&&(null!==t||e[o].$valid||(t=e[o].$name),e[o].$pristine&&(e[o].$dirty=!0));return log.info(n.standard),angular.element(".ng-invalid[name="+t+"]").focus(),void s.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}C()},reset:function(e){}};var C=function(){if(null==n.entity.executionDate||""==n.entity.executionDate)return void s.swal("El formulario contiene errores!","Por favor selecciona la fecha de ejecución.","error");var e=JSON.stringify(n.entity),t={data:Base64.encode(e)};return u({method:"POST",url:"api/customer-config-question-express-intervention/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(e){l(function(){n.entity=e.data.result,n.entity.factor=r.factor,n.entity.subfactor=r.subfactor,n.entity.hazard=r.hazard,D(),n.fileUploader.queue.length>0&&(x=e.data.result.id,n.fileUploader.uploadAll()),s.swal("Registro","La información ha sido guardada satisfactoriamente","success")})})["catch"](function(e){s.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};n.onDownload=function(e){angular.element("#downloadIntervention")[0].src="api/customer-config-question-express-intervention/download?id="+e}}]);
"use strict";app.controller("customerDiagnosticExpressMatrixDashboardSummaryCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$document","$location","$translate","$aside","ListService","ExpressDashboardService","ChartService","ExpressMatrixService",function(e,t,n,i,a,r,o,s,l,c,u,d,p,m,f,h,g,v,x,w,k){function I(){var n=[{name:"customer_express_matrix_workplace_with_qa",criteria:{customerId:t.customerId}}];v.getDataList(n).then(function(t){e.workplaceList=t.data.data.customerExpressMatrixWorkplaceList,e.workplaceList.push({id:0,name:"Matriz General"}),null==e.filter.selectedWorkPlace&&(e.filter.selectedWorkPlace=e.workplaceList[e.workplaceList.length-1]),D(),C()},function(t){e.status="Unable to load customer data: "+t.message})}function D(){var n={customerId:t.customerId,isHistorical:!1,isClosed:!1};e.filter.selectedWorkPlace&&0!=e.filter.selectedWorkPlace.id&&(n.workplaceId=e.filter.selectedWorkPlace.id),null!=e.filter.selectedYear&&(n.year=e.filter.selectedYear.value);var i=[{name:"customer_express_matrix_question_intervention_list",criteria:n},{name:"customer_express_matrix_hazard_general_stats",criteria:n}];v.getDataList(i).then(function(t){e.interventionList=t.data.data.customerExpressMatrixQuestionInterventionList,e.interventionListFilter=t.data.data.customerExpressMatrixQuestionInterventionList,e.generalStats=t.data.data.customerExpressMatrixHazardGeneralStats,e.yearList=t.data.data.customerExpressMatrixQuestionInterventionYearList,void 0!==e.interventionList&&null!==e.interventionList&&angular.forEach(e.interventionList,function(e,t){null!=e.executionDate&&(e.executionDate=new Date(e.executionDate.date))}),null==e.filter.selectedYear&&(e.filter.selectedYear=e.yearList.length>0?e.yearList[0]:null),b()},function(t){e.status="Unable to load customer data: "+t.message})}function C(){var n={customerId:t.customerId,isHistorical:!1};e.filter.selectedWorkPlace&&0!=e.filter.selectedWorkPlace.id&&(n.workplaceId=e.filter.selectedWorkPlace.id),null!=e.filter.selectedYear&&(n.year=e.filter.selectedYear.value);var i=[{name:"chart_doughnut_options",criteria:null},{name:"customer_express_matrix_hazard_intervention_stats",criteria:n}];w.getDataChart(i).then(function(t){e.chart.doughnut.options=angular.copy(t.data.data.chartDoughnutOptions),e.chart.doughnut.options.legend.position="bottom",e.chart.doughnut.options.maintainAspectRatio=!1,e.chart.doughnut.options.responsive=!1,e.chart.doughnut.options.cutoutPercentage=70,e.chart.intervention.data=t.data.data.customerExpressMatrixHazardInterventionStats},function(t){e.status="Unable to load customer data: "+t.message})}e.isView="E"!=e.customer.matrixType,e.isWorkplaceDisabled=!1,e.calendarWidget=null,e.calendarDate=null,e.filter={selectedWorkPlace:null,selectedHazard:null,selectedYear:null},e.chart={doughnut:{options:null},intervention:{data:null}},e.calendarOptions={weekNumber:!0,month:{content:'# if ($.inArray(+data.date, data.dates) != -1) { #<div class="intervention-date">#= data.value #</div># } else { ##= data.value ## } #',weekNumber:'<a class="italic">#= data.weekNumber #</a>'},footer:!1},e.$on("kendoWidgetCreated",function(t,n){null==e.calendarWidget&&(e.calendarWidget=n)}),I();var b=function(){void 0!==e.interventionList&&null!==e.interventionList&&(e.calendarOptions.dates=e.interventionList.filter(function(e){return null!=e.executionDate}).map(function(e){return+e.executionDate}),e.calendarWidget.setOptions(e.calendarOptions))};e.onChangeCalendar=function(){null!=e.calendarDate&&(e.interventionListFilter=e.interventionList.filter(function(t){return t.executionDate.getTime()==e.calendarDate.getTime()}))},e.onViewDetail=function(){null!=e.$parent&&(x.setIsBack(!0),e.$parent.navToSection("hazard","list",0))},e.onCreate=function(){k.setIsBackInNavigation(!0),k.setShouldCreateNewWorkplace(!0),k.setWorkplaceId(null),c.$emit("wizardGoTo",{newValue:0})},e.onSelectWorkPlace=function(){e.reloadData(),e.calendarDate=null,D(),C()},e.onSelectYear=function(){D(),C()},e.onSelectIntervention=function(t){var n=g.open({templateUrl:c.app.views.urlRoot+"modules/customer/diagnostic/tab-express-matrix/dashboard/intervention/customer_diagnostic_express_matrix_dashboard_intervention_modal.htm",placement:"right",size:"lg",backdrop:"static",controller:"ModalInstanceSideCustomerDiagnosticExpressMatrixInterventionDetailCtrl",scope:e,resolve:{entity:function(){return t},isView:function(){return e.isView}}});n.result.then(function(){e.reloadData(),D(),C()},function(){D(),C()})},e.dtOptionsCustomerConfigQuestionExpressInterventionResponsible=i.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(n){return n.customerId=t.customerId,e.filter.selectedWorkPlace&&0!=e.filter.selectedWorkPlace.id&&(n.workplaceId=e.filter.selectedWorkPlace.id),JSON.stringify(n)},url:"api/customer-config-question-express-intervention-responsible",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,n,i){o(angular.element(t).contents())(e)}),e.dtColumnsCustomerConfigQuestionExpressInterventionResponsible=[a.newColumn("responsibleName").withTitle("Nombre").withOption("width",200).withOption("defaultContent",""),a.newColumn("responsibleEmail").withTitle("E-mail").withOption("width",200).withOption("defaultContent",""),a.newColumn("qty").withTitle("Tareas Asignadas").withOption("width",200).withOption("defaultContent","")],e.dtInstanceCustomerConfigQuestionExpressInterventionResponsibleCallback=function(t){e.dtInstanceCustomerConfigQuestionExpressInterventionResponsible=t},e.reloadData=function(){null!=e.dtInstanceCustomerConfigQuestionExpressInterventionResponsible&&e.dtInstanceCustomerConfigQuestionExpressInterventionResponsible.reloadData()},e.onExportPdf=function(){kendo.drawing.drawDOM($(".express-matrix-dashboard-export-pdf")).then(function(e){return kendo.drawing.exportPDF(e,{paperSize:"auto",margin:{left:"1cm",top:"1cm",right:"1cm",bottom:"1cm"}})}).done(function(e){kendo.saveAs({dataURI:e,fileName:"TABLERO_GENERAL_PELIGROS.pdf",proxyURL:"//demos.telerik.com/kendo-ui/service/export"})})},e.onExportExcel=function(){var n={customerId:t.customerId,isHistorical:0};e.filter.selectedWorkPlace&&0!=e.filter.selectedWorkPlace.id&&(n.workplaceId=e.filter.selectedWorkPlace.id),angular.element("#downloadGeneralDashboardExcel")[0].src="api/customer-config-question-express-intervention/export-excel-general?data="+Base64.encode(JSON.stringify(n))}}]);
"use strict";app.controller("customerDiagnosticCtrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout",function(t,i,o,n,c,a){var s=o;t.diagnostic_section="list",t.currentDiagnostic=0,t.navToSection=function(i,o,n){s.info("cambiando la vista a... section:",i," titlenav:",o," currentDiagnostic:",n),a(function(){t.diagnostic_section=i,t.$parent.switchSubTab(o),t.currentDiagnostic=n})}}]);
"use strict";app.controller("customerDiagnosticListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert",function(n,a,t,e,i,o,r,l,c,s,d,u,m){var p=t;n.canCreate=!1,n.dtInstanceDiagnostic={},n.dtOptionsDiagnostic=e.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(n){return n.customerId=a.customerId,JSON.stringify(n)},url:"api/customer-diagnostic",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){f()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(a,t,e){r(angular.element(a).contents())(n)}),n.dtColumnsDiagnostic=[i.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(n,a,t,e){var i="",o="";"Completado"!=n.status&&"Cancelado"!=n.status||(o='disabled="disabled"');var r='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Continuar"  data-id="'+n.id+'"'+o+' >   <i class="fa fa-play-circle"></i></a> ',l='<a class="btn btn-danger btn-xs delRow lnk" href="#"  uib-tooltip="Eliminar" data-id="'+n.id+'"'+o+' >   <i class="fa fa-trash-o"></i></a> ',c='<a class="btn btn-blue btn-xs cancelRow lnk" href="#" uib-tooltip="Cancelar" data-id="'+n.id+'"'+o+' >   <i class="fa fa-ban"></i></a> ';return s.can("diagnostico_view"),s.can("diagnostico_continue")&&(i+=r),s.can("clientes_delete")&&(i+=l),s.can("diagnostico_cancel")&&(i+=c),i}),i.newColumn("status").withTitle("Estado").withOption("width",200).renderWith(function(n,a,t,e){var i="";switch(n){case"Completado":i="label label-success";break;case"Cancelado":i="label label-inverse";break;case"Iniciado":i="label label-warning"}var o='<span class="'+i+'">'+n+"</span>";return o}),i.newColumn("createdBy").withTitle("Asesor"),i.newColumn("createdAt").withTitle("Fecha Creación").withOption("width",200),i.newColumn("endDate").withTitle("Fecha Finalización").withOption("width",200)];var f=function(){angular.element("#dtCustomerDiagnostic a.editRow").on("click",function(){var a=angular.element(this).data("id");n.onEdit(a)}),angular.element("#dtCustomerDiagnostic a.delRow").on("click",function(){var a=angular.element(this).data("id");m.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(e){if(e){var i={};i.id=a,u({method:"POST",url:"api/diagnostic/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(n){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(n){t.error(n),m.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){n.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})}),angular.element("#dtCustomerDiagnostic a.cancelRow").on("click",function(){var a=angular.element(this).data("id");m.swal({title:"Está seguro?",text:"Cancelará el diagnóstico seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, cancelar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(e){if(e){var i={};i.id=a,u({method:"POST",url:"api/diagnostic/cancel",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(n){swal("Eliminado","Diagnóstico cancelado satisfactoriamente","info")})["catch"](function(n){t.error(n),m.swal("Error en la cancelación","Se ha presentado un error durante la cancelacón del diagnóstico por favor intentelo de nuevo","error")})["finally"](function(){n.reloadData()})}else swal("Terminado","Operación terminada","error")})})};n.dtInstanceDiagnosticCallback=function(a){n.dtInstanceDiagnostic=a},n.reloadData=function(){n.dtInstanceDiagnostic.reloadData(),w()},n.onEdit=function(a){null!=n.$parent&&n.$parent.navToSection("summary","summary",a)},n.onCreate=function(){var t={},e={id:0,customerId:a.customerId,status:{id:0,item:"Iniciado",value:"iniciado"},arlActivity:null,arlIntermediaryActivity:null,arlIntermediaryNit:null,arlIntermediaryName:null,arlIntermediaryLicence:null,arlIntermediaryRegister:null,dateFrom:null,dateTo:null},i=JSON.stringify(e);t.data=Base64.encode(i),u({method:"POST",url:"api/diagnostic/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(a){null!=n.$parent&&n.$parent.navToSection("summary","summary",a.data.result.id)})["catch"](function(n){p.error(n),m.swal("Error Creando","Se ha presentado un error durante la creación del diagnóstico por favor intentelo de nuevo","error")})["finally"](function(){})};var w=function(){var t={};t.customer_id=a.customerId,u({method:"POST",url:"api/diagnostic/canCreate",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(a){n.canCreate=a.data.data})["catch"](function(n){})["finally"](function(){})};w()}]);
"use strict";app.controller("customerDiagnosticSummaryCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","ChartService",function(t,n,a,o,i,e,r,c,s,l,u,p,d,m){function h(){var n={diagnosticId:g},a=[{name:"chart_bar_options",criteria:null},{name:"chart_doughnut_options",criteria:null},{name:"customer_diagnostic",criteria:n}];m.getDataChart(a).then(function(n){t.chart.bar.options=n.data.data.chartBarOptions,t.chart.doughnut.options=n.data.data.chartLineOptions,t.chart.programs.data=n.data.data.customerDiagnosticProgram,t.chart.progress.data=n.data.data.customerDiagnosticProgress,t.chart.progress.total=n.data.data.customerDiagnosticAverage},function(n){t.status="Unable to load customer data: "+n.message})}var w=n.customerId,g=t.$parent.currentDiagnostic;t.chart={bar:{options:null},doughnut:{options:null},programs:{data:null},progress:{data:null,total:0}},h(),t.dtInstanceDiagnosticSummary={},t.dtOptionsDiagnosticSummary=o.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.operation="diagnostic",t.customer_id=w,t.diagnostic_id=g,t},url:"api/diagnostic/summary",type:"POST",beforeSend:function(){},complete:function(t){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withDOM("tr").withOption("createdRow",function(n,a,o){r(angular.element(n).contents())(t)}),t.dtColumnsDiagnosticSummary=[i.newColumn("abbreviation").withTitle("Código").withOption("width",200),i.newColumn("name").withTitle("Programa").withOption("width",400),i.newColumn("questions").withTitle("Preguntas").withOption("width",200),i.newColumn("answers").withTitle("Respuestas").withOption("width",200),i.newColumn("advance").withTitle("Avance (%)").withOption("width",200),i.newColumn("average").withTitle("Promedio Total (%)").withOption("width",200),i.newColumn(null).withTitle("Estado").withOption("width",200).renderWith(function(t,n,a,o){var i="label label-danger",e="Sin Iniciar";parseInt(t.answers)==parseInt(t.questions)?(e="Completado",i="label label-info"):parseInt(t.answers)>0&&(e="Iniciado",i="label label-success");var r='<span class="'+i+'">'+e+"</span>";return r}).notSortable()],t.dtInstanceDiagnosticSummaryCallback=function(n){t.dtInstanceDiagnosticSummary=n},t.reloadData=function(){t.dtInstanceDiagnosticSummary.reloadData()},t.onContinue=function(){null!=t.$parent&&t.$parent.navToSection("edit","edit",t.$parent.currentDiagnostic)},t.onCancel=function(n){null!=t.$parent&&t.$parent.navToSection("list","list")},t.onViewReport=function(n){null!=t.$parent&&t.$parent.navToSection("report","report",t.$parent.currentDiagnostic)},t.onViewReporttMonthly=function(){null!=t.$parent&&t.$parent.navToSection("report_monthly","report_monthly",t.$parent.currentDiagnostic)},t.onExportPdf=function(){kendo.drawing.drawDOM($(".diagnostic-export-pdf")).then(function(t){return kendo.drawing.exportPDF(t,{paperSize:"auto",margin:{left:"1cm",top:"1cm",right:"1cm",bottom:"1cm"}})}).done(function(t){kendo.saveAs({dataURI:t,fileName:"Diagnóstico.pdf",proxyURL:"//demos.telerik.com/kendo-ui/service/export"})})},t.onExportExcel=function(){jQuery("#downloadDocument")[0].src="api/diagnostic/summary/export-excel?id="+t.$parent.currentDiagnostic}}]);
"use strict";app.controller("customerDiagnosticEditCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","SweetAlert","$rootScope","$http","$timeout","$uibModal","flowFactory","cfpLoadingBar","$document","$filter","$aside","FileUploader","ChartService","ListService",function(t,e,n,i,a,o,r,l,c,s,d,u,m,p,f,w,h,g,v,b,C,D){function O(){var e={diagnosticId:I},n=[{name:"chart_bar_options",criteria:null},{name:"chart_doughnut_options",criteria:null},{name:"customer_diagnostic",criteria:e}];C.getDataChart(n).then(function(e){t.chart.bar.options=e.data.data.chartBarOptions,t.chart.doughnut.options=e.data.data.chartLineOptions,t.chart.programs.data=e.data.data.customerDiagnosticProgram,t.chart.progress.data=e.data.data.customerDiagnosticProgress,t.chart.progress.total=e.data.data.customerDiagnosticAverage},function(e){t.status="Unable to load customer data: "+e.message})}function y(){var e=[{name:"customer_diagnostic_prevention_program",value:I}];D.getDataList(e).then(function(e){t.chapters=e.data.data.customerDiagnosticPreventionProgram,k()},function(e){t.status="Unable to load customer data: "+e.message})}t.rateList=d.rates(),t.currentStep=-1;var S=n,T={refresh:!0,index:0},x={id:0,code:null},P={model:null},I=t.$parent.currentDiagnostic;t.chart={bar:{options:null},doughnut:{options:null},programs:{data:null},progress:{data:null,total:0}},O(),y();var k=function(){if(0==x.id){var e=g("filter")(t.chapters,function(t){return parseFloat(t.advance)<100});t.currentStep=e.length>0?t.chapters.indexOf(e[0]):t.chapters.length-1,x.id=t.chapters[t.currentStep].id,x.code=t.chapters[t.currentStep].abbreviation,t.grid.dataSource.read()}},A=function(){y(),O(),t.grid.dataSource.read()};t.rateOptions={dataSource:t.rateList,dataTextField:"text",dataValueField:"id",change:function(){},select:function(e){var n=this.dataItem(e.item);P.model&&P.model.rateId!=n.id&&(P.model.rate=n,t.onSave(P.model))}},m(function(){t.mainGridOptions={dataSource:{type:"odata",transport:{read:{url:"api/customer-diagnostic-prevention",dataType:"json",type:"POST",data:function(){var t={diagnosticId:I,sizeOf:I,programId:x.id};return t}},parameterMap:function(t,e){return JSON.stringify(t)}},schema:{model:{id:"id",fields:{description:{editable:!1,nullable:!0},documentNumber:{editable:!1,nullable:!0},businessName:{editable:!1,nullable:!0},isActive:{editable:!1,nullable:!0,type:"boolean"}}},data:function(t){return t.data||t},total:function(t){return t.recordsTotal||t.data.length||0}},pageSize:10,serverPaging:!0,serverFiltering:!0,serverSorting:!0},sortable:{mode:"multiple"},pageable:{change:function(t){T.index=t.index,S.info("page.index",T.index)}},filterable:{mode:"row"},dataBound:function(t){this.expandRow(this.tbody.find("tr.k-master-row"))},columns:[{field:"name",title:"Categoría",attributes:{"class":"text-orange text-large"},filterable:{cell:{operator:"contains",suggestionOperator:"contains"}}},{field:null,title:"Avance",width:"150px",attributes:{style:"text-align: center"},filterable:!1,template:function(t){var e='<h4 class="no-margin">'+t.advance+"%</h4>";return e+='<uib-progressbar value="'+t.advance+'" class="progress-xs no-radius no-margin" type="success"></uib-progressbar>',e+=t.answers+" de "+t.questions}},{field:null,title:"Promedio",width:"150px",attributes:{style:"text-align: center"},filterable:!1,template:function(t){var e='<h4 class="no-margin">'+t.average+"%</h4>";return e+='<uib-progressbar value="'+t.total+'" class="progress-xs no-radius no-margin" type="success"></uib-progressbar>',e+="Promedio Total"}}]},t.detailGridOptions=function(t){return{dataSource:{type:"odata",transport:{read:{url:"api/customer-diagnostic-prevention-question",dataType:"json",type:"POST",data:function(){var e={categoryId:t.id,diagnosticId:I,sizeOf:I,programId:x.id};return e}},parameterMap:function(t,e){return JSON.stringify(t)}},requestEnd:function(t){},schema:{model:{id:"id",fields:{description:{editable:!1,nullable:!0},article:{editable:!1,nullable:!0},rate:{editable:!0,defaultValue:{id:0,text:null,code:null}}}},data:function(t){return t.data||t},total:function(t){return t.recordsTotal||t.data.length||0}},serverPaging:!0,serverSorting:!0,serverFiltering:!1,pageSize:10,filter:{field:"categoryId",operator:"eq",value:t.id}},editable:"incell",edit:function(t){P.model=t.model},scrollable:!1,sortable:!0,pageable:!1,columns:[{command:[{text:" ",template:"<a class='btn btn-dark-azure btn btn-sm' ng-click='onAddGuide(dataItem)' uib-tooltip='Guía implementación' tooltip-placement='right'><i class='fa fa-info-circle'></i></a> "},{text:" ",template:"<a class='btn btn-light-red btn btn-sm' ng-click='onAddComment(dataItem)' uib-tooltip='Comentarios' tooltip-placement='right'><i class='fa fa-comments'></i></a> "},{text:" ",template:"<a class='btn btn-warning btn btn-sm' ng-click='onAddImprovementPlan(dataItem)' uib-tooltip='Plan Mejoramiento' tooltip-placement='right'><i class='fa fa-plus-square'></i></a> "},{text:" ",template:"<a class='btn btn-info btn btn-sm' ng-click='onAddAttachment(dataItem)' uib-tooltip='Anexos' tooltip-placement='right'><i class='fa fa-paperclip'></i></a> "}],width:"160px",headerAttributes:{style:"display: none"}},{field:"description",title:"Descripción",headerAttributes:{style:"display: none"}},{field:"article",title:"Artículo",width:"150px",headerAttributes:{style:"display: none"},attributes:{style:"text-align: center"}},{field:"rate",title:"Calificación",width:"220px",editor:'<input kendo-drop-down-list k-value-primitive="true" k-options="rateOptions"  />',template:function(t){return t.rate?t.rate.text:"-Seleccionar-"},headerAttributes:{style:"display: none"},attributes:{style:"text-align: center;font-weight: bold;","class":"text-capitalize text-dark"}},{title:"icon",width:"70px",headerAttributes:{style:"display: none"},template:function(t){var e="";switch(t.rateCode){case"na":e='<i class="fa fa-ban text-yellow text-extra-extra-large"></i>';break;case"cp":e='<i class="fa fa-minus-circle text-muted text-extra-extra-large"></i>';break;case"nc":e='<i class="fa fa-circle-o text-red text-extra-extra-large"></i>';break;case"c":e='<i class="fa fa-check-circle-o text-green text-extra-extra-large"></i>';break;default:e='<i class="fa fa-question-circle text-orange text-extra-extra-large"></i>'}return e},attributes:{style:"text-align: center;font-weight: bold;"}}]}}}),t.$on("kendoWidgetCreated",function(e,n){void 0!==t.grid&&null!==t.grid||(t.grid=n)}),t.form={next:function(t){if(t.$valid)_();else{var e=null,n=null;for(e in t)"$"!=e[0]&&(null!==n||t[e].$valid||(n=t[e].$name),t[e].$pristine&&(t[e].$dirty=!0));angular.element(".ng-invalid[name="+n+"]").focus(),R()}},prev:function(t){E()},goTo:function(e,n){parseInt(t.currentStep)>parseInt(n)?B(n):e.$valid?B(n):R()},submit:function(){},reset:function(){}};var _=function(){t.currentStep++,x.id=t.chapters[t.currentStep].id,x.code=t.chapters[t.currentStep].abbreviation,t.grid.dataSource.read()},E=function(){t.currentStep--,x.id=t.chapters[t.currentStep].id,x.code=t.chapters[t.currentStep].abbreviation,t.grid.dataSource.read()},B=function(e){t.currentStep=e,x.id=t.chapters[t.currentStep].id,x.code=t.chapters[t.currentStep].abbreviation,t.grid.dataSource.read()},R=function(t){l.pop("error","Error","Por favor complete el formulario en este paso antes de continuar.")};t.onSave=function(t){t.programId=x.id;var e={},i=JSON.stringify(t);return e.data=Base64.encode(i),u({method:"POST",url:"api/prevention/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(t){m(function(){l.pop("success","Actualización","La información del diagnóstico ha sido actualizada satisfactoriamente."),A()})})["catch"](function(t){n.error(t),l.pop("error","Error","Error guardando el registro. Por favor verifique los datos ingresados!")})["finally"](function(){})},t.onSelectRate=function(e,n,i){m(function(){i.rate=e,t.onSave(i)})},t.onCancel=function(e){null!=t.$parent&&t.$parent.navToSection("summary","summary",I)},t.onAddComment=function(e){var i=v.open({templateUrl:d.app.views.urlRoot+"modules/customer/common/modals/customer_questions_comment_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideDiagnosticDetailCommentCtrl",scope:t,resolve:{question:function(){return e}}});i.result.then(function(){},function(){n.info("Modal dismissed at: "+new Date)})},t.onAddGuide=function(e){var i=v.open({templateUrl:d.app.views.urlRoot+"modules/customer/diagnostic/sg-sst/customer_diagnostic_sgsst_guide_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideDiagnosticDetailGuideCtrl",scope:t,resolve:{question:function(){return e},program:function(){return x}}});i.result.then(function(){},function(){n.info("Modal dismissed at: "+new Date)})},t.onAddAttachment=function(e){var i=v.open({templateUrl:d.app.views.urlRoot+"modules/customer/common/modals/customer_document_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideDiagnosticAttachmentCtrl",scope:t,resolve:{isView:function(){return t.isView},program:function(){return x}}});i.result.then(function(){},function(){n.info("Modal dismissed at: "+new Date)})},t.onAddImprovementPlan=function(e){var i=v.open({templateUrl:d.app.views.urlRoot+"modules/customer/common/modals/customer_improvement_plan_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideCustomerDiagnosticDetailImprovementPlanCtrl",scope:t,resolve:{question:function(){return e},isView:function(){return t.isView},program:function(){return t.chapters[t.currentStep]}}});i.result.then(function(){},function(){n.info("Modal dismissed at: "+new Date)})},t.onSummaryExportPdf=function(){kendo.drawing.drawDOM($(".export-pdf")).then(function(t){return kendo.drawing.exportPDF(t,{paperSize:"auto",margin:{left:"1cm",top:"1cm",right:"1cm",bottom:"1cm"}})}).done(function(t){kendo.saveAs({dataURI:t,fileName:"Diagnóstico.pdf",proxyURL:"//demos.telerik.com/kendo-ui/service/export"})})},t.onSummaryExportExcel=function(){jQuery("#downloadDocument")[0].src="api/diagnostic/export-excel?diagnostic_id="+t.$parent.currentDiagnostic+"&program_id="+t.program_id+"&rate_id="+t.rate_id}}]),app.controller("ModalInstanceSideDiagnosticAttachmentCtrl",["$stateParams","$rootScope","$scope","program","$uibModalInstance","$log","$timeout","SweetAlert","isView","$filter","FileUploader","$http","DTColumnBuilder","DTOptionsBuilder","$compile","ListService",function(t,e,n,i,a,o,r,l,c,s,d,u,m,p,f,w){function h(){var e=[{name:"customer_document_type",value:t.customerId}];w.getDataList(e).then(function(t){n.documentType=t.data.data.customerDocumentType},function(t){n.status="Unable to load customer data: "+t.message})}var g=0;n.documentClassification=e.parameters("customer_document_classification"),n.documentStatus=e.parameters("customer_document_status"),n.isView=c,h();var v=function(){n.attachment={id:0,customerId:t.customerId,program:i.code,agent:null,type:null,classification:null,status:n.documentStatus?n.documentStatus[0]:null,version:1,description:""}};v(),n.onCloseModal=function(){a.close(1)},n.onCancel=function(){a.dismiss("cancel")},n.onClear=function(){v()};var b=n.uploader=new d({url:"api/document/upload",formData:[],removeAfterUpload:!0});b.filters.push({name:"customFilter",fn:function(t,e){return this.queue.length<10}}),b.onWhenAddingFileFailed=function(t,e,n){console.info("onWhenAddingFileFailed",t,e,n)},b.onAfterAddingFile=function(t){console.info("onAfterAddingFile",t)},b.onAfterAddingAll=function(t){console.info("onAfterAddingAll",t)},b.onBeforeUploadItem=function(t){console.info("onBeforeUploadItem",t);var e={id:g};t.formData.push(e)},b.onProgressItem=function(t,e){console.info("onProgressItem",t,e)},b.onProgressAll=function(t){console.info("onProgressAll",t)},b.onSuccessItem=function(t,e,n,i){console.info("onSuccessItem",t,e,n,i)},b.onErrorItem=function(t,e,n,i){console.info("onErrorItem",t,e,n,i)},b.onCancelItem=function(t,e,n,i){console.info("onCancelItem",t,e,n,i)},b.onCompleteItem=function(t,e,n,i){console.info("onCompleteItem",t,e,n,i)},b.onCompleteAll=function(){console.info("onCompleteAll"),l.swal("Registro","La información ha sido guardada satisfactoriamente","success"),n.reloadData(),n.onClear()},n.form={submit:function(t){var e=null;if(t.$invalid){var n=null,e=null;for(n in t)"$"!=n[0]&&(null!==e||t[n].$valid||(e=t[n].$name),t[n].$pristine&&(t[n].$dirty=!0));return angular.element(".ng-invalid[name="+e+"]").focus(),void l.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}C()},reset:function(t){n.attachment=angular.copy(n.master),t.$setPristine(!0)}};var C=function(){var t={},e=JSON.stringify(n.attachment);return t.data=Base64.encode(e),u({method:"POST",url:"api/document/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){r(function(){b.queue.length>0?(g=t.data.result.id,b.uploadAll()):(l.swal("Registro","La información ha sido guardada satisfactoriamente","success"),n.reloadData(),n.onClear())})})["catch"](function(t){o.error(t),l.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){n.reloadData()})};n.dtInstanceCustomerDocumentModal={},n.dtOptionsCustomerDocumentModal=p.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.operation="document",e.customerId=t.customerId,e.program=i.code,e.statusCode="2",JSON.stringify(e)},url:"api/customer-document",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){D()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,e,i){f(angular.element(t).contents())(n)}),n.dtColumnsCustomerDocumentModal=[m.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,n,i,a){var o=t.documentUrl?t.documentUrl:"",r="api/document/download?id="+t.id,l="",c='<a target="_self" class="btn btn-primary btn-xs downloadDocumentRow lnk" href="'+r+'" uib-tooltip="Descargar anexo" data-id="'+t.id+'" >   <i class="fa fa-download"></i></a> ',s='<a class="btn btn-info btn-xs openDocumentRow lnk" target="_blank" href="'+o+'" uib-tooltip="Abrir anexo" data-id="'+t.id+'" >   <i class="fa fa-folder-open-o"></i></a> ',d=!1;return null==t.protectionType?d=!0:"public"==t.protectionType?d=!0:"private"==t.protectionType&&1==t.hasPermission&&(d=!0),e.can("clientes_anexo_open")&&""!=o&&(l+=s),e.can("clientes_anexo_download")&&""!=o&&(l+=c),d?l:""}),m.newColumn("documentType").withTitle("Tipo de documento").withOption("width",200),m.newColumn("classification").withTitle("Clasificación").withOption("width",200),m.newColumn("description").withTitle("Descripción").withOption("width",200),m.newColumn("version").withTitle("Versión").withOption("width",200),m.newColumn("dateOfCreation").withTitle("Fecha Creación").withOption("width",200).withOption("defaultContent",""),m.newColumn("status").withTitle("Estado").withOption("width",200).renderWith(function(t,e,n,i){var a="";switch(t){case"Vigente":a="label label-success";break;case"Anulado":a="label label-danger"}var o='<span class="'+a+'">'+t+"</span>";return o})];var D=function(){$("#dtCustomerDocumentModal a.editRow").on("click",function(){var t=$(this).data("id"),e=$(this).data("url");""==e?l.swal("Error en la descarga","No existe un anexo para descargar","error"):jQuery("#downloadDocument")[0].src="api/document/download?id="+t})};n.dtInstanceCustomerDocumentModalCallback=function(t){n.dtInstanceCustomerDocumentModal=t},n.reloadData=function(){n.dtInstanceCustomerDocumentModal.reloadData()}}]),app.controller("ModalInstanceSideDiagnosticPlanCtrl",["$scope","$uibModalInstance","actionPlan","$log","$timeout","SweetAlert","isView","$filter","FileUploader","$http",function(t,e,n,i,a,o,r,l,c,s){t.actionPlan=n,t.isView=r,t.ok=function(){e.close(1)},t.cancel=function(){e.dismiss("cancel")},t.saveActionPlan=function(){var e={};t.actionPlan.closeDateTime=t.actionPlan.closeDateTime.toISOString();var n=JSON.stringify(t.actionPlan);return e.data=Base64.encode(n),s({method:"POST",url:"api/diagnostic/actionPlan/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){a(function(){o.swal("Validación exitosa","Procediendo con el guardado...","success"),t.ok()})})["catch"](function(t){i.error(t),o.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})},t.addActionPlanAlert=function(){null==t.actionPlan.alerts&&(t.actionPlan.alerts=[]),a(function(){t.actionPlan.alerts.push({id:0,type:{item:"- Seleccionar -",value:"-S-"},timeType:{item:"- Seleccionar -",value:"-S-"},time:0,preference:{item:"- Seleccionar -",value:"-S-"},sent:0,status:{item:"- Seleccionar -",value:"-S-"}})},500)},t.removeAlert=function(e){o.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(n){n?a(function(){t.actionPlan.alerts.splice(e,1)}):swal("Cancelación","La operación ha sido cancelada","error")})}}]),app.controller("ModalInstanceSideDiagnosticDetailCommentCtrl",["$stateParams","$rootScope","$scope","$uibModalInstance","question","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile","$document",function(t,e,n,i,a,o,r,l,c,s,d,u,m,p,f,w){var h=function(){n.entity={id:0,diagnosticDetailId:a.id,comment:""}};h(),n.onCloseModal=function(){i.close(1)},n.onCancel=function(){i.dismiss("cancel")},n.onClear=function(){h()},n.form={submit:function(t){var e=null;if(t.$invalid){var i=null,e=null;for(i in t)"$"!=i[0]&&(null!==e||t[i].$valid||(e=t[i].$name),t[i].$pristine&&(t[i].$dirty=!0));return angular.element(".ng-invalid[name="+e+"]").focus(),void r(function(){s.pop("error","Error","Por favor verifique los datos requeridos del formulario y vuelva a intentarlo")},500)}n.onSave()},reset:function(t){t.$setPristine(!0)}},n.onSave=function(){var t={},e=JSON.stringify(n.entity);return t.data=Base64.encode(e),c({method:"POST",url:"api/diagnostic/comment/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){r(function(){s.pop("success","Operación Exitosa","Actualización exitosa."),n.onClear(),n.reloadData()})})["catch"](function(t){s.pop("Error","Error inesperado",t)})["finally"](function(){})};var g={};g.operation="document",g.diagnostic_detail_id=a.id,n.dtInstanceQuestionComment={},n.dtOptionsQuestionComment=p.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:g,url:"api/diagnostic/comment",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,e,i){f(angular.element(t).contents())(n)}),n.dtColumnsQuestionComment=[m.newColumn("comment").withTitle("Comentario"),m.newColumn("user").withTitle("Usuario").withOption("width",200).withOption("defaultContent",200),m.newColumn("createdAt").withTitle("Fecha").withOption("width",200)],n.dtInstanceQuestionCommentCallback=function(t){n.dtInstanceQuestionComment=t},n.reloadData=function(){n.dtInstanceQuestionComment.reloadData()}}]),app.controller("ModalInstanceSideDiagnosticDetailGuideCtrl",["$stateParams","$rootScope","$scope","$uibModalInstance","question","program","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile","$document",function(t,e,n,i,a,o,r,l,c,s,d,u,m,p,f,w,h){n.question={id:a.id},n.onCloseModal=function(){i.close(1)},n.onCancel=function(){i.dismiss("cancel")},n.onClear=function(){n.question={id:a.id}};var g=function(){if(n.question.id){var t={id:n.question.id};s({method:"GET",url:"api/prevention/question",params:t})["catch"](function(t,e){}).then(function(t){l(function(){n.question=t.data.result,v.question_id=n.question.id,n.reloadDataGlobal(),n.reloadDataInternal()})})["finally"](function(){l(function(){n.loading=!1},400)})}};g();var v={};n.dtInstanceDiagnosticDocumentA={},n.dtOptionsDiagnosticDocumentA=f.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.operation="document",e.customerId=t.customerId,e.program=o.code,e.statusCode="2",JSON.stringify(e)},url:"api/customer-document",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){b()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,e,i){w(angular.element(t).contents())(n)}),n.dtColumnsDiagnosticDocumentA=[p.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,n,i,a){var o=t.documentUrl?t.documentUrl:"",r="api/document/download?id="+t.id,l="",c='<a target="_self" class="btn btn-primary btn-xs downloadDocumentRow lnk" href="'+r+'" uib-tooltip="Descargar anexo" data-id="'+t.id+'" data-url="'+o+'" >   <i class="fa fa-download"></i></a> ',s='<a class="btn btn-info btn-xs openDocumentRow lnk" target="_blank" href="'+o+'" uib-tooltip="Abrir anexo" data-id="'+t.id+'" >   <i class="fa fa-folder-open-o"></i></a> ',d=('<a class="btn btn-danger btn-xs delDocumentRow lnk" href="#" uib-tooltip="Anular anexo" data-id="'+t.id+'" >   <i class="fa fa-ban"></i></a> ',!1);return null==t.protectionType?d=!0:"public"==t.protectionType?d=!0:"private"==t.protectionType&&1==t.hasPermission&&(d=!0),e.can("clientes_anexo_open")&&""!=o&&(l+=s),e.can("clientes_anexo_download")&&""!=o&&(l+=c),e.can("clientes_anexo_invalidate"),d?l:""}),p.newColumn("documentType").withTitle("Tipo de documento").withOption("width",200),p.newColumn("classification").withTitle("Clasificación").withOption("width",200),p.newColumn("description").withTitle("Descripción").withOption("width",200),p.newColumn("version").withTitle("Versión").withOption("width",200),p.newColumn("dateOfCreation").withTitle("Fecha Creación").withOption("width",200).withOption("defaultContent",""),p.newColumn("status").withTitle("Estado").withOption("width",200).renderWith(function(t,e,n,i){var a="";switch(t){case"Vigente":a="label label-success";break;case"Anulado":a="label label-danger"}var o='<span class="'+a+'">'+t+"</span>";return o})];var b=function(){$("#dtDiagnosticDocumentA a.editRow").on("click",function(){var t=$(this).data("id"),e=$(this).data("url");""==e?c.swal("Error en la descarga","No existe un anexo para descargar","error"):jQuery("#downloadDocument")[0].src="api/document/download?id="+t})};n.reloadData=function(){n.dtColumnsDiagnosticDocumentAtt.reloadData()},v.operation="quotes",v.question_id=0,v.customer_id=t.customerId,n.dtInstanceCustomerDiagnosticPreventionDocumentQuestionGlobal={},n.dtOptionsCustomerDiagnosticPreventionDocumentQuestionGlobal=f.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:v,url:"api/configuration/program-prevention-document/question",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){C()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,e,i){w(angular.element(t).contents())(n)}),n.dtColumnsCustomerDiagnosticPreventionDocumentQuestionGlobal=[p.newColumn(null).withTitle("Acciones").withOption("width",200).notSortable().renderWith(function(t,e,i,a){var o=null!=t.document?t.document.path:"",r="api/configuration/program-prevention-document/download?id="+t.id,l="",c=('<a target="_self" class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+t.id+'">   <i class="fa fa-edit"></i></a> ','<a target="_self" class="btn btn-info btn-xs downloadRow lnk" href="'+r+'" uib-tooltip="Descargar anexo" data-id="'+t.id+'" data-url="'+o+'" >   <i class="fa fa-download"></i></a> ');'<a class="btn btn-light-red btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+t.id+'" >   <i class="fa fa-ban"></i></a> ';return""!=o&&(l+=c),n.isAdmin||n.isAgent||n.$parent.isCustomerContractor,l}),p.newColumn("classification").withTitle("Clasificación").withOption("width",200),p.newColumn("name").withTitle("Nombre").withOption("width",200),p.newColumn("description").withTitle("Descripción").withOption("width",200),p.newColumn("startDate").withTitle("Fecha de Inicio Vigencia").withOption("width",200),p.newColumn("endDate").withTitle("Fecha de Finalización Vigencia").withOption("width",200),p.newColumn("version").withTitle("Versión").withOption("width",200),p.newColumn("status").withTitle("Estado").withOption("width",200).renderWith(function(t,e,n,i){var a="";switch(t){case"Vigente":a="label label-success";break;case"Anulado":a="label label-danger"}var o='<span class="'+a+'">'+t+"</span>";return o})];var C=function(){$("#dtCustomerDiagnosticPreventionDocumentQuestionGlobal a.editRow").on("click",function(){var t=$(this).data("id");$state.go("app.program-prevention-document.edit",{id:t})}),$("#dtCustomerDiagnosticPreventionDocumentQuestionGlobal a.downloadRow").on("click",function(){}),$("#dtCustomerDiagnosticPreventionDocumentQuestionGlobal a.delRow").on("click",function(){var t=$(this).data("id");log.info("intenta eliminar el registro: "+t),c.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(e){if(e){var i={};i.id=t,s({method:"POST",url:"api/configuration/program-prevention-document/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){r.error(t),c.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){n.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};n.reloadDataGlobal=function(){n.dtInstanceCustomerDiagnosticPreventionDocumentQuestionGlobal.reloadData()},n.dtInstanceCustomerDiagnosticPreventionDocumentQuestionInternal={},n.dtOptionsCustomerDiagnosticPreventionDocumentQuestionInternal=f.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:v,url:"api/customer/diagnostic-prevention-document/question",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){D()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,e,i){w(angular.element(t).contents())(n)}),n.dtColumnsCustomerDiagnosticPreventionDocumentQuestionInternal=[p.newColumn(null).withTitle("Acciones").withOption("width",200).notSortable().renderWith(function(t,e,i,a){var o=null!=t.document?t.document.path:"",r="api/customer/diagnostic-prevention-document/download?id="+t.id,l="",c=('<a target="_self" class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+t.id+'">   <i class="fa fa-edit"></i></a> ','<a target="_self" class="btn btn-info btn-xs downloadRow lnk" href="'+r+'" uib-tooltip="Descargar anexo" data-id="'+t.id+'" data-url="'+o+'" >   <i class="fa fa-download"></i></a> ');'<a class="btn btn-light-red btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+t.id+'" >   <i class="fa fa-ban"></i></a> ';return""!=o&&(l+=c),n.isAdmin||n.isAgent||n.$parent.isCustomerContractor,l}),p.newColumn("classification").withTitle("Clasificación").withOption("width",200),p.newColumn("name").withTitle("Nombre").withOption("width",200),p.newColumn("description").withTitle("Descripción").withOption("width",200),p.newColumn("startDate").withTitle("Fecha de Inicio Vigencia").withOption("width",200),p.newColumn("endDate").withTitle("Fecha de Finalización Vigencia").withOption("width",200),p.newColumn("version").withTitle("Versión").withOption("width",200),p.newColumn("status").withTitle("Estado").withOption("width",200).renderWith(function(t,e,n,i){var a="";switch(t){case"Vigente":a="label label-success";break;case"Anulado":a="label label-danger"}var o='<span class="'+a+'">'+t+"</span>";return o})];var D=function(){$("#dtCustomerDiagnosticPreventionDocumentQuestionInternal a.editRow").on("click",function(){var t=$(this).data("id");$state.go("app.program-prevention-document.edit",{id:t})}),$("#dtCustomerDiagnosticPreventionDocumentQuestionInternal a.downloadRow").on("click",function(){}),$("#dtCustomerDiagnosticPreventionDocumentQuestionInternal a.delRow").on("click",function(){var t=$(this).data("id");log.info("intenta eliminar el registro: "+t),c.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(e){if(e){var i={};i.id=t,s({method:"POST",url:"api/configuration/program-prevention-document/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){r.error(t),c.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){n.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};n.reloadDataInternal=function(){n.dtInstanceCustomerDiagnosticPreventionDocumentQuestionInternal.reloadData()}}]),app.controller("ModalInstanceSideCustomerDiagnosticDetailImprovementPlanCtrl",["$stateParams","$rootScope","$scope","$uibModalInstance","question","program","$log","$timeout","SweetAlert","isView","$filter","FileUploader","$http","DTOptionsBuilder","DTColumnBuilder","$compile",function(t,e,n,i,a,o,r,l,c,s,d,u,m,p,f,w){n.maxDate=new Date,n.datePickerConfig={culture:"es-CO",format:"dd/MM/yyyy HH:mm"},n.responsibleList=[],n.typesAlert=d("orderBy")(e.parameters("tracking_alert_type"),"id",!1),n.typesTime=e.parameters("tracking_alert_timeType"),n.statusAlert=e.parameters("tracking_alert_status"),n.preferencesAlert=e.parameters("tracking_alert_preference"),n.typeList=e.parameters("improvement_plan_type");var h=function(){n.improvement={id:0,customerId:t.customerId,classificationName:o.abbreviation,classificationId:o.abbreviation,entityName:"SG",entityId:a.id,type:null,endDate:null,description:"",observation:"",responsible:null,isRequiresAnalysis:!1,status:{id:0,value:"CR",item:"Creada"},trackingList:[],alertList:[]}};h(),n.onLoadRecord=function(t){if(0!=t){var e={id:t};m({method:"GET",url:"api/customer/improvement-plan",params:e})["catch"](function(t,e){if(403==e){var n=null!==t.message&&void 0!==t.message?t.message:"app.clientes.list";
c.swal("No Autorizado","No estas autorizado para ver esta información.","error"),l(function(){$state.go(n)},3e3)}else 404==e?c.swal("Información no disponible","Centro de trabajo no encontrado","error"):c.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(t){l(function(){null!=t.data.result&&""!=t.data.result&&(n.improvement=t.data.result,b())},400)})["finally"](function(){})}else n.loading=!1},n.onCloseModal=function(){i.close(1)},n.onCancel=function(){i.dismiss("cancel")},n.onClear=function(){};var g=function(){var e={customer_id:t.customerId};return m({method:"POST",url:"api/customer/improvement-plan/list-data",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(t){l(function(){n.responsibleList=t.data.data.responsible})})["catch"](function(t){c.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};g(),n.master=n.improvement,n.form={submit:function(t){var e=null;if(t.$invalid){var n=null,e=null;for(n in t)"$"!=n[0]&&(null!==e||t[n].$valid||(e=t[n].$name),t[n].$pristine&&(t[n].$dirty=!0));return angular.element(".ng-invalid[name="+e+"]").focus(),void c.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}c.swal("Validación exitosa","Procediendo con el guardado...","success"),v()},reset:function(t){n.improvement=angular.copy(n.master),t.$setPristine(!0)}};var v=function(){var t={},e=JSON.stringify(n.improvement);return t.data=Base64.encode(e),m({method:"POST",url:"api/customer/improvement-plan/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){l(function(){h()})})["catch"](function(t){c.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){n.reloadData()})},b=function(){null!=n.improvement.endDate&&(n.improvement.endDate=new Date(n.improvement.endDate.date)),angular.forEach(n.improvement.trackingList,function(t,e){null!=t.startDate&&(t.startDate=new Date(t.startDate.date))})};n.onAddTracking=function(){l(function(){null==n.improvement.trackingList&&(n.improvement.trackingList=[]),n.improvement.trackingList.push({id:0,customerImprovementPlanId:0,responsible:null,startDate:null})})},n.onRemoveTracking=function(t){c.swal({title:"Está seguro?",text:"Desea confirmar la eliminación de este registro ?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(e){e?l(function(){var e=n.improvement.trackingList[t];if(n.improvement.trackingList.splice(t,1),0!=e.id){var i={};i.id=e.id,m({method:"POST",url:"api/customer/improvement-plan-tracking/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){r.error(t),c.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})},n.onAddAlert=function(){l(function(){null==n.improvement.alertList&&(n.improvement.alertList=[]),n.improvement.alertList.push({id:0,customerImprovementPlanId:0,type:null,preference:null,time:0,timeType:null,status:null})})},n.onRemoveAlert=function(t){c.swal({title:"Está seguro?",text:"Desea confirmar la eliminación de este registro ?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(e){e?l(function(){var e=n.improvement.alertList[t];if(n.improvement.alertList.splice(t,1),0!=e.id){var i={};i.id=e.id,m({method:"POST",url:"api/customer/improvement-plan-alert/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){r.error(t),c.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})},n.dtInstanceImprovementPlan={},n.dtOptionsImprovementPlan=p.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.customerId=n.improvement.customerId,t.entityId=n.improvement.entityId,t.entityName=n.improvement.entityName,JSON.stringify(t)},url:"api/customer-improvement-plan-entity",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){C()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,e,i){w(angular.element(t).contents())(n)}),n.dtColumnsImprovementPlan=[f.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,i,a,o){var r="",l='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+t.id+'" >   <i class="fa fa-edit"></i></a> ',c='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+t.id+'" >   <i class="fa fa-trash-o"></i></a> ';return e.can("cliente_plan_mejoramiento_edit")&&(r+=l),e.can("cliente_plan_mejoramiento_delete")&&(r+=c),n.isView?null:r}),f.newColumn("origin").withTitle("Origen").withOption("width",200).withOption("defaultContent",""),f.newColumn("classification").withTitle("Clasificación").withOption("width",200).withOption("defaultContent",""),f.newColumn("type").withTitle("Tipo").withOption("width",200).withOption("defaultContent",""),f.newColumn("description").withTitle("Hallazgo").withOption("width",200).withOption("defaultContent",""),f.newColumn("responsibleName").withTitle("Responsable").withOption("defaultContent",""),f.newColumn(null).withTitle("Fecha Cierre").withOption("width",200).renderWith(function(t,e,n,i){return"object"==typeof t.endDate&&null!=t.endDate?moment(t.endDate.date).format("DD/MM/YYYY"):null!=t.endDate?moment(t.endDate).format("DD/MM/YYYY"):""}),f.newColumn(null).withTitle("Estado").withOption("width",200).withOption("defaultContent","").renderWith(function(t,e,n,i){var a="label label-success",o=t.status;switch(t.statusCode){case"AB":a="label label-info";break;case"CO":a="label label-success";break;case"CA":a="label label-danger"}return'<span class="'+a+'">'+o+"</span>"})];var C=function(){$("#dtImprovementPlan a.editRow").on("click",function(){var t=$(this).data("id");n.onLoadRecord(t)}),$("#dtImprovementPlan a.delRow").on("click",function(){var t=$(this).data("id");c.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(e){if(e){var i={};i.id=t,m({method:"POST",url:"api/customer/improvement-plan/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){r.error(t),c.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){n.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};n.dtInstanceImprovementPlanCallback=function(t){n.dtInstanceImprovementPlan=t},n.reloadData=function(){n.dtInstanceImprovementPlan.reloadData()}}]);
"use strict";app.controller("customerDiagnosticReportCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert",function(t,e,r,a,o,n,i,l,s,c,d,u,g){var p=r,m={};t.question={rate:{id:"0",text:"-- Seleccionar --",value:"-S-",code:"0"}},p.info("loading..customerDiagnosticReportCtrl "),m.operation="diagnostic",m.customer_id=e.customerId,m.diagnostic_id=t.$parent.currentDiagnostic,t.rate_id=0,t.program_id=0,t.categories=[],t.rates=c.rates();var f=function(){var t=randomColor({luminosity:"bright",hue:"orange",format:"rgb"});return p.info(t),t};f(),f(),f(),f(),f(),f();t.data_prg={labels:[],datasets:[]},t.options_prg={responsive:!0,scaleBeginAtZero:!0,scaleShowGridLines:!0,scaleGridLineColor:"rgba(0,0,0,.05)",scaleGridLineWidth:1,barShowStroke:!0,barStrokeWidth:2,barValueSpacing:5,barDatasetSpacing:1,legendTemplate:'<ul class="tc-chart-js-legend"><% for (var i=0; i<datasets.length; i++){%><li><span style="background-color:<%=datasets[i].fillColor%>"></span><%if(datasets[i].label){%><%=datasets[i].label%><%}%></li><%}%></ul>'},t.data_sg=[],t.options_sg={responsive:!0,segmentShowStroke:!0,segmentStrokeColor:"#fff",segmentStrokeWidth:2,percentageInnerCutout:50,animationSteps:100,animationEasing:"easeOutBounce",animateRotate:!0,animateScale:!1,legendTemplate:'<ul class="tc-chart-js-legend"><% for (var i=0; i<segments.length; i++){%><li><span style="background-color:<%=segments[i].fillColor%>"></span><%if(segments[i].label){%><%=segments[i].label%><%}%></li><%}%></ul>'},t.totalAvg=0,t.changeRate=function(e,r,a){p.info(e),p.info(r),d(function(){t.rate_id=e.id,v()})};var h=function(){var a={};a.customer_id=e.customerId,a.diagnostic_id=t.$parent.currentDiagnostic,u({method:"GET",url:"api/diagnostic/report",params:a}).then(function(e){d(function(){t.data_prg=e.data.result.report_programs,t.totalAvg=e.data.result.totalAvg,$.each(t.data_prg.datasets,function(t,e){var r="rgb("+e.fillColor.r+","+e.fillColor.g+","+e.fillColor.b+")";e.fillColor=r,e.highlightFill=r,e.highlightStroke=r}),t.data_sg=e.data.result.report_advances})})["catch"](function(t){r.error(t),g.swal("Error Cargando Reportes","Se ha presentado un error durante la consulta de los reportes para el diagnóstico por favor intentelo de nuevo","error")})["finally"](function(){})};h();var v=function(){p.info("Intentamos cargar la información del programa_id: ");var e={};e.diagnostic_id=t.$parent.currentDiagnostic,e.program_id=t.program_id,e.rate_id=t.rate_id,u({method:"GET",url:"api/diagnostic/infoReport",params:e}).then(function(e){console.log(e),_(e.data.data.programs),t.loaded=!0})["catch"](function(t){r.error(t),g.swal("Error Consultando Preguntas","Se ha presentado un error durante la consulta del cuestionario, por favor intentelo de nuevo.","error")})["finally"](function(){h()})};v();var _=function(e){return null!=e&&0!=e.length&&void(t.categories=e)};t.editDiagnostic=function(e){null!=t.$parent&&t.$parent.navToSection("edit","edit",t.$parent.currentDiagnostic)},t.cancelEdition=function(e){null!=t.$parent&&t.$parent.navToSection("summary","summary",t.$parent.currentDiagnostic)},t.clearFilter=function(){t.question={rate:{id:"0",text:"-- Seleccionar --",value:"-S-",code:"0"}},t.rate_id=0,v()},t.onSummaryExportPdf=function(){kendo.drawing.drawDOM($("#export-pdf")).then(function(t){return kendo.drawing.exportPDF(t,{paperSize:"auto",margin:{left:"1cm",top:"1cm",right:"1cm",bottom:"1cm"}})}).done(function(t){kendo.saveAs({dataURI:t,fileName:"DiagnosticoReporte.pdf",proxyURL:"//demos.telerik.com/kendo-ui/service/export"})})},t.onSummaryExportExcel=function(){jQuery("#downloadDocument")[0].src="api/diagnostic/infoReport/export-excel?diagnostic_id="+t.$parent.currentDiagnostic+"&program_id="+t.program_id+"&rate_id="+t.rate_id}}]);
"use strict";app.controller("customerDiagnosticReportMonthlyCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert",function(t,a,o,e,i,n,r,l,d,s,u,c,p){var h=o;h.info("loading..customerDiagnosticReportMonthlyCtrl "),t.request={},t.audit={},t.audit.operation="info",t.audit.diagnosticId=t.$parent.currentDiagnostic,t.audit.year=0,t.filter={selectedYear:null},t.years=[];var g=function(){var t=randomColor({luminosity:"bright",hue:"orange",format:"rgb"});return h.info(t),t};g(),g(),g(),g(),g(),g();t.dataProgram=null,t.dataEvolutionProgram=null,t.dataEvolutionTotal=null,t.dataEvolutionAvg=null,t.optionsLine={legend:{position:"right"},responsive:!0,scaleShowGridLines:!0,scaleGridLineColor:"rgba(0,0,0,.05)",scaleGridLineWidth:1,bezierCurve:!0,bezierCurveTension:.4,pointDot:!0,pointDotRadius:4,pointDotStrokeWidth:1,pointHitDetectionRadius:20,datasetStroke:!0,datasetStrokeWidth:2,datasetFill:!0,onAnimationProgress:function(){},onAnimationComplete:function(){},legendTemplate:'<ul class="tc-chart-js-legend"><% for (var i=0; i<datasets.length; i++){%><li><span style="background-color:<%=datasets[i].strokeColor%>"></span><%if(datasets[i].label){%><%=datasets[i].label%><%}%></li><%}%></ul>'},t.optionsBar={legend:{position:"right"},responsive:!0,scaleBeginAtZero:!0,scaleShowGridLines:!0,scaleGridLineColor:"rgba(0,0,0,.05)",scaleGridLineWidth:1,barShowStroke:!0,barStrokeWidth:2,barValueSpacing:5,barDatasetSpacing:1,legendTemplate:'<ul class="tc-chart-js-legend"><% for (var i=0; i<datasets.length; i++){%><li><span style="background-color:<%=datasets[i].fillColor%>"></span><%if(datasets[i].label){%><%=datasets[i].label%><%}%></li><%}%></ul>'};var m=function(){var e={};e.customer_id=a.customerId,e.diagnostic_id=t.$parent.currentDiagnostic,e.year=t.audit.year,c({method:"POST",url:"api/diagnostic/report-monthly-filter",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(a){t.years=a.data.data,t.years.length>0&&(t.filter.selectedYear=t.years[0],t.audit.year=t.filter.selectedYear.value,t.request.data=Base64.encode(JSON.stringify(t.audit)),t.reloadData(),t.reloadIndicatorData(),w())})["catch"](function(t){o.error(t),p.swal("Error Cargando Reportes","Se ha presentado un error durante la consulta de los reportes para el diagnóstico por favor intentelo de nuevo","error")})["finally"](function(){})},w=function(){var e={};e.customer_id=a.customerId,e.diagnostic_id=t.$parent.currentDiagnostic,e.year=t.audit.year,c({method:"GET",url:"api/diagnostic/reportMonthly",params:e}).then(function(a){u(function(){t.dataProgram=a.data.result.report_programs,t.dataEvolutionProgram=a.data.result.line_programs,t.dataEvolutionTotal=a.data.result.line_total,t.dataEvolutionAvg=a.data.result.line_avg,t.datasetChartEvolutionAvgLabels=[];for(var o=0;o<a.data.result.line_avg.labels.length;o++)t.datasetChartEvolutionAvgLabels.push(a.data.result.line_avg.labels[o]);t.datasetChartEvolutionAvgLabels=[];for(var o=0;o<a.data.result.line_avg.labels.length;o++)t.datasetChartEvolutionAvgLabels.push(a.data.result.line_avg.labels[o]);t.datasetEvolutionAvgData=[];for(var o=0;o<a.data.result.line_avg.datasets[0].data.length;o++)t.datasetEvolutionAvgData.push(a.data.result.line_avg.datasets[0].data[o]);t.dataEvolutionAvg={labels:t.datasetChartEvolutionAvgLabels,datasets:[{label:"Promedio Total % (calificación)",borderColor:"rgba(218,79,74,1)",backgroundColor:"rgba(218,79,74,1)",data:t.datasetEvolutionAvgData}]},t.datasetEvolutionTotalData=[];for(var o=0;o<a.data.result.line_total.datasets[0].data.length;o++)t.datasetEvolutionTotalData.push(a.data.result.line_total.datasets[0].data[o]);t.dataEvolutionTotal={labels:t.datasetChartEvolutionAvgLabels,datasets:[{label:"Avance % (respuestas / preguntas)",borderColor:"rgba(51,149,255,1)",backgroundColor:"rgba(51,149,255,1)",data:t.datasetEvolutionTotalData}]},t.datasetEvolutionProgramsColors=["rgba(255,99,132,0.2)","rgba(54,162,235,0.2)","rgba(255,206,86,0.2)","rgba(139,195,74,0.2)","rgba(255,87,34,0.2)"],t.datasetEvolutionProgramsData=[];for(var o=0;o<a.data.result.line_programs.datasets.length;o++)t.datasetEvolutionProgramsData.push({label:a.data.result.line_programs.datasets[o].label,backgroundColor:t.datasetEvolutionProgramsColors[o],hoverBackgroundColor:t.datasetEvolutionProgramsColors[o],data:a.data.result.line_programs.datasets[o].data});t.dataEvolutionProgram={labels:t.datasetChartEvolutionAvgLabels,datasets:t.datasetEvolutionProgramsData},console.log(a.data.result.report_programs),t.datasetEvolutionReportData=[],t.datasetEvolutionReportColors=["#FF6384","#36A2EB","#FFCE56","#8BC34A","#FF5722"];for(var o=0;o<a.data.result.report_programs.datasets.length;o++)t.datasetEvolutionReportData.push({label:a.data.result.report_programs.datasets[o].label,backgroundColor:t.datasetEvolutionReportColors[o],hoverBackgroundColor:t.datasetEvolutionReportColors[o],data:a.data.result.report_programs.datasets[o].data});t.dataProgram={labels:t.datasetChartEvolutionAvgLabels,datasets:t.datasetEvolutionReportData},$.each(t.dataProgram.datasets,function(t,a){var o="rgb("+a.fillColor.r+","+a.fillColor.g+","+a.fillColor.b+")";a.fillColor=o,a.highlightFill=o,a.highlightStroke=o})})})["catch"](function(t){o.error(t),p.swal("Error Cargando Reportes","Se ha presentado un error durante la consulta de los reportes para el diagnóstico por favor intentelo de nuevo","error")})["finally"](function(){})};m(),w(),t.request.data=Base64.encode(JSON.stringify(t.audit)),t.dtInstanceDiagnosticSummaryProgram={},t.dtOptionsDiagnosticSummaryProgram=e.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:t.request,url:"api/diagnostic/summary-program",type:"POST",beforeSend:function(){},complete:function(t){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withDOM("tr").withOption("language",{}).withOption("createdRow",function(a,o,e){r(angular.element(a).contents())(t)}),t.dtColumnsDiagnosticSummaryProgram=[i.newColumn("abbreviation").withTitle("Ccde").withOption("width",100),i.newColumn("name").withTitle("Programa").withOption("width",400),i.newColumn("ENE").withTitle("ENE").withOption("width",200),i.newColumn("FEB").withTitle("FEB").withOption("width",200),i.newColumn("MAR").withTitle("MAR").withOption("width",200),i.newColumn("ABR").withTitle("ABR").withOption("width",200),i.newColumn("MAY").withTitle("MAY").withOption("width",200),i.newColumn("JUN").withTitle("JUN").withOption("width",200),i.newColumn("JUL").withTitle("JUL").withOption("width",200),i.newColumn("AGO").withTitle("AGO").withOption("width",200),i.newColumn("SEP").withTitle("SEP").withOption("width",200),i.newColumn("OCT").withTitle("OCT").withOption("width",200),i.newColumn("NOV").withTitle("NOV").withOption("width",200),i.newColumn("DIC").withTitle("DIC").withOption("width",200)],t.dtInstanceDiagnosticSummaryIndicator={},t.dtOptionsDiagnosticSummaryIndicator=e.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:t.request,url:"api/diagnostic/summary-indicator",type:"POST",beforeSend:function(){},complete:function(t){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withDOM("tr").withOption("language",{}).withOption("createdRow",function(a,o,e){r(angular.element(a).contents())(t)}),t.dtColumnsDiagnosticSummaryIndicator=[i.newColumn("indicator").withTitle("Indicador").withOption("width",400),i.newColumn(null).withTitle("ENE").withOption("width",200).renderWith(function(t,a,o,e){return"Promedio Total %"!=t.indicator?f(t.ENE):t.ENE}),i.newColumn(null).withTitle("FEB").withOption("width",200).renderWith(function(t,a,o,e){return"Promedio Total %"!=t.indicator?f(t.FEB):t.FEB}),i.newColumn(null).withTitle("MAR").withOption("width",200).renderWith(function(t,a,o,e){return"Promedio Total %"!=t.indicator?f(t.MAR):t.MAR}),i.newColumn(null).withTitle("ABR").withOption("width",200).renderWith(function(t,a,o,e){return"Promedio Total %"!=t.indicator?f(t.ABR):t.ABR}),i.newColumn(null).withTitle("MAY").withOption("width",200).renderWith(function(t,a,o,e){return"Promedio Total %"!=t.indicator?f(t.MAY):t.MAY}),i.newColumn(null).withTitle("JUN").withOption("width",200).renderWith(function(t,a,o,e){return"Promedio Total %"!=t.indicator?f(t.JUN):t.JUN}),i.newColumn(null).withTitle("JUL").withOption("width",200).renderWith(function(t,a,o,e){return"Promedio Total %"!=t.indicator?f(t.JUL):t.JUL}),i.newColumn(null).withTitle("AGO").withOption("width",200).renderWith(function(t,a,o,e){return"Promedio Total %"!=t.indicator?f(t.AGO):t.AGO}),i.newColumn(null).withTitle("SEP").withOption("width",200).renderWith(function(t,a,o,e){return"Promedio Total %"!=t.indicator?f(t.SEP):t.SEP}),i.newColumn(null).withTitle("OCT").withOption("width",200).renderWith(function(t,a,o,e){return"Promedio Total %"!=t.indicator?f(t.OCT):t.OCT}),i.newColumn(null).withTitle("NOV").withOption("width",200).renderWith(function(t,a,o,e){return"Promedio Total %"!=t.indicator?f(t.NOV):t.NOV}),i.newColumn(null).withTitle("DIC").withOption("width",200).renderWith(function(t,a,o,e){return"Promedio Total %"!=t.indicator?f(t.DIC):t.DIC})];var f=function(t){return null!=t?parseInt(t):""};t.reloadData=function(){t.dtInstanceDiagnosticSummaryProgram.reloadData()},t.reloadIndicatorData=function(){t.dtInstanceDiagnosticSummaryIndicator.reloadData()},t.editDiagnosticSummary=function(a){null!=t.$parent&&t.$parent.navToSection("form","edit",a)},t.editDiagnosticReport=function(){null!=t.$parent&&t.$parent.navToSection("edit","edit",t.$parent.currentDiagnostic)},t.editDiagnosticReportMonthly=function(){null!=t.$parent&&t.$parent.navToSection("report_monthly","report_monthly",t.$parent.currentDiagnostic)},t.cancelEdition=function(a){null!=t.$parent&&t.$parent.navToSection("summary","summary",t.$parent.currentDiagnostic)},t.editDiagnostic=function(a){null!=t.$parent&&t.$parent.navToSection("report","report",t.$parent.currentDiagnostic)},t.changeYear=function(a,o){u(function(){t.audit.operation="info",t.audit.diagnosticId=t.$parent.currentDiagnostic,t.audit.year=a.value,t.request.data=Base64.encode(JSON.stringify(t.audit)),t.reloadData(),t.reloadIndicatorData(),w()})},t.clearYear=function(){u(function(){t.audit.operation="info",t.audit.diagnosticId=t.$parent.currentDiagnostic,t.audit.year=0,t.request.data=Base64.encode(JSON.stringify(t.audit)),t.filter.selectedYear=null,t.reloadData(),t.reloadIndicatorData(),w()})},t.onSummaryByProgramExportExcel=function(){jQuery("#downloadDocument")[0].src="api/diagnostic/summary-program/export?data="+Base64.encode(JSON.stringify(t.audit))},t.onSummaryByProgramExportPdf=function(){kendo.drawing.drawDOM($(".export-pdf-program")).then(function(t){return kendo.drawing.exportPDF(t,{paperSize:"auto",margin:{left:"1cm",top:"1cm",right:"1cm",bottom:"1cm"}})}).done(function(t){kendo.saveAs({dataURI:t,fileName:"Diagnóstico Reporte Mensual Program.pdf",proxyURL:"//demos.telerik.com/kendo-ui/service/export"})})},t.onSummaryByIndicatorExportExcel=function(){jQuery("#downloadDocument")[0].src="api/diagnostic/summary-indicator/export?data="+Base64.encode(JSON.stringify(t.audit))},t.onSummaryByIndicatorExportPdf=function(){kendo.drawing.drawDOM($(".export-pdf-indicator")).then(function(t){return kendo.drawing.exportPDF(t,{paperSize:"auto",margin:{left:"1cm",top:"1cm",right:"1cm",bottom:"1cm"}})}).done(function(t){kendo.saveAs({dataURI:t,fileName:"Diagnóstico Reporte Mensual Indicadores.pdf",proxyURL:"//demos.telerik.com/kendo-ui/service/export"})})}}]);
"use strict";app.controller("customerDiagnosticObservationListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$document","$filter",function(i,n,a,t,o,e,r,s,c,d,l,u,f,v,p){var m=a,w={};m.info("loading..customerDiagnosticObservationListCtrl "),i.loading=!0,i.isView=!1,i.agents=d.agents(),i.diagnostic_id=i.$parent.currentDiagnostic,i.observation={id:"0",diagnosticId:i.diagnostic_id,currentDate:p("date")(new Date,"dd/MM/yyyy HH:mm"),agent:{id:"0",name:"- Seleccionar -"},description:""},i.onLoadRecord=function(){if(0!=i.observation.id){m.info("editando cliente con código: "+i.observation.id);var n={id:i.observation.id,diagnostic_id:i.diagnostic_id};u({method:"GET",url:"api/diagnostic/observation/get",params:n})["catch"](function(i,n){if(403==n){var a=null!==i.message&&void 0!==i.message?i.message:"app.clientes.list";f.swal("No Autorizado","No estas autorizado para ver esta información.","error"),l(function(){c.go(a)},3e3)}else 404==n?(f.swal("Información no disponible","Observación no encontrada","error"),l(function(){c.go("app.clientes.list")})):f.swal("Error","Se ha presentado un error al intentar acceder a la información de la observación","error")}).then(function(n){l(function(){i.observation=n.data.result,i.observation.diagnosticId=i.diagnostic_id})})["finally"](function(){l(function(){i.loading=!1},400),l(function(){v.scrollTop(40,2e3)})})}else m.info("creacion de nuevo cliente"),i.loading=!1},i.onLoadRecord();i.cancelEdition=function(n){null!=i.$parent&&i.$parent.navToSection("summary","summary",i.diagnostic_id)},i.master=i.observation,i.form={submit:function(n){var a=null;if(n.$invalid){var t=null,a=null;for(t in n)"$"!=t[0]&&(null!==a||n[t].$valid||(a=n[t].$name),n[t].$pristine&&(n[t].$dirty=!0));return m.info(i.observation),angular.element(".ng-invalid[name="+a+"]").focus(),void f.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}f.swal("Validación exitosa","Guardando información de la observación...","success"),i.save()},reset:function(n){i.clear()}},i.save=function(){var n={},t=JSON.stringify(i.observation);return n.data=Base64.encode(t),u({method:"POST",url:"api/diagnostic/observation/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(n){l(function(){i.observation=n.data.result,i.reloadData()})})["catch"](function(i){a.error(i),f.swal("Error de guardado","Error guardando la observación por favor verifique los datos ingresados!","error")})["finally"](function(){i.clear()})},i.clear=function(){l(function(){i.observation={id:"0",diagnosticId:i.diagnostic_id,currentDate:Date.today().toString("dd/MM/yyyy HH:mm"),agent:{id:"0",name:"- Seleccionar -"},description:""}}),i.isView=!1},w.operation="diagnostic",w.diagnostic_id=i.diagnostic_id,i.dtInstanceDiagnosticObservation={},i.dtOptionsDiagnosticObservation=t.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:w,url:"api/diagnostic/observation",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){g()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(n,a,t){r(angular.element(n).contents())(i)}),i.dtColumnsDiagnosticObservation=[o.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(i,n,a,t){var o="",e="",r='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar"  data-id="'+i.id+'"'+e+' >   <i class="fa fa-edit"></i></a> ',s='<a class="btn btn-info btn-xs viewRow lnk" href="#"  uib-tooltip="Ver" data-id="'+i.id+'" >   <i class="fa fa-eye"></i></a> ',c='<a class="btn btn-danger btn-xs delRow lnk" href="#"  uib-tooltip="Eliminar" data-id="'+i.id+'"'+e+' >   <i class="fa fa-trash-o"></i></a> ';return d.can("clientes_view")&&(o+=s),d.can("clientes_edit")&&(o+=r),d.can("clientes_delete")&&(o+=c),o}),o.newColumn("currentDate").withTitle("Fecha").withOption("width",200),o.newColumn("agent.name").withTitle("Usuario").withOption("width",200),o.newColumn("description").withTitle("Observación").withOption("width",200)];var g=function(){$("#dtol a.editRow").on("click",function(){var n=$(this).data("id");i.editDiagnosticObservation(n)}),$("#dtol a.viewRow").on("click",function(){var n=$(this).data("id");i.observation.id=n,i.viewDiagnosticObservation(n)}),$("#dtol a.delRow").on("click",function(){var n=$(this).data("id");m.info("intenta eliminar el registro: "+n),f.swal({title:"Está seguro?",text:"Eliminará la observación seleccionada.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(t){if(t){var o={};o.id=n,u({method:"POST",url:"api/diagnostic/observation/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(i){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(i){a.error(i),f.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){i.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};i.reloadData=function(){i.dtInstanceDiagnosticObservation.reloadData()},i.editDiagnosticObservation=function(n){i.observation.id=n,i.isView=!1,i.onLoadRecord()},i.viewDiagnosticObservation=function(n){i.observation.id=n,i.isView=!0,i.onLoadRecord()},i.createDiagnosticObservation=function(){var t={},o={id:0,customerId:n.customerId,status:{id:0,item:"Iniciado",value:"iniciado"}},e=JSON.stringify(o);t.data=Base64.encode(e),u({method:"POST",url:"api/diagnostic/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(n){null!=i.$parent&&(i.reloadData(),swal("Creado","Observación adicionada satisfactoriamente","info"))})["catch"](function(i){a.error(i),f.swal("Error Creando","Se ha presentado un error durante la creación de la observación por favor intentelo de nuevo","error")})["finally"](function(){})}}]);
"use strict";app.controller("customerDiagnosticObservationListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$document","$filter",function(n,i,t,a,e,o,r,s,l,c,d,u,f,w,m){var p=t,g={};n.loading=!0,n.isView=!1,n.agents=c.agents(),n.diagnostic_id=i.customerId;var v=function(){n.observation={id:"0",diagnosticId:i.customerId,currentDate:m("date")(new Date,"dd/MM/yyyy HH:mm"),agent:null,description:null},n.isView=!1};v(),n.onLoadRecord=function(){if(0!=n.observation.id){p.info("editando cliente con código: "+n.observation.id);var i={id:n.observation.id,diagnostic_id:n.diagnostic_id};u({method:"GET",url:"api/diagnostic/observation/get",params:i})["catch"](function(n,i){if(403==i){var t=null!==n.message&&void 0!==n.message?n.message:"app.clientes.list";f.swal("No Autorizado","No estas autorizado para ver esta información.","error"),d(function(){l.go(t)},3e3)}else 404==i?(f.swal("Información no disponible","Observación no encontrada","error"),d(function(){l.go("app.clientes.list")})):f.swal("Error","Se ha presentado un error al intentar acceder a la información de la observación","error")}).then(function(i){d(function(){n.observation=i.data.result,n.observation.diagnosticId=n.diagnostic_id})})["finally"](function(){d(function(){n.loading=!1},400),d(function(){w.scrollTop(40,2e3)})})}else n.loading=!1},n.onLoadRecord(),n.master=n.observation,n.form={submit:function(i){var t=null;if(i.$invalid){var a=null,t=null;for(a in i)"$"!=a[0]&&(null!==t||i[a].$valid||(t=i[a].$name),i[a].$pristine&&(i[a].$dirty=!0));return p.info(n.observation),angular.element(".ng-invalid[name="+t+"]").focus(),void f.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}h()},reset:function(i){n.clear()}};var h=function(){var i={},a=JSON.stringify(n.observation);return i.data=Base64.encode(a),u({method:"POST",url:"api/diagnostic/observation/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(i){d(function(){f.swal("Registro","La información ha sido guardada satisfactoriamente","success"),v(),n.reloadData()})})["catch"](function(n){t.error(n),f.swal("Error de guardado","Error guardando la observación por favor verifique los datos ingresados!","error")})["finally"](function(){})};n.onClear=function(){v()},g.operation="diagnostic",g.diagnostic_id=n.diagnostic_id,n.dtInstanceDiagnosticObservation={},n.dtOptionsDiagnosticObservation=a.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:g,url:"api/diagnostic/observation",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){b()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(i,t,a){r(angular.element(i).contents())(n)}),n.dtColumnsDiagnosticObservation=[e.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(n,i,t,a){var e="",o="",r='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar"  data-id="'+n.id+'"'+o+' >   <i class="fa fa-edit"></i></a> ',s='<a class="btn btn-info btn-xs viewRow lnk" href="#"  uib-tooltip="Ver" data-id="'+n.id+'" >   <i class="fa fa-eye"></i></a> ',l='<a class="btn btn-danger btn-xs delRow lnk" href="#"  uib-tooltip="Eliminar" data-id="'+n.id+'"'+o+' >   <i class="fa fa-trash-o"></i></a> ';return c.can("clientes_view")&&(e+=s),c.can("clientes_edit")&&(e+=r),c.can("clientes_delete")&&(e+=l),e}),e.newColumn("currentDate").withTitle("Fecha").withOption("width",200).withOption("defaultContent",""),e.newColumn("agent.name").withTitle("Usuario").withOption("width",200).withOption("defaultContent",""),e.newColumn("description").withTitle("Observación").withOption("defaultContent","")];var b=function(){angular.element("#dtDiagnosticObservation a.editRow").on("click",function(){var i=angular.element(this).data("id");n.onEdit(i)}),angular.element("#dtDiagnosticObservation a.viewRow").on("click",function(){var i=angular.element(this).data("id");n.onView(i)}),angular.element("#dtDiagnosticObservation a.delRow").on("click",function(){var i=angular.element(this).data("id");f.swal({title:"Está seguro?",text:"Eliminará la observación seleccionada.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(a){if(a){var e={};e.id=i,u({method:"POST",url:"api/diagnostic/observation/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(n){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(n){t.error(n),f.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){n.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};n.dtInstanceDiagnosticObservationCallback=function(i){n.dtInstanceDiagnosticObservation=i},n.reloadData=function(){n.dtInstanceDiagnosticObservation.reloadData()},n.onEdit=function(i){n.observation.id=i,n.isView=!1,n.onLoadRecord()},n.onView=function(i){n.observation.id=i,n.isView=!0,n.onLoadRecord()}}]);
"use strict";app.controller("customerManagementTabsCtrl",["$scope","$rootScope","$timeout","$filter",function(t,e,n,a){t.views=[{name:"basic",url:e.app.views.urlRoot+"modules/customer/management/customer_management.htm"},{name:"indicator",url:e.app.views.urlRoot+"modules/customer/management/indicators/customer_management_indicators.htm"}],t.loading=!1,t.tabname="basic",t.getView=function(e){var n=a("filter")(t.views,{name:e});return n[0]},t.switchTab=function(e){n(function(){t.tabname=e})},t.switchSubTab=function(e){n(function(){t.subtab=e})}}]);
"use strict";app.controller("customerManagementCtrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout",function(t,n,e,a,r,o){var c=e;c.info("loading..customerManagementCtrl!!! "),t.management_section="list",t.currentManagement=0,t.currentProgram=0,t.navToSection=function(n,e,a,r){o(function(){t.management_section=n,t.$parent.switchSubTab(e),t.currentManagement=a,t.currentProgram=r})}}]);
"use strict";app.controller("customerManagementListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert",function(e,n,t,a,i,o,r,l,c,s,u,d,m){e.isNew=!1,e.isAgent="agent"==s.currentUser().wg_type,e.isAdmin="system"==s.currentUser().wg_type,e.isCustomer="customerAdmin"==s.currentUser().wg_type||"customerUser"==s.currentUser().wg_type,e.dtInstanceManagement={},e.dtOptionsManagement=a.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerId=n.customerId,JSON.stringify(e)},url:"api/customer-management",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){p()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(n,t,a){r(angular.element(n).contents())(e)}),e.dtColumnsManagement=[i.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,n,t,a){var i="",o="";"completado"!=e.statusCode&&"cancelado"!=e.statusCode||(o='ng-disabled="true"');var r='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Continuar"  data-id="'+e.id+'"'+o+' >   <i class="fa fa-play-circle"></i></a> ',l='<a class="btn btn-danger btn-xs delRow lnk" href="#"  uib-tooltip="Eliminar" data-id="'+e.id+'"'+o+' >   <i class="fa fa-trash-o"></i></a> ',c='<a class="btn btn-blue btn-xs cancelRow lnk" href="#" uib-tooltip="Cancelar" data-id="'+e.id+'"'+o+' >   <i class="fa fa-ban"></i></a> ';return s.can("programa_empresarial_continue")&&(i+=r),s.can("programa_empresarial_delete")&&(i+=l),s.can("programa_empresarial_cancel")&&(i+=c),i}),i.newColumn("workplace").withTitle("Centro de Trabajo").withOption("defaultContent",""),i.newColumn("economicSector").withTitle("Sector Económico").withOption("defaultContent",""),i.newColumn("program").withTitle("Programa Empresarial").withOption("defaultContent",""),i.newColumn("createdAt").withTitle("Fecha Creación").withOption("width",200).renderWith(function(e,n,t,a){return"object"==typeof e&&null!=e?moment(e.date).format("DD/MM/YYYY"):null!=e?moment(e).format("DD/MM/YYYY"):""}),i.newColumn("createdBy").withTitle("Responsable Seguimiento").withOption("defaultContent",""),i.newColumn(null).withTitle("Estado").withOption("width",200).renderWith(function(e,n,t,a){var i="";switch(e.statusCode){case"completado":i="label label-success";break;case"cancelado":i="label label-inverse";break;case"iniciado":i="label label-warning"}var o='<span class="'+i+'">'+e.status+"</span>";return o})];var p=function(){angular.element("#dtCustomerManagement a.editRow").on("click",function(){if(!$(this).is("[disabled]")){var n=angular.element(this).data("id");e.onEdit(n)}}),angular.element("#dtCustomerManagement a.delRow").on("click",function(){if(!$(this).is("[disabled]")){var n=angular.element(this).data("id");m.swal({title:"Está seguro?",text:"Eliminará la gestión seleccionada.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(a){if(a){var i={};i.id=n,d({method:"POST",url:"api/management/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){t.error(e),m.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){e.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})}}),angular.element("a.cancelRow").on("click",function(){if(!$(this).is("[disabled]")){var n=angular.element(this).data("id");m.swal({title:"Está seguro?",text:"Cancelar el diagnóstico seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, cancelar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(a){if(a){var i={};i.id=n,d({method:"POST",url:"api/management/cancel",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(e){swal("Eliminado","Gestión cancelada satisfactoriamente","info")})["catch"](function(e){t.error(e),m.swal("Error en la cancelación","Se ha presentado un error durante la cancelacón la gestión por favor intentelo de nuevo","error")})["finally"](function(){e.reloadData()})}else swal("Terminado","Operación terminada","error")})}})};e.dtInstanceManagementCallback=function(n){e.dtInstanceManagement=n},e.reloadData=function(){e.dtInstanceManagement.reloadData(),canCreate()},e.onConfig=function(){null!=e.$parent&&e.$parent.navToSection("setting","setting")},e.onEdit=function(n){null!=e.$parent&&e.$parent.navToSection("summary","summary",n)}}]);
"use strict";app.controller("customerManagementSettingCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","ListService","$aside",function(t,e,n,o,r,i,a,c,l,u,s,d,m,p,f){t.record={},t.currentEntity={};var g=function(){t.entity={id:0,customerId:e.customerId,economicSector:null,programEconomicSector:null,customerWorkplace:null,programId:null,active:!0}};g();var w=function(){var n=[{name:"economic_sector",value:null},{name:"customer_workplace",value:e.customerId}];p.getDataList(n).then(function(e){t.economicSectorList=e.data.data.economicSectorList,t.workplaceList=e.data.data.workplaceList},function(t){})};w(),t.onSelectEconomicSector=function(){t.reloadData()},t.onSelectWorkplace=function(){t.reloadData()},t.onCreate=function(){"E"==t.customer.matrixType?h():"G"==t.customer.matrixType?v():c.pop("error","Atención!","No se ha configurado el tipo de matríz de peligros en la empresa.")},t.onRefresh=function(){w()};var h=function(){var e=f.open({templateUrl:u.app.views.urlRoot+"modules/customer/common/modals/customer_express_matrix_work_place_modal.htm",placement:"right",size:"lg",backdrop:"static",controller:"ModalInstanceSideCustomerDiagnosticExpressMatrixWorkplaceCtrl",scope:t,resolve:{entity:function(){return{id:0}},isView:function(){return t.isView},closeAfterCreate:function(){return!0}}});e.result.then(function(e){t.workplaceList.push(e),t.entity.customerWorkplace=e,t.reloadData()},function(){w()})},v=function(){var e=f.open({templateUrl:u.app.views.urlRoot+"modules/customer/common/modals/customer_gtc_matrix_work_place_modal.htm",placement:"right",size:"lg",backdrop:"static",controller:"ModalInstanceSideWorkplaceMatrixGTC45Ctrl",scope:t,resolve:{entity:function(){return{id:0}},isView:function(){return t.isView},closeAfterCreate:function(){return!0}}});e.result.then(function(e){t.workplaceList.push(e),t.entity.customerWorkplace=e,t.reloadData()},function(){w()})};t.dtOptionsManagementSetting=o.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(n){return n.customerId=e.customerId,n.economicSectorId=t.entity.economicSector?t.entity.economicSector.id:-1,t.entity.customerWorkplace&&(n.workplaceId=t.entity.customerWorkplace?t.entity.customerWorkplace.id:-1),JSON.stringify(n)},url:"api/customer-management-setting",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(t){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withPaginationType("full_numbers").withOption("createdRow",function(e,n,o){a(angular.element(e).contents())(t)}),t.dtColumnsManagementSetting=[r.newColumn("abbreviation").withTitle("Código").withOption("width",200).withOption("defaultContent",""),r.newColumn("name").withTitle("Programa").withOption("defaultContent",""),r.newColumn(null).withOption("width",200).withTitle("Acciones").notSortable().renderWith(function(e,n,o,r){t.record[e.id]=e;var i="",a=t.currentEntity&&t.currentEntity.id==e.customerManagementId?"checked ":"",c='<div class="radio clip-radio radio-success"> <input type="radio" id="checked_'+e.id+'" '+a+'name="selected_program" value="'+e.id+'"  ng-click="select(record['+e.id+'])"><label class="text-bold" for="checked_'+e.id+'"> Seleccionar </label> </div>';return i+=c}).notSortable()],t.select=function(n){t.entity.id="iniciado"==n.status?n.customerManagementId:0,t.entity.programId=n.programId,t.entity.customerId=e.customerId,t.entity.programEconomicSector={id:n.id}},t.dtInstanceManagementSetting=function(e){t.dtInstanceManagementSetting=e},t.reloadData=function(){t.dtInstanceManagementSetting.reloadData()},t.form={submit:function(t){var e=null;if(t.$invalid){var n=null,e=null;for(n in t)"$"!=n[0]&&(null!==e||t[n].$valid||(e=t[n].$name),t[n].$pristine&&(t[n].$dirty=!0));return angular.element(".ng-invalid[name="+e+"]").focus(),void m.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}y()},reset:function(e){t.employee=angular.copy(t.master),e.$setPristine(!0)}};var y=function(){if(null==t.entity.programEconomicSector)return void m.swal("Atención!","Por favor seleccione un programa.","error");var e=JSON.stringify(t.entity);return d({method:"POST",url:"api/customer-management/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param({data:Base64.encode(e)})}).then(function(e){t.currentEntity=e.data.result,t.entity.id=e.data.result.id,t.reloadData(),s(function(){c.pop("success","Operación Exitosa","Actualización exitosa.")})})["catch"](function(t){400==t.status?c.pop("error","Error",t.data.message):c.pop("error","Error","Error guardando el registro. Por favor verifique los datos ingresados!")})["finally"](function(){})};t.onContinue=function(){null!=t.$parent&&t.$parent.navToSection("summary","summary",t.entity.id)},t.onCancel=function(e){null!=t.$parent&&t.$parent.navToSection("list","list")},t.editManagement=function(e){null!=t.$parent&&t.$parent.navToSection("report","report",t.entity.id)}}]);
"use strict";app.controller("customerManagementSummaryCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","ChartService",function(t,n,a,e,r,o,i,l,c,m,u,p,s,d){function h(){var n={managementId:t.$parent.currentManagement},a=[{name:"chart_bar_options",criteria:null},{name:"chart_doughnut_options",criteria:null},{name:"customer_management",criteria:n}];d.getDataChart(a).then(function(n){t.chart.bar.options=n.data.data.chartBarOptions,t.chart.doughnut.options=n.data.data.chartLineOptions,t.chart.programs.data=n.data.data.customerManagementProgram,t.chart.progress.data=n.data.data.customerManagementProgress,t.chart.progress.total=n.data.data.customerManagementAverage},function(n){t.status="Unable to load customer data: "+n.message})}t.chart={bar:{options:null},doughnut:{options:null},programs:{data:null},progress:{data:null,total:0}},h(),t.dtInstanceManagementSummary={},t.dtOptionsManagementSummary=e.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(a){return a.operation="management",a.customer_id=n.customerId,a.management_id=t.$parent.currentManagement,a},url:"api/management/summary",type:"POST",beforeSend:function(){},complete:function(t){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){w()}).withDOM("tr").withOption("paging",!1).withOption("createdRow",function(n,a,e){i(angular.element(n).contents())(t)}),t.dtColumnsManagementSummary=[r.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,n,a,e){var r="",o="",i='<a class="btn btn-primary btn-xs continueRow lnk" href="#" uib-tooltip="Continuar"  data-id="'+t.id+'"'+o+' >   <i class="fa fa-play-circle"></i></a> ';return m.can("programa_empresarial_continue")&&(r+=i),r}),r.newColumn("workplace").withTitle("Centro de Trabajo").withOption("width",200),r.newColumn("abbreviation").withTitle("Código").withOption("width",200),r.newColumn("name").withTitle("Programa").withOption("width",400),r.newColumn("questions").withTitle("Preguntas").withOption("width",200),r.newColumn("answers").withTitle("Respuestas").withOption("width",200),r.newColumn("advance").withTitle("Avance (%)").withOption("width",200),r.newColumn("average").withTitle("Promedio Total (%)").withOption("width",200),r.newColumn(null).withTitle("Estado").withOption("width",200).renderWith(function(t,n,a,e){var r="label label-danger",o="Sin Iniciar";parseInt(t.answers)==parseInt(t.questions)?(o="Completado",r="label label-info"):parseInt(t.answers)>0&&(o="Iniciado",r="label label-success");var i='<span class="'+r+'">'+o+"</span>";return i}).notSortable()];var w=function(){angular.element("a.continueRow").on("click",function(){var n=angular.element(this).data("id");null!=t.$parent&&t.$parent.navToSection("edit","edit",t.$parent.currentManagement,n)})};t.dtInstanceManagementSummaryCallback=function(n){t.dtInstanceManagementSummary=n},t.reloadData=function(){t.dtInstanceManagementSummary.reloadData()},t.onImport=function(){null!=t.$parent&&t.$parent.navToSection("import","import",t.$parent.currentManagement)},t.onAttachment=function(){null!=t.$parent&&t.$parent.navToSection("attachment","attachment",t.$parent.currentManagement)},t.onViewReport=function(n){null!=t.$parent&&t.$parent.navToSection("report","report",t.$parent.currentManagement)},t.onViewReportMonthly=function(){null!=t.$parent&&t.$parent.navToSection("report_monthly","report_monthly",t.$parent.currentManagement)},t.onCancel=function(n){null!=t.$parent&&t.$parent.navToSection("list","list")},t.onExportPdf=function(){kendo.drawing.drawDOM($(".management-export-pdf")).then(function(t){return kendo.drawing.exportPDF(t,{paperSize:"auto",margin:{left:"1cm",top:"1cm",right:"1cm",bottom:"1cm"}})}).done(function(t){kendo.saveAs({dataURI:t,fileName:"Programas_Empresariales_Resumen.pdf",proxyURL:"//demos.telerik.com/kendo-ui/service/export"})})},t.onExportExcel=function(){jQuery("#downloadDocument")[0].src="api/management/summary/export-excel?id="+t.$parent.currentManagement}}]);
"use strict";app.controller("customerManagementEditCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","SweetAlert","$rootScope","$http","$timeout","$uibModal","flowFactory","cfpLoadingBar","$document","$filter","$aside","FileUploader","ChartService","ListService",function(e,t,n,a,o,i,r,l,s,c,d,u,m,p,f,h,g,w,v,b,C,y){function O(){var t={managementId:P},n=[{name:"chart_bar_options",criteria:null},{name:"chart_doughnut_options",criteria:null},{name:"customer_management",criteria:t}];C.getDataChart(n).then(function(t){e.chart.bar.options=t.data.data.chartBarOptions,e.chart.doughnut.options=t.data.data.chartLineOptions,e.chart.programs.data=t.data.data.customerManagementProgram,e.chart.progress.data=t.data.data.customerManagementProgress,e.chart.progress.total=t.data.data.customerManagementAverage},function(t){e.status="Unable to load customer data: "+t.message})}function x(){var t=[{name:"customer_management_program",value:P}];y.getDataList(t).then(function(t){e.chapters=t.data.data.customerManagementProgram,k()},function(t){e.status="Unable to load customer data: "+t.message})}var S=n,D={refresh:!0,index:0},T={id:e.$parent.currentProgram,code:null},I={model:null},P=e.$parent.currentManagement;e.rateList=d.rates(),e.currentStep=-1,e.chart={bar:{options:null},doughnut:{options:null},programs:{data:null},progress:{data:null,total:0}},O(),x();var k=function(){if(n.info("initializeWizard"),0!=T.id){var t=w("filter")(e.chapters,function(e){return e.id==T.id});e.currentStep=t.length>0?e.chapters.indexOf(t[0]):e.chapters.length-1,T.id=e.chapters[e.currentStep].id,T.code=e.chapters[e.currentStep].abbreviation}},_=function(){n.info("refreshOnChange"),x(),O(),e.grid.dataSource.read()};e.rateOptions={dataSource:e.rateList,dataTextField:"text",dataValueField:"id",change:function(){},select:function(t){var n=this.dataItem(t.item);I.model&&I.model.rateId!=n.id&&(I.model.rate=n,e.onSave(I.model))}},m(function(){e.mainGridOptions={dataSource:{type:"odata",transport:{read:{url:"api/customer-management-detail",dataType:"json",type:"POST",data:function(){var e={managementId:P,sizeOf:P,programId:T.id};return e}},parameterMap:function(e,t){return JSON.stringify(e)}},schema:{model:{id:"id",fields:{description:{editable:!1,nullable:!0},documentNumber:{editable:!1,nullable:!0},businessName:{editable:!1,nullable:!0},isActive:{editable:!1,nullable:!0,type:"boolean"}}},data:function(e){return e.data||e},total:function(e){return e.recordsTotal||e.data.length||0}},pageSize:10,serverPaging:!0,serverFiltering:!0,serverSorting:!0},sortable:{mode:"multiple"},pageable:{change:function(e){D.index=e.index,S.info("page.index",D.index)}},filterable:{mode:"row"},dataBound:function(e){this.expandRow(this.tbody.find("tr.k-master-row"))},columns:[{field:"name",title:"Categoría",attributes:{"class":"text-orange text-large"},filterable:{cell:{operator:"contains",suggestionOperator:"contains"}}},{field:null,title:"Avance",width:"150px",attributes:{style:"text-align: center"},filterable:!1,template:function(e){var t='<h4 class="no-margin">'+e.advance+"%</h4>";return t+='<uib-progressbar value="'+e.advance+'" class="progress-xs no-radius no-margin" type="success"></uib-progressbar>',t+=e.answers+" de "+e.questions}},{field:null,title:"Promedio",width:"150px",attributes:{style:"text-align: center"},filterable:!1,template:function(e){var t='<h4 class="no-margin">'+e.average+"%</h4>";return t+='<uib-progressbar value="'+e.total+'" class="progress-xs no-radius no-margin" type="success"></uib-progressbar>',t+="Promedio Total"}}]},e.detailGridOptions=function(e){return{dataSource:{type:"odata",transport:{read:{url:"api/customer-management-detail-question",dataType:"json",type:"POST",data:function(){var t={categoryId:e.id,managementId:P,sizeOf:P,programId:T.id};return t}},parameterMap:function(e,t){return JSON.stringify(e)}},requestEnd:function(e){},schema:{model:{id:"id",fields:{description:{editable:!1,nullable:!0},article:{editable:!1,nullable:!0},rate:{editable:!0,defaultValue:{id:0,text:null,code:null}}}},data:function(e){return e.data||e},total:function(e){return e.recordsTotal||e.data.length||0}},serverPaging:!1,serverSorting:!0,serverFiltering:!1,filter:{field:"categoryId",operator:"eq",value:e.id}},editable:"incell",edit:function(e){I.model=e.model},scrollable:!1,sortable:!0,pageable:!1,dataBound:function(e){e.sender.tbody.find("tr").each(function(){var t=e.sender.dataItem(this);d.can("programa_empresarial_resource_view")?0==t.hasResource&&$(this).find(".btn-dark-azure").remove():$(this).find(".btn-dark-azure").remove()})},columns:[{command:[{text:" ",template:"<a class='btn btn-light-red btn btn-xs' ng-click='onAddComment(dataItem)' uib-tooltip='Comentarios' tooltip-placement='right'><i class='fa fa-comments'></i></a> "},{text:" ",template:"<a class='btn btn-warning btn btn-xs' ng-click='onAddImprovementPlan(dataItem)' uib-tooltip='Plan Mejoramiento' tooltip-placement='right'><i class='fa fa-plus-square'></i></a> "},{text:" ",template:"<a class='btn btn-info btn btn-xs' ng-click='onAddAttachment(dataItem)' uib-tooltip='Anexos' tooltip-placement='right'><i class='fa fa-paperclip'></i></a> "}],width:"130px",headerAttributes:{style:"display: none"}},{field:"description",title:"Descripción",headerAttributes:{style:"display: none"}},{field:"article",title:"Artículo",width:"150px",headerAttributes:{style:"display: none"},attributes:{style:"text-align: center"}},{field:"rate",title:"Calificación",width:"220px",editor:'<input kendo-drop-down-list k-value-primitive="true" k-options="rateOptions"  />',template:function(e){return e.rate?e.rate.text:"-Seleccionar-"},headerAttributes:{style:"display: none"},attributes:{style:"text-align: center;font-weight: bold;","class":"text-capitalize text-dark"}},{title:"icon",width:"70px",headerAttributes:{style:"display: none"},template:function(e){var t="";switch(e.rateCode){case"na":t='<i class="fa fa-ban text-yellow text-extra-extra-large"></i>';break;case"cp":t='<i class="fa fa-minus-circle text-muted text-extra-extra-large"></i>';break;case"nc":t='<i class="fa fa-circle-o text-red text-extra-extra-large"></i>';break;case"c":t='<i class="fa fa-check-circle-o text-green text-extra-extra-large"></i>';break;default:t='<i class="fa fa-question-circle text-orange text-extra-extra-large"></i>'}return t},attributes:{style:"text-align: center;font-weight: bold;"}}]}}}),e.$on("kendoWidgetCreated",function(t,n){void 0!==e.grid&&null!==e.grid||(e.grid=n)}),e.form={next:function(t){if(e.toTheTop(),t.$valid)A();else{var n=null,a=null;for(n in t)"$"!=n[0]&&(null!==a||t[n].$valid||(a=t[n].$name),t[n].$pristine&&(t[n].$dirty=!0));angular.element(".ng-invalid[name="+a+"]").focus(),E()}},prev:function(t){e.toTheTop(),M()},goTo:function(t,n){parseInt(e.currentStep)>parseInt(n)?(e.toTheTop(),B(n)):(e.toTheTop(),B(n))},submit:function(){},reset:function(){}};var A=function(){e.currentStep++,T.id=e.chapters[e.currentStep].id,T.code=e.chapters[e.currentStep].abbreviation,n.info("nextStep"),e.grid.dataSource.read()},M=function(){e.currentStep--,T.id=e.chapters[e.currentStep].id,T.code=e.chapters[e.currentStep].abbreviation,n.info("prevStep"),e.grid.dataSource.read()},B=function(t){e.currentStep=t,T.id=e.chapters[e.currentStep].id,T.code=e.chapters[e.currentStep].abbreviation,n.info("goToStep"),e.grid.dataSource.read()},E=function(e){l.pop("error","Error","Por favor complete el formulario en este paso antes de continuar.")};e.onSave=function(e){e.programId=T.id;var t={},a=JSON.stringify(e);return t.data=Base64.encode(a),u({method:"POST",url:"api/management/detail/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(e){m(function(){l.pop("success","Actualización","La información ha sido actualizada satisfactoriamente."),_()})})["catch"](function(e){n.error(e),l.pop("error","Error","Error guardando el registro. Por favor verifique los datos ingresados!")})["finally"](function(){})},e.onCancel=function(){null!=e.$parent&&e.$parent.navToSection("summary","summary",P)},e.onAddComment=function(t){var a=v.open({templateUrl:d.app.views.urlRoot+"modules/customer/common/modals/customer_questions_comment_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideManagementDetailCommentCtrl",scope:e,resolve:{question:function(){return t}}});a.result.then(function(){e.reloadData()},function(){n.info("Modal dismissed at: "+new Date)})},e.onAddAttachment=function(t){var a=v.open({templateUrl:d.app.views.urlRoot+"modules/customer/common/modals/customer_document_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideManagementAttachmentCtrl",scope:e,resolve:{dataItem:function(){return t},isView:function(){return e.isView},program:function(){return T}}});a.result.then(function(){},function(){n.info("Modal dismissed at: "+new Date)})},e.onAddImprovementPlan=function(t){var a=v.open({templateUrl:d.app.views.urlRoot+"modules/customer/common/modals/customer_improvement_plan_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideCustomerManagementDetailImprovementPlanCtrl",scope:e,resolve:{question:function(){return t},isView:function(){return e.isView},program:function(){return e.chapters[e.currentStep]}}});a.result.then(function(){},function(){n.info("Modal dismissed at: "+new Date)})},e.onSummaryExportExcel=function(){jQuery("#downloadDocument")[0].src="api/customer-management-detail/export-excel?id="+P+"&program="+T.id}}]),app.controller("ModalInstanceSideManagementAttachmentCtrl",["$stateParams","$rootScope","$scope","$uibModalInstance","$log","$timeout","SweetAlert","isView","dataItem","program","$filter","FileUploader","$http","DTColumnBuilder","DTOptionsBuilder","$compile","ListService",function(e,t,n,a,o,i,r,l,s,c,d,u,m,p,f,h,g){function w(){var t=[{name:"customer_document_type",value:e.customerId}];g.getDataList(t).then(function(e){n.documentType=e.data.data.customerDocumentType},function(e){n.status="Unable to load customer data: "+e.message})}var v=0,b="M";n.documentClassification=t.parameters("customer_document_classification"),n.documentStatus=t.parameters("customer_document_status"),n.isView=l,w();var C=function(){n.attachment={id:0,managementDetailId:s.id,type:null,classification:null,description:null,status:n.documentStatus?n.documentStatus[0]:null,version:1,program:c.code,label:b}};C(),n.onCloseModal=function(){a.close(1)},n.onCancel=function(){a.dismiss("cancel")},n.onClear=function(){C()};var y=n.uploader=new u({url:"api/customer-management-detail-document/upload",formData:[],removeAfterUpload:!0});y.filters.push({name:"customFilter",fn:function(e,t){return this.queue.length<10}}),y.onBeforeUploadItem=function(e){var t={id:v};e.formData.push(t)},y.onCompleteAll=function(){n.reloadData(),n.onClear()},n.form={submit:function(e){var t=null;if(e.$invalid){var n=null,t=null;for(n in e)"$"!=n[0]&&(null!==t||e[n].$valid||(t=e[n].$name),e[n].$pristine&&(e[n].$dirty=!0));return angular.element(".ng-invalid[name="+t+"]").focus(),void r.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}r.swal("Validación exitosa","Procediendo con el guardado...","success"),O()},reset:function(e){e.$setPristine(!0)}};var O=function(){var e={},t=JSON.stringify(n.attachment);return e.data=Base64.encode(t),m({method:"POST",url:"api/customer-management-detail-document/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){i(function(){y.queue.length>0?(v=e.data.result.id,y.uploadAll()):(n.reloadData(),n.onClear())})})["catch"](function(e){r.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){n.reloadData()})};n.dtInstanceCustomerDocumentModal={},n.dtOptionsCustomerDocumentModal=f.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.customerId=e.customerId,t.managementDetailId=s.id,t.statusCode="2",JSON.stringify(t)},url:"api/customer-management-detail-document",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){x()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,t,a){h(angular.element(e).contents())(n)}),n.dtColumnsCustomerDocumentModal=[p.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,n,a,o){var i=e.documentUrl?e.documentUrl:"",r="api/customer-management-detail-document/download?id="+e.id,l="",s='<a target="_self" class="btn btn-primary btn-xs downloadDocumentRow lnk" href="'+r+'" uib-tooltip="Descargar anexo" data-id="'+e.id+'" data-url="'+i+'" >   <i class="fa fa-download"></i></a> ',c='<a class="btn btn-info btn-xs openDocumentRow lnk" target="_blank" href="'+i+'" uib-tooltip="Abrir anexo" data-id="'+e.id+'" >   <i class="fa fa-folder-open-o"></i></a> ',d=!1;return null==e.protectionType?d=!0:"public"==e.protectionType?d=!0:"private"==e.protectionType&&1==e.hasPermission&&(d=!0),t.can("clientes_anexo_open")&&""!=i&&(l+=c),t.can("clientes_anexo_download")&&""!=i&&(l+=s),d?l:""}),p.newColumn("documentType").withTitle("Tipo de documento").withOption("width",200),p.newColumn("classification").withTitle("Clasificación").withOption("width",200),p.newColumn("description").withTitle("Descripción").withOption("width",200),p.newColumn("version").withTitle("Versión").withOption("width",200),p.newColumn("createdAt").withTitle("Fecha Creación").withOption("width",200).withOption("defaultContent",""),p.newColumn("status").withTitle("Estado").withOption("width",200).renderWith(function(e,t,n,a){var o="";switch(e){case"Vigente":o="label label-success";break;case"Anulado":o="label label-danger"}var i='<span class="'+o+'">'+e+"</span>";return i})];var x=function(){$("#dtCustomerDocumentModal a.editRow").on("click",function(){})};n.dtInstanceCustomerDocumentModalCallback=function(e){n.dtInstanceCustomerDocumentModal=e},n.reloadData=function(){n.dtInstanceCustomerDocumentModal.reloadData()}}]),app.controller("ModalInstanceSideManagementDetailCommentCtrl",["$stateParams","$rootScope","$scope","$uibModalInstance","question","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile","$document",function(e,t,n,a,o,i,r,l,s,c,d,u,m,p,f,h){var g=function(){n.entity={id:0,managementDetailId:o.id,comment:""}};g(),n.onCloseModal=function(){a.close(1)},n.onCancel=function(){a.dismiss("cancel")},n.onClear=function(){g()},n.form={submit:function(e){var t=null;if(e.$invalid){var a=null,t=null;for(a in e)"$"!=a[0]&&(null!==t||e[a].$valid||(t=e[a].$name),e[a].$pristine&&(e[a].$dirty=!0));return angular.element(".ng-invalid[name="+t+"]").focus(),void r(function(){c.pop("error","Error","Por favor verifique los datos requeridos del formulario y vuelva a intentarlo")},500)}n.onSave()},reset:function(e){e.$setPristine(!0)}},n.onSave=function(){var e={},t=JSON.stringify(n.entity);return e.data=Base64.encode(t),s({method:"POST",url:"api/management/comment/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){r(function(){c.pop("success","Operación Exitosa","Actualización exitosa."),n.onClear(),n.reloadData()})})["catch"](function(e){c.pop("Error","Error inesperado",e)})["finally"](function(){})};var w={};w.operation="document",w.management_detail_id=o.id,n.dtInstanceQuestionComment={},n.dtOptionsQuestionComment=p.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:w,url:"api/management/comment",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,t,a){f(angular.element(e).contents())(n)}),n.dtColumnsQuestionComment=[m.newColumn("comment").withTitle("Comentario"),m.newColumn("user").withTitle("Usuario").withOption("width",200).withOption("defaultContent",200),m.newColumn("createdAt").withTitle("Fecha").withOption("width",200)],n.dtInstanceQuestionCommentCallback=function(e){n.dtInstanceQuestionComment=e},n.reloadData=function(){n.dtInstanceQuestionComment.reloadData()}}]),app.controller("ModalInstanceSideCustomerManagementDetailImprovementPlanCtrl",["$stateParams","$rootScope","$scope","$uibModalInstance","question","program","$log","$timeout","SweetAlert","isView","$filter","FileUploader","$http","DTOptionsBuilder","DTColumnBuilder","$compile",function(e,t,n,a,o,i,r,l,s,c,d,u,m,p,f,h){n.maxDate=new Date,n.datePickerConfig={culture:"es-CO",format:"dd/MM/yyyy HH:mm"},n.responsibleList=[],n.typesAlert=d("orderBy")(t.parameters("tracking_alert_type"),"id",!1),n.typesTime=t.parameters("tracking_alert_timeType"),n.statusAlert=t.parameters("tracking_alert_status"),n.preferencesAlert=t.parameters("tracking_alert_preference"),n.typeList=t.parameters("improvement_plan_type");var g=function(){n.improvement={id:0,customerId:e.customerId,classificationName:i.abbreviation,classificationId:i.abbreviation,entityName:"PE",entityId:o.id,type:null,endDate:null,description:"",observation:"",responsible:null,isRequiresAnalysis:!1,status:{id:0,value:"CR",item:"Creada"},trackingList:[],alertList:[]}};g(),n.onLoadRecord=function(e){if(0!=e){var t={id:e};m({method:"GET",url:"api/customer/improvement-plan",params:t})["catch"](function(e,t){if(403==t){var n=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";s.swal("No Autorizado","No estas autorizado para ver esta información.","error"),l(function(){$state.go(n)},3e3)}else 404==t?s.swal("Información no disponible","Centro de trabajo no encontrado","error"):s.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(e){l(function(){null!=e.data.result&&""!=e.data.result&&(n.improvement=e.data.result,b())},400)})["finally"](function(){})}else n.loading=!1},n.onCloseModal=function(){a.close(1)},n.onCancel=function(){a.dismiss("cancel")},n.onClear=function(){};var w=function(){var t={customer_id:e.customerId};return m({method:"POST",url:"api/customer/improvement-plan/list-data",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(e){l(function(){n.responsibleList=e.data.data.responsible})})["catch"](function(e){s.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};w(),n.master=n.improvement,n.form={submit:function(e){var t=null;if(e.$invalid){var n=null,t=null;for(n in e)"$"!=n[0]&&(null!==t||e[n].$valid||(t=e[n].$name),e[n].$pristine&&(e[n].$dirty=!0));return angular.element(".ng-invalid[name="+t+"]").focus(),void s.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}s.swal("Validación exitosa","Procediendo con el guardado...","success"),v()},reset:function(e){n.improvement=angular.copy(n.master),e.$setPristine(!0)}};var v=function(){var e={},t=JSON.stringify(n.improvement);return e.data=Base64.encode(t),m({method:"POST",url:"api/customer/improvement-plan/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){l(function(){g()})})["catch"](function(e){s.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){n.reloadData()})},b=function(){null!=n.improvement.endDate&&(n.improvement.endDate=new Date(n.improvement.endDate.date)),angular.forEach(n.improvement.trackingList,function(e,t){null!=e.startDate&&(e.startDate=new Date(e.startDate.date))})};n.onAddTracking=function(){l(function(){null==n.improvement.trackingList&&(n.improvement.trackingList=[]),n.improvement.trackingList.push({id:0,customerImprovementPlanId:0,responsible:null,startDate:null})})},n.onRemoveTracking=function(e){s.swal({title:"Está seguro?",text:"Desea confirmar la eliminación de este registro ?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(t){t?l(function(){var t=n.improvement.trackingList[e];if(n.improvement.trackingList.splice(e,1),0!=t.id){var a={};a.id=t.id,m({method:"POST",url:"api/customer/improvement-plan-tracking/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){r.error(e),s.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})},n.onAddAlert=function(){l(function(){null==n.improvement.alertList&&(n.improvement.alertList=[]),n.improvement.alertList.push({id:0,customerImprovementPlanId:0,type:null,preference:null,time:0,timeType:null,status:null})})},n.onRemoveAlert=function(e){s.swal({title:"Está seguro?",text:"Desea confirmar la eliminación de este registro ?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(t){t?l(function(){var t=n.improvement.alertList[e];if(n.improvement.alertList.splice(e,1),0!=t.id){var a={};a.id=t.id,m({method:"POST",url:"api/customer/improvement-plan-alert/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){r.error(e),s.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})},n.dtInstanceImprovementPlan={},n.dtOptionsImprovementPlan=p.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerId=n.improvement.customerId,e.entityId=n.improvement.entityId,e.entityName=n.improvement.entityName,JSON.stringify(e)},url:"api/customer-improvement-plan-entity",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){C()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,t,a){h(angular.element(e).contents())(n)}),n.dtColumnsImprovementPlan=[f.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,a,o,i){var r="",l='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+e.id+'" >   <i class="fa fa-edit"></i></a> ',s='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+e.id+'" >   <i class="fa fa-trash-o"></i></a> ';return t.can("cliente_plan_mejoramiento_edit")&&(r+=l),t.can("cliente_plan_mejoramiento_delete")&&(r+=s),n.isView?null:r}),f.newColumn("origin").withTitle("Origen").withOption("width",200).withOption("defaultContent",""),f.newColumn("classification").withTitle("Clasificación").withOption("width",200).withOption("defaultContent",""),f.newColumn("type").withTitle("Tipo").withOption("width",200).withOption("defaultContent",""),f.newColumn("description").withTitle("Hallazgo").withOption("width",200).withOption("defaultContent",""),f.newColumn("responsibleName").withTitle("Responsable").withOption("defaultContent",""),f.newColumn(null).withTitle("Fecha Cierre").withOption("width",200).renderWith(function(e,t,n,a){return"object"==typeof e.endDate&&null!=e.endDate?moment(e.endDate.date).format("DD/MM/YYYY"):null!=e.endDate?moment(e.endDate).format("DD/MM/YYYY"):""}),f.newColumn(null).withTitle("Estado").withOption("width",200).withOption("defaultContent","").renderWith(function(e,t,n,a){var o="label label-success",i=e.status;switch(e.statusCode){case"AB":o="label label-info";break;case"CO":o="label label-success";break;case"CA":o="label label-danger"}return'<span class="'+o+'">'+i+"</span>"})];var C=function(){$("#dtImprovementPlan a.editRow").on("click",function(){var e=$(this).data("id");n.onLoadRecord(e)}),$("#dtImprovementPlan a.delRow").on("click",function(){var e=$(this).data("id");s.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(t){if(t){var a={};a.id=e,m({method:"POST",url:"api/customer/improvement-plan/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){r.error(e),s.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){n.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};n.dtInstanceImprovementPlanCallback=function(e){n.dtInstanceImprovementPlan=e},n.reloadData=function(){n.dtInstanceImprovementPlan.reloadData()}}]);
"use strict";app.controller("customerManagementReportCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert",function(e,a,r,t,n,o,i,l,s,d,u,m,c){var p=r,g={};p.info("loading..customerManagementReportCtrl "),g.operation="management",g.customer_id=a.customerId,g.management_id=e.$parent.currentManagement,e.rate_id=0,e.program_id=0,e.categories=[],e.programs=[],e.question={rate:null,program:null},e.rates=d.rates();var f=function(){var e=randomColor({luminosity:"bright",hue:"orange",format:"rgb"});return p.info(e),e};f(),f(),f(),f(),f(),f();e.data_prg={labels:[],datasets:[]},e.options_prg={responsive:!0,scaleBeginAtZero:!0,scaleShowGridLines:!0,scaleGridLineColor:"rgba(0,0,0,.05)",scaleGridLineWidth:1,barShowStroke:!0,barStrokeWidth:2,barValueSpacing:5,barDatasetSpacing:1,legendTemplate:'<ul class="tc-chart-js-legend"><% for (var i=0; i<datasets.length; i++){%><li><span style="background-color:<%=datasets[i].fillColor%>"></span><%if(datasets[i].label){%><%=datasets[i].label%><%}%></li><%}%></ul>'},e.data_sg=[],e.options_sg={responsive:!0,segmentShowStroke:!0,segmentStrokeColor:"#fff",segmentStrokeWidth:2,percentageInnerCutout:50,animationSteps:100,animationEasing:"easeOutBounce",animateRotate:!0,animateScale:!1,legendTemplate:'<ul class="tc-chart-js-legend"><% for (var i=0; i<segments.length; i++){%><li><span style="background-color:<%=segments[i].fillColor%>"></span><%if(segments[i].label){%><%=segments[i].label%><%}%></li><%}%></ul>'},e.totalAvg=0,e.changeRate=function(a,r,t){p.info(a),p.info(r),u(function(){e.rate_id=a.id,v()})},e.changeProgram=function(a,r,t){p.info(a),p.info(r),u(function(){e.program_id=a.id,v()})},e.clearProgram=function(){u(function(){e.question.program=null,e.program_id=0,v()})},e.clearRate=function(){u(function(){e.question.rate=null,e.rate_id=0,v()})};var h=function(){var t={};t.customer_id=a.customerId,t.management_id=e.$parent.currentManagement,m({method:"POST",url:"api/management/report-monthly-filter",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(a){e.programs=a.data.data.programs})["catch"](function(e){r.error(e),c.swal("Error Cargando Reportes","Se ha presentado un error durante la consulta de los reportes para el diagnóstico por favor intentelo de nuevo","error")})["finally"](function(){})},_=function(){var t={};t.customer_id=a.customerId,t.management_id=e.$parent.currentManagement,m({method:"GET",url:"api/management/report",params:t}).then(function(a){u(function(){e.data_prg=a.data.result.report_programs,e.totalAvg=a.data.result.totalAvg,$.each(e.data_prg.datasets,function(e,a){var r="rgb("+a.fillColor.r+","+a.fillColor.g+","+a.fillColor.b+")";a.fillColor=r,a.highlightFill=r,a.highlightStroke=r}),e.data_sg=a.data.result.report_advances})})["catch"](function(e){r.error(e),c.swal("Error Cargando Reportes","Se ha presentado un error durante la consulta de los reportes para el managemento por favor intentelo de nuevo","error")})["finally"](function(){})};_(),h();var v=function(){p.info("Intentamos cargar la información del programa_id: ");var a={};a.management_id=e.$parent.currentManagement,a.program_id=e.program_id,a.rate_id=e.rate_id,m({method:"GET",url:"api/management/infoReport",params:a}).then(function(a){S(a.data.data.programs),e.loaded=!0})["catch"](function(e){r.error(e),c.swal("Error Consultando Preguntas","Se ha presentado un error durante la consulta del cuestionario, por favor intentelo de nuevo.","error")})["finally"](function(){_()})};v();var S=function(a){return null!=a&&0!=a.length&&void(e.categories=a)};e.editManagement=function(a){null!=e.$parent&&e.$parent.navToSection("edit","edit",e.$parent.currentManagement)},e.cancelEdition=function(a){null!=e.$parent&&e.$parent.navToSection("summary","summary",e.$parent.currentManagement)},e.onSummaryExportPdf=function(){kendo.drawing.drawDOM($(".export-pdf")).then(function(e){return kendo.drawing.exportPDF(e,{paperSize:"auto",margin:{left:"1cm",top:"1cm",right:"1cm",bottom:"1cm"}})}).done(function(e){kendo.saveAs({dataURI:e,fileName:"Reporte Programas Empresariales.pdf",proxyURL:"//demos.telerik.com/kendo-ui/service/export"})})},e.onSummaryExportExcel=function(){jQuery("#downloadDocument")[0].src="api/management/infoReport/export-excel?management_id="+e.$parent.currentManagement+"&program_id="+e.program_id+"&rate_id="+e.rate_id}}]);
"use strict";app.controller("customerManagementReportMonthlyCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert",function(t,a,e,n,o,r,i,l,d,u,s,c,m){var p=e;p.info("loading..customerManagementReportMonthlyCtrl "),t.request={},t.audit={},t.audit.operation="info",t.audit.managementId=t.$parent.currentManagement,t.audit.year=0,t.audit.program=0,t.filter={selectedYear:null,selectedProgram:null},t.years=[],t.programs=[];var h=function(){var t=randomColor({luminosity:"bright",hue:"orange",format:"rgb"});return p.info(t),t};h(),h(),h(),h(),h(),h();t.dataProgram=null,t.dataEvolutionProgram=null,t.dataEvolutionTotal=null,t.dataEvolutionAvg=null,t.optionsLine={legend:{position:"bottom"},responsive:!0,scaleShowGridLines:!0,scaleGridLineColor:"rgba(0,0,0,.05)",scaleGridLineWidth:1,bezierCurve:!0,bezierCurveTension:.4,pointDot:!0,pointDotRadius:4,pointDotStrokeWidth:1,pointHitDetectionRadius:20,datasetStroke:!0,datasetStrokeWidth:2,datasetFill:!0,onAnimationProgress:function(){},onAnimationComplete:function(){},legendTemplate:'<ul class="tc-chart-js-legend"><% for (var i=0; i<datasets.length; i++){%><li><span style="background-color:<%=datasets[i].strokeColor%>"></span><%if(datasets[i].label){%><%=datasets[i].label%><%}%></li><%}%></ul>'},t.optionsBar={legend:{position:"bottom"},responsive:!0,scaleBeginAtZero:!0,scaleShowGridLines:!0,scaleGridLineColor:"rgba(0,0,0,.05)",scaleGridLineWidth:1,barShowStroke:!0,barStrokeWidth:2,barValueSpacing:5,barDatasetSpacing:1,legendTemplate:'<ul class="tc-chart-js-legend"><% for (var i=0; i<datasets.length; i++){%><li><span style="background-color:<%=datasets[i].fillColor%>"></span><%if(datasets[i].label){%><%=datasets[i].label%><%}%></li><%}%></ul>'};var g=function(){var n={};n.customer_id=a.customerId,n.management_id=t.$parent.currentManagement,n.year=t.audit.year,c({method:"POST",url:"api/management/report-monthly-filter",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(a){t.years=a.data.data.years,t.programs=a.data.data.programs,t.years.length>0&&(t.filter.selectedYear=t.years[0],t.audit.year=t.filter.selectedYear.value,t.request.data=Base64.encode(JSON.stringify(t.audit)),t.reloadData(),t.reloadIndicatorData(),w())})["catch"](function(t){e.error(t),m.swal("Error Cargando Reportes","Se ha presentado un error durante la consulta de los reportes para el diagnóstico por favor intentelo de nuevo","error")})["finally"](function(){})},w=function(){var n={};n.customer_id=a.customerId,n.management_id=t.$parent.currentManagement,n.year=t.audit.year,c({method:"GET",url:"api/management/reportMonthly",params:n}).then(function(a){s(function(){t.datasetChartEvolutionAvgLabels=[];for(var e=0;e<a.data.result.line_avg.labels.length;e++)t.datasetChartEvolutionAvgLabels.push(a.data.result.line_avg.labels[e]);t.datasetChartEvolutionAvgLabels=[];for(var e=0;e<a.data.result.line_avg.labels.length;e++)t.datasetChartEvolutionAvgLabels.push(a.data.result.line_avg.labels[e]);t.datasetEvolutionAvgData=[];for(var e=0;e<a.data.result.line_avg.datasets[0].data.length;e++)t.datasetEvolutionAvgData.push(a.data.result.line_avg.datasets[0].data[e]);t.dataEvolutionAvg={labels:t.datasetChartEvolutionAvgLabels,datasets:[{label:"Promedio Total % (calificación)",borderColor:"rgba(218,79,74,1)",backgroundColor:"rgba(218,79,74,1)",data:t.datasetEvolutionAvgData}]},t.datasetEvolutionTotalData=[];for(var e=0;e<a.data.result.line_total.datasets[0].data.length;e++)t.datasetEvolutionTotalData.push(a.data.result.line_total.datasets[0].data[e]);if(t.dataEvolutionTotal={labels:t.datasetChartEvolutionAvgLabels,datasets:[{label:"Avance % (respuestas / preguntas)",borderColor:"rgba(51,149,255,1)",backgroundColor:"rgba(51,149,255,1)",data:t.datasetEvolutionTotalData}]},t.datasetEvolutionProgramsColors=["rgba(255,99,132,0.2)","rgba(54,162,235,0.2)","rgba(255,206,86,0.2)","rgba(139,195,74,0.2)","rgba(255,87,34,0.2)"],t.datasetEvolutionProgramsData=[],a.data.result.line_programs.datasets)for(var e=0;e<a.data.result.line_programs.datasets.length;e++)t.datasetEvolutionProgramsData.push({label:a.data.result.line_programs.datasets[e].label,backgroundColor:t.datasetEvolutionProgramsColors[e],hoverBackgroundColor:t.datasetEvolutionProgramsColors[e],data:a.data.result.line_programs.datasets[e].data});if(t.dataEvolutionProgram={labels:t.datasetChartEvolutionAvgLabels,datasets:t.datasetEvolutionProgramsData},t.datasetEvolutionReportData=[],t.datasetEvolutionReportColors=["#FF6384","#36A2EB","#FFCE56","#8BC34A","#FF5722"],a.data.result.report_programs.datasets)for(var e=0;e<a.data.result.report_programs.datasets.length;e++)t.datasetEvolutionReportData.push({label:a.data.result.report_programs.datasets[e].label,backgroundColor:t.datasetEvolutionReportColors[e],hoverBackgroundColor:t.datasetEvolutionReportColors[e],data:a.data.result.report_programs.datasets[e].data});t.dataProgram={labels:t.datasetChartEvolutionAvgLabels,datasets:t.datasetEvolutionReportData},$.each(t.dataProgram.datasets,function(t,a){var e="rgb("+a.fillColor.r+","+a.fillColor.g+","+a.fillColor.b+")";a.fillColor=e,a.highlightFill=e,a.highlightStroke=e})})})["catch"](function(t){e.error(t),m.swal("Error Cargando Reportes","Se ha presentado un error durante la consulta de los reportes para el diagnóstico por favor intentelo de nuevo","error")})["finally"](function(){})};g(),w(),t.request.data=Base64.encode(JSON.stringify(t.audit)),t.dtInstanceDiagnosticSummaryProgram={},t.dtOptionsDiagnosticSummaryProgram=n.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:t.request,url:"api/management/summary-program",type:"POST",beforeSend:function(){},complete:function(t){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withDOM("tr").withOption("language",{}).withOption("createdRow",function(a,e,n){i(angular.element(a).contents())(t)}),t.dtColumnsDiagnosticSummaryProgram=[o.newColumn("abbreviation").withTitle("Ccde").withOption("width",100),o.newColumn("name").withTitle("Programa").withOption("width",400),o.newColumn("ENE").withTitle("ENE").withOption("width",200),o.newColumn("FEB").withTitle("FEB").withOption("width",200),o.newColumn("MAR").withTitle("MAR").withOption("width",200),o.newColumn("ABR").withTitle("ABR").withOption("width",200),o.newColumn("MAY").withTitle("MAY").withOption("width",200),o.newColumn("JUN").withTitle("JUN").withOption("width",200),o.newColumn("JUL").withTitle("JUL").withOption("width",200),o.newColumn("AGO").withTitle("AGO").withOption("width",200),o.newColumn("SEP").withTitle("SEP").withOption("width",200),o.newColumn("OCT").withTitle("OCT").withOption("width",200),o.newColumn("NOV").withTitle("NOV").withOption("width",200),o.newColumn("DIC").withTitle("DIC").withOption("width",200)],t.dtInstanceDiagnosticSummaryIndicator={},t.dtOptionsDiagnosticSummaryIndicator=n.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:t.request,url:"api/management/summary-indicator",type:"POST",beforeSend:function(){},complete:function(t){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withDOM("tr").withOption("language",{}).withOption("createdRow",function(a,e,n){i(angular.element(a).contents())(t)}),t.dtColumnsDiagnosticSummaryIndicator=[o.newColumn("indicator").withTitle("Indicador").withOption("width",400),o.newColumn(null).withTitle("ENE").withOption("width",200).renderWith(function(t,a,e,n){return"Promedio Total %"!=t.indicator?f(t.ENE):t.ENE}),o.newColumn(null).withTitle("FEB").withOption("width",200).renderWith(function(t,a,e,n){return"Promedio Total %"!=t.indicator?f(t.FEB):t.FEB}),o.newColumn(null).withTitle("MAR").withOption("width",200).renderWith(function(t,a,e,n){return"Promedio Total %"!=t.indicator?f(t.MAR):t.MAR}),o.newColumn(null).withTitle("ABR").withOption("width",200).renderWith(function(t,a,e,n){return"Promedio Total %"!=t.indicator?f(t.ABR):t.ABR}),o.newColumn(null).withTitle("MAY").withOption("width",200).renderWith(function(t,a,e,n){return"Promedio Total %"!=t.indicator?f(t.MAY):t.MAY}),o.newColumn(null).withTitle("JUN").withOption("width",200).renderWith(function(t,a,e,n){return"Promedio Total %"!=t.indicator?f(t.JUN):t.JUN}),o.newColumn(null).withTitle("JUL").withOption("width",200).renderWith(function(t,a,e,n){return"Promedio Total %"!=t.indicator?f(t.JUL):t.JUL}),o.newColumn(null).withTitle("AGO").withOption("width",200).renderWith(function(t,a,e,n){return"Promedio Total %"!=t.indicator?f(t.AGO):t.AGO}),o.newColumn(null).withTitle("SEP").withOption("width",200).renderWith(function(t,a,e,n){return"Promedio Total %"!=t.indicator?f(t.SEP):t.SEP}),o.newColumn(null).withTitle("OCT").withOption("width",200).renderWith(function(t,a,e,n){return"Promedio Total %"!=t.indicator?f(t.OCT):t.OCT}),o.newColumn(null).withTitle("NOV").withOption("width",200).renderWith(function(t,a,e,n){return"Promedio Total %"!=t.indicator?f(t.NOV):t.NOV}),o.newColumn(null).withTitle("DIC").withOption("width",200).renderWith(function(t,a,e,n){return"Promedio Total %"!=t.indicator?f(t.DIC):t.DIC})];var f=function(t){return null!=t?parseInt(t):""};t.reloadData=function(){t.dtInstanceDiagnosticSummaryProgram.reloadData()},t.reloadIndicatorData=function(){t.dtInstanceDiagnosticSummaryIndicator.reloadData()},t.editDiagnosticSummary=function(a){null!=t.$parent&&t.$parent.navToSection("form","edit",a)},t.editDiagnosticReport=function(){null!=t.$parent&&t.$parent.navToSection("edit","edit",t.$parent.currentManagement)},t.editDiagnosticReportMonthly=function(){null!=t.$parent&&t.$parent.navToSection("report_monthly","report_monthly",t.$parent.currentManagement)},t.cancelEdition=function(a){null!=t.$parent&&t.$parent.navToSection("summary","summary",t.$parent.currentManagement)},t.editDiagnostic=function(a){null!=t.$parent&&t.$parent.navToSection("report","report",t.$parent.currentManagement)},t.changeYear=function(a,e){s(function(){t.audit.operation="info",t.audit.managementId=t.$parent.currentManagement,t.audit.year=a.value,t.request.data=Base64.encode(JSON.stringify(t.audit)),t.reloadData(),t.reloadIndicatorData(),w()})},t.clearYear=function(){s(function(){t.audit.operation="info",t.audit.managementId=t.$parent.currentManagement,t.audit.year=0,t.request.data=Base64.encode(JSON.stringify(t.audit)),t.filter.selectedYear=null,t.reloadData(),t.reloadIndicatorData(),w()})},t.$watch("filter.selectedProgram",function(){s(function(){null!=t.filter.selectedProgram&&(t.audit.operation="info",t.audit.managementId=t.$parent.currentManagement,t.audit.program=t.filter.selectedProgram.id,t.request.data=Base64.encode(JSON.stringify(t.audit)),t.reloadIndicatorData())})}),t.clearProgram=function(){s(function(){t.audit.operation="info",t.audit.managementId=t.$parent.currentManagement,t.audit.program=0,t.request.data=Base64.encode(JSON.stringify(t.audit)),t.filter.selectedProgram=null,t.reloadIndicatorData()})},t.onSummaryByProgramExportExcel=function(){jQuery("#downloadDocument")[0].src="api/management/summary-program/export?data="+Base64.encode(JSON.stringify(t.audit))},t.onSummaryByProgramExportPdf=function(){kendo.drawing.drawDOM($(".export-pdf-program")).then(function(t){return kendo.drawing.exportPDF(t,{paperSize:"auto",margin:{left:"1cm",top:"1cm",right:"1cm",bottom:"1cm"}})}).done(function(t){kendo.saveAs({dataURI:t,fileName:"Reporte Mensual Programas Empresariales.pdf",proxyURL:"//demos.telerik.com/kendo-ui/service/export"})})},t.onSummaryByIndicatorExportExcel=function(){jQuery("#downloadDocument")[0].src="api/management/summary-indicator/export?data="+Base64.encode(JSON.stringify(t.audit))},t.onSummaryByIndicatorExportPdf=function(){kendo.drawing.drawDOM($(".export-pdf-indicator")).then(function(t){return kendo.drawing.exportPDF(t,{paperSize:"auto",margin:{left:"1cm",top:"1cm",right:"1cm",bottom:"1cm"}})}).done(function(t){kendo.saveAs({dataURI:t,fileName:"Reporte Mensual Indicadores Programas Empresariales.pdf",proxyURL:"//demos.telerik.com/kendo-ui/service/export"})})}}]);
"use strict";app.controller("customerManagementndicatorsCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$document","$filter","ListService","ChartService",function(e,a,t,n,r,o,i,l,c,p,s,m,d,u,w,f,h){function g(){var t=[{name:"current_year"},{name:"customer_management_indicator_filters",criteria:{customerId:a.customerId}}];f.getDataList(t).then(function(a){e.years=a.data.data.customer_management_indicator_years,e.programList=a.data.data.customer_management_indicator_program_list,e.workplaceOriginalList=a.data.data.customer_management_indicator_workplace_id;var t=a.data.data.currentYear;if(1==e.years.length)e.filter.year=e.years[0];else{var n=w("filter")(e.years,{value:t});e.filter.year=n.length?n[0]:null}e.isLoaded=!0},function(a){e.status="Unable to load customer data: "+a.message})}function O(){var t={customerId:a.customerId,year:e.filter.year?e.filter.year.value:0,programId:e.filter.program?e.filter.program.id:0};e.filter.workplace&&(t.workplaceList=e.filter.compareWorkplaceList.map(function(e){return e&&e.name?e.name.id:0}),t.workplaceList.push(e.filter.workplace.id));var n=[{name:"chart_line_options",criteria:null},{name:"chart_bar_options",criteria:null},{name:"customer_management_indicator",criteria:t}];h.getDataChart(n).then(function(a){e.chart.bar.options=angular.copy(a.data.data.chartLineOptions),e.chart.bar.options.legend.position="bottom",e.chart.bar.options.maintainAspectRatio=!1,e.chart.bar.options.responsive=!1,e.chart.average.data=a.data.data.customerManagementAverageProgram,e.chart.improvementPlan.data=a.data.data.customerManagemenImprovementPlanStatus,e.chart.valoration.data=a.data.data.customerManagemenValoration},function(e){})}e.isLoaded=!1,e.filter={canCompare:!1,year:null,program:null,workplace:null,compareWorkplaceList:[]},e.compareWorkplaceList=[],e.chart={line:{options:null},bar:{options:null},average:{data:null},valoration:{data:null},improvementPlan:{data:null},absenteeismMedicalCause:{data:null},occupationalDiseaseFatalityRate:{data:null},occupationalDiseasePrevalence:{data:null},occupationalDiseaseIncidence:{data:null}},g();var b=function(){e.moduleCompareWokplaceList=e.workplaceList.filter(function(a){return a.id!=e.filter.workplace.id})};e.onAddCompare=function(){e.filter.compareWorkplaceList.push({})},e.onRemoveCompare=function(a){e.filter.compareWorkplaceList.splice(a,1),e.reloadData(),e.reloadResponsibleData(),O()},e.onRemoveWorkplace=function(){e.filter.workplace=null,e.filter.compareWorkplaceList=[],e.filter.year&&e.filter.program&&(e.reloadData(),e.reloadResponsibleData(),O())},e.onSelectYear=function(){e.filter.program&&(e.reloadData(),e.reloadResponsibleData(),O())},e.onSelectProgram=function(){e.workplaceList=e.workplaceOriginalList.filter(function(a){return a.programId==(e.filter.program?e.filter.program.id:0)}),e.onRemoveWorkplace()},e.onSelectWorkplace=function(){b(),e.compareWorkplaceList=[],e.filter.year&&e.filter.program&&(e.reloadData(),e.reloadResponsibleData(),O())},e.onSelectCompareWorkplace=function(a){e.reloadData(),e.reloadResponsibleData(),O()},e.dtOptionsManagementIndicatorSummary=n.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.customerId=a.customerId,t.programId=e.filter.program?e.filter.program.id:0,t.year=e.filter.year?e.filter.year.value:0,e.filter.workplace&&(t.workplaceId=e.filter.compareWorkplaceList.map(function(e){return e&&e.name?e.name.id:0}),t.workplaceId.push(e.filter.workplace.id)),JSON.stringify(t)},url:"api/customer-management-summary-indicator",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(e){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withDOM("tr").withOption("paging",!1).withOption("createdRow",function(a,t,n){i(angular.element(a).contents())(e)}),e.dtColumnsManagementIndicatorSummary=[r.newColumn("name").withTitle("Programa").withOption("width",400),r.newColumn("abbreviation").withTitle("Código").withOption("width",200),r.newColumn("workplace").withTitle("Centro de Trabajo").withOption("width",200),r.newColumn("questions").withTitle("Preguntas").withOption("width",200),r.newColumn("answers").withTitle("Respuestas").withOption("width",200),r.newColumn("advance").withTitle("Avance (%)").withOption("width",200),r.newColumn("average").withTitle("Promedio Total (%)").withOption("width",200),r.newColumn(null).withTitle("Estado").withOption("width",200).renderWith(function(e,a,t,n){var r="label label-danger",o="Sin Iniciar";parseInt(e.answers)==parseInt(e.questions)?(o="Completado",r="label label-info"):parseInt(e.answers)>0&&(o="Iniciado",r="label label-success");var i='<span class="'+r+'">'+o+"</span>";return i}).notSortable()],e.dtInstanceManagementIndicatorSummaryCallback=function(a){e.dtInstanceManagementIndicatorSummary=a},e.reloadData=function(){e.dtInstanceManagementIndicatorSummary.reloadData()},e.dtOptionsManagementResponsibleSummary=n.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.customerId=a.customerId,t.year=e.filter.year?e.filter.year.value:0,e.filter.workplace&&(t.workplaceId=e.filter.compareWorkplaceList.map(function(e){return e&&e.name?e.name.id:0}),t.workplaceId.push(e.filter.workplace.id)),JSON.stringify(t)},url:"api/customer-management-summary-responsible",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(e){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withPaginationType("full_numbers").withOption("createdRow",function(a,t,n){i(angular.element(a).contents())(e)}),e.dtColumnsManagementResponsibleSummary=[r.newColumn("workplace").withTitle("Centro de Trabajo"),r.newColumn("responsible").withTitle("Nombre del Responsable").withOption("width",400),r.newColumn("qty").withTitle("Cant. Planes Mejoramiento").withOption("width",200)],e.dtInstanceManagementResponsibleSummaryCallback=function(a){e.dtInstanceManagementResponsibleSummary=a},e.reloadResponsibleData=function(){e.dtInstanceManagementResponsibleSummary.reloadData()},e.onExportPdf=function(e){var a=null,t="Gráfica.pdf";switch(e){case"AV":a=".export-pdf-average",t="PROMEDIO_TOTAL_PROGRAMA_EMPRESARIAL.pdf";break;case"VA":a=".export-pdf-valoration",t="VALORACION_PROGRAMA_EMPRESARIAL.pdf";break;case"IP":a=".export-pdf-improvement-plan",t="PLANES_MEJORAMIENTO.pdf"}kendo.drawing.drawDOM($(a)).then(function(e){return kendo.drawing.exportPDF(e,{paperSize:"auto",margin:{left:"1cm",top:"1cm",right:"1cm",bottom:"1cm"}})}).done(function(e){kendo.saveAs({dataURI:e,fileName:t})})}}]);
"use strict";app.controller("customerManagementAttachmentCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","SweetAlert","$rootScope","$http","$timeout","$uibModal","flowFactory","cfpLoadingBar","$filter","$document","FileUploader","$localStorage","$aside","ListService","$ngConfirm",function(e,t,n,a,o,i,r,l,c,u,s,d,m,p,f,h,w,g,v,b,C,D,y){function T(){var n=[{name:"customer_document_type",value:t.customerId},{name:"customer_management_program",value:e.currentId}];D.getDataList(n).then(function(t){e.documentType=t.data.data.customerDocumentType,e.chapters=t.data.data.customerManagementProgram,S()},function(t){e.status="Unable to load customer data: "+t.message})}e.isVisible="view"!=e.$parent.editMode;var O=null,x=0;e.currentId=e.$parent.currentManagement,e.currentProgram=e.$parent.currentProgram,e.documentClassification=s.parameters("customer_document_classification"),e.documentStatus=s.parameters("customer_document_status"),e.$storage=b.$default({hideManagementAttachmentCanceled:!0}),T(),e.onCancel=function(){null!=e.$parent&&e.$parent.navToSection("summary","summary",e.currentId)},e.onClear=function(){A()};var A=function(){e.attachment={id:0,customerManagementItemId:0,type:null,classification:null,description:"",status:e.documentStatus?e.documentStatus[0]:null,version:1},O&&O.$setPristine(!0)},S=function(){if(e.chapters&&e.chapters.length>0){var t=e.chapters[0];e.parent={economicSector:{name:t.economicSector},customerWorkplace:{name:t.workplace},program:{name:t.name,abbreviation:t.abbreviation}}}};A();var P=function(t){var n={id:t};d({method:"GET",url:"api/customer-management-detail-document/get",params:n})["catch"](function(e,t){}).then(function(t){m(function(){e.attachment=t.data.result,e.attachment.version=parseInt(e.attachment.version)+1})})["finally"](function(){})},_=e.uploader=new v({url:"api/customer-management-detail-document/upload",formData:[],removeAfterUpload:!0});_.filters.push({name:"customFilter",fn:function(e,t){return this.queue.length<10}}),_.onBeforeUploadItem=function(e){var t={id:x};e.formData.push(t)},_.onCompleteAll=function(){e.reloadData(),e.onClear()},e.form={submit:function(e){O=e;var t=null;if(e.$invalid){var n=null,t=null;for(n in e)"$"!=n[0]&&(null!==t||e[n].$valid||(t=e[n].$name),e[n].$pristine&&(e[n].$dirty=!0));return angular.element(".ng-invalid[name="+t+"]").focus(),void u.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}u.swal("Validación exitosa","Procediendo con el guardado...","success"),M()},reset:function(e){e.$setPristine(!0)}};var M=function(){var t={},n=JSON.stringify(e.attachment);return t.data=Base64.encode(n),d({method:"POST",url:"api/customer-management-detail-document/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){m(function(){_.queue.length>0?(x=t.data.result.id,_.uploadAll()):(e.reloadData(),e.onClear())})})["catch"](function(e){u.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){e.reloadData()})};e.dtOptionsManagementDocument=a.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.managementId=e.currentId,e.$storage.hideManagementAttachmentCanceled&&(t.statusCode="2"),JSON.stringify(t)},url:"api/customer-management-detail-document",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){I()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,n,a){r(angular.element(t).contents())(e)}),e.dtColumnsManagementDocument=[o.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,n,a,o){var i=t.documentUrl?t.documentUrl:"",r="api/customer-management-detail-document/download?id="+t.id,l="",c='<a target="_self" class="btn btn-primary btn-xs downloadDocumentRow lnk" href="'+r+'" uib-tooltip="Descargar anexo" data-id="'+t.id+'" >   <i class="fa fa-download"></i></a> ',u='<a class="btn btn-info btn-xs openDocumentRow lnk" target="_blank" href="'+i+'" uib-tooltip="Abrir anexo" data-id="'+t.id+'" >   <i class="fa fa-folder-open-o"></i></a> ',d='<a class="btn btn-danger btn-xs delDocumentRow lnk" href="#" uib-tooltip="Anular anexo" data-id="'+t.id+'" >   <i class="fa fa-ban"></i></a> ',m=!1;return null==t.protectionType?m=!0:"public"==t.protectionType?m=!0:"private"==t.protectionType&&1==t.hasPermission&&(m=!0),s.can("clientes_anexo_open")&&""!=i&&(l+=u),s.can("clientes_anexo_download")&&""!=i&&(l+=c),s.can("clientes_anexo_invalidate")&&e.isVisible&&"2"!=t.statusCode&&(l+=d),m?l:""}),o.newColumn("documentType").withTitle("Tipo de documento").withOption("width",200),o.newColumn("classification").withTitle("Clasificación").withOption("width",200),o.newColumn("description").withTitle("Descripción").withOption("width",200),o.newColumn("version").withTitle("Versión").withOption("width",200),o.newColumn("createdAt").withTitle("Fecha Creación").withOption("width",200).withOption("defaultContent",""),o.newColumn("status").withTitle("Estado").withOption("width",200).renderWith(function(e,t,n,a){var o="";switch(e){case"Vigente":o="label label-success";break;case"Anulado":o="label label-danger"}var i='<span class="'+o+'">'+e+"</span>";return i})];var I=function(){$("#dtManagementDocument a.editRow").on("click",function(){var e=$(this).data("id"),t=$(this).data("url");""==t?u.swal("Error en la descarga","No existe un anexo para descargar","error"):jQuery("#downloadDocument")[0].src="api/customer-management-detail-document/download?id="+e}),angular.element("#dtManagementDocument a.delDocumentRow").on("click",function(){var t=angular.element(this).data("id");y({boxWidth:"35%",useBootstrap:!1,animation:"bottom",closeAnimation:"scale",title:"Está seguro?",content:"<strong>Anulará</strong> el anexo seleccionado",scope:e,type:"red",typeAnimated:!0,buttons:{cancel:{text:"Anular y cambiar versión",btnClass:"btn-primary",action:function(n,a){e.attachment.id=t,e.isView=!1,P(t),l.pop("info","Anulación Anexo","El anexo se cargó satisfactoriamente, seleccione una nueva versión del documento")}},fullCancel:{text:"Anular definitivamente",btnClass:"btn-red",action:function(a,o){var i={};i.id=t,d({method:"POST",url:"api/customer-management-detail-document/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(t){swal("Eliminado","Anexo anulado satisfactoriamente","info"),e.reloadData()})["catch"](function(e){n.error(e),u.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}},closeAll:{text:"Cancelar",btnClass:"btn-default",action:function(e,t){}}}})})};e.dtInstanceManagementDocumentCallback=function(t){e.dtInstanceManagementDocument=t},e.reloadData=function(){e.dtInstanceManagementDocument.reloadData()},e.onShowCancelledChange=function(){e.reloadData()}}]);
"use strict";app.controller("customerManagementImportCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","SweetAlert","$rootScope","$http","$timeout","$uibModal","flowFactory","cfpLoadingBar","$filter","$document","FileUploader","$localStorage","$aside","ListService",function(t,e,n,a,o,i,r,c,l,s,u,d,m,p,f,h,g,w,b,v,C,y){function D(){var n={customerId:e.customerId,customerManagementId:t.currentId},a=[{name:"customer_management_category",value:null,criteria:n},{name:"customer_management_program",value:t.currentId}];y.getDataList(a).then(function(e){t.categoryList=e.data.data.customerManagementCategoryList,t.questionListAll=e.data.data.customerManagementQuestionList,t.chapters=e.data.data.customerManagementProgram,O()},function(e){t.status="Unable to load customer data: "+e.message})}console.log("editMode Import",t.$parent.editMode);var I=null;t.isCreate=0==t.$parent.currentId,t.currentId=t.$parent.currentManagement,t.currentProgram=t.$parent.currentProgram,t.categoryList=[],t.questionList=[],t.questionListAll=[],D();var O=function(){if(t.entity={id:t.currentId,economicSector:null,customerWorkplace:null,program:null,customerManagementProgramCategory:null,customerManagementDetail:null,documentList:[]},null!=I&&I.$setPristine(!0),t.chapters&&t.chapters.length>0){var e=t.chapters[0];t.entity.economicSector={name:e.economicSector},t.entity.customerWorkplace={name:e.workplace},t.entity.program={name:e.name,abbreviation:e.abbreviation}}};O(),t.onSelectCategory=function(){t.reloadData(),t.entity.customerManagementDetail=null,t.entity.documentList=[],M()},t.onSelectQuestion=function(){t.reloadData(),t.entity.documentList=[]},t.onSearchQuestion=function(){var e=C.open({templateUrl:u.app.views.urlRoot+"modules/common/modals/data_table_list_modal.htm",controller:"ModalInstanceSideManagementImportCtrl",placement:"right",size:"lg",backdrop:!0,scope:t,resolve:{data:function(){return t.questionList}}});e.result.then(function(e){t.entity.customerManagementDetail=e,t.onSelectQuestion()},function(){})};var M=function(){null!=t.entity.customerManagementProgramCategory&&(t.questionList=t.questionListAll.filter(function(e){return e.categoryId==t.entity.customerManagementProgramCategory.id}))};t.form={submit:function(t){I=t;var e=null;if(t.$invalid){var n=null,e=null;for(n in t)"$"!=n[0]&&(null!==e||t[n].$valid||(e=t[n].$name),t[n].$pristine&&(t[n].$dirty=!0));return angular.element(".ng-invalid[name="+e+"]").focus(),void s.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}T()},reset:function(t){t.$setPristine(!0)}};var T=function(){if(null==t.entity.documentList||void 0===t.entity.documentList||0==t.entity.documentList.length)return void s.swal("Información requerida!","Debes seleccionar al menos 1 anexo para importar.","warning");var e={},n=JSON.stringify(t.entity);return e.data=Base64.encode(n),d({method:"POST",url:"api/customer-management-detail-document/import",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){s.swal("Registro","La información ha sido importada satisfactoriamente","success"),m(function(){O(),t.reloadData()})})["catch"](function(t){s.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};t.onCancel=function(){null!=t.$parent&&t.$parent.navToSection("summary","summary",t.currentId)},t.onContinue=function(){null!=t.$parent&&t.$parent.navToSection("edit","edit",t.currentId,t.currentProgram)},t.dtOptionsManagementItemDocument=a.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(n){return n.managementDetailId=t.entity.customerManagementDetail?t.entity.customerManagementDetail.id:0,n.program=t.entity.program?t.entity.program.abbreviation:-1,n.customerId=t.entity.customerManagementDetail?e.customerId:-1,n.statusCode="2",JSON.stringify(n)},url:"api/customer-management-detail-document-available",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){S()}).withOption("bFilter",!1).withOption("paging",!1).withOption("createdRow",function(e,n,a){r(angular.element(e).contents())(t)}),t.dtColumnsManagementItemDocument=[o.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,e,n,a){var o=t.documentUrl?t.documentUrl:"",i="",r='<a target="_self" class="btn btn-primary btn-xs downloadDocumentRow lnk" uib-tooltip="Descargar anexo" data-id="'+t.id+'" >   <i class="fa fa-download"></i></a> ',c=!0;return""!=o&&(i+=r),c?i:""}),o.newColumn("documentType").withTitle("Tipo de documento").withOption("width",200),o.newColumn("classification").withTitle("Clasificación").withOption("width",200),o.newColumn("description").withTitle("Descripción").withOption("width",200),o.newColumn("version").withTitle("Versión").withOption("width",200),o.newColumn("dateOfCreation").withTitle("Fecha Creación").withOption("width",200).withOption("defaultContent",""),o.newColumn("status").withTitle("Estado").withOption("width",200).renderWith(function(t,e,n,a){var o="";switch(t){case"Vigente":o="label label-success";break;case"Anulado":o="label label-danger"}var i='<span class="'+o+'">'+t+"</span>";return i}),o.newColumn(null).withTitle("Acciones").notSortable().renderWith(function(t,e,n,a){var o="",i="",r='<div class="checkbox clip-check check-success "><input class="checkRow" type="checkbox" id="chk_'+t.id+'" data-id="'+t.id+'" data-value="'+t.selected+'" '+i+' ><label for="chk_'+t.id+'"> Seleccionar </label></div>';return o+=r}).notSortable()];var S=function(){$("#dtManagementItemDocument a.downloadDocumentRow").on("click",function(){var t=$(this).data("id");angular.element("#download")[0].src="api/customer-document/download?id="+t}),$("input[type=checkbox]").on("change",function(){var e=$(this).data("id"),n=($(this).data("value"),$(this).is(":checked"));n?t.entity.documentList.push({id:e}):t.entity.documentList=g("filter")(t.entity.documentList,{id:"!"+e})})};t.dtInstanceManagementItemDocumentCallback=function(e){t.dtInstanceManagementItemDocument=e},t.reloadData=function(){t.dtInstanceManagementItemDocument.reloadData()}}]),app.controller("ModalInstanceSideManagementImportCtrl",["$rootScope","$stateParams","$scope","$uibModalInstance","data","$http","toaster","DTOptionsBuilder","DTColumnBuilder","$compile","$q",function(t,e,n,a,o,i,r,c,l,s,u){n.title="Preguntas",n.record={},n.onCloseModal=function(t){a.close(t)},n.onCancel=function(){a.dismiss("cancel")},n.dtOptionsCommonDataTableList=c.fromFnPromise(function(){var t=u.defer();return t.resolve(o),t.promise}).withBootstrap().withPaginationType("full_numbers").withOption("createdRow",function(t,e,a){s(angular.element(t).contents())(n)}),n.dtColumnsCommonDataTableList=[l.newColumn(null).withOption("width",200).withTitle("Acciones").notSortable().renderWith(function(t,e,a,o){n.record[t.id]=t;var i="",r='<a class="btn btn-success btn-xs" href="#" uib-tooltip="Seleccionar" ng-click="select(record['+t.id+'])">   <i class="fa fa-plus-square"></i></a> ';return i+=r}).notSortable(),l.newColumn("article").withOption("width",200).withTitle("Artículo").withOption("defaultContent",""),l.newColumn("description").withTitle("Descripción").withOption("defaultContent","")],n.dtInstanceCommonDataTableListCallback=function(t){n.dtInstanceCommonDataTableList=t},n.reloadData=function(){n.dtInstanceCommonDataTableList.reloadData()},n.select=function(t){n.onCloseModal(t)}}]);
"use strict";app.controller("customerOccupationalTabsCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","SweetAlert","$rootScope","$http","$timeout","$uibModal","flowFactory","cfpLoadingBar","$document","$filter","$aside","FileUploader",function(o,t,a,e,i,c,u,l,r,n,s,m,p,_,d,v,b,h,w,$){o.views=[{name:"absenteeism",url:s.app.views.urlRoot+"modules/customer/occupational/absenteeism/customer_absenteeism_tabs.htm"},{name:"health_damage",url:s.app.views.urlRoot+"modules/customer/occupational/health-damage/customer_health_damage_tabs.htm"},{name:"occupational_report_al",url:s.app.views.urlRoot+"modules/customer/occupational/report/customer_occupational_report_al.htm"},{name:"occupational_investigation_al",url:s.app.views.urlRoot+"modules/customer/occupational/investigation/customer_occupational_investigation_al.htm"},{name:"occupational_report_incident",url:s.app.views.urlRoot+"modules/customer/occupational/report-incident/customer_occupational_report_incident.htm"},{name:"occupational_covid_19",url:s.app.views.urlRoot+"modules/customer/occupational/covid-19/customer_covid_tabs.htm"},{name:"occupational_covid_19_bolivar",url:s.app.views.urlRoot+"modules/customer/occupational/covid-19-bolivar/customer_covid_bolivar_tabs.htm"}],o.loading=!1,o.tabname="basic",o.getView=function(t){var a=h("filter")(o.views,{name:t});return a[0]},o.switchTab=function(t){p(function(){o.tabname=t})},o.switchSubTab=function(t){p(function(){o.subtab=t})}}]);
"use strict";app.controller("customerAbsenteeismTabsCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","SweetAlert","$rootScope","$http","$timeout","$uibModal","flowFactory","cfpLoadingBar","$document","$filter","$aside","FileUploader",function(e,t,i,s,a,o,n,l,u,r,m,c,b,p,d,$,f,w,_,h){e.views=[{name:"basic",url:m.app.views.urlRoot+"modules/customer/occupational/absenteeism/disability/customer_absenteeism_disability.htm"},{name:"indicator",url:m.app.views.urlRoot+"modules/customer/occupational/absenteeism/indicators/customer_absenteeism_indicators.htm"},{name:"analysis",url:m.app.views.urlRoot+"modules/customer/occupational/absenteeism/analysis/customer_absenteeism_analysis_tabs.htm"},{name:"administrator",url:m.app.views.urlRoot+"modules/customer/occupational/absenteeism/billing/customer_absenteeism_disability_billing.htm"}],e.loading=!1,e.tabname="basic",e.getView=function(t){var i=w("filter")(e.views,{name:t});return i[0]},e.switchTab=function(t){b(function(){e.tabname=t})},e.switchSubTab=function(t){b(function(){e.subtab=t})}}]);
"use strict";app.controller("customerAbsenteeismDisabilityCtrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout",function(t,e,i,o,c,n){var r=i;r.info("loading..customerEmployeeCtrl!!! "),t.disability_section="list",t.currentId=0,t.editMode="create",t.navToSection=function(e,i,o){n(function(){t.disability_section=e,t.editMode=i,t.$parent.switchSubTab(i),t.currentId=o})}}]);
"use strict";app.controller("customerAbsenteeismDisabilityAnalysisCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$document","$filter","$aside","ListService","ChartService",function(e,t,a,n,i,l,o,r,s,u,c,d,f,m,p,w,C,h){function y(){var a=e.filter.compareYearList.filter(function(t){return null!=t&&null!=t.value&&e.filter.canCompare}).map(function(e,t,a){return e.value.value});void 0!==a&&null!==a||(a=[]),a.push(e.filter.selectedYear?e.filter.selectedYear.value:0);var n={customerId:t.customerId,cause:e.filter.selectedCause,workplaceId:e.filter.workplace?e.filter.workplace.id:null,yearList:a},i=[{name:"chart_line_options",criteria:null},{name:"customer_absenteeism_disability_general_event",criteria:n}];h.getDataChart(i).then(function(t){e.chart.line.options=t.data.data.chartLineOptions,e.chart.months.data=t.data.data.customerAbsenteeismDisabilityGeneralEvent},function(e){})}function b(){var a=[{name:"absenteeism_disability_causes_only"},{name:"current_year"},{name:"absenteeism_disability_years",value:t.customerId}];C.getDataList(a).then(function(t){e.causes=t.data.data.absenteeism_disability_causes_only,e.years=t.data.data.absenteeism_disability_causes_years;var a=t.data.data.currentYear,n=p("filter")(e.years,{value:a});e.filter.selectedYear=n.length?n[0]:null,O(),y()},function(t){e.status="Unable to load customer data: "+t.message})}function v(){var a=[{name:"absenteeism_disability_customer_workplace",criteria:{customerId:t.customerId,cause:e.filter.selectedCause.value,years:D()}}];C.getDataList(a).then(function(t){e.workplaceList=t.data.data.workplaceList},function(t){e.status="Unable to load customer data: "+t.message})}e.filter={canCompare:!1,selectedCause:null,selectedYear:null,compareYearList:[],workplace:null},e.compareYearList=[],e.workplaceList=[],e.years=[],e.chart={line:{options:null},months:{data:null}},b(),e.dtOptionsCustomerDisabilityAnalysis=n.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(a){return a.customerId=t.customerId,a.cause=e.filter.selectedCause?e.filter.selectedCause.value:"",a.workplaceId=e.filter.workplace?e.filter.workplace.id:"",JSON.stringify(a)},url:"api/customer-absenteeism-disability-general",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,a,n){o(angular.element(t).contents())(e)}),e.dtColumnsCustomerDisabilityAnalysis=[i.newColumn("year").withTitle("Año").withOption("defaultContent",""),i.newColumn("jan").withTitle("ENE").withOption("defaultContent",""),i.newColumn("feb").withTitle("FEB").withOption("defaultContent",""),i.newColumn("mar").withTitle("MAR").withOption("defaultContent",""),i.newColumn("apr").withTitle("ABR").withOption("defaultContent",""),i.newColumn("may").withTitle("MAY").withOption("defaultContent",""),i.newColumn("jun").withTitle("JUN").withOption("defaultContent",""),i.newColumn("jul").withTitle("JUL").withOption("defaultContent",""),i.newColumn("aug").withTitle("AGO").withOption("defaultContent",""),i.newColumn("sep").withTitle("SEP").withOption("defaultContent",""),i.newColumn("oct").withTitle("OCT").withOption("defaultContent",""),i.newColumn("nov").withTitle("NOV").withOption("defaultContent",""),i.newColumn("dec").withTitle("DIC").withOption("defaultContent","")],e.dtInstanceCustomerDisabilityAnalysisCauseCallback=function(t){e.dtInstanceCustomerDisabilityAnalysisCause=t},e.reloadData=function(t){e.dtInstanceCustomerDisabilityAnalysisCause.reloadData()},e.onSelectCause=function(){c(function(){v(),y(),e.reloadData()})},e.onClearCause=function(){c(function(){e.filter.selectedCause=null,y(),e.reloadData()})},e.onClearWorkplace=function(){c(function(){e.filter.workplace=null,y(),e.reloadData()})},e.onSelectYear=function(){O(),v(),y(),e.reloadData()},e.onChangeCompare=function(){v(),y()},e.onAddCompareYear=function(){e.filter.compareYearList.push({})},e.onRemoveCompareYear=function(t){e.filter.compareYearList.splice(t,1),v(),y()},e.onExportPdf=function(){kendo.drawing.drawDOM($(".export-pdf-disability-general")).then(function(e){return kendo.drawing.exportPDF(e,{paperSize:"auto",margin:{left:"1cm",top:"1cm",right:"1cm",bottom:"1cm"}})}).done(function(e){kendo.saveAs({dataURI:e,fileName:"AUSENTISMO_GENERAL.pdf"})})},e.onExportExcel=function(){var a=e.filter.selectedCause?e.filter.selectedCause.value:"";angular.element("#download")[0].src="api/customer-absenteeism-disability/export-general?customerId="+t.customerId+"&cause="+a};var O=function(){e.compareYearList=e.years.filter(function(t){return t.value!=(e.filter.selectedYear?e.filter.selectedYear.value:0)})},D=function(){var t=e.filter.compareYearList.filter(function(t){return null!=t&&null!=t.value&&e.filter.canCompare}).map(function(e,t,a){return e.value.value});return void 0!==t&&null!==t||(t=[]),t.push(e.filter.selectedYear?e.filter.selectedYear.value:0),t}}]);
"use strict";app.controller("customerAbsenteeismDisabilityListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$document","$filter","$aside","ListService",function(e,t,n,i,a,o,r,l,s,c,d,u,p,m,f,h,w){function b(){var n=[{name:"criteria_operators",value:null},{name:"criteria_conditions",value:null},{name:"month_options",value:null},{name:"current_month",value:null},{name:"customer_absenteeism_disability_filter_field",value:null},{name:"customer_absenteeism_disability_filter_years",value:t.customerId}];w.getDataList(n).then(function(t){e.criteria=t.data.data.criteriaOperatorList,e.conditions=t.data.data.criteriaConditionList,e.audit.fields=t.data.data.customerAbsenteeismDisabilityFilterField,e.yearList=t.data.data.customerAbsenteeismDisabilityFilterYears,e.monthList=t.data.data.monthOptions,e.currentMonth=t.data.data.currentMonth,e.yearList.length>0&&(e.filter.selectedYear=e.yearList[0]),e.filter.selectedMonth=e.monthList.find(function(t){return t.value==e.currentMonth}),e.reloadData()},function(t){e.status="Unable to load customer data: "+t.message})}e.audit={fields:[],filters:[]},e.filter={selectedYear:null,selectedMonth:null},b(),e.addFilter=function(){null==e.audit.filters&&(e.audit.filters=[]),e.audit.filters.push({id:0,field:null,criteria:e.criteria.length>0?e.criteria[1]:null,condition:e.conditions.length>0?e.conditions[0]:null,value:""})},e.onFilter=function(){e.reloadData()},e.removeFilter=function(t){e.audit.filters.splice(t,1)},e.onCleanFilter=function(){e.audit.filters=[],e.reloadData()},e.clearMonth=function(){e.filter.selectedMonth=null,e.reloadData()},e.dtInstanceDiagnosticDisabilityDT={},e.dtOptionsDiagnosticDisabilityDT=i.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(n){return n.operation="absenteeism",n.customerId=t.customerId,n.year=e.filter.selectedYear?e.filter.selectedYear.value:1,n.month=e.filter.selectedMonth?e.filter.selectedMonth.value:null,angular.isDefined(e.audit)&&angular.isDefined(e.audit.filters)&&(n.filter={filters:e.audit.filters.filter(function(e){return null!=e&&null!=e.field&&null!=e.criteria}).map(function(e,t,n){return{field:e.field.name,operator:e.criteria.value,value:e.value,condition:e.condition.value}})}),JSON.stringify(n)},url:"api/customer-absenteeism-disability",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){g()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,n,i){r(angular.element(t).contents())(e)}),e.dtColumnsDiagnosticDisabilityDT=[a.newColumn(null).withTitle("Acciones").withOption("width",220).notSortable().renderWith(function(e,t,n,i){var a="",o="",r='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar"  data-id="'+e.id+'"'+o+' >   <i class="fa fa-edit"></i></a> ',l='<a class="btn btn-info btn-xs viewRow lnk" href="#"  uib-tooltip="Ver" data-id="'+e.id+'" >   <i class="fa fa-eye"></i></a> ',s='<a class="btn btn-danger btn-xs delRow lnk" href="#"  uib-tooltip="Eliminar" data-id="'+e.id+'"'+o+' >   <i class="fa fa-trash-o"></i></a> ',d='<a class="btn btn-success btn-xs uploadRow lnk" href="#"  uib-tooltip="Adicionar anexo" data-id="'+e.id+'"'+o+' >   <i class="fa fa-paperclip"></i></a> ',u='<a class="btn btn-purple btn-xs reportRow lnk" href="#"  uib-tooltip="Adicionar reporte AT" data-id="'+e.id+'"'+o+' >   <i class="fa fa-ambulance"></i></a> ',p='<a class="btn btn-dark-orange btn-xs actionPlanRowDisability lnk" href="#" tooltip-placement="right" uib-tooltip="Plan de mejoramiento"  data-id="'+e.id+'" >   <i class="fa fa-plus-square"></i></a> ';return c.can("clientes_view")&&(a+=l),c.can("clientes_edit")&&(a+=r),c.can("clientes_edit")&&(a+=s),c.can("clientes_edit")&&(a+=d),null==e.category||"Incapacidad"!=e.category||null==e.causeValue||"AT"!=e.causeValue&&"AL"!=e.causeValue||(a+=p,a+=u),a}),a.newColumn("documentNumber").withTitle("Nro Identificación").withOption("width",200).withOption("defaultContent",""),a.newColumn("firstName").withTitle("Nombres").withOption("width",200).withOption("defaultContent",""),a.newColumn("lastName").withTitle("Apellidos").withOption("width",200).withOption("defaultContent",""),a.newColumn("contractType").withTitle("Tipo Contrato").withOption("width",200).withOption("defaultContent",""),a.newColumn("workplace").withTitle("Centro de Trabajo").withOption("width",200).withOption("defaultContent",""),a.newColumn("category").withTitle("Tipo Ausentismo").withOption("width",200).withOption("defaultContent",""),a.newColumn("typeText").withTitle("Tipo Incapacidad").withOption("width",200).withOption("defaultContent",""),a.newColumn("causeItem").withTitle("Causa Incapacidad").withOption("width",200).withOption("defaultContent",""),a.newColumn("startDateFormat").withTitle("F Inicial").withOption("width",180).withOption("defaultContent",""),a.newColumn("endDateFormat").withTitle("F Final").withOption("width",180).withOption("defaultContent",""),a.newColumn(null).withTitle("Reporte EPS").notSortable().renderWith(function(e,t,n,i){var a="";if(null==e.category||"Incapacidad"!=e.category||null==e.causeValue||"AT"!=e.causeValue&&"AL"!=e.causeValue)a="NA";else{var o=1==e.hasReportEps||"1"==e.hasReportEps?"checked":"",r=1==e.hasReportEps||"1"==e.hasReportEps?"Si":"No",l='<div class="checkbox clip-check check-success "><input class="editRow" ng-disabled="true" type="checkbox" id="chk_'+e.id+'" data-id="'+e.id+'" '+o+' ><label for="chk_'+e.id+'">'+r+"</label></div>";a+=l}return a}).notSortable(),a.newColumn(null).withTitle("Reporte ARL").notSortable().renderWith(function(e,t,n,i){var a="";if(null==e.category||"Incapacidad"!=e.category||null==e.causeValue||"AT"!=e.causeValue&&"AL"!=e.causeValue)a="NA";else{var o=1==e.hasReport||"1"==e.hasReport?"checked":"",r=1==e.hasReport||"1"==e.hasReport?"Si":"No",l='<div class="checkbox clip-check check-success "><input class="editRow" ng-disabled="true" type="checkbox" id="chk_'+e.id+'" data-id="'+e.id+'" '+o+' ><label for="chk_'+e.id+'">'+r+"</label></div>";a+=l}return a}).notSortable(),a.newColumn(null).withTitle("Reporte Ministerio").notSortable().renderWith(function(e,t,n,i){var a="";if(null==e.category||"Incapacidad"!=e.category||null==e.causeValue||"AT"!=e.causeValue&&"AL"!=e.causeValue)a="NA";else{var o=1==e.hasReportMin||"1"==e.hasReportMin?"checked":"",r=1==e.hasReportMin||"1"==e.hasReportMin?"Si":"No",l='<div class="checkbox clip-check check-success "><input class="editRow" ng-disabled="true" type="checkbox" id="chk_'+e.id+'" data-id="'+e.id+'" '+o+' ><label for="chk_'+e.id+'">'+r+"</label></div>";a+=l}return a}).notSortable(),a.newColumn(null).withTitle("Incapacidad").notSortable().renderWith(function(e,t,n,i){var a="";if(null!=e.category&&"Incapacidad"==e.category){var o=1==e.hasInhability||"1"==e.hasInhability?"checked":"",r=1==e.hasInhability||"1"==e.hasInhability?"Si":"No",l='<div class="checkbox clip-check check-success "><input class="editRow" ng-disabled="true" type="checkbox" id="chk_'+e.id+'" data-id="'+e.id+'" '+o+' ><label for="chk_'+e.id+'">'+r+"</label></div>";a+=l}else a="NA";return a}).notSortable(),a.newColumn(null).withTitle("Investigación AT").notSortable().renderWith(function(e,t,n,i){var a="";if(null==e.category||"Incapacidad"!=e.category||null==e.causeValue||"AT"!=e.causeValue&&"AL"!=e.causeValue)a="NA";else{var o=1==e.hasInvestigation||"1"==e.hasInvestigation?"checked":"",r=e.hasInvestigation||"1"==e.hasInvestigation?"Si":"No",l='<div class="checkbox clip-check check-success "><input class="editRow" ng-disabled="true" type="checkbox" id="chk_'+e.id+'" data-id="'+e.id+'" '+o+' ><label for="chk_'+e.id+'">'+r+"</label></div>";a+=l}return a}).notSortable(),a.newColumn(null).withTitle("Plan Mejoramiento").notSortable().renderWith(function(e,t,n,i){var a="";if(null==e.category||"Incapacidad"!=e.category||null==e.causeValue||"AT"!=e.causeValue&&"AL"!=e.causeValue)a="NA";else{var o=1==e.hasImprovementPlan||"1"==e.hasImprovementPlan?"checked":"",r=1==e.hasImprovementPlan||"1"==e.hasImprovementPlan?"Si":"No",l='<div class="checkbox clip-check check-success "><input class="editRow" ng-disabled="true" type="checkbox" id="chk_'+e.id+'" data-id="'+e.id+'" '+o+' ><label for="chk_'+e.id+'">'+r+"</label></div>";a+=l}return a}).notSortable()];var g=function(){angular.element("#dataDiagnosticDisabilityDT a.editRow").on("click",function(){var e=angular.element(this).data("id");v(e)}),angular.element("#dataDiagnosticDisabilityDT a.viewRow").on("click",function(){var e=angular.element(this).data("id");y(e)}),angular.element("#dataDiagnosticDisabilityDT a.uploadRow").on("click",function(){var e=angular.element(this).data("id");C(e)}),angular.element("#dataDiagnosticDisabilityDT a.reportRow").on("click",function(){var e=angular.element(this).data("id");D(e)}),angular.element("#dataDiagnosticDisabilityDT a.actionPlanRowDisability").on("click",function(){var e=angular.element(this).data("id");O(e)}),angular.element("#dataDiagnosticDisabilityDT a.delRow").on("click",function(){var t=angular.element(this).data("id");p.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(i){if(i){var a={};a.id=t,u({method:"POST",url:"api/absenteeism-disability/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){n.error(e),p.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){e.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};e.dtInstanceDiagnosticDisabilityDTCallback=function(t){e.dtInstanceDiagnosticDisabilityDT=t},e.reloadData=function(){e.dtInstanceDiagnosticDisabilityDT.reloadData()},e.onCreate=function(){null!=e.$parent&&e.$parent.navToSection("edit","edit",0)},e.onExportExcel=function(){var n=JSON.stringify({customerId:t.customerId,year:e.filter.selectedYear?e.filter.selectedYear.value:1,month:e.filter.selectedMonth?e.filter.selectedMonth.value:null});angular.element("#downloadDocument")[0].src="api/customer-absenteeism-disability/export-excel?data="+Base64.encode(n)};var v=function(t){null!=e.$parent&&e.$parent.navToSection("edit","edit",t)},y=function(t){null!=e.$parent&&e.$parent.navToSection("edit","view",t)},C=function(t){var n=h.open({templateUrl:c.app.views.urlRoot+"modules/customer/occupational/absenteeism/disability/customer_absenteeism_disability_document_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideDisabilityDocumentCtrl",scope:e,resolve:{disability:function(){return{id:t?t:0}}}});n.result.then(function(){e.reloadData()},function(){e.reloadData()})},D=function(t){var n=h.open({templateUrl:c.app.views.urlRoot+"modules/customer/occupational/absenteeism/disability/customer_absenteeism_disability_reportAL_list_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideDisabilityReportALCtrl",scope:e,resolve:{disability:function(){return{id:t?t:0}}}});n.result.then(function(){e.reloadData()},function(){})},O=function(t){var n=h.open({templateUrl:c.app.views.urlRoot+"modules/customer/common/modals/customer_improvement_plan_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideCustomerAbsenteeismDisabilitymprovementPlanCtrl",scope:e,resolve:{item:function(){return{id:t}},isView:function(){return e.isView}}});n.result.then(function(){e.reloadData()},function(){e.reloadData()})};e.onUpload=function(){var t=h.open({templateUrl:c.app.views.urlRoot+"modules/customer/occupational/absenteeism/disability/customer_absenteeism_disability_import_modal.htm",placement:"bottom",size:"lg",backdrop:!0,controller:"ModalInstanceSideUploadDisabilityCtrl",scope:e});t.result.then(function(t){t&&t.sessionId&&null!=e.$parent&&e.$parent.navToSection("staging","staging",t.sessionId)},function(){})}}]),app.controller("ModalInstanceSideDisabilityDocumentCtrl",["$rootScope","$scope","$uibModalInstance","disability","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile","$document",function(e,t,n,i,a,o,r,l,s,c,d,u,p,m,f){var h=0;t.disabilityDocumentType=e.parameters("absenteeism_disability_document_type"),t.disability=i,t.disabledType=!1,t.attachment={id:0,created_at:c("date")(new Date,"dd/MM/yyyy HH:mm"),customerDisabilityId:i.id,agent:null,type:null,classification:null,status:null,version:1,description:""},t.onLoadRecordDisability=function(){if(0!=t.disability.id){var e={id:t.disability.id};l({method:"GET",url:"api/absenteeism-disability",params:e})["catch"](function(e,t){if(403==t){var n=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";r.swal("No Autorizado","No estas autorizado para ver esta información.","error"),o(function(){$state.go(n)},3e3)}else 404==t?r.swal("Información no disponible","Centro de trabajo no encontrado","error"):r.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(e){o(function(){if(t.disability=e.data.result,null!=t.disability.cause&&"EG"==t.disability.cause.value){var n=c("filter")(t.disabilityDocumentType,{value:"INC"});n.length>0&&(t.attachment.type=n[0],t.disabledType=!0)}})})["finally"](function(){})}},t.onLoadRecordDisability();var w=t.uploader=new d({url:"api/absenteeism-disability-document/upload",formData:[],removeAfterUpload:!0});w.filters.push({name:"customFilter",fn:function(e,t){return this.queue.length<10}}),w.onWhenAddingFileFailed=function(e,t,n){console.info("onWhenAddingFileFailed",e,t,n)},w.onAfterAddingFile=function(e){console.info("onAfterAddingFile",e)},w.onAfterAddingAll=function(e){console.info("onAfterAddingAll",e)},w.onBeforeUploadItem=function(e){console.info("onBeforeUploadItem",e);var t={id:h};e.formData.push(t)},w.onProgressItem=function(e,t){console.info("onProgressItem",e,t)},w.onProgressAll=function(e){console.info("onProgressAll",e)},w.onSuccessItem=function(e,t,n,i){console.info("onSuccessItem",e,t,n,i)},w.onErrorItem=function(e,t,n,i){console.info("onErrorItem",e,t,n,i)},w.onCancelItem=function(e,t,n,i){console.info("onCancelItem",e,t,n,i)},w.onCompleteItem=function(e,t,n,i){console.info("onCompleteItem",e,t,n,i)},w.onCompleteAll=function(){console.info("onCompleteAll")},t.onCloseModal=function(){n.close(1)},t.onCancelDocument=function(){n.dismiss("cancel")},t.form={submit:function(e){var t=null;if(e.$invalid){var n=null,t=null;for(n in e)"$"!=n[0]&&(null!==t||e[n].$valid||(t=e[n].$name),e[n].$pristine&&(e[n].$dirty=!0));return angular.element(".ng-invalid[name="+t+"]").focus(),void r.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}b()},reset:function(e){}};var b=function(){var e={},n=JSON.stringify(t.attachment);return e.data=Base64.encode(n),l({method:"POST",url:"api/absenteeism-disability-document/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){o(function(){t.attachment=e.data.result,h=e.data.result.id,w.uploadAll(),r.swal("Registro","La información ha sido guardada satisfactoriamente","success"),t.onCloseModal()})})["catch"](function(e){a.error(e),r.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})},g={};g.operation="document",g.disability_id=t.disability.id,t.dtInstanceDisabilityAttachment={},t.dtOptionsDisabilityAttachment=p.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:g,url:"api/absenteeism-disability-document",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){v()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,n,i){m(angular.element(e).contents())(t)}),t.dtColumnsDisabilityDocumentAttachment=[u.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,n,i,a){var o=null!=t.document?t.document.path:"",r="",l='<a target="_self" class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Descargar anexo" data-id="'+t.id+'" data-url="'+o+'" >   <i class="fa fa-download"></i></a> ';'<a class="btn btn-info btn-xs viewRow lnk" target="_blank" href="'+o+'" uib-tooltip="Abrir anexo" data-id="'+t.id+'" >   <i class="fa fa-folder-open-o"></i></a> ','<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Anular anexo" data-id="'+t.id+'" >   <i class="fa fa-ban"></i></a> ';return e.can("seguimiento_view"),e.can("seguimiento_edit")&&(r+=l),e.can("seguimiento_delete"),r}),u.newColumn("documentType").withTitle("Tipo de documento").withOption("width",200),u.newColumn("description").withTitle("Descripción").withOption("width",200),u.newColumn("date").withTitle("Fecha Creación").withOption("width",200),u.newColumn(null).withTitle("Usuario").withOption("width",200).renderWith(function(e,t,n,i){var a="";return null!=e.agent&&(a=e.agent),a})];var v=function(){$("#dtDisabilityDocumentAttachment a.editRow").on("click",function(){var e=$(this).data("id"),t=$(this).data("url");""==t?r.swal("Error en la descarga","No existe un anexo para descargar","error"):jQuery("#downloadDocument")[0].src="api/absenteeism-disability-document/download?id="+e}),$("#dtDisabilityDocumentAttachment a.delRow").on("click",function(){var e=$(this).data("id");log.info("intenta eliminar el registro: "+e),r.swal({title:"Está seguro?",text:"Anularás el anexo seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, anular!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(e){e||swal("Cancelación","La operación ha sido cancelada","error")})})};t.reloadData=function(){t.dtInstanceDisabilityAttachment.reloadData()}}]),app.controller("ModalInstanceSideDisabilityReportALCtrl",["$rootScope","$scope","$uibModalInstance","disability","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile","$document",function(e,t,n,i,a,o,r,l,s,c,d,u,p,m,f){t.onCloseModal=function(){n.close(t.employee)},t.onCancel=function(){n.dismiss("cancel")},t.dtInstanceReportAL={},t.dtOptionsReportAL=p.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.operation="document",e.disability_id=i.id,e},url:"api/absenteeism-disability-report-al/available",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){h()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,n,i){m(angular.element(e).contents())(t)}),t.dtColumnsReportAL=[u.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,n,i,a){var o=null!=t.document?t.document.path:"",r="",l=('<a target="_self" class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Descargar anexo" data-id="'+t.id+'" data-url="'+o+'" >   <i class="fa fa-download"></i></a> ','<a class="btn btn-info btn-xs viewRow lnk" target="_blank" href="'+o+'" uib-tooltip="Abrir anexo" data-id="'+t.id+'" >   <i class="fa fa-folder-open-o"></i></a> ','<a class="btn btn-primary btn-xs delRow lnk" href="#" uib-tooltip="Adicionar reporte" data-id="'+t.id+'" >   <i class="fa fa-plus"></i></a> ');return e.can("seguimiento_view"),e.can("seguimiento_edit"),e.can("seguimiento_delete"),r+=l}),u.newColumn("accident_date").withTitle("Fecha de accidente").withOption("width",200),u.newColumn("accident_description").withTitle("Descripción accidente").withOption("width",200),u.newColumn("status").withTitle("Estado").withOption("width",100).renderWith(function(e,t,n,i){var a="";switch(e){case"abierto":a="label label-success";break;case"Cancelado":a="label label-danger";break;case"Retirado":a="label label-warning"}var o='<span class="'+a+'">'+e+"</span>";return o})];var h=function(){$("#dtReportAL a.delRow").on("click",function(){var e=$(this).data("id");r.swal({title:"Está seguro?",text:"Adicionará el reporte al diagnóstico.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, adicionar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(n){if(n){var r={id:0,customerDisabilityId:i.id,reportAL:{id:e}},c={},d=JSON.stringify(r);return c.data=Base64.encode(d),l({method:"POST",url:"api/absenteeism-disability-report-al/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(c)}).then(function(e){o(function(){s.pop("success","Operación Exitosa","Registro eliminado"),t.reloadDataReportALRelation(),t.reloadData()})})["catch"](function(e){a.error(e),s.pop("error","Error","Por favor ingrese los campos requeridos.")})["finally"](function(){})}swal("Cancelación","La operación ha sido cancelada","error")})})};t.reloadData=function(){t.dtInstanceReportAL.reloadData()},t.dtInstanceReportALRelation={},t.dtOptionsReportALRelation=p.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.operation="document",e.disability_id=i.id,e},url:"api/absenteeism-disability-report-al",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){w()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,n,i){m(angular.element(e).contents())(t)}),t.dtColumnsReportALRelation=[u.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,n,i,a){var o=null!=t.document?t.document.path:"",r="",l=('<a target="_self" class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Descargar anexo" data-id="'+t.id+'" data-url="'+o+'" >   <i class="fa fa-download"></i></a> ','<a class="btn btn-info btn-xs viewRow lnk" target="_blank" href="'+o+'" uib-tooltip="Abrir anexo" data-id="'+t.id+'" >   <i class="fa fa-folder-open-o"></i></a> ','<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar reporte" data-id="'+t.id+'" >   <i class="fa fa-trash"></i></a> ');return e.can("seguimiento_view"),e.can("seguimiento_edit"),e.can("seguimiento_delete"),r+=l}),u.newColumn("accident_date").withTitle("Fecha de accidente").withOption("width",200),u.newColumn("accident_description").withTitle("Descripción accidente").withOption("width",200),u.newColumn("status").withTitle("Estado").withOption("width",100).renderWith(function(e,t,n,i){var a="";switch(e){case"abierto":a="label label-success";break;case"Cancelado":a="label label-danger";break;case"Retirado":a="label label-warning"}var o='<span class="'+a+'">'+e+"</span>";return o})];var w=function(){$("#dtReportALRelation a.delRow").on("click",function(){var e=$(this).data("id");r.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(n){if(n){var i={};i.id=e,l({method:"POST",url:"api/absenteeism-disability-report-al/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){a.error(e),r.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){t.reloadDataReportALRelation(),t.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};t.reloadDataReportALRelation=function(){t.dtInstanceReportALRelation.reloadData()}}]),app.controller("ModalInstanceSideDisabilityActionPlanCtrl",["$rootScope","$scope","$uibModalInstance","actionPlan","$log","$timeout","SweetAlert","isView","$filter","FileUploader","$http",function(e,t,n,i,a,o,r,l,s,c,d){t.typesAlert=s("orderBy")(e.parameters("tracking_alert_type"),"id",!1),t.typesTime=e.parameters("tracking_alert_timeType"),t.statusAlert=e.parameters("tracking_alert_status"),t.perferencesAlert=e.parameters("tracking_alert_preference"),t.datePickerConfig={culture:"es-CO",format:"dd/MM/yyyy hh:mm tt"},t.actionPlan=i,t.isView=l,t.onClose=function(){n.close(1)},t.onCancel=function(){n.dismiss("cancel")},t.saveActionPlan=function(){var e={};if(void 0==t.actionPlan.closeDateTime||null==t.actionPlan.closeDateTime)return void r.swal("Error de guardado","La fecha de cierre es requerida!","error");t.actionPlan.closeDateTime=t.actionPlan.closeDateTime.toISOString();var i=JSON.stringify(t.actionPlan);return e.data=Base64.encode(i),d({method:"POST",url:"api/absenteeism-disability/action-plan/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){o(function(){r.swal("Registro","La información ha sido guardada satisfactoriamente","success"),n.close(1)})})["catch"](function(e){n.close(1)})["finally"](function(){})},t.addActionPlanAlert=function(){null==t.actionPlan.alerts&&(t.actionPlan.alerts=[]),o(function(){t.actionPlan.alerts.push({id:0,type:null,timeType:null,time:0,preference:null,sent:0,status:null})},500)},t.removeAlert=function(e){r.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(n){n?o(function(){t.actionPlan.alerts.splice(e,1)}):swal("Cancelación","La operación ha sido cancelada","error")})}}]),app.controller("ModalInstanceSideCustomerAbsenteeismDisabilitymprovementPlanCtrl",["$stateParams","$rootScope","$scope","$uibModalInstance","item","$log","$timeout","SweetAlert","isView","$filter","FileUploader","$http","DTOptionsBuilder","DTColumnBuilder","$compile",function(e,t,n,i,a,o,r,l,s,c,d,u,p,m,f){var h="AT";n.maxDate=new Date,n.datePickerConfig={culture:"es-CO",format:"dd/MM/yyyy HH:mm"},n.responsibleList=[],n.typesAlert=c("orderBy")(t.parameters("tracking_alert_type"),"id",!1),n.typesTime=t.parameters("tracking_alert_timeType"),n.statusAlert=t.parameters("tracking_alert_status"),n.preferencesAlert=t.parameters("tracking_alert_preference"),n.typeList=t.parameters("improvement_plan_type");var w=function(){n.improvement={id:0,customerId:e.customerId,classificationName:h,classificationId:h,entityName:"AD",entityId:a.id,type:null,endDate:null,description:"",observation:"",responsible:null,isRequiresAnalysis:!1,status:{id:0,value:"CR",item:"Creada"},trackingList:[],alertList:[]}};w(),n.onLoadRecord=function(e){if(0!=e){var t={id:e};u({method:"GET",url:"api/customer/improvement-plan",params:t})["catch"](function(e,t){if(403==t){var n=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";l.swal("No Autorizado","No estas autorizado para ver esta información.","error"),r(function(){$state.go(n)},3e3)}else 404==t?l.swal("Información no disponible","Centro de trabajo no encontrado","error"):l.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(e){r(function(){null!=e.data.result&&""!=e.data.result&&(n.improvement=e.data.result,v())},400)})["finally"](function(){})}else n.loading=!1},n.onCloseModal=function(){i.close(1)},n.onCancel=function(){i.dismiss("cancel")},n.onClear=function(){};var b=function(){var t={customer_id:e.customerId};return u({method:"POST",url:"api/customer/improvement-plan/list-data",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(e){r(function(){n.responsibleList=e.data.data.responsible})})["catch"](function(e){l.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};b(),n.master=n.improvement,n.form={submit:function(e){var t=null;if(e.$invalid){var n=null,t=null;for(n in e)"$"!=n[0]&&(null!==t||e[n].$valid||(t=e[n].$name),e[n].$pristine&&(e[n].$dirty=!0));return angular.element(".ng-invalid[name="+t+"]").focus(),void l.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}g()},reset:function(e){n.improvement=angular.copy(n.master),e.$setPristine(!0)}};var g=function(){var e={},t=JSON.stringify(n.improvement);return e.data=Base64.encode(t),u({method:"POST",url:"api/customer/improvement-plan/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){r(function(){l.swal("Registro","La información se ha guardado satisfactoriamente","success"),w()})})["catch"](function(e){l.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){n.reloadData()})},v=function(){null!=n.improvement.endDate&&(n.improvement.endDate=new Date(n.improvement.endDate.date)),angular.forEach(n.improvement.trackingList,function(e,t){null!=e.startDate&&(e.startDate=new Date(e.startDate.date))})};n.onAddTracking=function(){r(function(){null==n.improvement.trackingList&&(n.improvement.trackingList=[]),n.improvement.trackingList.push({id:0,customerImprovementPlanId:0,responsible:null,startDate:null})})},n.onRemoveTracking=function(e){l.swal({title:"Está seguro?",text:"Desea confirmar la eliminación de este registro ?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(t){t?r(function(){var t=n.improvement.trackingList[e];if(n.improvement.trackingList.splice(e,1),0!=t.id){var i={};i.id=t.id,u({method:"POST",url:"api/customer/improvement-plan-tracking/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){o.error(e),l.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})},n.onAddAlert=function(){r(function(){null==n.improvement.alertList&&(n.improvement.alertList=[]),n.improvement.alertList.push({id:0,customerImprovementPlanId:0,type:null,preference:null,time:0,timeType:null,status:null})})},n.onRemoveAlert=function(e){l.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(t){t?r(function(){var t=n.improvement.alertList[e];if(n.improvement.alertList.splice(e,1),0!=t.id){var i={};i.id=t.id,u({method:"POST",url:"api/customer/improvement-plan-alert/delete",
headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){o.error(e),l.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})},n.dtInstanceImprovementPlan={},n.dtOptionsImprovementPlan=p.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerId=n.improvement.customerId,e.entityId=n.improvement.entityId,e.entityName=n.improvement.entityName,JSON.stringify(e)},url:"api/customer-improvement-plan-entity",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){y()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,t,i){f(angular.element(e).contents())(n)}),n.dtColumnsImprovementPlan=[m.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,i,a,o){var r="",l='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+e.id+'" >   <i class="fa fa-edit"></i></a> ',s='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+e.id+'" >   <i class="fa fa-trash-o"></i></a> ';return t.can("cliente_plan_mejoramiento_edit")&&(r+=l),t.can("cliente_plan_mejoramiento_delete")&&(r+=s),n.isView?null:r}),m.newColumn("origin").withTitle("Origen").withOption("width",200).withOption("defaultContent",""),m.newColumn("classification").withTitle("Clasificación").withOption("width",200).withOption("defaultContent",""),m.newColumn("type").withTitle("Tipo").withOption("width",200).withOption("defaultContent",""),m.newColumn("description").withTitle("Hallazgo").withOption("width",200).withOption("defaultContent",""),m.newColumn("responsibleName").withTitle("Responsable").withOption("defaultContent",""),m.newColumn(null).withTitle("Fecha Cierre").withOption("width",200).renderWith(function(e,t,n,i){return"object"==typeof e.endDate&&null!=e.endDate?moment(e.endDate.date).format("DD/MM/YYYY"):null!=e.endDate?moment(e.endDate).format("DD/MM/YYYY"):""}),m.newColumn(null).withTitle("Estado").withOption("width",200).withOption("defaultContent","").renderWith(function(e,t,n,i){var a="label label-success",o=e.status;switch(e.statusCode){case"AB":a="label label-info";break;case"CO":a="label label-success";break;case"CA":a="label label-danger"}return'<span class="'+a+'">'+o+"</span>"})];var y=function(){$("#dtImprovementPlan a.editRow").on("click",function(){var e=$(this).data("id");n.onLoadRecord(e)}),$("#dtImprovementPlan a.delRow").on("click",function(){var e=$(this).data("id");l.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(t){if(t){var i={};i.id=e,u({method:"POST",url:"api/customer/improvement-plan/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){o.error(e),l.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){n.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};n.dtInstanceImprovementPlanCallback=function(e){n.dtInstanceImprovementPlan=e},n.reloadData=function(){n.dtInstanceImprovementPlan.reloadData()}}]),app.controller("ModalInstanceSideUploadDisabilityCtrl",["$rootScope","$stateParams","$scope","FileUploader","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","ngNotify","ListService",function(e,t,n,i,a,o,r,l,s,c,d,u){function p(){var e=[{name:"export_url",value:null}];u.getDataList(e).then(function(e){m=e.data.data.exportUrl.item,h.url=m+"api/v1/customer-absenteeism-import",n.uploader.url=m+"api/v1/customer-absenteeism-import"},function(e){n.status="Unable to load customer data: "+e.message})}var m="",f=null,h=n.uploader=new i({url:m+"api/v1/customer-absenteeism-import",formData:[]});p(),n.download=function(){jQuery("#downloadDocument")[0].src="api/customer-absenteeism-disability/download-template"},h.filters.push({name:"customFilter",fn:function(e,t){return this.queue.length<10}}),h.onWhenAddingFileFailed=function(e,t,n){console.info("onWhenAddingFileFailed",e,t,n)},h.onAfterAddingFile=function(e){console.info("onAfterAddingFile",e)},h.onAfterAddingAll=function(e){console.info("onAfterAddingAll",e)},h.onBeforeUploadItem=function(e){console.info("onBeforeUploadItem",e);var n={id:t.customerId};e.formData.push(n)},h.onProgressItem=function(e,t){console.info("onProgressItem",e,t)},h.onProgressAll=function(e){console.info("onProgressAll",e)},h.onSuccessItem=function(e,t,n,i){console.info("onSuccessItem",e,t,n,i)},h.onErrorItem=function(e,t,n,i){console.info("onErrorItem",e,t,n,i)},h.onCancelItem=function(e,t,n,i){console.info("onCancelItem",e,t,n,i)},h.onCompleteItem=function(e,t,n,i){console.info("onCompleteItem",e,t,n,i),f=t},h.onCompleteAll=function(){console.info("onCompleteAll"),a.close(f)}}]);
"use strict";app.controller("customerAbsenteeismDisabilityStagingListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$document","$filter","$aside","ListService",function(i,t,a,e,n,s,l,o,r,d,u,c,y,m,p,b,f){function h(){var t=[{name:"export_url",value:null}];f.getDataList(t).then(function(i){w=i.data.data.exportUrl.item},function(t){i.status="Unable to load customer data: "+t.message})}var w="";i.audit={fields:[],filters:[]},h(),i.dtInstanceDiagnosticDisabilityStagingDT={},i.dtOptionsDiagnosticDisabilityStagingDT=e.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(a){return a.customerId=t.customerId,a.sessionId=i.$parent.currentId,JSON.stringify(a)},url:"api/customer-absenteeism-disability-staging",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[1,"asc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){g()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,a,e){l(angular.element(t).contents())(i)}),i.dtColumnsDiagnosticDisabilityStagingDT=[n.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(i,t,a,e){var n="",s='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar"  data-id="'+i.id+'"'+n+' >   <i class="fa fa-edit"></i></a> ',l='<a class="btn btn-info btn-xs addRow lnk" href="#" uib-tooltip="Relacionar ausentismo"  data-id="'+i.id+'"'+n+' >   <i class="fa fa-plus"></i></a> ',o=0!=i.isValid&&i.isValid?"":s;return o+=1==i.disabilityParentIsRequired||i.disabilityParentIsRequired?l:""}),n.newColumn(null).withTitle("Fila").withOption("width",50).renderWith(function(i,t,a,e){var n=1==i.isValid||i.isValid?"badge badge-success":"badge badge-danger",s=1==i.isValid||i.isValid?' <i class=" fa fa-check"></i>':' <i class=" fa fa-ban"></i>';return'<span class="'+n+'">'+i.index+s+"</span>"}),n.newColumn("documentNumber").withTitle("Nro Identificación").withOption("width",200).withOption("defaultContent",""),n.newColumn("firstName").withTitle("Nombres").withOption("width",200).withOption("defaultContent",""),n.newColumn("lastName").withTitle("Apellidos").withOption("width",200).withOption("defaultContent",""),n.newColumn("category").withTitle("Tipo Ausentismo").withOption("width",100).withOption("defaultContent",""),n.newColumn("type").withTitle("Tipo Incapacidad").withOption("width",100).withOption("defaultContent",""),n.newColumn("cause").withTitle("Causa Incapacidad").withOption("width",100).withOption("defaultContent",""),n.newColumn("accidentType").withTitle("Tipo Impacto").withOption("width",100).withOption("defaultContent",""),n.newColumn("disabilityParent").withTitle("Relacionar Ausentismo").withOption("width",100).withOption("defaultContent",""),n.newColumn("diagnostic").withTitle("Diagnóstico").withOption("width",100).withOption("defaultContent",""),n.newColumn("start").withTitle("F Inicial").withOption("width",180).withOption("defaultContent",""),n.newColumn("end").withTitle("F Final").withOption("width",180).withOption("defaultContent",""),n.newColumn("bodyPart").withTitle("Parte Cuerpo").withOption("width",180).withOption("defaultContent",""),n.newColumn("observation").withTitle("Observación").withOption("width",280).withOption("defaultContent","")];var g=function(){angular.element("#dataDiagnosticDisabilityStagingDT a.editRow").on("click",function(){var i=angular.element(this).data("id");D(i)}),angular.element("#dataDiagnosticDisabilityStagingDT a.addRow").on("click",function(){var i=angular.element(this).data("id");v({id:i})})};i.dtInstanceDiagnosticDisabilityStagingDTCallback=function(t){i.dtInstanceDiagnosticDisabilityStagingDT=t},i.reloadData=function(){i.dtInstanceDiagnosticDisabilityStagingDT.reloadData()};var D=function(t){var a=b.open({templateUrl:d.app.views.urlRoot+"modules/customer/occupational/absenteeism/disability/customer_absenteeism_disability_staging_modal.htm",placement:"right",windowTopClass:"top-modal",size:"lg",backdrop:!0,controller:"ModalInstanceSideCustomerAbsenteeismDisabilityStagingEditCtrl",scope:i,resolve:{dataItem:function(){return{id:t?t:0}},isView:function(){return i.isView}}});a.result.then(function(){i.reloadData()},function(){i.reloadData()})},v=function(t){var a=b.open({templateUrl:d.app.views.urlRoot+"modules/common/modals/data_table_list_modal.htm",placement:"right",windowTopClass:"top-modal",size:"lg",backdrop:!0,controller:"ModalInstanceSideCustomerAbsenteeismDisabilityParentStagingCtrl",resolve:{dataItem:function(){return t}}});a.result.then(function(t){i.reloadData()},function(){})};i.onCancel=function(){m.scrollTop(40,2e3),null!=i.$parent&&i.$parent.navToSection("list","list")},i.onProcess=function(){y.swal({title:"Confirma la importación de los registros?",text:"Se importarán los registros válidos. Una vez realizado este proceso no se podrán realizar cambios.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, confirmar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(e){if(e)return c({method:"POST",url:w+"api/v1/customer-absenteeism-import/confirm",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param({id:t.customerId,sessionId:i.$parent.currentId})}).then(function(t){u(function(){y.swal("Registro","La información ha sido importada satisfactoriamente","success"),i.onCancel()})})["catch"](function(i){a.error(i),y.swal("Error de guardado",i.data.message,"error")})["finally"](function(){})})}}]),app.controller("ModalInstanceSideCustomerAbsenteeismDisabilityStagingEditCtrl",["$rootScope","$stateParams","$scope","dataItem","isView","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","ngNotify","$document","$filter","$aside","ListService",function(i,t,a,e,n,s,l,o,r,d,u,c,y,m,p,b){function f(){var i=[{name:"absenteeism_disability_day_charged_is_death",value:null},{name:"absenteeism_disability_current_minimum_daily",value:null},{name:"config_day_charged_part",value:null},{name:"customer_workplace",value:t.customerId}];b.getDataList(i).then(function(i){a.workplaceList=i.data.data.workplaceList,w=i.data.data.absenteeismDisabilityDayChargedIsDeath?i.data.data.absenteeismDisabilityDayChargedIsDeath.value:0,g=i.data.data.absenteeismDisabilityCurrentMinimumDaily?i.data.data.absenteeismDisabilityCurrentMinimumDaily.value:0,a.configDayChargedPartList=i.data.data.configDayChargedPart},function(i){a.status="Unable to load customer data: "+i.message})}a.onCloseModal=function(){s.close(null)},a.onCancel=function(){s.dismiss("cancel")};var h=l,w=0,g=0;a.causeList=i.parameters("absenteeism_disability_causes"),a.causeListAdmin=i.parameters("absenteeism_disability_causes_admin"),a.causes=i.parameters("absenteeism_disability_causes"),a.types=i.parameters("absenteeism_disability_type"),a.contractTypes=i.parameters("employee_contract_type"),a.years=[],a.documentType=i.parameters("customer_document_type"),a.tiposdoc=i.parameters("tipodoc"),a.absenteeismType=i.parameters("absenteeism_category"),a.concept=i.parameters("absenteeism_concept_cost"),a.diagnostics=[],a.employees=[],f(),a.maxDate=new Date,a.datePickerConfig={culture:"es-CO",format:"dd/MM/yyyy"},a.loading=!0,a.customer_id=t.customerId,a.isView=n,a.isCreate=!0,a.format="dd-MM-yyyy",a.currentYear=null,a.filter={selectedCause:null};var D=function(){a.disability={id:e.id,category:null,type:null,cause:null,workplace:null,accidentType:null,diagnostic:null,employee:null,dayLiquidationBasis:0,dayLiquidationBasisFormat:"",hourLiquidationBasis:0,hourLiquidationBasisFormat:"",startDate:new Date,endDate:new Date,numberDays:0,chargedDays:0,charged:!1,amountPaid:0,indirectCost:[],directCostTotal:0,indirectCostTotal:0}};D();var v=function(){var t=a.accidentTypeList=i.parameters("absenteeism_disability_accident_type");null!==t&&a.disability.cause&&(a.accidentTypeList=t.filter(function(i){return null!=a.disability.type&&"Sin Incapacidad"==a.disability.type.value?"L"==i.value||"M"==i.value:"AL"==a.disability.cause.value||"AT"==a.disability.cause.value?"N"!==i.value:"EL"==a.disability.cause.value||"ELC"==a.disability.cause.value?"N"==i.value||"M"==i.value:void 0}))};v(),a.onLoadRecord=function(){if(0!=a.disability.id){var i={id:a.disability.id};d({method:"GET",url:"api/customer-absenteeism-disability-staging/get",params:i})["catch"](function(i,t){if(403==t){var a=null!==i.message&&void 0!==i.message?i.message:"app.clientes.list";r.swal("No Autorizado","No estas autorizado para ver esta información.","error"),o(function(){$state.go(a)},3e3)}else 404==t?r.swal("Información no disponible","Centro de trabajo no encontrado","error"):r.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(i){console.log(i),o(function(){a.disability=i.data.result,null!=a.disability.category&&"Incapacidad"!=a.disability.category.value?a.causes=a.causeListAdmin:a.causes=a.causeList,C(),a.onChangeStartDate(),I(),O(),v();var t=a.accidentTypeList.filter(function(i){return null!=i&&a.disability.accidentType&&i.value==a.disability.accidentType.value});0==t.length&&(a.disability.accidentType=null)})})["finally"](function(){o(function(){a.loading=!1},400),o(function(){y.scrollTop(40,2e3)})})}else h.info("creacion de nuevo cliente"),a.loading=!1},a.onLoadRecord();var C=function(){if(a.disability.startDate=new Date(a.disability.startDate.date),a.disability.endDate=new Date(a.disability.endDate.date),null!=a.disability.diagnostic){var i=m("filter")(a.diagnostics,{id:a.disability.diagnostic.id});0==i.length&&a.diagnostics.push(a.disability.diagnostic)}a.disability.dayLiquidationBasisFormat=m("currency")(a.disability.dayLiquidationBasis,"$ ",2),a.disability.hourLiquidationBasisFormat=m("currency")(a.disability.hourLiquidationBasis,"$ ",2),a.disability.indirectCostTotal=m("currency")(a.disability.indirectCostTotal,"$ ",2)};a.$watch("disability.endDate - disability.startDate",function(){T(),I()});var T=function(){var i=new moment(a.disability.endDate),t=new moment(a.disability.startDate);a.disability.isHour||(null!=a.disability.type&&"Sin Incapacidad"==a.disability.type.value?a.disability.numberDays=0:a.disability.numberDays=i.diff(t,"days")+1)};a.onChangeStartDate=function(i){null!=a.disability.type&&"Sin Incapacidad"==a.disability.type.value&&(a.disability.numberDays=0,a.disability.endDate=new Date(a.disability.startDate))},a.$watch("disability.employee.salary",function(){null!=a.disability.employee&&(a.disability.employee.salary>0&&(a.disability.dayLiquidationBasis=a.disability.employee.salary/30),a.disability.dayLiquidationBasis>0&&(a.disability.hourLiquidationBasis=a.disability.dayLiquidationBasis/8),a.disability.dayLiquidationBasisFormat=m("currency")(a.disability.dayLiquidationBasis,"$ ",2),a.disability.hourLiquidationBasisFormat=m("currency")(a.disability.hourLiquidationBasis,"$ ",2))});var I=function(){var i=0;if(0==a.disability.id){if(a.disability.amountPaid=0,null!=a.disability.cause&&null!=a.disability.employee&&""!=a.disability.employee.salary&&""!=a.disability.numberDays)if("AL"==a.disability.cause.value||"AT"==a.disability.cause.value)parseInt(a.disability.numberDays)>1&&(i=parseFloat(a.disability.employee.salary)/30*(parseInt(a.disability.numberDays)-1),a.disability.amountPaid=Math.round(100*i)/100);else if("EG"==a.disability.cause.value)if(null!=a.disability.type&&"Inicial"==a.disability.type.item){if(parseInt(a.disability.numberDays)>2){var t=parseFloat(a.disability.employee.salary)/30*.6667;t=t<parseFloat(g)?parseFloat(g):t,i=Math.round(t*(parseInt(a.disability.numberDays)-2)),a.disability.amountPaid=i}}else null!=a.disability.type&&"Prorroga"==a.disability.type.item&&(i=parseFloat(a.disability.employee.salary)/30*parseInt(a.disability.numberDays),a.disability.amountPaid=Math.round(100*i)/100);else if("LM"==a.disability.cause.value||"LP"==a.disability.cause.value)i=parseFloat(a.disability.employee.salary)/30*parseInt(a.disability.numberDays),a.disability.amountPaid=Math.round(100*i)/100;else if("EL"==a.disability.cause.value){if(parseInt(a.disability.numberDays)>2){var t=parseFloat(a.disability.employee.salary)/30*.6667;t=t<parseFloat(g)?parseFloat(g):t,i=Math.round(t*(parseInt(a.disability.numberDays)-2)),a.disability.amountPaid=i}}else"ELC"==a.disability.cause.value&&parseInt(a.disability.numberDays)>1&&(i=parseFloat(a.disability.employee.salary)/30*(parseInt(a.disability.numberDays)-1),a.disability.amountPaid=Math.round(100*i)/100);var e=0;null!=a.disability.category&&"Incapacidad"==a.disability.category.value&&null!=a.disability.employee&&""!=a.disability.employee.salary&&""!=a.disability.numberDays&&(null===a.disability.cause||"EG"!=a.disability.cause.value&&"LM"!=a.disability.cause.value||null!=a.disability.type&&"Inicial"==a.disability.type.item&&(e=parseInt(a.disability.numberDays)>=2?parseFloat(a.disability.employee.salary)/30*2:parseFloat(a.disability.employee.salary)/30*parseInt(a.disability.numberDays))),Math.round(100*e)/100>0&&(a.disability.directCostTotal=Math.round(100*e)/100)}},O=function(){var i=a.disability.category?a.disability.category.value:null,t=a.disability.type?a.disability.type.value:null,e=a.disability.cause?a.disability.cause.value:null,n=a.disability.accidentType?a.disability.accidentType.value:null;a.disability.chargedDays=0,"Incapacidad"==i&&"Inicial"==t?"AT"!=e&&"AL"!=e||"M"!=n||(a.disability.chargedDays=w):"Incapacidad"==i&&"Sin Incapacidad"==t&&("AT"!=e&&"AL"!=e||"M"!=n||(a.disability.chargedDays=w))};a.onSelectCategory=function(){null!=a.disability.category&&"Incapacidad"!=a.disability.category.value?(a.disability.type=null,a.disability.cause=null,a.causes=a.causeListAdmin):(a.disability.isHour=!1,a.causes=a.causeList),a.onChangeIsHour(),I(),O()},a.onSelectType=function(){a.disability.accidentType=null,a.onChangeStartDate(),v(),I(),O()},a.onSelectCause=function(){a.disability.accidentType=null,v(),I(),O()},a.onSelectAccidentType=function(){O()},a.onChangeIsHour=function(){a.disability.isHour?a.disability.numberDays=0:(T(),I())},a.$watch("disability.numberDays",function(){I()}),a.$watch("disability.indirectCost",function(){if(null!=a.disability.indirectCost&&a.disability.indirectCost.length>0){var i=0;angular.forEach(a.disability.indirectCost,function(t,a){null!=t.concept&&""!=t.amount&&angular.isNumber(parseFloat(t.amount))&&(i+=parseFloat(t.amount))}),a.disability.indirectCostTotal=i}else a.disability.indirectCostTotal=0},!0),a.master=a.disability,a.form={submit:function(i){var t=null;if(i.$invalid){var e=null,t=null;for(e in i)"$"!=e[0]&&(null!==t||i[e].$valid||(t=i[e].$name),i[e].$pristine&&(i[e].$dirty=!0));return h.info(a.disability),angular.element(".ng-invalid[name="+t+"]").focus(),void r.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}L()},reset:function(i){}};var L=function(){var i=new moment(a.disability.endDate),t=new moment(a.disability.startDate);if(a.disability.type&&"Sin Incapacidad"!=a.disability.type.value&&i<t)return void r.swal("El formulario contiene errores!","La fecha final debe ser mayor a la fecha inicial.","error");var e={},n=JSON.stringify(a.disability);return e.data=Base64.encode(n),d({method:"POST",url:"api/customer-absenteeism-disability-staging/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(i){o(function(){r.swal("Registro","La información ha sido guardada satisfactoriamente","success"),a.onCloseModal()})})["catch"](function(i){l.error(i),r.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};a.onAddDisabilityDiagnostic=function(){var t=p.open({templateUrl:i.app.views.urlRoot+"modules/customer/occupational/absenteeism/disability/customer_absenteeism_disability_diagnostic_modal.htm",placement:"left",windowTopClass:"top-modal",size:"lg",backdrop:!0,controller:"ModalInstanceSideDisabilityDiagnosticListCtrl",scope:a});t.result.then(function(i){var t=m("filter")(a.diagnostics,{id:i.id});0==t.length&&a.diagnostics.push(i),a.disability.diagnostic=i},function(){})},a.onAddDisabilityEmployeeList=function(){var t=p.open({templateUrl:i.app.views.urlRoot+"modules/customer/occupational/absenteeism/disability/customer_absenteeism_disability_employee_list_modal.htm",placement:"left",windowTopClass:"top-modal",size:"lg",backdrop:!0,controller:"ModalInstanceSideDisabilityEmployeeListCtrl",scope:a});t.result.then(function(i){var t=m("filter")(a.employees,{id:i.id});0==t.length&&a.employees.push(i),a.disability.employee=i},function(){})}}]),app.controller("ModalInstanceSideCustomerAbsenteeismDisabilityParentStagingCtrl",["$rootScope","$stateParams","$scope","dataItem","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile","bsLoadingOverlayService",function(i,t,a,e,n,s,l,o,r,d,u,c,y,m,p,b){a.title="AUSENTISMOS INICIALES",a.loadingOverlayTemplateUrl=i.app.themeRootUrl+"templates/loading-overlay-element-template.htm";var f=function(){a.disability={id:e.id,category:null,type:null,cause:null,workplace:null,accidentType:null,diagnostic:null,employee:null,dayLiquidationBasis:0,dayLiquidationBasisFormat:"",hourLiquidationBasis:0,hourLiquidationBasisFormat:"",startDate:new Date,endDate:new Date,numberDays:0,chargedDays:0,charged:!1,amountPaid:0,indirectCost:[],directCostTotal:0,indirectCostTotal:0,disabilityParent:null}};f(),a.onLoadRecord=function(){if(0!=a.disability.id){var i={id:a.disability.id};r({method:"GET",url:"api/customer-absenteeism-disability-staging/get",params:i})["catch"](function(i,t){}).then(function(i){l(function(){a.disability=i.data.result,a.reloadData()})})["finally"](function(){})}},a.onLoadRecord(),a.onCloseModal=function(){n.close(null)},a.onCancel=function(){n.dismiss("cancel")},a.dtOptionsCommonDataTableList=m.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(i){return i.customerId=t.customerId,i.typeValue="Inicial",i.causeValue=a.disability.cause?a.disability.cause.value:"",i.customerEmployeeId=a.disability.employee?a.disability.employee.id:0,JSON.stringify(i)},url:"api/customer-absenteeism-disability-related",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){h()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(i,t,e){p(angular.element(i).contents())(a)}),a.dtColumnsCommonDataTableList=[y.newColumn(null).withTitle("Acciones").withOption("width",80).notSortable().renderWith(function(i,t,a,e){var n="",s='<a class="btn btn-success btn-xs editRow lnk" href="#" uib-tooltip="Adicionar item"  data-id="'+i.id+'" data-cause="'+i.causeItem+'" data-date="'+i.startDateFormat+'" >   <i class="fa fa-plus-square"></i></a> ';return n+=s}),y.newColumn("causeItem").withTitle("Causa Incapacidad").withOption("width",200).withOption("defaultContent",""),y.newColumn("startDateFormat").withTitle("F Inicial").withOption("width",200).withOption("defaultContent",""),y.newColumn("endDateFormat").withTitle("F Final").withOption("width",180).withOption("defaultContent","")];var h=function(){angular.element("#dtCommonDataTableList a.editRow").on("click",function(){var i=angular.element(this).data("id"),t=angular.element(this).data("cause"),e=angular.element(this).data("date");a.disability.disabilityParent={id:i,name:e+" | "+t},w()})},w=function(){var i={},t=JSON.stringify(a.disability);return i.data=Base64.encode(t),r({method:"POST",url:"api/customer-absenteeism-disability-staging/update",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(i){l(function(){o.swal("Registro","La información ha sido guardada satisfactoriamente","success"),n.close(null)})})["catch"](function(i){s.error(i),o.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};a.dtInstanceCommonDataTableListCallback=function(i){a.dtInstanceCommonDataTableList=i},a.reloadData=function(){a.dtInstanceCommonDataTableList.reloadData(null,!1)}}]);
"use strict";app.controller("customerAbsenteeismDisabilityEditCtrl",["$scope","$stateParams","$log","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$document","$filter","$aside","ListService","bsLoadingOverlayService","$q","DTColumnBuilder","DTOptionsBuilder","$compile",function(i,t,e,a,n,o,l,s,r,d,c,u,p,y,m,b,f,h){function w(){var e=[{name:"absenteeism_disability_day_charged_is_death",value:null},{name:"absenteeism_disability_current_minimum_daily",value:null},{name:"customer_workplace",value:t.customerId},{name:"export_url",value:null}];p.getDataList(e).then(function(t){C=t.data.data.exportUrl.item,i.workplaceList=t.data.data.workplaceList,v=t.data.data.absenteeismDisabilityDayChargedIsDeath?t.data.data.absenteeismDisabilityDayChargedIsDeath.value:0,D=t.data.data.absenteeismDisabilityCurrentMinimumDaily?t.data.data.absenteeismDisabilityCurrentMinimumDaily.value:0},function(t){i.status="Unable to load customer data: "+t.message})}var g=e,v=0,D=0,C=null;i.causeList=o.parameters("absenteeism_disability_causes"),i.causeListAdmin=o.parameters("absenteeism_disability_causes_admin"),i.causes=o.parameters("absenteeism_disability_causes"),i.types=o.parameters("absenteeism_disability_type"),i.contractTypes=o.parameters("employee_contract_type"),i.years=[],i.documentType=o.parameters("customer_document_type"),i.tiposdoc=o.parameters("tipodoc"),i.absenteeismType=o.parameters("absenteeism_category"),i.concept=o.parameters("absenteeism_concept_cost"),i.diagnostics=[],i.employees=[],w(),i.maxDate=new Date,i.datePickerConfig={culture:"es-CO",format:"dd/MM/yyyy"},i.loading=!0,i.customer_id=t.customerId,i.isView="view"==i.$parent.editMode,i.isCreate=!0,i.format="dd-MM-yyyy",i.minDate=new Date-1,i.isDisabilityParentEnable=!1,i.isDisabilityParentRequired=!1,i.currentYear=null,i.filter={selectedCause:null};var T=function(){i.disability={id:i.$parent.currentId,category:null,type:null,cause:null,workplace:null,diagnostic:null,employee:null,dayLiquidationBasis:0,dayLiquidationBasisFormat:"",hourLiquidationBasis:0,hourLiquidationBasisFormat:"",startDate:new Date,endDate:new Date,numberDays:0,chargedDays:0,charged:!1,amountPaid:0,indirectCost:[],directCostTotal:0,indirectCostTotal:0,accidentType:null,disabilityParent:null,isHour:!1}};T();var O=function(){var t=i.accidentTypeList=o.parameters("absenteeism_disability_accident_type");null!==t&&i.disability.cause&&(i.accidentTypeList=t.filter(function(t){return null!=i.disability.type&&"Sin Incapacidad"==i.disability.type.value?"L"==t.value||"M"==t.value:"AL"==i.disability.cause.value||"AT"==i.disability.cause.value?"N"!==t.value:"EL"==i.disability.cause.value||"ELC"==i.disability.cause.value?"N"==t.value||"M"==t.value:void 0}))};O(),i.onLoadRecord=function(){if(0!=i.disability.id){var t={id:i.disability.id};s({method:"GET",url:"api/absenteeism-disability",params:t})["catch"](function(i,t){if(403==t){var e=null!==i.message&&void 0!==i.message?i.message:"app.clientes.list";r.swal("No Autorizado","No estas autorizado para ver esta información.","error"),l(function(){n.go(e)},3e3)}else 404==t?r.swal("Información no disponible","Centro de trabajo no encontrado","error"):r.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(t){console.log(t),l(function(){i.disability=t.data.result,null!=i.disability.category&&"Incapacidad"!=i.disability.category.value?i.causes=i.causeListAdmin:i.causes=i.causeList,L(),P(),O(),I(),A()})})["finally"](function(){l(function(){i.loading=!1},400),l(function(){d.scrollTop(40,2e3)})})}else g.info("creacion de nuevo cliente"),i.loading=!1},i.onLoadRecord();var I=function(){if(i.disability.startDate=new Date(i.disability.startDate.date),i.disability.endDate=new Date(i.disability.endDate.date),null!=i.disability.diagnostic){var t=c("filter")(i.diagnostics,{id:i.disability.diagnostic.id});0==t.length&&i.diagnostics.push(i.disability.diagnostic)}i.disability.dayLiquidationBasisFormat=c("currency")(i.disability.dayLiquidationBasis,"$ ",2),i.disability.hourLiquidationBasisFormat=c("currency")(i.disability.hourLiquidationBasis,"$ ",2),i.disability.indirectCostTotal=c("currency")(i.disability.indirectCostTotal,"$ ",2)};i.$watch("disability.endDate - disability.startDate",function(){S(),L()});var S=function(){var t=new moment(i.disability.endDate),e=new moment(i.disability.startDate);i.disability.isHour||(null!=i.disability.type&&"Sin Incapacidad"==i.disability.type.value?i.disability.numberDays=0:i.disability.numberDays=t.diff(e,"days")+1)};i.onChangeStartDate=function(t){null!=i.disability.type&&"Sin Incapacidad"==i.disability.type.value&&(i.disability.numberDays=0,i.disability.endDate=new Date(i.disability.startDate))},i.$watch("disability.employee.salary",function(){null!=i.disability.employee&&(i.disability.employee.salary>0&&(i.disability.dayLiquidationBasis=i.disability.employee.salary/30),i.disability.dayLiquidationBasis>0&&(i.disability.hourLiquidationBasis=i.disability.dayLiquidationBasis/8),i.disability.dayLiquidationBasisFormat=c("currency")(i.disability.dayLiquidationBasis,"$ ",2),i.disability.hourLiquidationBasisFormat=c("currency")(i.disability.hourLiquidationBasis,"$ ",2))});var L=function(){var t=0;if(0==i.disability.id){if(i.disability.amountPaid=0,null!=i.disability.cause&&null!=i.disability.employee&&""!=i.disability.employee.salary&&""!=i.disability.numberDays)if("AL"==i.disability.cause.value||"AT"==i.disability.cause.value)parseInt(i.disability.numberDays)>1&&(t=parseFloat(i.disability.employee.salary)/30*(parseInt(i.disability.numberDays)-1),i.disability.amountPaid=Math.round(100*t)/100);else if("EG"==i.disability.cause.value)if(null!=i.disability.type&&"Inicial"==i.disability.type.item){if(parseInt(i.disability.numberDays)>2){var e=parseFloat(i.disability.employee.salary)/30*.6667;e=e<parseFloat(D)?parseFloat(D):e,t=Math.round(e*(parseInt(i.disability.numberDays)-2)),i.disability.amountPaid=t}}else null!=i.disability.type&&"Prorroga"==i.disability.type.item&&(t=parseFloat(i.disability.employee.salary)/30*parseInt(i.disability.numberDays),i.disability.amountPaid=Math.round(100*t)/100);else if("LM"==i.disability.cause.value||"LP"==i.disability.cause.value)t=parseFloat(i.disability.employee.salary)/30*parseInt(i.disability.numberDays),i.disability.amountPaid=Math.round(100*t)/100;else if("EL"==i.disability.cause.value){if(parseInt(i.disability.numberDays)>2){var e=parseFloat(i.disability.employee.salary)/30*.6667;e=e<parseFloat(D)?parseFloat(D):e,t=Math.round(e*(parseInt(i.disability.numberDays)-2)),i.disability.amountPaid=t}}else"ELC"==i.disability.cause.value&&parseInt(i.disability.numberDays)>1&&(t=parseFloat(i.disability.employee.salary)/30*(parseInt(i.disability.numberDays)-1),i.disability.amountPaid=Math.round(100*t)/100);var a=0;null!=i.disability.category&&"Incapacidad"==i.disability.category.value&&null!=i.disability.employee&&""!=i.disability.employee.salary&&""!=i.disability.numberDays&&(null===i.disability.cause||"EG"!=i.disability.cause.value&&"LM"!=i.disability.cause.value||null!=i.disability.type&&"Inicial"==i.disability.type.item&&(a=parseInt(i.disability.numberDays)>=2?parseFloat(i.disability.employee.salary)/30*2:parseFloat(i.disability.employee.salary)/30*parseInt(i.disability.numberDays))),Math.round(100*a)/100>0&&(i.disability.directCostTotal=Math.round(100*a)/100)}},P=function(){var t=i.disability.category?i.disability.category.value:null,e=i.disability.type?i.disability.type.value:null,a=i.disability.cause?i.disability.cause.value:null,n=i.disability.accidentType?i.disability.accidentType.value:null;i.disability.chargedDays=0,"Incapacidad"==t&&"Inicial"==e?"AT"!=a&&"AL"!=a||"M"!=n||(i.disability.chargedDays=v):"Incapacidad"==t&&"Sin Incapacidad"==e&&("AT"!=a&&"AL"!=a||"M"!=n||(i.disability.chargedDays=v))},A=function(){i.isDisabilityParentEnable=!i.isView&&i.disability.type&&("Prorroga"==i.disability.type.value||"Sin Incapacidad"==i.disability.type.value&&null!=i.disability.accidentType&&"M"==i.disability.accidentType.value)&&null!=i.disability.cause,i.isDisabilityParentRequired=!i.isView&&i.disability.type&&("Prorroga"==i.disability.type.value||"Sin Incapacidad"==i.disability.type.value&&null!=i.disability.accidentType&&"M"==i.disability.accidentType.value&&null!=i.disability.cause&&"ELC"==i.disability.cause.value)&&null!=i.disability.cause};i.onSelectCategory=function(){null!=i.disability.category&&"Incapacidad"!=i.disability.category.value?(i.disability.type=null,i.disability.cause=null,i.causes=i.causeListAdmin):(i.disability.isHour=!1,i.causes=i.causeList),i.onChangeIsHour(),L(),P()},i.onSelectType=function(){i.disability.accidentType=null,i.disability.disabilityParent=null,i.onChangeStartDate(),O(),L(),P(),A()},i.onSelectCause=function(){i.disability.accidentType=null,i.disability.disabilityParent=null,O(),L(),P(),A()},i.onSelectAccidentType=function(){P(),A()},i.onChangeIsHour=function(){i.disability.isHour?i.disability.numberDays=0:(S(),L())},i.$watch("disability.numberDays",function(){L()}),i.$watch("disability.indirectCost",function(){if(null!=i.disability.indirectCost&&i.disability.indirectCost.length>0){var t=0;angular.forEach(i.disability.indirectCost,function(i,e){null!=i.concept&&""!=i.amount&&angular.isNumber(parseFloat(i.amount))&&(t+=parseFloat(i.amount))}),i.disability.indirectCostTotal=t}else i.disability.indirectCostTotal=0},!0),i.master=i.disability,i.form={submit:function(t){var e=null;if(t.$invalid){var a=null,e=null;for(a in t)"$"!=a[0]&&(null!==e||t[a].$valid||(e=t[a].$name),t[a].$pristine&&(t[a].$dirty=!0));return g.info(i.disability),angular.element(".ng-invalid[name="+e+"]").focus(),void r.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}E()},reset:function(i){}};var E=function(){var t={},a=JSON.stringify(i.disability);return t.data=Base64.encode(a),s({method:"POST",url:"api/absenteeism-disability/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){l(function(){r.swal("Registro","La información ha sido guardada satisfactoriamente","success"),i.disability=t.data.result,I(),_(i.disability.disabilityParent?i.disability.disabilityParent.id:i.disability.id)})})["catch"](function(i){e.error(i),r.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})},_=function(i){return s({method:"POST",url:C+"api/v1/customer-absenteeism-notify",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param({id:i,customerId:t.customerId})}).then(function(i){})["catch"](function(i){})["finally"](function(){})};i.onAddIndirectCost=function(){null==i.disability.indirectCost&&(i.disability.indirectCost=[]),i.disability.indirectCost.push({id:0,customerDisabilityId:0,concept:null,amount:0})},i.onRemoveIndirectCost=function(t){r.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(n){n?l(function(){if(0==i.disability.indirectCost[t].id)i.disability.indirectCost.splice(t,1);else{var n={id:i.disability.indirectCost[t].id};s({method:"POST",url:"api/absenteeism-disability-indirect-cost/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(e){i.disability.indirectCost.splice(t,1)})["catch"](function(i){e.error(i),a.pop("error","Error","Error guardando el registro. Por favor verifique los datos ingresados!")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})},i.onAddEmployee=function(){var t=u.open({templateUrl:o.app.views.urlRoot+"modules/customer/occupational/absenteeism/disability/customer_absenteeism_disability_employee_modal.htm",placement:"right",windowTopClass:"top-modal",size:"lg",backdrop:!0,controller:"ModalInstanceSideDisabilityEmployeeCtrl",scope:i});t.result.then(function(){},function(){})},i.onAddDisabilityDiagnostic=function(){var t=u.open({templateUrl:o.app.views.urlRoot+"modules/customer/occupational/absenteeism/disability/customer_absenteeism_disability_diagnostic_modal.htm",placement:"right",windowTopClass:"top-modal",size:"lg",backdrop:!0,controller:"ModalInstanceSideDisabilityDiagnosticListCtrl",scope:i});t.result.then(function(t){var e=c("filter")(i.diagnostics,{id:t.id});0==e.length&&i.diagnostics.push(t),i.disability.diagnostic=t},function(){})},i.onAddDisabilityParent=function(){var t=u.open({templateUrl:o.app.views.urlRoot+"modules/common/modals/data_table_list_modal.htm",placement:"right",windowTopClass:"top-modal",size:"lg",backdrop:!0,controller:"ModalInstanceSideDisabilityParentCtrl",resolve:{entity:function(){return{cause:i.disability.cause.value,customerEmployeeId:i.disability.employee.id}}}});t.result.then(function(t){i.disability.disabilityParent=t},function(){})},i.onAddDisabilityEmployeeList=function(){var t=u.open({templateUrl:o.app.views.urlRoot+"modules/customer/occupational/absenteeism/disability/customer_absenteeism_disability_employee_list_modal.htm",placement:"right",windowTopClass:"top-modal",size:"lg",backdrop:!0,controller:"ModalInstanceSideDisabilityEmployeeListCtrl",scope:i});t.result.then(function(t){var e=c("filter")(i.employees,{id:t.id});0==e.length&&i.employees.push(t),i.disability.workplace=t.workPlace,i.disability.employee=t},function(){})},i.onAddDaysCharged=function(){var t=u.open({templateUrl:o.app.views.urlRoot+"modules/common/modals/data_table_list_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideDisabilityDaysChargedCtrl",scope:i,resolve:{entity:function(){return{id:i.disability.id}},isView:function(){return!1}}});t.result.then(function(t){i.reloadData()},function(){e.info("Modal dismissed at: "+new Date),i.reloadData()})},i.onCancel=function(){d.scrollTop(40,2e3),null!=i.$parent&&i.$parent.navToSection("list","list")},i.dtOptionsCustomerAbsenteeismDisabilityDayCharged=f.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.isDeleted=!1,t.customerDisabilityId=i.disability.id,JSON.stringify(t)},dataSrc:function(t){return l(function(){"AL"!=i.disability.cause.value&&"AT"!=i.disability.cause.value||(i.disability.chargedDays=t.extra?t.extra:0)}),t.data},url:"api/customer-absenteeism-disability-day-charged",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){M()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,e,a){h(angular.element(t).contents())(i)}),i.dtColumnsCustomerAbsenteeismDisabilityDayCharged=[b.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(i,t,e,a){var n="",o='<a class="btn btn-danger btn-xs delRow lnk" href="#" tooltip="Eliminar registro" data-id="'+i.id+'" >   <i class="fa fa-trash-o"></i></a> ';return n+=o}),b.newColumn("type").withTitle("Incapacidad Permanente").withOption("width",200).withOption("defaultContent","").notSortable(),b.newColumn("classification").withTitle("Classificación de la Lesión").withOption("defaultContent","").notSortable(),b.newColumn("part").withTitle("Parte del Cuerpo").withOption("defaultContent","").notSortable(),b.newColumn("value").withTitle("Días").withOption("defaultContent","").notSortable()];var M=function(){angular.element("#dtCustomerAbsenteeismDisabilityDayCharged a.delRow").on("click",function(){var t=angular.element(this).data("id");r.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(e){if(e){var a={};a.id=t,s({method:"POST",url:"api/customer-absenteeism-disability-day-charged/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(i){swal("Eliminado","Regitro eliminado satisfactoriamente","info")})["catch"](function(i){r.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro por favor intentelo de nuevo","error")})["finally"](function(){i.reloadData()})}else swal("Cancelado","Operacion cancelada","error")})})};i.dtInstanceCustomerAbsenteeismDisabilityDayChargedCallback=function(t){i.dtInstanceCustomerAbsenteeismDisabilityDayCharged=t},i.reloadData=function(){null!=i.dtInstanceCustomerAbsenteeismDisabilityDayCharged&&i.dtInstanceCustomerAbsenteeismDisabilityDayCharged.reloadData(null,!1)},i.onSaveDayCharged=function(t){y.start({referenceId:"data-table-list-modal"});var e={id:0,customerDisabilityId:i.disability.id,configDayChargedPart:t},n={},o=JSON.stringify(e);return n.data=Base64.encode(o),m(function(t,e){s({method:"POST",url:"api/customer-absenteeism-disability-day-charged/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(e){l(function(){a.pop("success","Operación Exitosa","El registro se guardo satisfactoriamente."),i.reloadData(),y.stop({referenceId:"data-table-list-modal"}),t(e)})})["catch"](function(i){a.pop("error","Error",i.data.message),y.stop({referenceId:"data-table-list-modal"}),e(i)})["finally"](function(){})})}}]),app.controller("ModalInstanceSideDisabilityEmployeeCtrl",["$rootScope","$stateParams","$scope","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile",function(i,t,e,a,n,o,l,s,r,d,c,u,p,y){e.contractTypes=i.parameters("employee_contract_type"),e.documentTypes=i.parameters("employee_document_type");var m=function(){e.employee={id:0,customerId:t.customerId,isActive:!0,contractType:null,job:null,workPlace:null,salary:0,entity:{id:0,documentType:null,documentNumber:"",firstName:"",lastName:"",isActive:!0}}};m();var b=function(){var i={};return i.operation="diagnostic",i.customerId=t.customerId,s({method:"POST",url:"api/customer/config-sgsst/workplace/listProcess",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(i){o(function(){e.workPlaces=i.data.data})})["catch"](function(i){})["finally"](function(){})};b();var f=function(){if(null!=e.employee.workPlace){var i={};return i.operation="diagnostic",i.customerId=t.customerId,i.workPlaceId=e.employee.workPlace.id,s({method:"POST",url:"api/customer/config-sgsst/job/listByWorkPlace",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(i){o(function(){e.jobs=i.data.data})})["catch"](function(i){})["finally"](function(){})}e.jobs=[]};e.$watch("employee.workPlace",function(){f()}),e.onCloseModal=function(){a.close(1)},e.onCancelEmployee=function(){a.dismiss("cancel")},e.form={submit:function(i){var t=null;if(i.$invalid){var a=null,t=null;for(a in i)"$"!=a[0]&&(null!==t||i[a].$valid||(t=i[a].$name),i[a].$pristine&&(i[a].$dirty=!0));return angular.element(".ng-invalid[name="+t+"]").focus(),void o(function(){r.pop("error","Error","Por favor verifique los datos requeridos del formulario y vuelva a intentarlo")},500)}e.onSaveEmployee()},reset:function(i){i.$setPristine(!0)}},e.onSaveEmployee=function(){var i={},t=JSON.stringify(e.employee);return i.data=Base64.encode(t),s({method:"POST",url:"api/customer-employee/quickSave",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(i){o(function(){e.attachment=i.data.result,r.pop("success","Operación Exitosa","Registro eliminado"),e.onCloseModal()})})["catch"](function(i){n.error(i),r.pop("error","Error","Por favor ingrese los campos requeridos.")})["finally"](function(){})}}]),app.controller("ModalInstanceSideDisabilityDiagnosticListCtrl",["$rootScope","$stateParams","$scope","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile",function(i,t,e,a,n,o,l,s,r,d,c,u,p,y){e.diagnostic={id:0,code:"",description:"",isActive:!0},e.onCloseModal=function(){a.close(e.diagnostic)},e.onCancel=function(){a.dismiss("cancel")},e.onLoadRecord=function(){if(0!=e.diagnostic.id){var i={id:e.diagnostic.id};s({method:"GET",url:"api/disability-diagnostic",params:i})["catch"](function(i,t){if(403==t){var e=null!==i.message&&void 0!==i.message?i.message:"app.clientes.list";l.swal("No Autorizado","No estas autorizado para ver esta información.","error"),o(function(){$state.go(e)},3e3)}else 404==t?l.swal("Información no disponible","Diagnóstico no encontrado","error"):l.swal("Error","Se ha presentado un error al intentar acceder a la información del proceso","error")}).then(function(i){o(function(){e.diagnostic=i.data.result})})["finally"](function(){o(function(){e.onCloseModal()},400)})}else e.loading=!1},e.dtInstanceDisabilityDiagnosticList={},e.dtOptionsDisabilityDiagnosticList=p.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(i){return JSON.stringify(i)},url:"api/disability-diagnostic",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[1,"asc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){m()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(i,t,a){y(angular.element(i).contents())(e)}),e.dtColumnsDisabilityDiagnosticList=[u.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(i,t,e,a){var n="",o="",l='<a class="btn btn-success btn-xs editRow lnk" href="#" uib-tooltip="Adicionar diagnóstico"  data-id="'+i.id+'"'+o+' >   <i class="fa fa-plus-square"></i></a> ';return n+=l}),u.newColumn("code").withTitle("Código").withOption("width",200),u.newColumn("description").withTitle("Diagnóstico"),u.newColumn(null).withTitle("Estado").withOption("width",200).renderWith(function(i,t,e,a){var n="label label-danger";null==i.isActive&&void 0==i.isActive||(n=i.isActive?"label label-success":"label label-danger");var o='<span class="'+n+'">'+i.status+"</span>";return o})];var m=function(){angular.element("#dtDisabilityDiagnosticList a.editRow").on("click",function(){var i=angular.element(this).data("id");e.editDisabilityDiagnostic(i)})};e.reloadData=function(){e.dtInstanceDisabilityDiagnostic.reloadData()},e.viewDisabilityDiagnostic=function(i){e.diagnostic.id=i,e.isView=!0,e.onLoadRecord()},e.editDisabilityDiagnostic=function(i){e.diagnostic.id=i,e.isView=!1,e.onLoadRecord()}}]),app.controller("ModalInstanceSideDisabilityEmployeeListCtrl",["$rootScope","$stateParams","$scope","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile",function(i,t,e,a,n,o,l,s,r,d,c,u,p,y){e.employee={id:0},e.onCloseModal=function(){a.close(e.employee)},e.onCancel=function(){a.dismiss("cancel")},e.onLoadRecord=function(){if(0!=e.employee.id){var i={id:e.employee.id};s({method:"GET",url:"api/customer-employee",params:i})["catch"](function(i,t){if(403==t){var e=null!==i.message&&void 0!==i.message?i.message:"app.clientes.list";l.swal("No Autorizado","No estas autorizado para ver esta información.","error"),o(function(){$state.go(e)},3e3)}else 404==t?l.swal("Información no disponible","Diagnóstico no encontrado","error"):l.swal("Error","Se ha presentado un error al intentar acceder a la información del proceso","error")}).then(function(i){console.log(i),o(function(){e.employee=i.data.result})})["finally"](function(){o(function(){e.onCloseModal()},400)})}else e.loading=!1},e.dtInstanceDisabilityEmployeeList={},e.dtOptionsDisabilityEmployeeList=p.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(i){return i.customerId=t.customerId,JSON.stringify(i)},url:"api/customer-employee-modal-basic",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){m()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(i,t,a){y(angular.element(i).contents())(e)}),e.dtColumnsDisabilityEmployeeList=[u.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(i,t,e,a){var n="",o="",l='<a class="btn btn-success btn-xs editRow lnk" href="#" uib-tooltip="Adicionar empleado" tooltip-placement="right"  data-id="'+i.id+'"'+o+' >   <i class="fa fa-plus-square"></i></a> ';return n+=l}),u.newColumn("documentNumber").withTitle("Número Identificación").withOption("width",200),u.newColumn("firstName").withTitle("Nombre").withOption("width",200),u.newColumn("lastName").withTitle("Apellidos").withOption("width",200),u.newColumn("workPlace").withTitle("Centro de Trabajo").withOption("width",200),u.newColumn("job").withTitle("Cargo").withOption("width",200),u.newColumn("neighborhood").withTitle("Centro de Costos").withOption("width",200),u.newColumn(null).withTitle("Estado").withOption("width",200).renderWith(function(i,t,e,a){var n="label label-danger",o="Inactivo";null==i.isActiveCode&&void 0==i.isActiveCode||("Activo"==i.isActiveCode?(n="label label-success",o="Activo"):(n="label label-danger",o="Inactivo"));var l='<span class="'+n+'">'+o+"</span>";return l}),u.newColumn(null).withTitle("Autorización").withOption("width",200).renderWith(function(i,t,e,a){var n="label label-danger",o="Inactivo";null==i.isAuthorized&&void 0==i.isAuthorized||("Autorizado"==i.isAuthorized?(n="label label-success",o="Autorizado"):"No Autorizado"==i.isAuthorized?(n="label label-danger",o="No Autorizado"):(n="label label-info",o="N/A"));var l='<span class="'+n+'">'+o+"</span>";return l})];var m=function(){angular.element("#dtDisabilityEmployeeList a.editRow").on("click",function(){var i=angular.element(this).data("id");e.editDisabilityEmployee(i)})};e.reloadData=function(){e.dtInstanceDisabilityEmployeeList.reloadData()},e.viewDisabilityEmployee=function(i){e.employee.id=i,e.isView=!0,e.onLoadRecord()},e.editDisabilityEmployee=function(i){e.employee.id=i,e.isView=!1,e.onLoadRecord()}}]),app.controller("ModalInstanceSideDisabilityDaysChargedCtrl",["$rootScope","$stateParams","$scope","entity","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile","bsLoadingOverlayService",function(i,t,e,a,n,o,l,s,r,d,c,u,p,y,m,b){e.title="DÍAS CARGADOS",e.loadingOverlayTemplateUrl=i.app.themeRootUrl+"templates/loading-overlay-element-template.htm",e.onCloseModal=function(){n.close(null)},e.onCancel=function(){n.dismiss("cancel")},e.dtOptionsCommonDataTableList=y.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(i){return i.isDeleted=!1,i.customerDisabilityId=a.id,JSON.stringify(i)},url:"api/customer-absenteeism-disability-day-charged-available",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){f()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(i,t,a){m(angular.element(i).contents())(e)}),e.dtColumnsCommonDataTableList=[p.newColumn(null).withTitle("Acciones").withOption("width",80).notSortable().renderWith(function(i,t,e,a){var n="",o="",l='<a class="btn btn-success btn-xs editRow lnk" href="#" uib-tooltip="Adicionar item"  data-id="'+i.id+'"'+o+' >   <i class="fa fa-plus-square"></i></a> ';return n+=l}),p.newColumn("type").withTitle("Incapacidad Permanente").withOption("width",200).withOption("defaultContent","").notSortable(),p.newColumn("classification").withTitle("Classificación de la Lesión").withOption("defaultContent","").notSortable(),p.newColumn("part").withTitle("Parte del Cuerpo").withOption("defaultContent","").notSortable(),p.newColumn("value").withTitle("Días").withOption("defaultContent","").notSortable()];var f=function(){angular.element("#dtCommonDataTableList a.editRow").on("click",function(){var i=angular.element(this).data("id");l(function(){b.stop({referenceId:"data-table-list-modal"}),e.onSaveDayCharged({id:i}).then(function(i){e.reloadData()},function(i){})["finally"](function(){})})})};e.dtInstanceCommonDataTableListCallback=function(i){e.dtInstanceCommonDataTableList=i},e.reloadData=function(){e.dtInstanceCommonDataTableList.reloadData(null,!1)}}]),app.controller("ModalInstanceSideDisabilityParentCtrl",["$rootScope","$stateParams","$scope","entity","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile","bsLoadingOverlayService",function(i,t,e,a,n,o,l,s,r,d,c,u,p,y,m,b){e.title="AUSENTISMOS INICIALES",e.loadingOverlayTemplateUrl=i.app.themeRootUrl+"templates/loading-overlay-element-template.htm",e.onCloseModal=function(){n.close(null)},e.onCancel=function(){n.dismiss("cancel")},e.dtOptionsCommonDataTableList=y.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(i){return i.customerId=t.customerId,i.typeValue="Inicial",i.causeValue=a.cause,i.customerEmployeeId=a.customerEmployeeId,JSON.stringify(i)},url:"api/customer-absenteeism-disability-related",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){f()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(i,t,a){m(angular.element(i).contents())(e)}),e.dtColumnsCommonDataTableList=[p.newColumn(null).withTitle("Acciones").withOption("width",80).notSortable().renderWith(function(i,t,e,a){var n="",o='<a class="btn btn-success btn-xs editRow lnk" href="#" uib-tooltip="Adicionar item"  data-id="'+i.id+'" data-cause="'+i.causeItem+'" data-date="'+i.startDateFormat+'" >   <i class="fa fa-plus-square"></i></a> ';return n+=o}),p.newColumn("causeItem").withTitle("Causa Incapacidad").withOption("width",200).withOption("defaultContent",""),p.newColumn("startDateFormat").withTitle("F Inicial").withOption("width",200).withOption("defaultContent",""),p.newColumn("endDateFormat").withTitle("F Final").withOption("width",180).withOption("defaultContent","")];var f=function(){angular.element("#dtCommonDataTableList a.editRow").on("click",function(){var i=angular.element(this).data("id"),t=angular.element(this).data("cause"),e=angular.element(this).data("date");n.close({id:i,name:e+" | "+t})})};e.dtInstanceCommonDataTableListCallback=function(i){e.dtInstanceCommonDataTableList=i},e.reloadData=function(){e.dtInstanceCommonDataTableList.reloadData(null,!1)}}]);
"use strict";app.controller("customerAbsenteeismDisabilitySummaryCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$document","$filter","$aside","ListService","ChartService",function(e,t,a,n,i,r,l,s,o,u,c,d,f,m,C,p,h,y){function w(){var a=e.filter.yearList.filter(function(e){return null!=e&&null!=e.value}).map(function(e,t,a){return e.value.value});void 0!==a&&null!==a||(a=[]),a.push(e.filter.selectedChartYear?e.filter.selectedChartYear.value:0);var n={customerId:t.customerId,cause:e.filter.selectedChartCause,year:e.filter.selectedChartYear?e.filter.selectedChartYear.value:0,yearList:a},i=[{name:"chart_line_options",criteria:null},{name:"customer_absenteeism_disability_general_event",criteria:n}];y.getDataChart(i).then(function(t){e.chart.line.options=t.data.data.chartLineOptions,e.chart.months.data=t.data.data.customerAbsenteeismDisabilityGeneralEvent},function(e){})}function b(){var a=[{name:"absenteeism_disability_causes_full"},{name:"current_year"},{name:"absenteeism_disability_causes_years",value:t.customerId}];h.getDataList(a).then(function(t){e.causes=t.data.data.absenteeism_disability_causes_full,e.yearsCause=t.data.data.absenteeism_disability_causes_years,e.years=t.data.data.absenteeism_disability_causes_years;var a=t.data.data.currentYear,n=C("filter")(e.years,{value:a});e.filter.selectedChartYear=n.length?n[0]:null,_(),w()},function(t){e.status="Unable to load customer data: "+t.message})}e.filter={canCompare:!1,selectedCause:null,selectedYear:null,selectedChartCause:null,selectedChartYear:null,yearList:[]},e.compareYearList=[],e.chart={line:{options:null},months:{data:null}},b(),e.dtInstanceSummaryCause={},e.dtOptionsSummaryCause=n.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(a){return a.operation="absenteeism",a.customerId=t.customerId,a.cause=e.filter.selectedCause?e.filter.selectedCause.item:"",a.period=e.filter.selectedYear?e.filter.selectedYear.item:"",JSON.stringify(a)},url:"api/customer-absenteeism-disability-sumary",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,a,n){l(angular.element(t).contents())(e)}),e.dtColumnsSummaryCause=[i.newColumn("cause").withTitle("Causa").withOption("defaultContent",""),i.newColumn("quantity").withTitle("Cantidad").withOption("defaultContent",""),i.newColumn("period").withTitle("Periodo").withOption("defaultContent",""),i.newColumn("type").withTitle("Tipo Contracto").withOption("defaultContent","")],e.dtInstanceSummaryCauseCallback=function(t){e.dtInstanceSummaryCause=t},e.reloadData=function(t){e.dtInstanceSummaryCause.reloadData()},e.onSelecCause=function(t,a){c(function(){e.reloadData()})},e.onClearCause=function(){c(function(){e.filter.selectedCause=null,e.reloadData()})},e.onSelecChartCause=function(e,t){c(function(){w()})},e.onClearChartCause=function(){c(function(){e.filter.selectedChartCause=null,w()})},e.onSelectYear=function(t,a){c(function(){e.reloadData()})},e.onClearYear=function(){c(function(){e.filter.selectedYear=null,e.reloadData()})},e.onSelectChartYear=function(e,t){_(),w()},e.onChangeCompare=function(){},e.onAddCompareYear=function(){e.filter.yearList.push({})},e.onRemoveCompareYear=function(t){e.filter.yearList.splice(t,1),w()};var _=function(){e.compareYearList=e.years.filter(function(t){return t.value!=(e.filter.selectedChartYear?e.filter.selectedChartYear.value:0)})}}]);
"use strict";app.controller("customerAbsenteeismIndicatorsCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$document","$filter",function(e,i,t,n,a,o,r,d,s,c,l,u,f,m,p){var w=t,h={};w.info("loading..customerAbsenteeismIndicatorsCtrl "),e.classifications=c.parameters("absenteeism_disability_classification"),e.periods=c.parameters("absenteeism_indicator_period"),e.workplaces=[],e.indicator={id:0,customerId:i.customerId,classification:null,period:null,workCenter:null,manHoursWorked:0,population:0,directCost:0,eventNumber:0,targetEvent:0,diseaseRate:0,diseaseRateFormat:0,disabilityDays:0,targetDisabilityDays:0,targetFrequency:0,targetFrequencyIndex:0,frequencyIndex:0,frequencyIndexFormat:0,targetSeverity:0,targetSeverityIndex:0,severityIndex:0,severityIndexFormat:0,targetWorkAccident:0,disablingInjuriesIndex:0,disablingInjuriesIndexFormat:0};var b=function(){e.indicator.population>0&&(e.indicator.diseaseRate=e.indicator.eventNumber/e.indicator.population),e.indicator.diseaseRateFormat=p("number")(100*parseFloat(e.indicator.diseaseRate),2)+"%"},y=function(){e.indicator.manHoursWorked>0&&(e.indicator.frequencyIndex=2e4*parseFloat(e.indicator.eventNumber)/parseFloat(e.indicator.manHoursWorked)),e.indicator.frequencyIndexFormat=p("number")(e.indicator.frequencyIndex,2)},I=function(){e.indicator.manHoursWorked>0&&(e.indicator.severityIndex=2e4*parseFloat(e.indicator.disabilityDays)/parseFloat(e.indicator.manHoursWorked)),e.indicator.severityIndexFormat=p("number")(e.indicator.severityIndex,2)},v=function(){e.indicator.disablingInjuriesIndex=parseFloat(e.indicator.severityIndex)*parseFloat(e.indicator.frequencyIndex)/1e3,e.indicator.disablingInjuriesIndexFormat=p("number")(e.indicator.disablingInjuriesIndex,3)};e.$watch("indicator.eventNumber",function(){b(),y(),v()}),e.$watch("indicator.population",function(){b()}),e.$watch("indicator.manHoursWorked",function(){y(),I(),v()}),e.$watch("indicator.disabilityDays",function(){I(),v()}),e.onLoadRecord=function(){if(0!=e.indicator.id){w.info("editando cliente con código: "+e.disability.id);var i={id:e.disability.id};u({method:"GET",url:"api/absenteeism-indicator/get",params:i})["catch"](function(e,i){if(403==i){var t=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";f.swal("No Autorizado","No estas autorizado para ver esta informaci�n.","error"),l(function(){s.go(t)},3e3)}else 404==i?f.swal("Informaci�n no disponible","Centro de trabajo no encontrado","error"):f.swal("Error","Se ha presentado un error al intentar acceder a la informaci�n del centro de trabajo","error")}).then(function(i){l(function(){e.indicator=i.data.result,b(),y(),I(),v()})})["finally"](function(){l(function(){e.loading=!1},400),l(function(){m.scrollTop(40,2e3)})})}else w.info("creacion de nuevo cliente"),e.loading=!1},e.onLoadRecord(),e.master=e.disability,e.form={submit:function(i){var t=null;if(i.$invalid){var n=null,t=null;for(n in i)"$"!=n[0]&&(null!==t||i[n].$valid||(t=i[n].$name),i[n].$pristine&&(i[n].$dirty=!0));return w.info(e.disability),angular.element(".ng-invalid[name="+t+"]").focus(),void f.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}f.swal("Validación exitosa","Guardando información de indicador...","success"),g()},reset:function(i){e.clear()}},e.clear=function(){l(function(){e.indicator={id:0,customerId:i.customerId,classification:null,period:null,workCenter:null,manHoursWorked:0,population:0,directCost:0,eventNumber:0,targetEvent:0,diseaseRate:0,diseaseRateFormat:0,disabilityDays:0,targetDisabilityDays:0,targetFrequency:0,targetFrequencyIndex:0,frequencyIndex:0,frequencyIndexFormat:0,targetSeverity:0,targetSeverityIndex:0,severityIndex:0,severityIndexFormat:0,targetWorkAccident:0,disablingInjuriesIndex:0,disablingInjuriesIndexFormat:0}}),e.isView=!1};var g=function(){var i={},n=JSON.stringify(e.indicator);return i.data=Base64.encode(n),u({method:"POST",url:"api/absenteeism-indicator/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(i){l(function(){e.indicator=i.data.result,e.reloadData()})})["catch"](function(e){t.error(e),f.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){e.clear()})};h.operation="absenteeism",h.customer_id=i.customerId,e.dtInstanceIndicators={},e.dtOptionsIndicators=n.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:h,url:"api/absenteeism-indicator",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){x()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(i,t,n){r(angular.element(i).contents())(e)}),e.dtColumnsIndicators=[a.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,i,t,n){var a="",o="",r='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar"  data-id="'+e.id+'"'+o+' >   <i class="fa fa-edit"></i></a> ',d='<a class="btn btn-info btn-xs viewRow lnk" href="#"  uib-tooltip="Ver" data-id="'+e.id+'" >   <i class="fa fa-eye"></i></a> ',s='<a class="btn btn-danger btn-xs delRow lnk" href="#"  uib-tooltip="Eliminar" data-id="'+e.id+'"'+o+' >   <i class="fa fa-trash-o"></i></a> ';return c.can("clientes_view")&&(a+=d),c.can("clientes_edit")&&(a+=r),c.can("clientes_delete")&&(a+=s),a}),a.newColumn("classification.item").withTitle("Clasificación").withOption("width",200),a.newColumn("period.item").withTitle("Periodo").withOption("width",200),a.newColumn("workCenter.item").withTitle("Centro de trabajo").withOption("width",200),a.newColumn("diseaseRate").withTitle("% Tasa de Enf / AL").withOption("width",200),a.newColumn("frequencyIndex").withTitle("(IF)").withOption("width",200),a.newColumn("severityIndex").withTitle("(IS)").withOption("width",200),a.newColumn("disablingInjuriesIndex").withTitle("(ILI)").withOption("width",200)],e.viewDiagnosticWorkPlace=function(i){e.disability.id=i,e.isView=!0,e.onLoadRecord()},e.cancelEdition=function(i){null!=e.$parent&&e.$parent.navToSection("summary","summary",e.absenteeism_id)};var x=function(){$("#dataTableIndicators a.editRow").on("click",function(){var i=$(this).data("id");e.editDiagnosticWorkPlace(i)}),$("#dataTableIndicators a.viewRow").on("click",function(){var i=$(this).data("id");e.disability.id=i,e.viewDiagnosticWorkPlace(i)}),$("#dataTableIndicators a.delRow").on("click",function(){var i=$(this).data("id");w.info("intenta eliminar el registro: "+i),f.swal({title:"Está seguro?",text:"Eliminar�s el centro de trabajo seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(n){if(n){var a={};a.id=i,u({method:"POST",url:"api/absenteeism-indicator/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){t.error(e),f.swal("Error en la eliminaci�n","Se ha presentado un error durante la eliminaci�n del registro por favor intentelo de nuevo","error")})["finally"](function(){e.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};e.reloadData=function(){e.dtInstanceIndicators.reloadData()},e.editDiagnosticWorkPlace=function(i){e.indicator.id=i,e.isView=!1,e.onLoadRecord()};var C=function(){var n={};n.customer_id=i.customerId,u({method:"POST",url:"api/absenteeism-indicator/list",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(i){l(function(){e.workplaces=i.data.result})})["catch"](function(e){t.error(e),f.swal("Error Cargando Reportes","Se ha presentado un error durante la consulta de los reportes para el diagnóstico por favor intentelo de nuevo","error")})["finally"](function(){})};C()}]);
"use strict";app.controller("customerAbsenteeismAnalysisTabsCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","SweetAlert","$rootScope","$http","$timeout","$uibModal","flowFactory","cfpLoadingBar","$document","$filter","$aside","FileUploader",function(e,t,o,s,a,i,n,l,u,r,c,m,p,b,$,d,f,w,_,y){e.views=[{name:"resolution_1111",url:c.app.views.urlRoot+"modules/customer/occupational/absenteeism/analysis/1111/customer_absenteeism_analysis.htm"},{name:"resolution_0312",url:c.app.views.urlRoot+"modules/customer/occupational/absenteeism/analysis/0312/customer_absenteeism_analysis.htm"}],e.loading=!1,e.tabname="resolution_1111",e.getView=function(t){var o=w("filter")(e.views,{name:t});return o[0]},e.switchTab=function(t){p(function(){e.tabname=t})},e.switchSubTab=function(t){p(function(){e.subtab=t})}}]);
"use strict";app.controller("customerAbsenteeismAnalysisResolution1111Ctrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$document","$filter","$aside","ListService","ChartService",function(t,i,n,e,a,o,r,s,l,c,d,u,p,w,m,f,h,I){function b(){var n={customerId:i.customerId,year:t.indicator.period?t.indicator.period.value:0,workPlace:t.indicator.workCenter?t.indicator.workCenter.value:null,classification:t.indicator.classification?t.indicator.classification.value:null,resolution:"1111"},e=[{name:"chart_line_options",criteria:null},{name:"customer_absenteeism_indicator",criteria:n}];I.getDataChart(e).then(function(i){t.chart.line.options=i.data.data.chartLineOptions,t.chart.eventNumber.data=i.data.data.customerAbsenteeismIndicatorEventNumber,t.chart.disabilityDays.data=i.data.data.customerAbsenteeismIndicatorDisabilityDays,t.chart.IF.data=i.data.data.customerAbsenteeismIndicatorIF,t.chart.IS.data=i.data.data.customerAbsenteeismIndicatorIS,t.chart.ILI.data=i.data.data.customerAbsenteeismIndicatorILI},function(t){})}function O(){var n=[{name:"absenteeism_disability_indicator_years",value:i.customerId},{name:"absenteeism_disability_indicator_workplaces",value:i.customerId}];h.getDataList(n).then(function(i){t.periods=i.data.data.absenteeism_disability_indicator_years,t.workplaces=i.data.data.absenteeism_disability_indicator_workplaces,t.indicator.period=t.periods.length>0?t.periods[0]:null,t.isLoaded=!0,b()},function(i){t.status="Unable to load customer data: "+i.message})}var g={};t.isLoaded=!1,t.classifications=c.parameters("absenteeism_disability_classification"),t.chart={line:{options:null},eventNumber:{data:null},disabilityDays:{data:null},IF:{data:null},IS:{data:null},ILI:{data:null}},O(),t.indicator={classification:null,period:null,workCenter:null},g.operation="absenteeism",g.customer_id=i.customerId,t.dtInstanceIndicators={},t.dtOptionsIndicators=e.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.customerId=i.customerId,JSON.stringify(t)},url:"api/customer-absenteeism-indicator",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[2,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){v()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(i,n,e){r(angular.element(i).contents())(t)}),t.dtColumnsIndicators=[a.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,i,n,e){var a="",o="",r='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar"  data-id="'+t.id+'"'+o+' >   <i class="fa fa-edit"></i></a> ';return a+=r}),a.newColumn("classification").withTitle("Clasificación").withOption("width",200),a.newColumn("period").withTitle("Periodo").withOption("width",200),a.newColumn("name").withTitle("Centro de trabajo").withOption("width",200),a.newColumn("manHoursWorked").withTitle("(HHT)").withOption("width",200),a.newColumn("disabilityDays").withTitle("Días incapacitantes)").withOption("width",200),a.newColumn("eventNumber").withTitle("Eventos").withOption("width",200),a.newColumn("directCost").withTitle("Costo Directo").withOption("width",200),a.newColumn("indirectCost").withTitle("Costo Indirecto").withOption("width",200),a.newColumn("diseaseRate").withTitle("% Tasa de Enf / AL").withOption("width",200),a.newColumn("frequencyIndex").withTitle("(IF)").withOption("width",200),a.newColumn("severityIndex").withTitle("(IS)").withOption("width",200),a.newColumn("disablingInjuriesIndex").withTitle("(ILI)").withOption("width",200)],t.viewDiagnosticWorkPlace=function(i){t.disability.id=i,t.isView=!0,t.onLoadRecord()},t.cancelEdition=function(i){null!=t.$parent&&t.$parent.navToSection("summary","summary",t.absenteeism_id)};var v=function(){angular.element("#dataTableIndicators a.editRow").on("click",function(){var i=angular.element(this).data("id"),n=f.open({templateUrl:c.app.views.urlRoot+"modules/customer/occupational/absenteeism/analysis/1111/customer_absenteeism_disability_indicator_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideDisabilityIndicatorCtrl",scope:t,resolve:{indicator:function(){return{id:i}}}});n.result.then(function(){t.reloadDataIndicator()},function(){})})};t.reloadDataIndicator=function(){t.dtInstanceIndicators.reloadData()},t.onConsolidate=function(){var e={};e.id=i.customerId,u({method:"POST",url:"api/customer-absenteeism-indicator/consolidate-1111",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(t){swal("Consolidación","La Matriz de indicadores se ha consolidado satisfactoriamente","info")})["catch"](function(t){n.error(t),p.swal("Error en la Consolidación�n","Se ha presentado un error durante la Consolidación de la matriz por favor intentelo de nuevo","error")})["finally"](function(){t.reloadDataIndicator()})},t.dtOptionsEventNumber=e.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(n){return n.operation="absenteeism",n.customer_id=i.customerId,n.workCenter=t.indicator.workCenter?t.indicator.workCenter.value:"",n.year=t.indicator.period?t.indicator.period.value:0,n.classification=t.indicator.classification?t.indicator.classification.value:"",n.name="eventNumber",n},url:"api/absenteeism-indicator/report",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withOption("language",{}).withOption("bFilter",!1).withOption("paging",!1).withOption("createdRow",function(i,n,e){r(angular.element(i).contents())(t)}),t.dtColumnsEventNumber=[a.newColumn("item").withTitle("Mes").notSortable(),a.newColumn("eventNumber").withTitle("Nro Eventos").withOption("width",200).notSortable(),a.newColumn("targetEvent").withTitle("Meta").withOption("width",200).notSortable()],t.dtInstanceEventNumberCallback=function(i){t.dtInstanceEventNumber=i},t.dtInstanceDisabilityDays={},t.dtOptionsDisabilityDays=e.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(n){return n.operation="absenteeism",n.customer_id=i.customerId,n.workCenter=t.indicator.workCenter?t.indicator.workCenter.value:"",n.year=t.indicator.period?t.indicator.period.value:0,n.classification=t.indicator.classification?t.indicator.classification.value:"",n.name="disabilityDays",n},url:"api/absenteeism-indicator/report",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withOption("language",{}).withOption("bFilter",!1).withOption("paging",!1).withOption("createdRow",function(i,n,e){r(angular.element(i).contents())(t)}),t.dtColumnsDisabilityDays=[a.newColumn("item").withTitle("Mes").notSortable(),a.newColumn("disabilityDays").withTitle("Nro Días").withOption("width",200).notSortable(),a.newColumn("targetDisabilityDays").withTitle("Meta").withOption("width",200).notSortable()],t.dtInstanceDisabilityDaysCallback=function(i){t.dtInstanceDisabilityDays=i},t.dtInstanceIF={},t.dtOptionsIF=e.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(n){return n.operation="absenteeism",n.customer_id=i.customerId,n.workCenter=t.indicator.workCenter?t.indicator.workCenter.value:"",n.year=t.indicator.period?t.indicator.period.value:0,n.classification=t.indicator.classification?t.indicator.classification.value:"",n.name="IF",n},url:"api/absenteeism-indicator/report",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withOption("language",{}).withOption("bFilter",!1).withOption("paging",!1).withOption("createdRow",function(i,n,e){r(angular.element(i).contents())(t)}),t.dtColumnsIF=[a.newColumn("item").withTitle("Mes").notSortable(),a.newColumn("frequencyIndex").withTitle("IF").withOption("width",200).notSortable(),a.newColumn("targetFrequencyIndex").withTitle("Meta").withOption("width",200).notSortable()],t.dtInstanceIFCallback=function(i){t.dtInstanceIF=i},t.dtInstanceIS={},t.dtOptionsIS=e.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(n){return n.operation="absenteeism",n.customer_id=i.customerId,n.workCenter=t.indicator.workCenter?t.indicator.workCenter.value:"",n.year=t.indicator.period?t.indicator.period.value:0,n.classification=t.indicator.classification?t.indicator.classification.value:"",n.name="IS",n},url:"api/absenteeism-indicator/report",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withOption("language",{}).withOption("bFilter",!1).withOption("paging",!1).withOption("createdRow",function(i,n,e){r(angular.element(i).contents())(t)}),t.dtColumnsIS=[a.newColumn("item").withTitle("Mes").notSortable(),a.newColumn("severityIndex").withTitle("IS").withOption("width",200).notSortable(),a.newColumn("targetSeverityIndex").withTitle("Meta").withOption("width",200).notSortable()],t.dtInstanceISCallback=function(i){t.dtInstanceIS=i},t.dtInstanceILI={},t.dtOptionsILI=e.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(n){return n.operation="absenteeism",n.customer_id=i.customerId,n.workCenter=t.indicator.workCenter?t.indicator.workCenter.value:"",n.year=t.indicator.period?t.indicator.period.value:0,n.classification=t.indicator.classification?t.indicator.classification.value:"",n.name="ILI",n},url:"api/absenteeism-indicator/report",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withOption("language",{}).withOption("bFilter",!1).withOption("paging",!1).withOption("createdRow",function(i,n,e){r(angular.element(i).contents())(t)}),t.dtColumnsILI=[a.newColumn("item").withTitle("Mes").notSortable(),a.newColumn("disablingInjuriesIndex").withTitle("ILI").withOption("width",200).notSortable(),a.newColumn("targetWorkAccident").withTitle("Meta").withOption("width",200).notSortable()],t.dtInstanceILICallback=function(i){t.dtInstanceILI=i},t.onFilter=function(){C(),b()};var C=function(){t.dtInstanceEventNumber.reloadData(),t.dtInstanceDisabilityDays.reloadData(),t.dtInstanceIF.reloadData(),t.dtInstanceIS.reloadData(),t.dtInstanceILI.reloadData()};t.onClear=function(){t.indicator.classification=null,t.indicator.workCenter=null,t.indicator.period=t.periods.length>0?t.periods[0]:null,C(),b()},t.onCreateTarget=function(){var i=f.open({templateUrl:c.app.views.urlRoot+"modules/customer/occupational/absenteeism/analysis/1111/customer_absenteeism_disability_goal_modal.htm",placement:"left",size:"lg",backdrop:!0,controller:"ModalInstanceSideDisabilityGoalCtrl",scope:t});i.result.then(function(){t.reloadData()})}}]),app.controller("ModalInstanceSideDisabilityGoalCtrl",["$stateParams","$rootScope","$scope","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile",function(t,i,n,e,a,o,r,s,l,c,d,u,p,w){n.period=i.parameters("absenteeism_indicator_period"),n.period=c("orderBy")(n.period,"value",!0),n.indicator={id:0,customerId:t.customerId,period:null,targetIF:0,targetIS:0,targetILI:0,targetEvent:0,targetDay:0},n.disabledType=!1,n.onCloseModal=function(){e.close(1)},n.onCancel=function(){e.dismiss("cancel")},n.onReset=function(){n.indicator={id:0,customerId:t.customerId,period:null,targetIF:0,targetIS:0,targetILI:0,targetEvent:0,targetDay:0}},n.form={submit:function(t){var i=null;if(t.$invalid){var e=null,i=null;for(e in t)"$"!=e[0]&&(null!==i||t[e].$valid||(i=t[e].$name),t[e].$pristine&&(t[e].$dirty=!0));return angular.element(".ng-invalid[name="+i+"]").focus(),void r.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}n.onSave()},reset:function(t){}},n.onSave=function(){var t={},i=JSON.stringify(n.indicator);return t.data=Base64.encode(i),s({method:"POST",url:"api/absenteeism-indicator-target/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){o(function(){r.swal("Validación exitosa","El registro se guardó satisfactoriamente","success"),n.reloadData(),n.onReset()})})["catch"](function(t){a.error(t),r.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};var m={};m.operation="document",m.customer_id=n.indicator.customerId,n.dtInstanceGoalIndicator={},n.dtOptionsGoalIndicator=p.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:m,url:"api/absenteeism-indicator-target",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){f()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,i,e){w(angular.element(t).contents())(n)}),n.dtColumnsGoalIndicator=[u.newColumn(null).withTitle("Acciones").withOption("width",80).notSortable().renderWith(function(t,i,n,e){var a=(null!=t.document?t.document.path:"",""),o='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+t.id+'" >   <i class="fa fa-trash-o"></i></a> ';return a+=o}),u.newColumn("period.item").withTitle("Periodo").withOption("width",100),u.newColumn("targetEvent").withTitle("Meta Eventos"),u.newColumn("targetDay").withTitle("Meta Días Inc"),u.newColumn("targetIF").withTitle("Meta IF"),u.newColumn("targetIS").withTitle("Meta IS"),u.newColumn("targetILI").withTitle("Meta ILI")];var f=function(){angular.element("#dtDisabilityGoalIndicator a.delRow").on("click",function(){var t=angular.element(this).data("id");r.swal({title:"Está seguro?",text:"Anularás el anexo seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(i){if(i){var e={};e.id=t,s({method:"POST",url:"api/absenteeism-indicator-target/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){a.error(t),r.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){n.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};n.reloadData=function(){n.dtInstanceGoalIndicator.reloadData()}}]),app.controller("ModalInstanceSideDisabilityIndicatorCtrl",["$stateParams","$rootScope","$scope","$uibModalInstance","indicator","$log","$timeout","$document","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile",function(t,i,n,e,a,o,r,s,l,c,d,u,p,w,m,f){n.period=i.parameters("absenteeism_indicator_period"),n.indicator=a,n.disabledType=!1,n.onCloseModal=function(){e.close(1)},n.onCancel=function(){e.dismiss("cancel")},n.onReset=function(){n.indicator={id:0,customerId:t.customerId,period:null,targetIF:0,targetIS:0,targetILI:0,targetEvent:0,targetDay:0}},n.onLoadRecord=function(){if(0!=n.indicator.id){var t={id:n.indicator.id};c({method:"GET",url:"api/absenteeism-indicator",params:t})["catch"](function(t,i){if(403==i){var n=null!==t.message&&void 0!==t.message?t.message:"app.clientes.list";l.swal("No Autorizado","No estas autorizado para ver esta informaci�n.","error"),r(function(){$state.go(n)},3e3)}else 404==i?l.swal("Informaci�n no disponible","Centro de trabajo no encontrado","error"):l.swal("Error","Se ha presentado un error al intentar acceder a la informaci�n del centro de trabajo","error")}).then(function(t){r(function(){n.indicator=t.data.result})})["finally"](function(){r(function(){n.loading=!1},400),r(function(){s.scrollTop(40,2e3)})})}else log.info("creacion de nuevo cliente"),n.loading=!1};var h=function(){n.indicator.population>0&&(n.indicator.diseaseRate=n.indicator.eventNumber/n.indicator.population),n.indicator.diseaseRateFormat=u("number")(100*parseFloat(n.indicator.diseaseRate),2)+"%"},I=function(){n.indicator.manHoursWorked>0&&(n.indicator.frequencyIndex=2e4*parseFloat(n.indicator.eventNumber)/parseFloat(n.indicator.manHoursWorked)),n.indicator.frequencyIndexFormat=u("number")(n.indicator.frequencyIndex,2)},b=function(){n.indicator.manHoursWorked>0&&(n.indicator.severityIndex=2e4*parseFloat(n.indicator.disabilityDays)/parseFloat(n.indicator.manHoursWorked)),n.indicator.severityIndexFormat=u("number")(n.indicator.severityIndex,2)},O=function(){n.indicator.disablingInjuriesIndex=parseFloat(n.indicator.severityIndex)*parseFloat(n.indicator.frequencyIndex)/1e3,n.indicator.disablingInjuriesIndexFormat=u("number")(n.indicator.disablingInjuriesIndex,3)};n.$watch("indicator.eventNumber",function(){h(),I(),O()}),n.$watch("indicator.population",function(){h()}),n.$watch("indicator.manHoursWorked",function(){I(),b(),O()}),n.$watch("indicator.disabilityDays",function(){b(),O()}),n.onLoadRecord(),n.master=n.indicator,n.form={submit:function(t){var i=null;if(t.$invalid){var n=null,i=null;for(n in t)"$"!=n[0]&&(null!==i||t[n].$valid||(i=t[n].$name),t[n].$pristine&&(t[n].$dirty=!0));return angular.element(".ng-invalid[name="+i+"]").focus(),void l.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}l.swal("Validación exitosa","Guardando información de indicador...","success"),g()},reset:function(t){n.clear()}},n.clear=function(){r(function(){n.indicator={id:0,customerId:t.customerId,classification:null,period:null,workCenter:null,manHoursWorked:0,population:0,directCost:0,eventNumber:0,targetEvent:0,diseaseRate:0,diseaseRateFormat:0,disabilityDays:0,targetDisabilityDays:0,targetFrequency:0,targetFrequencyIndex:0,frequencyIndex:0,frequencyIndexFormat:0,targetSeverity:0,targetSeverityIndex:0,severityIndex:0,severityIndexFormat:0,targetWorkAccident:0,disablingInjuriesIndex:0,disablingInjuriesIndexFormat:0}}),n.isView=!1};var g=function(){console.log(n.indicator);var t={},i=JSON.stringify(n.indicator);return t.data=Base64.encode(i),c({method:"POST",url:"api/absenteeism-indicator/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){r(function(){n.indicator=t.data.result,console.log(n.indicator),e.dismiss("cancel"),n.dtInstanceIndicators.reloadData()})})["catch"](function(t){o.error(t),l.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};n.dtInstanceDisabilityIndicatorList={},n.dtOptionsDisabilityIndicatorList=m.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.id=n.indicator.id,JSON.stringify(t)},url:"api/customer-absenteeism-indicator-summary",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){v()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,i,e){f(angular.element(t).contents())(n)}),n.dtColumnsDisabilityIndicatorList=[w.newColumn("label").withTitle("Indicador"),w.newColumn("value").withTitle("Valor"),w.newColumn("goal").withTitle("Meta")];var v=function(){};n.dtInstanceDisabilityIndicatorListCallback=function(t){n.dtInstanceDisabilityIndicatorList=t},n.reloadData=function(){n.dtInstanceDisabilityIndicatorList.reloadData()}}]);
"use strict";app.controller("customerAbsenteeismAnalysisResolution0312Ctrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$document","$filter","$aside","ListService","ChartService","ngNotify",function(t,e,a,i,n,o,r,s,c,l,d,u,p,m,f,w,h,b,y){function O(){var a=t.filter.compareYearList.filter(function(e){return null!=e&&null!=e.value&&t.filter.canCompare}).map(function(t,e,a){return t.value.value});void 0!==a&&null!==a||(a=[]),a.push(t.filter.selectedYear?t.filter.selectedYear.value:0);var i={customerId:e.customerId,yearList:a},n=[{name:"chart_line_options",criteria:null},{name:"chart_bar_options",criteria:null},{name:"customer_absenteeism_indicator_0312",criteria:i}];b.getDataChart(n).then(function(e){t.chart.line.options=e.data.data.chartLineOptions,t.chart.bar.options=e.data.data.chartLBarOptions,t.chart.frequencyAccidentality.data=e.data.data.customerAbsenteeismIndicatorFrequencyAccidentality,t.chart.severityAccidentality.data=e.data.data.customerAbsenteeismIndicatorSeverityAccidentality,t.chart.mortalProportionAccidentality.data=e.data.data.customerAbsenteeismIndicatorMortalProportionAccidentality,t.chart.absenteeismMedicalCause.data=e.data.data.customerAbsenteeismIndicatorAbsenteeismMedicalCause,t.chart.occupationalDiseaseFatalityRate.data=e.data.data.customerAbsenteeismIndicatorOccupationalDiseaseFatalityRate,t.chart.occupationalDiseasePrevalence.data=e.data.data.customerAbsenteeismIndicatorOccupationalDiseasePrevalence,t.chart.occupationalDiseaseIncidence.data=e.data.data.customerAbsenteeismIndicatorOccupationalDiseaseIncidence},function(t){})}function g(){var a=[{name:"current_year"},{name:"absenteeism_disability_indicator_years",value:e.customerId}];h.getDataList(a).then(function(e){t.years=e.data.data.absenteeism_disability_indicator_years;var a=e.data.data.currentYear,i=f("filter")(t.years,{value:a});t.filter.selectedYear=i.length?i[0]:null,t.isLoaded=!0,D(),O()},function(e){t.status="Unable to load customer data: "+e.message})}var v=a,C={refresh:!0,index:0};t.isLoaded=!1,t.filter={canCompare:!1,selectedCause:null,selectedYear:null,compareYearList:[]},t.compareYearList=[],t.chart={line:{options:null},bar:{options:null},frequencyAccidentality:{data:null},severityAccidentality:{data:null},mortalProportionAccidentality:{data:null},absenteeismMedicalCause:{data:null},occupationalDiseaseFatalityRate:{data:null},occupationalDiseasePrevalence:{data:null},occupationalDiseaseIncidence:{data:null}},g();var D=function(){t.compareYearList=t.years.filter(function(e){return e.value!=t.filter.selectedYear.value})};t.reloadData=function(){t.grid.dataSource.read(),t.onSelectYear()},t.onConsolidate=function(){var i={};i.id=e.customerId,u({method:"POST",url:"api/customer-absenteeism-indicator/consolidate-0312",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(e){if(e.data.result.isQueue){var a='<div class="row"><div class="col-sm-12 text-center">Por favor espere y verifique su correo y la bandeja de mensajes!</div> </div>';y.set(a,{position:"bottom",sticky:!0,type:"info",button:!0,html:!0})}else swal("Consolidación","La Matriz de indicadores se ha consolidado satisfactoriamente","info"),t.reloadData()})["catch"](function(t){a.error(t),p.swal("Error en la Consolidación","Se ha presentado un error durante la Consolidación de la matriz por favor intentelo de nuevo","error")})["finally"](function(){})},d(function(){var i=function(){var t=[{command:[{text:" ",template:"<a class='btn btn-success btn btn-xs' ng-click='onEdit(dataItem)' uib-tooltip='Editar' tooltip-placement='right'><i class='fa fa-edit'></i></a> "}],width:"80px"}];return t.push(n("classification","Clasificación","250px")),t.push(n("period","Periodo","100px")),t.push(n("disabilityDays","Días Incapacidad",null)),t.push(n("eventNumber","Eventos",null)),t.push(n("chargedDays","Días Cargados",null)),t.push(n("eventMortalNumber","Mortales",null)),t.push(n("programedDays","Días Programados","200px")),t.push(n("employeeQuantity","Empleados","200px")),t},n=function(t,e,a,i,n){return{field:t,title:e,width:a,headerAttributes:{"class":"text-bold"},filterable:void 0!==i&&i,template:"function"==typeof n?n:null}};t.mainGridOptions={dataSource:{type:"odata",transport:{read:{url:"api/customer-absenteeism-indicator-parent",dataType:"json",type:"POST",data:function(){var t={customerId:e.customerId};return t}},parameterMap:function(t,e){return JSON.stringify(t)}},schema:{model:{id:"id",fields:{}},data:function(t){return t.data||t},total:function(t){return t.recordsTotal||t.data.length||0}},pageSize:10,serverPaging:!0,serverFiltering:!0,serverSorting:!0},scrollable:!0,sortable:{mode:"multiple"},pageable:{change:function(t){C.index=t.index,v.info("page.index",C.index)}},filterable:!1,dataBinding:function(t){a.info("dataBinding")},dataBound:function(e){a.info("dataBound"),t.grid.tbody.find("tr").each(function(){t.grid.dataItem(this)})},columns:i()},t.detailGridOptions=function(t){return{dataSource:{type:"odata",transport:{read:{url:"api/customer-absenteeism-indicator-detail",dataType:"json",type:"POST",data:function(){var a={cause:t.cause,periodCode:t.periodCode,customerId:e.customerId};return a}},parameterMap:function(t,e){return JSON.stringify(t)}},requestEnd:function(t){},schema:{model:{id:"id",classification:"classification",fields:{}},data:function(t){return t.data||t},total:function(t){return t.recordsTotal||t.data.length||0}},serverPaging:!1,serverSorting:!0,serverFiltering:!1,pageSize:10,filter:[{field:"cause",operator:"eq",value:t.cause},{field:"periodCode",operator:"eq",value:t.periodCode}]},noRecords:!0,scrollable:!1,sortable:!0,pageable:!1,dataBound:function(t){a.info("dataBound child"),this.wrapper.css({width:this.wrapper.closest("div.k-parent")[0].offsetWidth-90+"px"})},columns:[{command:[{text:" ",template:"<a class='btn btn-warning btn btn-xs' ng-click='onEditDetail(dataItem)' uib-tooltip='Configurar' tooltip-placement='right'><i class='fa fa-gear'></i></a> "}],width:"50px"},n("workplace","Centro de Trabajo",null),n("disabilityDays","Días Incapacidad","150px"),n("eventNumber","Eventos","100px"),n("chargedDays","Días Cargados","150px"),n("eventMortalNumber","Mortales","100px")]}}}),t.$on("kendoWidgetCreated",function(e,a){void 0!==t.grid&&null!==t.grid||(t.grid=a)}),t.onEdit=function(e){var a=w.open({templateUrl:l.app.views.urlRoot+"modules/customer/occupational/absenteeism/analysis/0312/customer_absenteeism_disability_indicator_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideCustomerAbsenteeismAnalysisResolution0312Ctrl",scope:t,resolve:{dataItem:function(){return e}}});a.result.then(function(){t.grid.dataSource.read()},function(){t.grid.dataSource.read()})},t.onEditDetail=function(e){var a=w.open({templateUrl:l.app.views.urlRoot+"modules/customer/occupational/absenteeism/analysis/0312/customer_absenteeism_disability_indicator_detail_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideCustomerAbsenteeismAnalysisResolution0312DetailCtrl",scope:t,resolve:{dataItem:function(){return e}}});a.result.then(function(){t.grid.dataSource.read()},function(){t.grid.dataSource.read()})},t.onAddCompareYear=function(){t.filter.compareYearList.push({})},t.onRemoveCompareYear=function(e){t.filter.compareYearList.splice(e,1),O()},t.onSelectYear=function(){D(),O(),t.dtInstanceFrequencyAccidentality.reloadData(),t.dtInstanceSeverityAccidentality.reloadData(),t.dtInstanceMortalProportionAccidentality.reloadData(),t.dtInstanceAbsenteeismMedicalCause.reloadData(),t.dtInstanceOccupationalDiseaseFatalityRate.reloadData(),t.dtInstanceOccupationalDiseasePrevalence.reloadData(),t.dtInstanceOccupationalDiseaseIncidence.reloadData()},t.onChangeCompare=function(){O()},t.dtOptionsFrequencyAccidentality=i.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(a){return a.customerId=e.customerId,a.year=t.filter.selectedYear?t.filter.selectedYear.value:0,JSON.stringify(a)},url:"api/customer-absenteeism-indicator-frequency-accidentality",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withOption("language",{}).withOption("bFilter",!1).withOption("paging",!1).withOption("createdRow",function(e,a,i){r(angular.element(e).contents())(t)}),t.dtColumnsFrequencyAccidentality=[n.newColumn("month").withTitle("Mes").notSortable(),n.newColumn("eventNumber").withTitle("Eventos").withOption("width",200).notSortable(),n.newColumn("employeeQuantity").withTitle("Empleados").withOption("width",200).notSortable(),n.newColumn("result").withTitle("Resultado").withOption("width",200).notSortable()],t.dtInstanceFrequencyAccidentalityCallback=function(e){t.dtInstanceFrequencyAccidentality=e},t.dtOptionsSeverityAccidentality=i.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(a){return a.customerId=e.customerId,a.year=t.filter.selectedYear?t.filter.selectedYear.value:0,JSON.stringify(a)},url:"api/customer-absenteeism-indicator-severity-accidentality",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withOption("language",{}).withOption("bFilter",!1).withOption("paging",!1).withOption("createdRow",function(e,a,i){r(angular.element(e).contents())(t)}),t.dtColumnsSeverityAccidentality=[n.newColumn("month").withTitle("Mes").notSortable(),n.newColumn("disabilityDays").withTitle("Días Incapacidad").withOption("width",200).notSortable(),n.newColumn("chargedDays").withTitle("Días Cargados").withOption("width",200).notSortable(),n.newColumn("employeeQuantity").withTitle("Empleados").withOption("width",200).notSortable(),n.newColumn("result").withTitle("Resultado").withOption("width",200).notSortable()],t.dtInstanceSeverityAccidentalityCallback=function(e){t.dtInstanceSeverityAccidentality=e},t.dtOptionsMortalProportionAccidentality=i.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(a){return a.customerId=e.customerId,a.year=t.filter.selectedYear?t.filter.selectedYear.value:0,JSON.stringify(a)},url:"api/customer-absenteeism-indicator-mortal-proportion-accidentality",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withOption("language",{}).withOption("bFilter",!1).withOption("paging",!1).withOption("createdRow",function(e,a,i){r(angular.element(e).contents())(t)}),t.dtColumnsMortalProportionAccidentality=[n.newColumn("year").withTitle("Año").notSortable(),n.newColumn("eventMortalNumber").withTitle("Mortales").withOption("width",200).notSortable(),n.newColumn("eventNumber").withTitle("Eventos").withOption("width",200).notSortable(),n.newColumn("result").withTitle("Resultado").withOption("width",200).notSortable()],t.dtInstanceMortalProportionAccidentalityCallback=function(e){t.dtInstanceMortalProportionAccidentality=e},t.dtOptionsAbsenteeismMedicalCause=i.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(a){return a.customerId=e.customerId,a.year=t.filter.selectedYear?t.filter.selectedYear.value:0,JSON.stringify(a)},url:"api/customer-absenteeism-indicator-absenteeism-medical-cause",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withOption("language",{}).withOption("bFilter",!1).withOption("paging",!1).withOption("createdRow",function(e,a,i){r(angular.element(e).contents())(t)}),t.dtColumnsAbsenteeismMedicalCause=[n.newColumn("month").withTitle("Mes").notSortable(),n.newColumn("disabilityDays").withTitle("Días Incapacidad").withOption("width",200).notSortable(),n.newColumn("programedDays").withTitle("Días Programados").withOption("width",200).notSortable(),n.newColumn("result").withTitle("Resultado").withOption("width",200).notSortable()],t.dtInstanceAbsenteeismMedicalCauseCallback=function(e){t.dtInstanceAbsenteeismMedicalCause=e},t.dtOptionsOccupationalDiseaseFatalityRate=i.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(a){return a.customerId=e.customerId,a.year=t.filter.selectedYear?t.filter.selectedYear.value:0,JSON.stringify(a)},url:"api/customer-absenteeism-indicator-occupational-disease-fatality-rate",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withOption("language",{}).withOption("bFilter",!1).withOption("paging",!1).withOption("createdRow",function(e,a,i){r(angular.element(e).contents())(t)}),t.dtColumnsOccupationalDiseaseFatalityRate=[n.newColumn("year").withTitle("Año").notSortable(),n.newColumn("eventMortalNumber").withTitle("Mortales").withOption("width",200).notSortable(),n.newColumn("eventNumber").withTitle("Eventos").withOption("width",200).notSortable(),n.newColumn("result").withTitle("Resultado").withOption("width",200).notSortable()],t.dtInstanceOccupationalDiseaseFatalityRateCallback=function(e){t.dtInstanceOccupationalDiseaseFatalityRate=e},t.dtOptionsOccupationalDiseasePrevalence=i.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.customerId=e.customerId,JSON.stringify(t)},url:"api/customer-absenteeism-indicator-occupational-disease-prevalence",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withOption("language",{}).withOption("bFilter",!1).withOption("paging",!1).withOption("createdRow",function(e,a,i){r(angular.element(e).contents())(t)}),t.dtColumnsOccupationalDiseasePrevalence=[n.newColumn("year").withTitle("Año").notSortable(),n.newColumn("diagnosticAll").withTitle("Casos").withOption("width",200).notSortable(),n.newColumn("employeeQuantity").withTitle("Promedio de Empleados").withOption("width",200).notSortable(),n.newColumn("result").withTitle("Resultado").withOption("width",200).notSortable()],t.dtInstanceOccupationalDiseasePrevalenceCallback=function(e){t.dtInstanceOccupationalDiseasePrevalence=e},t.dtOptionsOccupationalDiseaseIncidence=i.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.customerId=e.customerId,JSON.stringify(t)},url:"api/customer-absenteeism-indicator-occupational-disease-incidence",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withOption("language",{}).withOption("bFilter",!1).withOption("paging",!1).withOption("createdRow",function(e,a,i){r(angular.element(e).contents())(t)}),t.dtColumnsOccupationalDiseaseIncidence=[n.newColumn("year").withTitle("Año").notSortable(),n.newColumn("diagnosticNew").withTitle("Casos").withOption("width",200).notSortable(),n.newColumn("employeeQuantity").withTitle("Promedio de Empleados").withOption("width",200).notSortable(),n.newColumn("result").withTitle("Resultado").withOption("width",200).notSortable()],t.dtInstanceOccupationalDiseaseIncidenceCallback=function(e){t.dtInstanceOccupationalDiseaseIncidence=e},t.onExportPdf=function(t){var e=null,a="Gráfica.pdf";switch(t){case"FA":e=".export-pdf-frequency-accidentality",a="FRECUENCIA_ACCIDENTALIDAD.pdf";break;case"SA":e=".export-pdf-severity-accidentality",a="SEVERIDAD_ACCIDENTALIDAD.pdf";break;case"PAM":e=".export-pdf-mortal-proportion-accidentality",a="PROPORCION_ACCIDENTES_MORTALES.pdf";break;case"PAM":e=".export-pdf-mortal-proportion-accidentality",a="PROPORCION_DE_ACCIDENTES_DE_TRABAJO_MORTALES.pdf";break;case"ACM":e=".export-pdf-absenteeism-medical-cause",a="AUSENTISMO_CAUSA_MEDICA.pdf";break;case"TL":e=".export-pdf-occupational-disease-fatality-rate",a="TASA_LETALIDAD_ENFERMEDAD_LABORAL.pdf";break;case"PEL":e=".export-pdf-occupational-disease-prevalence",a="PREVALENCIA_ENFERMEDAD_LABORAL.pdf";break;case"IEL":e=".export-pdf-occupational-disease-incidence",a="INCIDENCIA_ENFERMEDAD_LABORAL.pdf"}kendo.drawing.drawDOM($(e)).then(function(t){return kendo.drawing.exportPDF(t,{paperSize:"auto",margin:{left:"1cm",top:"1cm",right:"1cm",bottom:"1cm"}})}).done(function(t){kendo.saveAs({dataURI:t,fileName:a})})},t.onExportExcel=function(a){var i=null;switch(a){case"FA":i="api/customer-absenteeism-indicator/export-frequency-accidentality";break;case"SA":i="api/customer-absenteeism-indicator/export-severity-accidentality";break;case"PAM":i="api/customer-absenteeism-indicator/export-mortal-proportion-accidentality";break;case"ACM":i="api/customer-absenteeism-indicator/export-absenteeism-medical-cause";break;case"TL":i="api/customer-absenteeism-indicator/export-occupational-disease-fatality-rate";break;case"PEL":i="api/customer-absenteeism-indicator/export-occupational-disease-prevalence";break;case"IEL":i="api/customer-absenteeism-indicator/export-occupational-disease-incidence";break;case"MA":i="api/customer-absenteeism-indicator/export-parent"}var n=t.filter.selectedYear?t.filter.selectedYear.value:"";angular.element("#download")[0].src=i+"?customerId="+e.customerId+"&year="+n}}]),app.controller("ModalInstanceSideCustomerAbsenteeismAnalysisResolution0312Ctrl",["$stateParams","$rootScope","$scope","$uibModalInstance","dataItem","$log","$timeout","$document","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile",function(t,e,a,i,n,o,r,s,c,l,d,u,p,m,f,w){a.onCloseModal=function(){i.close(1)},a.onCancel=function(){i.dismiss("cancel")};var h=function(){a.indicator={customerId:n.customerId,cause:n.cause,periodCode:n.periodCode,classification:n.classification,period:n.period,employeeQuantity:n.employeeQuantity,programedDays:n.programedDays,eventNumber:n.eventNumber,disabilityDays:n.disabilityDays,chargedDays:n.chargedDays,eventMortalNumber:n.eventMortalNumber}};h(),a.master=a.indicator,a.form={submit:function(t){var e=null;if(t.$invalid){var a=null,e=null;for(a in t)"$"!=a[0]&&(null!==e||t[a].$valid||(e=t[a].$name),t[a].$pristine&&(t[a].$dirty=!0));return void angular.element(".ng-invalid[name="+e+"]").focus()}c.swal("Validación exitosa","Guardando información de indicador...","success"),b()},reset:function(t){h()}};var b=function(){console.log(a.indicator);var t={},e=JSON.stringify(a.indicator);return t.data=Base64.encode(e),l({method:"POST",url:"api/customer-absenteeism-indicator/update",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){r(function(){a.indicator=t.data.result,c.swal("Validación exitosa","El registro se guardó satisfactoriamente","success"),i.dismiss("cancel")})})["catch"](function(t){o.error(t),c.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})}}]),app.controller("ModalInstanceSideCustomerAbsenteeismAnalysisResolution0312DetailCtrl",["$stateParams","$rootScope","$scope","$uibModalInstance","dataItem","$log","$timeout","$document","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile",function(t,e,a,i,n,o,r,s,c,l,d,u,p,m,f,w){a.onCloseModal=function(){i.close(1)},a.onCancel=function(){i.dismiss("cancel")},a.isDisableChargedDays="AT"!=n.cause&&"AL"!=n.cause,a.isDisableEventMortalNumber="AT"!=n.cause&&"AL"!=n.cause&&"EL"!=n.cause&&"ELC"!=n.cause;var h=function(){a.indicator={id:n.id,customerId:n.customerId,cause:n.cause,periodCode:n.periodCode,classification:n.classification,period:n.period,workCenter:n.workplace,employeeQuantity:n.employeeQuantity,programedDays:n.programedDays,eventNumber:n.eventNumber,disabilityDays:n.disabilityDays,chargedDays:n.chargedDays,eventMortalNumber:n.eventMortalNumber}};h(),a.master=a.indicator,a.form={submit:function(t){var e=null;if(t.$invalid){var a=null,e=null;for(a in t)"$"!=a[0]&&(null!==e||t[a].$valid||(e=t[a].$name),t[a].$pristine&&(t[a].$dirty=!0));return void angular.element(".ng-invalid[name="+e+"]").focus()}c.swal("Validación exitosa","Guardando información de indicador...","success"),b()},reset:function(t){h()}};var b=function(){console.log(a.indicator);var t={},e=JSON.stringify(a.indicator);return t.data=Base64.encode(e),l({method:"POST",url:"api/customer-absenteeism-indicator/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){r(function(){a.indicator=t.data.result,c.swal("Validación exitosa","El registro se guardó satisfactoriamente","success"),i.dismiss("cancel")})})["catch"](function(t){o.error(t),c.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})}}]);
"use strict";app.controller("customerAbsenteeismBillingCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$document","$filter",function(r,e,a,i,o,t,n,s,l,d,c,u,p,m,f){var h=a;h.info("loading..customerAbsenteeismIndicatorsCtrl "),r.disabilities=[];var g=function(){var i={};i.customer_id=e.customerId,u({method:"POST",url:"api/absenteeism-disability/billing",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(e){r.disabilities=e.data.data})["catch"](function(r){a.error(r),p.swal("Error en la eliminaci�n","Se ha presentado un error durante la eliminaci�n del registro por favor intentelo de nuevo","error")})["finally"](function(){})};g(),r.onSaveBilling=function(){var e={},i={isValid:!0,disabilities:[]},o=!0;if(angular.forEach(r.disabilities,function(r){r.charged&&""==r.amountPaid?o=!1:r.charged&&""!=r.amountPaid&&i.disabilities.push(r)}),o){if(i.disabilities.length>0){var t=JSON.stringify(i);return e.data=Base64.encode(t),u({method:"POST",url:"api/absenteeism-disability/update",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(r){c(function(){s.pop("success","Operación Exitosa","Pagos administradoras ingresados"),g()})})["catch"](function(r){a.error(r),s.pop("error","Error","Ha ocurrido un error ingresando las facturas")})["finally"](function(){})}s.pop("error","Error","No hay proyectos marcados para facturar")}else s.pop("error","Error","El número de factura es requerido para los proyectos marcados como facturado")}}]);
"use strict";app.controller("customerHealthDamageTabsCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","SweetAlert","$rootScope","$http","$timeout","$uibModal","flowFactory","cfpLoadingBar","$document","$filter","$aside","FileUploader",function(a,t,e,o,i,l,s,u,m,r,c,n,h,d,p,_,g,f,v,b){a.views=[{name:"disability",url:c.app.views.urlRoot+"modules/customer/occupational/health-damage/disability/customer_health_damage_disability.htm"},{name:"diagnostic",url:c.app.views.urlRoot+"modules/customer/occupational/health-damage/diagnostic/customer_health_damage_diagnostic_source.htm"},{name:"restriction",url:c.app.views.urlRoot+"modules/customer/occupational/health-damage/restriction/customer_health_damage_restriction.htm"},{name:"qualification",url:c.app.views.urlRoot+"modules/customer/occupational/health-damage/qualification/customer_health_damage_qualification_source.htm"},{name:"qualification_lost",url:c.app.views.urlRoot+"modules/customer/occupational/health-damage/qualification-lost/customer_health_damage_qualification_lost.htm"},{name:"administrative",url:c.app.views.urlRoot+"modules/customer/occupational/health-damage/administrative/customer_health_damage_administrative_process.htm"},{name:"observation",url:c.app.views.urlRoot+"modules/customer/occupational/health-damage/observation/customer_health_damage_observation.htm"},{name:"analysis",url:c.app.views.urlRoot+"modules/customer/occupational/health-damage/analysis/customer_health_damage_analysis.htm"}],a.loading=!1,a.tabname="basic",a.getView=function(t){var e=f("filter")(a.views,{name:t});return e[0]},a.switchTab=function(t){h(function(){a.tabname=t})},a.switchSubTab=function(t){h(function(){a.subtab=t})}}]);
"use strict";app.controller("customerHealthDamageDisabilityCtrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout","$filter",function(t,i,e,a,o,s,l){t.views=[{name:"disability_edit",url:o.app.views.urlRoot+"modules/customer/occupational/health-damage/disability/customer_health_damage_disability_edit.htm"},{name:"disability_list",url:o.app.views.urlRoot+"modules/customer/occupational/health-damage/disability/customer_health_damage_disability_list.htm"},{name:"disability_person",url:o.app.views.urlRoot+"modules/customer/occupational/health-damage/disability/customer_health_damage_disability_person.htm"}],t.tracking_section="list",t.currentId=0,t.modeDsp="edit",t.tabname="disability_edit",t.navToSection=function(i,e,a){s(function(){t.tracking_section=i,t.modeDsp=e,t.$parent.switchSubTab(e),t.currentId=a})},t.getView=function(i){var e=l("filter")(t.views,{name:i});return e[0]},t.switchTab=function(i){s(function(){t.tabname=i})}}]);
"use strict";app.controller("customerHealthDamageDisabilityEditCtrl",["$scope","$stateParams","$log","$compile","$state","SweetAlert","$rootScope","$http","$timeout","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$uibModal","flowFactory","cfpLoadingBar","$filter","$aside","$document","FileUploader","$localStorage","toaster",function(t,i,n,e,o,a,l,s,r,c,d,u,p,w,h,m,f,D,g,O,y){t.dtInstanceHealthDamageDisabilityDetail={},t.dtOptionsHealthDamageDisabilityDetail=c.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.operation="tracking",t.customerId=i.customerId,t.category="Incapacidad",JSON.stringify(t)},url:"api/customer-absenteeism-disability-diagnostic-analysis",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){C()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(i,n,o){e(angular.element(i).contents())(t)}),t.dtColumnsHealthDamageDisabilityDetail=[d.newColumn(null).withTitle("Acciones").withOption("width",80).notSortable().renderWith(function(t,i,n,e){var o="",a='<a class="btn btn-info btn-xs viewRow lnk" href="#" uib-tooltip="Ver reporte" data-diagnostic="'+t.diagnosticId+'" >   <i class="fa fa-eye"></i></a> ';return o+=a}),d.newColumn("description").withTitle("Diagnóstico").withOption("width",200).withOption("defaultContent",""),d.newColumn("start").withTitle("F.Inicio").withOption("width",200).withOption("defaultContent",""),d.newColumn("end").withTitle("F.Final").withOption("width",200).withOption("defaultContent",""),d.newColumn("records").withTitle("Num Casos").withOption("width",200).withOption("defaultContent",""),d.newColumn("days").withTitle("Num Días Acumulados").withOption("width",200).withOption("defaultContent",""),d.newColumn("workplace").withTitle("Centro de Trabajo").withOption("width",200).withOption("defaultContent","")];var C=function(){$("#dtHealthDamageDisabilityDetail a.viewRow").on("click",function(){var t=$(this).data("diagnostic");b(t)})};t.reloadDataHealthDamageDisabilityDetail=function(){t.dtInstanceHealthDamageDisabilityDetail.reloadData()},t.onExportExcel=function(){jQuery("#download")[0].src="api/absenteeism-disability/diagnostic-analysis-export?id="+i.customerId};var b=function(i){var n={diagnosticId:i},e=f.open({templateUrl:l.app.views.urlRoot+"modules/customer/occupational/health-damage/disability/customer_health_damage_disability_diagnostic_analysis_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideDisabilityDiagnosticAnalysisCtrl",scope:t,resolve:{filter:function(){return n}}});e.result.then(function(){t.reloadData()})}}]),app.controller("ModalInstanceSideDisabilityDiagnosticAnalysisCtrl",["$rootScope","$stateParams","$scope","filter","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile",function(t,i,n,e,o,a,l,s,r,c,d,u,p,w,h){n.employee={id:0},n.onCloseModal=function(){o.close(n.employee)},n.onCancel=function(){o.dismiss("cancel")},n.onLoadRecord=function(){if(0!=n.employee.id){var t={id:n.employee.id};r({method:"GET",url:"api/customer-employee",params:t})["catch"](function(t,i){if(403==i){var n=null!==t.message&&void 0!==t.message?t.message:"app.clientes.list";s.swal("No Autorizado","No estas autorizado para ver esta información.","error"),l(function(){$state.go(n)},3e3)}else 404==i?s.swal("Información no disponible","Diagnóstico no encontrado","error"):s.swal("Error","Se ha presentado un error al intentar acceder a la información del proceso","error")}).then(function(t){l(function(){n.employee=t.data.result})})["finally"](function(){l(function(){n.onCloseModal()},400)})}else n.loading=!1},n.dtInstanceCustomerHealthDamageDisabilityDiagnosticAnalysis={},n.dtOptionsCustomerHealthDamageDisabilityDiagnosticAnalysis=w.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.operation="diagnostic",t.customerId=i.customerId,t.category="Incapacidad",t.diagnosticId=e.diagnosticId,JSON.stringify(t)},url:"api/customer-absenteeism-disability-person-analysis",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){m()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,i,e){h(angular.element(t).contents())(n)}),n.dtColumnsCustomerHealthDamageDisabilityDiagnosticAnalysis=[p.newColumn("employee").withTitle("Empleado").withOption("width",200).withOption("defaultContent",""),p.newColumn("start").withTitle("F.Inicio").withOption("width",200).withOption("defaultContent",""),p.newColumn("end").withTitle("F.Final").withOption("width",200).withOption("defaultContent",""),p.newColumn("origin").withTitle("Origen").withOption("width",200).withOption("defaultContent",""),p.newColumn("type").withTitle("Tipo").withOption("width",200).withOption("defaultContent",""),p.newColumn("numberDays").withTitle("Num Días").withOption("width",200).withOption("defaultContent",""),p.newColumn("acumulateDays").withTitle("Num Días Acumulados").withOption("width",200).withOption("defaultContent",""),p.newColumn("description").withTitle("Diagnóstico").withOption("width",200).withOption("defaultContent","")];var m=function(){};n.reloadData=function(){n.dtInstanceCustomerHealthDamageDisabilityDiagnosticAnalysis.reloadData()}}]);
"use strict";app.controller("customerHealthDamageDisabilityListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","SweetAlert","$http","$filter","$document","$aside",function(t,i,e,n,o,a,l,s,r,d,u,c,p,w,h,m){var f=e;f.info("loading..customerHealthDamageDisabilityListCtrl "),t.dtInstanceHealthDamageDisabilityList={},t.dtOptionsHealthDamageDisabilityList=n.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{url:"api/customer-absenteeism-disability-days-analysis",data:function(t){return t.operation="tracking",t.customerId=i.customerId,JSON.stringify(t)},type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){O()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(i,e,n){l(angular.element(i).contents())(t)}),t.dtColumnsHealthDamageDisabilityList=[o.newColumn(null).withTitle("Acciones").withOption("width",80).notSortable().renderWith(function(t,i,e,n){var o="",a='<a class="btn btn-info btn-xs viewRow lnk" href="#" uib-tooltip="Ver reporte" data-diagnostic="'+t.diagnostic_id+'"data-type="'+t.type+'" >   <i class="fa fa-eye"></i></a> ';return o+=a}),o.newColumn("disability").withTitle("Diagnóstico").withOption("width",200).withOption("defaultContent",""),o.newColumn("causeItem").withTitle("Origen").withOption("width",200).withOption("defaultContent",""),o.newColumn("startDate").withTitle("F.Inicio").withOption("width",200).withOption("defaultContent",""),o.newColumn("endDate").withTitle("F.Final").withOption("width",200).withOption("defaultContent",""),o.newColumn("records").withTitle("Num Casos").withOption("width",200).withOption("defaultContent",""),o.newColumn("days").withTitle("Num Días Acumulados").withOption("width",200).withOption("defaultContent",""),o.newColumn("workplace").withTitle("Centro de Trabajo").withOption("width",200).withOption("defaultContent","")];var O=function(){$("#dtHealthDamageDisabilityList a.viewRow").on("click",function(){var t=$(this).data("diagnostic"),i=$(this).data("type");D(t,i)})};t.reloadData=function(){t.dtInstanceHealthDamageDisabilityList.reloadData()},t.onExportExcel=function(){jQuery("#download")[0].src="api/absenteeism-disability/days-analysis-export?id="+i.customerId};var D=function(i,e){var n={diagnosticId:i,type:e},o=m.open({templateUrl:d.app.views.urlRoot+"modules/customer/occupational/health-damage/disability/customer_health_damage_disability_diagnostic_analysis_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideDisabilityDiagnosticAnalysisPersonCtrl",scope:t,resolve:{filter:function(){return n}}});o.result.then(function(){t.reloadData()})}}]),app.controller("ModalInstanceSideDisabilityDiagnosticAnalysisPersonCtrl",["$rootScope","$stateParams","$scope","filter","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile",function(t,i,e,n,o,a,l,s,r,d,u,c,p,w,h){var m={};e.employee={id:0},e.onCloseModal=function(){o.close(e.employee)},e.onCancel=function(){o.dismiss("cancel")},e.onLoadRecord=function(){if(0!=e.employee.id){var t={id:e.employee.id};r({method:"GET",url:"api/customer-employee",params:t})["catch"](function(t,i){if(403==i){var e=null!==t.message&&void 0!==t.message?t.message:"app.clientes.list";s.swal("No Autorizado","No estas autorizado para ver esta información.","error"),l(function(){$state.go(e)},3e3)}else 404==i?s.swal("Información no disponible","Diagnóstico no encontrado","error"):s.swal("Error","Se ha presentado un error al intentar acceder a la información del proceso","error")}).then(function(t){l(function(){e.employee=t.data.result})})["finally"](function(){l(function(){e.onCloseModal()},400)})}else e.loading=!1},m.operation="diagnostic",m.customer_id=i.customerId,m.diagnostic_id=n.diagnosticId,m.type=n.type,m.data="",e.dtInstanceCustomerHealthDamageDisabilityDiagnosticAnalysis={},e.dtOptionsCustomerHealthDamageDisabilityDiagnosticAnalysis=w.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:m,url:"api/absenteeism-disability/person-analysis",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){f()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,i,n){h(angular.element(t).contents())(e)}),e.dtColumnsCustomerHealthDamageDisabilityDiagnosticAnalysis=[p.newColumn("employee").withTitle("Empleado").withOption("width",200).withOption("defaultContent",""),p.newColumn("startDate").withTitle("F.Inicio").withOption("width",200).withOption("defaultContent",""),p.newColumn("endDate").withTitle("F.Final").withOption("width",200).withOption("defaultContent",""),p.newColumn("origin").withTitle("Origen").withOption("width",200).withOption("defaultContent",""),p.newColumn("type").withTitle("Tipo").withOption("width",200).withOption("defaultContent",""),p.newColumn("days").withTitle("Num Días").withOption("width",200).withOption("defaultContent",""),p.newColumn("acumulateDays").withTitle("Num Días Acumulados").withOption("width",200).withOption("defaultContent",""),p.newColumn("disability").withTitle("Diagnóstico").withOption("width",200).withOption("defaultContent","")];var f=function(){};e.reloadData=function(){e.dtInstanceCustomerHealthDamageDisabilityDiagnosticAnalysis.reloadData()}}]);
"use strict";app.controller("customerHealthDamageDisabilityPersonCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","SweetAlert","$http","$filter","$document",function(t,i,n,e,o,a,l,r,s,w,p,u,h,d,c){var m=n;m.info("loading..customerHealthDamageDisabilityPersonCtrl "),t.dtInstanceHealthDamageDisabilityPerson={},t.dtOptionsHealthDamageDisabilityPerson=e.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.operation="tracking",t.customerId=i.customerId,t.category="Incapacidad",JSON.stringify(t)},url:"api/customer-absenteeism-disability-person-analysis",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){O()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(i,n,e){l(angular.element(i).contents())(t)}),t.dtColumnsHealthDamageDisabilityPerson=[o.newColumn("employee").withTitle("Empleado").withOption("width",200).withOption("defaultContent",""),o.newColumn("startDate").withTitle("F.Inicio").withOption("width",200).withOption("defaultContent",""),o.newColumn("endDate").withTitle("F.Final").withOption("width",200).withOption("defaultContent",""),o.newColumn("origin").withTitle("Origen").withOption("width",200).withOption("defaultContent",""),o.newColumn("type").withTitle("Tipo").withOption("width",200).withOption("defaultContent",""),o.newColumn("numberDays").withTitle("Num Días").withOption("width",200).withOption("defaultContent",""),o.newColumn("acumulateDays").withTitle("Num Días Acumulados").withOption("width",200).withOption("defaultContent",""),o.newColumn("description").withTitle("Diagnóstico").withOption("width",200).withOption("defaultContent",""),o.newColumn("workplace").withTitle("Centro de Trabajo").withOption("width",200).withOption("defaultContent","")];var O=function(){};t.reloadData=function(){t.dtInstanceHealthDamageDisabilityPerson.reloadData()},t.onExportExcel=function(){jQuery("#download")[0].src="api/customer-absenteeism-disability/export-person-analysis?id="+i.customerId}}]);
"use strict";app.controller("customerHealthDamageDiagnosticSourceCtrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout",function(t,o,e,c,i,n){var r=e;r.info("loading..customerWorkMedicineCtrl!!! "),t.tracking_section="list",t.currentId=0,t.modeDsp="edit",t.navToSection=function(o,e,c){n(function(){t.tracking_section=o,t.modeDsp=e,t.$parent.switchSubTab(e),t.currentId=c})}}]);
"use strict";app.controller("customerHealthDamageDiagnosticSourceEditCtrl",["$scope","$stateParams","$log","$compile","$state","SweetAlert","$rootScope","$http","$timeout","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$uibModal","flowFactory","cfpLoadingBar","$filter","$aside","$document",function(e,t,i,o,a,n,r,l,s,c,d,u,p,m,f,h,g,w){var D=i;e.invalid=!1;var y={},v=e.$parent.currentId;e.isAgent="agent"==r.currentUser().wg_type,e.isAdmin="system"==r.currentUser().wg_type,e.isCustomer="customerAdmin"==r.currentUser().wg_type||"customerUser"==r.currentUser().wg_type,D.info("loading..customerWorkMedicineEditCtrl con el id de tracking: ",v),e.canShow=!1,e.presumedSources=r.parameters("work_health_damage_presumed_diagnostic_source"),e.codeCIE10s=r.parameters("work_health_damage_code_cie_10"),e.arl=r.parameters("arl"),e.documentType=r.parameters("customer_document_type"),e.tiposdoc=r.parameters("tipodoc"),e.isView="view"==e.$parent.modeDsp,console.log(e.isView),e.minDateCurrent=new Date,e.customerId=t.customerId,e.maxDate=new Date,e.datePickerConfig={culture:"es-CO",format:"dd/MM/yyyy HH:mm"},e.employees=[],e.diagnostics=[],e.onLoadRecord=function(){if(0!=e.diagnostic.id){D.info("editando cliente con código: "+e.diagnostic.id);var t={id:e.diagnostic.id};l({method:"GET",url:"api/customer/health-damage/diagnostic-source",params:t})["catch"](function(e,t){if(403==t){var i=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";n.swal("No Autorizado","No estas autorizado para ver esta información.","error"),s(function(){a.go(i)},3e3)}else 404==t?n.swal("Información no disponible","Centro de trabajo no encontrado","error"):n.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(t){s(function(){e.diagnostic=t.data.result,e.canShow=!0})})["finally"](function(){s(function(){e.loading=!1},400),s(function(){w.scrollTop(40,2e3)})})}else D.info("creacion de nuevo cliente"),e.loading=!1},e.diagnostic={id:v,employee:null,arl:null};var b=function(){e.detail={id:0,customerHealthDamageDiagnosticSourceId:e.diagnostic.id,codeCIE10:null,presumedSource:null,diagnostic:""}};b(),e.onLoadRecord(),e.master=e.diagnostic,e.form={submit:function(t){var i=null;if(t.$invalid){var o=null,i=null;for(o in t)"$"!=o[0]&&(null!==i||t[o].$valid||(i=t[o].$name),t[o].$pristine&&(t[o].$dirty=!0));return D.info(e.customer),angular.element(".ng-invalid[name="+i+"]").focus(),void n.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}n.swal("Validación exitosa","Procediendo con el guardado...","success"),D.info(e.customer),C()},reset:function(t){e.diagnostic=angular.copy(e.master),t.$setPristine(!0)}};var C=function(){var t={},o=JSON.stringify(e.diagnostic);return t.data=Base64.encode(o),l({method:"POST",url:"api/customer/health-damage/diagnostic-source/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){s(function(){e.diagnostic=t.data.result,y.customer_health_damage_id=e.diagnostic.id,e.canShow=!0,b()})})["catch"](function(e){i.error(e),n.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};e.cancelEdition=function(){null!=e.$parent&&e.$parent.navToSection("list","list")},y.customer_health_damage_id=v,e.dtInstanceHealthDamageDiagnosticSourceDetail={},e.dtOptionsHealthDamageDiagnosticSourceDetail=c.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.HealthDamageDiagnosticSourceId=e.diagnostic.id,JSON.stringify(t)},url:"api/customer-health-damage-diagnostic-source-detail",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){O()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,i,a){o(angular.element(t).contents())(e)}),e.dtColumnsHealthDamageDiagnosticSourceDetail=[d.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,i,o,a){var n="",l='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+t.id+'" >   <i class="fa fa-edit"></i></a> ',s='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+t.id+'" >   <i class="fa fa-trash-o"></i></a> ';return r.can("seguimiento_edit")&&(n+=l),r.can("seguimiento_delete")&&(n+=s),e.isView?"":n}),d.newColumn("codeCIE10").withTitle("Código CIE10").withOption("width",200).withOption("defaultContent",""),d.newColumn("description").withTitle("Diagnóstico").withOption("width",200).withOption("defaultContent",""),d.newColumn("item").withTitle("Presunto Origen del Diagnóstico").withOption("width",200).withOption("defaultContent","")];var O=function(){$("#dtHealthDamageDiagnosticSourceDetail a.editRow").on("click",function(){var t=$(this).data("id");e.editHealthDamageDiagnosticSourceDetail(t)}),$("#dtHealthDamageDiagnosticSourceDetail a.delRow").on("click",function(){var t=$(this).data("id");D.info("intenta eliminar el registro: "+t),n.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(o){if(o){var a={};a.id=t,l({method:"POST",url:"api/customer/health-damage/diagnostic-source-detail/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){i.error(e),n.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){e.reloadDataHealthDamageDiagnosticSourceDetail()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};e.dtInstanceHealthDamageDiagnosticSourceDetailCallback=function(t){e.dtInstanceHealthDamageDiagnosticSourceDetail=t},e.reloadDataHealthDamageDiagnosticSourceDetail=function(){e.dtInstanceHealthDamageDiagnosticSourceDetail.reloadData()},e.editHealthDamageDiagnosticSourceDetail=function(t){if(t){var i={id:t};l({method:"GET",url:"api/customer/health-damage/diagnostic-source-detail",params:i})["catch"](function(e,t){if(403==t){var i=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";n.swal("No Autorizado","No estas autorizado para ver esta información.","error"),s(function(){a.go(i)},3e3)}else 404==t?n.swal("Información no disponible","Centro de trabajo no encontrado","error"):n.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(t){s(function(){e.detail=t.data.result})})["finally"](function(){s(function(){e.loading=!1},400),s(function(){w.scrollTop(40,2e3)})})}else D.info("creacion de nuevo cliente"),e.loading=!1},e.saveHealthDamageDiagnosticSourceDetail=function(){if(null!=e.detail.codeCIE10&&null!=e.detail.presumedSource){var t={};e.invalid=!1;var o=JSON.stringify(e.detail);return t.data=Base64.encode(o),l({method:"POST",url:"api/customer/health-damage/diagnostic-source-detail/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){s(function(){e.clearHealthDamageDiagnosticSourceDetail(),e.reloadDataHealthDamageDiagnosticSourceDetail()})})["catch"](function(e){i.error(e),n.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})}e.invalid=!0},e.clearHealthDamageDiagnosticSourceDetail=function(){b()},e.onAddEmployee=function(){var t=g.open({templateUrl:r.app.views.urlRoot+"modules/customer/occupational/health-damage/diagnostic/customer_absenteeism_disability_employee_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideHealthDamageSourceEmployeeCtrl",scope:e});t.result.then(function(){})},e.onAddDisabilityEmployeeList=function(){var t=g.open({templateUrl:r.app.views.urlRoot+"modules/customer/occupational/health-damage/diagnostic/customer_absenteeism_disability_employee_list_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideHealthDamageEmployeeListCtrl",scope:e});t.result.then(function(t){var i=h("filter")(e.employees,{id:t.id});0==i.length&&e.employees.push(t),e.diagnostic.employee=t})},e.onAddDisabilityDiagnostic=function(t){if(null==e.diagnostic.employee)return void toaster.pop("error","Error","Debe seleccionar primero un empleado");var i=g.open({templateUrl:r.app.views.urlRoot+"modules/customer/occupational/health-damage/diagnostic/customer_absenteeism_disability_diagnostic_modal.htm",placement:"right",size:"lg",backdrop:!0,resolve:{employee:function(){return e.diagnostic.employee}},controller:"ModalInstanceSideHealthDamageDiagnosticListCtrl",scope:e});i.result.then(function(t){var i=h("filter")(e.diagnostics,{id:t.id});0==i.length&&e.diagnostics.push(t),e.detail.codeCIE10=t})}}]),app.controller("ModalInstanceSideHealthDamageSourceEmployeeCtrl",["$rootScope","$stateParams","$scope","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile",function(e,t,i,o,a,n,r,l,s,c,d,u,p,m){i.contractTypes=e.parameters("employee_contract_type"),i.documentTypes=e.parameters("employee_document_type");var f=function(){i.employee={id:0,customerId:t.customerId,isActive:!0,contractType:null,job:null,workPlace:null,salary:0,entity:{id:0,documentType:null,documentNumber:"",firstName:"",lastName:"",isActive:!0}}};f();var h=function(){var e={};return e.operation="diagnostic",e.customerId=t.customerId,l({method:"POST",url:"api/customer/config-sgsst/workplace/listProcess",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){n(function(){i.workPlaces=e.data.data})})["catch"](function(e){})["finally"](function(){})};h();var g=function(){if(null!=i.employee.workPlace){var e={};return e.operation="diagnostic",e.customerId=t.customerId,e.workPlaceId=i.employee.workPlace.id,l({method:"POST",url:"api/customer/config-sgsst/job/listByWorkPlace",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){n(function(){i.jobs=e.data.data})})["catch"](function(e){})["finally"](function(){})}i.jobs=[]};i.$watch("employee.workPlace",function(){g()}),i.onCloseModal=function(){o.close(1)},i.onCancelEmployee=function(){o.dismiss("cancel")},i.form={submit:function(e){var t=null;if(e.$invalid){var o=null,t=null;for(o in e)"$"!=o[0]&&(null!==t||e[o].$valid||(t=e[o].$name),e[o].$pristine&&(e[o].$dirty=!0));return angular.element(".ng-invalid[name="+t+"]").focus(),void n(function(){s.pop("error","Error","Por favor verifique los datos requeridos del formulario y vuelva a intentarlo")},500)}i.onSaveEmployee()},reset:function(e){e.$setPristine(!0)}},i.onSaveEmployee=function(){var e={},t=JSON.stringify(i.employee);return e.data=Base64.encode(t),l({method:"POST",url:"api/customer-employee/quickSave",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){n(function(){i.attachment=e.data.result,s.pop("success","Operación Exitosa","Registro eliminado"),i.onCloseModal()})})["catch"](function(e){a.error(e),s.pop("error","Error","Por favor ingrese los campos requeridos.")})["finally"](function(){})}}]),app.controller("ModalInstanceSideHealthDamageEmployeeListCtrl",["$rootScope","$stateParams","$scope","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile",function(e,t,i,o,a,n,r,l,s,c,d,u,p,m){i.employee={id:0},i.onCloseModal=function(){o.close(i.employee)},i.onCancel=function(){o.dismiss("cancel")},i.onLoadRecord=function(){if(0!=i.employee.id){var e={id:i.employee.id};l({method:"GET",url:"api/customer-employee",params:e})["catch"](function(e,t){if(403==t){var i=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";r.swal("No Autorizado","No estas autorizado para ver esta información.","error"),n(function(){$state.go(i)},3e3)}else 404==t?r.swal("Información no disponible","Diagnóstico no encontrado","error"):r.swal("Error","Se ha presentado un error al intentar acceder a la información del proceso","error")}).then(function(e){n(function(){i.employee=e.data.result})})["finally"](function(){n(function(){i.onCloseModal()},400)})}else i.loading=!1},i.dtInstanceDisabilityEmployeeList={},i.dtOptionsDisabilityEmployeeList=p.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerId=t.customerId,JSON.stringify(e)},url:"api/customer-employee-modal-basic",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){f()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,t,o){m(angular.element(e).contents())(i)}),i.dtColumnsDisabilityEmployeeList=[u.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,t,i,o){var a="",n="",r='<a class="btn btn-success btn-xs editRow lnk" href="#" uib-tooltip="Adicionar empleado" tooltip-placement="right"  data-id="'+e.id+'"'+n+' >   <i class="fa fa-plus-square"></i></a> ';return a+=r}),u.newColumn("documentNumber").withTitle("Número Identificación").withOption("width",200),u.newColumn("firstName").withTitle("Nombre").withOption("width",200),u.newColumn("lastName").withTitle("Apellidos").withOption("width",200),u.newColumn("workPlace").withTitle("Centro de Trabajo").withOption("width",200),u.newColumn("job").withTitle("Cargo").withOption("width",200),u.newColumn("neighborhood").withTitle("Centro de Costos").withOption("width",200),u.newColumn(null).withTitle("Estado").withOption("width",200).renderWith(function(e,t,i,o){var a="label label-danger",n="Inactivo";null==e.isActiveCode&&void 0==e.isActiveCode||("Activo"==e.isActiveCode?(a="label label-success",n="Activo"):(a="label label-danger",n="Inactivo"));var r='<span class="'+a+'">'+n+"</span>";return r}),u.newColumn(null).withTitle("Autorización").withOption("width",200).renderWith(function(e,t,i,o){var a="label label-danger",n="Inactivo";null==e.isAuthorized&&void 0==e.isAuthorized||("Autorizado"==e.isAuthorized?(a="label label-success",n="Autorizado"):"No Autorizado"==e.isAuthorized?(a="label label-danger",n="No Autorizado"):(a="label label-info",n="N/A"));var r='<span class="'+a+'">'+n+"</span>";return r})];var f=function(){$("#dtDisabilityEmployeeList a.editRow").on("click",function(){var e=$(this).data("id");i.editDisabilityEmployee(e)})};i.reloadData=function(){i.dtInstanceDisabilityEmployeeList.reloadData()},i.viewDisabilityEmployee=function(e){i.employee.id=e,i.isView=!0,i.onLoadRecord()},i.editDisabilityEmployee=function(e){i.employee.id=e,i.isView=!1,i.onLoadRecord()}}]),app.controller("ModalInstanceSideHealthDamageDiagnosticListCtrl",["$rootScope","$stateParams","$scope","$uibModalInstance","employee","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile",function(e,t,i,o,a,n,r,l,s,c,d,u,p,m,f){i.diagnostic={id:0,code:"",description:"",isActive:!0},i.onCloseModal=function(){o.close(i.diagnostic)},i.onCancel=function(){o.dismiss("cancel")},i.onLoadRecord=function(){if(0!=i.diagnostic.id){var e={id:i.diagnostic.id};s({method:"GET",url:"api/disability-diagnostic",params:e})["catch"](function(e,t){if(403==t){var i=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";l.swal("No Autorizado","No estas autorizado para ver esta información.","error"),r(function(){$state.go(i)},3e3)}else 404==t?l.swal("Información no disponible","Diagnóstico no encontrado","error"):l.swal("Error","Se ha presentado un error al intentar acceder a la información del proceso","error")}).then(function(e){r(function(){i.diagnostic=e.data.result})})["finally"](function(){r(function(){i.onCloseModal()},400)})}else i.loading=!1},i.dtInstanceDisabilityDiagnosticList={},i.dtOptionsDisabilityDiagnosticList=m.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerEmployeeId=a.id,JSON.stringify(e)},url:"api/disability-diagnostic-employee",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){h()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,t,o){f(angular.element(e).contents())(i)}),i.dtColumnsDisabilityDiagnosticList=[p.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,t,i,o){var a="",n="",r='<a class="btn btn-success btn-xs editRow lnk" href="#" uib-tooltip="Adicionar diagnóstico"  data-id="'+e.id+'"'+n+' >   <i class="fa fa-plus-square"></i></a> ';return a+=r}),p.newColumn("code").withTitle("Código").withOption("width",200),p.newColumn("description").withTitle("Diagnóstico"),p.newColumn(null).withTitle("Estado").withOption("width",200).renderWith(function(e,t,i,o){var a="label label-danger";null==e.isActive&&void 0==e.isActive||(a=e.isActive?"label label-success":"label label-danger");var n='<span class="'+a+'">'+e.status+"</span>";return n})];var h=function(){$("#dtDisabilityDiagnosticList a.editRow").on("click",function(){var e=$(this).data("id");i.editDisabilityDiagnostic(e)})};i.reloadData=function(){i.dtInstanceDisabilityDiagnostic.reloadData()},i.viewDisabilityDiagnostic=function(e){i.diagnostic.id=e,i.isView=!0,i.onLoadRecord()},i.editDisabilityDiagnostic=function(e){i.diagnostic.id=e,i.isView=!1,i.onLoadRecord()}}]);
"use strict";app.controller("customerHealthDamageDiagnosticSourceListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","SweetAlert","$http","$filter","$document",function(t,i,e,n,a,o,r,l,c,s,d,u,w,h,m){var f=e;f.info("loading..customerWorkMedicineListCtrl "),t.agents=s.agents(),t.dtInstanceHealthDamageDiagnosticSource={},t.dtOptionsHealthDamageDiagnosticSource=n.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.customerId=i.customerId,JSON.stringify(t)},url:"api/customer-health-damage-diagnostic-source",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){p()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(i,e,n){r(angular.element(i).contents())(t)}),t.dtColumnsHealthDamageDiagnosticSource=[a.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,i,e,n){var a="",o='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+t.id+'" >   <i class="fa fa-edit"></i></a> ',r='<a class="btn btn-info btn-xs viewRow lnk" href="#" uib-tooltip="Ver" data-id="'+t.id+'" >   <i class="fa fa-eye"></i></a> ',l='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+t.id+'" >   <i class="fa fa-trash-o"></i></a> ';return s.can("seguimiento_view")&&(a+=r),s.can("seguimiento_edit")&&(a+=o),s.can("seguimiento_delete")&&(a+=l),a}),a.newColumn("createdAt").withTitle("Fecha Registro").withOption("width",200).withOption("defaultContent",""),a.newColumn("documentNumber").withTitle("Número Identificación").withOption("width",200).withOption("defaultContent",""),a.newColumn("firstName").withTitle("Nombre").withOption("width",200).withOption("defaultContent",""),a.newColumn("lastName").withTitle("Apellidos").withOption("width",200).withOption("defaultContent",""),a.newColumn("occupation").withTitle("Cargo").withOption("width",200).withOption("defaultContent","")];var p=function(){$("#dtHealthDamageDiagnosticSource a.editRow").on("click",function(){var i=$(this).data("id");t.editWorkMedicine(i)}),$("#dtHealthDamageDiagnosticSource a.viewRow").on("click",function(){var i=$(this).data("id");t.viewWorkMedicine(i)}),$("#dtHealthDamageDiagnosticSource a.delRow").on("click",function(){var i=$(this).data("id");f.info("intenta eliminar el registro: "+i),u.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(n){if(n){var a={};a.id=i,w({method:"POST",url:"api/customer/health-damage/diagnostic-source/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){e.error(t),u.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){t.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};t.reloadData=function(){t.dtInstanceHealthDamageDiagnosticSource.reloadData()},t.editWorkMedicine=function(i){null!=t.$parent&&t.$parent.navToSection("form","edit",i)},t.viewWorkMedicine=function(i){null!=t.$parent&&t.$parent.navToSection("form","view",i)}}]);
"use strict";app.controller("customerHealthDamageRestrictionCtrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout",function(t,o,e,c,i,n){var r=e;r.info("loading..customerWorkMedicineCtrl!!! "),t.tracking_section="list",t.currentId=0,t.modeDsp="edit",t.navToSection=function(o,e,c){n(function(){t.tracking_section=o,t.modeDsp=e,t.$parent.switchSubTab(e),t.currentId=c})}}]);
"use strict";app.controller("customerHealthDamageRestrictionEditCtrl",["$scope","$stateParams","$log","$compile","$state","SweetAlert","$rootScope","$http","$timeout","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$uibModal","flowFactory","cfpLoadingBar","$filter","$aside","$document","FileUploader","$localStorage","toaster",function(e,t,a,n,i,o,r,l,s,c,d,u,m,h,p,f,w,g,v,D,b){var O=a,y=0,C={},R=e.$parent.currentId;e.isAgent="agent"==r.currentUser().wg_type,e.isAdmin="system"==r.currentUser().wg_type,e.isCustomer="customerAdmin"==r.currentUser().wg_type||"customerUser"==r.currentUser().wg_type,O.info("loading..customerHealthDamageRestrictionEditCtrl con el id de tracking: ",R),e.canShow=!1,e.restrictions=r.parameters("work_health_damage_restriction"),e.whoPerceived=r.parameters("work_health_damage_who_perceived"),e.observationTypeList=r.parameters("work_health_damage_restriction_observation_type"),e.accessLevelList=r.parameters("work_health_damage_restriction_observation_access"),e.arl=r.parameters("arl"),e.documentType=r.parameters("customer_document_type"),e.tiposdoc=r.parameters("tipodoc"),e.documentStatusList=r.parameters("work_health_damage_document_status"),e.classifications=r.parameters("work_health_damage_restriction_document_type"),e.isView="view"==e.$parent.modeDsp,console.log(e.isView),e.minDateCurrent=new Date,e.customerId=t.customerId,e.maxDate=new Date,e.datePickerConfig={culture:"es-CO",format:"dd/MM/yyyy HH:mm"},e.employees=[],e.onLoadRecord=function(){if(0!=e.restriction.id){O.info("editando cliente con código: "+e.restriction.id);var t={id:e.restriction.id};l({method:"GET",url:"api/customer/health-damage/restriction",params:t})["catch"](function(e,t){if(403==t){var a=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";o.swal("No Autorizado","No estas autorizado para ver esta información.","error"),s(function(){i.go(a)},3e3)}else 404==t?o.swal("Información no disponible","Centro de trabajo no encontrado","error"):o.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(t){s(function(){e.restriction=t.data.result,e.canShow=!0})})["finally"](function(){s(function(){e.loading=!1},400),s(function(){g.scrollTop(40,2e3)})})}else O.info("creacion de nuevo cliente"),e.loading=!1},e.restriction={id:R,employee:null,arl:null};var T=function(){e.detail={id:0,customerHealthDamageRestrictionId:e.restriction.id,dateOfIssue:null,timeInMonths:0,expirationDate:null,isPermanentManagement:!1,restriction:null,description:"",whoPerceived:null,observation:""}},E=function(){e.observation={id:0,customerHealthDamageRestrictionId:e.restriction.id,dateOf:new Date,type:null,accessLevel:null,description:""}},S=function(){e.attachment={id:0,customerHealthDamageRestrictionId:e.restriction.id,type:null,name:"",description:"",status:null,version:1,startDate:null,endDate:null}};T(),E(),S(),e.onLoadRecord(),e.master=e.restriction,e.form={submit:function(t){var a=null;if(t.$invalid){var n=null,a=null;for(n in t)"$"!=n[0]&&(null!==a||t[n].$valid||(a=t[n].$name),t[n].$pristine&&(t[n].$dirty=!0));return O.info(e.customer),angular.element(".ng-invalid[name="+a+"]").focus(),void o.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e intentalo de nuevo.","error")}o.swal("Validación exitosa","Procediendo con el guardado...","success"),O.info(e.customer),H()},reset:function(t){e.restriction=angular.copy(e.master),t.$setPristine(!0)}};var H=function(){var t={},n=JSON.stringify(e.restriction);return t.data=Base64.encode(n),l({method:"POST",url:"api/customer/health-damage/restriction/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){s(function(){e.restriction=t.data.result,e.canShow=!0,C.customer_health_damage_id=e.restriction.id,T(),E(),S()})})["catch"](function(e){a.error(e),o.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};e.cancelEdition=function(){null!=e.$parent&&e.$parent.navToSection("list","list")},C.customer_health_damage_id=R,e.dtInstanceHealthDamageRestrictionDetail={},e.dtOptionsHealthDamageRestrictionDetail=c.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerHealthDamageRestrictionId=R,JSON.stringify(e)},url:"api/customer-health-damage-restriction-detail",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){I()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,a,i){n(angular.element(t).contents())(e)}),e.dtColumnsHealthDamageRestrictionDetail=[d.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,a,n,i){var o="",r='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+t.id+'" >   <i class="fa fa-edit"></i></a> ',l='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+t.id+'" >   <i class="fa fa-trash-o"></i></a> ';return o+=r,o+=l,e.isView?"":o}),d.newColumn("dateOfIssue").withTitle("Fecha Emision").withOption("width",200).withOption("defaultContent",""),d.newColumn("expirationDate").withTitle("Fecha Vencimiento").withOption("width",200).withOption("defaultContent",""),d.newColumn("item").withTitle("Restricción").withOption("width",200).withOption("defaultContent",""),d.newColumn("description").withTitle("Descripción").withOption("width",200).withOption("defaultContent",""),d.newColumn("isPermanentManagement").withTitle("Manejo Permanente").withOption("width",200).renderWith(function(e,t,a,n){var i="",o="";return e||"1"==e?(o="Si",i="label label-success"):(o="No",i="label label-danger"),'<span class="'+i+'">'+o+"</span>"})];var I=function(){$("#dtHealthDamageRestrictionDetail a.editRow").on("click",function(){var t=$(this).data("id");e.editHealthDamageRestrictionDetail(t)}),$("#dtHealthDamageRestrictionDetail a.delRow").on("click",function(){var t=$(this).data("id");O.info("intenta eliminar el registro: "+t),o.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(n){if(n){var i={};i.id=t,l({method:"POST",url:"api/customer/health-damage/restriction-detail/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){a.error(e),o.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){e.reloadDataHealthDamageRestrictionDetail()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};e.dtInstanceHealthDamageRestrictionDetailCallback=function(t){e.dtInstanceHealthDamageRestrictionDetail=t},e.reloadDataHealthDamageRestrictionDetail=function(){e.dtInstanceHealthDamageRestrictionDetail.reloadData()},e.editHealthDamageRestrictionDetail=function(t){if(t){var a={id:t};l({method:"GET",url:"api/customer/health-damage/restriction-detail",params:a})["catch"](function(e,t){if(403==t){var a=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";o.swal("No Autorizado","No estas autorizado para ver esta información.","error"),s(function(){i.go(a)},3e3)}else 404==t?o.swal("Información no disponible","Centro de trabajo no encontrado","error"):o.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(t){s(function(){e.detail=t.data.result,null!=e.detail.dateOfIssue&&(e.detail.dateOfIssue=new Date(e.detail.dateOfIssue.date)),null!=e.detail.expirationDate&&(e.detail.expirationDate=new Date(e.detail.expirationDate.date))})})["finally"](function(){s(function(){e.loading=!1},400),s(function(){})})}else O.info("creacion de nuevo cliente"),e.loading=!1},e.saveHealthDamageRestrictionDetail=function(){var t={},n=JSON.stringify(e.detail);return null!=e.detail.whoPerceived&&0!=e.detail.timeInMonths&&null!=e.detail.dateOfIssue&&null!=e.detail.restriction?(t.data=Base64.encode(n),l({method:"POST",url:"api/customer/health-damage/restriction-detail/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){s(function(){e.clearHealthDamageRestrictionDetail(),e.reloadDataHealthDamageRestrictionDetail()})})["catch"](function(e){a.error(e),o.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})):void o.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e intentalo de nuevo.","error")},e.clearHealthDamageRestrictionDetail=function(){T()},C.customer_health_damage_id=R,e.dtInstanceHealthDamageRestrictionObservation={},e.dtOptionsHealthDamageRestrictionObservation=c.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerHealthDamageRestrictionId=R,JSON.stringify(e)},url:"api/customer-health-damage-restriction-observation",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){P()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,a,i){n(angular.element(t).contents())(e)}),e.dtColumnsHealthDamageRestrictionObservation=[d.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,a,n,i){var o="",r='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+t.id+'" >   <i class="fa fa-edit"></i></a> ',l='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+t.id+'" >   <i class="fa fa-trash-o"></i></a> ';return o+=r,o+=l,e.isView?"":o}),d.newColumn("dateOf").withTitle("Fecha").withOption("width",200).withOption("defaultContent",""),d.newColumn("name").withTitle("Usuario").withOption("width",200).withOption("defaultContent",""),d.newColumn("type").withTitle("Restricción").withOption("width",200).withOption("defaultContent",""),d.newColumn("accessLevel").withTitle("Nivel acceso").withOption("width",200).renderWith(function(e,t,a,n){var i="";return i="Pública"==e?"label label-success":"label label-danger",'<span class="'+i+'">'+e+"</span>"}),d.newColumn("description").withTitle("Observación").withOption("defaultContent","")];var P=function(){$("#dtHealthDamageRestrictionObservation a.editRow").on("click",function(){var t=$(this).data("id");e.editHealthDamageRestrictionObservation(t)}),$("#dtHealthDamageRestrictionObservation a.delRow").on("click",function(){var t=$(this).data("id");O.info("intenta eliminar el registro: "+t),o.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(n){if(n){var i={};i.id=t,l({method:"POST",url:"api/customer/health-damage/restriction-observation/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){a.error(e),o.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){e.reloadDataHealthDamageRestrictionObservation()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};e.dtInstanceHealthDamageRestrictionObservationCallback=function(t){e.dtInstanceHealthDamageRestrictionObservation=t},e.reloadDataHealthDamageRestrictionObservation=function(){e.dtInstanceHealthDamageRestrictionObservation.reloadData()},e.editHealthDamageRestrictionObservation=function(t){if(t){var a={id:t};l({method:"GET",url:"api/customer/health-damage/restriction-observation",params:a})["catch"](function(e,t){if(403==t){var a=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";o.swal("No Autorizado","No estas autorizado para ver esta información.","error"),s(function(){i.go(a)},3e3)}else 404==t?o.swal("Información no disponible","Centro de trabajo no encontrado","error"):o.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(t){s(function(){e.observation=t.data.result,null!=e.observation.dateOf&&(e.observation.dateOf=new Date(e.observation.dateOf.date))})})["finally"](function(){s(function(){e.loading=!1},400),s(function(){})})}else O.info("creacion de nuevo cliente"),e.loading=!1},e.saveHealthDamageRestrictionObservation=function(){var t={},n=JSON.stringify(e.observation);return null!=e.observation.type&&null!=e.observation.accessLevel?(t.data=Base64.encode(n),l({method:"POST",url:"api/customer/health-damage/restriction-observation/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){s(function(){e.clearHealthDamageRestrictionObservation(),e.reloadDataHealthDamageRestrictionObservation()})})["catch"](function(e){a.error(e),o.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})):void o.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e intentalo de nuevo.","error")},e.clearHealthDamageRestrictionObservation=function(){E()},C.customer_health_damage_id=R,e.dtInstanceHealthDamageRestrictionDocument={},e.dtOptionsHealthDamageRestrictionDocument=c.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerHealthDamageRestrictionId=R,JSON.stringify(e)},url:"api/customer-health-damage-restriction-document",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){_()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,a,i){n(angular.element(t).contents())(e)}),e.dtColumnsHealthDamageRestrictionDocument=[d.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,a,n,i){var o="",r=null!=t.document?t.document.path:"",l='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+t.id+'" >   <i class="fa fa-edit"></i></a> ',s='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+t.id+'" >   <i class="fa fa-trash-o"></i></a> ',c='<a target="_self" class="btn btn-info btn-xs downloadRow lnk" href="#" uib-tooltip="Descargar anexo" data-id="'+t.id+'" data-url="'+r+'" >   <i class="fa fa-download"></i></a> ';return o+=l,""!=r&&(o+=c),o+=s,e.isView?c:o}),d.newColumn("type").withTitle("Tipo").withOption("width",200).withOption("defaultContent",""),d.newColumn("name").withTitle("Nombre").withOption("width",200).withOption("defaultContent",""),d.newColumn("description").withTitle("Descripción").withOption("defaultContent",""),d.newColumn("version").withTitle("Version").withOption("width",200).withOption("defaultContent",""),d.newColumn("status").withTitle("Estado").withOption("width",200).renderWith(function(e,t,a,n){var i="",o="";return"Activo"==e?(o=e,i="label label-success"):(o=e,i="label label-danger"),'<span class="'+i+'">'+o+"</span>"})];var _=function(){$("#dtHealthDamageRestrictionDocument a.editRow").on("click",function(){var t=$(this).data("id");e.editHealthDamageRestrictionDocument(t)}),$("#dtHealthDamageRestrictionDocument a.downloadRow").on("click",function(){var e=$(this).data("id"),t=$(this).data("url");""==t?b.pop("error","Error en la descarga","No existe un anexo para descargar"):jQuery("#download")[0].src="api/customer/health-damage/restriction-document/download?id="+e}),$("#dtHealthDamageRestrictionDocument a.delRow").on("click",function(){var t=$(this).data("id");O.info("intenta eliminar el registro: "+t),o.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(n){if(n){var i={};i.id=t,l({method:"POST",url:"api/customer/health-damage/restriction-document/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){a.error(e),o.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){e.reloadDataHealthDamageRestrictionDocument()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};e.dtInstanceHealthDamageRestrictionDocumentCallback=function(t){e.dtInstanceHealthDamageRestrictionDocument=t},e.reloadDataHealthDamageRestrictionDocument=function(){e.dtInstanceHealthDamageRestrictionDocument.reloadData()},e.editHealthDamageRestrictionDocument=function(t){if(t){var a={id:t};l({method:"GET",url:"api/customer/health-damage/restriction-document",params:a})["catch"](function(e,t){if(403==t){var a=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";o.swal("No Autorizado","No estas autorizado para ver esta información.","error"),s(function(){i.go(a)},3e3)}else 404==t?o.swal("Información no disponible","Centro de trabajo no encontrado","error"):o.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(t){s(function(){e.attachment=t.data.result,null!=e.attachment.startDate&&(e.attachment.startDate=new Date(e.attachment.startDate.date)),null!=e.attachment.endDate&&(e.attachment.endDate=new Date(e.attachment.endDate.date))})})["finally"](function(){s(function(){e.loading=!1},400),s(function(){})})}else O.info("creacion de nuevo cliente"),e.loading=!1},e.saveHealthDamageRestrictionDocument=function(){var t={},n=JSON.stringify(e.attachment);return null!=e.attachment.type&&""!=e.attachment.name&&null!=e.attachment.status&&""!=e.attachment.description?(t.data=Base64.encode(n),l({method:"POST",url:"api/customer/health-damage/restriction-document/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){s(function(){e.uploader.queue.length>0?(y=t.data.result.id,k.uploadAll()):(e.clearHealthDamageRestrictionDocument(),e.reloadDataHealthDamageRestrictionDocument())})})["catch"](function(e){a.error(e),o.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})):void o.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e intentalo de nuevo.","error")},e.clearHealthDamageRestrictionDocument=function(){S()};var k=e.uploader=new v({url:"api/customer/health-damage/restriction-document/upload",formData:[],removeAfterUpload:!0});k.filters.push({name:"customFilter",fn:function(e,t){return this.queue.length<10}}),k.onBeforeUploadItem=function(e){console.info("onBeforeUploadItem",e);var t={id:y};e.formData.push(t)},k.onCompleteAll=function(){console.info("onCompleteAll"),e.clearHealthDamageRestrictionDocument(),e.reloadDataHealthDamageRestrictionDocument()},e.onAddEmployee=function(){var t=w.open({templateUrl:r.app.views.urlRoot+"modules/customer/occupational/health-damage/restriction/customer_absenteeism_disability_employee_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideHealthDamageRestrictionEmployeeCtrl",scope:e});t.result.then(function(){})},e.onAddDisabilityEmployeeList=function(){var t=w.open({templateUrl:r.app.views.urlRoot+"modules/customer/occupational/health-damage/restriction/customer_absenteeism_disability_employee_list_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideHealthDamageRestrictionEmployeeListCtrl",scope:e});t.result.then(function(t){var a=f("filter")(e.employees,{id:t.id});0==a.length&&e.employees.push(t),e.restriction.employee=t})};var x=function(){if(O.info("calculateDate"),null!=e.detail.dateOfIssue&&null!=e.detail.timeInMonths){var t=new Date(e.detail.dateOfIssue);t.setMonth(t.getMonth()+parseInt(e.detail.timeInMonths)),e.detail.expirationDate=t}};e.$watch("detail.dateOfIssue",function(){x()}),e.$watch("detail.timeInMonths",function(){x()})}]),app.controller("ModalInstanceSideHealthDamageRestrictionEmployeeCtrl",["$rootScope","$stateParams","$scope","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile",function(e,t,a,n,i,o,r,l,s,c,d,u,m,h){a.contractTypes=e.parameters("employee_contract_type"),a.documentTypes=e.parameters("employee_document_type");var p=function(){a.employee={id:0,customerId:t.customerId,isActive:!0,contractType:null,job:null,workPlace:null,salary:0,entity:{id:0,documentType:null,documentNumber:"",firstName:"",lastName:"",isActive:!0}}};p();var f=function(){var e={};return e.operation="restriction",e.customerId=t.customerId,l({method:"POST",url:"api/customer/config-sgsst/workplace/listProcess",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){o(function(){a.workPlaces=e.data.data})})["catch"](function(e){})["finally"](function(){})};f();var w=function(){if(null!=a.employee.workPlace){var e={};return e.operation="restriction",e.customerId=t.customerId,e.workPlaceId=a.employee.workPlace.id,l({method:"POST",url:"api/customer/config-sgsst/job/listByWorkPlace",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){o(function(){a.jobs=e.data.data})})["catch"](function(e){})["finally"](function(){})}a.jobs=[]};a.$watch("employee.workPlace",function(){w()}),a.onCloseModal=function(){n.close(1)},a.onCancelEmployee=function(){n.dismiss("cancel")},a.form={submit:function(e){var t=null;if(e.$invalid){var n=null,t=null;for(n in e)"$"!=n[0]&&(null!==t||e[n].$valid||(t=e[n].$name),e[n].$pristine&&(e[n].$dirty=!0));return angular.element(".ng-invalid[name="+t+"]").focus(),void o(function(){s.pop("error","Error","Por favor verifique los datos requeridos del formulario y vuelva a intentarlo")},500)}a.onSaveEmployee()},reset:function(e){e.$setPristine(!0)}},a.onSaveEmployee=function(){var e={},t=JSON.stringify(a.employee);return e.data=Base64.encode(t),l({method:"POST",url:"api/customer-employee/quickSave",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){o(function(){a.attachment=e.data.result,s.pop("success","Operación Exitosa","Registro eliminado"),a.onCloseModal()})})["catch"](function(e){i.error(e),s.pop("error","Error","Por favor ingrese los campos requeridos.")})["finally"](function(){})}}]),app.controller("ModalInstanceSideHealthDamageRestrictionEmployeeListCtrl",["$rootScope","$stateParams","$scope","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile",function(e,t,a,n,i,o,r,l,s,c,d,u,m,h){a.employee={id:0},a.onCloseModal=function(){n.close(a.employee)},a.onCancel=function(){n.dismiss("cancel")},a.onLoadRecord=function(){if(0!=a.employee.id){var e={id:a.employee.id};l({method:"GET",url:"api/customer-employee",params:e})["catch"](function(e,t){if(403==t){var a=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";r.swal("No Autorizado","No estas autorizado para ver esta información.","error"),o(function(){$state.go(a)},3e3)}else 404==t?r.swal("Información no disponible","Diagnóstico no encontrado","error"):r.swal("Error","Se ha presentado un error al intentar acceder a la información del proceso","error")}).then(function(e){o(function(){a.employee=e.data.result})})["finally"](function(){o(function(){a.onCloseModal()},400)})}else a.loading=!1},a.dtInstanceDisabilityEmployeeList={},a.dtOptionsDisabilityEmployeeList=m.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerId=t.customerId,JSON.stringify(e)},url:"api/customer-employee-modal-basic",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){p()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,t,n){h(angular.element(e).contents())(a)}),a.dtColumnsDisabilityEmployeeList=[u.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,t,a,n){var i="",o="",r='<a class="btn btn-success btn-xs editRow lnk" href="#" uib-tooltip="Adicionar empleado" tooltip-placement="right"  data-id="'+e.id+'"'+o+' >   <i class="fa fa-plus-square"></i></a> ';return i+=r}),u.newColumn("documentNumber").withTitle("Número Identificación").withOption("width",200),u.newColumn("firstName").withTitle("Nombre").withOption("width",200),u.newColumn("lastName").withTitle("Apellidos").withOption("width",200),u.newColumn("workPlace").withTitle("Centro de Trabajo").withOption("width",200),u.newColumn("job").withTitle("Cargo").withOption("width",200),u.newColumn("neighborhood").withTitle("Centro de Costos").withOption("width",200),u.newColumn(null).withTitle("Estado").withOption("width",200).renderWith(function(e,t,a,n){var i="label label-danger",o="Inactivo";null==e.isActiveCode&&void 0==e.isActiveCode||("Activo"==e.isActiveCode?(i="label label-success",o="Activo"):(i="label label-danger",o="Inactivo"));var r='<span class="'+i+'">'+o+"</span>";return r}),u.newColumn(null).withTitle("Autorización").withOption("width",200).renderWith(function(e,t,a,n){var i="label label-danger",o="Inactivo";null==e.isAuthorized&&void 0==e.isAuthorized||("Autorizado"==e.isAuthorized?(i="label label-success",o="Autorizado"):"No Autorizado"==e.isAuthorized?(i="label label-danger",o="No Autorizado"):(i="label label-info",o="N/A"));var r='<span class="'+i+'">'+o+"</span>";return r})];var p=function(){$("#dtDisabilityEmployeeList a.editRow").on("click",function(){var e=$(this).data("id");a.editDisabilityEmployee(e)})};a.reloadData=function(){a.dtInstanceDisabilityEmployeeList.reloadData()},a.viewDisabilityEmployee=function(e){a.employee.id=e,a.isView=!0,a.onLoadRecord()},a.editDisabilityEmployee=function(e){a.employee.id=e,a.isView=!1,a.onLoadRecord()}}]);
"use strict";app.controller("customerHealthDamageRestrictionListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","SweetAlert","$http","$filter","$document",function(t,i,e,n,a,o,r,l,s,c,d,w,u,h,p){var m=e;m.info("loading..customerWorkMedicineListCtrl "),t.agents=c.agents(),t.dtInstanceHealthDamageRestriction={},t.dtOptionsHealthDamageRestriction=n.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.customerId=i.customerId,JSON.stringify(t)},url:"api/customer-health-damage-restriction",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){f()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(i,e,n){r(angular.element(i).contents())(t)}),t.dtColumnsHealthDamageRestriction=[a.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,i,e,n){var a="",o='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+t.id+'" >   <i class="fa fa-edit"></i></a> ',r='<a class="btn btn-info btn-xs viewRow lnk" href="#" uib-tooltip="Ver" data-id="'+t.id+'" >   <i class="fa fa-eye"></i></a> ',l='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+t.id+'" >   <i class="fa fa-trash-o"></i></a> ';return c.can("seguimiento_view")&&(a+=r),c.can("seguimiento_edit")&&(a+=o),c.can("seguimiento_delete")&&(a+=l),a}),a.newColumn("createdAt").withTitle("Fecha Registro").withOption("width",200).withOption("defaultContent",""),a.newColumn("documentNumber").withTitle("Número Identificación").withOption("width",200).withOption("defaultContent",""),a.newColumn("firstName").withTitle("Nombre").withOption("width",200).withOption("defaultContent",""),a.newColumn("lastName").withTitle("Apellidos").withOption("width",200).withOption("defaultContent",""),a.newColumn("occupation").withTitle("Cargo").withOption("width",200).withOption("defaultContent","")];var f=function(){$("#dtHealthDamageRestriction a.editRow").on("click",function(){var i=$(this).data("id");t.editWorkMedicine(i)}),$("#dtHealthDamageRestriction a.viewRow").on("click",function(){var i=$(this).data("id");t.viewWorkMedicine(i)}),$("#dtHealthDamageRestriction a.delRow").on("click",function(){var i=$(this).data("id");m.info("intenta eliminar el registro: "+i),w.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(n){if(n){var a={};a.id=i,u({method:"POST",url:"api/customer/health-damage/restriction/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){e.error(t),w.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){t.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};t.reloadData=function(){t.dtInstanceHealthDamageRestriction.reloadData()},t.editWorkMedicine=function(i){null!=t.$parent&&t.$parent.navToSection("form","edit",i)},t.viewWorkMedicine=function(i){null!=t.$parent&&t.$parent.navToSection("form","view",i)};var O={customer_id:0};t.dtInstanceHealthDamageDisability={},t.dtOptionsHealthDamageDisability=n.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:O,url:"api/customer/health-damage/restriction",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){f()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(i,e,n){r(angular.element(i).contents())(t)}),t.dtColumnsHealthDamageDisability=[a.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,i,e,n){var a="",o='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+t.id+'" >   <i class="fa fa-edit"></i></a> ',r='<a class="btn btn-info btn-xs viewRow lnk" href="#" uib-tooltip="Ver" data-id="'+t.id+'" >   <i class="fa fa-eye"></i></a> ',l='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+t.id+'" >   <i class="fa fa-trash-o"></i></a> ';return c.can("seguimiento_view")&&(a+=r),c.can("seguimiento_edit")&&(a+=o),c.can("seguimiento_delete")&&(a+=l),a}),a.newColumn("examinationDateFormat").withTitle("Fecha Registro").withOption("width",200).withOption("defaultContent",""),a.newColumn("employee.entity.firstName").withTitle("Nombre").withOption("width",200).withOption("defaultContent",""),a.newColumn("employee.entity.lastName").withTitle("Apellidos").withOption("width",200).withOption("defaultContent",""),a.newColumn("employee.job.name").withTitle("Cargo").withOption("width",200).withOption("defaultContent","")]}]);
"use strict";app.controller("customerHealthDamageQualificationSourceCtrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout",function(t,o,e,c,i,n){var r=e;r.info("loading..customerWorkMedicineCtrl!!! "),t.tracking_section="list",t.currentId=0,t.modeDsp="edit",t.navToSection=function(o,e,c){n(function(){t.tracking_section=o,t.modeDsp=e,t.$parent.switchSubTab(e),t.currentId=c})}}]);
"use strict";app.controller("customerHealthDamageQualificationSourceEditCtrl",["$scope","$stateParams","$log","$compile","$state","SweetAlert","$rootScope","$http","$timeout","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$uibModal","flowFactory","cfpLoadingBar","$filter","$aside","$document","toaster","FileUploader",function(t,e,a,i,n,o,r,l,s,c,d,u,m,h,p,f,g,D,w,v){var O=a,y={},S=0,C=t.$parent.currentId;t.isAgent="agent"==r.currentUser().wg_type,t.isAdmin="system"==r.currentUser().wg_type,t.isCustomer="customerAdmin"==r.currentUser().wg_type||"customerUser"==r.currentUser().wg_type,O.info("loading..customerHealthDamageQualificationSourceEditCtrl con el id: ",C),t.arl=r.parameters("arl"),t.documentType=r.parameters("customer_document_type"),t.tiposdoc=r.parameters("tipodoc"),t.diagnosticList=r.parameters("work_health_damage_diagnostic"),t.lateralities=r.parameters("work_health_damage_laterality"),t.entityPerformsDiagnostic=r.parameters("work_health_damage_entity_perform_diagnostic"),t.codeCIE10=r.parameters("work_health_damage_code_cie_10"),t.applicants=r.parameters("work_health_damage_applicant"),t.directors=r.parameters("work_health_damage_apt"),t.supports=r.parameters("work_health_damage_diagnostic_support"),t.documents=r.parameters("work_health_damage_diagnostic_document"),t.qualifyingEntities=r.parameters("work_health_damage_entity_qualify"),t.qualifiedOrigins=r.parameters("work_health_damage_entity_qualify_origin"),t.controversyStatus=r.parameters("work_health_damage_controversy_status"),t.classifications=r.parameters("work_health_damage_qs_document_type"),t.documentStatusList=r.parameters("work_health_damage_document_status"),t.canShow=!1,t.isView="view"==t.$parent.modeDsp,t.minDateCurrent=new Date,t.customerId=e.customerId,t.maxDate=new Date,t.datePickerConfig={culture:"es-CO",format:"dd/MM/yyyy HH:mm"},t.employees=[],t.diagnostics=[],t.onLoadRecord=function(){if(0!=t.qs.id){O.info("editando cliente con código: "+t.qs.id);var e={id:t.qs.id};l({method:"GET",url:"api/customer/health-damage/qs",params:e})["catch"](function(t,e){if(403==e){var a=null!==t.message&&void 0!==t.message?t.message:"app.clientes.list";o.swal("No Autorizado","No estas autorizado para ver esta información.","error"),s(function(){n.go(a)},3e3)}else 404==e?o.swal("Información no disponible","Centro de trabajo no encontrado","error"):o.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(e){s(function(){t.qs=e.data.result,t.canShow=!0,null!=t.qs.diagnostic&&""!=t.qs.diagnostic&&(t.diagnostic=t.qs.diagnostic,t.diagnostic.dateOf&&(t.diagnostic.dateOf=new Date(t.diagnostic.dateOf.date)),t.diagnostic.requestDate&&(t.diagnostic.requestDate=new Date(t.diagnostic.requestDate.date)),t.diagnostic.dateSend&&(t.diagnostic.dateSend=new Date(t.diagnostic.dateSend.date)),t.diagnostic.dateReceived&&(t.diagnostic.dateReceived=new Date(t.diagnostic.dateReceived.date)),t.diagnosticAttachment.entityId=t.diagnostic.id,t.reloadDataHealthDamageQsDiagnosticDocument()),null!=t.qs.opportunity&&""!=t.qs.opportunity&&(t.opportunity=t.qs.opportunity,t.opportunity.dateOf&&(t.opportunity.dateOf=new Date(t.opportunity.dateOf.date)),t.opportunity.notificationDate&&(t.opportunity.notificationDate=new Date(t.opportunity.notificationDate.date)),t.opportunity.filingDate&&(t.opportunity.filingDate=new Date(t.opportunity.filingDate.date)),t.opportunityDetail.customerHealthDamageQsFirstOpportunityId=t.opportunity.id,t.opportunityAttachment.entityId=t.opportunity.id,t.reloadDataHealthDamageQsFirstOpportunityDetail(),t.reloadDataHealthDamageQsFirstOpportunityDocument()),null!=t.qs.regional&&""!=t.qs.regional&&(t.regional=t.qs.regional,t.regional.dateOf&&(t.regional.dateOf=new Date(t.regional.dateOf.date)),t.regional.notificationDate&&(t.regional.notificationDate=new Date(t.regional.notificationDate.date)),t.regional.filingDate&&(t.regional.filingDate=new Date(t.regional.filingDate.date)),t.regionalDetail.customerHealthDamageQsRegionalBoardId=t.regional.id,t.regionalAttachment.entityId=t.regional.id,t.reloadDataHealthDamageQsRegionalBoardDetail(),t.reloadDataHealthDamageQsRegionalBoardDocument()),null!=t.qs.national&&""!=t.qs.national&&(t.national=t.qs.national,t.national.dateOf&&(t.national.dateOf=new Date(t.national.dateOf.date)),t.national.notificationDate&&(t.national.notificationDate=new Date(t.national.notificationDate.date)),t.nationalDetail.customerHealthDamageQsNationalBoardId=t.national.id,t.nationalAttachment.entityId=t.national.id,t.reloadDataHealthDamageQsNationalBoardDetail(),t.reloadDataHealthDamageQsNationalBoardDocument()),null!=t.qs.justiceFirst&&""!=t.qs.justiceFirst&&(t.justiceFirst=t.qs.justiceFirst,t.justiceFirst.dateOf&&(t.justiceFirst.dateOf=new Date(t.justiceFirst.dateOf.date)),t.justiceFirstDetail.customerHealthDamageQsJusticeBoardId=t.justiceFirst.id,t.justiceFirstAttachment.entityId=t.justiceFirst.id,t.reloadDataHealthDamageQsJusticeBoardFirstDetail(),t.reloadDataHealthDamageQsJusticeBoardFirstDocument()),null!=t.qs.justiceSecond&&""!=t.qs.justiceSecond&&(t.justiceSecond=t.qs.justiceSecond,t.justiceSecond.dateOf&&(t.justiceSecond.dateOf=new Date(t.justiceSecond.dateOf.date)),t.justiceSecondDetail.customerHealthDamageQsJusticeBoardId=t.justiceSecond.id,t.justiceSecondAttachment.entityId=t.justiceSecond.id,t.reloadDataHealthDamageQsJusticeBoardSecondDetail(),t.reloadDataHealthDamageQsJusticeBoardSecondDocument()),null!=t.qs.justiceThird&&""!=t.qs.justiceThird&&(t.justiceThird=t.qs.justiceThird,t.justiceThird.dateOf&&(t.justiceThird.dateOf=new Date(t.justiceThird.dateOf.date)),t.justiceThirdDetail.customerHealthDamageQsJusticeBoardId=t.justiceThird.id,t.justiceThirdAttachment.entityId=t.justiceThird.id,t.reloadDataHealthDamageQsJusticeBoardThirdDetail(),t.reloadDataHealthDamageQsJusticeBoardThirdDocument())})})["finally"](function(){s(function(){t.loading=!1},400),s(function(){D.scrollTop(40,2e3)})})}else O.info("creacion de nuevo cliente"),t.loading=!1},t.qs={id:C,employee:null,arl:null,stepQualificationFirstOpportunity:!1,stepQualificationRegionalBoard:!1,stepQualificationNationalBoard:!1,stepQualificationLaborJustice:!1,stepSecondInstance:!1,stepThirdInstance:!1,isActive:!0,diagnostic:null,opportunity:null,regional:null,national:null,justiceFirst:null,justiceSecond:null,justiceThird:null};var b=function(){t.diagnostic={id:0,customerHealthDamageQualificationSourceId:t.qs.id,dateOf:null,diagnostic:null,laterality:null,entityPerformsDiagnostic:null,codeCIE10:null,description:"",isRequestedSupport:!0,requestDate:null,applicant:null,directorApt:null,dateSend:null,dateReceived:null,supports:[],documents:[]},t.diagnosticAttachment={id:0,customerHealthDamageQualificationSourceId:t.qs.id,entityId:t.diagnostic.id,entityCode:"diagnostic",entityName:"Diagnóstico",type:null,name:"",description:"",version:"1",status:{item:"Activo",value:"Activo"},startDate:null,endDate:null},t.opportunity={id:0,customerHealthDamageQualificationSourceId:t.qs.id,dateOf:null,opinionNumber:0,qualifyingEntity:null,notificationDate:null,description:"",filingDate:null,isRemainedFirm:!0},t.opportunityDetail={id:0,customerHealthDamageQsFirstOpportunityId:t.opportunity.id,diagnostic:null,qualifiedOrigin:null,controversyStatus:null},t.opportunityAttachment={id:0,customerHealthDamageQualificationSourceId:t.qs.id,entityId:t.opportunity.id,entityCode:"opportunity",entityName:"Calificación Primera Oportunidad",type:null,name:"",description:"",version:"1",status:{item:"Activo",value:"Activo"},startDate:null,endDate:null},t.regional={id:0,customerHealthDamageQualificationSourceId:t.qs.id,dateOf:null,opinionNumber:0,qualifyingEntity:null,notificationDate:null,description:"",filingDate:null,isRemainedFirm:!0},t.regionalDetail={id:0,customerHealthDamageQsRegionalBoardId:t.regional.id,diagnostic:null,qualifiedOrigin:null,controversyStatus:null},t.regionalAttachment={id:0,customerHealthDamageQualificationSourceId:t.qs.id,entityId:t.regional.id,entityCode:"regional",entityName:"Calificación Junta Regional",type:null,name:"",description:"",version:"1",status:{item:"Activo",value:"Activo"},startDate:null,endDate:null},t.national={id:0,customerHealthDamageQualificationSourceId:t.qs.id,dateOf:null,opinionNumber:0,notificationDate:null,description:""},t.nationalDetail={id:0,customerHealthDamageQsNationalBoardId:t.national.id,diagnostic:null,qualifiedOrigin:null,controversyStatus:null},t.nationalAttachment={id:0,customerHealthDamageQualificationSourceId:t.qs.id,entityId:t.national.id,entityCode:"national",entityName:"Calificación Junta Nacional",type:null,name:"",description:"",version:"1",status:{item:"Activo",value:"Activo"},startDate:null,endDate:null},t.justiceFirst={id:0,customerHealthDamageQualificationSourceId:t.qs.id,instance:"first",dateOf:null,judgment:"",claimant:"",defendant:"",numberProcess:""},t.justiceFirstDetail={id:0,customerHealthDamageQsJusticeBoardId:t.justiceFirst.id,diagnostic:null,qualifiedOrigin:null,controversyStatus:null},t.justiceFirstAttachment={id:0,customerHealthDamageQualificationSourceId:t.qs.id,entityId:t.justiceFirst.id,entityCode:"justiceFirst",entityName:"Calificación Justicia Laboral / Primera Instancia",type:null,name:"",description:"",version:"1",status:{item:"Activo",value:"Activo"},startDate:null,endDate:null},t.justiceSecond={id:0,customerHealthDamageQualificationSourceId:t.qs.id,instance:"second",dateOf:null,judgment:"",claimant:"",defendant:"",numberProcess:""},t.justiceSecondDetail={id:0,customerHealthDamageQsJusticeBoardId:t.justiceSecond.id,diagnostic:null,qualifiedOrigin:null,controversyStatus:null},t.justiceSecondAttachment={id:0,customerHealthDamageQualificationSourceId:t.qs.id,entityId:t.justiceSecond.id,entityCode:"justiceSecond",entityName:"Calificación Justicia Laboral / Segunda Instancia",type:null,name:"",description:"",version:"1",status:{item:"Activo",value:"Activo"},startDate:null,endDate:null},t.justiceThird={id:0,customerHealthDamageQualificationSourceId:t.qs.id,instance:"third",dateOf:null,judgment:"",claimant:"",defendant:"",numberProcess:""},t.justiceThirdDetail={id:0,customerHealthDamageQsJusticeBoardId:t.justiceThird.id,diagnostic:null,qualifiedOrigin:null,controversyStatus:null},t.justiceThirdAttachment={id:0,customerHealthDamageQualificationSourceId:t.qs.id,entityId:t.justiceThird.id,entityCode:"justiceThird",entityName:"Calificación Justicia Laboral / Tercera Instancia",type:null,name:"",description:"",version:"1",status:{item:"Activo",value:"Activo"},startDate:null,endDate:null}};b(),t.onLoadRecord(),t.master=t.qs,t.form={submit:function(e){var a=null;if(e.$invalid){var i=null,a=null;for(i in e)"$"!=i[0]&&(null!==a||e[i].$valid||(a=e[i].$name),e[i].$pristine&&(e[i].$dirty=!0));return O.info(t.customer),angular.element(".ng-invalid[name="+a+"]").focus(),void o.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}o.swal("Validación exitosa","Procediendo con el guardado...","success"),O.info(t.customer),Q()},reset:function(e){t.qs=angular.copy(t.master),e.$setPristine(!0)}};var Q=function(){var e={},i=JSON.stringify(t.qs);return e.data=Base64.encode(i),l({method:"POST",url:"api/customer/health-damage/qs/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){s(function(){t.qs=e.data.result,t.canShow=!0,b()})})["catch"](function(t){a.error(t),o.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};t.cancelEdition=function(){null!=t.$parent&&t.$parent.navToSection("list","list")},t.onAddDiagnosticSupport=function(){s(function(){null==t.diagnostic.supports&&(t.diagnostic.supports=[]),t.diagnostic.supports.push({id:0,customerHealthDamageQualificationSourceDiagnosticId:0,support:null,description:""})})},t.onRemoveDiagnosticSupport=function(e){o.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(i){i?s(function(){var i=t.diagnostic.supports[e];if(t.diagnostic.supports.splice(e,1),0!=i.id){var n={};n.id=i.id,l({method:"POST",url:"api/customer/health-damage/qs/diagnostic-support/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){a.error(t),o.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})},t.onAddDiagnosticDocument=function(){s(function(){null==t.diagnostic.documents&&(t.diagnostic.documents=[]),t.diagnostic.documents.push({id:0,customerHealthDamageQualificationSourceDiagnosticId:0,document:null,description:""})})},t.onRemoveDiagnosticSupport=function(e){o.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(i){i?s(function(){var i=t.diagnostic.documents[e];if(t.diagnostic.documents.splice(e,1),0!=i.id){var n={};n.id=i.id,l({method:"POST",url:"api/customer/health-damage/qs/diagnostic-document/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){a.error(t),o.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})},t.saveHealthDamageQsDiagnostic=function(){var e={},i=JSON.stringify(t.diagnostic);return e.data=Base64.encode(i),null!=t.diagnostic.laterality&&null!=t.diagnostic.entityPerformsDiagnostic&&null!=t.diagnostic.codeCIE10&&null!=t.diagnostic.applicant&&null!=t.diagnostic.directorApt?l({method:"POST",url:"api/customer/health-damage/qs/diagnostic/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){s(function(){w.pop("success","Operación Exitosa","Se guardó la información exitosamente..."),t.diagnostic=e.data.result,t.diagnostic.dateOf=new Date(t.diagnostic.dateOf.date),t.diagnostic.requestDate=new Date(t.diagnostic.requestDate.date),t.diagnostic.dateSend=new Date(t.diagnostic.dateSend.date),t.diagnostic.dateReceived=new Date(t.diagnostic.dateReceived.date),t.clearHealthDamageQsDiagnosticDocument()})})["catch"](function(t){a.error(t),o.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){}):void o.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e intentalo de nuevo.","error")},t.dtInstanceHealthDamageQsDiagnosticDocument={},t.dtOptionsHealthDamageQsDiagnosticDocument=c.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerHealthDamageQualificationSourceId=t.qs.id,e.entityCode="diagnostic",e.entityId=t.diagnostic.id,JSON.stringify(e)},url:"api/customer-health-damage-qs-document",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){T()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,a,n){i(angular.element(e).contents())(t)}),t.dtColumnsHealthDamageQsDiagnosticDocument=[d.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,a,i,n){var o="",r=null!=e.document?e.document.path:"",l='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+e.id+'" >   <i class="fa fa-edit"></i></a> ',s='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+e.id+'" >   <i class="fa fa-trash-o"></i></a> ',c='<a target="_self" class="btn btn-info btn-xs downloadRow lnk" href="#" uib-tooltip="Descargar anexo" data-id="'+e.id+'" data-url="'+r+'" >   <i class="fa fa-download"></i></a> ';return o+=l,""!=r&&(o+=c),o+=s,t.isView?c:o}),d.newColumn("item").withTitle("Tipo").withOption("width",200).withOption("defaultContent",""),d.newColumn("name").withTitle("Nombre").withOption("width",200).withOption("defaultContent",""),d.newColumn("description").withTitle("Descripción").withOption("defaultContent",""),d.newColumn("version").withTitle("Version").withOption("width",200).withOption("defaultContent",""),d.newColumn("status").withTitle("Estado").withOption("width",150).renderWith(function(t,e,a,i){var n="",o="";return"Activo"==t?(o=t,n="label label-success"):(o=t,n="label label-danger"),'<span class="'+n+'">'+o+"</span>"})];var T=function(){$("#dtHealthDamageQsDiagnosticDocument a.editRow").on("click",function(){var e=$(this).data("id");t.editHealthDamageQsDiagnosticDocument(e)}),$("#dtHealthDamageQsDiagnosticDocument a.downloadRow").on("click",function(){var t=$(this).data("id"),e=$(this).data("url");""==e?w.pop("error","Error en la descarga","No existe un anexo para descargar"):jQuery("#download")[0].src="api/customer/health-damage/qs/document/download?id="+t}),$("#dtHealthDamageQsDiagnosticDocument a.delRow").on("click",function(){var e=$(this).data("id");O.info("intenta eliminar el registro: "+e),o.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(i){if(i){var n={};n.id=e,l({method:"POST",url:"api/customer/health-damage/qs/document/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){a.error(t),o.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){t.reloadDataHealthDamageQsDiagnosticDocument()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};t.dtInstanceHealthDamageQsDiagnosticDocumentCallback=function(e){t.dtInstanceHealthDamageQsDiagnosticDocument=e,t.reloadDataHealthDamageQsDiagnosticDocument()},t.reloadDataHealthDamageQsDiagnosticDocument=function(){void 0!=t.dtInstanceHealthDamageQsDiagnosticDocument.reloadData&&t.dtInstanceHealthDamageQsDiagnosticDocument.reloadData()},t.editHealthDamageQsDiagnosticDocument=function(e){if(e){var a={id:e};l({method:"GET",url:"api/customer/health-damage/qs/document",params:a})["catch"](function(t,e){if(403==e){var a=null!==t.message&&void 0!==t.message?t.message:"app.clientes.list";o.swal("No Autorizado","No estas autorizado para ver esta información.","error"),s(function(){n.go(a)},3e3)}else 404==e?o.swal("Información no disponible","Centro de trabajo no encontrado","error"):o.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(e){s(function(){t.diagnosticAttachment=e.data.result,null!=t.diagnosticAttachment.startDate&&(t.diagnosticAttachment.startDate=new Date(t.diagnosticAttachment.startDate.date)),null!=t.diagnosticAttachment.endDate&&(t.diagnosticAttachment.endDate=new Date(t.diagnosticAttachment.endDate.date))})})["finally"](function(){s(function(){t.loading=!1},400),s(function(){})})}else O.info("creacion de nuevo cliente"),t.loading=!1},t.saveHealthDamageQsDiagnosticDocument=function(){var e={},i=JSON.stringify(t.diagnosticAttachment);return e.data=Base64.encode(i),null!=t.diagnosticAttachment.type&&""!=t.diagnosticAttachment.name&&null!=t.diagnosticAttachment.status&&""!=t.diagnosticAttachment.description?l({method:"POST",url:"api/customer/health-damage/qs/document/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){s(function(){w.pop("success","Operación Exitosa","Se guardó la información exitosamente..."),t.uploaderDiagnostic.queue.length>0?(S=e.data.result.id,k.uploadAll()):(t.clearHealthDamageQsDiagnosticDocument(),t.reloadDataHealthDamageQsDiagnosticDocument(),t.reloadDataHealthDamageQsDocument())})})["catch"](function(t){a.error(t),o.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){}):void o.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e intentalo de nuevo.","error")},t.clearHealthDamageQsDiagnosticDocument=function(){t.diagnosticAttachment={id:0,customerHealthDamageQualificationSourceId:t.qs.id,entityId:t.diagnostic.id,entityCode:"diagnostic",entityName:"Diagnóstico",type:null,name:"",description:"",version:"1",status:{item:"Activo",value:"Activo"},startDate:null,endDate:null}},t.saveHealthDamageQsFirstOpportunity=function(){var e={},i=JSON.stringify(t.opportunity);return e.data=Base64.encode(i),l({method:"POST",url:"api/customer/health-damage/qs/opportunity/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){s(function(){w.pop("success","Operación Exitosa","Se guardó la información exitosamente..."),t.opportunity=e.data.result,t.opportunity.dateOf=new Date(t.opportunity.dateOf.date),t.opportunity.notificationDate=new Date(t.opportunity.notificationDate.date),t.opportunity.filingDate=new Date(t.opportunity.filingDate.date),t.clearHealthDamageQsFirstOpportunityDetail(),t.clearHealthDamageQsFirstOpportunityDocument()})})["catch"](function(t){a.error(t),o.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})},y.customer_health_damage_id=t.opportunity.id,t.dtInstanceHealthDamageQsOpportunityDetail={},t.dtOptionsHealthDamageQsOpportunityDetail=c.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerHealthDamageQsFirstOpportunityId=t.opportunity.id,JSON.stringify(e)},url:"api/customer-health-damage-qs-opportunity-detail",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){H()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,a,n){i(angular.element(e).contents())(t)}),t.dtColumnsHealthDamageQsOpportunityDetail=[d.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,a,i,n){var o="",l='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+e.id+'" >   <i class="fa fa-edit"></i></a> ',s='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+e.id+'" >   <i class="fa fa-trash-o"></i></a> ';return r.can("seguimiento_edit")&&(o+=l),r.can("seguimiento_delete")&&(o+=s),t.isView?null:o}),d.newColumn("diagnostic").withTitle("Diagnóstico").withOption("defaultContent",""),d.newColumn("origen").withTitle("Origen calificado").withOption("defaultContent",""),d.newColumn("status").withTitle("Estado de controversia").withOption("width",200).withOption("defaultContent","")];var H=function(){$("#dtHealthDamageQsOpportunityDetail a.editRow").on("click",function(){var e=$(this).data("id");console.log(e),t.editHealthDamageQsFirstOpportunityDetail(e)}),$("#dtHealthDamageQsOpportunityDetail a.delRow").on("click",function(){var e=$(this).data("id");O.info("intenta eliminar el registro: "+e),o.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(i){if(i){var n={};n.id=e,l({method:"POST",url:"api/customer/health-damage/qs/opportunity-detail/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){a.error(t),o.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){t.reloadDataHealthDamageQsFirstOpportunityDetail()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};t.dtInstanceHealthDamageQsOpportunityDetailCallback=function(e){t.dtInstanceHealthDamageQsOpportunityDetail=e,t.reloadDataHealthDamageQsFirstOpportunityDetail()},t.reloadDataHealthDamageQsFirstOpportunityDetail=function(){y.customer_health_damage_id=t.opportunity.id,void 0!=t.dtInstanceHealthDamageQsOpportunityDetail.reloadData&&t.dtInstanceHealthDamageQsOpportunityDetail.reloadData()},t.editHealthDamageQsFirstOpportunityDetail=function(e){if(e){var a={id:e};l({method:"GET",url:"api/customer/health-damage/qs/opportunity-detail",params:a})["catch"](function(t,e){if(403==e){var a=null!==t.message&&void 0!==t.message?t.message:"app.clientes.list";o.swal("No Autorizado","No estas autorizado para ver esta información.","error"),s(function(){n.go(a)},3e3)}else 404==e?o.swal("Información no disponible","Centro de trabajo no encontrado","error"):o.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(e){s(function(){t.opportunityDetail=e.data.result})})["finally"](function(){s(function(){t.loading=!1},400),s(function(){D.scrollTop(40,2e3)})})}else O.info("creacion de nuevo cliente"),t.loading=!1},t.saveHealthDamageQsFirstOpportunityDetail=function(){var e={},i=JSON.stringify(t.opportunityDetail);return e.data=Base64.encode(i),null!=t.opportunityDetail.diagnostic&&null!=t.opportunityDetail.qualifiedOrigin&&null!=t.opportunityDetail.controversyStatus?l({method:"POST",url:"api/customer/health-damage/qs/opportunity-detail/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){s(function(){w.pop("success","Operación Exitosa","Se guardó la información exitosamente..."),t.clearHealthDamageQsFirstOpportunityDetail(),t.reloadDataHealthDamageQsFirstOpportunityDetail()})})["catch"](function(t){a.error(t),o.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){}):void o.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e intentalo de nuevo.","error")},t.clearHealthDamageQsFirstOpportunityDetail=function(){t.opportunityDetail={id:0,customerHealthDamageQsFirstOpportunityId:t.opportunity.id,diagnostic:null,qualifiedOrigin:null,controversyStatus:null}},t.dtInstanceHealthDamageQsOpportunityDocument={},t.dtOptionsHealthDamageQsOpportunityDocument=c.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerHealthDamageQualificationSourceId=t.qs.id,e.entityCode="opportunity",e.entityId=t.opportunity.id,JSON.stringify(e)},url:"api/customer-health-damage-qs-document",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){B()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,a,n){i(angular.element(e).contents())(t)}),t.dtColumnsHealthDamageQsOpportunityDocument=[d.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,a,i,n){var o="",r=null!=e.document?e.document.path:"",l='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+e.id+'" >   <i class="fa fa-edit"></i></a> ',s='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+e.id+'" >   <i class="fa fa-trash-o"></i></a> ',c='<a target="_self" class="btn btn-info btn-xs downloadRow lnk" href="#" uib-tooltip="Descargar anexo" data-id="'+e.id+'" data-url="'+r+'" >   <i class="fa fa-download"></i></a> ';return o+=l,""!=r&&(o+=c),o+=s,t.isView?c:o}),d.newColumn("item").withTitle("Tipo").withOption("width",200).withOption("defaultContent",""),d.newColumn("name").withTitle("Nombre").withOption("width",200).withOption("defaultContent",""),d.newColumn("description").withTitle("Descripción").withOption("defaultContent",""),d.newColumn("version").withTitle("Version").withOption("width",200).withOption("defaultContent",""),d.newColumn("status").withTitle("Estado").withOption("width",150).renderWith(function(t,e,a,i){var n="",o="";return"Activo"==t?(o=t,n="label label-success"):(o=t,n="label label-danger"),'<span class="'+n+'">'+o+"</span>"})];var B=function(){$("#dtHealthDamageQsOpportunityDocument a.editRow").on("click",function(){var e=$(this).data("id");t.editHealthDamageQsFirstOpportunityDocument(e)}),$("#dtHealthDamageQsOpportunityDocument a.downloadRow").on("click",function(){var t=$(this).data("id"),e=$(this).data("url");""==e?w.pop("error","Error en la descarga","No existe un anexo para descargar"):jQuery("#download")[0].src="api/customer/health-damage/qs/document/download?id="+t}),$("#dtHealthDamageQsOpportunityDocument a.delRow").on("click",function(){var e=$(this).data("id");O.info("intenta eliminar el registro: "+e),o.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(i){if(i){var n={};n.id=e,l({method:"POST",url:"api/customer/health-damage/qs/document/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){a.error(t),o.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){t.reloadDataHealthDamageQsFirstOpportunityDocument()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};t.dtInstanceHealthDamageQsOpportunityDocumentCallback=function(e){t.dtInstanceHealthDamageQsOpportunityDocument=e,t.reloadDataHealthDamageQsFirstOpportunityDocument()},t.reloadDataHealthDamageQsFirstOpportunityDocument=function(){void 0!=t.dtInstanceHealthDamageQsOpportunityDocument.reloadData&&t.dtInstanceHealthDamageQsOpportunityDocument.reloadData()},t.editHealthDamageQsFirstOpportunityDocument=function(e){if(e){var a={id:e};l({method:"GET",url:"api/customer/health-damage/qs/document",params:a})["catch"](function(t,e){if(403==e){var a=null!==t.message&&void 0!==t.message?t.message:"app.clientes.list";o.swal("No Autorizado","No estas autorizado para ver esta información.","error"),s(function(){n.go(a)},3e3)}else 404==e?o.swal("Información no disponible","Centro de trabajo no encontrado","error"):o.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(e){s(function(){t.opportunityAttachment=e.data.result,null!=t.opportunityAttachment.startDate&&(t.opportunityAttachment.startDate=new Date(t.opportunityAttachment.startDate.date)),
null!=t.opportunityAttachment.endDate&&(t.opportunityAttachment.endDate=new Date(t.opportunityAttachment.endDate.date))})})["finally"](function(){s(function(){t.loading=!1},400),s(function(){})})}else O.info("creacion de nuevo cliente"),t.loading=!1},t.saveHealthDamageQsFirstOpportunityDocument=function(){var e={},i=JSON.stringify(t.opportunityAttachment);return e.data=Base64.encode(i),null!=t.opportunityAttachment.type&&""!=t.opportunityAttachment.name&&null!=t.opportunityAttachment.status&&""!=t.opportunityAttachment.description?l({method:"POST",url:"api/customer/health-damage/qs/document/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){s(function(){w.pop("success","Operación Exitosa","Se guardó la información exitosamente..."),t.uploaderOpportunity.queue.length>0?(S=e.data.result.id,F.uploadAll()):(t.clearHealthDamageQsFirstOpportunityDocument(),t.reloadDataHealthDamageQsFirstOpportunityDocument(),t.reloadDataHealthDamageQsDocument())})})["catch"](function(t){a.error(t),o.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){}):void o.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e intentalo de nuevo.","error")},t.clearHealthDamageQsFirstOpportunityDocument=function(){t.opportunityAttachment={id:0,customerHealthDamageQualificationSourceId:t.qs.id,entityId:t.opportunity.id,entityCode:"opportunity",entityName:"Calificación Primera Oportunidad",type:null,name:"",description:"",version:"1",status:{item:"Activo",value:"Activo"},startDate:null,endDate:null}},t.saveHealthDamageQsRegionalBoard=function(){var e={},i=JSON.stringify(t.regional);return e.data=Base64.encode(i),l({method:"POST",url:"api/customer/health-damage/qs/regional/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){s(function(){w.pop("success","Operación Exitosa","Se guardó la información exitosamente..."),t.regional=e.data.result,t.regional.dateOf=new Date(t.regional.dateOf.date),t.regional.notificationDate=new Date(t.regional.notificationDate.date),t.regional.filingDate=new Date(t.regional.filingDate.date),t.clearHealthDamageQsRegionalBoardDetail(),t.clearHealthDamageQsRegionalBoardDocument()})})["catch"](function(t){a.error(t),o.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})},y.customer_health_damage_regional_id=t.regional.id,t.dtInstanceHealthDamageQsRegionalDetail={},t.dtOptionsHealthDamageQsRegionalDetail=c.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerHealthDamageQsRegionalBoardId=t.regional.id,JSON.stringify(e)},url:"api/customer-health-damage-qs-regional-detail",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){j()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,a,n){i(angular.element(e).contents())(t)}),t.dtColumnsHealthDamageQsRegionalDetail=[d.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,a,i,n){var o="",l='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+e.id+'" >   <i class="fa fa-edit"></i></a> ',s='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+e.id+'" >   <i class="fa fa-trash-o"></i></a> ';return r.can("seguimiento_edit")&&(o+=l),r.can("seguimiento_delete")&&(o+=s),t.isView?null:o}),d.newColumn("diagnostic").withTitle("Diagnóstico").withOption("width",200).withOption("defaultContent",""),d.newColumn("origen").withTitle("Origen calificado").withOption("width",200).withOption("defaultContent",""),d.newColumn("status").withTitle("Estado de controversia").withOption("width",200).withOption("defaultContent","")];var j=function(){$("#dtHealthDamageQsRegionalDetail a.editRow").on("click",function(){var e=$(this).data("id");t.editHealthDamageQsRegionalBoardDetail(e)}),$("#dtHealthDamageQsRegionalDetail a.delRow").on("click",function(){var e=$(this).data("id");O.info("intenta eliminar el registro: "+e),o.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(i){if(i){var n={};n.id=e,l({method:"POST",url:"api/customer/health-damage/qs/regional-detail/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){a.error(t),o.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){t.reloadDataHealthDamageQsRegionalBoardDetail()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};t.dtInstanceHealthDamageQsRegionalDetailCallback=function(e){t.dtInstanceHealthDamageQsRegionalDetail=e,t.reloadDataHealthDamageQsRegionalBoardDetail()},t.reloadDataHealthDamageQsRegionalBoardDetail=function(){y.customer_health_damage_regional_id=t.regional.id,void 0!=t.dtInstanceHealthDamageQsRegionalDetail.reloadData&&t.dtInstanceHealthDamageQsRegionalDetail.reloadData()},t.editHealthDamageQsRegionalBoardDetail=function(e){if(e){var a={id:e};l({method:"GET",url:"api/customer/health-damage/qs/regional-detail",params:a})["catch"](function(t,e){if(403==e){var a=null!==t.message&&void 0!==t.message?t.message:"app.clientes.list";o.swal("No Autorizado","No estas autorizado para ver esta información.","error"),s(function(){n.go(a)},3e3)}else 404==e?o.swal("Información no disponible","Centro de trabajo no encontrado","error"):o.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(e){s(function(){t.regionalDetail=e.data.result})})["finally"](function(){s(function(){t.loading=!1},400),s(function(){D.scrollTop(40,2e3)})})}else O.info("creacion de nuevo cliente"),t.loading=!1},t.saveHealthDamageQsRegionalBoardDetail=function(){var e={},i=JSON.stringify(t.regionalDetail);return e.data=Base64.encode(i),null!=t.regionalDetail.diagnostic&&null!=t.regionalDetail.qualifiedOrigin&&null!=t.regionalDetail.controversyStatus?l({method:"POST",url:"api/customer/health-damage/qs/regional-detail/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){s(function(){w.pop("success","Operación Exitosa","Se guardó la información exitosamente..."),t.clearHealthDamageQsRegionalBoardDetail(),t.reloadDataHealthDamageQsRegionalBoardDetail()})})["catch"](function(t){a.error(t),o.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){}):void o.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e intentalo de nuevo.","error")},t.clearHealthDamageQsRegionalBoardDetail=function(){t.regionalDetail={id:0,customerHealthDamageQsRegionalBoardId:t.regional.id,diagnostic:null,qualifiedOrigin:null,controversyStatus:null}},t.dtInstanceHealthDamageQsRegionalDocument={},t.dtOptionsHealthDamageQsRegionalDocument=c.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerHealthDamageQualificationSourceId=t.qs.id,e.entityCode="regional",e.entityId=t.regional.id,JSON.stringify(e)},url:"api/customer-health-damage-qs-document",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){E()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,a,n){i(angular.element(e).contents())(t)}),t.dtColumnsHealthDamageQsRegionalDocument=[d.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,a,i,n){var o="",r=null!=e.document?e.document.path:"",l='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+e.id+'" >   <i class="fa fa-edit"></i></a> ',s='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+e.id+'" >   <i class="fa fa-trash-o"></i></a> ',c='<a target="_self" class="btn btn-info btn-xs downloadRow lnk" href="#" uib-tooltip="Descargar anexo" data-id="'+e.id+'" data-url="'+r+'" >   <i class="fa fa-download"></i></a> ';return o+=l,""!=r&&(o+=c),o+=s,t.isView?c:o}),d.newColumn("item").withTitle("Tipo").withOption("width",200).withOption("defaultContent",""),d.newColumn("name").withTitle("Nombre").withOption("width",200).withOption("defaultContent",""),d.newColumn("description").withTitle("Descripción").withOption("defaultContent",""),d.newColumn("version").withTitle("Version").withOption("width",200).withOption("defaultContent",""),d.newColumn("status").withTitle("Estado").withOption("width",150).renderWith(function(t,e,a,i){var n="",o="";return"Activo"==t?(o=t,n="label label-success"):(o=t,n="label label-danger"),'<span class="'+n+'">'+o+"</span>"})];var E=function(){$("#dtHealthDamageQsRegionalDocument a.editRow").on("click",function(){var e=$(this).data("id");t.editHealthDamageQsRegionalBoardDocument(e)}),$("#dtHealthDamageQsRegionalDocument a.downloadRow").on("click",function(){var t=$(this).data("id"),e=$(this).data("url");""==e?w.pop("error","Error en la descarga","No existe un anexo para descargar"):jQuery("#download")[0].src="api/customer/health-damage/qs/document/download?id="+t}),$("#dtHealthDamageQsRegionalDocument a.delRow").on("click",function(){var e=$(this).data("id");O.info("intenta eliminar el registro: "+e),o.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(i){if(i){var n={};n.id=e,l({method:"POST",url:"api/customer/health-damage/qs/document/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){a.error(t),o.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){t.reloadDataHealthDamageQsRegionalBoardDocument()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};t.dtInstanceHealthDamageQsRegionalDocumentCallback=function(e){t.dtInstanceHealthDamageQsRegionalDocument=e,t.reloadDataHealthDamageQsRegionalBoardDocument()},t.reloadDataHealthDamageQsRegionalBoardDocument=function(){void 0!=t.dtInstanceHealthDamageQsRegionalDocument.reloadData&&t.dtInstanceHealthDamageQsRegionalDocument.reloadData()},t.editHealthDamageQsRegionalBoardDocument=function(e){if(e){var a={id:e};l({method:"GET",url:"api/customer/health-damage/qs/document",params:a})["catch"](function(t,e){if(403==e){var a=null!==t.message&&void 0!==t.message?t.message:"app.clientes.list";o.swal("No Autorizado","No estas autorizado para ver esta información.","error"),s(function(){n.go(a)},3e3)}else 404==e?o.swal("Información no disponible","Centro de trabajo no encontrado","error"):o.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(e){s(function(){t.regionalAttachment=e.data.result,null!=t.regionalAttachment.startDate&&(t.regionalAttachment.startDate=new Date(t.regionalAttachment.startDate.date)),null!=t.regionalAttachment.endDate&&(t.regionalAttachment.endDate=new Date(t.regionalAttachment.endDate.date))})})["finally"](function(){s(function(){t.loading=!1},400),s(function(){})})}else O.info("creacion de nuevo cliente"),t.loading=!1},t.saveHealthDamageQsRegionalBoardDocument=function(){var e={},i=JSON.stringify(t.regionalAttachment);return e.data=Base64.encode(i),null!=t.regionalAttachment.type&&""!=t.regionalAttachment.name&&null!=t.regionalAttachment.status&&""!=t.regionalAttachment.description?l({method:"POST",url:"api/customer/health-damage/qs/document/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){s(function(){w.pop("success","Operación Exitosa","Se guardó la información exitosamente..."),t.uploaderRegional.queue.length>0?(S=e.data.result.id,L.uploadAll()):(t.clearHealthDamageQsRegionalBoardDocument(),t.reloadDataHealthDamageQsRegionalBoardDocument(),t.reloadDataHealthDamageQsDocument())})})["catch"](function(t){a.error(t),o.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){}):void o.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e intentalo de nuevo.","error")},t.clearHealthDamageQsRegionalBoardDocument=function(){t.regionalAttachment={id:0,customerHealthDamageQualificationSourceId:t.qs.id,entityId:t.regional.id,entityCode:"regional",entityName:"Calificación Junta Regional",type:null,name:"",description:"",version:"1",status:{item:"Activo",value:"Activo"},startDate:null,endDate:null}},t.saveHealthDamageQsNationalBoard=function(){var e={},i=JSON.stringify(t.national);return e.data=Base64.encode(i),l({method:"POST",url:"api/customer/health-damage/qs/national/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){s(function(){w.pop("success","Operación Exitosa","Se guardó la información exitosamente..."),t.national=e.data.result,t.national.dateOf=new Date(t.national.dateOf.date),t.national.notificationDate=new Date(t.national.notificationDate.date),t.clearHealthDamageQsNationalBoardDetail(),t.clearHealthDamageQsNationalBoardDocument()})})["catch"](function(t){a.error(t),o.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})},y.customer_health_damage_national_id=t.national.id,t.dtInstanceHealthDamageQsNationalDetail={},t.dtOptionsHealthDamageQsNationalDetail=c.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerHealthDamageQsNationalId=t.national.id,JSON.stringify(e)},url:"api/customer-health-damage-qs-national-detail",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){A()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,a,n){i(angular.element(e).contents())(t)}),t.dtColumnsHealthDamageQsNationalDetail=[d.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,a,i,n){var o="",l='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+e.id+'" >   <i class="fa fa-edit"></i></a> ',s='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+e.id+'" >   <i class="fa fa-trash-o"></i></a> ';return r.can("seguimiento_edit")&&(o+=l),r.can("seguimiento_delete")&&(o+=s),t.isView?null:o}),d.newColumn("diagnostic").withTitle("Diagnóstico").withOption("defaultContent",""),d.newColumn("origen").withTitle("Origen calificado").withOption("defaultContent",""),d.newColumn("status").withTitle("Estado de controversia").withOption("width",200).withOption("defaultContent","")];var A=function(){$("#dtHealthDamageQsNationalDetail a.editRow").on("click",function(){var e=$(this).data("id");t.editHealthDamageQsNationalBoardDetail(e)}),$("#dtHealthDamageQsNationalDetail a.delRow").on("click",function(){var e=$(this).data("id");O.info("intenta eliminar el registro: "+e),o.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(i){if(i){var n={};n.id=e,l({method:"POST",url:"api/customer/health-damage/qs/national-detail/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){a.error(t),o.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){t.reloadDataHealthDamageQsNationalBoardDetail()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};t.dtInstanceHealthDamageQsNationalDetailCallback=function(e){t.dtInstanceHealthDamageQsNationalDetail=e,t.reloadDataHealthDamageQsNationalBoardDetail()},t.reloadDataHealthDamageQsNationalBoardDetail=function(){y.customer_health_damage_national_id=t.national.id,void 0!=t.dtInstanceHealthDamageQsNationalDetail.reloadData&&t.dtInstanceHealthDamageQsNationalDetail.reloadData()},t.editHealthDamageQsNationalBoardDetail=function(e){if(e){var a={id:e};l({method:"GET",url:"api/customer/health-damage/qs/national-detail",params:a})["catch"](function(t,e){if(403==e){var a=null!==t.message&&void 0!==t.message?t.message:"app.clientes.list";o.swal("No Autorizado","No estas autorizado para ver esta información.","error"),s(function(){n.go(a)},3e3)}else 404==e?o.swal("Información no disponible","Centro de trabajo no encontrado","error"):o.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(e){s(function(){t.nationalDetail=e.data.result})})["finally"](function(){s(function(){t.loading=!1},400),s(function(){D.scrollTop(40,2e3)})})}else O.info("creacion de nuevo cliente"),t.loading=!1},t.saveHealthDamageQsNationalBoardDetail=function(){var e={},i=JSON.stringify(t.nationalDetail);return e.data=Base64.encode(i),null!=t.nationalDetail.diagnostic&&null!=t.nationalDetail.qualifiedOrigin&&null!=t.nationalDetail.controversyStatus?l({method:"POST",url:"api/customer/health-damage/qs/national-detail/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){s(function(){w.pop("success","Operación Exitosa","Se guardó la información exitosamente..."),t.clearHealthDamageQsNationalBoardDetail(),t.reloadDataHealthDamageQsNationalBoardDetail()})})["catch"](function(t){a.error(t),o.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){}):void o.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e intentalo de nuevo.","error")},t.clearHealthDamageQsNationalBoardDetail=function(){t.nationalDetail={id:0,customerHealthDamageQsNationalBoardId:t.national.id,diagnostic:null,qualifiedOrigin:null,controversyStatus:null}},t.dtInstanceHealthDamageQsNationalDocument={},t.dtOptionsHealthDamageQsNationalDocument=c.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerHealthDamageQualificationSourceId=t.qs.id,e.entityCode="national",e.entityId=t.national.id,JSON.stringify(e)},url:"api/customer-health-damage-qs-document",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){q()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,a,n){i(angular.element(e).contents())(t)}),t.dtColumnsHealthDamageQsNationalDocument=[d.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,a,i,n){var o="",r=null!=e.document?e.document.path:"",l='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+e.id+'" >   <i class="fa fa-edit"></i></a> ',s='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+e.id+'" >   <i class="fa fa-trash-o"></i></a> ',c='<a target="_self" class="btn btn-info btn-xs downloadRow lnk" href="#" uib-tooltip="Descargar anexo" data-id="'+e.id+'" data-url="'+r+'" >   <i class="fa fa-download"></i></a> ';return o+=l,""!=r&&(o+=c),o+=s,t.isView?c:o}),d.newColumn("item").withTitle("Tipo").withOption("width",200).withOption("defaultContent",""),d.newColumn("name").withTitle("Nombre").withOption("width",200).withOption("defaultContent",""),d.newColumn("description").withTitle("Descripción").withOption("defaultContent",""),d.newColumn("version").withTitle("Version").withOption("width",200).withOption("defaultContent",""),d.newColumn("status").withTitle("Estado").withOption("width",150).renderWith(function(t,e,a,i){var n="",o="";return"Activo"==t?(o=t,n="label label-success"):(o=t,n="label label-danger"),'<span class="'+n+'">'+o+"</span>"})];var q=function(){$("#dtHealthDamageQsNationalDocument a.editRow").on("click",function(){var e=$(this).data("id");t.editHealthDamageQsNationalBoardDocument(e)}),$("#dtHealthDamageQsNationalDocument a.downloadRow").on("click",function(){var t=$(this).data("id"),e=$(this).data("url");""==e?w.pop("error","Error en la descarga","No existe un anexo para descargar"):jQuery("#download")[0].src="api/customer/health-damage/qs/document/download?id="+t}),$("#dtHealthDamageQsNationalDocument a.delRow").on("click",function(){var e=$(this).data("id");O.info("intenta eliminar el registro: "+e),o.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(i){if(i){var n={};n.id=e,l({method:"POST",url:"api/customer/health-damage/qs/document/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){a.error(t),o.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){t.reloadDataHealthDamageQsNationalBoardDocument()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};t.dtInstanceHealthDamageQsNationalDocumentCallback=function(e){t.dtInstanceHealthDamageQsNationalDocument=e,t.reloadDataHealthDamageQsNationalBoardDocument()},t.reloadDataHealthDamageQsNationalBoardDocument=function(){void 0!=t.dtInstanceHealthDamageQsNationalDocument.reloadData&&t.dtInstanceHealthDamageQsNationalDocument.reloadData()},t.editHealthDamageQsNationalBoardDocument=function(e){if(e){var a={id:e};l({method:"GET",url:"api/customer/health-damage/qs/document",params:a})["catch"](function(t,e){if(403==e){var a=null!==t.message&&void 0!==t.message?t.message:"app.clientes.list";o.swal("No Autorizado","No estas autorizado para ver esta información.","error"),s(function(){n.go(a)},3e3)}else 404==e?o.swal("Información no disponible","Centro de trabajo no encontrado","error"):o.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(e){s(function(){t.nationalAttachment=e.data.result,null!=t.nationalAttachment.startDate&&(t.nationalAttachment.startDate=new Date(t.nationalAttachment.startDate.date)),null!=t.nationalAttachment.endDate&&(t.nationalAttachment.endDate=new Date(t.nationalAttachment.endDate.date))})})["finally"](function(){s(function(){t.loading=!1},400),s(function(){})})}else O.info("creacion de nuevo cliente"),t.loading=!1},t.saveHealthDamageQsNationalBoardDocument=function(){var e={},i=JSON.stringify(t.nationalAttachment);return e.data=Base64.encode(i),null!=t.nationalAttachment.type&&""!=t.nationalAttachment.name&&null!=t.nationalAttachment.status&&""!=t.nationalAttachment.description?l({method:"POST",url:"api/customer/health-damage/qs/document/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){s(function(){w.pop("success","Operación Exitosa","Se guardó la información exitosamente..."),t.uploaderNational.queue.length>0?(S=e.data.result.id,z.uploadAll()):(t.clearHealthDamageQsNationalBoardDocument(),t.reloadDataHealthDamageQsNationalBoardDocument(),t.reloadDataHealthDamageQsDocument())})})["catch"](function(t){a.error(t),o.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){}):void o.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e intentalo de nuevo.","error")},t.clearHealthDamageQsNationalBoardDocument=function(){t.nationalAttachment={id:0,customerHealthDamageQualificationSourceId:t.qs.id,entityId:t.national.id,entityCode:"national",entityName:"Calificación Junta Nacional",type:null,name:"",description:"",version:"1",status:{item:"Activo",value:"Activo"},startDate:null,endDate:null}},t.saveHealthDamageQsJusticeBoardFirst=function(){var e={},i=JSON.stringify(t.justiceFirst);return e.data=Base64.encode(i),l({method:"POST",url:"api/customer/health-damage/qs/justice/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){s(function(){w.pop("success","Operación Exitosa","Se guardó la información exitosamente..."),t.justiceFirst=e.data.result,t.justiceFirst.dateOf=new Date(t.justiceFirst.dateOf.date),t.clearHealthDamageQsJusticeBoardFirstDetail(),t.clearHealthDamageQsJusticeBoardFirstDocument()})})["catch"](function(t){a.error(t),o.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})},y.customer_health_damage_justiceFirst_id=t.justiceFirst.id,t.dtInstanceHealthDamageQsJusticeFirstDetail={},t.dtOptionsHealthDamageQsJusticeFirstDetail=c.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerHealthDamageQsId=t.justiceFirst.id,JSON.stringify(e)},url:"api/customer-health-damage-qs-justice-detail",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){I()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,a,n){i(angular.element(e).contents())(t)}),t.dtColumnsHealthDamageQsJusticeFirstDetail=[d.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,a,i,n){var o="",l='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+e.id+'" >   <i class="fa fa-edit"></i></a> ',s='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+e.id+'" >   <i class="fa fa-trash-o"></i></a> ';return r.can("seguimiento_edit")&&(o+=l),r.can("seguimiento_delete")&&(o+=s),t.isView?null:o}),d.newColumn("diagnostic").withTitle("Diagnóstico").withOption("defaultContent",""),d.newColumn("origen").withTitle("Origen calificado").withOption("width",200).withOption("defaultContent",""),d.newColumn("status").withTitle("Estado de controversia").withOption("width",200).withOption("defaultContent","")];var I=function(){$("#dtHealthDamageQsJusticeFirstDetail a.editRow").on("click",function(){var e=$(this).data("id");t.editHealthDamageQsJusticeBoardFirstDetail(e)}),$("#dtHealthDamageQsJusticeFirstDetail a.delRow").on("click",function(){var e=$(this).data("id");O.info("intenta eliminar el registro: "+e),o.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(i){if(i){var n={};n.id=e,l({method:"POST",url:"api/customer/health-damage/qs/justice-detail/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){a.error(t),o.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){t.reloadDataHealthDamageQsJusticeBoardFirstDetail()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};t.dtInstanceHealthDamageQsJusticeFirstDetailCallback=function(e){t.dtInstanceHealthDamageQsJusticeFirstDetail=e,t.reloadDataHealthDamageQsJusticeBoardFirstDetail()},t.reloadDataHealthDamageQsJusticeBoardFirstDetail=function(){y.customer_health_damage_justiceFirst_id=t.justiceFirst.id,void 0!=t.dtInstanceHealthDamageQsJusticeFirstDetail.reloadData&&t.dtInstanceHealthDamageQsJusticeFirstDetail.reloadData()},t.editHealthDamageQsJusticeBoardFirstDetail=function(e){if(e){var a={id:e};l({method:"GET",url:"api/customer/health-damage/qs/justice-detail",params:a})["catch"](function(t,e){if(403==e){var a=null!==t.message&&void 0!==t.message?t.message:"app.clientes.list";o.swal("No Autorizado","No estas autorizado para ver esta información.","error"),s(function(){n.go(a)},3e3)}else 404==e?o.swal("Información no disponible","Centro de trabajo no encontrado","error"):o.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(e){s(function(){t.justiceFirstDetail=e.data.result})})["finally"](function(){s(function(){t.loading=!1},400),s(function(){D.scrollTop(40,2e3)})})}else O.info("creacion de nuevo cliente"),t.loading=!1},t.saveHealthDamageQsJusticeBoardFirstDetail=function(){var e={},i=JSON.stringify(t.justiceFirstDetail);return e.data=Base64.encode(i),null!=t.justiceFirstDetail.diagnostic&&null!=t.justiceFirstDetail.qualifiedOrigin&&null!=t.justiceFirstDetail.controversyStatus?l({method:"POST",url:"api/customer/health-damage/qs/justice-detail/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){s(function(){w.pop("success","Operación Exitosa","Se guardó la información exitosamente..."),t.clearHealthDamageQsJusticeBoardFirstDetail(),t.reloadDataHealthDamageQsJusticeBoardFirstDetail()})})["catch"](function(t){a.error(t),o.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){}):void o.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e intentalo de nuevo.","error")},t.clearHealthDamageQsJusticeBoardFirstDetail=function(){t.justiceFirstDetail={id:0,customerHealthDamageQsJusticeBoardId:t.justiceFirst.id,diagnostic:null,qualifiedOrigin:null,controversyStatus:null}},t.dtInstanceHealthDamageQsJusticeFirstDocument={},t.dtOptionsHealthDamageQsJusticeFirstDocument=c.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerHealthDamageQualificationSourceId=t.qs.id,e.entityCode="justiceFirst",e.entityId=t.justiceFirst.id,JSON.stringify(e)},url:"api/customer-health-damage-qs-document",type:"POST",beforeSend:function(){},complete:function(){}
}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){x()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,a,n){i(angular.element(e).contents())(t)}),t.dtColumnsHealthDamageQsJusticeFirstDocument=[d.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,a,i,n){var o="",r=null!=e.document?e.document.path:"",l='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+e.id+'" >   <i class="fa fa-edit"></i></a> ',s='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+e.id+'" >   <i class="fa fa-trash-o"></i></a> ',c='<a target="_self" class="btn btn-info btn-xs downloadRow lnk" href="#" uib-tooltip="Descargar anexo" data-id="'+e.id+'" data-url="'+r+'" >   <i class="fa fa-download"></i></a> ';return o+=l,""!=r&&(o+=c),o+=s,t.isView?c:o}),d.newColumn("item").withTitle("Tipo").withOption("width",200).withOption("defaultContent",""),d.newColumn("name").withTitle("Nombre").withOption("width",200).withOption("defaultContent",""),d.newColumn("description").withTitle("Descripción").withOption("defaultContent",""),d.newColumn("version").withTitle("Version").withOption("width",200).withOption("defaultContent",""),d.newColumn("status").withTitle("Estado").withOption("width",150).renderWith(function(t,e,a,i){var n="",o="";return"Activo"==t?(o=t,n="label label-success"):(o=t,n="label label-danger"),'<span class="'+n+'">'+o+"</span>"})];var x=function(){$("#dtHealthDamageQsJusticeFirstDocument a.editRow").on("click",function(){var e=$(this).data("id");t.editHealthDamageQsJusticeBoardFirstDocument(e)}),$("#dtHealthDamageQsJusticeFirstDocument a.downloadRow").on("click",function(){var t=$(this).data("id"),e=$(this).data("url");""==e?w.pop("error","Error en la descarga","No existe un anexo para descargar"):jQuery("#download")[0].src="api/customer/health-damage/qs/document/download?id="+t}),$("#dtHealthDamageQsJusticeFirstDocument a.delRow").on("click",function(){var e=$(this).data("id");O.info("intenta eliminar el registro: "+e),o.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(i){if(i){var n={};n.id=e,l({method:"POST",url:"api/customer/health-damage/qs/document/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){a.error(t),o.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){t.reloadDataHealthDamageQsJusticeBoardFirstDocument()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};t.dtInstanceHealthDamageQsJusticeFirstDocumentCallback=function(e){t.dtInstanceHealthDamageQsJusticeFirstDocument=e,t.reloadDataHealthDamageQsJusticeBoardFirstDocument()},t.reloadDataHealthDamageQsJusticeBoardFirstDocument=function(){void 0!=t.dtInstanceHealthDamageQsJusticeFirstDocument.reloadData&&t.dtInstanceHealthDamageQsJusticeFirstDocument.reloadData()},t.editHealthDamageQsJusticeBoardFirstDocument=function(e){if(e){var a={id:e};l({method:"GET",url:"api/customer/health-damage/qs/document",params:a})["catch"](function(t,e){if(403==e){var a=null!==t.message&&void 0!==t.message?t.message:"app.clientes.list";o.swal("No Autorizado","No estas autorizado para ver esta información.","error"),s(function(){n.go(a)},3e3)}else 404==e?o.swal("Información no disponible","Centro de trabajo no encontrado","error"):o.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(e){s(function(){t.justiceFirstAttachment=e.data.result,null!=t.justiceFirstAttachment.startDate&&(t.justiceFirstAttachment.startDate=new Date(t.justiceFirstAttachment.startDate.date)),null!=t.justiceFirstAttachment.endDate&&(t.justiceFirstAttachment.endDate=new Date(t.justiceFirstAttachment.endDate.date))})})["finally"](function(){s(function(){t.loading=!1},400),s(function(){})})}else O.info("creacion de nuevo cliente"),t.loading=!1},t.saveHealthDamageQsJusticeBoardFirstDocument=function(){var e={},i=JSON.stringify(t.justiceFirstAttachment);return e.data=Base64.encode(i),null!=t.justiceFirstAttachment.type&&""!=t.justiceFirstAttachment.name&&null!=t.justiceFirstAttachment.status&&""!=t.justiceFirstAttachment.description?l({method:"POST",url:"api/customer/health-damage/qs/document/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){s(function(){w.pop("success","Operación Exitosa","Se guardó la información exitosamente..."),t.uploaderJusticeFirst.queue.length>0?(S=e.data.result.id,U.uploadAll()):(t.clearHealthDamageQsJusticeBoardFirstDocument(),t.reloadDataHealthDamageQsJusticeBoardFirstDocument(),t.reloadDataHealthDamageQsDocument())})})["catch"](function(t){a.error(t),o.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){}):void o.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e intentalo de nuevo.","error")},t.clearHealthDamageQsJusticeBoardFirstDocument=function(){t.justiceFirstAttachment={id:0,customerHealthDamageQualificationSourceId:t.qs.id,entityId:t.justiceFirst.id,entityCode:"justiceFirst",entityName:"Calificación Justicia Laboral / Primera Instancia",type:null,name:"",description:"",version:"1",status:{item:"Activo",value:"Activo"},startDate:null,endDate:null}},t.saveHealthDamageQsJusticeBoardSecond=function(){if(null!=t.justiceSecond.dateOf&&null!=t.justiceFirst.dateOf){var e=G(t.justiceFirst.dateOf,t.justiceSecond.dateOf);if(1==e)return w.pop("error","Validacion","La fecha de la segunda instancia no puede ser menor a la fecha de la primera instancia"),void(t.justiceSecond.dateOf=null)}var i={},n=JSON.stringify(t.justiceSecond);return i.data=Base64.encode(n),l({method:"POST",url:"api/customer/health-damage/qs/justice/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(e){s(function(){w.pop("success","Operación Exitosa","Se guardó la información exitosamente..."),t.justiceSecond=e.data.result,null!=t.justiceSecond.dateOf&&(t.justiceSecond.dateOf=new Date(t.justiceSecond.dateOf.date)),t.clearHealthDamageQsJusticeBoardSecondDetail(),t.clearHealthDamageQsJusticeBoardSecondDocument()})})["catch"](function(t){a.error(t),o.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})},y.customer_health_damage_justiceSecond_id=t.justiceSecond.id,t.dtInstanceHealthDamageQsJusticeSecondDetail={},t.dtOptionsHealthDamageQsJusticeSecondDetail=c.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerHealthDamageQsId=t.justiceSecond.id,JSON.stringify(e)},url:"api/customer-health-damage-qs-justice-detail",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){J()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,a,n){i(angular.element(e).contents())(t)}),t.dtColumnsHealthDamageQsJusticeSecondDetail=[d.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,a,i,n){var o="",l='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+e.id+'" >   <i class="fa fa-edit"></i></a> ',s='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+e.id+'" >   <i class="fa fa-trash-o"></i></a> ';return r.can("seguimiento_edit")&&(o+=l),r.can("seguimiento_delete")&&(o+=s),t.isView?null:o}),d.newColumn("diagnostic").withTitle("Diagnóstico").withOption("defaultContent",""),d.newColumn("origen").withTitle("Origen calificado").withOption("width",200).withOption("defaultContent",""),d.newColumn("status").withTitle("Estado de controversia").withOption("width",200).withOption("defaultContent","")];var J=function(){$("#dtHealthDamageQsJusticeSecondDetail a.editRow").on("click",function(){var e=$(this).data("id");t.editHealthDamageQsJusticeBoardSecondDetail(e)}),$("#dtHealthDamageQsJusticeSecondDetail a.delRow").on("click",function(){var e=$(this).data("id");O.info("intenta eliminar el registro: "+e),o.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(i){if(i){var n={};n.id=e,l({method:"POST",url:"api/customer/health-damage/qs/justice-detail/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){a.error(t),o.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){t.reloadDataHealthDamageQsJusticeBoardSecondDetail()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};t.dtInstanceHealthDamageQsJusticeSecondDetailCallback=function(e){t.dtInstanceHealthDamageQsJusticeSecondDetail=e,t.reloadDataHealthDamageQsJusticeBoardSecondDetail()},t.reloadDataHealthDamageQsJusticeBoardSecondDetail=function(){y.customer_health_damage_justiceSecond_id=t.justiceSecond.id,void 0!=t.dtInstanceHealthDamageQsJusticeSecondDetail.reloadData&&t.dtInstanceHealthDamageQsJusticeSecondDetail.reloadData()},t.editHealthDamageQsJusticeBoardSecondDetail=function(e){if(e){var a={id:e};l({method:"GET",url:"api/customer/health-damage/qs/justice-detail",params:a})["catch"](function(t,e){if(403==e){var a=null!==t.message&&void 0!==t.message?t.message:"app.clientes.list";o.swal("No Autorizado","No estas autorizado para ver esta información.","error"),s(function(){n.go(a)},3e3)}else 404==e?o.swal("Información no disponible","Centro de trabajo no encontrado","error"):o.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(e){s(function(){t.justiceSecondDetail=e.data.result})})["finally"](function(){s(function(){t.loading=!1},400),s(function(){D.scrollTop(40,2e3)})})}else O.info("creacion de nuevo cliente"),t.loading=!1},t.saveHealthDamageQsJusticeBoardSecondDetail=function(){var e={},i=JSON.stringify(t.justiceSecondDetail);return e.data=Base64.encode(i),null!=t.justiceSecondDetail.diagnostic&&null!=t.justiceSecondDetail.qualifiedOrigin&&null!=t.justiceSecondDetail.controversyStatus?l({method:"POST",url:"api/customer/health-damage/qs/justice-detail/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){s(function(){w.pop("success","Operación Exitosa","Se guardó la información exitosamente..."),t.clearHealthDamageQsJusticeBoardSecondDetail(),t.reloadDataHealthDamageQsJusticeBoardSecondDetail()})})["catch"](function(t){a.error(t),o.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){}):void o.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e intentalo de nuevo.","error")},t.clearHealthDamageQsJusticeBoardSecondDetail=function(){t.justiceSecondDetail={id:0,customerHealthDamageQsJusticeBoardId:t.justiceSecond.id,diagnostic:null,qualifiedOrigin:null,controversyStatus:null}},t.dtInstanceHealthDamageQsJusticeSecondDocument={},t.dtOptionsHealthDamageQsJusticeSecondDocument=c.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerHealthDamageQualificationSourceId=t.qs.id,e.entityCode="justiceSecond",e.entityId=t.justiceSecond.id,JSON.stringify(e)},url:"api/customer-health-damage-qs-document",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){N()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,a,n){i(angular.element(e).contents())(t)}),t.dtColumnsHealthDamageQsJusticeSecondDocument=[d.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,a,i,n){var o="",r=null!=e.document?e.document.path:"",l='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+e.id+'" >   <i class="fa fa-edit"></i></a> ',s='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+e.id+'" >   <i class="fa fa-trash-o"></i></a> ',c='<a target="_self" class="btn btn-info btn-xs downloadRow lnk" href="#" uib-tooltip="Descargar anexo" data-id="'+e.id+'" data-url="'+r+'" >   <i class="fa fa-download"></i></a> ';return o+=l,""!=r&&(o+=c),o+=s,t.isView?c:o}),d.newColumn("item").withTitle("Tipo").withOption("width",200).withOption("defaultContent",""),d.newColumn("name").withTitle("Nombre").withOption("width",200).withOption("defaultContent",""),d.newColumn("description").withTitle("Descripción").withOption("defaultContent",""),d.newColumn("version").withTitle("Version").withOption("width",200).withOption("defaultContent",""),d.newColumn("status").withTitle("Estado").withOption("width",150).renderWith(function(t,e,a,i){var n="",o="";return"Activo"==t?(o=t,n="label label-success"):(o=t,n="label label-danger"),'<span class="'+n+'">'+o+"</span>"})];var N=function(){$("#dtHealthDamageQsJusticeSecondDocument a.editRow").on("click",function(){var e=$(this).data("id");t.editHealthDamageQsJusticeBoardSecondDocument(e)}),$("#dtHealthDamageQsJusticeSecondDocument a.downloadRow").on("click",function(){var t=$(this).data("id"),e=$(this).data("url");""==e?w.pop("error","Error en la descarga","No existe un anexo para descargar"):jQuery("#download")[0].src="api/customer/health-damage/qs/document/download?id="+t}),$("#dtHealthDamageQsJusticeSecondDocument a.delRow").on("click",function(){var e=$(this).data("id");O.info("intenta eliminar el registro: "+e),o.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(i){if(i){var n={};n.id=e,l({method:"POST",url:"api/customer/health-damage/qs/document/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){a.error(t),o.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){t.reloadDataHealthDamageQsJusticeBoardSecondDocument()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};t.dtInstanceHealthDamageQsJusticeSecondDocumentCallback=function(e){t.dtInstanceHealthDamageQsJusticeSecondDocument=e,t.reloadDataHealthDamageQsJusticeBoardSecondDocument()},t.reloadDataHealthDamageQsJusticeBoardSecondDocument=function(){void 0!=t.dtInstanceHealthDamageQsJusticeSecondDocument.reloadData&&t.dtInstanceHealthDamageQsJusticeSecondDocument.reloadData()},t.editHealthDamageQsJusticeBoardSecondDocument=function(e){if(e){var a={id:e};l({method:"GET",url:"api/customer/health-damage/qs/document",params:a})["catch"](function(t,e){if(403==e){var a=null!==t.message&&void 0!==t.message?t.message:"app.clientes.list";o.swal("No Autorizado","No estas autorizado para ver esta información.","error"),s(function(){n.go(a)},3e3)}else 404==e?o.swal("Información no disponible","Centro de trabajo no encontrado","error"):o.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(e){s(function(){t.justiceSecondAttachment=e.data.result,null!=t.justiceSecondAttachment.startDate&&(t.justiceSecondAttachment.startDate=new Date(t.justiceSecondAttachment.startDate.date)),null!=t.justiceSecondAttachment.endDate&&(t.justiceSecondAttachment.endDate=new Date(t.justiceSecondAttachment.endDate.date))})})["finally"](function(){s(function(){t.loading=!1},400),s(function(){})})}else O.info("creacion de nuevo cliente"),t.loading=!1},t.saveHealthDamageQsJusticeBoardSecondDocument=function(){var e={},i=JSON.stringify(t.justiceSecondAttachment);return e.data=Base64.encode(i),null!=t.justiceSecondAttachment.type&&""!=t.justiceSecondAttachment.name&&null!=t.justiceSecondAttachment.status&&""!=t.justiceSecondAttachment.description?l({method:"POST",url:"api/customer/health-damage/qs/document/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){s(function(){w.pop("success","Operación Exitosa","Se guardó la información exitosamente..."),t.uploaderJusticeSecond.queue.length>0?(S=e.data.result.id,V.uploadAll()):(t.clearHealthDamageQsJusticeBoardSecondDocument(),t.reloadDataHealthDamageQsJusticeBoardSecondDocument(),t.reloadDataHealthDamageQsDocument())})})["catch"](function(t){a.error(t),o.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){}):void o.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e intentalo de nuevo.","error")},t.clearHealthDamageQsJusticeBoardSecondDocument=function(){t.justiceSecondAttachment={id:0,customerHealthDamageQualificationSourceId:t.qs.id,entityId:t.justiceSecond.id,entityCode:"justiceSecond",entityName:"Calificación Justicia Laboral / Segunda Instancia",type:null,name:"",description:"",version:"1",status:{item:"Activo",value:"Activo"},startDate:null,endDate:null}},t.saveHealthDamageQsJusticeBoardThird=function(){if(null!=t.justiceThird.dateOf&&null!=t.justiceSecond.dateOf){var e=G(t.justiceSecond.dateOf,t.justiceThird.dateOf);if(1==e)return w.pop("error","Validacion","La fecha de la  instancia de casacion no puede ser menor a la fecha de la segunda instancia"),void(t.justiceThird.dateOf=null)}var i={},n=JSON.stringify(t.justiceThird);return i.data=Base64.encode(n),l({method:"POST",url:"api/customer/health-damage/qs/justice/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(e){s(function(){w.pop("success","Operación Exitosa","Se guardó la información exitosamente..."),t.justiceThird=e.data.result,t.justiceThird.dateOf=new Date(t.justiceThird.dateOf.date),t.clearHealthDamageQsJusticeBoardThirdDetail(),t.clearHealthDamageQsJusticeBoardThirdDocument()})})["catch"](function(t){a.error(t),o.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})},y.customer_health_damage_justiceThird_id=t.justiceThird.id,t.dtInstanceHealthDamageQsJusticeThirdDetail={},t.dtOptionsHealthDamageQsJusticeThirdDetail=c.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerHealthDamageQsId=t.justiceThird.id,JSON.stringify(e)},url:"api/customer-health-damage-qs-justice-detail",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){P()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,a,n){i(angular.element(e).contents())(t)}),t.dtColumnsHealthDamageQsJusticeThirdDetail=[d.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,a,i,n){var o="",l='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+e.id+'" >   <i class="fa fa-edit"></i></a> ',s='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+e.id+'" >   <i class="fa fa-trash-o"></i></a> ';return r.can("seguimiento_edit")&&(o+=l),r.can("seguimiento_delete")&&(o+=s),t.isView?null:o}),d.newColumn("diagnostic").withTitle("Diagnóstico").withOption("defaultContent",""),d.newColumn("origen").withTitle("Origen calificado").withOption("width",200).withOption("defaultContent",""),d.newColumn("status").withTitle("Estado de controversia").withOption("width",200).withOption("defaultContent","")];var P=function(){$("#dtHealthDamageQsJusticeThirdDetail a.editRow").on("click",function(){var e=$(this).data("id");t.editHealthDamageQsJusticeBoardThirdDetail(e)}),$("#dtHealthDamageQsJusticeThirdDetail a.delRow").on("click",function(){var e=$(this).data("id");O.info("intenta eliminar el registro: "+e),o.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(i){if(i){var n={};n.id=e,l({method:"POST",url:"api/customer/health-damage/qs/justice-detail/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){a.error(t),o.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){t.reloadDataHealthDamageQsJusticeBoardThirdDetail()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};t.dtInstanceHealthDamageQsJusticeThirdDetailCallback=function(e){t.dtInstanceHealthDamageQsJusticeThirdDetail=e,t.reloadDataHealthDamageQsJusticeBoardThirdDetail()},t.reloadDataHealthDamageQsJusticeBoardThirdDetail=function(){y.customer_health_damage_justiceThird_id=t.justiceThird.id,void 0!=t.dtInstanceHealthDamageQsJusticeThirdDetail.reloadData&&t.dtInstanceHealthDamageQsJusticeThirdDetail.reloadData()},t.editHealthDamageQsJusticeBoardThirdDetail=function(e){if(e){var a={id:e};l({method:"GET",url:"api/customer/health-damage/qs/justice-detail",params:a})["catch"](function(t,e){if(403==e){var a=null!==t.message&&void 0!==t.message?t.message:"app.clientes.list";o.swal("No Autorizado","No estas autorizado para ver esta información.","error"),s(function(){n.go(a)},3e3)}else 404==e?o.swal("Información no disponible","Centro de trabajo no encontrado","error"):o.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(e){s(function(){t.justiceThirdDetail=e.data.result})})["finally"](function(){s(function(){t.loading=!1},400),s(function(){D.scrollTop(40,2e3)})})}else O.info("creacion de nuevo cliente"),t.loading=!1},t.saveHealthDamageQsJusticeBoardThirdDetail=function(){var e={},i=JSON.stringify(t.justiceThirdDetail);return e.data=Base64.encode(i),null!=t.justiceThirdDetail.diagnostic&&null!=t.justiceThirdDetail.qualifiedOrigin&&null!=t.justiceThirdDetail.controversyStatus?l({method:"POST",url:"api/customer/health-damage/qs/justice-detail/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){s(function(){w.pop("success","Operación Exitosa","Se guardó la información exitosamente..."),t.clearHealthDamageQsJusticeBoardThirdDetail(),t.reloadDataHealthDamageQsJusticeBoardThirdDetail()})})["catch"](function(t){a.error(t),o.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){}):void o.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e intentalo de nuevo.","error")},t.clearHealthDamageQsJusticeBoardThirdDetail=function(){t.justiceThirdDetail={id:0,customerHealthDamageQsJusticeBoardId:t.justiceThird.id,diagnostic:null,qualifiedOrigin:null,controversyStatus:null}},t.dtInstanceHealthDamageQsJusticeThirdDocument={},t.dtOptionsHealthDamageQsJusticeThirdDocument=c.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){e.customerHealthDamageQualificationSourceId=t.qs.id,e.entityCode="justiceThird",e.entityId=t.justiceThird.id},url:"api/customer/health-damage/qs/document",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){R()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,a,n){i(angular.element(e).contents())(t)}),t.dtColumnsHealthDamageQsJusticeThirdDocument=[d.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,a,i,n){var o="",r=null!=e.document?e.document.path:"",l='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+e.id+'" >   <i class="fa fa-edit"></i></a> ',s='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+e.id+'" >   <i class="fa fa-trash-o"></i></a> ',c='<a target="_self" class="btn btn-info btn-xs downloadRow lnk" href="#" uib-tooltip="Descargar anexo" data-id="'+e.id+'" data-url="'+r+'" >   <i class="fa fa-download"></i></a> ';return o+=l,""!=r&&(o+=c),o+=s,t.isView?c:o}),d.newColumn("item").withTitle("Tipo").withOption("width",200).withOption("defaultContent",""),d.newColumn("name").withTitle("Nombre").withOption("width",200).withOption("defaultContent",""),d.newColumn("description").withTitle("Descripción").withOption("defaultContent",""),d.newColumn("version").withTitle("Version").withOption("width",200).withOption("defaultContent",""),d.newColumn("status").withTitle("Estado").withOption("width",150).renderWith(function(t,e,a,i){var n="",o="";return"Activo"==t?(o=t,n="label label-success"):(o=t,n="label label-danger"),'<span class="'+n+'">'+o+"</span>"})];var R=function(){$("#dtHealthDamageQsJusticeThirdDocument a.editRow").on("click",function(){var e=$(this).data("id");t.editHealthDamageQsJusticeBoardThirdDocument(e)}),$("#dtHealthDamageQsJusticeThirdDocument a.downloadRow").on("click",function(){var t=$(this).data("id"),e=$(this).data("url");""==e?w.pop("error","Error en la descarga","No existe un anexo para descargar"):jQuery("#download")[0].src="api/customer/health-damage/qs/document/download?id="+t}),$("#dtHealthDamageQsJusticeThirdDocument a.delRow").on("click",function(){var e=$(this).data("id");O.info("intenta eliminar el registro: "+e),o.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(i){if(i){var n={};n.id=e,l({method:"POST",url:"api/customer/health-damage/qs/document/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){a.error(t),o.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){t.reloadDataHealthDamageQsJusticeBoardThirdDocument()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};t.dtInstanceHealthDamageQsJusticeThirdDocumentCallback=function(e){t.dtInstanceHealthDamageQsJusticeThirdDocument=e,t.reloadDataHealthDamageQsJusticeBoardThirdDocument()},t.reloadDataHealthDamageQsJusticeBoardThirdDocument=function(){void 0!=t.dtInstanceHealthDamageQsJusticeThirdDocument.reloadData&&t.dtInstanceHealthDamageQsJusticeThirdDocument.reloadData()},t.editHealthDamageQsJusticeBoardThirdDocument=function(e){if(e){var a={id:e};l({method:"GET",url:"api/customer/health-damage/qs/document",params:a})["catch"](function(t,e){if(403==e){var a=null!==t.message&&void 0!==t.message?t.message:"app.clientes.list";o.swal("No Autorizado","No estas autorizado para ver esta información.","error"),s(function(){n.go(a)},3e3)}else 404==e?o.swal("Información no disponible","Centro de trabajo no encontrado","error"):o.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(e){s(function(){t.justiceThirdAttachment=e.data.result,null!=t.justiceThirdAttachment.startDate&&(t.justiceThirdAttachment.startDate=new Date(t.justiceThirdAttachment.startDate.date)),null!=t.justiceThirdAttachment.endDate&&(t.justiceThirdAttachment.endDate=new Date(t.justiceThirdAttachment.endDate.date))})})["finally"](function(){s(function(){t.loading=!1},400),s(function(){})})}else O.info("creacion de nuevo cliente"),t.loading=!1},t.saveHealthDamageQsJusticeBoardThirdDocument=function(){var e={},i=JSON.stringify(t.justiceThirdAttachment);return e.data=Base64.encode(i),null!=t.justiceThirdAttachment.type&&""!=t.justiceThirdAttachment.name&&null!=t.justiceThirdAttachment.status&&""!=t.justiceThirdAttachment.description?l({method:"POST",url:"api/customer/health-damage/qs/document/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){s(function(){w.pop("success","Operación Exitosa","Se guardó la información exitosamente..."),t.uploaderJusticeThird.queue.length>0?(S=e.data.result.id,W.uploadAll()):(t.clearHealthDamageQsJusticeBoardThirdDocument(),t.reloadDataHealthDamageQsJusticeBoardThirdDocument(),t.reloadDataHealthDamageQsDocument())})})["catch"](function(t){a.error(t),o.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){}):void o.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e intentalo de nuevo.","error")},t.clearHealthDamageQsJusticeBoardThirdDocument=function(){t.justiceThirdAttachment={id:0,customerHealthDamageQualificationSourceId:t.qs.id,entityId:t.justiceThird.id,entityCode:"justiceThird",entityName:"Calificación Justicia Laboral / Tercera Instancia",type:null,name:"",description:"",version:"1",status:{item:"Activo",value:"Activo"},startDate:null,endDate:null}},t.dtInstanceHealthDamageQsDocument={},t.dtOptionsHealthDamageQsDocument=c.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){e.customer_health_damage_qs_id=t.qs.id},url:"api/customer/health-damage/qs/document-all",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){_()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,a,n){i(angular.element(e).contents())(t)}),t.dtColumnsHealthDamageQsDocument=[d.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,a,i,n){var o="",r=null!=e.document?e.document.path:"",l='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar anexo" data-id="'+e.id+'" >   <i class="fa fa-trash-o"></i></a> ',s='<a target="_self" class="btn btn-info btn-xs downloadRow lnk" href="#" uib-tooltip="Descargar anexo" data-id="'+e.id+'" data-url="'+r+'" >   <i class="fa fa-download"></i></a> ';
return""!=r&&(o+=s),o+=l,t.isView?s:o}),d.newColumn("createdAt").withTitle("Fecha registro").withOption("width",120).withOption("defaultContent",""),d.newColumn("entityName").withTitle("Módulo").withOption("width",200).withOption("defaultContent",""),d.newColumn("type.item").withTitle("Tipo").withOption("width",200).withOption("defaultContent",""),d.newColumn("name").withTitle("Nombre").withOption("width",200).withOption("defaultContent",""),d.newColumn("description").withTitle("Descripción").withOption("defaultContent",""),d.newColumn("version").withTitle("Version").withOption("width",200).withOption("defaultContent",""),d.newColumn("status.item").withTitle("Estado").withOption("width",150).renderWith(function(t,e,a,i){var n="",o="";return"Activo"==t?(o=t,n="label label-success"):(o=t,n="label label-danger"),'<span class="'+n+'">'+o+"</span>"})];var _=function(){$("#dtHealthDamageQsDocument a.downloadRow").on("click",function(){var t=$(this).data("id"),e=$(this).data("url");""==e?w.pop("error","Error en la descarga","No existe un anexo para descargar"):jQuery("#download")[0].src="api/customer/health-damage/qs/document/download?id="+t}),$("#dtHealthDamageQsDocument a.delRow").on("click",function(){var e=$(this).data("id");O.info("intenta eliminar el registro: "+e),o.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(i){if(i){var n={};n.id=e,l({method:"POST",url:"api/customer/health-damage/qs/document/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){a.error(t),o.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){t.reloadDataHealthDamageQsDocument()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};t.dtInstanceHealthDamageQsDocumentCallback=function(e){t.dtInstanceHealthDamageQsDocument=e,t.reloadDataHealthDamageQsDocument()},t.reloadDataHealthDamageQsDocument=function(){void 0!=t.dtInstanceHealthDamageQsDocument.reloadData&&t.dtInstanceHealthDamageQsDocument.reloadData()},t.onDownload=function(){jQuery("#download")[0].src="api/customer/health-damage/qs/document/download-all?id="+t.qs.id};var k=t.uploaderDiagnostic=new v({url:"api/customer/health-damage/qs/document/upload",formData:[],removeAfterUpload:!0});k.filters.push({name:"customFilter",fn:function(t,e){return this.queue.length<10}}),k.onBeforeUploadItem=function(t){console.info("onBeforeUploadItem",t);var e={id:S};t.formData.push(e)},k.onCompleteAll=function(){console.info("onCompleteAll"),t.clearHealthDamageQsDiagnosticDocument(),t.reloadDataHealthDamageQsDiagnosticDocument(),t.reloadDataHealthDamageQsDiagnosticDocument()};var F=t.uploaderOpportunity=new v({url:"api/customer/health-damage/qs/document/upload",formData:[],removeAfterUpload:!0});F.filters.push({name:"customFilter",fn:function(t,e){return this.queue.length<10}}),F.onBeforeUploadItem=function(t){console.info("onBeforeUploadItem",t);var e={id:S};t.formData.push(e)},F.onCompleteAll=function(){console.info("onCompleteAll"),t.clearHealthDamageQsFirstOpportunityDocument(),t.reloadDataHealthDamageQsFirstOpportunityDocument(),t.reloadDataHealthDamageQsDocument()};var L=t.uploaderRegional=new v({url:"api/customer/health-damage/qs/document/upload",formData:[],removeAfterUpload:!0});L.filters.push({name:"customFilter",fn:function(t,e){return this.queue.length<10}}),L.onBeforeUploadItem=function(t){console.info("onBeforeUploadItem",t);var e={id:S};t.formData.push(e)},L.onCompleteAll=function(){console.info("onCompleteAll"),t.clearHealthDamageQsRegionalBoardDocument(),t.reloadDataHealthDamageQsRegionalBoardDocument(),t.reloadDataHealthDamageQsDocument()};var z=t.uploaderNational=new v({url:"api/customer/health-damage/qs/document/upload",formData:[],removeAfterUpload:!0});z.filters.push({name:"customFilter",fn:function(t,e){return this.queue.length<10}}),z.onBeforeUploadItem=function(t){console.info("onBeforeUploadItem",t);var e={id:S};t.formData.push(e)},z.onCompleteAll=function(){console.info("onCompleteAll"),t.clearHealthDamageQsNationalBoardDocument(),t.reloadDataHealthDamageQsNationalBoardDocument(),t.reloadDataHealthDamageQsDocument()};var U=t.uploaderJusticeFirst=new v({url:"api/customer/health-damage/qs/document/upload",formData:[],removeAfterUpload:!0});U.filters.push({name:"customFilter",fn:function(t,e){return this.queue.length<10}}),U.onBeforeUploadItem=function(t){console.info("onBeforeUploadItem",t);var e={id:S};t.formData.push(e)},U.onCompleteAll=function(){console.info("onCompleteAll"),t.clearHealthDamageQsJusticeBoardFirstDocument(),t.reloadDataHealthDamageQsJusticeBoardFirstDocument(),t.reloadDataHealthDamageQsDocument()};var V=t.uploaderJusticeSecond=new v({url:"api/customer/health-damage/qs/document/upload",formData:[],removeAfterUpload:!0});V.filters.push({name:"customFilter",fn:function(t,e){return this.queue.length<10}}),V.onBeforeUploadItem=function(t){console.info("onBeforeUploadItem",t);var e={id:S};t.formData.push(e)},V.onCompleteAll=function(){console.info("onCompleteAll"),t.clearHealthDamageQsJusticeBoardSecondDocument(),t.reloadDataHealthDamageQsJusticeBoardSecondDocument(),t.reloadDataHealthDamageQsDocument()};var W=t.uploaderJusticeThird=new v({url:"api/customer/health-damage/qs/document/upload",formData:[],removeAfterUpload:!0});W.filters.push({name:"customFilter",fn:function(t,e){return this.queue.length<10}}),W.onBeforeUploadItem=function(t){console.info("onBeforeUploadItem",t);var e={id:S};t.formData.push(e)},W.onCompleteAll=function(){console.info("onCompleteAll"),t.clearHealthDamageQsJusticeBoardThirdDocument(),t.reloadDataHealthDamageQsJusticeBoardThirdDocument(),t.reloadDataHealthDamageQsDocument()},t.onAddEmployee=function(){var e=g.open({templateUrl:r.app.views.urlRoot+"modules/customer/occupational/health-damage/qualification/customer_absenteeism_disability_employee_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideHealthQualificationSourceEmployeeCtrl",scope:t});e.result.then(function(){})},t.onAddDisabilityEmployeeList=function(){var e=g.open({templateUrl:r.app.views.urlRoot+"modules/customer/occupational/health-damage/qualification/customer_absenteeism_disability_employee_list_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideHealthQualificationSourceEmployeeListCtrl",scope:t});e.result.then(function(e){var a=f("filter")(t.employees,{id:e.id});0==a.length&&t.employees.push(e),t.qs.employee=e})},t.saveStepQualificationFirstOpportunity=function(){w.pop("success","Operación Exitosa","Se guardó la información exitosamente se habilitara la pestaña Calificación Primera Oportunidad"),t.qs.stepQualificationFirstOpportunity=!0,t.stepQualificationFirstOpportunityActive=!0,Q()},t.saveStepQualificationRegionalBoard=function(){w.pop("success","Operación Exitosa","Se guardó la información exitosamente se habilitara la pestaña Calificación Junta Regional"),t.qs.stepQualificationRegionalBoard=!0,t.stepQualificationRegionalBoardActive=!0,Q()},t.saveStepQualificationNationalBoard=function(){w.pop("success","Operación Exitosa","Se guardó la información exitosamente se habilitara la pestaña Calificación Junta Nacional"),t.qs.stepQualificationNationalBoard=!0,t.stepQualificationNationalBoardActive=!0,Q()},t.saveStepQualificationLaborJustice=function(){w.pop("success","Operación Exitosa","Se guardó la información exitosamente se habilitara la pestaña Calificación Justicia Laboral"),t.qs.stepQualificationLaborJustice=!0,t.stepQualificationLaborJusticeActive=!0,Q()},t.saveStepSecondInstance=function(){w.pop("success","Operación Exitosa","Se guardó la información exitosamente se habilitara la pestaña Instancia Segunda"),t.qs.stepSecondInstance=!0,t.stepQualificationSecondInstanceActive=!0,Q()},t.saveStepThirdInstance=function(){w.pop("success","Operación Exitosa","Se guardó la información exitosamente se habilitara la pestaña Instancia Casacion"),t.qs.stepThirdInstance=!0,t.stepQualificationThirdInstanceActive=!0,Q()},t.onAddDisabilityDiagnostic=function(e){var a=g.open({templateUrl:r.app.views.urlRoot+"modules/customer/occupational/health-damage/qualification/customer_absenteeism_disability_diagnostic_modal.htm",placement:"right",size:"lg",backdrop:!0,resolve:{employee:function(){return t.qs.employee}},controller:"ModalInstanceSideHealthDamageQsDiagnosticListCtrl",scope:t});a.result.then(function(a){var i=f("filter")(t.diagnostics,{id:a.id});switch(0==i.length&&t.diagnostics.push(a),e){case"opportunityDetail":t.opportunityDetail.diagnostic=a;break;case"regionalDetail":t.regionalDetail.diagnostic=a;break;case"nationalDetail":t.nationalDetail.diagnostic=a;break;case"justiceFirstDetail":t.justiceFirstDetail.diagnostic=a;break;case"justiceSecondDetail":t.justiceSecondDetail.diagnostic=a;break;case"justiceThirdDetail":t.justiceThirdDetail.diagnostic=a;break;default:t.diagnostic.codeCIE10=a}})};var M=function(t){return t.constructor===Date?t:t.constructor===Array?new Date(t[0],t[1],t[2]):t.constructor===Number?new Date(t):t.constructor===String?new Date(t):"object"==typeof t?new Date(t.year,t.month,t.date):NaN},G=function(t,e){return isFinite(t=M(t).valueOf())&&isFinite(e=M(e).valueOf())?(t>e)-(t<e):NaN};t.$watch("justiceSecond.dateOf",function(){if(null!=t.justiceSecond.dateOf&&null!=t.justiceFirst.dateOf){var e=G(t.justiceFirst.dateOf,t.justiceSecond.dateOf);1==e&&(w.pop("error","Validacion","La fecha de la instancia segunda no puede ser menor a la fecha de la primera instancia"),t.justiceSecond.dateOf=null)}}),t.$watch("justiceThird.dateOf",function(){if(null!=t.justiceThird.dateOf&&null!=t.justiceSecond.dateOf){var e=G(t.justiceSecond.dateOf,t.justiceThird.dateOf);1==e&&(w.pop("error","Validacion","La fecha de la  instancia de casacion no puede ser menor a la fecha de la segunda instancia"),t.justiceThird.dateOf=null)}})}]),app.controller("ModalInstanceSideHealthQualificationSourceEmployeeCtrl",["$rootScope","$stateParams","$scope","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile",function(t,e,a,i,n,o,r,l,s,c,d,u,m,h){a.contractTypes=t.parameters("employee_contract_type"),a.documentTypes=t.parameters("employee_document_type");var p=function(){a.employee={id:0,customerId:e.customerId,isActive:!0,contractType:null,job:null,workPlace:null,salary:0,entity:{id:0,documentType:null,documentNumber:"",firstName:"",lastName:"",isActive:!0}}};p();var f=function(){var t={};return t.operation="restriction",t.customerId=e.customerId,l({method:"POST",url:"api/customer/config-sgsst/workplace/listProcess",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){o(function(){a.workPlaces=t.data.data})})["catch"](function(t){})["finally"](function(){})};f();var g=function(){if(null!=a.employee.workPlace){var t={};return t.operation="restriction",t.customerId=e.customerId,t.workPlaceId=a.employee.workPlace.id,l({method:"POST",url:"api/customer/config-sgsst/job/listByWorkPlace",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){o(function(){a.jobs=t.data.data})})["catch"](function(t){})["finally"](function(){})}a.jobs=[]};a.$watch("employee.workPlace",function(){g()}),a.onCloseModal=function(){i.close(1)},a.onCancelEmployee=function(){i.dismiss("cancel")},a.form={submit:function(t){var e=null;if(t.$invalid){var i=null,e=null;for(i in t)"$"!=i[0]&&(null!==e||t[i].$valid||(e=t[i].$name),t[i].$pristine&&(t[i].$dirty=!0));return angular.element(".ng-invalid[name="+e+"]").focus(),void o(function(){s.pop("error","Error","Por favor verifique los datos requeridos del formulario y vuelva a intentarlo")},500)}a.onSaveEmployee()},reset:function(t){t.$setPristine(!0)}},a.onSaveEmployee=function(){var t={},e=JSON.stringify(a.employee);return t.data=Base64.encode(e),l({method:"POST",url:"api/customer-employee/quickSave",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){o(function(){a.attachment=t.data.result,s.pop("success","Operación Exitosa","Registro eliminado"),a.onCloseModal()})})["catch"](function(t){n.error(t),s.pop("error","Error","Por favor ingrese los campos requeridos.")})["finally"](function(){})}}]),app.controller("ModalInstanceSideHealthQualificationSourceEmployeeListCtrl",["$rootScope","$stateParams","$scope","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile",function(t,e,a,i,n,o,r,l,s,c,d,u,m,h){a.employee={id:0},a.onCloseModal=function(){i.close(a.employee)},a.onCancel=function(){i.dismiss("cancel")},a.onLoadRecord=function(){if(0!=a.employee.id){var t={id:a.employee.id};l({method:"GET",url:"api/customer-employee",params:t})["catch"](function(t,e){if(403==e){var a=null!==t.message&&void 0!==t.message?t.message:"app.clientes.list";r.swal("No Autorizado","No estas autorizado para ver esta información.","error"),o(function(){$state.go(a)},3e3)}else 404==e?r.swal("Información no disponible","Diagnóstico no encontrado","error"):r.swal("Error","Se ha presentado un error al intentar acceder a la información del proceso","error")}).then(function(t){o(function(){a.employee=t.data.result})})["finally"](function(){o(function(){a.onCloseModal()},400)})}else a.loading=!1},a.dtInstanceDisabilityEmployeeList={},a.dtOptionsDisabilityEmployeeList=m.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.customerId=e.customerId,JSON.stringify(t)},url:"api/customer-employee-modal-basic",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){p()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,e,i){h(angular.element(t).contents())(a)}),a.dtColumnsDisabilityEmployeeList=[u.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,e,a,i){var n="",o="",r='<a class="btn btn-success btn-xs editRow lnk" href="#" uib-tooltip="Adicionar empleado" tooltip-placement="right"  data-id="'+t.id+'"'+o+' >   <i class="fa fa-plus-square"></i></a> ';return n+=r}),u.newColumn("documentNumber").withTitle("Número Identificación").withOption("width",200),u.newColumn("firstName").withTitle("Nombre").withOption("width",200),u.newColumn("lastName").withTitle("Apellidos").withOption("width",200),u.newColumn("workPlace").withTitle("Centro de Trabajo").withOption("width",200),u.newColumn("job").withTitle("Cargo").withOption("width",200),u.newColumn("neighborhood").withTitle("Centro de Costos").withOption("width",200),u.newColumn(null).withTitle("Estado").withOption("width",200).renderWith(function(t,e,a,i){var n="label label-danger",o="Inactivo";null==t.isActiveCode&&void 0==t.isActiveCode||("Activo"==t.isActiveCode?(n="label label-success",o="Activo"):(n="label label-danger",o="Inactivo"));var r='<span class="'+n+'">'+o+"</span>";return r}),u.newColumn(null).withTitle("Autorización").withOption("width",200).renderWith(function(t,e,a,i){var n="label label-danger",o="Inactivo";null==t.isAuthorized&&void 0==t.isAuthorized||("Autorizado"==t.isAuthorized?(n="label label-success",o="Autorizado"):"No Autorizado"==t.isAuthorized?(n="label label-danger",o="No Autorizado"):(n="label label-info",o="N/A"));var r='<span class="'+n+'">'+o+"</span>";return r})];var p=function(){$("#dtDisabilityEmployeeList a.editRow").on("click",function(){var t=$(this).data("id");a.editDisabilityEmployee(t)})};a.reloadData=function(){a.dtInstanceDisabilityEmployeeList.reloadData()},a.viewDisabilityEmployee=function(t){a.employee.id=t,a.isView=!0,a.onLoadRecord()},a.editDisabilityEmployee=function(t){a.employee.id=t,a.isView=!1,a.onLoadRecord()}}]),app.controller("ModalInstanceSideHealthDamageQsDiagnosticListCtrl",["$rootScope","$stateParams","$scope","employee","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile",function(t,e,a,i,n,o,r,l,s,c,d,u,m,h,p){a.diagnostic={id:0,code:"",description:"",isActive:!0},a.onCloseModal=function(){n.close(a.diagnostic)},a.onCancel=function(){n.dismiss("cancel")},a.onLoadRecord=function(){if(0!=a.diagnostic.id){var t={id:a.diagnostic.id};s({method:"GET",url:"api/disability-diagnostic",params:t})["catch"](function(t,e){if(403==e){var a=null!==t.message&&void 0!==t.message?t.message:"app.clientes.list";l.swal("No Autorizado","No estas autorizado para ver esta información.","error"),r(function(){$state.go(a)},3e3)}else 404==e?l.swal("Información no disponible","Diagnóstico no encontrado","error"):l.swal("Error","Se ha presentado un error al intentar acceder a la información del proceso","error")}).then(function(t){r(function(){a.diagnostic=t.data.result})})["finally"](function(){r(function(){a.onCloseModal()},400)})}else a.loading=!1},a.dtInstanceDisabilityDiagnosticList={},a.dtOptionsDisabilityDiagnosticList=h.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.customerEmployeeId=i.id,JSON.stringify(t)},url:"api/disability-diagnostic-source-employee",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){f()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,e,i){p(angular.element(t).contents())(a)}),a.dtColumnsDisabilityDiagnosticList=[m.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,e,a,i){var n="",o="",r='<a class="btn btn-success btn-xs editRow lnk" href="#" uib-tooltip="Adicionar diagnóstico"  data-id="'+t.id+'"'+o+' >   <i class="fa fa-plus-square"></i></a> ';return n+=r}),m.newColumn("code").withTitle("Código").withOption("width",200),m.newColumn("description").withTitle("Diagnóstico"),m.newColumn(null).withTitle("Estado").withOption("width",200).renderWith(function(t,e,a,i){var n="label label-danger";null==t.isActive&&void 0==t.isActive||(n=t.isActive?"label label-success":"label label-danger");var o='<span class="'+n+'">'+t.status+"</span>";return o})];var f=function(){$("#dtDisabilityDiagnosticList a.editRow").on("click",function(){var t=$(this).data("id");a.editDisabilityDiagnostic(t)})};a.reloadData=function(){a.dtInstanceDisabilityDiagnostic.reloadData()},a.viewDisabilityDiagnostic=function(t){a.diagnostic.id=t,a.isView=!0,a.onLoadRecord()},a.editDisabilityDiagnostic=function(t){a.diagnostic.id=t,a.isView=!1,a.onLoadRecord()}}]);
"use strict";app.controller("customerHealthDamageQualificationSourceListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","SweetAlert","$http","$filter","$document","$aside",function(t,e,i,n,a,o,l,r,c,d,u,s,w,h,m,p){function f(e){var i=p.open({templateUrl:d.app.views.urlRoot+"modules/customer/occupational/health-damage/qualification/customer_health_damage_download_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideHealthDamageQualificationSourceDownloadDocument",scope:t,resolve:{qs:function(){return{id:e}},isView:function(){return t.isView}}});i.result.then(function(){t.reloadData()})}var g=i;g.info("loading..customerWorkMedicineListCtrl "),t.agents=d.agents(),t.dtInstanceHealthDamageQualificationSource={},t.dtOptionsHealthDamageQualificationSource=n.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.customerId=e.customerId,JSON.stringify(t)},url:"api/customer-health-damage-qs",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){O()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,i,n){l(angular.element(e).contents())(t)}),t.dtColumnsHealthDamageQualificationSource=[a.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,e,i,n){var a="",o='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+t.id+'" >   <i class="fa fa-edit"></i></a> ',l='<a class="btn btn-info btn-xs viewRow lnk" href="#" uib-tooltip="Ver" data-id="'+t.id+'" >   <i class="fa fa-eye"></i></a> ',r='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+t.id+'" >   <i class="fa fa-trash-o"></i></a> ',c='<a class="btn btn-light-purple btn-xs downloadDocumentRow lnk" href="#" uib-tooltip="Descargar anexos" data-id="'+t.id+'" >   <i class="fa fa-cloud-download"></i></a> ';return d.can("seguimiento_view"),a+=l,d.can("seguimiento_edit"),a+=o,d.can("seguimiento_delete"),a+=r,a+=c}),a.newColumn("createdAt").withTitle("Fecha Registro").withOption("width",200).withOption("defaultContent",""),a.newColumn("documentNumber").withTitle("Número Identificación").withOption("width",200).withOption("defaultContent",""),a.newColumn("firstName").withTitle("Nombre").withOption("width",200).withOption("defaultContent",""),a.newColumn("lastName").withTitle("Apellidos").withOption("width",200).withOption("defaultContent",""),a.newColumn("occupation").withTitle("Cargo").withOption("width",200).withOption("defaultContent","")];var O=function(){$("#dtHealthDamageQualificationSource a.editRow").on("click",function(){var e=$(this).data("id");t.editWorkMedicine(e)}),$("#dtHealthDamageQualificationSource a.viewRow").on("click",function(){var e=$(this).data("id");t.viewWorkMedicine(e)}),$("#dtHealthDamageQualificationSource a.downloadDocumentRow").on("click",function(){var t=$(this).data("id");f(t)}),$("#dtHealthDamageQualificationSource a.delRow").on("click",function(){var e=$(this).data("id");g.info("intenta eliminar el registro: "+e),s.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(n){if(n){var a={};a.id=e,w({method:"POST",url:"api/customer/health-damage/qs/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){i.error(t),s.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){t.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};t.reloadData=function(){t.dtInstanceHealthDamageQualificationSource.reloadData()},t.editWorkMedicine=function(e){null!=t.$parent&&t.$parent.navToSection("form","edit",e)},t.viewWorkMedicine=function(e){null!=t.$parent&&t.$parent.navToSection("form","view",e)}}]),app.controller("ModalInstanceSideHealthDamageQualificationSourceDownloadDocument",["$rootScope","$scope","$uibModalInstance","qs","$log","$timeout","SweetAlert","isView","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$filter","FileUploader","$http","$compile",function(t,e,i,n,a,o,l,r,c,d,u,s,w,h,m){e.datePickerConfig={culture:"es-CO",format:"dd/MM/yyyy hh:mm tt"},e.qs=n,e.isView=r,e.onClose=function(){i.close(1)},e.onCancel=function(){i.dismiss("cancel")},e.dtInstanceCustomerHealthDamageDocument={},e.dtOptionsCustomerHealthDamageDocument=c.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){t.customer_health_damage_qs_id=e.qs.id},url:"api/customer/health-damage/qs/document-all",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){p()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,i,n){m(angular.element(t).contents())(e)}),e.dtColumnsCustomerHealthDamageDocument=[d.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,e,i,n){var a="",o=null!=t.document?t.document.path:"",l=('<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar anexo" data-id="'+t.id+'" >   <i class="fa fa-trash-o"></i></a> ','<a target="_self" class="btn btn-info btn-xs downloadRow lnk" href="#" uib-tooltip="Descargar anexo" data-id="'+t.id+'" data-url="'+o+'" >   <i class="fa fa-download"></i></a> ');return""!=o&&(a+=l),a}),d.newColumn("createdAt").withTitle("Fecha registro").withOption("width",120).withOption("defaultContent",""),d.newColumn("entityName").withTitle("Módulo").withOption("width",200).withOption("defaultContent",""),d.newColumn("type.item").withTitle("Tipo").withOption("width",200).withOption("defaultContent",""),d.newColumn("name").withTitle("Nombre").withOption("width",200).withOption("defaultContent",""),d.newColumn("description").withTitle("Descripción").withOption("defaultContent",""),d.newColumn("version").withTitle("Version").withOption("width",200).withOption("defaultContent",""),d.newColumn("status.item").withTitle("Estado").withOption("width",150).renderWith(function(t,e,i,n){var a="",o="";return"Activo"==t?(o=t,a="label label-success"):(o=t,a="label label-danger"),'<span class="'+a+'">'+o+"</span>"})];var p=function(){$("#dtCustomerHealthDamageDocument a.downloadRow").on("click",function(){var t=$(this).data("id"),e=$(this).data("url");""==e?toaster.pop("error","Error en la descarga","No existe un anexo para descargar"):jQuery("#download")[0].src="api/customer/health-damage/qs/document/download?id="+t})};e.reloadData=function(){e.dtInstanceCustomerHealthDamageDocument.reloadData()},e.onDownload=function(){jQuery("#download")[0].src="api/customer/health-damage/qs/document/download-all?id="+n.id}}]);
"use strict";app.controller("customerHealthDamageQualificationLostCtrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout",function(t,o,e,i,c,n){var r=e;r.info("loading..customerWorkMedicineCtrl!!! "),t.tracking_section="list",t.currentId=0,t.modeDsp="edit",t.navToSection=function(o,e,i){n(function(){t.tracking_section=o,t.modeDsp=e,t.$parent.switchSubTab(e),t.currentId=i})}}]);
"use strict";app.controller("customerHealthDamageQualificationLostEditCtrl",["$scope","$stateParams","$log","$compile","$state","SweetAlert","$rootScope","$http","$timeout","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$uibModal","flowFactory","cfpLoadingBar","$filter","$aside","$document","toaster","FileUploader",function(t,e,a,n,i,o,r,l,c,s,d,u,m,p,h,f,g,w,D,y){var v=a,O=0,b=t.$parent.currentId;t.isAgent="agent"==r.currentUser().wg_type,t.isAdmin="system"==r.currentUser().wg_type,t.isCustomer="customerAdmin"==r.currentUser().wg_type||"customerUser"==r.currentUser().wg_type,v.info("loading..customerHealthDamageQualificationSourceEditCtrl con el id: ",b),t.arl=r.parameters("arl"),t.documentType=r.parameters("customer_document_type"),t.tiposdoc=r.parameters("tipodoc"),t.diagnosticList=r.parameters("work_health_damage_diagnostic"),t.lateralities=r.parameters("work_health_damage_laterality"),t.entityPerformsDiagnostic=r.parameters("work_health_damage_entity_perform_diagnostic"),t.codeCIE10=r.parameters("work_health_damage_code_cie_10"),t.applicants=r.parameters("work_health_damage_applicant"),t.directors=r.parameters("work_health_damage_apt"),t.supports=r.parameters("work_health_damage_diagnostic_support"),t.documents=r.parameters("work_health_damage_diagnostic_document"),t.qualifyingEntities=r.parameters("work_health_damage_entity_qualify"),t.qualifiedOrigins=r.parameters("work_health_damage_entity_qualify_origin"),t.controversyStatus=r.parameters("work_health_damage_controversy_status"),t.classifications=r.parameters("work_health_damage_ql_document_type"),t.documentStatusList=r.parameters("work_health_damage_document_status"),t.canShow=!1,t.isView="view"==t.$parent.modeDsp,t.minDateCurrent=new Date,t.customerId=e.customerId,t.maxDate=new Date,t.datePickerConfig={culture:"es-CO",format:"dd/MM/yyyy HH:mm"},t.employees=[],t.diagnostics=[],t.onLoadRecord=function(){if(0!=t.ql.id){v.info("editando cliente con código: "+t.ql.id);var e={id:t.ql.id};l({method:"GET",url:"api/customer/health-damage/ql",params:e})["catch"](function(t,e){if(403==e){var a=null!==t.message&&void 0!==t.message?t.message:"app.clientes.list";o.swal("No Autorizado","No estas autorizado para ver esta información.","error"),c(function(){i.go(a)},3e3)}else 404==e?o.swal("Información no disponible","Centro de trabajo no encontrado","error"):o.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(e){c(function(){t.ql=e.data.result,t.canShow=!0,null!=t.ql.opportunity&&""!=t.ql.opportunity&&(t.opportunity=t.ql.opportunity,t.opportunity.dateOf=new Date(t.opportunity.dateOf.date),t.opportunity.notificationDate=new Date(t.opportunity.notificationDate.date),t.opportunity.structuringDate=new Date(t.opportunity.structuringDate.date),t.opportunity.nonconformityDate=new Date(t.opportunity.nonconformityDate.date),t.opportunityAttachment.entityId=t.opportunity.id,t.reloadDataHealthDamageQlFirstOpportunityDocument()),null!=t.ql.regional&&""!=t.ql.regional&&(t.regional=t.ql.regional,t.regional.structuringDate=new Date(t.regional.structuringDate.date),t.regional.dateOf=new Date(t.regional.dateOf.date),t.regional.notificationDate=new Date(t.regional.notificationDate.date),t.regional.nonconformityDate=new Date(t.regional.nonconformityDate.date),t.regionalAttachment.entityId=t.regional.id,t.reloadDataHealthDamageQlRegionalBoardDocument()),null!=t.ql.national&&""!=t.ql.national&&(t.national=t.ql.national,t.national.structuringDate=new Date(t.national.structuringDate.date),t.national.dateOf=new Date(t.national.dateOf.date),t.national.notificationDate=new Date(t.national.notificationDate.date),t.nationalAttachment.entityId=t.national.id,t.reloadDataHealthDamageQlNationalBoardDocument()),null!=t.ql.justiceFirst&&""!=t.ql.justiceFirst&&(t.justiceFirst=t.ql.justiceFirst,t.justiceFirst.dateOf=new Date(t.justiceFirst.dateOf.date),t.justiceFirst.structuringDate=new Date(t.justiceFirst.structuringDate.date),t.justiceFirstAttachment.entityId=t.justiceFirst.id,t.reloadDataHealthDamageQlJusticeBoardFirstDocument()),null!=t.ql.justiceSecond&&""!=t.ql.justiceSecond&&(t.justiceSecond=t.ql.justiceSecond,t.justiceSecond.dateOf=new Date(t.justiceSecond.dateOf.date),t.justiceSecond.structuringDate=new Date(t.justiceSecond.structuringDate.date),t.justiceSecondAttachment.entityId=t.justiceSecond.id,t.reloadDataHealthDamageQlJusticeBoardSecondDocument())})})["finally"](function(){c(function(){t.loading=!1},400),c(function(){w.scrollTop(40,2e3)})})}else v.info("creacion de nuevo cliente"),t.loading=!1},t.ql={id:b,employee:null,arl:null,stepQualificationRegionalBoard:!1,stepQualificationNationalBoard:!1,stepQualificationLaborJustice:!1,isActive:!0,opportunity:null,regional:null,national:null,justiceFirst:null,justiceSecond:null,justiceThird:null,stepSecondInstance:!1};var C=function(){t.opportunity={id:0,customerHealthDamageQualificationLostId:t.ql.id,qualifyingEntity:null,dateOf:null,notificationDate:null,origin:null,percentageRating:0,structuringDate:null,nonconformityDate:null,controversyStatus:null,diagnostics:[]},t.opportunityAttachment={id:0,customerHealthDamageQualificationLostId:t.ql.id,entityId:t.opportunity.id,entityCode:"opportunity",entityName:"Primera Oportunidad",type:null,name:"",description:"",version:"1",status:{item:"Activo",value:"Activo"},startDate:null,endDate:null},t.regional={id:0,customerHealthDamageQualificationLostId:t.ql.id,controversyStatus:null,structuringDate:null,dateOf:null,notificationDate:null,nonconformityDate:null,origin:null,percentageRating:0,diagnostics:[]},t.regionalAttachment={id:0,customerHealthDamageQualificationLostId:t.ql.id,entityId:t.regional.id,entityCode:"regional",entityName:"Primera Instancia",type:null,name:"",description:"",version:"1",status:{item:"Activo",value:"Activo"},startDate:null,endDate:null},t.national={id:0,customerHealthDamageQualificationLostId:t.ql.id,controversyStatus:null,structuringDate:null,dateOf:null,notificationDate:null,origin:null,percentageRating:0,diagnostics:[]},t.nationalAttachment={id:0,customerHealthDamageQualificationLostId:t.ql.id,entityId:t.national.id,entityCode:"national",entityName:"Segunda Instancia",type:null,name:"",description:"",version:"1",status:{item:"Activo",value:"Activo"},startDate:null,endDate:null},t.justiceFirst={id:0,customerHealthDamageQualificationLostId:t.ql.id,sentenceType:"first",dateOf:null,structuringDate:null,judgment:"",origin:null,percentageRating:0,diagnostics:[]},t.justiceFirstAttachment={id:0,customerHealthDamageQualificationLostId:t.ql.id,entityId:t.justiceFirst.id,entityCode:"justiceFirst",entityName:"Justicia Laboral Ordinaria / Primera Sentencia",type:null,name:"",description:"",version:"1",status:{item:"Activo",value:"Activo"},startDate:null,endDate:null},t.justiceSecond={id:0,customerHealthDamageQualificationLostId:t.ql.id,sentenceType:"second",dateOf:null,structuringDate:null,judgment:"",origin:null,percentageRating:0,diagnostics:[]},t.justiceSecondAttachment={id:0,customerHealthDamageQualificationLostId:t.ql.id,entityId:t.justiceSecond.id,entityCode:"justiceSecond",entityName:"Justicia Laboral Ordinaria / Segunda Sentencia",type:null,name:"",description:"",version:"1",status:{item:"Activo",value:"Activo"},startDate:null,endDate:null}};C(),t.onLoadRecord(),t.master=t.ql,t.form={submit:function(e){var a=null;if(e.$invalid){var n=null,a=null;for(n in e)"$"!=n[0]&&(null!==a||e[n].$valid||(a=e[n].$name),e[n].$pristine&&(e[n].$dirty=!0));return v.info(t.customer),angular.element(".ng-invalid[name="+a+"]").focus(),void o.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}o.swal("Validación exitosa","Procediendo con el guardado...","success"),v.info(t.customer),S()},reset:function(e){t.ql=angular.copy(t.master),e.$setPristine(!0)}};var S=function(){var e={},n=JSON.stringify(t.ql);return e.data=Base64.encode(n),l({method:"POST",url:"api/customer/health-damage/ql/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){c(function(){t.ql=e.data.result,t.canShow=!0,t.opportunity.customerHealthDamageQualificationLostId=t.ql.id,t.regional.customerHealthDamageQualificationLostId=t.ql.id,t.national.customerHealthDamageQualificationLostId=t.ql.id,t.justiceFirst.customerHealthDamageQualificationLostId=t.ql.id,t.justiceSecond.customerHealthDamageQualificationLostId=t.ql.id})})["catch"](function(t){a.error(t),o.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};t.cancelEdition=function(){null!=t.$parent&&t.$parent.navToSection("list","list")},t.saveHealthDamageQlFirstOpportunity=function(){var e={},n=JSON.stringify(t.opportunity);return e.data=Base64.encode(n),l({method:"POST",url:"api/customer/health-damage/ql/opportunity/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){c(function(){D.pop("success","Operación Exitosa","Se guardó la información exitosamente..."),t.opportunity=e.data.result,t.opportunity.dateOf=new Date(t.opportunity.dateOf.date),t.opportunity.notificationDate=new Date(t.opportunity.notificationDate.date),t.opportunity.structuringDate=new Date(t.opportunity.structuringDate.date),t.opportunity.nonconformityDate=new Date(t.opportunity.nonconformityDate.date),t.clearHealthDamageQlFirstOpportunityDocument()})})["catch"](function(t){a.error(t),o.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})},t.onAddOpportunityDiagnostic=function(){c(function(){null==t.opportunity.diagnostics&&(t.opportunity.diagnostics=[]),t.opportunity.diagnostics.push({id:0,customerHealthDamageQlFirstOpportunityId:0,codeCIE10:null,description:"",observation:""})})},t.onRemoveOpportunityDiagnostic=function(e){o.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(n){n?c(function(){var n=t.opportunity.diagnostics[e];if(t.opportunity.diagnostics.splice(e,1),0!=n.id){var i={};i.id=n.id,l({method:"POST",url:"api/customer/health-damage/ql/opportunity-diagnostic/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){a.error(t),o.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})},t.dtInstanceHealthDamageQlOpportunityDocument={},t.dtOptionsHealthDamageQlOpportunityDocument=s.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerHealthDamageQualificationLostId=t.ql.id,e.entityCode="opportunity",e.entityId=t.opportunity.id,JSON.stringify(e)},url:"api/customer-health-damage-ql-document",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){Q()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,a,i){n(angular.element(e).contents())(t)}),t.dtColumnsHealthDamageQlOpportunityDocument=[d.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,a,n,i){var o="",r=null!=e.document?e.document.path:"",l='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+e.id+'" >   <i class="fa fa-edit"></i></a> ',c='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+e.id+'" >   <i class="fa fa-trash-o"></i></a> ',s='<a target="_self" class="btn btn-info btn-xs downloadRow lnk" href="#" uib-tooltip="Descargar anexo" data-id="'+e.id+'" data-url="'+r+'" >   <i class="fa fa-download"></i></a> ';return o+=l,""!=r&&(o+=s),o+=c,t.isView?s:o}),d.newColumn("item").withTitle("Tipo").withOption("width",200).withOption("defaultContent",""),d.newColumn("name").withTitle("Nombre").withOption("width",200).withOption("defaultContent",""),d.newColumn("description").withTitle("Descripción").withOption("defaultContent",""),d.newColumn("version").withTitle("Versión").withOption("width",200).withOption("defaultContent",""),d.newColumn("status").withTitle("Estado").withOption("width",150).renderWith(function(t,e,a,n){var i="",o="";return"Activo"==t?(o=t,i="label label-success"):(o=t,i="label label-danger"),'<span class="'+i+'">'+o+"</span>"})];var Q=function(){$("#dtHealthDamageQlOpportunityDocument a.editRow").on("click",function(){var e=$(this).data("id");t.editHealthDamageQlFirstOpportunityDocument(e)}),$("#dtHealthDamageQlOpportunityDocument a.downloadRow").on("click",function(){var t=$(this).data("id"),e=$(this).data("url");""==e?D.pop("error","Error en la descarga","No existe un anexo para descargar"):jQuery("#download")[0].src="api/customer/health-damage/ql/document/download?id="+t}),$("#dtHealthDamageQlOpportunityDocument a.delRow").on("click",function(){var e=$(this).data("id");v.info("intenta eliminar el registro: "+e),o.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(n){if(n){var i={};i.id=e,l({method:"POST",url:"api/customer/health-damage/ql/document/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){a.error(t),o.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){t.reloadDataHealthDamageQlFirstOpportunityDocument()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};t.dtInstanceHealthDamageQlOpportunityDocumentCallback=function(e){t.dtInstanceHealthDamageQlOpportunityDocument=e,t.reloadDataHealthDamageQlFirstOpportunityDocument()},t.reloadDataHealthDamageQlFirstOpportunityDocument=function(){void 0!=t.dtInstanceHealthDamageQlOpportunityDocument.reloadData&&t.dtInstanceHealthDamageQlOpportunityDocument.reloadData()},t.editHealthDamageQlFirstOpportunityDocument=function(e){if(e){var a={id:e};l({method:"GET",url:"api/customer/health-damage/ql/document",params:a})["catch"](function(t,e){if(403==e){var a=null!==t.message&&void 0!==t.message?t.message:"app.clientes.list";o.swal("No Autorizado","No estas autorizado para ver esta información.","error"),c(function(){i.go(a)},3e3)}else 404==e?o.swal("Información no disponible","Centro de trabajo no encontrado","error"):o.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(e){c(function(){t.opportunityAttachment=e.data.result,null!=t.opportunityAttachment.startDate&&(t.opportunityAttachment.startDate=new Date(t.opportunityAttachment.startDate.date)),null!=t.opportunityAttachment.endDate&&(t.opportunityAttachment.endDate=new Date(t.opportunityAttachment.endDate.date))})})["finally"](function(){c(function(){t.loading=!1},400),c(function(){})})}else v.info("creacion de nuevo cliente"),t.loading=!1},t.saveHealthDamageQlFirstOpportunityDocument=function(){var e={},n=JSON.stringify(t.opportunityAttachment);return null!=t.opportunityAttachment.type&&""!=t.opportunityAttachment.name&&null!=t.opportunityAttachment.status&&""!=t.opportunityAttachment.description?(e.data=Base64.encode(n),l({method:"POST",url:"api/customer/health-damage/ql/document/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){c(function(){D.pop("success","Operación Exitosa","Se guardó la información exitosamente..."),t.uploaderOpportunity.queue.length>0?(O=e.data.result.id,q.uploadAll()):(t.clearHealthDamageQlFirstOpportunityDocument(),t.reloadDataHealthDamageQlFirstOpportunityDocument(),t.reloadDataHealthDamageQlDocument())})})["catch"](function(t){a.error(t),o.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})):void o.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e intentalo de nuevo.","error")},t.clearHealthDamageQlFirstOpportunityDocument=function(){t.opportunityAttachment={id:0,customerHealthDamageQualificationLostId:t.ql.id,entityId:t.opportunity.id,entityCode:"opportunity",entityName:"Primera Oportunidad",type:null,name:"",description:"",version:"1",status:{item:"Activo",value:"Activo"},startDate:null,endDate:null}},t.saveHealthDamageQlRegionalBoard=function(){var e={},n=JSON.stringify(t.regional);return e.data=Base64.encode(n),l({method:"POST",url:"api/customer/health-damage/ql/regional/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){c(function(){D.pop("success","Operación Exitosa","Se guardó la información exitosamente..."),t.regional=e.data.result,t.regional.structuringDate=new Date(t.regional.structuringDate.date),t.regional.dateOf=new Date(t.regional.dateOf.date),t.regional.notificationDate=new Date(t.regional.notificationDate.date),t.regional.nonconformityDate=new Date(t.regional.nonconformityDate.date),t.clearHealthDamageQlRegionalBoardDocument()})})["catch"](function(t){a.error(t),o.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})},t.onAddRegionalDiagnostic=function(){c(function(){null==t.regional.diagnostics&&(t.regional.diagnostics=[]),t.regional.diagnostics.push({id:0,customerHealthDamageQlRegionalBoardId:0,codeCIE10:null,description:"",observation:""})})},t.onRemoveRegionalDiagnostic=function(e){o.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(n){n?c(function(){var n=t.regional.diagnostics[e];if(t.regional.diagnostics.splice(e,1),0!=n.id){var i={};i.id=n.id,l({method:"POST",url:"api/customer/health-damage/qs/regional-diagnostic/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){a.error(t),o.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})},t.dtInstanceHealthDamageQlRegionalDocument={},t.dtOptionsHealthDamageQlRegionalDocument=s.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerHealthDamageQualificationLostId=t.ql.id,e.entityCode="regional",e.entityId=t.regional.id,JSON.stringify(e)},url:"api/customer-health-damage-ql-document",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){A()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,a,i){n(angular.element(e).contents())(t)}),t.dtColumnsHealthDamageQlRegionalDocument=[d.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,a,n,i){var o="",r=null!=e.document?e.document.path:"",l='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+e.id+'" >   <i class="fa fa-edit"></i></a> ',c='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+e.id+'" >   <i class="fa fa-trash-o"></i></a> ',s='<a target="_self" class="btn btn-info btn-xs downloadRow lnk" href="#" uib-tooltip="Descargar anexo" data-id="'+e.id+'" data-url="'+r+'" >   <i class="fa fa-download"></i></a> ';return o+=l,""!=r&&(o+=s),o+=c,t.isView?s:o}),d.newColumn("item").withTitle("Tipo").withOption("width",200).withOption("defaultContent",""),d.newColumn("name").withTitle("Nombre").withOption("width",200).withOption("defaultContent",""),d.newColumn("description").withTitle("Descripción").withOption("defaultContent",""),d.newColumn("version").withTitle("Versión").withOption("width",200).withOption("defaultContent",""),d.newColumn("status").withTitle("Estado").withOption("width",150).renderWith(function(t,e,a,n){var i="",o="";return"Activo"==t?(o=t,i="label label-success"):(o=t,i="label label-danger"),'<span class="'+i+'">'+o+"</span>"})];var A=function(){$("#dtHealthDamageQlRegionalDocument a.editRow").on("click",function(){var e=$(this).data("id");t.editHealthDamageQlRegionalBoardDocument(e)}),$("#dtHealthDamageQlRegionalDocument a.downloadRow").on("click",function(){var t=$(this).data("id"),e=$(this).data("url");""==e?D.pop("error","Error en la descarga","No existe un anexo para descargar"):jQuery("#download")[0].src="api/customer/health-damage/ql/document/download?id="+t}),$("#dtHealthDamageQlRegionalDocument a.delRow").on("click",function(){var e=$(this).data("id");v.info("intenta eliminar el registro: "+e),o.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(n){if(n){var i={};i.id=e,l({method:"POST",url:"api/customer/health-damage/ql/document/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){a.error(t),o.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){t.reloadDataHealthDamageQlRegionalBoardDocument()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};t.dtInstanceHealthDamageQlRegionalDocumentCallback=function(e){t.dtInstanceHealthDamageQlRegionalDocument=e,t.reloadDataHealthDamageQlRegionalBoardDocument()},t.reloadDataHealthDamageQlRegionalBoardDocument=function(){void 0!=t.dtInstanceHealthDamageQlRegionalDocument.reloadData&&t.dtInstanceHealthDamageQlRegionalDocument.reloadData()},t.editHealthDamageQlRegionalBoardDocument=function(e){if(e){var a={id:e};l({method:"GET",url:"api/customer/health-damage/ql/document",params:a})["catch"](function(t,e){if(403==e){var a=null!==t.message&&void 0!==t.message?t.message:"app.clientes.list";o.swal("No Autorizado","No estas autorizado para ver esta información.","error"),c(function(){i.go(a)},3e3)}else 404==e?o.swal("Información no disponible","Centro de trabajo no encontrado","error"):o.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(e){c(function(){t.regionalAttachment=e.data.result,null!=t.regionalAttachment.startDate&&(t.regionalAttachment.startDate=new Date(t.regionalAttachment.startDate.date)),null!=t.regionalAttachment.endDate&&(t.regionalAttachment.endDate=new Date(t.regionalAttachment.endDate.date))})})["finally"](function(){c(function(){t.loading=!1},400),c(function(){})})}else v.info("creacion de nuevo cliente"),t.loading=!1},t.saveHealthDamageQlRegionalBoardDocument=function(){var e={},n=JSON.stringify(t.regionalAttachment);return null!=t.regionalAttachment.type&&""!=t.regionalAttachment.name&&null!=t.regionalAttachment.status&&""!=t.regionalAttachment.description?(e.data=Base64.encode(n),l({method:"POST",url:"api/customer/health-damage/ql/document/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){c(function(){D.pop("success","Operación Exitosa","Se guardó la información exitosamente..."),t.uploaderRegional.queue.length>0?(O=e.data.result.id,I.uploadAll()):(t.clearHealthDamageQlRegionalBoardDocument(),t.reloadDataHealthDamageQlRegionalBoardDocument(),t.reloadDataHealthDamageQlDocument())})})["catch"](function(t){a.error(t),o.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})):void o.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e intentalo de nuevo.","error")},t.clearHealthDamageQlRegionalBoardDocument=function(){t.regionalAttachment={id:0,customerHealthDamageQualificationLostId:t.ql.id,entityId:t.regional.id,entityCode:"regional",entityName:"Primera Instancia",type:null,name:"",description:"",version:"1",status:{item:"Activo",value:"Activo"},startDate:null,endDate:null}},t.saveHealthDamageQlNationalBoard=function(){var e={},n=JSON.stringify(t.national);return e.data=Base64.encode(n),l({method:"POST",url:"api/customer/health-damage/ql/national/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){c(function(){D.pop("success","Operación Exitosa","Se guardó la información exitosamente..."),t.national=e.data.result,t.national.structuringDate=new Date(t.national.structuringDate.date),t.national.dateOf=new Date(t.national.dateOf.date),t.national.notificationDate=new Date(t.national.notificationDate.date),t.clearHealthDamageQlNationalBoardDocument()})})["catch"](function(t){a.error(t),o.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})},t.onAddNationalDiagnostic=function(){c(function(){null==t.national.diagnostics&&(t.national.diagnostics=[]),t.national.diagnostics.push({id:0,customerHealthDamageQlNationalBoardId:0,codeCIE10:null,description:"",observation:""})})},t.onRemoveNationalDiagnostic=function(e){o.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(n){n?c(function(){var n=t.national.diagnostics[e];if(t.national.diagnostics.splice(e,1),0!=n.id){var i={};i.id=n.id,l({method:"POST",url:"api/customer/health-damage/ql/national-diagnostic/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){a.error(t),o.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})},t.dtInstanceHealthDamageQlNationalDocument={},t.dtOptionsHealthDamageQlNationalDocument=s.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerHealthDamageQualificationLostId=t.ql.id,e.entityCode="national",e.entityId=t.national.id,JSON.stringify(e)},url:"api/customer-health-damage-ql-document",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){H()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,a,i){n(angular.element(e).contents())(t)}),t.dtColumnsHealthDamageQlNationalDocument=[d.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,a,n,i){var o="",r=null!=e.document?e.document.path:"",l='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+e.id+'" >   <i class="fa fa-edit"></i></a> ',c='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+e.id+'" >   <i class="fa fa-trash-o"></i></a> ',s='<a target="_self" class="btn btn-info btn-xs downloadRow lnk" href="#" uib-tooltip="Descargar anexo" data-id="'+e.id+'" data-url="'+r+'" >   <i class="fa fa-download"></i></a> ';return o+=l,""!=r&&(o+=s),o+=c,t.isView?s:o}),d.newColumn("item").withTitle("Tipo").withOption("width",200).withOption("defaultContent",""),d.newColumn("name").withTitle("Nombre").withOption("width",200).withOption("defaultContent",""),d.newColumn("description").withTitle("Descripción").withOption("defaultContent",""),d.newColumn("version").withTitle("Versión").withOption("width",200).withOption("defaultContent",""),d.newColumn("status").withTitle("Estado").withOption("width",150).renderWith(function(t,e,a,n){var i="",o="";return"Activo"==t?(o=t,i="label label-success"):(o=t,i="label label-danger"),'<span class="'+i+'">'+o+"</span>"})];var H=function(){$("#dtHealthDamageQlNationalDocument a.editRow").on("click",function(){var e=$(this).data("id");t.editHealthDamageQlNationalBoardDocument(e)}),$("#dtHealthDamageQlNationalDocument a.downloadRow").on("click",function(){var t=$(this).data("id"),e=$(this).data("url");""==e?D.pop("error","Error en la descarga","No existe un anexo para descargar"):jQuery("#download")[0].src="api/customer/health-damage/ql/document/download?id="+t}),$("#dtHealthDamageQlNationalDocument a.delRow").on("click",function(){var e=$(this).data("id");v.info("intenta eliminar el registro: "+e),o.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(n){if(n){var i={};i.id=e,l({method:"POST",url:"api/customer/health-damage/ql/document/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){a.error(t),o.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){t.reloadDataHealthDamageQlNationalBoardDocument()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};t.dtInstanceHealthDamageQlNationalDocumentCallback=function(e){t.dtInstanceHealthDamageQlNationalDocument=e,t.reloadDataHealthDamageQlNationalBoardDocument()},t.reloadDataHealthDamageQlNationalBoardDocument=function(){void 0!=t.dtInstanceHealthDamageQlNationalDocument.reloadData&&t.dtInstanceHealthDamageQlNationalDocument.reloadData()},t.editHealthDamageQlNationalBoardDocument=function(e){if(e){var a={id:e};l({method:"GET",url:"api/customer/health-damage/ql/document",params:a})["catch"](function(t,e){if(403==e){var a=null!==t.message&&void 0!==t.message?t.message:"app.clientes.list";o.swal("No Autorizado","No estas autorizado para ver esta información.","error"),c(function(){i.go(a)},3e3)}else 404==e?o.swal("Información no disponible","Centro de trabajo no encontrado","error"):o.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(e){c(function(){t.nationalAttachment=e.data.result,null!=t.nationalAttachment.startDate&&(t.nationalAttachment.startDate=new Date(t.nationalAttachment.startDate.date)),
null!=t.nationalAttachment.endDate&&(t.nationalAttachment.endDate=new Date(t.nationalAttachment.endDate.date))})})["finally"](function(){c(function(){t.loading=!1},400),c(function(){})})}else v.info("creacion de nuevo cliente"),t.loading=!1},t.saveHealthDamageQlNationalBoardDocument=function(){var e={},n=JSON.stringify(t.nationalAttachment);return null!=t.nationalAttachment.type&&""!=t.nationalAttachment.name&&null!=t.nationalAttachment.status&&""!=t.nationalAttachment.description?(e.data=Base64.encode(n),l({method:"POST",url:"api/customer/health-damage/ql/document/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){c(function(){D.pop("success","Operación Exitosa","Se guardó la información exitosamente..."),t.uploaderNational.queue.length>0?(O=e.data.result.id,x.uploadAll()):(t.clearHealthDamageQlNationalBoardDocument(),t.reloadDataHealthDamageQlNationalBoardDocument(),t.reloadDataHealthDamageQlDocument())})})["catch"](function(t){a.error(t),o.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})):void o.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e intentalo de nuevo.","error")},t.clearHealthDamageQlNationalBoardDocument=function(){t.nationalAttachment={id:0,customerHealthDamageQualificationLostId:t.ql.id,entityId:t.national.id,entityCode:"national",entityName:"Segunda Instancia",type:null,name:"",description:"",version:"1",status:{item:"Activo",value:"Activo"},startDate:null,endDate:null}},t.saveHealthDamageQlJusticeBoardFirst=function(){var e={},n=JSON.stringify(t.justiceFirst);return e.data=Base64.encode(n),l({method:"POST",url:"api/customer/health-damage/ql/justice/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){c(function(){D.pop("success","Operación Exitosa","Se guardó la información exitosamente..."),t.justiceFirst=e.data.result,t.justiceFirst.structuringDate=new Date(t.justiceFirst.structuringDate.date),t.justiceFirst.dateOf=new Date(t.justiceFirst.dateOf.date),t.clearHealthDamageQlJusticeBoardFirstDocument()})})["catch"](function(t){a.error(t),o.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})},t.onAddJusticeFirstDiagnostic=function(){c(function(){null==t.justiceFirst.diagnostics&&(t.justiceFirst.diagnostics=[]),t.justiceFirst.diagnostics.push({id:0,customerHealthDamageQlJusticeBoardId:0,codeCIE10:null,description:"",observation:""})})},t.onRemoveJusticeFirstDiagnostic=function(e){o.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(n){n?c(function(){var n=t.justiceFirst.diagnostics[e];if(t.justiceFirst.diagnostics.splice(e,1),0!=n.id){var i={};i.id=n.id,l({method:"POST",url:"api/customer/health-damage/ql/justice-diagnostic/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){a.error(t),o.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})},t.dtInstanceHealthDamageQlJusticeFirstDocument={},t.dtOptionsHealthDamageQlJusticeFirstDocument=s.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerHealthDamageQualificationLostId=t.ql.id,e.entityCode="justiceFirst",e.entityId=t.justiceFirst.id,JSON.stringify(e)},url:"api/customer-health-damage-ql-document",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){T()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,a,i){n(angular.element(e).contents())(t)}),t.dtColumnsHealthDamageQlJusticeFirstDocument=[d.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,a,n,i){var o="",r=null!=e.document?e.document.path:"",l='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+e.id+'" >   <i class="fa fa-edit"></i></a> ',c='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+e.id+'" >   <i class="fa fa-trash-o"></i></a> ',s='<a target="_self" class="btn btn-info btn-xs downloadRow lnk" href="#" uib-tooltip="Descargar anexo" data-id="'+e.id+'" data-url="'+r+'" >   <i class="fa fa-download"></i></a> ';return o+=l,""!=r&&(o+=s),o+=c,t.isView?s:o}),d.newColumn("item").withTitle("Tipo").withOption("width",200).withOption("defaultContent",""),d.newColumn("name").withTitle("Nombre").withOption("width",200).withOption("defaultContent",""),d.newColumn("description").withTitle("Descripción").withOption("defaultContent",""),d.newColumn("version").withTitle("Versión").withOption("width",200).withOption("defaultContent",""),d.newColumn("status").withTitle("Estado").withOption("width",150).renderWith(function(t,e,a,n){var i="",o="";return"Activo"==t?(o=t,i="label label-success"):(o=t,i="label label-danger"),'<span class="'+i+'">'+o+"</span>"})];var T=function(){$("#dtHealthDamageQlJusticeFirstDocument a.editRow").on("click",function(){var e=$(this).data("id");t.editHealthDamageQlJusticeBoardFirstDocument(e)}),$("#dtHealthDamageQlJusticeFirstDocument a.downloadRow").on("click",function(){var t=$(this).data("id"),e=$(this).data("url");""==e?D.pop("error","Error en la descarga","No existe un anexo para descargar"):jQuery("#download")[0].src="api/customer/health-damage/ql/document/download?id="+t}),$("#dtHealthDamageQlJusticeFirstDocument a.delRow").on("click",function(){var e=$(this).data("id");v.info("intenta eliminar el registro: "+e),o.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(n){if(n){var i={};i.id=e,l({method:"POST",url:"api/customer/health-damage/ql/document/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){a.error(t),o.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){t.reloadDataHealthDamageQlJusticeBoardFirstDocument()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};t.dtInstanceHealthDamageQlJusticeFirstDocumentCallback=function(e){t.dtInstanceHealthDamageQlJusticeFirstDocument=e,t.reloadDataHealthDamageQlJusticeBoardFirstDocument()},t.reloadDataHealthDamageQlJusticeBoardFirstDocument=function(){void 0!=t.dtInstanceHealthDamageQlJusticeFirstDocument.reloadData&&t.dtInstanceHealthDamageQlJusticeFirstDocument.reloadData()},t.editHealthDamageQlJusticeBoardFirstDocument=function(e){if(e){var a={id:e};l({method:"GET",url:"api/customer/health-damage/ql/document",params:a})["catch"](function(t,e){if(403==e){var a=null!==t.message&&void 0!==t.message?t.message:"app.clientes.list";o.swal("No Autorizado","No estas autorizado para ver esta información.","error"),c(function(){i.go(a)},3e3)}else 404==e?o.swal("Información no disponible","Centro de trabajo no encontrado","error"):o.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(e){c(function(){t.justiceFirstAttachment=e.data.result,null!=t.justiceFirstAttachment.startDate&&(t.justiceFirstAttachment.startDate=new Date(t.justiceFirstAttachment.startDate.date)),null!=t.justiceFirstAttachment.endDate&&(t.justiceFirstAttachment.endDate=new Date(t.justiceFirstAttachment.endDate.date))})})["finally"](function(){c(function(){t.loading=!1},400),c(function(){})})}else v.info("creacion de nuevo cliente"),t.loading=!1},t.saveHealthDamageQlJusticeBoardFirstDocument=function(){var e={},n=JSON.stringify(t.justiceFirstAttachment);return null!=t.justiceFirstAttachment.type&&""!=t.justiceFirstAttachment.name&&null!=t.justiceFirstAttachment.status&&""!=t.justiceFirstAttachment.description?(e.data=Base64.encode(n),l({method:"POST",url:"api/customer/health-damage/ql/document/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){c(function(){D.pop("success","Operación Exitosa","Se guardó la información exitosamente..."),t.uploaderJusticeFirst.queue.length>0?(O=e.data.result.id,j.uploadAll()):(t.clearHealthDamageQlJusticeBoardFirstDocument(),t.reloadDataHealthDamageQlJusticeBoardFirstDocument(),t.reloadDataHealthDamageQlDocument())})})["catch"](function(t){a.error(t),o.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})):void o.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e intentalo de nuevo.","error")},t.clearHealthDamageQlJusticeBoardFirstDocument=function(){t.justiceFirstAttachment={id:0,customerHealthDamageQualificationLostId:t.ql.id,entityId:t.justiceFirst.id,entityCode:"justiceFirst",entityName:"Justicia Laboral Ordinaria / Primera Sentencia",type:null,name:"",description:"",version:"1",status:{item:"Activo",value:"Activo"},startDate:null,endDate:null}},t.saveHealthDamageQlJusticeBoardSecond=function(){var e={},n=JSON.stringify(t.justiceSecond);return e.data=Base64.encode(n),l({method:"POST",url:"api/customer/health-damage/ql/justice/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){c(function(){D.pop("success","Operación Exitosa","Se guardó la información exitosamente..."),t.justiceSecond=e.data.result,t.clearHealthDamageQlJusticeBoardSecondDocument(),t.justiceSecond.structuringDate=new Date(t.justiceSecond.structuringDate.date),t.justiceSecond.dateOf=new Date(t.justiceSecond.dateOf.date)})})["catch"](function(t){a.error(t),o.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})},t.onAddJusticeSecondDiagnostic=function(){c(function(){null==t.justiceSecond.diagnostics&&(t.justiceSecond.diagnostics=[]),t.justiceSecond.diagnostics.push({id:0,customerHealthDamageQlJusticeBoardId:0,codeCIE10:null,description:"",observation:""})})},t.onRemoveJusticeSecondDiagnostic=function(e){o.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(n){n?c(function(){var n=t.justiceSecond.diagnostics[e];if(t.justiceSecond.diagnostics.splice(e,1),0!=n.id){var i={};i.id=n.id,l({method:"POST",url:"api/customer/health-damage/ql/justice-diagnostic/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){a.error(t),o.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})},t.dtInstanceHealthDamageQlJusticeSecondDocument={},t.dtOptionsHealthDamageQlJusticeSecondDocument=s.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerHealthDamageQualificationLostId=t.ql.id,e.entityCode="justiceSecond",e.entityId=t.justiceSecond.id,JSON.stringify(e)},url:"api/customer-health-damage-ql-document",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){B()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,a,i){n(angular.element(e).contents())(t)}),t.dtColumnsHealthDamageQlJusticeSecondDocument=[d.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,a,n,i){var o="",r=null!=e.document?e.document.path:"",l='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+e.id+'" >   <i class="fa fa-edit"></i></a> ',c='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+e.id+'" >   <i class="fa fa-trash-o"></i></a> ',s='<a target="_self" class="btn btn-info btn-xs downloadRow lnk" href="#" uib-tooltip="Descargar anexo" data-id="'+e.id+'" data-url="'+r+'" >   <i class="fa fa-download"></i></a> ';return o+=l,""!=r&&(o+=s),o+=c,t.isView?s:o}),d.newColumn("item").withTitle("Tipo").withOption("width",200).withOption("defaultContent",""),d.newColumn("name").withTitle("Nombre").withOption("width",200).withOption("defaultContent",""),d.newColumn("description").withTitle("Descripción").withOption("defaultContent",""),d.newColumn("version").withTitle("Versión").withOption("width",200).withOption("defaultContent",""),d.newColumn("status").withTitle("Estado").withOption("width",150).renderWith(function(t,e,a,n){var i="",o="";return"Activo"==t?(o=t,i="label label-success"):(o=t,i="label label-danger"),'<span class="'+i+'">'+o+"</span>"})];var B=function(){$("#dtHealthDamageQlJusticeSecondDocument a.editRow").on("click",function(){var e=$(this).data("id");t.editHealthDamageQlJusticeBoardSecondDocument(e)}),$("#dtHealthDamageQlJusticeSecondDocument a.downloadRow").on("click",function(){var t=$(this).data("id"),e=$(this).data("url");""==e?D.pop("error","Error en la descarga","No existe un anexo para descargar"):jQuery("#download")[0].src="api/customer/health-damage/ql/document/download?id="+t}),$("#dtHealthDamageQlJusticeSecondDocument a.delRow").on("click",function(){var e=$(this).data("id");v.info("intenta eliminar el registro: "+e),o.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(n){if(n){var i={};i.id=e,l({method:"POST",url:"api/customer/health-damage/ql/document/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){a.error(t),o.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){t.reloadDataHealthDamageQlJusticeBoardSecondDocument()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};t.dtInstanceHealthDamageQlJusticeSecondDocumentCallback=function(e){t.dtInstanceHealthDamageQlJusticeSecondDocument=e,t.reloadDataHealthDamageQlJusticeBoardSecondDocument()},t.reloadDataHealthDamageQlJusticeBoardSecondDocument=function(){void 0!=t.dtInstanceHealthDamageQlJusticeSecondDocument.reloadData&&t.dtInstanceHealthDamageQlJusticeSecondDocument.reloadData()},t.editHealthDamageQlJusticeBoardSecondDocument=function(e){if(e){var a={id:e};l({method:"GET",url:"api/customer/health-damage/ql/document",params:a})["catch"](function(t,e){if(403==e){var a=null!==t.message&&void 0!==t.message?t.message:"app.clientes.list";o.swal("No Autorizado","No estas autorizado para ver esta información.","error"),c(function(){i.go(a)},3e3)}else 404==e?o.swal("Información no disponible","Centro de trabajo no encontrado","error"):o.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(e){c(function(){t.justiceSecondAttachment=e.data.result,null!=t.justiceSecondAttachment.startDate&&(t.justiceSecondAttachment.startDate=new Date(t.justiceSecondAttachment.startDate.date)),null!=t.justiceSecondAttachment.endDate&&(t.justiceSecondAttachment.endDate=new Date(t.justiceSecondAttachment.endDate.date))})})["finally"](function(){c(function(){t.loading=!1},400),c(function(){})})}else v.info("creacion de nuevo cliente"),t.loading=!1},t.saveHealthDamageQlJusticeBoardSecondDocument=function(){var e={},n=JSON.stringify(t.justiceSecondAttachment);return null!=t.justiceSecondAttachment.type&&""!=t.justiceSecondAttachment.name&&null!=t.justiceSecondAttachment.status&&""!=t.justiceSecondAttachment.description?(e.data=Base64.encode(n),l({method:"POST",url:"api/customer/health-damage/ql/document/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){c(function(){D.pop("success","Operación Exitosa","Se guardó la información exitosamente..."),t.uploaderJusticeSecond.queue.length>0?(O=e.data.result.id,R.uploadAll()):(t.clearHealthDamageQlJusticeBoardSecondDocument(),t.reloadDataHealthDamageQlJusticeBoardSecondDocument(),t.reloadDataHealthDamageQlDocument())})})["catch"](function(t){a.error(t),o.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})):void o.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e intentalo de nuevo.","error")},t.clearHealthDamageQlJusticeBoardSecondDocument=function(){t.justiceSecondAttachment={id:0,customerHealthDamageQualificationLostId:t.ql.id,entityId:t.justiceSecond.id,entityCode:"justiceSecond",entityName:"Justicia Laboral Ordinaria / Segunda Sentencia",type:null,name:"",description:"",version:"1",status:{item:"Activo",value:"Activo"},startDate:null,endDate:null}},t.dtInstanceHealthDamageQlDocument={},t.dtOptionsHealthDamageQlDocument=s.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){e.customer_health_damage_ql_id=t.ql.id},url:"api/customer/health-damage/ql/document-all",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){E()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,a,i){n(angular.element(e).contents())(t)}),t.dtColumnsHealthDamageQlDocument=[d.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,a,n,i){var o="",r=null!=e.document?e.document.path:"",l='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar anexo" data-id="'+e.id+'" >   <i class="fa fa-trash-o"></i></a> ',c='<a target="_self" class="btn btn-info btn-xs downloadRow lnk" href="#" uib-tooltip="Descargar anexo" data-id="'+e.id+'" data-url="'+r+'" >   <i class="fa fa-download"></i></a> ';return""!=r&&(o+=c),o+=l,t.isView?c:o}),d.newColumn("createdAt").withTitle("Fecha registro").withOption("width",120).withOption("defaultContent",""),d.newColumn("entityName").withTitle("Módulo").withOption("width",200).withOption("defaultContent",""),d.newColumn("type.item").withTitle("Tipo").withOption("width",200).withOption("defaultContent",""),d.newColumn("name").withTitle("Nombre").withOption("width",200).withOption("defaultContent",""),d.newColumn("description").withTitle("Descripción").withOption("defaultContent",""),d.newColumn("version").withTitle("Versión").withOption("width",200).withOption("defaultContent",""),d.newColumn("status.item").withTitle("Estado").withOption("width",150).renderWith(function(t,e,a,n){var i="",o="";return"Activo"==t?(o=t,i="label label-success"):(o=t,i="label label-danger"),'<span class="'+i+'">'+o+"</span>"})];var E=function(){$("#dtHealthDamageQlDocument a.downloadRow").on("click",function(){var t=$(this).data("id"),e=$(this).data("url");""==e?D.pop("error","Error en la descarga","No existe un anexo para descargar"):jQuery("#download")[0].src="api/customer/health-damage/ql/document/download?id="+t}),$("#dtHealthDamageQlDocument a.delRow").on("click",function(){var e=$(this).data("id");v.info("intenta eliminar el registro: "+e),o.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(n){if(n){var i={};i.id=e,l({method:"POST",url:"api/customer/health-damage/ql/document/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){a.error(t),o.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){t.reloadDataHealthDamageQlDocument()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};t.dtInstanceHealthDamageQlDocumentCallback=function(e){t.dtInstanceHealthDamageQlDocument=e,t.reloadDataHealthDamageQlDocument()},t.reloadDataHealthDamageQlDocument=function(){void 0!=t.dtInstanceHealthDamageQlDocument.reloadData&&t.dtInstanceHealthDamageQlDocument.reloadData()},t.onDownload=function(){jQuery("#download")[0].src="api/customer/health-damage/ql/document/download-all?id="+t.ql.id};var q=t.uploaderOpportunity=new y({url:"api/customer/health-damage/ql/document/upload",formData:[],removeAfterUpload:!0});q.filters.push({name:"customFilter",fn:function(t,e){return this.queue.length<10}}),q.onBeforeUploadItem=function(t){console.info("onBeforeUploadItem",t);var e={id:O};t.formData.push(e)},q.onCompleteAll=function(){console.info("onCompleteAll"),t.clearHealthDamageQlFirstOpportunityDocument(),t.reloadDataHealthDamageQlFirstOpportunityDocument(),t.reloadDataHealthDamageQlDocument()};var I=t.uploaderRegional=new y({url:"api/customer/health-damage/ql/document/upload",formData:[],removeAfterUpload:!0});I.filters.push({name:"customFilter",fn:function(t,e){return this.queue.length<10}}),I.onBeforeUploadItem=function(t){console.info("onBeforeUploadItem",t);var e={id:O};t.formData.push(e)},I.onCompleteAll=function(){console.info("onCompleteAll"),t.clearHealthDamageQlRegionalBoardDocument(),t.reloadDataHealthDamageQlRegionalBoardDocument(),t.reloadDataHealthDamageQlDocument()};var x=t.uploaderNational=new y({url:"api/customer/health-damage/ql/document/upload",formData:[],removeAfterUpload:!0});x.filters.push({name:"customFilter",fn:function(t,e){return this.queue.length<10}}),x.onBeforeUploadItem=function(t){console.info("onBeforeUploadItem",t);var e={id:O};t.formData.push(e)},x.onCompleteAll=function(){console.info("onCompleteAll"),t.clearHealthDamageQlNationalBoardDocument(),t.reloadDataHealthDamageQlNationalBoardDocument(),t.reloadDataHealthDamageQlDocument()};var j=t.uploaderJusticeFirst=new y({url:"api/customer/health-damage/ql/document/upload",formData:[],removeAfterUpload:!0});j.filters.push({name:"customFilter",fn:function(t,e){return this.queue.length<10}}),j.onBeforeUploadItem=function(t){console.info("onBeforeUploadItem",t);var e={id:O};t.formData.push(e)},j.onCompleteAll=function(){console.info("onCompleteAll"),t.clearHealthDamageQlJusticeBoardFirstDocument(),t.reloadDataHealthDamageQlJusticeBoardFirstDocument(),t.reloadDataHealthDamageQlDocument()};var R=t.uploaderJusticeSecond=new y({url:"api/customer/health-damage/ql/document/upload",formData:[],removeAfterUpload:!0});R.filters.push({name:"customFilter",fn:function(t,e){return this.queue.length<10}}),R.onBeforeUploadItem=function(t){console.info("onBeforeUploadItem",t);var e={id:O};t.formData.push(e)},R.onCompleteAll=function(){console.info("onCompleteAll"),t.clearHealthDamageQlJusticeBoardSecondDocument(),t.reloadDataHealthDamageQlJusticeBoardSecondDocument(),t.reloadDataHealthDamageQlDocument()},t.onAddEmployee=function(){var e=g.open({templateUrl:r.app.views.urlRoot+"modules/customer/occupational/health-damage/qualification-lost/customer_absenteeism_disability_employee_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideHealthQualificationSourceEmployeeCtrl",scope:t});e.result.then(function(){})},t.onAddDisabilityEmployeeList=function(){var e=g.open({templateUrl:r.app.views.urlRoot+"modules/customer/occupational/health-damage/qualification-lost/customer_absenteeism_disability_employee_list_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideHealthQualificationSourceEmployeeListCtrl",scope:t});e.result.then(function(e){var a=f("filter")(t.employees,{id:e.id});0==a.length&&t.employees.push(e),t.ql.employee=e})},t.saveStepQualificationRegionalBoard=function(){D.pop("success","Operación Exitosa","Se guardó la información exitosamente..."),t.ql.stepQualificationRegionalBoard=!0,t.stepQualificationRegionalBoardActive=!0,S()},t.saveStepQualificationNationalBoard=function(){D.pop("success","Operación Exitosa","Se guardó la información exitosamente..."),t.ql.stepQualificationNationalBoard=!0,t.stepQualificationNationalBoardActive=!0,S()},t.saveStepQualificationLaborJustice=function(){D.pop("success","Operación Exitosa","Se guardó la información exitosamente..."),t.ql.stepQualificationLaborJustice=!0,t.stepQualificationLaborJusticeActive=!0,S()},t.saveStepSecondInstance=function(){D.pop("success","Operación Exitosa","Se guardó la información exitosamente se habilitara la pestaña Instancia Segunda"),t.ql.stepSecondInstance=!0,t.stepSecondInstanceActive=!0,S()},t.onAddDisabilityDiagnosticOpportunity=function(e){var a=g.open({templateUrl:r.app.views.urlRoot+"modules/customer/occupational/health-damage/qualification/customer_absenteeism_disability_diagnostic_modal.htm",placement:"right",size:"lg",backdrop:!0,resolve:{employee:function(){return t.ql.employee}},controller:"ModalInstanceSideHealthDamageQlDiagnosticListCtrl",scope:t});a.result.then(function(a){var n=f("filter")(t.diagnostics,{id:a.id});0==n.length&&t.diagnostics.push(a),t.opportunity.diagnostics[e].codeCIE10=a})},t.onAddDisabilityDiagnosticRegional=function(e){var a=g.open({templateUrl:r.app.views.urlRoot+"modules/customer/occupational/health-damage/qualification/customer_absenteeism_disability_diagnostic_modal.htm",placement:"right",size:"lg",backdrop:!0,resolve:{employee:function(){return t.ql.employee}},controller:"ModalInstanceSideHealthDamageQlDiagnosticListCtrl",scope:t});a.result.then(function(a){var n=f("filter")(t.diagnostics,{id:a.id});0==n.length&&t.diagnostics.push(a),t.regional.diagnostics[e].codeCIE10=a})},t.onAddDisabilityDiagnosticNational=function(e){var a=g.open({templateUrl:r.app.views.urlRoot+"modules/customer/occupational/health-damage/qualification/customer_absenteeism_disability_diagnostic_modal.htm",placement:"right",size:"lg",backdrop:!0,resolve:{employee:function(){return t.ql.employee}},controller:"ModalInstanceSideHealthDamageQlDiagnosticListCtrl",scope:t});a.result.then(function(a){var n=f("filter")(t.diagnostics,{id:a.id});0==n.length&&t.diagnostics.push(a),t.national.diagnostics[e].codeCIE10=a})},t.onAddDisabilityDiagnosticJusticeFirst=function(e){var a=g.open({templateUrl:r.app.views.urlRoot+"modules/customer/occupational/health-damage/qualification/customer_absenteeism_disability_diagnostic_modal.htm",placement:"right",size:"lg",backdrop:!0,resolve:{employee:function(){return t.ql.employee}},controller:"ModalInstanceSideHealthDamageQlDiagnosticListCtrl",scope:t});a.result.then(function(a){var n=f("filter")(t.diagnostics,{id:a.id});0==n.length&&t.diagnostics.push(a),t.justiceFirst.diagnostics[e].codeCIE10=a})},t.onAddDisabilityDiagnosticJusticeSecond=function(e){var a=g.open({templateUrl:r.app.views.urlRoot+"modules/customer/occupational/health-damage/qualification/customer_absenteeism_disability_diagnostic_modal.htm",placement:"right",size:"lg",backdrop:!0,resolve:{employee:function(){return t.ql.employee}},controller:"ModalInstanceSideHealthDamageQlDiagnosticListCtrl",scope:t});a.result.then(function(a){var n=f("filter")(t.diagnostics,{id:a.id});0==n.length&&t.diagnostics.push(a),t.justiceSecond.diagnostics[e].codeCIE10=a})}}]),app.controller("ModalInstanceSideHealthQualificationSourceEmployeeCtrl",["$rootScope","$stateParams","$scope","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile",function(t,e,a,n,i,o,r,l,c,s,d,u,m,p){a.contractTypes=t.parameters("employee_contract_type"),a.documentTypes=t.parameters("employee_document_type");var h=function(){a.employee={id:0,customerId:e.customerId,isActive:!0,contractType:null,job:null,workPlace:null,salary:0,entity:{id:0,documentType:null,documentNumber:"",firstName:"",lastName:"",isActive:!0}}};h();var f=function(){var t={};return t.operation="restriction",t.customerId=e.customerId,l({method:"POST",url:"api/customer/config-sgsst/workplace/listProcess",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){o(function(){a.workPlaces=t.data.data})})["catch"](function(t){})["finally"](function(){})};f();var g=function(){if(null!=a.employee.workPlace){var t={};return t.operation="restriction",t.customerId=e.customerId,t.workPlaceId=a.employee.workPlace.id,l({method:"POST",url:"api/customer/config-sgsst/job/listByWorkPlace",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){o(function(){a.jobs=t.data.data})})["catch"](function(t){})["finally"](function(){})}a.jobs=[]};a.$watch("employee.workPlace",function(){g()}),a.onCloseModal=function(){n.close(1)},a.onCancelEmployee=function(){n.dismiss("cancel")},a.form={submit:function(t){var e=null;if(t.$invalid){var n=null,e=null;for(n in t)"$"!=n[0]&&(null!==e||t[n].$valid||(e=t[n].$name),t[n].$pristine&&(t[n].$dirty=!0));return angular.element(".ng-invalid[name="+e+"]").focus(),void o(function(){c.pop("error","Error","Por favor verifique los datos requeridos del formulario y vuelva a intentarlo")},500)}a.onSaveEmployee()},reset:function(t){t.$setPristine(!0)}},a.onSaveEmployee=function(){var t={},e=JSON.stringify(a.employee);return t.data=Base64.encode(e),l({method:"POST",url:"api/customer-employee/quickSave",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){o(function(){a.attachment=t.data.result,c.pop("success","Operación Exitosa","Registro eliminado"),a.onCloseModal()})})["catch"](function(t){i.error(t),c.pop("error","Error","Por favor ingrese los campos requeridos.")})["finally"](function(){})}}]),app.controller("ModalInstanceSideHealthQualificationSourceEmployeeListCtrl",["$rootScope","$stateParams","$scope","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile",function(t,e,a,n,i,o,r,l,c,s,d,u,m,p){a.employee={id:0},a.onCloseModal=function(){n.close(a.employee)},a.onCancel=function(){n.dismiss("cancel")},a.onLoadRecord=function(){if(0!=a.employee.id){var t={id:a.employee.id};l({method:"GET",url:"api/customer-employee",params:t})["catch"](function(t,e){if(403==e){var a=null!==t.message&&void 0!==t.message?t.message:"app.clientes.list";r.swal("No Autorizado","No estas autorizado para ver esta información.","error"),
o(function(){$state.go(a)},3e3)}else 404==e?r.swal("Información no disponible","Diagnóstico no encontrado","error"):r.swal("Error","Se ha presentado un error al intentar acceder a la información del proceso","error")}).then(function(t){o(function(){a.employee=t.data.result})})["finally"](function(){o(function(){a.onCloseModal()},400)})}else a.loading=!1},a.dtOptionsDisabilityEmployeeList=m.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.customerId=e.customerId,JSON.stringify(t)},url:"api/customer-employee-modal-basic",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){h()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,e,n){p(angular.element(t).contents())(a)}),a.dtColumnsDisabilityEmployeeList=[u.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,e,n,i){var o="",r="",l='<a class="btn btn-success btn-xs editRow lnk" href="#" uib-tooltip="Adicionar empleado" tooltip-placement="right"  data-id="'+t.id+'"'+r+' >   <i class="fa fa-plus-square"></i></a> ';return o+=l,a.isView?"":o}),u.newColumn("documentNumber").withTitle("Número Identificación").withOption("width",200),u.newColumn("firstName").withTitle("Nombre").withOption("width",200),u.newColumn("lastName").withTitle("Apellidos").withOption("width",200),u.newColumn("workPlace").withTitle("Centro de Trabajo").withOption("width",200),u.newColumn("job").withTitle("Cargo").withOption("width",200),u.newColumn("neighborhood").withTitle("Centro de Costos").withOption("width",200),u.newColumn(null).withTitle("Estado").withOption("width",200).renderWith(function(t,e,a,n){var i="label label-danger",o="Inactivo";null==t.isActiveCode&&void 0==t.isActiveCode||("Activo"==t.isActiveCode?(i="label label-success",o="Activo"):(i="label label-danger",o="Inactivo"));var r='<span class="'+i+'">'+o+"</span>";return r}),u.newColumn(null).withTitle("Autorización").withOption("width",200).renderWith(function(t,e,a,n){var i="label label-danger",o="Inactivo";null==t.isAuthorized&&void 0==t.isAuthorized||("Autorizado"==t.isAuthorized?(i="label label-success",o="Autorizado"):"No Autorizado"==t.isAuthorized?(i="label label-danger",o="No Autorizado"):(i="label label-info",o="N/A"));var r='<span class="'+i+'">'+o+"</span>";return r})];var h=function(){$("#dtDisabilityEmployeeList a.editRow").on("click",function(){var t=$(this).data("id");a.editDisabilityEmployee(t)})};a.reloadData=function(){a.dtInstanceDisabilityEmployeeList.reloadData()},a.viewDisabilityEmployee=function(t){a.employee.id=t,a.isView=!0,a.onLoadRecord()},a.editDisabilityEmployee=function(t){a.employee.id=t,a.isView=!1,a.onLoadRecord()}}]),app.controller("ModalInstanceSideHealthDamageQlDiagnosticListCtrl",["$rootScope","$stateParams","$scope","employee","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile",function(t,e,a,n,i,o,r,l,c,s,d,u,m,p,h){a.diagnostic={id:0,code:"",description:"",isActive:!0},a.onCloseModal=function(){i.close(a.diagnostic)},a.onCancel=function(){i.dismiss("cancel")},a.onLoadRecord=function(){if(0!=a.diagnostic.id){var t={id:a.diagnostic.id};c({method:"GET",url:"api/disability-diagnostic",params:t})["catch"](function(t,e){if(403==e){var a=null!==t.message&&void 0!==t.message?t.message:"app.clientes.list";l.swal("No Autorizado","No estas autorizado para ver esta información.","error"),r(function(){$state.go(a)},3e3)}else 404==e?l.swal("Información no disponible","Diagnóstico no encontrado","error"):l.swal("Error","Se ha presentado un error al intentar acceder a la información del proceso","error")}).then(function(t){r(function(){a.diagnostic=t.data.result})})["finally"](function(){r(function(){a.onCloseModal()},400)})}else a.loading=!1},a.dtInstanceDisabilityDiagnosticList={},a.dtOptionsDisabilityDiagnosticList=p.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.customerEmployeeId=n.id,JSON.stringify(t)},url:"api/disability-diagnostic-source-employee",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){f()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,e,n){h(angular.element(t).contents())(a)}),a.dtColumnsDisabilityDiagnosticList=[m.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,e,n,i){var o="",r="",l='<a class="btn btn-success btn-xs editRow lnk" href="#" uib-tooltip="Adicionar diagnóstico"  data-id="'+t.id+'"'+r+' >   <i class="fa fa-plus-square"></i></a> ';return o+=l,a.isView?"":o}),m.newColumn("code").withTitle("Código").withOption("width",200),m.newColumn("description").withTitle("Diagnóstico"),m.newColumn(null).withTitle("Estado").withOption("width",200).renderWith(function(t,e,a,n){var i="label label-danger";null==t.isActive&&void 0==t.isActive||(i=t.isActive?"label label-success":"label label-danger");var o='<span class="'+i+'">'+t.status+"</span>";return o})];var f=function(){$("#dtDisabilityDiagnosticList a.editRow").on("click",function(){var t=$(this).data("id");a.editDisabilityDiagnostic(t)})};a.reloadData=function(){a.dtInstanceDisabilityDiagnostic.reloadData()},a.viewDisabilityDiagnostic=function(t){a.diagnostic.id=t,a.isView=!0,a.onLoadRecord()},a.editDisabilityDiagnostic=function(t){a.diagnostic.id=t,a.isView=!1,a.onLoadRecord()}}]);
"use strict";app.controller("customerHealthDamageQualificationLostListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","SweetAlert","$http","$filter","$document","$aside",function(t,e,i,n,a,o,l,r,d,c,s,u,w,h,m,p){function f(e){var i=p.open({templateUrl:c.app.views.urlRoot+"modules/customer/occupational/health-damage/qualification-lost/customer_health_damage_download_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideHealthDamageQualificationLostDownloadDocument",scope:t,resolve:{ql:function(){return{id:e}},isView:function(){return t.isView}}});i.result.then(function(){t.reloadData()})}var g=i,O={};g.info("loading..customerHealthDamageQualificationLostListCtrl "),O.operation="tracking",O.customer_id=e.customerId,t.agents=c.agents(),t.dtInstanceHealthDamageQualificationLost={},t.dtOptionsHealthDamageQualificationLost=n.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.customerId=e.customerId,JSON.stringify(t)},url:"api/customer-health-damage-ql",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){D()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,i,n){l(angular.element(e).contents())(t)}),t.dtColumnsHealthDamageQualificationLost=[a.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,e,i,n){var a="",o='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+t.id+'" >   <i class="fa fa-edit"></i></a> ',l='<a class="btn btn-info btn-xs viewRow lnk" href="#" uib-tooltip="Ver" data-id="'+t.id+'" >   <i class="fa fa-eye"></i></a> ',r='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+t.id+'" >   <i class="fa fa-trash-o"></i></a> ',d='<a class="btn btn-light-purple btn-xs downloadDocumentRow lnk" href="#" uib-tooltip="Descargar anexos" data-id="'+t.id+'" >   <i class="fa fa-cloud-download"></i></a> ';return c.can("seguimiento_view"),a+=l,c.can("seguimiento_edit"),a+=o,c.can("seguimiento_delete"),a+=r,a+=d}),a.newColumn("createdAt").withTitle("Fecha Registro").withOption("width",200).withOption("defaultContent",""),a.newColumn("documentNumber").withTitle("Número Identificación").withOption("width",200).withOption("defaultContent",""),a.newColumn("firstName").withTitle("Nombre").withOption("width",200).withOption("defaultContent",""),a.newColumn("lastName").withTitle("Apellidos").withOption("width",200).withOption("defaultContent",""),a.newColumn("occupation").withTitle("Cargo").withOption("width",200).withOption("defaultContent","")];var D=function(){$("#dtHealthDamageQualificationLost a.editRow").on("click",function(){var e=$(this).data("id");t.editWorkMedicine(e)}),$("#dtHealthDamageQualificationLost a.viewRow").on("click",function(){var e=$(this).data("id");t.viewWorkMedicine(e)}),$("#dtHealthDamageQualificationLost a.downloadDocumentRow").on("click",function(){var t=$(this).data("id");f(t)}),$("#dtHealthDamageQualificationLost a.delRow").on("click",function(){var e=$(this).data("id");g.info("intenta eliminar el registro: "+e),u.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(n){if(n){var a={};a.id=e,w({method:"POST",url:"api/customer/health-damage/ql/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){i.error(t),u.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){t.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};t.reloadData=function(){t.dtInstanceHealthDamageQualificationLost.reloadData()},t.editWorkMedicine=function(e){null!=t.$parent&&t.$parent.navToSection("form","edit",e)},t.viewWorkMedicine=function(e){null!=t.$parent&&t.$parent.navToSection("form","view",e)}}]),app.controller("ModalInstanceSideHealthDamageQualificationLostDownloadDocument",["$rootScope","$scope","$uibModalInstance","ql","$log","$timeout","SweetAlert","isView","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$filter","FileUploader","$http","$compile",function(t,e,i,n,a,o,l,r,d,c,s,u,w,h,m){e.datePickerConfig={culture:"es-CO",format:"dd/MM/yyyy hh:mm tt"},e.ql=n,e.isView=r,e.onClose=function(){i.close(1)},e.onCancel=function(){i.dismiss("cancel")},e.dtInstanceCustomerHealthDamageDocument={},e.dtOptionsCustomerHealthDamageDocument=d.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){t.customer_health_damage_ql_id=e.ql.id},url:"api/customer/health-damage/ql/document-all",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){p()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,i,n){m(angular.element(t).contents())(e)}),e.dtColumnsCustomerHealthDamageDocument=[c.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,e,i,n){var a="",o=null!=t.document?t.document.path:"",l=('<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar anexo" data-id="'+t.id+'" >   <i class="fa fa-trash-o"></i></a> ','<a target="_self" class="btn btn-info btn-xs downloadRow lnk" href="#" uib-tooltip="Descargar anexo" data-id="'+t.id+'" data-url="'+o+'" >   <i class="fa fa-download"></i></a> ');return""!=o&&(a+=l),a}),c.newColumn("createdAt").withTitle("Fecha registro").withOption("width",120).withOption("defaultContent",""),c.newColumn("entityName").withTitle("Módulo").withOption("width",200).withOption("defaultContent",""),c.newColumn("type.item").withTitle("Tipo").withOption("width",200).withOption("defaultContent",""),c.newColumn("name").withTitle("Nombre").withOption("width",200).withOption("defaultContent",""),c.newColumn("description").withTitle("Descripción").withOption("defaultContent",""),c.newColumn("version").withTitle("Version").withOption("width",200).withOption("defaultContent",""),c.newColumn("status.item").withTitle("Estado").withOption("width",150).renderWith(function(t,e,i,n){var a="",o="";return"Activo"==t?(o=t,a="label label-success"):(o=t,a="label label-danger"),'<span class="'+a+'">'+o+"</span>"})];var p=function(){$("#dtCustomerHealthDamageDocument a.downloadRow").on("click",function(){var t=$(this).data("id"),e=$(this).data("url");""==e?toaster.pop("error","Error en la descarga","No existe un anexo para descargar"):jQuery("#download")[0].src="api/customer/health-damage/ql/document/download?id="+t})};e.reloadData=function(){e.dtInstanceCustomerHealthDamageDocument.reloadData()},e.onDownload=function(){jQuery("#download")[0].src="api/customer/health-damage/ql/document/download-all?id="+n.id}}]);
"use strict";app.controller("customerHealthDamageAdministrativeProcessCtrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout",function(t,e,o,i,c,n){var r=o;r.info("loading..customerWorkMedicineCtrl!!! "),t.tracking_section="list",t.currentId=0,t.modeDsp="edit",t.navToSection=function(e,o,i){n(function(){t.tracking_section=e,t.modeDsp=o,t.$parent.switchSubTab(o),t.currentId=i})}}]);
"use strict";app.controller("customerHealthDamageAdministrativeProcessEditCtrl",["$scope","$stateParams","$log","$compile","$state","SweetAlert","$rootScope","$http","$timeout","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$uibModal","flowFactory","cfpLoadingBar","$filter","$aside","$document",function(e,t,o,i,n,a,r,l,s,c,d,u,m,p,f,h,w,y){var v=o,g=e.$parent.currentId;e.isAgent="agent"==r.currentUser().wg_type,e.isAdmin="system"==r.currentUser().wg_type,e.isCustomer="customerAdmin"==r.currentUser().wg_type||"customerUser"==r.currentUser().wg_type,v.info("loading..customerHealthDamageAdministrativeProcessEditCtrl con el id: ",g),e.arl=r.parameters("arl"),e.documentType=r.parameters("customer_document_type"),e.tiposdoc=r.parameters("tipodoc"),e.isView="view"==e.$parent.modeDsp,console.log(e.isView),e.minDateCurrent=new Date,e.customerId=t.customerId,e.maxDate=new Date,e.datePickerConfig={culture:"es-CO",format:"dd/MM/yyyy HH:mm"},e.employees=[],e.onLoadRecord=function(){if(0!=e.administrative.id){v.info("editando cliente con código: "+e.administrative.id);var t={id:e.administrative.id};l({method:"GET",url:"api/customer/health-damage/administrative-process",params:t})["catch"](function(e,t){if(403==t){var o=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";a.swal("No Autorizado","No estas autorizado para ver esta información.","error"),s(function(){n.go(o)},3e3)}else 404==t?a.swal("Información no disponible","Centro de trabajo no encontrado","error"):a.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(t){s(function(){e.administrative=t.data.result,e.canShow=!0})})["finally"](function(){s(function(){e.loading=!1},400),s(function(){y.scrollTop(40,2e3)})})}else v.info("creacion de nuevo cliente"),e.loading=!1};var b=function(){e.administrative={id:g,employee:null,arl:null,isRelocated:!1,observationRelocated:"",isEnhancedStability:!1,observationEnhancedStability:"",isDisabilityPayment:!1,observationDisabilityPayment:"",isTutelage:!1,resultTutelage:"",isComplain:!1,resultComplain:"",whatCustomerSay:"",whatCustomerExpect:"",medicalOccupationalConcept:""}};b(),e.onLoadRecord(),e.master=e.administrative,e.form={submit:function(t){var o=null;if(t.$invalid){var i=null,o=null;for(i in t)"$"!=i[0]&&(null!==o||t[i].$valid||(o=t[i].$name),t[i].$pristine&&(t[i].$dirty=!0));return v.info(e.customer),angular.element(".ng-invalid[name="+o+"]").focus(),void a.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}a.swal("Validación exitosa","Procediendo con el guardado...","success"),v.info(e.customer),C()},reset:function(t){e.administrative=angular.copy(e.master),t.$setPristine(!0)}};var C=function(){var t={},i=JSON.stringify(e.administrative);return t.data=Base64.encode(i),l({method:"POST",url:"api/customer/health-damage/administrative-process/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){s(function(){e.administrative=t.data.result})})["catch"](function(e){o.error(e),a.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};e.cancelEdition=function(){null!=e.$parent&&e.$parent.navToSection("list","list")},e.onAddEmployee=function(){var t=w.open({templateUrl:r.app.views.urlRoot+"modules/customer/occupational/health-damage/administrative/customer_absenteeism_disability_employee_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideHealthAdministrativeProcessEmployeeCtrl",scope:e});t.result.then(function(){})},e.onAddDisabilityEmployeeList=function(){var t=w.open({templateUrl:r.app.views.urlRoot+"modules/customer/occupational/health-damage/administrative/customer_absenteeism_disability_employee_list_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideHealthAdministrativeProcessEmployeeListCtrl",scope:e});t.result.then(function(t){var o=h("filter")(e.employees,{id:t.id});0==o.length&&e.employees.push(t),e.administrative.employee=t})}}]),app.controller("ModalInstanceSideHealthAdministrativeProcessEmployeeCtrl",["$rootScope","$stateParams","$scope","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile",function(e,t,o,i,n,a,r,l,s,c,d,u,m,p){o.contractTypes=e.parameters("employee_contract_type"),o.documentTypes=e.parameters("employee_document_type");var f=function(){o.employee={id:0,customerId:t.customerId,isActive:!0,contractType:null,job:null,workPlace:null,salary:0,entity:{id:0,documentType:null,documentNumber:"",firstName:"",lastName:"",isActive:!0}}};f();var h=function(){var e={};return e.operation="restriction",e.customerId=t.customerId,l({method:"POST",url:"api/customer/config-sgsst/workplace/listProcess",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){a(function(){o.workPlaces=e.data.data})})["catch"](function(e){})["finally"](function(){})};h();var w=function(){if(null!=o.employee.workPlace){var e={};return e.operation="restriction",e.customerId=t.customerId,e.workPlaceId=o.employee.workPlace.id,l({method:"POST",url:"api/customer/config-sgsst/job/listByWorkPlace",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){a(function(){o.jobs=e.data.data})})["catch"](function(e){})["finally"](function(){})}o.jobs=[]};o.$watch("employee.workPlace",function(){w()}),o.onCloseModal=function(){i.close(1)},o.onCancelEmployee=function(){i.dismiss("cancel")},o.form={submit:function(e){var t=null;if(e.$invalid){var i=null,t=null;for(i in e)"$"!=i[0]&&(null!==t||e[i].$valid||(t=e[i].$name),e[i].$pristine&&(e[i].$dirty=!0));return angular.element(".ng-invalid[name="+t+"]").focus(),void a(function(){s.pop("error","Error","Por favor verifique los datos requeridos del formulario y vuelva a intentarlo")},500)}o.onSaveEmployee()},reset:function(e){e.$setPristine(!0)}},o.onSaveEmployee=function(){var e={},t=JSON.stringify(o.employee);return e.data=Base64.encode(t),l({method:"POST",url:"api/customer-employee/quickSave",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){a(function(){o.attachment=e.data.result,s.pop("success","Operación Exitosa","Registro eliminado"),o.onCloseModal()})})["catch"](function(e){n.error(e),s.pop("error","Error","Por favor ingrese los campos requeridos.")})["finally"](function(){})}}]),app.controller("ModalInstanceSideHealthAdministrativeProcessEmployeeListCtrl",["$rootScope","$stateParams","$scope","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile",function(e,t,o,i,n,a,r,l,s,c,d,u,m,p){o.employee={id:0},o.onCloseModal=function(){i.close(o.employee)},o.onCancel=function(){i.dismiss("cancel")},o.onLoadRecord=function(){if(0!=o.employee.id){var e={id:o.employee.id};l({method:"GET",url:"api/customer-employee",params:e})["catch"](function(e,t){if(403==t){var o=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";r.swal("No Autorizado","No estas autorizado para ver esta información.","error"),a(function(){$state.go(o)},3e3)}else 404==t?r.swal("Información no disponible","Diagnóstico no encontrado","error"):r.swal("Error","Se ha presentado un error al intentar acceder a la información del proceso","error")}).then(function(e){a(function(){o.employee=e.data.result})})["finally"](function(){a(function(){o.onCloseModal()},400)})}else o.loading=!1},o.dtInstanceDisabilityEmployeeList={},o.dtOptionsDisabilityEmployeeList=m.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerId=t.customerId,JSON.stringify(e)},url:"api/customer-employee-modal-basic",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){f()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,t,i){p(angular.element(e).contents())(o)}),o.dtColumnsDisabilityEmployeeList=[u.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,t,o,i){var n="",a="",r='<a class="btn btn-success btn-xs editRow lnk" href="#" uib-tooltip="Adicionar empleado" tooltip-placement="right"  data-id="'+e.id+'"'+a+' >   <i class="fa fa-plus-square"></i></a> ';return n+=r}),u.newColumn("documentNumber").withTitle("Número Identificación").withOption("width",200),u.newColumn("firstName").withTitle("Nombre").withOption("width",200),u.newColumn("lastName").withTitle("Apellidos").withOption("width",200),u.newColumn("workPlace").withTitle("Centro de Trabajo").withOption("width",200),u.newColumn("job").withTitle("Cargo").withOption("width",200),u.newColumn("neighborhood").withTitle("Centro de Costos").withOption("width",200),u.newColumn(null).withTitle("Estado").withOption("width",200).renderWith(function(e,t,o,i){var n="label label-danger",a="Inactivo";null==e.isActiveCode&&void 0==e.isActiveCode||("Activo"==e.isActiveCode?(n="label label-success",a="Activo"):(n="label label-danger",a="Inactivo"));var r='<span class="'+n+'">'+a+"</span>";return r}),u.newColumn(null).withTitle("Autorización").withOption("width",200).renderWith(function(e,t,o,i){var n="label label-danger",a="Inactivo";null==e.isAuthorized&&void 0==e.isAuthorized||("Autorizado"==e.isAuthorized?(n="label label-success",a="Autorizado"):"No Autorizado"==e.isAuthorized?(n="label label-danger",a="No Autorizado"):(n="label label-info",a="N/A"));var r='<span class="'+n+'">'+a+"</span>";return r})];var f=function(){$("#dtDisabilityEmployeeList a.editRow").on("click",function(){var e=$(this).data("id");o.editDisabilityEmployee(e)})};o.reloadData=function(){o.dtInstanceDisabilityEmployeeList.reloadData()},o.viewDisabilityEmployee=function(e){o.employee.id=e,o.isView=!0,o.onLoadRecord()},o.editDisabilityEmployee=function(e){o.employee.id=e,o.isView=!1,o.onLoadRecord()}}]);
"use strict";app.controller("customerHealthDamageAdministrativeProcessListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","SweetAlert","$http","$filter","$document",function(t,i,e,n,a,o,r,l,s,c,d,u,m,w,h){var p=e;p.info("loading..customerHealthDamageAdministrativeProcessListCtrl "),t.agents=c.agents(),t.dtInstanceHealthDamageAdministrativeProcess={},t.dtOptionsHealthDamageAdministrativeProcess=n.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.customerId=i.customerId,JSON.stringify(t)},url:"api/customer-health-damage-administrative-process",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){f()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(i,e,n){r(angular.element(i).contents())(t)}),t.dtColumnsHealthDamageAdministrativeProcess=[a.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,i,e,n){var a="",o='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+t.id+'" >   <i class="fa fa-edit"></i></a> ',r='<a class="btn btn-info btn-xs viewRow lnk" href="#" uib-tooltip="Ver" data-id="'+t.id+'" >   <i class="fa fa-eye"></i></a> ',l='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+t.id+'" >   <i class="fa fa-trash-o"></i></a> ';return c.can("seguimiento_view")&&(a+=r),c.can("seguimiento_edit")&&(a+=o),c.can("seguimiento_delete")&&(a+=l),a}),a.newColumn("createdAt").withTitle("Fecha Registro").withOption("width",200).withOption("defaultContent",""),a.newColumn("documentNumber").withTitle("Número Identificación").withOption("width",200).withOption("defaultContent",""),a.newColumn("firstName").withTitle("Nombre").withOption("width",200).withOption("defaultContent",""),a.newColumn("lastName").withTitle("Apellidos").withOption("width",200).withOption("defaultContent",""),a.newColumn("occupation").withTitle("Cargo").withOption("width",200).withOption("defaultContent","")];var f=function(){$("#dtHealthDamageAdministrativeProcess a.editRow").on("click",function(){var i=$(this).data("id");t.editWorkMedicine(i)}),$("#dtHealthDamageAdministrativeProcess a.viewRow").on("click",function(){var i=$(this).data("id");t.viewWorkMedicine(i)}),$("#dtHealthDamageAdministrativeProcess a.delRow").on("click",function(){var i=$(this).data("id");p.info("intenta eliminar el registro: "+i),u.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(n){if(n){var a={};a.id=i,m({method:"POST",url:"api/customer/health-damage/administrative-process/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){e.error(t),u.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){t.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};t.reloadData=function(){t.dtInstanceHealthDamageAdministrativeProcess.reloadData()},t.editWorkMedicine=function(i){null!=t.$parent&&t.$parent.navToSection("form","edit",i)},t.viewWorkMedicine=function(i){null!=t.$parent&&t.$parent.navToSection("form","view",i)}}]);
"use strict";app.controller("customerHealthDamageObservationCtrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout",function(t,e,o,n,a,c){var i=o;i.info("loading..customerHealthDamageObservation!!! "),t.tracking_section="list",t.currentId=0,t.modeDsp="edit",t.navToSection=function(e,o,n){c(function(){t.tracking_section=e,t.modeDsp=o,t.$parent.switchSubTab(o),t.currentId=n})}}]);
"use strict";app.controller("customerHealthDamageObservationListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","SweetAlert","$http","$filter","$document",function(t,e,n,i,o,a,r,l,c,s,u,w,h,p,d){var m=n;m.info("loading..customerHealthDamageObservationListCtrl "),t.agents=s.agents(),t.dtInstanceHealthDamageObservation={},t.dtOptionsHealthDamageObservation=i.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.customerId=e.customerId,JSON.stringify(t)},url:"api/customer-health-damage-restriction-observation-all",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){O()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,n,i){r(angular.element(e).contents())(t)}),t.dtColumnsHealthDamageObservation=[o.newColumn("restrictionDate").withTitle("Fecha restricción").withOption("width",150).withOption("defaultContent",""),o.newColumn("documentNumber").withTitle("Número Identificación").withOption("width",200).withOption("defaultContent",""),o.newColumn("fullName").withTitle("Nombre Empleado").withOption("width",200).withOption("defaultContent",""),o.newColumn("observationDate").withTitle("Fecha Observación").withOption("width",200).withOption("defaultContent",""),o.newColumn("name").withTitle("Usuario").withOption("width",200).withOption("defaultContent",""),o.newColumn("restriccion").withTitle("Restricción").withOption("width",200).withOption("defaultContent",""),o.newColumn("accessLevel").withTitle("Nivel acceso").withOption("width",200).renderWith(function(t,e,n,i){var o="";return o="Pública"==t?"label label-success":"label label-danger",'<span class="'+o+'">'+t+"</span>"}),o.newColumn("description").withTitle("Observación").withOption("defaultContent","")];var O=function(){};t.reloadData=function(){t.dtInstanceHealthDamageObservation.reloadData()},t.editWorkMedicine=function(e){null!=t.$parent&&t.$parent.navToSection("form","edit",e)},t.viewWorkMedicine=function(e){null!=t.$parent&&t.$parent.navToSection("form","view",e)}}]);
"use strict";app.controller("customerHealthDamageAnalysisCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$document","$filter",function(a,t,e,r,o,d,s,l,n,i,u,c,p,m,B){var g=e;g.info("loading..customerHealthDamageAnalysisCtrl "),a.request={},a.audit={},a.audit.operation="info",a.audit.customerId=t.customerId,a.audit.year=0,a.filter={selectedYear:null},a.years=[],a.dataProgram=null,a.dataEvolutionProgram=null,a.dataEvolutionTotal=null,a.dataEvolutionAvg=null,a.optionsPie={legend:{position:"bottom"},responsive:!1,segmentShowStroke:!0,segmentStrokeColor:"#fff",segmentStrokeWidth:2,percentageInnerCutout:0,animationSteps:100,animationEasing:"easeOutBounce",animateRotate:!0,animateScale:!1,legendTemplate:'<ul class="tc-chart-js-legend"><% for (var i=0; i<segments.length; i++){%><li><span style="background-color:<%=segments[i].fillColor%>"></span><%if(segments[i].label){%><%=segments[i].label%><%}%></li><%}%></ul>'},a.optionsBar={legend:{position:"bottom"},responsive:!0,scaleBeginAtZero:!0,scaleShowGridLines:!0,scaleGridLineColor:"rgba(0,0,0,.05)",scaleGridLineWidth:1,barShowStroke:!0,barStrokeWidth:2,barValueSpacing:5,barDatasetSpacing:1,legendTemplate:'<ul class="tc-chart-js-legend"><% for (var i=0; i<datasets.length; i++){%><li><span style="background-color:<%=datasets[i].fillColor%>"></span><%if(datasets[i].label){%><%=datasets[i].label%><%}%></li><%}%></ul>'};var f=function(){var r={};r.customer_id=t.customerId,r.year=a.audit.year,c({method:"POST",url:"api/customer/health-damage/analysis/filter-year",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(r)}).then(function(t){a.years=t.data.data,a.years.length>0&&(a.filter.selectedYear=a.years[0],y())})["catch"](function(a){e.error(a),p.swal("Error Cargando Reportes","Se ha presentado un error durante la consulta de los reportes para el diagnóstico por favor intentelo de nuevo","error")})["finally"](function(){})},y=function(){var r={};r.customer_id=t.customerId,r.year=a.filter.selectedYear?a.filter.selectedYear.value:0,c({method:"POST",url:"api/customer/health-damage/analysis",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(r)}).then(function(t){u(function(){if(a.dataBarLink=t.data.result.dataBarLink,null!=t.data.result.dataPieWorkTIme.labels){a.datasetPieWorkTImeData=[];for(var e=0;e<t.data.result.dataPieWorkTIme.datasets.length;e++)a.datasetPieWorkTImeData.push({label:t.data.result.dataPieWorkTIme.datasets[e].label,backgroundColor:t.data.result.dataPieWorkTIme.datasets[e].pointColor,hoverBackgroundColor:t.data.result.dataPieWorkTIme.datasets[e].pointColor,data:t.data.result.dataPieWorkTIme.datasets[e].data});a.dataPieWorkTIme={labels:t.data.result.dataPieWorkTIme.labels,datasets:a.datasetPieWorkTImeData}}if(null!=t.data.result.dataBarWeekDay.labels){a.datasetBarWeekDayData=[];for(var e=0;e<t.data.result.dataBarWeekDay.datasets.length;e++)a.datasetBarWeekDayData.push({label:t.data.result.dataBarWeekDay.datasets[e].label,backgroundColor:t.data.result.dataBarWeekDay.datasets[e].pointColor,hoverBackgroundColor:t.data.result.dataBarWeekDay.datasets[e].pointColor,data:t.data.result.dataBarWeekDay.datasets[e].data});a.dataBarWeekDay={labels:t.data.result.dataBarWeekDay.labels,datasets:a.datasetBarWeekDayData}}if(null!=t.data.result.dataBarPlace.labels){a.datasetBarPlaceData=[];for(var e=0;e<t.data.result.dataBarPlace.datasets.length;e++)a.datasetBarPlaceData.push({label:t.data.result.dataBarPlace.datasets[e].label,backgroundColor:t.data.result.dataBarPlace.datasets[e].pointColor,hoverBackgroundColor:t.data.result.dataBarPlace.datasets[e].pointColor,data:t.data.result.dataBarPlace.datasets[e].data});a.dataBarPlace={labels:t.data.result.dataBarPlace.labels,datasets:a.datasetBarPlaceData}}if(null!=t.data.result.dataBarLesionType.labels){a.datasetBarLesionTypeData=[];for(var e=0;e<t.data.result.dataBarLesionType.datasets.length;e++)a.datasetBarLesionTypeData.push({label:t.data.result.dataBarLesionType.datasets[e].label,backgroundColor:t.data.result.dataBarLesionType.datasets[e].pointColor,hoverBackgroundColor:t.data.result.dataBarLesionType.datasets[e].pointColor,data:t.data.result.dataBarLesionType.datasets[e].data});a.dataBarLesionType={labels:t.data.result.dataBarLesionType.labels,datasets:a.datasetBarLesionTypeData}}if(null!=t.data.result.dataBarBody.labels){a.datasetBarBodyData=[];for(var e=0;e<t.data.result.dataBarBody.datasets.length;e++)a.datasetBarBodyData.push({label:t.data.result.dataBarBody.datasets[e].label,backgroundColor:t.data.result.dataBarBody.datasets[e].pointColor,hoverBackgroundColor:t.data.result.dataBarBody.datasets[e].pointColor,data:t.data.result.dataBarBody.datasets[e].data});a.dataBarBody={labels:t.data.result.dataBarBody.labels,datasets:a.datasetBarBodyData}}if(null!=t.data.result.dataBarFactor.labels){a.datasetBarFactorData=[];for(var e=0;e<t.data.result.dataBarFactor.datasets.length;e++)a.datasetBarFactorData.push({label:t.data.result.dataBarFactor.datasets[e].label,backgroundColor:t.data.result.dataBarFactor.datasets[e].pointColor,hoverBackgroundColor:t.data.result.dataBarFactor.datasets[e].pointColor,data:t.data.result.dataBarFactor.datasets[e].data});a.dataBarFactor={labels:t.data.result.dataBarFactor.labels,datasets:a.datasetBarFactorData}}})})["catch"](function(a){e.error(a),p.swal("Error Cargando Reportes","Se ha presentado un error durante la consulta de los reportes para el diagnóstico por favor intentelo de nuevo","error")})["finally"](function(){})};f(),y(),a.changeYear=function(a,t){u(function(){y()})},a.clearYear=function(){u(function(){a.filter.selectedYear=null,y()})},a.onSummaryByProgramExportExcel=function(){jQuery("#downloadDocument")[0].src="api/occupational-report-incident/summary-lesion/export?data="+Base64.encode(JSON.stringify(a.audit))},a.onSummaryByProgramExportPdf=function(){kendo.drawing.drawDOM($(".export-pdf-program")).then(function(a){return kendo.drawing.exportPDF(a,{paperSize:"auto",margin:{left:"1cm",top:"1cm",right:"1cm",bottom:"1cm"}})}).done(function(a){kendo.saveAs({dataURI:a,fileName:"Reporte Mensual Programas Empresariales.pdf",proxyURL:"//demos.telerik.com/kendo-ui/service/export"})})},a.onSummaryByIndicatorExportExcel=function(){jQuery("#downloadDocument")[0].src="api/management/summary-indicator/export?data="+Base64.encode(JSON.stringify(a.audit))},a.onSummaryByIndicatorExportPdf=function(){kendo.drawing.drawDOM($(".export-pdf-indicator")).then(function(a){return kendo.drawing.exportPDF(a,{paperSize:"auto",margin:{left:"1cm",top:"1cm",right:"1cm",bottom:"1cm"}})}).done(function(a){kendo.saveAs({dataURI:a,fileName:"Reporte Mensual Indicadores Programas Empresariales.pdf",proxyURL:"//demos.telerik.com/kendo-ui/service/export"})})}}]);
"use strict";app.controller("customerOccupationalReportAnalysisCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$document","$filter","ChartService",function(t,a,e,n,o,i,r,d,l,u,c,p,m,h,w,s){function O(){var e={customerId:a.customerId,year:t.filter.selectedYear?t.filter.selectedYear.value:0},n=[{name:"chart_bar_options",criteria:null},{name:"chart_doughnut_options",criteria:null},{name:"customer_occupational_report",criteria:e}];s.getDataChart(n).then(function(a){t.chart.bar.options=a.data.data.chartBarOptions,t.chart.doughnut.options=a.data.data.chartLineOptions,t.chart.bar.options.legend.position="bottom",t.chart.accidentType.data=a.data.data.customerOccupationalReportAccidentType,t.chart.deathCause.data=a.data.data.customerOccupationalReportDeathCause,t.chart.location.data=a.data.data.customerOccupationalReportLocation,t.chart.link.data=a.data.data.customerOccupationalReportLink,t.chart.workTime.data=a.data.data.customerOccupationalReportWorkTime,t.chart.weekDay.data=a.data.data.customerOccupationalReportWeekDay,t.chart.place.data=a.data.data.customerOccupationalReportPlace,t.chart.injury.data=a.data.data.customerOccupationalReportInjury,t.chart.body.data=a.data.data.customerOccupationalReportBody,t.chart.factor.data=a.data.data.customerOccupationalReportFactor},function(a){t.status="Unable to load customer data: "+a.message})}t.chart={bar:{options:null},doughnut:{options:null},accidentType:{data:null},deathCause:{data:null},location:{data:null},link:{data:null},workTime:{data:null},weekDay:{data:null},place:{data:null},injury:{data:null},body:{data:null},factor:{data:null}},t.request={},t.audit={},t.audit.operation="info",t.audit.customerId=a.customerId,t.audit.year=0,t.filter={selectedYear:null},t.years=[];var f=function(){var n={};n.customer_id=a.customerId,n.year=t.audit.year,p({method:"POST",url:"api/occupational-report/monthly-filter",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(a){t.years=a.data.data,t.years.length>0&&(t.filter.selectedYear=t.years[0],t.audit.year=t.filter.selectedYear.value,t.request.data=Base64.encode(JSON.stringify(t.audit)),t.reloadData(),t.reloadIndicatorData(),O())})["catch"](function(t){e.error(t),m.swal("Error Cargando Reportes","Se ha presentado un error durante la consulta de los reportes para el diagnóstico por favor intentelo de nuevo","error")})["finally"](function(){})};f(),t.request.data=Base64.encode(JSON.stringify(t.audit)),t.dtInstanceReportAlSummaryProgram={},t.dtOptionsReportAlSummaryProgram=n.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:t.request,url:"api/occupational-report/summary-lesion",type:"POST",beforeSend:function(){},complete:function(t){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withDOM("tr").withOption("language",{}).withOption("createdRow",function(a,e,n){r(angular.element(a).contents())(t)}),t.dtColumnsReportAlSummaryProgram=[o.newColumn("name").withTitle("Lesión").withOption("width",400),o.newColumn("ENE").withTitle("ENE").withOption("width",200),o.newColumn("FEB").withTitle("FEB").withOption("width",200),o.newColumn("MAR").withTitle("MAR").withOption("width",200),o.newColumn("ABR").withTitle("ABR").withOption("width",200),o.newColumn("MAY").withTitle("MAY").withOption("width",200),o.newColumn("JUN").withTitle("JUN").withOption("width",200),o.newColumn("JUL").withTitle("JUL").withOption("width",200),o.newColumn("AGO").withTitle("AGO").withOption("width",200),o.newColumn("SEP").withTitle("SEP").withOption("width",200),o.newColumn("OCT").withTitle("OCT").withOption("width",200),o.newColumn("NOV").withTitle("NOV").withOption("width",200),o.newColumn("DIC").withTitle("DIC").withOption("width",200)],t.dtInstanceReportAlSummaryIndicator={},t.dtOptionsReportAlSummaryIndicator=n.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:t.request,url:"api/occupational-report/summary-indicator",type:"POST",beforeSend:function(){},complete:function(t){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withDOM("tr").withOption("language",{}).withOption("createdRow",function(a,e,n){r(angular.element(a).contents())(t)}),t.dtColumnsReportAlSummaryIndicator=[o.newColumn("indicator").withTitle("Indicador").withOption("width",400),o.newColumn(null).withTitle("ENE").withOption("width",200).renderWith(function(t,a,e,n){return"Promedio Total %"!=t.indicator?y(t.ENE):t.ENE}),o.newColumn(null).withTitle("FEB").withOption("width",200).renderWith(function(t,a,e,n){return"Promedio Total %"!=t.indicator?y(t.FEB):t.FEB}),o.newColumn(null).withTitle("MAR").withOption("width",200).renderWith(function(t,a,e,n){return"Promedio Total %"!=t.indicator?y(t.MAR):t.MAR}),o.newColumn(null).withTitle("ABR").withOption("width",200).renderWith(function(t,a,e,n){return"Promedio Total %"!=t.indicator?y(t.ABR):t.ABR}),o.newColumn(null).withTitle("MAY").withOption("width",200).renderWith(function(t,a,e,n){return"Promedio Total %"!=t.indicator?y(t.MAY):t.MAY}),o.newColumn(null).withTitle("JUN").withOption("width",200).renderWith(function(t,a,e,n){return"Promedio Total %"!=t.indicator?y(t.JUN):t.JUN}),o.newColumn(null).withTitle("JUL").withOption("width",200).renderWith(function(t,a,e,n){return"Promedio Total %"!=t.indicator?y(t.JUL):t.JUL}),o.newColumn(null).withTitle("AGO").withOption("width",200).renderWith(function(t,a,e,n){return"Promedio Total %"!=t.indicator?y(t.AGO):t.AGO}),o.newColumn(null).withTitle("SEP").withOption("width",200).renderWith(function(t,a,e,n){return"Promedio Total %"!=t.indicator?y(t.SEP):t.SEP}),o.newColumn(null).withTitle("OCT").withOption("width",200).renderWith(function(t,a,e,n){return"Promedio Total %"!=t.indicator?y(t.OCT):t.OCT}),o.newColumn(null).withTitle("NOV").withOption("width",200).renderWith(function(t,a,e,n){return"Promedio Total %"!=t.indicator?y(t.NOV):t.NOV}),o.newColumn(null).withTitle("DIC").withOption("width",200).renderWith(function(t,a,e,n){return"Promedio Total %"!=t.indicator?y(t.DIC):t.DIC})];var y=function(t){return null!=t?parseInt(t):""};t.dtInstanceReportAlSummaryProgramCallback=function(a){t.dtInstanceReportAlSummaryProgram=a},t.reloadData=function(){t.dtInstanceReportAlSummaryProgram.reloadData()},t.dtInstanceReportAlSummaryIndicatorCallback=function(a){t.dtInstanceReportAlSummaryIndicator=a},t.reloadIndicatorData=function(){},t.cancelEdition=function(a){null!=t.$parent&&t.$parent.navToSection("list","list",0)},t.changeYear=function(e,n){c(function(){t.audit.operation="info",t.audit.customerId=a.customerId,t.audit.year=e.value,t.request.data=Base64.encode(JSON.stringify(t.audit)),t.reloadData(),t.reloadIndicatorData(),O()})},t.clearYear=function(){c(function(){t.audit.operation="info",t.audit.customerId=a.customerId,t.audit.year=0,t.request.data=Base64.encode(JSON.stringify(t.audit)),t.filter.selectedYear=null,t.reloadData(),t.reloadIndicatorData(),O()})},t.onSummaryByProgramExportExcel=function(){jQuery("#downloadDocument")[0].src="api/occupational-report/summary-lesion/export?data="+Base64.encode(JSON.stringify(t.audit))},t.onSummaryByProgramExportPdf=function(){kendo.drawing.drawDOM($(".export-pdf-program")).then(function(t){return kendo.drawing.exportPDF(t,{paperSize:"auto",margin:{left:"1cm",top:"1cm",right:"1cm",bottom:"1cm"}})}).done(function(t){kendo.saveAs({dataURI:t,fileName:"Reporte Mensual Programas Empresariales.pdf",proxyURL:"//demos.telerik.com/kendo-ui/service/export"})})},t.onSummaryByIndicatorExportExcel=function(){jQuery("#downloadDocument")[0].src="api/management/summary-indicator/export?data="+Base64.encode(JSON.stringify(t.audit))},t.onSummaryByIndicatorExportPdf=function(){kendo.drawing.drawDOM($(".export-pdf-indicator")).then(function(t){return kendo.drawing.exportPDF(t,{paperSize:"auto",margin:{left:"1cm",top:"1cm",right:"1cm",bottom:"1cm"}})}).done(function(t){kendo.saveAs({dataURI:t,fileName:"Reporte Mensual Indicadores Programas Empresariales.pdf",proxyURL:"//demos.telerik.com/kendo-ui/service/export"})})}}]);
"use strict";app.controller("customerOccupationalReportALCtrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout",function(t,o,c,e,r,n){var i=c;i.info("loading..customerTrackingCtrl!!! "),t.tracking_section="list",t.currentReport=0,t.modeDsp="edit",t.navToSection=function(o,c,e){n(function(){t.tracking_section=o,t.modeDsp=c,t.$parent.switchSubTab(c),t.currentReport=e})}}]);
"use strict";app.controller("customerOccupationalReportALEditCtrl",["$scope","$stateParams","$log","$compile","$state","SweetAlert","$rootScope","$http","$timeout","$uibModal","flowFactory","cfpLoadingBar","$filter","$aside","toaster","ListService",function(e,t,o,r,n,i,a,l,c,s,u,p,d,m,f,y){function h(){var o=[{name:"customer_config_job_activity_list",value:t.customerId}];y.getDataList(o).then(function(t){e.report_regular_task=t.data.data.customerConfigJobActivityList},function(t){e.status="Unable to load customer data: "+t.message})}var w=o,g=e.$parent.currentTraking;e.currentStep=0,e.isAgent="agent"==a.currentUser().wg_type,e.isAdmin="system"==a.currentUser().wg_type,e.isCustomer="customerAdmin"==a.currentUser().wg_type||"customerUser"==a.currentUser().wg_type,e.reloadEmployee=!0,e.isView="view"==e.$parent.modeDsp,e.minDateCurrent=new Date,e.customerId=t.customerId,e.users=[],e.employees=[],e.conditionalList=[{item:"Si",value:1},{item:"No",value:0}],w.info("loading..customerTrackingEditCtrl con el id de tracking: ",g),e.eps=a.parameters("eps"),e.afp=a.parameters("afp"),e.arl=a.parameters("arl"),e.employment_relationship=a.parameters("wg_report_employment_relationship"),e.document_type=a.parameters("tipodoc"),e.zone=a.parameters("wg_report_zone"),e.economic_activity=a.parameters("wg_economic_activity"),e.type_linkage=a.parameters("wg_type_linkage"),e.gender=a.parameters("gender"),e.report_regular_work=a.parameters("wg_report_regular_work"),e.report_week_day=a.parameters("wg_report_week_day"),e.report_working_day=a.parameters("wg_report_working_day"),e.report_accident_type=a.parameters("wg_report_accident_type"),e.report_location=a.parameters("wg_report_location"),e.report_place=a.parameters("wg_report_place"),e.report_lesion_type=a.parameters("wg_report_lesion_type"),e.report_body_part=a.parameters("wg_report_body_part"),e.report_factor=a.parameters("wg_report_factor"),e.report_mechanism=a.parameters("wg_report_mechanism"),h(),e.states=[],e.cities=[],e.report={id:0,customerId:t.customerId,employeeId:0,typeLinkage:null,firstLastName:"",secondLastName:"",firstName:"",secondName:"",documentType:null,documentNumber:"",birthDate:null,gender:null,address:null,telephone:null,fax:null,state:null,city:null,zone:null,job:null,occupation:null,occupationTimeDay:"",occupationTimeMonth:"",startDate:null,salary:"",workingDay:null,eps:null,arl:null,isAfp:null,afp:null,customerEmploymentRelationship:null,customerEconomicActivity:null,customerBusinessName:"",customerDocumentType:null,customerDocumentNumber:"",customerAddress:"",customerEmail:"",customerTelephone:"",customerFax:"",customerState:null,customerCity:null,customerZone:null,isCustomerBranchName:null,customerBranchEconomicActivity:null,customerBranchAddress:"",customerBranchTelephone:"",customerBranchFax:"",customerBranchState:null,customerBranchCity:null,accidentDate:null,accidentWeekDay:null,accidentWorkingDay:null,accidentRegularWork:null,accidentRegularWorkText:null,accidentWorkTime:null,accidentType:null,accidentDeathCause:null,accidentState:null,accidentCity:null,accidentZone:null,accidentLocation:null,accidentPlace:null,accidentLesionDescription:"",accidentBodyPartDescription:"",accidentMechanismDescription:"",accidentDescription:"",isAccidentWitness:null,date:null,responsibleName:"",responsibleDocumentType:null,responsibleDocumentNumber:"",responsibleDocumentJob:"",status:"abierto",witnesses:[{id:0,name:"",documentType:null,documentNumber:0,job:""},{id:0,name:"",documentType:null,documentNumber:0,job:""}],lesions:[],bodies:[],factors:[],mechanisms:[]};var v=function(){if(null!=e.report.job){var t={};return t.operation="diagnostic",t.customerId=e.customerId,t.jobId=e.report.job.id,l({method:"POST",url:"api/customer/config-sgsst/job-activity/list",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){c(function(){e.employee_occupation=t.data.data})})["catch"](function(e){})["finally"](function(){})}e.employee_occupation=[]};e.$watch("report.job",function(){v()}),e.cancelEdition=function(t){e.isView?null!=e.$parent&&e.$parent.navToSection("list","list"):i.swal({title:"Está seguro?",text:"Perderá todos los cambios realizados en este formulario.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, cancelar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(t){t?c(function(){null!=e.$parent&&e.$parent.navToSection("list","list")}):swal("Cancelación","La operación ha sido cancelada","error")})};var b=function(e){var t=[];return angular.forEach(e,function(e){var o={id:0,customerOccupationalReportAlId:0,itemId:e.value,description:e.item,isActive:!1};t.push(o)}),t},_=function(t){if(t){var o={id:t};l({method:"GET",url:"api/occupational-report",params:o})["catch"](function(e,t){if(403==t){var o=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";i.swal("No Autorizado","No estas autorizado para ver esta información.","error"),c(function(){n.go(o)},3e3)}else 404==t?c(function(){}):i.swal("Error","Se ha presentado un error al intentar acceder a la información del seguimiento","error")}).then(function(t){e.reloadEmployee=!1,c(function(){e.report=t.data.result,C(),D(),e.report.lesions=k(e.report.lesions),e.report.bodies=k(e.report.bodies),e.report.factors=k(e.report.factors),e.report.mechanisms=k(e.report.mechanisms),e.changeState(e.report.state),e.changeCustomerState(e.report.customerState),e.changeCustomerBranchState(e.report.customerBranchState),e.changeAccidentState(e.report.accidentState)}),c(function(){e.reloadEmployee=!0},100)})["finally"](function(){c(function(){e.loading=!1},400)})}else e.report.lesions=b(e.report_lesion_type),e.report.bodies=b(e.report_body_part),e.report.factors=b(e.report_factor),e.report.mechanisms=b(e.report_mechanism)};e.$watch("report.accidentDate",function(){D()});var D=function(){c(function(){if(null!=e.report.accidentDate){var t=["Domingo","Lunes","Martes","Miercoles","Jueves","Viernes","Sabado"],o=e.report.accidentDate.getDay(),r={item:t[o],value:o};e.report.accidentWeekDay=r}},400)},C=function(){e.report.birthDate&&(e.report.birthDate=new Date(e.report.birthDate.date)),e.report.startDate&&(e.report.startDate=new Date(e.report.startDate.date)),e.report.accidentDate&&(e.report.accidentDate=new Date(e.report.accidentDate.date)),e.report.date&&(e.report.date=new Date(e.report.date.date))};_(e.$parent.currentReport),e.master=e.report,e.form={next:function(t){if(e.toTheTop(),t.$valid)S();else{var o=null,r=null;for(o in t)"$"!=o[0]&&(null!==r||t[o].$valid||(r=t[o].$name),t[o].$pristine&&(t[o].$dirty=!0));angular.element(".ng-invalid[name="+r+"]").focus(),T()}},prev:function(t){e.toTheTop(),E()},goTo:function(t,o){parseInt(e.currentStep)>parseInt(o)?(e.toTheTop(),A(o)):t.$valid?(e.toTheTop(),A(o)):T()},submit:function(t){var o=null;if(t.$invalid){var r=null,o=null;for(r in t)"$"!=r[0]&&(null!==o||t[r].$valid||(o=t[r].$name),t[r].$pristine&&(t[r].$dirty=!0));return w.info(e.customer),angular.element(".ng-invalid[name="+o+"]").focus(),void i.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}w.info(e.customer),O()},reset:function(t){e.report=angular.copy(e.master),t.$setPristine(!0)}};var T=function(e){f.pop("error","Error","Por favor complete el formulario en este paso antes de continuar")},S=function(){e.currentStep++},E=function(){e.currentStep--},A=function(t){e.currentStep=t},O=function(){var t={},r=JSON.stringify(e.report);t.data=Base64.encode(r);var n=0==e.report.id;return l({method:"POST",url:"api/occupational-report/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){c(function(){e.report=t.data.result,n?(e.$parent.currentReport=e.report.id,_(e.$parent.currentReport)):(C(),D(),e.report.lesions=k(e.report.lesions),e.report.bodies=k(e.report.bodies),e.report.factors=k(e.report.factors),e.report.mechanisms=k(e.report.mechanisms),e.changeState(e.report.state),e.changeCustomerState(e.report.customerState),e.changeCustomerBranchState(e.report.customerBranchState),e.changeAccidentState(e.report.accidentState)),i.swal("Registro","La información ha sido guardada satisfactoriamente","success")})})["catch"](function(e){o.error(e),i.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})},N=function(){var t={cid:68};l({method:"GET",url:"api/states",params:t})["catch"](function(e,t){}).then(function(t){e.states=t.data.result,e.cities=[]})["finally"](function(){})},I=function(t){if(t){w.info("editando cliente con código: "+e.customer.id);var o={id:t};l({method:"GET",url:"api/customer",params:o})["catch"](function(e,t){if(403==t){var o=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";i.swal("No Autorizado","No estas autorizado para ver esta información.","error"),c(function(){n.go(o)},3e3)}else 404==t?(i.swal("Información no disponible","Cliente no encontrado","error"),c(function(){n.go("app.clientes.list")})):i.swal("Error","Se ha presentado un error al intentar acceder a la información del cliente","error")}).then(function(t){c(function(){e.customer=t.data.result,e.report.customerBusinessName=e.customer.businessName,e.report.customerDocumentType=e.customer.documentType,e.report.customerDocumentNumber=e.customer.documentNumber,e.report.customerEconomicActivity=e.customer.economicActivity;var o=L(e.customer.contacts,"dir"),r=L(e.customer.contacts,"tel"),n=L(e.customer.contacts,"fax"),i=L(e.customer.contacts,"email");e.report.customerAddress=o.length>0?o[0].value:"",e.report.customerTelephone=r.length>0?r[0].value:"",e.report.customerFax=n.length>0?n[0].value:"",e.report.customerEmail=i.length>0?i[0].value:"",e.report.customerState=e.customer.state,e.changeCustomerState(e.report.customerState),e.report.customerCity=e.customer.town})})["finally"](function(){})}};N(),I(e.report.customerId),e.$watch("report.employee",function(){if(null!=e.report.employee&&null!=e.report.employee.entity&&e.reloadEmployee){e.report.employeeId=e.report.employee.entity.id,e.report.firstLastName=e.report.employee.entity.lastName,e.report.firstName=e.report.employee.entity.firstName,e.report.documentType=e.report.employee.entity.documentType,e.report.documentNumber=e.report.employee.entity.documentNumber,e.report.birthDate=null,e.report.employee.entity.birthDate&&(e.report.birthDate=new Date(e.report.employee.entity.birthDate.date)),e.report.gender=e.report.employee.entity.gender,e.report.state=e.report.employee.entity.state,e.changeState(e.report.state),e.report.city=e.report.employee.entity.town,e.report.eps=e.report.employee.entity.eps,e.report.arl=e.report.employee.entity.arl,null!=e.report.employee.entity.afp?e.report.isAfp={item:"Si",value:"1"}:e.report.isAfp={item:"No",value:"0"},e.report.afp=e.report.employee.entity.afp;var t=L(e.report.employee.entity.details,"dir"),o=L(e.report.employee.entity.details,"tel"),r=L(e.report.employee.entity.details,"fax");e.report.address=t.length>0?t[0].value:"",e.report.telephone=o.length>0?o[0].value:"",e.report.fax=r.length>0?r[0].value:"",e.report.salary=e.report.employee.salary,e.report.job=e.report.employee.job,e.report.occupation=e.report.employee.occupation}});var L=function(e,t){var o=[];return angular.forEach(e,function(e){null!=e.type&&e.type.value===t&&o.push(e)}),o},k=function(e){return angular.forEach(e,function(e){e.isActive="0"!=e.isActive}),e};e.changeState=function(t,o){e.employeeCities=[];var r={sid:t.id};l({method:"GET",url:"api/towns",params:r}).then(function(t){e.employeeCities=t.data.result})["finally"](function(){})},e.changeCustomerState=function(t,o){e.customerCities=[];var r={sid:t.id};l({method:"GET",url:"api/towns",params:r}).then(function(t){e.customerCities=t.data.result})["finally"](function(){})},e.changeCustomerBranchState=function(t,o){if(null!=t){e.customerBranchCities=[];var r={sid:t.id};l({method:"GET",url:"api/towns",params:r}).then(function(t){e.customerBranchCities=t.data.result})["finally"](function(){})}},e.changeAccidentState=function(t,o){e.accidentCities=[];var r={sid:t.id};l({method:"GET",url:"api/towns",params:r}).then(function(t){e.accidentCities=t.data.result})["finally"](function(){})},e.onCancel=function(){null!=e.$parent&&e.$parent.navToSection("list","list",0)},e.onPreview=function(){null!=e.$parent&&e.$parent.navToSection("preview","preview",e.$parent.currentReport)},e.onAddEmployeeList=function(){var t=m.open({templateUrl:a.app.views.urlRoot+"modules/customer/occupational/investigation/customer_absenteeism_disability_employee_list_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideOccupationalEmployeeListCtrl",scope:e});t.result.then(function(t){var o=d("filter")(e.employees,{id:t.id});0==o.length&&e.employees.push(t),e.report.employee=t,e.report.job=e.report.employee.job})},e.onSearchEconomicActivity=function(){var t=m.open({templateUrl:a.app.views.urlRoot+"modules/customer/occupational/report/customer_absenteeism_disability_employee_list_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideOccupationalCustomerEconomicActivityListCtrl",scope:e});t.result.then(function(t){e.report.customerEconomicActivity=t})}}]),app.controller("ModalInstanceSideOccupationalEmployeeListCtrl",["$rootScope","$stateParams","$scope","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile",function(e,t,o,r,n,i,a,l,c,s,u,p,d,m){o.employee={id:0},o.onCloseModal=function(){r.close(o.employee)},o.onCancel=function(){r.dismiss("cancel")},o.onLoadRecord=function(){if(0!=o.employee.id){var e={id:o.employee.id};l({method:"GET",url:"api/customer-employee",params:e})["catch"](function(e,t){if(403==t){var o=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";a.swal("No Autorizado","No estas autorizado para ver esta información.","error"),i(function(){$state.go(o)},3e3)}else 404==t?a.swal("Información no disponible","Diagnóstico no encontrado","error"):a.swal("Error","Se ha presentado un error al intentar acceder a la información del proceso","error")}).then(function(e){i(function(){o.employee=e.data.result})})["finally"](function(){i(function(){o.onCloseModal()},400)})}else o.loading=!1},o.dtInstanceDisabilityEmployeeList={},o.dtOptionsDisabilityEmployeeList=d.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerId=t.customerId,JSON.stringify(e)},url:"api/customer-employee-modal-basic",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){f()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,t,r){m(angular.element(e).contents())(o)}),o.dtColumnsDisabilityEmployeeList=[p.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,t,o,r){var n="",i="",a='<a class="btn btn-success btn-xs editRow lnk" href="#" uib-tooltip="Adicionar empleado" tooltip-placement="right"  data-id="'+e.id+'"'+i+' >   <i class="fa fa-plus-square"></i></a> ';return n+=a}),p.newColumn("documentNumber").withTitle("Número Identificación").withOption("width",200),p.newColumn("firstName").withTitle("Nombre").withOption("width",200),p.newColumn("lastName").withTitle("Apellidos").withOption("width",200),p.newColumn("workPlace").withTitle("Centro de Trabajo").withOption("width",200),p.newColumn("job").withTitle("Cargo").withOption("width",200),p.newColumn("neighborhood").withTitle("Centro de Costos").withOption("width",200),p.newColumn(null).withTitle("Estado").withOption("width",200).renderWith(function(e,t,o,r){var n="label label-danger",i="Inactivo";null==e.isActiveCode&&void 0==e.isActiveCode||("Activo"==e.isActiveCode?(n="label label-success",i="Activo"):(n="label label-danger",i="Inactivo"));var a='<span class="'+n+'">'+i+"</span>";return a}),p.newColumn(null).withTitle("Autorización").withOption("width",200).renderWith(function(e,t,o,r){var n="label label-danger",i="Inactivo";null==e.isAuthorized&&void 0==e.isAuthorized||("Autorizado"==e.isAuthorized?(n="label label-success",i="Autorizado"):"No Autorizado"==e.isAuthorized?(n="label label-danger",i="No Autorizado"):(n="label label-info",i="N/A"));var a='<span class="'+n+'">'+i+"</span>";return a})];var f=function(){$("#dtDisabilityEmployeeList a.editRow").on("click",function(){var e=$(this).data("id");o.editDisabilityEmployee(e)})};o.reloadData=function(){o.dtInstanceDisabilityEmployeeList.reloadData()},o.viewDisabilityEmployee=function(e){o.employee.id=e,o.isView=!0,o.onLoadRecord()},o.editDisabilityEmployee=function(e){o.employee.id=e,o.isView=!1,o.onLoadRecord()}}]),app.controller("ModalInstanceSideOccupationalCustomerEconomicActivityListCtrl",["$rootScope","$stateParams","$scope","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile",function(e,t,o,r,n,i,a,l,c,s,u,p,d,m){o.title="ACTIVIDADES ECONÓMICAS";var f={};o.activity={id:0},o.onCloseModal=function(){r.close(o.activity)},o.onCancel=function(){r.dismiss("cancel")},o.onLoadRecord=function(){if(0!=o.activity.id){var e={id:o.activity.id};l({method:"GET",url:"api/investigation-al/economic-activity",params:e})["catch"](function(e,t){if(403==t){var o=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";a.swal("No Autorizado","No estas autorizado para ver esta información.","error"),i(function(){$state.go(o)},3e3)}else 404==t?a.swal("Información no disponible","Diagnóstico no encontrado","error"):a.swal("Error","Se ha presentado un error al intentar acceder a la información del proceso","error")}).then(function(e){i(function(){o.activity=e.data.result})})["finally"](function(){i(function(){o.onCloseModal()},400)})}else o.loading=!1},f.operation="restriction",f.data="",o.dtInstanceDisabilityEmployeeList={},o.dtOptionsDisabilityEmployeeList=d.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:f,url:"api/investigation-al/economic-activity",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){y()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,t,r){m(angular.element(e).contents())(o)}),o.dtColumnsDisabilityEmployeeList=[p.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,t,o,r){var n="",i="",a='<a class="btn btn-success btn-xs editRow lnk" href="#" uib-tooltip="Adicionar actividad"  data-id="'+e.id+'"'+i+' >   <i class="fa fa-plus-square"></i></a> ';return n+=a}),p.newColumn("code").withTitle("Código").withOption("width",200).withOption("defaultContent",""),p.newColumn("name").withTitle("Actividad Económica").withOption("defaultContent","")];var y=function(){$("#dtDisabilityEmployeeList a.editRow").on("click",function(){var e=$(this).data("id");o.editDisabilityEmployee(e)})};o.reloadData=function(){o.dtInstanceDisabilityEmployeeList.reloadData()},o.viewDisabilityEmployee=function(e){o.activity.id=e,o.isView=!0,o.onLoadRecord()},o.editDisabilityEmployee=function(e){o.activity.id=e,o.isView=!1,o.onLoadRecord()}}]);
"use strict";app.controller("customerOccupationalReportALListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","SweetAlert","$http","$filter","$document","$aside",function(t,e,n,o,a,i,r,l,c,u,s,d,p,m,f,w){var h=n;t.agents=u.agents(),t.dtInstanceCustomerOccupationalReportAL={},t.dtOptionsCustomerOccupationalReportAL=o.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.customerId=e.customerId,JSON.stringify(t)},url:"api/customer-occupational-report-al",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){C()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,n,o){r(angular.element(e).contents())(t)}),t.dtColumnsCustomerOccupationalReportAL=[a.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,e,n,o){var a="",i='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+t.id+'" >   <i class="fa fa-edit"></i></a> ',r='<a class="btn btn-info btn-xs viewRow lnk" href="#" uib-tooltip="Ver" data-id="'+t.id+'" >   <i class="fa fa-eye"></i></a> ',l=('<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+t.id+'" >   <i class="fa fa-trash-o"></i></a> ','<a target="_self" class="btn btn-success btn-xs downloadRow lnk" href="#" uib-tooltip="Descargar reporte" data-id="'+t.id+'" data-url="" >   <i class="fa fa-download"></i></a> '),c='<a class="btn btn-success btn-xs documentRow lnk" href="#" uib-tooltip="Anexos" data-id="'+t.id+'" >   <i class="fa fa-paperclip"></i></a> ';return u.can("seguimiento_view")&&(a+=r),u.can("seguimiento_edit")&&(a+=i),u.can("seguimiento_delete"),a+=l,a+=c}),a.newColumn("documentType").withTitle("Tipo de Identificación").withOption("width",200),a.newColumn("documentNumber").withTitle("Número de Identificación").withOption("width",200),a.newColumn("firstName").withTitle("Nombre"),a.newColumn("lastName").withTitle("Apellidos"),a.newColumn("job").withTitle("Cargo"),a.newColumn("eps").withTitle("EPS"),a.newColumn("arl").withTitle("ARL"),a.newColumn("afp").withTitle("AFP"),a.newColumn("accidentDate").withTitle("Fecha Accidente").withOption("width",150)];var C=function(){$("#dtCustomerOccupationalReportAL a.editRow").on("click",function(){var e=$(this).data("id");t.onEditReportAL(e)}),$("#dtCustomerOccupationalReportAL a.downloadRow").on("click",function(){var t=$(this).data("id"),e=$(this).data("url");""==e&&(jQuery("#downloadDocument")[0].src="api/occupational-report/download?id="+t)}),$("#dtCustomerOccupationalReportAL a.viewRow").on("click",function(){var e=$(this).data("id");t.onViewReportAL(e)}),angular.element("#dtCustomerOccupationalReportAL a.documentRow").on("click",function(){var e=angular.element(this).data("id");t.onAddAttachment(e)}),$("#dtCustomerOccupationalReportAL a.delRow").on("click",function(){var e=$(this).data("id");h.info("intenta eliminar el registro: "+e),d.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(o){if(o){var a={};a.id=e,p({method:"POST",url:"api/customer-occupational-report-al/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){n.error(t),d.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){t.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};t.dtInstanceCustomerOccupationalReportALCallback=function(e){t.dtInstanceCustomerOccupationalReportAL=e},t.reloadData=function(){t.dtInstanceCustomerOccupationalReportAL.reloadData()},t.onCreateReportAL=function(e){null!=t.$parent&&t.$parent.navToSection("form","edit",0)},t.onEditReportAL=function(e){null!=t.$parent&&t.$parent.navToSection("form","edit",e)},t.onViewReportAL=function(e){null!=t.$parent&&t.$parent.navToSection("form","view",e)},t.onViewReportAnalysis=function(e){null!=t.$parent&&t.$parent.navToSection("analysis","analysis",0)},t.onAttachment=function(e){null!=t.$parent&&t.$parent.navToSection("attachment","attachment",e)},t.onAddAttachment=function(e){var o=w.open({templateUrl:u.app.views.urlRoot+"modules/customer/occupational/report/customer_occupational_report_al_document_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideCustomerOccupationalReportALAttachmentCtrl",scope:t,resolve:{dataItem:function(){return{id:e}},isView:function(){return"view"==t.$parent.editMode}}});o.result.then(function(){t.reloadData()},function(){t.reloadData(),n.info("Modal dismissed at: "+new Date)})},t.onDownloadAttachment=function(){var e=$uibModal.open({templateUrl:u.app.views.urlRoot+"modules/common/modals/document_filter_modal.htm",controller:"ModalInstanceSideCustomerOccupationalReportALDownloadAttachmentCtrl",windowTopClass:"top-modal",resolve:{improvement:function(){return{id:0}},title:function(){return"Descargar anexos de seguimiento"},action:function(){return"Cancelar"}}});e.result.then(function(){t.reloadData()},function(){})}}]),app.controller("ModalInstanceSideCustomerOccupationalReportALAttachmentCtrl",["$stateParams","$rootScope","$scope","$uibModalInstance","dataItem","isView","$log","$timeout","SweetAlert","$filter","FileUploader","$http","DTColumnBuilder","DTOptionsBuilder","$compile","ListService",function(t,e,n,o,a,i,r,l,c,u,s,d,p,m,f,w){function h(){var e=[{name:"customer_document_type",value:t.customerId}];w.getDataList(e).then(function(t){n.documentType=t.data.data.customerDocumentType},function(t){n.status="Unable to load customer data: "+t.message})}var C=0,v="M",O=e.isCustomer();n.isView=!O&&i,n.documentClassification=e.parameters("customer_document_classification"),n.documentStatus=e.parameters("customer_document_status"),h();var b=function(){n.attachment={id:0,CustomerOccupationalReportId:a.id,type:null,classification:null,description:"",status:n.documentStatus?n.documentStatus[0]:null,version:1,label:v}};b(),n.onCloseModal=function(){o.close(1)},n.onCancel=function(){o.dismiss("cancel")},n.onClear=function(){b()};var g=n.uploader=new s({url:"api/customer-occupational-report-document/upload",formData:[],removeAfterUpload:!0});g.filters.push({name:"customFilter",fn:function(t,e){return this.queue.length<10}}),g.onBeforeUploadItem=function(t){var e={id:C};t.formData.push(e)},g.onCompleteAll=function(){n.reloadData(),n.onClear()},n.form={submit:function(t){var e=null;if(t.$invalid){var n=null,e=null;for(n in t)"$"!=n[0]&&(null!==e||t[n].$valid||(e=t[n].$name),t[n].$pristine&&(t[n].$dirty=!0));return angular.element(".ng-invalid[name="+e+"]").focus(),void c.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}c.swal("Validación exitosa","Procediendo con el guardado...","success"),T()},reset:function(t){t.$setPristine(!0)}};var T=function(){v=n.attachment.label;var t={},e=JSON.stringify(n.attachment);return t.data=Base64.encode(e),d({method:"POST",url:"api/customer-occupational-report-document/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){l(function(){g.queue.length>0?(C=t.data.result.id,g.uploadAll()):(n.reloadData(),n.onClear())})})["catch"](function(t){c.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){n.reloadData()})};n.dtOptionsCustomerDocumentModal=m.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.CustomerOccupationalReportId=a.id,t.statusCode="2",JSON.stringify(t)},url:"api/customer-occupational-report-document",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){D()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,e,o){f(angular.element(t).contents())(n)}),n.dtColumnsCustomerDocumentModal=[p.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,n,o,a){var i=t.documentUrl?t.documentUrl:"",r="api/customer-occupational-report-document/download?id="+t.id,l="",c='<a target="_self" class="btn btn-primary btn-xs downloadDocumentRow lnk" href="'+r+'" uib-tooltip="Descargar anexo" data-id="'+t.id+'" >   <i class="fa fa-download"></i></a> ',u='<a class="btn btn-info btn-xs openDocumentRow lnk" target="_blank" href="'+i+'" uib-tooltip="Abrir anexo" data-id="'+t.id+'" >   <i class="fa fa-folder-open-o"></i></a> ',s=!1;return null==t.protectionType?s=!0:"public"==t.protectionType?s=!0:"private"==t.protectionType&&1==t.hasPermission&&(s=!0),e.can("clientes_anexo_open")&&""!=i&&(l+=u),e.can("clientes_anexo_download")&&""!=i&&(l+=c),s?l:""}),p.newColumn("documentType").withTitle("Tipo de documento").withOption("width",200),p.newColumn("classification").withTitle("Clasificación").withOption("width",200),p.newColumn("description").withTitle("Descripción").withOption("width",200),p.newColumn("version").withTitle("Versión").withOption("width",200),p.newColumn("createdAt").withTitle("Fecha Creación").withOption("width",200).withOption("defaultContent",""),p.newColumn("status").withTitle("Estado").withOption("width",200).renderWith(function(t,e,n,o){var a="";switch(t){case"Vigente":a="label label-success";break;case"Anulado":a="label label-danger"}var i='<span class="'+a+'">'+t+"</span>";return i}),p.newColumn("label").withTitle("Origen").withOption("width",200).withOption("defaultContent","")];var D=function(){$("#dtCustomerDocumentModal a.editRow").on("click",function(){var t=$(this).data("id"),e=$(this).data("url");""==e?c.swal("Error en la descarga","No existe un anexo para descargar","error"):jQuery("#downloadDocument")[0].src="api/customer-occupational-report-document/download?id="+t})};n.dtInstanceCustomerDocumentModalCallback=function(t){n.dtInstanceCustomerDocumentModal=t},n.reloadData=function(){n.dtInstanceCustomerDocumentModal.reloadData()},n.dtOptionsCustomerMinimunStandardItemDocumentModal=m.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerId=t.customerId,e.roadSafetyItemId=a.roadSafetyItemId,e.customerId=t.customerId,e.statusCode="2",JSON.stringify(e)},url:"api/customer-occupational-report-document-available-previous",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){y()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,e,o){f(angular.element(t).contents())(n)}),n.dtColumnsCustomerMinimunStandardItemDocumentModal=[p.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,n,o,a){var i=t.documentUrl?t.documentUrl:"",r=("api/customer-occupational-report-document/download?id="+t.id,""),l='<a class="btn btn-success btn-xs addRow lnk" uib-tooltip="Adicionar" data-id="'+t.id+'" >   <i class="fa fa-plus"></i></a> ',c=!1;return null==t.protectionType?c=!0:"public"==t.protectionType?c=!0:"private"==t.protectionType&&1==t.hasPermission&&(c=!0),e.can("clientes_anexo_open")&&""!=i&&(r+=l),c?r:""}),p.newColumn("period").withTitle("Periodo").withOption("width",200),p.newColumn("documentType").withTitle("Tipo de documento").withOption("width",200),p.newColumn("classification").withTitle("Clasificación").withOption("width",200),p.newColumn("description").withTitle("Descripción").withOption("width",200),p.newColumn("version").withTitle("Versión").withOption("width",200),p.newColumn("createdAt").withTitle("Fecha Creación").withOption("width",200).withOption("defaultContent",""),p.newColumn("status").withTitle("Estado").withOption("width",200).renderWith(function(t,e,n,o){var a="";switch(t){case"Vigente":a="label label-success";break;case"Anulado":a="label label-danger"}var i='<span class="'+a+'">'+t+"</span>";return i})];var y=function(){$("#dtCustomerMinimunStandardItemDocumentModal a.addRow").on("click",function(){var t=$(this).data("id");S(t)})};n.dtInstanceCustomerMinimunStandardItemDocumentModalCallback=function(t){n.dtInstanceCustomerMinimunStandardItemDocumentModal=t},n.reloadHistoricalData=function(){n.dtInstanceCustomerMinimunStandardItemDocumentModal.reloadData()};var S=function(t){v=n.attachment.label;var e=JSON.stringify({id:t,CustomerOccupationalReportId:a.id});return d({method:"POST",url:"api/customer-occupational-report-document/import-historical",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param({data:Base64.encode(e)})}).then(function(t){l(function(){b(),n.reloadHistoricalData(),n.reloadData()})})["catch"](function(t){c.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})}}]),app.controller("ModalInstanceSideCustomerOccupationalReportALDownloadAttachmentCtrl",["$rootScope","$stateParams","$scope","$uibModal","$uibModalInstance","improvement","title","$log","$timeout","SweetAlert","$http","toaster","$filter","$aside","$document","DTColumnBuilder","DTOptionsBuilder","$compile","ListService","ngNotify",function(t,e,n,o,a,i,r,l,c,u,s,d,p,m,f,w,h,C,v,O){function b(){var t=n.filter.year?n.filter.year.value:null,o=[{name:"customer_document_type",value:e.customerId},{name:"customer_tracking_document_periods",value:e.customerId,year:t}];v.getDataList(o).then(function(t){n.documentType=t.data.data.customerDocumentType,n.years=t.data.data.customerTrackingDocumentPeriod.years,n.months=t.data.data.customerTrackingDocumentPeriod.months},function(t){n.status="Unable to load customer data: "+t.message})}n.loading=!0,n.title=r,n.onCloseModal=function(){a.close(1)},n.onCancel=function(){a.dismiss("cancel")},n.onSelectYear=function(){b()};var g=function(){n.filter={id:e.customerId}};g(),b(),n.form={submit:function(t){var e=null;if(t.$invalid){var o=null,e=null;for(o in t)"$"!=o[0]&&(null!==e||t[o].$valid||(e=t[o].$name),t[o].$pristine&&(t[o].$dirty=!0));return angular.element(".ng-invalid[name="+e+"]").focus(),void u.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}return n.filter.type||n.filter.year||n.filter.month?void T():void u.swal("El formulario contiene errores!","Por favor seleccione al menos un filtro e intentelo nuevamente.","error")},reset:function(t){}};var T=function(){O.set("El archivo se está generando.",{position:"bottom",sticky:!0,button:!1,html:!0});var t={customerId:e.customerId,audit:n.filter},o={},a=JSON.stringify(t);o.data=Base64.encode(a),s({method:"POST",url:"api/customer-occupational-report-document/export",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(t){var e=(t.data.path+t.data.filename,'<div class="row"> <div class="col-sm-12 text-center">Por favor espere y verifique su correo y la bandeja de mensajes!</div> </div>');O.set(e,{position:"bottom",sticky:!0,type:"success",button:!0,html:!0}),n.onCloseModal()})["catch"](function(t){O.set(t.data.message,{position:"bottom",sticky:!0,type:"error",button:!0,html:!0})})["finally"](function(){})}}]);
"use strict";app.controller("customerOccupationalReportAlAttachmentCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","SweetAlert","$rootScope","$http","$timeout","$uibModal","flowFactory","cfpLoadingBar","$filter","$document","FileUploader","$localStorage","$aside","ListService","$ngConfirm",function(t,n,e,o,a,i,r,l,c,u,s,d,m,p,f,h,w,g,C,v,A,b,O){function D(){var e=[{name:"customer_document_type",value:n.customerId}];b.getDataList(e).then(function(n){t.documentType=n.data.data.customerDocumentType},function(n){t.status="Unable to load customer data: "+n.message})}console.log("editMode attachment",t.$parent.editMode),t.isVisible="view"!=t.$parent.editMode;var y=null,I=0;t.currentId=t.$parent.currentId,t.documentClassification=s.parameters("customer_document_classification"),t.documentStatus=s.parameters("customer_document_status"),t.$storage=v.$default({hideMinimumStandardAttachmentCanceled:!0}),D(),t.onCancel=function(){null!=t.$parent&&t.$parent.navToSection("list","list",t.currentId)},t.onClear=function(){T()};var T=function(){t.attachment={id:0,customerImprovementPlanItemId:0,type:null,classification:null,description:"",status:t.documentStatus?t.documentStatus[0]:null,version:1},y&&y.$setPristine(!0)};T();var x=function(n){var e={id:n};d({method:"GET",url:"api/customer-occupational-report-document/get",params:e})["catch"](function(t,n){}).then(function(n){m(function(){t.attachment=n.data.result,t.attachment.version=parseInt(t.attachment.version)+1})})["finally"](function(){})},S=t.uploader=new C({url:"api/customer-occupational-report-document/upload",formData:[],removeAfterUpload:!0});S.filters.push({name:"customFilter",fn:function(t,n){return this.queue.length<10}}),S.onWhenAddingFileFailed=function(t,n,e){console.info("onWhenAddingFileFailed",t,n,e)},S.onAfterAddingFile=function(t){console.info("onAfterAddingFile",t)},S.onAfterAddingAll=function(t){console.info("onAfterAddingAll",t)},S.onBeforeUploadItem=function(t){console.info("onBeforeUploadItem",t);var n={id:I};t.formData.push(n)},S.onProgressItem=function(t,n){console.info("onProgressItem",t,n)},S.onProgressAll=function(t){console.info("onProgressAll",t)},S.onSuccessItem=function(t,n,e,o){console.info("onSuccessItem",t,n,e,o)},S.onErrorItem=function(t,n,e,o){console.info("onErrorItem",t,n,e,o)},S.onCancelItem=function(t,n,e,o){console.info("onCancelItem",t,n,e,o)},S.onCompleteItem=function(t,n,e,o){console.info("onCompleteItem",t,n,e,o)},S.onCompleteAll=function(){console.info("onCompleteAll"),t.reloadData(),t.onClear()},t.form={submit:function(t){y=t;var n=null;if(t.$invalid){var e=null,n=null;for(e in t)"$"!=e[0]&&(null!==n||t[e].$valid||(n=t[e].$name),t[e].$pristine&&(t[e].$dirty=!0));return angular.element(".ng-invalid[name="+n+"]").focus(),void u.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}u.swal("Validación exitosa","Procediendo con el guardado...","success"),P()},reset:function(t){t.$setPristine(!0)}};var P=function(){var n={},e=JSON.stringify(t.attachment);return n.data=Base64.encode(e),d({method:"POST",url:"api/customer-occupational-report-document/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(n){m(function(){S.queue.length>0?(I=n.data.result.id,S.uploadAll()):(t.reloadData(),t.onClear())})})["catch"](function(t){u.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){t.reloadData()})};t.dtOptionsCustomerOccupationalReportALDocument=o.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerId=n.customerId,t.$storage.hideMinimumStandardAttachmentCanceled&&(e.statusCode="2"),JSON.stringify(e)},url:"api/customer-occupational-report-document",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){_()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(n,e,o){r(angular.element(n).contents())(t)}),t.dtColumnsCustomerOccupationalReportALDocument=[a.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(n,e,o,a){var i=n.documentUrl?n.documentUrl:"",r="api/customer-occupational-report-document/download?id="+n.id,l="",c='<a target="_self" class="btn btn-primary btn-xs downloadDocumentRow lnk" href="'+r+'" uib-tooltip="Descargar anexo" data-id="'+n.id+'" >   <i class="fa fa-download"></i></a> ',u='<a class="btn btn-info btn-xs openDocumentRow lnk" target="_blank" href="'+i+'" uib-tooltip="Abrir anexo" data-id="'+n.id+'" >   <i class="fa fa-folder-open-o"></i></a> ',d='<a class="btn btn-danger btn-xs delDocumentRow lnk" href="#" uib-tooltip="Anular anexo" data-id="'+n.id+'" >   <i class="fa fa-ban"></i></a> ',m=!1;return null==n.protectionType?m=!0:"public"==n.protectionType?m=!0:"private"==n.protectionType&&1==n.hasPermission&&(m=!0),s.can("clientes_anexo_open")&&""!=i&&(l+=u),s.can("clientes_anexo_download")&&""!=i&&(l+=c),s.can("clientes_anexo_invalidate")&&t.isVisible&&"2"!=n.statusCode&&(l+=d),m?l:""}),a.newColumn("documentType").withTitle("Tipo de documento").withOption("width",200),a.newColumn("classification").withTitle("Clasificación").withOption("width",200),a.newColumn("description").withTitle("Descripción").withOption("width",200),a.newColumn("version").withTitle("Versión").withOption("width",200),a.newColumn("createdAt").withTitle("Fecha Creación").withOption("width",200).withOption("defaultContent",""),a.newColumn("status").withTitle("Estado").withOption("width",200).renderWith(function(t,n,e,o){var a="";switch(t){case"Vigente":a="label label-success";break;case"Anulado":a="label label-danger"}var i='<span class="'+a+'">'+t+"</span>";return i})];var _=function(){$("#dtCustomerOccupationalReportALDocument a.editRow").on("click",function(){var t=$(this).data("id"),n=$(this).data("url");""==n?u.swal("Error en la descarga","No existe un anexo para descargar","error"):jQuery("#downloadDocument")[0].src="api/customer-occupational-report-document/download?id="+t}),angular.element("#dtCustomerOccupationalReportALDocument a.delDocumentRow").on("click",function(){var n=angular.element(this).data("id");O({boxWidth:"35%",useBootstrap:!1,animation:"bottom",closeAnimation:"scale",title:"Está seguro?",content:"<strong>Anulará</strong> el anexo seleccionado",scope:t,type:"red",typeAnimated:!0,buttons:{cancel:{text:"Anular y cambiar versión",btnClass:"btn-primary",action:function(e,o){t.attachment.id=n,t.isView=!1,x(n),l.pop("info","Anulación Anexo","El anexo se cargó satisfactoriamente, seleccione una nueva versión del documento")}},fullCancel:{text:"Anular definitivamente",btnClass:"btn-red",action:function(o,a){var i={};i.id=n,d({method:"POST",url:"api/customer-occupational-report-document/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(n){swal("Eliminado","Anexo anulado satisfactoriamente","info"),t.reloadData()})["catch"](function(t){e.error(t),u.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}},closeAll:{text:"Cancelar",btnClass:"btn-default",action:function(t,n){}}}})})};t.dtInstanceCustomerOccupationalReportALDocumentCallback=function(n){t.dtInstanceCustomerOccupationalReportALDocument=n},t.reloadData=function(){t.dtInstanceCustomerOccupationalReportALDocument.reloadData()},t.onShowCancelledChange=function(){t.reloadData()}}]);
"use strict";app.controller("customerOccupationalReportALPreviewCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","SweetAlert","$http","$filter","$document",function(t,e,r,o,n,a,i,c,l,p,u,$,s,m,d){var f=r;f.info("loading..customerTrackingListCtrl "),t.agents=p.agents(),t.currentURL="api/occupational-report/preview?id="+t.$parent.currentReport+"&rnd="+Math.random(),t.onCancel=function(e){null!=t.$parent&&t.$parent.navToSection("form","edit",t.$parent.currentReport)}}]);
"use strict";app.controller("customerOccupationalInvestigationCtrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout",function(t,o,i,n,e,c){var a=i;a.info("loading..customerOccupationalInvestigationCtrl!!! "),t.investigation_section="list",t.currentId=0,t.modeDsp="edit",t.navToSection=function(o,i,n){c(function(){t.investigation_section=o,t.modeDsp=i,t.$parent.switchSubTab(i),t.currentId=n})}}]);
"use strict";app.controller("customerOccupationalInvestigationEditCtrl",["$scope","$stateParams","$log","$compile","$state","SweetAlert","$rootScope","$http","$timeout","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$uibModal","flowFactory","cfpLoadingBar","$filter","$aside","$document","toaster","FileUploader","ListService",function(e,t,i,n,a,o,r,l,s,c,u,d,p,m,f,v,g,w,h,y,b){function C(){var t=[{name:"wg_customer_productivity_stata_person_type",value:null}];b.getDataList(t).then(function(t){e.personTypeList=t.data.data.wg_customer_productivity_stata_person_type},function(t){e.status="Unable to load customer data: "+t.message})}function O(t,i,n){var a=[{name:"state",value:i?i.id:68},{name:"city",value:n?n.id:0}];b.getDataList(a).then(function(i){switch(t){case"general":e.stateList=i.data.data.stateList,e.cityList=i.data.data.cityList;break;case"customerBranch":e.branchStateList=i.data.data.stateList,e.branchCityList=i.data.data.cityList;break;case"employee":e.employeeStateList=i.data.data.stateList,e.employeeCityList=i.data.data.cityList;break;case"accident":e.accidentStateList=i.data.data.stateList,e.accidentCityList=i.data.data.cityList;break;default:e.stateList=i.data.data.stateList,e.cityList=i.data.data.cityList}},function(t){e.status="Unable to load customer data: "+t.message})}var D=i,T={},I=e.$parent.currentId;e.currentStep=0,e.isAgent="agent"==r.currentUser().wg_type,e.isAdmin="system"==r.currentUser().wg_type,e.isCustomer="customerAdmin"==r.currentUser().wg_type||"customerUser"==r.currentUser().wg_type,e.reloadEmployee=!0,e.isView="view"==e.$parent.modeDsp,e.minDateCurrent=new Date,e.customerId=t.customerId,e.users=[],e.employees=[],e.employeeHasCountry=!1,e.employeeHasState=!1,e.employeeHasCity=!1,C(),e.conditionalList=[{item:"Si",value:1},{item:"No",value:0}],e.weekDays=[{item:"Domingo",value:7},{item:"Lunes",value:1},{item:"Martes",value:2},{item:"Miercoles",value:3},{item:"Jueves",value:4},{item:"Viernes",value:5},{item:"Sábado",value:6}],e.eps=r.parameters("eps"),e.afp=r.parameters("afp"),e.arl=r.parameters("arl"),e.employment_relationship=r.parameters("wg_report_employment_relationship"),e.document_type=r.parameters("tipodoc"),e.zone=r.parameters("wg_report_zone"),e.economic_activity=r.parameters("wg_economic_activity"),e.type_linkage=r.parameters("wg_type_linkage"),e.gender=r.parameters("gender"),e.report_regular_work=r.parameters("wg_report_regular_work"),e.report_week_day=r.parameters("wg_report_week_day"),e.report_working_day=r.parameters("wg_report_working_day"),e.report_accident_type=r.parameters("wg_report_accident_type"),e.report_location=r.parameters("wg_report_location"),e.report_place=r.parameters("wg_report_place"),e.report_lesion_type=r.parameters("wg_report_lesion_type"),e.report_body_part=r.parameters("wg_report_body_part"),e.report_factor=r.parameters("wg_report_factor"),e.report_mechanism=r.parameters("wg_report_mechanism"),e.accidentTypeList=r.parameters("wg_report_accident_type"),e.employeeLinkTypeList=r.parameters("wg_type_linkage"),e.accidentWorkingDayList=r.parameters("wg_report_working_day"),e.accidentCategoryList=r.parameters("wg_report_accident_type"),e.accidentLocationList=r.parameters("wg_report_location"),e.accidentPlaceList=r.parameters("wg_report_place"),e.measureTypeList=r.parameters("investigation_measure"),e.arl=r.parameters("arl"),e.documentType=r.parameters("customer_document_type"),e.tiposdoc=r.parameters("tipodoc"),e.countryList=r.countries(),e.arl=r.parameters("arl"),e.documentType=r.parameters("customer_document_type"),e.tiposdoc=r.parameters("tipodoc"),e.extrainfo=r.parameters("extrainfo"),e.employeeZoneList=r.parameters("wg_report_zone"),e.accidentZoneList=r.parameters("wg_report_zone"),e.testimonyList=r.parameters("investigation_testimony_type"),e.factorImmediateList=r.parameters("investigation_cause_classification_immediate"),e.factorBasicList=r.parameters("investigation_cause_classification_basic"),e.customers=[],e.employees=[],e.responsibleList=[],e.states=[],e.cities=[],e.reportAtList=[],e.months=r.parameters("month");var S=function(){return{id:0,type:null,accidentIsWatching:null,documentType:null,documentNumber:"",name:"",job:"",story:""}};e.investigation={id:I,customer:e.customer,employee:null,isReportAtRelated:!1,reportAt:null,accidentDate:null,accidentType:null,country:null,state:null,city:null,observation:"",accidentWeekDay:null,accidentMonth:null,reportDate:null,notificationArlDate:null,notificationDocumentDate:null,responsibleList:[],customerIsWorkingInHq:!1,witnessList:[S()],customerObservation:null,customerPrincipalZone:null,customerPrincipalEconomicActivity:null,customerPrincipalRiskClass:null,customerBranchEconomicActivity:null,customerBranchRiskClass:null,customerBranchCountry:null,customerBranchState:null,customerBranchCity:null,customerBranchZone:null,customerResponsibleHealth:null,details:[],employeeLinkType:null,employeeStartDate:null,employeeZone:null,employeeHabitualOccupationCode:"",employeeHabitualOccupation:"",employeeHabitualOccupationTime:"",employeeDuration:"",employeeJobTask:"",accidentDateOf:null,accidentWorkingDay:null,accidentCategory:null,accidentWorkTimeHour:0,accidentWorkTimeMinute:0,accidentIsDeathCause:null,accidentDateOfDeath:null,accidentIsRegularWork:null,accidentOtherRegularWorkText:"",accidentOtherRegularWorkTextCode:"",accidentCountry:null,accidentState:null,accidentCity:null,accidentZone:null,accidentLocation:null,accidentPlace:null,lesions:[],bodies:[],factors:[],mechanisms:[]};var _=function(){e.basic={id:0,customerOccupationalInvestigationId:I,type:"basic",factor:null,cause:null}},E=function(){e.immediate={id:0,customerOccupationalInvestigationId:I,type:"immediate",factor:null,cause:null}},A=function(){e.measure={id:0,customerOccupationalInvestigationId:I,type:null,description:""}};E(),_(),A(),e.cancelEdition=function(t){e.isView?null!=e.$parent&&e.$parent.navToSection("list","list"):o.swal({title:"Está seguro?",text:"Perderá todos los cambios realizados en este formulario.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, cancelar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(t){t?s(function(){null!=e.$parent&&e.$parent.navToSection("list","list")}):swal("Cancelación","La operación ha sido cancelada","error")})};var L=function(e){var t=[];return angular.forEach(e,function(e){var i={id:0,customerOccupationalReportAlId:0,itemId:e.value,description:e.item,isActive:!1};t.push(i)}),t},k=function(t){if(t){var i={id:t};l({method:"GET",url:"api/customer/occupational-investigation-al",params:i})["catch"](function(e,t){if(403==t){var i=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";o.swal("No Autorizado","No estas autorizado para ver esta información.","error"),s(function(){a.go(i)},3e3)}else 404==t?s(function(){}):o.swal("Error","Se ha presentado un error al intentar acceder a la información del seguimiento","error")}).then(function(t){e.reloadEmployee=!1,s(function(){e.investigation=t.data.result,e.employeeHasCountry=null!=e.investigation.employee.entity.country,e.employeeHasState=null!=e.investigation.employee.entity.state,e.employeeHasCity=null!=e.investigation.employee.entity.town,null==e.investigation.customerPrincipalEconomicActivity&&(e.investigation.customerPrincipalEconomicActivity=e.investigation.customer.economicActivity),O("general",e.investigation.country,e.investigation.state),O("customer",e.investigation.customer.country,e.investigation.customer.state),O("customerBranch",e.investigation.customerBranchCountry,e.investigation.customerBranchState),O("accident",e.investigation.accidentCountry,e.investigation.accidentState),e.investigation.lesions=N(e.investigation.lesions),e.investigation.bodies=N(e.investigation.bodies),e.investigation.factors=N(e.investigation.factors),e.investigation.mechanisms=N(e.investigation.mechanisms),W(),null!=e.investigation.witnessList&&0!=e.investigation.witnessList.length||(e.investigation.witnessList=[S()])}),s(function(){e.reloadEmployee=!0},100)})["finally"](function(){s(function(){e.loading=!1},400)})}else e.investigation.lesions=L(e.report_lesion_type),e.investigation.bodies=L(e.report_body_part),e.investigation.factors=L(e.report_factor),e.investigation.mechanisms=L(e.report_mechanism)};k(I),e.master=e.report,e.form={next:function(t){if(e.toTheTop(),t.$valid||5==e.currentStep)0!=e.investigation.id?B():h.pop("error","Error","Para continuar, primero debe guardar");else{var i=null,n=null;for(i in t)"$"!=i[0]&&(null!==n||t[i].$valid||(n=t[i].$name),t[i].$pristine&&(t[i].$dirty=!0));angular.element(".ng-invalid[name="+n+"]").focus(),P()}},prev:function(t){e.toTheTop(),R()},goTo:function(t,i){parseInt(e.currentStep)>parseInt(i)?(e.toTheTop(),x(i)):t.$valid?(e.toTheTop(),x(i)):P()},submit:function(t){var i=null;if(t.$invalid){var n=null,i=null;for(n in t)"$"!=n[0]&&(null!==i||t[n].$valid||(i=t[n].$name),t[n].$pristine&&(t[n].$dirty=!0));return D.info(e.customer),angular.element(".ng-invalid[name="+i+"]").focus(),void o.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}D.info(e.customer),M()},reset:function(t){e.report=angular.copy(e.master),t.$setPristine(!0)}};var P=function(e){h.pop("error","Error","Por favor complete el formulario en este paso antes de continuar")},B=function(){e.currentStep++},R=function(){e.currentStep--},x=function(t){e.currentStep=t},M=function(){var t={};if(null==e.investigation.responsibleList||0==e.investigation.responsibleList.length)return void o.swal("Información requerida","Debe ingresar al menos un investigador","error");var n=JSON.stringify(e.investigation);return t.data=Base64.encode(n),l({method:"POST",url:"api/customer/occupational-investigation-al/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){s(function(){o.swal("Validación exitosa","La información ha sido guardada satisfactoriamente","success"),e.investigation=t.data.result,T.investigation_id=t.data.result.id,I=t.data.result.id,e.employeeHasCountry=null!=e.investigation.employee.entity.country,e.employeeHasState=null!=e.investigation.employee.entity.state,e.employeeHasCity=null!=e.investigation.employee.entity.town,null==e.investigation.customerPrincipalEconomicActivity&&(e.investigation.customerPrincipalEconomicActivity=e.investigation.customer.economicActivity),W()})})["catch"](function(e){i.error(e),o.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};e.onSelectCountry=function(){e.investigation.isReportAtRelated||(e.investigation.state=null,e.investigation.city=null),O("general",e.investigation.country,null)},e.onSelectState=function(){e.investigation.isReportAtRelated||(e.investigation.city=null),O("general",e.investigation.country,e.investigation.state)},e.onSelectCountryBranch=function(){e.investigation.customerBranchState=null,e.investigation.customerBranchCity=null,O("customerBranch",e.investigation.customerBranchCountry,null)},e.onSelectStateBranch=function(){e.investigation.customerBranchCity=null,O("customerBranch",e.investigation.customerBranchCountry,e.investigation.customerBranchState)},e.onSelectEmployeeCountry=function(){e.investigation.employee.entity.state=null,e.investigation.employee.entity.city=null,O("employee",e.investigation.employee.entity.country,null)},e.onSelectEmployeeState=function(){e.investigation.employee.entity.city=null,O("employee",e.investigation.employee.entity.country,e.investigation.employee.entity.state)},e.onSelectCountryAccident=function(){e.investigation.isReportAtRelated||(e.investigation.accidentState=null,e.investigation.accidentCity=null),O("accident",e.investigation.accidentCountry,null)},e.onSelectStateAccident=function(t,i){e.investigation.isReportAtRelated||(e.investigation.accidentCity=null),O("accident",e.investigation.accidentCountry,e.investigation.accidentState)};var N=function(e){return angular.forEach(e,function(e){e.isActive="0"!=e.isActive}),e},W=function(){if(null!=e.investigation.accidentDate){var t=["Domingo","Lunes","Martes","Miercoles","Jueves","Viernes","Sabado"];if(e.investigation.accidentWeekDayIndex!=-1){var i={item:t[e.investigation.accidentWeekDayIndex],value:e.investigation.accidentWeekDayIndex};e.investigation.accidentWeekDay=i}}e.investigation.accidentDate=z(e.investigation.accidentDate),e.investigation.reportDate=z(e.investigation.reportDate),e.investigation.notificationArlDate=z(e.investigation.notificationArlDate),e.investigation.notificationDocumentDate=z(e.investigation.notificationDocumentDate),e.investigation.employee.entity.birthDate=z(e.investigation.employee.entity.birthDate),e.investigation.employeeStartDate=z(e.investigation.employeeStartDate),e.investigation.accidentDateOf=z(e.investigation.accidentDateOf),e.investigation.accidentDateOfDeath=z(e.investigation.accidentDateOfDeath)},z=function(e){return null==e?null:new Date(e.date)};e.onCancel=function(){null!=e.$parent&&e.$parent.navToSection("list","list",0)},e.onPreview=function(){if(null!=e.$parent){var t=e.isView?"view":"preview";e.$parent.navToSection("preview",t,I)}},e.onChangeWorkplace=function(){var t=e.investigation.customerIsWorkingInHq;e.investigation.customerBranchEconomicActivity=t?e.investigation.customerPrincipalEconomicActivity:null,e.investigation.customerBranchCountry=t?e.investigation.customer.country:null,e.investigation.customerBranchState=t?e.investigation.customer.state:null,e.investigation.customerBranchCity=t?e.investigation.customer.town:null,e.investigation.customerBranchZone=t?e.investigation.customerPrincipalZone:null,e.investigation.details=t?e.investigation.customer.contacts:[]},e.onAddEmployee=function(){if(null!=e.investigation.customer){var t=g.open({templateUrl:r.app.views.urlRoot+"modules/customer/occupational/investigation/customer_absenteeism_disability_employee_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideOccupationalInvestigationEmployeeCtrl",scope:e,resolve:{customer:function(){return e.investigation.customer}}});t.result.then(function(e){F(e)})}else h.pop("error","Error","Debe seleccionar una empresa")},e.onAddDisabilityEmployeeList=function(){if(null!=e.investigation.customer){var t=g.open({templateUrl:r.app.views.urlRoot+"modules/customer/occupational/investigation/customer_absenteeism_disability_employee_list_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideOccupationalInvestigationEmployeeListCtrl",scope:e,resolve:{customer:function(){return e.investigation.customer}}});t.result.then(function(e){F(e)})}else h.pop("error","Error","Debe seleccionar una empresa")};var F=function(t){var i=v("filter")(e.employees,{id:t.id});0==i.length&&e.employees.push(t),e.investigation.employee=t};e.onSearchReportAT=function(t){if(null!=e.investigation.customer){var i=g.open({templateUrl:r.app.views.urlRoot+"modules/customer/occupational/investigation/customer_absenteeism_disability_employee_list_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideOccupationalInvestigationReportListCtrl",scope:e,resolve:{customer:function(){return e.investigation.customer}}});i.result.then(function(e){q(e)})}else h.pop("error","Error","Debe seleccionar una empresa")},e.onSelectReportAt=function(){j()},e.onSelectMadeByType=function(){};var q=function(t){var i=v("filter")(e.reportAtList,{id:t.id});0==i.length&&e.reportAtList.push(t),e.investigation.reportAt=t,j()},j=function(){var t=e.investigation.reportAt,i=v("filter")(e.countryList,{id:68},!0),n=i.length>0?i[0]:null;e.investigation.employee=t.employee,e.investigation.accidentDate=t.accidentDate,e.investigation.accidentWeekDay=t.accidentWeekDay,e.investigation.accidentType=t.accidentType,e.investigation.country=n,e.investigation.state=t.accidentState,e.investigation.city=t.accidentCity,e.investigation.reportDate=t.date,e.investigation.customerPrincipalEconomicActivity=t.customerEconomicActivity,e.investigation.customerPrincipalZone=t.customerZone,e.investigation.employeeLinkType=t.typeLinkage,e.investigation.employeeZone=t.zone,e.investigation.employeeHabitualOccupationTime=t.accidentWorkTime,e.investigation.accidentWorkingDay=t.accidentWorkingDay,e.investigation.accidentIsDeathCause=t.accidentDeathCause,e.investigation.accidentCategory=t.accidentType,e.investigation.accidentWorkTimeHour=t.accidentWorkTime,e.investigation.accidentIsRegularWork=t.accidentRegularWork,e.investigation.accidentOtherRegularWorkText=t.accidentRegularWorkText?t.accidentRegularWorkText.name:null,e.investigation.accidentOtherRegularWorkTextCode=t.accidentRegularWorkText.name,e.investigation.accidentIsRegularWork=t.accidentRegularWork,e.investigation.customerBranchCountry=n,e.investigation.accidentCountry=n,e.investigation.accidentState=t.accidentState,e.investigation.accidentCity=t.accidentCity,e.investigation.accidentZone=t.accidentZone,e.investigation.accidentLocation=t.accidentLocation,e.investigation.accidentPlace=t.accidentPlace,e.investigation.accidentPlace=t.accidentPlace,e.investigation.lesions=t.lesions.map(function(e,t,i){return{id:0,customerOccupationalReportAlId:0,itemId:e.itemId,description:e.description,isActive:"1"==e.isActive||1==e.isActive}}),e.investigation.bodies=t.bodies.map(function(e,t,i){return{id:0,customerOccupationalReportAlId:0,itemId:e.itemId,description:e.description,isActive:"1"==e.isActive||1==e.isActive}}),e.investigation.factors=t.factors.map(function(e,t,i){return{id:0,customerOccupationalReportAlId:0,itemId:e.itemId,description:e.description,isActive:"1"==e.isActive||1==e.isActive}}),e.investigation.mechanisms=t.mechanisms.map(function(e,t,i){return{id:0,customerOccupationalReportAlId:0,itemId:e.itemId,description:e.description,isActive:"1"==e.isActive||1==e.isActive}}),e.investigation.accidentInjuryTypeText=t.accidentDescription,W()},U=function(t){if(null!=e.investigation.customer){var i=g.open({templateUrl:r.app.views.urlRoot+"modules/customer/occupational/investigation/customer_absenteeism_disability_employee_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideOccupationalInvestigationAgentCtrl",scope:e,resolve:{customer:function(){return e.investigation.customer}}});i.result.then(function(e){H(e,t)})}else h.pop("error","Error","Debe seleccionar una empresa")},V=function(t){if(null!=e.investigation.customer){var i=g.open({templateUrl:r.app.views.urlRoot+"modules/common/modals/data_table_list_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideOccupationalInvestigationAgentListCtrl",scope:e,resolve:{customer:function(){return e.investigation.customer}}});i.result.then(function(e){H(e,t)})}else h.pop("error","Error","Debe seleccionar una empresa")},H=function(t,i){var n=v("filter")(e.responsibleList,{id:t.id});0==n.length&&e.responsibleList.push(t),e.investigation.responsibleList[i].responsible=t};e.onAddAgent=function(e){U(e)},e.onSearchAgentList=function(e){V(e)},e.onAddAgents=function(){s(function(){null==e.investigation.responsibleList&&(e.investigation.responsibleList=[]),e.investigation.responsibleList.push({id:0,type:null,responsible:null,documentNumber:"",name:"",job:"",role:null})})},e.onAddAgents(),e.onRemoveAgents=function(t){o.swal({title:"Está seguro?",text:"Confirma eliminar este registro??",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(n){n?s(function(){var n=e.investigation.responsibleList[t];if(e.investigation.responsibleList.splice(t,1),0!=n.id){var a={};a.id=n.id,l({method:"POST",url:"api/customer-occupational-investigation-al-responsible/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){i.error(e),o.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})};var J=function(t){if(null!=e.investigation.customer){var i=g.open({templateUrl:r.app.views.urlRoot+"modules/customer/occupational/investigation/customer_absenteeism_disability_employee_list_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideOccupationalInvestigationEconomicActivityListCtrl",scope:e});i.result.then(function(e){Z(e,t)})}else h.pop("error","Error","Debe seleccionar una empresa")},Z=function(t,i){switch(i){case"P":e.investigation.customerPrincipalEconomicActivity=t;break;case"B":e.investigation.customerBranchEconomicActivity=t}};e.onSearchPrincipalList=function(){J("P")},e.onSearchBranchList=function(){J("B")},e.onAddInfoDetail=function(){s(function(){null==e.investigation.details&&(e.investigation.details=[]),e.investigation.details.push({id:0,value:"",type:null})})},e.onRemoveInfoDetail=function(t){o.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(i){i?s(function(){var i=e.investigation.details[t];if(e.investigation.details.splice(t,1),0!=i.id){var n={};n.id=i.id,l({method:"POST",url:"api/customer-employee-contact/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info"),e.onSaveEmployee()})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})},e.onAddWitness=function(){s(function(){null==e.investigation.witnessList&&(e.investigation.witnessList=[]),e.investigation.witnessList.push(S())})},e.onRemoveWitness=function(t){o.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(n){n?s(function(){var n=e.investigation.witnessList[t];if(e.investigation.witnessList.splice(t,1),void 0!==n.id&&0!=n.id){var a={};a.id=n.id,l({method:"POST",url:"api/customer/occupational-investigation-al-witness/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){i.error(e),o.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})},e.onAddImmediate=function(){var t={};if(null==e.immediate.factor)return void h.pop("error","Error","Debe seleccionar la clasificación de la causa inmediata");if(null==e.immediate.cause)return void h.pop("error","Error","Debe ingresar el código de la causa inmediata");e.immediate.customerOccupationalInvestigationId=I;var n=JSON.stringify(e.immediate);return t.data=Base64.encode(n),l({method:"POST",url:"api/customer/occupational-investigation-al-cause/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){s(function(){e.reloadImmediateData(),E()})})["catch"](function(e){i.error(e),o.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})},e.cancelImmediate=function(){E()},e.onAddBasic=function(){var t={};if(null==e.basic.factor)return void h.pop("error","Error","Debe seleccionar la clasificación de la causa básica");if(null==e.basic.cause)return void h.pop("error","Error","Debe ingresar el código de la causa básica");e.basic.customerOccupationalInvestigationId=I;var n=JSON.stringify(e.basic);return t.data=Base64.encode(n),l({method:"POST",url:"api/customer/occupational-investigation-al-cause/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){s(function(){e.reloadBasicData(),_()})})["catch"](function(e){i.error(e),o.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})},e.cancelBasic=function(){_()};var G=function(t){var i="";switch(t){case"CI":i=t+e.immediate.factor.value;break;case"CB":i=t+e.basic.factor.value}var n=g.open({templateUrl:r.app.views.urlRoot+"modules/customer/occupational/investigation/customer_absenteeism_disability_employee_list_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideOccupationalInvestigationCauseListCtrl",scope:e,resolve:{target:function(){return i}}});n.result.then(function(e){Y(e,t)})},Y=function(t,i){switch(i){case"CI":e.immediate.cause=t;break;case"CB":e.basic.cause=t}};T.investigation_id=I,e.dtInstanceOccupationalInvestigationFactorImmediate={},e.dtOptionsOccupationalInvestigationFactorImmediate=c.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:T,url:"api/customer/occupational-investigation-al-cause/immediate",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){K()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,i,a){n(angular.element(t).contents())(e)}),e.dtColumnsOccupationalInvestigationFactorImmediate=[u.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,i,n,a){var o="",l=('<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+t.id+'" >   <i class="fa fa-edit"></i></a> ','<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+t.id+'" >   <i class="fa fa-trash-o"></i></a> ');return r.can("seguimiento_edit"),r.can("seguimiento_delete"),e.isView||(o+=l),o}),u.newColumn("factor.item").withTitle("Factor").withOption("width",300).withOption("defaultContent",""),u.newColumn("cause.code").withTitle("Código Causa").withOption("defaultContent",""),u.newColumn("cause.name").withTitle("Causa").withOption("defaultContent","")];var K=function(){angular.element("#dtOccupationalInvestigationFactorImmediate a.editRow").on("click",function(){var t=$(this).data("id");e.analysis.id=t,e.onLoadRecord()}),angular.element("#dtOccupationalInvestigationFactorImmediate a.delRow").on("click",function(){var t=$(this).data("id");D.info("intenta eliminar el registro: "+t),o.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(n){if(n){var a={};a.id=t,l({method:"POST",url:"api/customer/occupational-investigation-al-cause/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){i.error(e),o.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){e.reloadImmediateData()})}else e.reloadImmediateData()})})};e.dtInstanceOccupationalInvestigationFactorImmediateCallback=function(t){e.dtInstanceOccupationalInvestigationFactorImmediate=t},e.reloadImmediateData=function(){T.investigation_id=I,e.dtInstanceOccupationalInvestigationFactorImmediate.reloadData()},T.investigation_id=I,e.dtInstanceOccupationalInvestigationFactorBasic={},e.dtOptionsOccupationalInvestigationFactorBasic=c.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:T,url:"api/customer/occupational-investigation-al-cause/basic",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){Q()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,i,a){n(angular.element(t).contents())(e)}),e.dtColumnsOccupationalInvestigationFactorBasic=[u.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,i,n,a){var o="",l=('<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+t.id+'" >   <i class="fa fa-edit"></i></a> ','<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+t.id+'" >   <i class="fa fa-trash-o"></i></a> ');return r.can("seguimiento_edit"),e.isView||(o+=l),o}),u.newColumn("factor.item").withTitle("Factor").withOption("width",300).withOption("defaultContent",""),u.newColumn("cause.code").withTitle("Código Causa").withOption("defaultContent",""),u.newColumn("cause.name").withTitle("Causa").withOption("defaultContent","")];var Q=function(){angular.element("#dtOccupationalInvestigationFactorBasic a.editRow").on("click",function(){var t=$(this).data("id");e.analysis.id=t,e.onLoadRecord()}),angular.element("#dtOccupationalInvestigationFactorBasic a.delRow").on("click",function(){var t=$(this).data("id");D.info("intenta eliminar el registro: "+t),o.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(n){if(n){var a={};a.id=t,l({method:"POST",url:"api/customer/occupational-investigation-al-cause/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){i.error(e),o.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){e.reloadBasicData()})}else e.reloadBasicData()})})};e.dtInstanceOccupationalInvestigationFactorBasicCallback=function(t){e.dtInstanceOccupationalInvestigationFactorBasic=t},e.reloadBasicData=function(){T.investigation_id=I,e.dtInstanceOccupationalInvestigationFactorBasic.reloadData()},e.onSearchInsecureActList=function(e){G(e)},e.onAddMeasure=function(){var t={};if(null==e.measure.type)return void h.pop("error","Error","Debe seleccionar el tipo de medida de intervención");if(null==e.measure.description||""==e.measure.description)return void h.pop("error","Error","Debe ingresar la de medida de intervención");e.measure.customerOccupationalInvestigationId=I;var n=JSON.stringify(e.measure);return t.data=Base64.encode(n),l({method:"POST",url:"api/customer/occupational-investigation-al-measure/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){s(function(){e.reloadMeasureData(),A()})})["catch"](function(e){i.error(e),o.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})},e.cancelMeasure=function(){A()},T.investigation_id=I,e.dtInstanceOccupationalInvestigationMeasure={},e.dtOptionsOccupationalInvestigationMeasure=c.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:T,url:"api/customer/occupational-investigation-al-measure",type:"POST",beforeSend:function(){},
complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){X()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,i,a){n(angular.element(t).contents())(e)}),e.dtColumnsOccupationalInvestigationMeasure=[u.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,i,n,a){var o="",l='<a class="btn btn-warning btn-xs improvementRow lnk" href="#" uib-tooltip="Plan Mejoramiento" data-id="'+t.id+'" data-description="'+t.description+'">   <i class="fa fa-plus-square"></i></a> ',s='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+t.id+'" >   <i class="fa fa-trash-o"></i></a> ';return r.can("seguimiento_edit"),o+=l,e.isView||(o+=s),o}),u.newColumn("type.item").withTitle("Factor").withOption("defaultContent",""),u.newColumn("description").withTitle("Medida").withOption("defaultContent","")];var X=function(){angular.element("#dtOccupationalInvestigationMeasure a.improvementRow").on("click",function(){var e=$(this).data("id"),t=$(this).data("description");ee({id:e,comment:t})}),angular.element("#dtOccupationalInvestigationMeasure a.delRow").on("click",function(){var t=$(this).data("id");o.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(n){if(n){var a={};a.id=t,l({method:"POST",url:"api/customer/occupational-investigation-al-measure/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){i.error(e),o.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){e.reloadMeasureData()})}else e.reloadMeasureData()})})};e.dtInstanceOccupationalInvestigationMeasureCallback=function(t){e.dtInstanceOccupationalInvestigationMeasure=t},e.reloadMeasureData=function(){T.investigation_id=I,e.dtInstanceOccupationalInvestigationMeasure.reloadData()};var ee=function(t){var n=g.open({templateUrl:r.app.views.urlRoot+"modules/customer/common/modals/customer_improvement_plan_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideCustomerOccupationalInvestigationImprovementPlanCtrl",scope:e,resolve:{dataItem:function(){return t},isView:function(){return e.isView}}});n.result.then(function(){},function(){i.info("Modal dismissed at: "+new Date)})};e.$watch("investigation.accidentDate",function(){te()});var te=function(){s(function(){if(null!=e.investigation.accidentDate){var t=["Domingo","Lunes","Martes","Miercoles","Jueves","Viernes","Sabado"],i=e.investigation.accidentDate.getDay(),n={item:t[i],value:i};e.investigation.accidentWeekDay=n}},400)}}]),app.controller("ModalInstanceSideCustomerOccupationalInvestigationImprovementPlanCtrl",["$stateParams","$rootScope","$scope","$uibModalInstance","dataItem","$log","$timeout","SweetAlert","isView","$filter","FileUploader","$http","DTOptionsBuilder","DTColumnBuilder","$compile",function(e,t,i,n,a,o,r,l,s,c,u,d,p,m,f){i.maxDate=new Date,i.datePickerConfig={culture:"es-CO",format:"dd/MM/yyyy HH:mm"},i.isView=s,i.responsibleList=[],i.typesAlert=c("orderBy")(t.parameters("tracking_alert_type"),"id",!1),i.typesTime=t.parameters("tracking_alert_timeType"),i.statusAlert=t.parameters("tracking_alert_status"),i.preferencesAlert=t.parameters("tracking_alert_preference"),i.typeList=t.parameters("improvement_plan_type");var v=function(){i.improvement={id:0,customerId:e.customerId,classificationName:"INTERVENCIÓN",classificationId:null,entityName:"AT",entityId:a.id,type:null,endDate:null,description:a.comment,observation:"",responsible:null,isRequiresAnalysis:!1,status:{id:0,value:"CR",item:"Creada"},trackingList:[],alertList:[],period:null}};v(),i.onLoadRecord=function(e){if(0!=e){var t={id:e};d({method:"GET",url:"api/customer/improvement-plan",params:t})["catch"](function(e,t){if(403==t){var i=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";l.swal("No Autorizado","No estas autorizado para ver esta información.","error"),r(function(){$state.go(i)},3e3)}else 404==t?l.swal("Información no disponible","Registro no encontrado","error"):l.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(e){console.log(e),r(function(){null!=e.data.result&&""!=e.data.result&&(i.improvement=e.data.result,h())},400)})["finally"](function(){})}else i.loading=!1},i.onCloseModal=function(){n.close(1)},i.onCancel=function(){n.dismiss("cancel")},i.onClear=function(){};var g=function(){var t={customer_id:e.customerId};return d({method:"POST",url:"api/customer/improvement-plan/list-data",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(e){r(function(){i.responsibleList=e.data.data.responsible})})["catch"](function(e){l.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};g(),i.master=i.improvement,i.form={submit:function(e){var t=null;if(e.$invalid){var i=null,t=null;for(i in e)"$"!=i[0]&&(null!==t||e[i].$valid||(t=e[i].$name),e[i].$pristine&&(e[i].$dirty=!0));return angular.element(".ng-invalid[name="+t+"]").focus(),void l.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}l.swal("Validación exitosa","Procediendo con el guardado...","success"),w()},reset:function(e){i.improvement=angular.copy(i.master),e.$setPristine(!0)}};var w=function(){var e={},t=JSON.stringify(i.improvement);return e.data=Base64.encode(t),d({method:"POST",url:"api/customer/improvement-plan/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){r(function(){v()})})["catch"](function(e){l.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){i.reloadData()})},h=function(){null!=i.improvement.endDate&&(i.improvement.endDate=new Date(i.improvement.endDate.date)),angular.forEach(i.improvement.trackingList,function(e,t){null!=e.startDate&&(e.startDate=new Date(e.startDate.date))})};i.onAddTracking=function(){r(function(){null==i.improvement.trackingList&&(i.improvement.trackingList=[]),i.improvement.trackingList.push({id:0,customerImprovementPlanId:0,responsible:null,startDate:null})})},i.onRemoveTracking=function(e){l.swal({title:"Está seguro?",text:"Desea confirmar la eliminación de este registro ?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(t){t?r(function(){var t=i.improvement.trackingList[e];if(i.improvement.trackingList.splice(e,1),0!=t.id){var n={};n.id=t.id,d({method:"POST",url:"api/customer/improvement-plan-tracking/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){o.error(e),l.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})},i.onAddAlert=function(){r(function(){null==i.improvement.alertList&&(i.improvement.alertList=[]),i.improvement.alertList.push({id:0,customerImprovementPlanId:0,type:null,preference:null,time:0,timeType:null,status:null})})},i.onRemoveAlert=function(e){l.swal({title:"Está seguro?",text:"Desea confirmar la eliminación de este registro ?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(t){t?r(function(){var t=i.improvement.alertList[e];if(i.improvement.alertList.splice(e,1),0!=t.id){var n={};n.id=t.id,d({method:"POST",url:"api/customer/improvement-plan-alert/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){o.error(e),l.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})},i.dtInstanceImprovementPlan={},i.dtOptionsImprovementPlan=p.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerId=i.improvement.customerId,e.entityId=i.improvement.entityId,e.entityName=i.improvement.entityName,JSON.stringify(e)},url:"api/customer-improvement-plan-entity",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){y()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,t,n){f(angular.element(e).contents())(i)}),i.dtColumnsImprovementPlan=[m.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,n,a,o){var r="",l='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+e.id+'" >   <i class="fa fa-edit"></i></a> ',s='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+e.id+'" >   <i class="fa fa-trash-o"></i></a> ';return t.can("cliente_plan_mejoramiento_edit")&&(r+=l),t.can("cliente_plan_mejoramiento_delete")&&(r+=s),i.isView?null:r}),m.newColumn("origin").withTitle("Origen").withOption("width",200).withOption("defaultContent",""),m.newColumn("classification").withTitle("Clasificación").withOption("width",200).withOption("defaultContent",""),m.newColumn("type").withTitle("Tipo").withOption("width",200).withOption("defaultContent",""),m.newColumn("description").withTitle("Hallazgo").withOption("width",200).withOption("defaultContent",""),m.newColumn("responsibleName").withTitle("Responsable").withOption("defaultContent",""),m.newColumn(null).withTitle("Fecha Cierre").withOption("width",200).renderWith(function(e,t,i,n){return"object"==typeof e.endDate&&null!=e.endDate?moment(e.endDate.date).format("DD/MM/YYYY"):null!=e.endDate?moment(e.endDate).format("DD/MM/YYYY"):""}),m.newColumn(null).withTitle("Estado").withOption("width",200).withOption("defaultContent","").renderWith(function(e,t,i,n){var a="label label-success",o=e.status;switch(e.statusCode){case"AB":a="label label-info";break;case"CO":a="label label-success";break;case"CA":a="label label-danger"}return'<span class="'+a+'">'+o+"</span>"})];var y=function(){$("#dtImprovementPlan a.editRow").on("click",function(){var e=$(this).data("id");i.onLoadRecord(e)}),$("#dtImprovementPlan a.delRow").on("click",function(){var e=$(this).data("id");l.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(t){if(t){var n={};n.id=e,d({method:"POST",url:"api/customer/improvement-plan/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){o.error(e),l.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){i.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};i.dtInstanceImprovementPlanCallback=function(e){i.dtInstanceImprovementPlan=e},i.reloadData=function(){i.dtInstanceImprovementPlan.reloadData()}}]),app.controller("ModalInstanceSideOccupationalInvestigationEmployeeCtrl",["$rootScope","$stateParams","$scope","customer","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile",function(e,t,i,n,a,o,r,l,s,c,u,d,p,m,f){i.contractTypes=e.parameters("employee_contract_type"),i.documentTypes=e.parameters("employee_document_type");var v=function(){i.employee={id:0,customerId:n.id,isActive:!0,contractType:null,job:null,workPlace:null,salary:0,entity:{id:0,documentType:null,documentNumber:"",firstName:"",lastName:"",isActive:!0}}};v();var g=function(){var e={};return e.operation="restriction",e.customerId=t.customerId,s({method:"POST",url:"api/customer/config-sgsst/workplace/listProcess",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){r(function(){i.workPlaces=e.data.data})})["catch"](function(e){})["finally"](function(){})};g();var w=function(){if(null!=i.employee.workPlace){var e={};return e.operation="restriction",e.customerId=t.customerId,e.workPlaceId=i.employee.workPlace.id,s({method:"POST",url:"api/customer/config-sgsst/job/listByWorkPlace",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){r(function(){i.jobs=e.data.data})})["catch"](function(e){})["finally"](function(){})}i.jobs=[]};i.$watch("employee.workPlace",function(){w()}),i.onCloseModal=function(){a.close(1)},i.onCancelEmployee=function(){a.dismiss("cancel")},i.form={submit:function(e){var t=null;if(e.$invalid){var n=null,t=null;for(n in e)"$"!=n[0]&&(null!==t||e[n].$valid||(t=e[n].$name),e[n].$pristine&&(e[n].$dirty=!0));return angular.element(".ng-invalid[name="+t+"]").focus(),void r(function(){c.pop("error","Error","Por favor verifique los datos requeridos del formulario y vuelva a intentarlo")},500)}i.onSaveEmployee()},reset:function(e){e.$setPristine(!0)}},i.onSaveEmployee=function(){var e={},t=JSON.stringify(i.employee);return e.data=Base64.encode(t),s({method:"POST",url:"api/customer-employee/quickSave",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){r(function(){i.attachment=e.data.result,c.pop("success","Operación Exitosa","Registro eliminado"),i.onCloseModal()})})["catch"](function(e){o.error(e),c.pop("error","Error","Por favor ingrese los campos requeridos.")})["finally"](function(){})}}]),app.controller("ModalInstanceSideOccupationalInvestigationEmployeeListCtrl",["$rootScope","$stateParams","$scope","customer","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile",function(e,t,i,n,a,o,r,l,s,c,u,d,p,m,f){i.title="Empleados",i.employee={id:0},i.onCloseModal=function(){a.close(i.employee)},i.onCancel=function(){a.dismiss("cancel")},i.onLoadRecord=function(){if(0!=i.employee.id){var e={id:i.employee.id};s({method:"GET",url:"api/customer-employee",params:e})["catch"](function(e,t){if(403==t){var i=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";l.swal("No Autorizado","No estas autorizado para ver esta información.","error"),r(function(){$state.go(i)},3e3)}else 404==t?l.swal("Información no disponible","Diagnóstico no encontrado","error"):l.swal("Error","Se ha presentado un error al intentar acceder a la información del proceso","error")}).then(function(e){r(function(){i.employee=e.data.result})})["finally"](function(){r(function(){i.onCloseModal()},400)})}else i.loading=!1},i.dtInstanceDisabilityEmployeeList={},i.dtOptionsDisabilityEmployeeList=m.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerId=t.customerId,JSON.stringify(e)},url:"api/customer-employee-modal-basic",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){v()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,t,n){f(angular.element(e).contents())(i)}),i.dtColumnsDisabilityEmployeeList=[p.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,t,i,n){var a="",o="",r='<a class="btn btn-success btn-xs editRow lnk" href="#" uib-tooltip="Adicionar empleado" tooltip-placement="right"  data-id="'+e.id+'"'+o+' >   <i class="fa fa-plus-square"></i></a> ';return a+=r}),p.newColumn("documentNumber").withTitle("Número Identificación").withOption("width",200),p.newColumn("firstName").withTitle("Nombre").withOption("width",200),p.newColumn("lastName").withTitle("Apellidos").withOption("width",200),p.newColumn("workPlace").withTitle("Centro de Trabajo").withOption("width",200),p.newColumn("job").withTitle("Cargo").withOption("width",200),p.newColumn("neighborhood").withTitle("Centro de Costos").withOption("width",200),p.newColumn(null).withTitle("Estado").withOption("width",200).renderWith(function(e,t,i,n){var a="label label-danger",o="Inactivo";null==e.isActiveCode&&void 0==e.isActiveCode||("Activo"==e.isActiveCode?(a="label label-success",o="Activo"):(a="label label-danger",o="Inactivo"));var r='<span class="'+a+'">'+o+"</span>";return r}),p.newColumn(null).withTitle("Autorización").withOption("width",200).renderWith(function(e,t,i,n){var a="label label-danger",o="Inactivo";null==e.isAuthorized&&void 0==e.isAuthorized||("Autorizado"==e.isAuthorized?(a="label label-success",o="Autorizado"):"No Autorizado"==e.isAuthorized?(a="label label-danger",o="No Autorizado"):(a="label label-info",o="N/A"));var r='<span class="'+a+'">'+o+"</span>";return r})];var v=function(){angular.element("#dtDisabilityEmployeeList a.editRow").on("click",function(){var e=$(this).data("id");i.editDisabilityEmployee(e)})};i.dtInstanceDisabilityEmployeeListCallback=function(e){i.dtInstanceDisabilityEmployeeList=e},i.reloadData=function(){i.dtInstanceDisabilityEmployeeList.reloadData()},i.viewDisabilityEmployee=function(e){i.employee.id=e,i.isView=!0,i.onLoadRecord()},i.editDisabilityEmployee=function(e){i.employee.id=e,i.isView=!1,i.onLoadRecord()}}]),app.controller("ModalInstanceSideOccupationalInvestigationAgentCtrl",["$rootScope","$stateParams","$scope","customer","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile",function(e,t,i,n,a,o,r,l,s,c,u,d,p,m,f){i.contractTypes=e.parameters("employee_contract_type"),i.documentTypes=e.parameters("employee_document_type");var v=function(){i.employee={id:0,customerId:n.id,isActive:!0,contractType:null,job:null,workPlace:null,salary:0,entity:{id:0,documentType:null,documentNumber:"",firstName:"",lastName:"",isActive:!0}}};v();var g=function(){var e={};return e.operation="restriction",e.customerId=t.customerId,s({method:"POST",url:"api/customer/config-sgsst/workplace/listProcess",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){r(function(){i.workPlaces=e.data.data})})["catch"](function(e){})["finally"](function(){})};g();var w=function(){if(null!=i.employee.workPlace){var e={};return e.operation="restriction",e.customerId=t.customerId,e.workPlaceId=i.employee.workPlace.id,s({method:"POST",url:"api/customer/config-sgsst/job/listByWorkPlace",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){r(function(){i.jobs=e.data.data})})["catch"](function(e){})["finally"](function(){})}i.jobs=[]};i.$watch("employee.workPlace",function(){w()}),i.onCloseModal=function(){a.close(1)},i.onCancelEmployee=function(){a.dismiss("cancel")},i.form={submit:function(e){var t=null;if(e.$invalid){var n=null,t=null;for(n in e)"$"!=n[0]&&(null!==t||e[n].$valid||(t=e[n].$name),e[n].$pristine&&(e[n].$dirty=!0));return angular.element(".ng-invalid[name="+t+"]").focus(),void r(function(){c.pop("error","Error","Por favor verifique los datos requeridos del formulario y vuelva a intentarlo")},500)}i.onSaveEmployee()},reset:function(e){e.$setPristine(!0)}},i.onSaveEmployee=function(){var e={},t=JSON.stringify(i.employee);return e.data=Base64.encode(t),s({method:"POST",url:"api/customer-employee/quickSave",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){r(function(){i.attachment=e.data.result,c.pop("success","Operación Exitosa","Registro eliminado"),i.onCloseModal()})})["catch"](function(e){o.error(e),c.pop("error","Error","Por favor ingrese los campos requeridos.")})["finally"](function(){})}}]),app.controller("ModalInstanceSideOccupationalInvestigationAgentListCtrl",["$rootScope","$stateParams","$scope","customer","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile",function(e,t,i,n,a,o,r,l,s,c,u,d,p,m,f){i.title="Agentes";i.responsible={id:0},i.onCloseModal=function(){a.close(i.responsible)},i.onCancel=function(){a.dismiss("cancel")};var v=function(e,n){if(0!=e){var a={id:e,type:n,customerId:t.customerId};s({method:"GET",url:"api/customer-occupational-investigation-al-responsible/get-relation",params:a})["catch"](function(e,t){if(403==t){var i=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";l.swal("No Autorizado","No estas autorizado para ver esta información.","error"),r(function(){$state.go(i)},3e3)}else 404==t?l.swal("Información no disponible","Diagnóstico no encontrado","error"):l.swal("Error","Se ha presentado un error al intentar acceder a la información del proceso","error")}).then(function(e){r(function(){i.responsible=e.data.result})})["finally"](function(){r(function(){i.onCloseModal()},400)})}else i.loading=!1};i.dtOptionsCommonDataTableList=m.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerId=n.id,JSON.stringify(e)},url:"api/customer-occupational-investigation-al-responsible-available",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){g()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,t,n){f(angular.element(e).contents())(i)}),i.dtColumnsCommonDataTableList=[p.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,t,i,n){var a="",o="",r='<a class="btn btn-success btn-xs editRow lnk" href="#" uib-tooltip="Adicionar" tooltip-placement="right" data-type="'+e.typeCode+'"   data-id="'+e.id+'"'+o+' >   <i class="fa fa-plus-square"></i></a> ';return a+=r}),p.newColumn("type").withTitle("Tipo").withOption("width",200),p.newColumn("documentNumber").withTitle("Documento").withOption("width",200),p.newColumn("fullName").withTitle("Nombre").withOption("width",200),p.newColumn("job").withTitle("Cargo").withOption("width",200)];var g=function(){angular.element("#dtCommonDataTableList a.editRow").on("click",function(){var e=angular.element(this).data("id"),t=angular.element(this).data("type");v(e,t)})};i.dtInstanceCommonDataTableListCallback=function(e){i.dtInstanceCommonDataTableList=e},i.reloadData=function(){i.dtInstanceCommonDataTableList.reloadData()}}]),app.controller("ModalInstanceSideOccupationalInvestigationEconomicActivityListCtrl",["$rootScope","$stateParams","$scope","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile",function(e,t,i,n,a,o,r,l,s,c,u,d,p,m){i.title="ACTIVIDADES ECONÓMICAS";var f={};i.activity={id:0},i.onCloseModal=function(){n.close(i.activity)},i.onCancel=function(){n.dismiss("cancel")},i.onLoadRecord=function(){if(0!=i.activity.id){var e={id:i.activity.id};l({method:"GET",url:"api/investigation-al/economic-activity",params:e})["catch"](function(e,t){if(403==t){var i=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";r.swal("No Autorizado","No estas autorizado para ver esta información.","error"),o(function(){$state.go(i)},3e3)}else 404==t?r.swal("Información no disponible","Diagnóstico no encontrado","error"):r.swal("Error","Se ha presentado un error al intentar acceder a la información del proceso","error")}).then(function(e){o(function(){i.activity=e.data.result})})["finally"](function(){o(function(){i.onCloseModal()},400)})}else i.loading=!1},f.operation="restriction",f.data="",i.dtInstanceDisabilityEmployeeList={},i.dtOptionsDisabilityEmployeeList=p.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:f,url:"api/investigation-al/economic-activity",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){v()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,t,n){m(angular.element(e).contents())(i)}),i.dtColumnsDisabilityEmployeeList=[d.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,t,i,n){var a="",o="",r='<a class="btn btn-success btn-xs editRow lnk" href="#" uib-tooltip="Adicionar empleado" tooltip-placement="right"  data-id="'+e.id+'"'+o+' >   <i class="fa fa-plus-square"></i></a> ';return a+=r}),d.newColumn("code").withTitle("Código").withOption("width",200).withOption("defaultContent",""),d.newColumn("name").withTitle("Actividad Económica").withOption("defaultContent","")];var v=function(){angular.element("#dtDisabilityEmployeeList a.editRow").on("click",function(){var e=$(this).data("id");i.editDisabilityEmployee(e)})};i.reloadData=function(){i.dtInstanceDisabilityEmployeeList.reloadData()},i.viewDisabilityEmployee=function(e){i.activity.id=e,i.isView=!0,i.onLoadRecord()},i.editDisabilityEmployee=function(e){i.activity.id=e,i.isView=!1,i.onLoadRecord()}}]),app.controller("ModalInstanceSideOccupationalInvestigationCauseListCtrl",["$rootScope","$stateParams","$scope","target","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile",function(e,t,i,n,a,o,r,l,s,c,u,d,p,m,f){switch(i.title="CAUSAS",n){case"CIAI":i.title="CAUSAS INMEDIATAS - ACTOS INSEGUROS";break;case"CICI":i.title="CAUSAS INMEDIATAS - CONDICIONES INSEGURAS";break;case"CBFT":i.title="CAUSAS BASICAS - FACTORES DEL TRABAJO";break;case"CBFP":i.title="CAUSAS BASICAS - FACTORES PERSONALES"}var v={};i.cause={id:0},i.onCloseModal=function(){a.close(i.cause)},i.onCancel=function(){a.dismiss("cancel")},i.onLoadRecord=function(){if(0!=i.cause.id){var e={id:i.cause.id};s({method:"GET",url:"api/investigation-al/cause",params:e})["catch"](function(e,t){if(403==t){var i=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";l.swal("No Autorizado","No estas autorizado para ver esta información.","error"),r(function(){$state.go(i)},3e3)}else 404==t?l.swal("Información no disponible","Diagnóstico no encontrado","error"):l.swal("Error","Se ha presentado un error al intentar acceder a la información del proceso","error")}).then(function(e){r(function(){i.cause=e.data.result})})["finally"](function(){r(function(){i.onCloseModal()},400)})}else i.loading=!1},v.operation="restriction",v.investigation_cause_category=n,v.data="",i.dtInstanceDisabilityEmployeeList={},i.dtOptionsDisabilityEmployeeList=m.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:v,url:"api/investigation-al/cause",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){g()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,t,n){f(angular.element(e).contents())(i)}),i.dtColumnsDisabilityEmployeeList=[p.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,t,i,n){var a="",o="",r='<a class="btn btn-success btn-xs editRow lnk" href="#" uib-tooltip="Adicionar empleado" tooltip-placement="right"  data-id="'+e.id+'"'+o+' >   <i class="fa fa-plus-square"></i></a> ';return a+=r}),p.newColumn("parent.name").withTitle("Padre").withOption("defaultContent",""),p.newColumn("code").withTitle("Código").withOption("width",200).withOption("defaultContent",""),p.newColumn("name").withTitle("Causa").withOption("defaultContent","")];var g=function(){angular.element("#dtDisabilityEmployeeList a.editRow").on("click",function(){var e=$(this).data("id");i.editDisabilityEmployee(e)})};i.reloadData=function(){i.dtInstanceDisabilityEmployeeList.reloadData()},i.viewDisabilityEmployee=function(e){i.cause.id=e,i.isView=!0,i.onLoadRecord()},i.editDisabilityEmployee=function(e){i.cause.id=e,i.isView=!1,i.onLoadRecord()}}]),app.controller("ModalInstanceSideOccupationalInvestigationReportListCtrl",["$rootScope","$stateParams","$scope","customer","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile",function(e,t,i,n,a,o,r,l,s,c,u,d,p,m,f){i.title="REPORTES AT",i.report={id:0},i.onCloseModal=function(){a.close(i.report)},i.onCancel=function(){a.dismiss("cancel")},i.onLoadRecord=function(){if(0!=i.report.id){var e={id:i.report.id};s({method:"GET",url:"api/occupational-report",params:e})["catch"](function(e,t){if(403==t){var i=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";l.swal("No Autorizado","No estas autorizado para ver esta información.","error"),r(function(){$state.go(i)},3e3)}else 404==t?l.swal("Información no disponible","Diagnóstico no encontrado","error"):l.swal("Error","Se ha presentado un error al intentar acceder a la información del proceso","error")}).then(function(e){r(function(){i.report=e.data.result})})["finally"](function(){r(function(){i.onCloseModal()},400)})}else i.loading=!1};var v={};v.operation="restriction",v.customer_id=n.id,v.data="",i.dtInstanceDisabilityEmployeeList={},i.dtOptionsDisabilityEmployeeList=m.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:v,url:"api/occupational-report",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){g()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,t,n){f(angular.element(e).contents())(i)}),i.dtColumnsDisabilityEmployeeList=[p.newColumn(null).withTitle("Acciones").withOption("width",100).notSortable().renderWith(function(e,t,i,n){var a="",o="",r='<a class="btn btn-success btn-xs editRow lnk" href="#" uib-tooltip="Adicionar reporte"  data-id="'+e.id+'"'+o+' >   <i class="fa fa-plus-square"></i></a> ';return a+=r}),p.newColumn("documentType").withTitle("Tipo de Identificación").withOption("width",200),p.newColumn("documentNumber").withTitle("Número de Identificación").withOption("width",200),p.newColumn("firstName").withTitle("Nombre"),p.newColumn("lastName").withTitle("Apellidos"),p.newColumn("accidentDate").withTitle("Fecha Accidente").withOption("width",150),p.newColumn("status").withTitle("Estado").withOption("width",100).renderWith(function(e,t,i,n){
var a="";switch(e){case"abierto":a="label label-success";break;case"Cancelado":a="label label-danger";break;case"Retirado":a="label label-warning"}var o='<span class="'+a+'">'+e+"</span>";return o})];var g=function(){angular.element("#dtDisabilityEmployeeList a.editRow").on("click",function(){var e=$(this).data("id");i.editDisabilityEmployee(e)})};i.reloadData=function(){i.dtInstanceDisabilityEmployeeList.reloadData()},i.viewDisabilityEmployee=function(e){i.report.id=e,i.isView=!0,i.onLoadRecord()},i.editDisabilityEmployee=function(e){i.report.id=e,i.isView=!1,i.onLoadRecord()}}]);
"use strict";app.controller("customerOccupationalInvestigationListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","SweetAlert","$http","$filter","$document","$aside",function(t,n,e,o,i,a,r,l,c,s,u,d,p,m,w,f){var h=e,v={};v.operation="tracking",v.customer_id=n.customerId,t.agents=s.agents(),t.dtOptionsOccupationalInvestigationAL=o.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.customerId=n.customerId,JSON.stringify(t)},url:"api/customer-occupational-investigation-al",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){g()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(n,e,o){r(angular.element(n).contents())(t)}),t.dtColumnsOccupationalInvestigationAL=[i.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,n,e,o){var i="",a='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Iniciar investigación" data-id="'+t.id+'" >   <i class="fa fa-play"></i></a> ',r='<a class="btn btn-info btn-xs viewRow lnk" href="#" uib-tooltip="Consultar investigación" data-id="'+t.id+'" >   <i class="fa fa-eye"></i></a> ',l='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Anular investigación" data-id="'+t.id+'" >   <i class="fa fa-trash-o"></i></a> ',c='<a class="btn btn-success btn-xs downloadRow lnk" href="#" uib-tooltip="Descarcar Reporte" data-id="'+t.id+'" >   <i class="fa fa-download"></i></a> ',u='<a class="btn btn-dark-azure btn-xs reOpenRow lnk" href="#" uib-tooltip="Reabrir Investigación" data-id="'+t.id+'" >   <i class="fa fa-refresh"></i></a> ',d=('<a class="btn btn-light-purple btn-xs downloadDocumentRow lnk" href="#" uib-tooltip="Descarcar archivos" data-id="'+t.id+'" >   <i class="fa fa-cloud-download "></i></a> ','<a class="btn btn-success btn-xs documentRow lnk" href="#" uib-tooltip="Anexos" data-id="'+t.id+'" >   <i class="fa fa-paperclip"></i></a> ');return s.can("seguimiento_edit")&&"open"==t.statusCode&&(i+=a),s.can("seguimiento_delete")&&"open"==t.statusCode&&(i+=l),s.can("seguimiento_edit")&&"close"==t.statusCode&&(i+=r),s.can("cliente_investigacion_at_reopen")&&"close"==t.statusCode&&(i+=u),i+=c,i+=d}),i.newColumn("id").withTitle("Consecutivo").withOption("width",100).withOption("defaultContent",""),i.newColumn("accidentDate").withTitle("Fecha / Hora").withOption("width",150).withOption("defaultContent",""),i.newColumn("accidentType").withTitle("Tipo Accidente").withOption("width",150).withOption("defaultContent",""),i.newColumn("businessName").withTitle("Cliente").withOption("width",200).withOption("defaultContent",""),i.newColumn("documentType").withTitle("Tipo Identificación Empleado").withOption("width",200).withOption("defaultContent",""),i.newColumn("documentNumber").withTitle("Nro Identificación Empleado").withOption("width",200).withOption("defaultContent",""),i.newColumn("fullName").withTitle("Nombre Empleado").withOption("width",200).withOption("defaultContent",""),i.newColumn("job").withTitle("Cargo Empleado").withOption("width",200).withOption("defaultContent",""),i.newColumn(null).withTitle("Estado").withOption("width",100).renderWith(function(t,n,e,o){var i="",a=t.status;switch(t.statusCode){case"open":i="label label-success";break;case"close":i="label label-danger"}var r='<span class="'+i+'">'+a+"</span>";return r})];var g=function(){$("#dtOccupationalInvestigationAL a.editRow").on("click",function(){var n=$(this).data("id");t.onEditReportAL(n)}),$("#dtOccupationalInvestigationAL a.downloadRow").on("click",function(){var t=$(this).data("id");angular.element("#downloadDocument")[0].src="api/customer-occupational-investigation-al/export-pdf?id="+t}),$("#dtOccupationalInvestigationAL a.viewRow").on("click",function(){var n=$(this).data("id");t.onViewReportAL(n)}),$("#dtOccupationalInvestigationAL a.reOpenRow").on("click",function(){var n=$(this).data("id");t.onReOpenReportAL(n)}),angular.element("#dtOccupationalInvestigationAL a.documentRow").on("click",function(){var n=angular.element(this).data("id");t.onAddAttachment(n)}),$("#dtOccupationalInvestigationAL a.delRow").on("click",function(){var n=$(this).data("id");h.info("intenta eliminar el registro: "+n),d.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(o){if(o){var i={};i.id=n,p({method:"POST",url:"api/customer-occupational-investigation-al/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){e.error(t),d.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){t.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};t.dtInstanceOccupationalInvestigationALCallback=function(n){t.dtInstanceOccupationalInvestigationAL=n},t.reloadData=function(){t.dtInstanceOccupationalInvestigationAL.reloadData()},t.onCreateReportAL=function(n){null!=t.$parent&&t.$parent.navToSection("form","edit",0)},t.onEditReportAL=function(n){null!=t.$parent&&t.$parent.navToSection("form","edit",n)},t.onViewReportAL=function(n){null!=t.$parent&&t.$parent.navToSection("form","view",n)},t.onReOpenReportAL=function(n){d.swal({title:"Está seguro?",text:"La investigación seleccionada pasará a estado Abierta.",type:"info",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, reabrir!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(o){if(o){var i={};i.id=n,p({method:"POST",url:"api/customer-occupational-investigation-al/re-open",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(t){swal("Cambio de estado","Registro actualizado satisfactoriamente","info")})["catch"](function(t){e.error(t),d.swal("Error en el cambio de estado","Se ha presentado un error durante la actualización del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){t.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})},t.onViewReportAnalysis=function(n){null!=t.$parent&&t.$parent.navToSection("analysis","analysis",0)},t.onAddAttachment=function(n){var o=f.open({templateUrl:s.app.views.urlRoot+"modules/customer/occupational/investigation/customer_occupational_investigation_al_document_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideCustomerOccupationalInvestigationALAttachmentCtrl",scope:t,resolve:{dataItem:function(){return{id:n}},isView:function(){return"view"==t.$parent.editMode}}});o.result.then(function(){t.reloadData()},function(){t.reloadData(),e.info("Modal dismissed at: "+new Date)})},t.onDownloadAttachment=function(){var n=$uibModal.open({templateUrl:s.app.views.urlRoot+"modules/common/modals/document_filter_modal.htm",controller:"ModalInstanceSideCustomerOccupationalInvestigationALDownloadAttachmentCtrl",windowTopClass:"top-modal",resolve:{improvement:function(){return{id:0}},title:function(){return"Descargar anexos de seguimiento"},action:function(){return"Cancelar"}}});n.result.then(function(){t.reloadData()},function(){})}}]),app.controller("ModalInstanceSideCustomerOccupationalInvestigationALAttachmentCtrl",["$stateParams","$rootScope","$scope","$uibModalInstance","dataItem","isView","$log","$timeout","SweetAlert","$filter","FileUploader","$http","DTColumnBuilder","DTOptionsBuilder","$compile","ListService",function(t,n,e,o,i,a,r,l,c,s,u,d,p,m,w,f){function h(){var n=[{name:"customer_document_type",value:t.customerId}];f.getDataList(n).then(function(t){e.documentType=t.data.data.customerDocumentType},function(t){e.status="Unable to load customer data: "+t.message})}var v=0,g="M",C=n.isCustomer();e.isView=!C&&a,e.documentClassification=n.parameters("customer_document_classification"),e.documentStatus=n.parameters("customer_document_status"),h();var O=function(){e.attachment={id:0,customerOccupationalInvestigationId:i.id,type:null,classification:null,description:"",status:e.documentStatus?e.documentStatus[0]:null,version:1,label:g}};O(),e.onCloseModal=function(){o.close(1)},e.onCancel=function(){o.dismiss("cancel")},e.onClear=function(){O()};var b=e.uploader=new u({url:"api/customer-occupational-investigation-document/upload",formData:[],removeAfterUpload:!0});b.filters.push({name:"customFilter",fn:function(t,n){return this.queue.length<10}}),b.onBeforeUploadItem=function(t){var n={id:v};t.formData.push(n)},b.onCompleteAll=function(){e.reloadData(),e.onClear()},e.form={submit:function(t){var n=null;if(t.$invalid){var e=null,n=null;for(e in t)"$"!=e[0]&&(null!==n||t[e].$valid||(n=t[e].$name),t[e].$pristine&&(t[e].$dirty=!0));return angular.element(".ng-invalid[name="+n+"]").focus(),void c.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}c.swal("Validación exitosa","Procediendo con el guardado...","success"),T()},reset:function(t){t.$setPristine(!0)}};var T=function(){g=e.attachment.label;var t={},n=JSON.stringify(e.attachment);return t.data=Base64.encode(n),d({method:"POST",url:"api/customer-occupational-investigation-document/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){l(function(){b.queue.length>0?(v=t.data.result.id,b.uploadAll()):(e.reloadData(),e.onClear())})})["catch"](function(t){c.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){e.reloadData()})};e.dtOptionsCustomerDocumentModal=m.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.customerOccupationalInvestigationId=i.id,t.statusCode="2",JSON.stringify(t)},url:"api/customer-occupational-investigation-document",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){D()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,n,o){w(angular.element(t).contents())(e)}),e.dtColumnsCustomerDocumentModal=[p.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,e,o,i){var a=t.documentUrl?t.documentUrl:"",r="api/customer-occupational-investigation-document/download?id="+t.id,l="",c='<a target="_self" class="btn btn-primary btn-xs downloadDocumentRow lnk" href="'+r+'" uib-tooltip="Descargar anexo" data-id="'+t.id+'" >   <i class="fa fa-download"></i></a> ',s='<a class="btn btn-info btn-xs openDocumentRow lnk" target="_blank" href="'+a+'" uib-tooltip="Abrir anexo" data-id="'+t.id+'" >   <i class="fa fa-folder-open-o"></i></a> ',u=!1;return null==t.protectionType?u=!0:"public"==t.protectionType?u=!0:"private"==t.protectionType&&1==t.hasPermission&&(u=!0),n.can("clientes_anexo_open")&&""!=a&&(l+=s),n.can("clientes_anexo_download")&&""!=a&&(l+=c),u?l:""}),p.newColumn("documentType").withTitle("Tipo de documento").withOption("width",200),p.newColumn("classification").withTitle("Clasificación").withOption("width",200),p.newColumn("description").withTitle("Descripción").withOption("width",200),p.newColumn("version").withTitle("Versión").withOption("width",200),p.newColumn("createdAt").withTitle("Fecha Creación").withOption("width",200).withOption("defaultContent",""),p.newColumn("status").withTitle("Estado").withOption("width",200).renderWith(function(t,n,e,o){var i="";switch(t){case"Vigente":i="label label-success";break;case"Anulado":i="label label-danger"}var a='<span class="'+i+'">'+t+"</span>";return a}),p.newColumn("label").withTitle("Origen").withOption("width",200).withOption("defaultContent","")];var D=function(){$("#dtCustomerDocumentModal a.editRow").on("click",function(){var t=$(this).data("id"),n=$(this).data("url");""==n?c.swal("Error en la descarga","No existe un anexo para descargar","error"):jQuery("#downloadDocument")[0].src="api/customer-occupational-investigation-document/download?id="+t})};e.dtInstanceCustomerDocumentModalCallback=function(t){e.dtInstanceCustomerDocumentModal=t},e.reloadData=function(){e.dtInstanceCustomerDocumentModal.reloadData()},e.dtOptionsCustomerMinimunStandardItemDocumentModal=m.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(n){return n.customerId=t.customerId,n.roadSafetyItemId=i.roadSafetyItemId,n.customerId=t.customerId,n.statusCode="2",JSON.stringify(n)},url:"api/customer-occupational-investigation-document-available-previous",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){y()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,n,o){w(angular.element(t).contents())(e)}),e.dtColumnsCustomerMinimunStandardItemDocumentModal=[p.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,e,o,i){var a=t.documentUrl?t.documentUrl:"",r=("api/customer-occupational-investigation-document/download?id="+t.id,""),l='<a class="btn btn-success btn-xs addRow lnk" uib-tooltip="Adicionar" data-id="'+t.id+'" >   <i class="fa fa-plus"></i></a> ',c=!1;return null==t.protectionType?c=!0:"public"==t.protectionType?c=!0:"private"==t.protectionType&&1==t.hasPermission&&(c=!0),n.can("clientes_anexo_open")&&""!=a&&(r+=l),c?r:""}),p.newColumn("period").withTitle("Periodo").withOption("width",200),p.newColumn("documentType").withTitle("Tipo de documento").withOption("width",200),p.newColumn("classification").withTitle("Clasificación").withOption("width",200),p.newColumn("description").withTitle("Descripción").withOption("width",200),p.newColumn("version").withTitle("Versión").withOption("width",200),p.newColumn("createdAt").withTitle("Fecha Creación").withOption("width",200).withOption("defaultContent",""),p.newColumn("status").withTitle("Estado").withOption("width",200).renderWith(function(t,n,e,o){var i="";switch(t){case"Vigente":i="label label-success";break;case"Anulado":i="label label-danger"}var a='<span class="'+i+'">'+t+"</span>";return a})];var y=function(){$("#dtCustomerMinimunStandardItemDocumentModal a.addRow").on("click",function(){var t=$(this).data("id");I(t)})};e.dtInstanceCustomerMinimunStandardItemDocumentModalCallback=function(t){e.dtInstanceCustomerMinimunStandardItemDocumentModal=t},e.reloadHistoricalData=function(){e.dtInstanceCustomerMinimunStandardItemDocumentModal.reloadData()};var I=function(t){g=e.attachment.label;var n=JSON.stringify({id:t,customerOccupationalInvestigationId:i.id});return d({method:"POST",url:"api/customer-occupational-investigation-document/import-historical",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param({data:Base64.encode(n)})}).then(function(t){l(function(){O(),e.reloadHistoricalData(),e.reloadData()})})["catch"](function(t){c.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})}}]),app.controller("ModalInstanceSideCustomerOccupationalInvestigationALDownloadAttachmentCtrl",["$rootScope","$stateParams","$scope","$uibModal","$uibModalInstance","improvement","title","$log","$timeout","SweetAlert","$http","toaster","$filter","$aside","$document","DTColumnBuilder","DTOptionsBuilder","$compile","ListService","ngNotify",function(t,n,e,o,i,a,r,l,c,s,u,d,p,m,w,f,h,v,g,C){function O(){var t=e.filter.year?e.filter.year.value:null,o=[{name:"customer_document_type",value:n.customerId},{name:"customer_tracking_document_periods",value:n.customerId,year:t}];g.getDataList(o).then(function(t){e.documentType=t.data.data.customerDocumentType,e.years=t.data.data.customerTrackingDocumentPeriod.years,e.months=t.data.data.customerTrackingDocumentPeriod.months},function(t){e.status="Unable to load customer data: "+t.message})}e.loading=!0,e.title=r,e.onCloseModal=function(){i.close(1)},e.onCancel=function(){i.dismiss("cancel")},e.onSelectYear=function(){O()};var b=function(){e.filter={id:n.customerId}};b(),O(),e.form={submit:function(t){var n=null;if(t.$invalid){var o=null,n=null;for(o in t)"$"!=o[0]&&(null!==n||t[o].$valid||(n=t[o].$name),t[o].$pristine&&(t[o].$dirty=!0));return angular.element(".ng-invalid[name="+n+"]").focus(),void s.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}return e.filter.type||e.filter.year||e.filter.month?void T():void s.swal("El formulario contiene errores!","Por favor seleccione al menos un filtro e intentelo nuevamente.","error")},reset:function(t){}};var T=function(){C.set("El archivo se está generando.",{position:"bottom",sticky:!0,button:!1,html:!0});var t={customerId:n.customerId,audit:e.filter},o={},i=JSON.stringify(t);o.data=Base64.encode(i),u({method:"POST",url:"api/customer-occupational-investigation-document/export",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(t){var n=(t.data.path+t.data.filename,'<div class="row"> <div class="col-sm-12 text-center">Por favor espere y verifique su correo y la bandeja de mensajes!</div> </div>');C.set(n,{position:"bottom",sticky:!0,type:"success",button:!0,html:!0}),e.onCloseModal()})["catch"](function(t){C.set(t.data.message,{position:"bottom",sticky:!0,type:"error",button:!0,html:!0})})["finally"](function(){})}}]);
"use strict";app.controller("customerOccupationalInvestigationPreviewCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","SweetAlert","$http","$filter","$document",function(e,t,n,o,r,i,a,c,l,p,s,u,$,d,m){e.agents=p.agents(),e.isView="view"==e.$parent.modeDsp||"view"==e.$parent.editMode,e.currentURL="api/customer-occupational-investigation-al/stream-pdf?id="+e.$parent.currentId+"&rnd="+Math.random(),e.onCancel=function(t){null!=e.$parent&&(console.log("onCancel preview!!"),e.$parent.navToSection("form",e.isView?"view":"edit",e.$parent.currentId))}}]);
"use strict";app.controller("customerOccupationalReportIncidentAnalysisCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$document","$filter","ChartService",function(t,n,a,e,i,o,r,d,c,u,l,p,m,h,w,s){function O(){var a={customerId:n.customerId,year:t.filter.selectedYear?t.filter.selectedYear.value:0},e=[{name:"chart_bar_options",criteria:null},{name:"chart_doughnut_options",criteria:null},{name:"customer_occupational_report_incident",criteria:a}];s.getDataChart(e).then(function(n){t.chart.bar.options=n.data.data.chartBarOptions,t.chart.doughnut.options=n.data.data.chartLineOptions,t.chart.bar.options.legend.position="bottom",t.chart.accidentType.data=n.data.data.customerOccupationalReportAccidentType,t.chart.deathCause.data=n.data.data.customerOccupationalReportDeathCause,t.chart.location.data=n.data.data.customerOccupationalReportLocation,t.chart.link.data=n.data.data.customerOccupationalReportLink,t.chart.workTime.data=n.data.data.customerOccupationalReportWorkTime,t.chart.weekDay.data=n.data.data.customerOccupationalReportWeekDay,t.chart.place.data=n.data.data.customerOccupationalReportPlace,t.chart.injury.data=n.data.data.customerOccupationalReportInjury,t.chart.body.data=n.data.data.customerOccupationalReportBody,t.chart.factor.data=n.data.data.customerOccupationalReportFactor,t.chart.status.data=n.data.data.customerOccupationalReportStatus},function(n){t.status="Unable to load customer data: "+n.message})}t.chart={bar:{options:null},doughnut:{options:null},accidentType:{data:null},deathCause:{data:null},location:{data:null},link:{data:null},workTime:{data:null},weekDay:{data:null},place:{data:null},injury:{data:null},body:{data:null},factor:{data:null},status:{data:null}},t.request={},t.audit={},t.audit.operation="info",t.audit.customerId=n.customerId,t.audit.year=0,t.filter={selectedYear:null},t.years=[];var f=function(){var e={};e.customer_id=n.customerId,e.year=t.audit.year,p({method:"POST",url:"api/occupational-report-incident/monthly-filter",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(n){t.years=n.data.data,t.years.length>0&&(t.filter.selectedYear=t.years[0],t.audit.year=t.filter.selectedYear.value,t.request.data=Base64.encode(JSON.stringify(t.audit)),t.reloadData(),t.reloadIndicatorData(),O())})["catch"](function(t){a.error(t),m.swal("Error Cargando Reportes","Se ha presentado un error durante la consulta de los reportes para el diagnóstico por favor intentelo de nuevo","error")})["finally"](function(){})};f(),t.request.data=Base64.encode(JSON.stringify(t.audit)),t.dtInstanceReportIncidentSummaryProgram={},t.dtOptionsReportIncidentSummaryProgram=e.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:t.request,url:"api/occupational-report-incident/summary-lesion",type:"POST",beforeSend:function(){},complete:function(t){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withDOM("tr").withOption("language",{}).withOption("createdRow",function(n,a,e){r(angular.element(n).contents())(t)}),t.dtColumnsReportIncidentSummaryProgram=[i.newColumn("name").withTitle("Lesión").withOption("width",400),i.newColumn("ENE").withTitle("ENE").withOption("width",200),i.newColumn("FEB").withTitle("FEB").withOption("width",200),i.newColumn("MAR").withTitle("MAR").withOption("width",200),i.newColumn("ABR").withTitle("ABR").withOption("width",200),i.newColumn("MAY").withTitle("MAY").withOption("width",200),i.newColumn("JUN").withTitle("JUN").withOption("width",200),i.newColumn("JUL").withTitle("JUL").withOption("width",200),i.newColumn("AGO").withTitle("AGO").withOption("width",200),i.newColumn("SEP").withTitle("SEP").withOption("width",200),i.newColumn("OCT").withTitle("OCT").withOption("width",200),i.newColumn("NOV").withTitle("NOV").withOption("width",200),i.newColumn("DIC").withTitle("DIC").withOption("width",200)],t.dtInstanceReportIncidentSummaryIndicator={},t.dtOptionsReportIncidentSummaryIndicator=e.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:t.request,url:"api/occupational-report-incident/summary-indicator",type:"POST",beforeSend:function(){},complete:function(t){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withDOM("tr").withOption("language",{}).withOption("createdRow",function(n,a,e){r(angular.element(n).contents())(t)}),t.dtColumnsReportIncidentSummaryIndicator=[i.newColumn("indicator").withTitle("Indicador").withOption("width",400),i.newColumn(null).withTitle("ENE").withOption("width",200).renderWith(function(t,n,a,e){return"Promedio Total %"!=t.indicator?y(t.ENE):t.ENE}),i.newColumn(null).withTitle("FEB").withOption("width",200).renderWith(function(t,n,a,e){return"Promedio Total %"!=t.indicator?y(t.FEB):t.FEB}),i.newColumn(null).withTitle("MAR").withOption("width",200).renderWith(function(t,n,a,e){return"Promedio Total %"!=t.indicator?y(t.MAR):t.MAR}),i.newColumn(null).withTitle("ABR").withOption("width",200).renderWith(function(t,n,a,e){return"Promedio Total %"!=t.indicator?y(t.ABR):t.ABR}),i.newColumn(null).withTitle("MAY").withOption("width",200).renderWith(function(t,n,a,e){return"Promedio Total %"!=t.indicator?y(t.MAY):t.MAY}),i.newColumn(null).withTitle("JUN").withOption("width",200).renderWith(function(t,n,a,e){return"Promedio Total %"!=t.indicator?y(t.JUN):t.JUN}),i.newColumn(null).withTitle("JUL").withOption("width",200).renderWith(function(t,n,a,e){return"Promedio Total %"!=t.indicator?y(t.JUL):t.JUL}),i.newColumn(null).withTitle("AGO").withOption("width",200).renderWith(function(t,n,a,e){return"Promedio Total %"!=t.indicator?y(t.AGO):t.AGO}),i.newColumn(null).withTitle("SEP").withOption("width",200).renderWith(function(t,n,a,e){return"Promedio Total %"!=t.indicator?y(t.SEP):t.SEP}),i.newColumn(null).withTitle("OCT").withOption("width",200).renderWith(function(t,n,a,e){return"Promedio Total %"!=t.indicator?y(t.OCT):t.OCT}),i.newColumn(null).withTitle("NOV").withOption("width",200).renderWith(function(t,n,a,e){return"Promedio Total %"!=t.indicator?y(t.NOV):t.NOV}),i.newColumn(null).withTitle("DIC").withOption("width",200).renderWith(function(t,n,a,e){return"Promedio Total %"!=t.indicator?y(t.DIC):t.DIC})];var y=function(t){return null!=t?parseInt(t):""};t.dtInstanceReportIncidentSummaryProgramCallback=function(n){t.dtInstanceReportIncidentSummaryProgram=n},t.reloadData=function(){},t.dtInstanceReportIncidentSummaryIndicatorCallback=function(n){t.dtInstanceReportIncidentSummaryIndicator=n},t.reloadIndicatorData=function(){},t.cancelEdition=function(n){null!=t.$parent&&t.$parent.navToSection("list","list",0)},t.changeYear=function(a,e){l(function(){t.audit.operation="info",t.audit.customerId=n.customerId,t.audit.year=a.value,t.request.data=Base64.encode(JSON.stringify(t.audit)),t.reloadData(),t.reloadIndicatorData(),O()})},t.clearYear=function(){l(function(){t.audit.operation="info",t.audit.customerId=n.customerId,t.audit.year=0,t.request.data=Base64.encode(JSON.stringify(t.audit)),t.filter.selectedYear=null,t.reloadData(),t.reloadIndicatorData(),O()})},t.onSummaryByProgramExportExcel=function(){jQuery("#downloadDocument")[0].src="api/occupational-report-incident/summary-lesion/export?data="+Base64.encode(JSON.stringify(t.audit))},t.onSummaryByProgramExportPdf=function(){kendo.drawing.drawDOM($(".export-pdf-program")).then(function(t){return kendo.drawing.exportPDF(t,{paperSize:"auto",margin:{left:"1cm",top:"1cm",right:"1cm",bottom:"1cm"}})}).done(function(t){kendo.saveAs({dataURI:t,fileName:"Reporte Mensual Programas Empresariales.pdf",proxyURL:"//demos.telerik.com/kendo-ui/service/export"})})},t.onSummaryByIndicatorExportExcel=function(){jQuery("#downloadDocument")[0].src="api/management/summary-indicator/export?data="+Base64.encode(JSON.stringify(t.audit))},t.onSummaryByIndicatorExportPdf=function(){kendo.drawing.drawDOM($(".export-pdf-indicator")).then(function(t){return kendo.drawing.exportPDF(t,{paperSize:"auto",margin:{left:"1cm",top:"1cm",right:"1cm",bottom:"1cm"}})}).done(function(t){kendo.saveAs({dataURI:t,fileName:"Reporte Mensual Indicadores Programas Empresariales.pdf",proxyURL:"//demos.telerik.com/kendo-ui/service/export"})})}}]);
"use strict";app.controller("customerOccupationalReportIncidentCtrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout",function(t,o,c,e,n,r){var i=c;i.info("loading..customerOccupationalReportIncidentCtrl!!! "),t.tracking_section="list",t.currentReport=0,t.modeDsp="edit",t.navToSection=function(o,c,e){r(function(){t.tracking_section=o,t.modeDsp=c,t.$parent.switchSubTab(c),t.currentReport=e})}}]);
"use strict";app.controller("customerOccupationalReportIncidentEditCtrl",["$scope","$stateParams","$log","$compile","$state","SweetAlert","$rootScope","$http","$timeout","$uibModal","flowFactory","cfpLoadingBar","$filter","$aside","toaster",function(e,t,r,o,n,a,i,c,l,s,p,u,m,d,f){var h=r,y=e.$parent.currentTraking;e.currentStep=0,e.isAgent="agent"==i.currentUser().wg_type,e.isAdmin="system"==i.currentUser().wg_type,e.isCustomer="customerAdmin"==i.currentUser().wg_type||"customerUser"==i.currentUser().wg_type,e.reloadEmployee=!0,e.isView="view"==e.$parent.modeDsp,e.minDateCurrent=new Date,e.customerId=t.customerId,e.users=[],e.employees=[],e.conditionalList=[{item:"Si",value:1},{item:"No",value:0}],h.info("loading..customerOccupationalReportIncidentEditCtrl.js con el id de tracking: ",y),e.eps=i.parameters("eps"),e.afp=i.parameters("afp"),e.arl=i.parameters("arl"),e.employment_relationship=i.parameters("wg_report_employment_relationship"),e.document_type=i.parameters("tipodoc"),e.zone=i.parameters("wg_report_zone"),e.economic_activity=i.parameters("wg_economic_activity"),e.type_linkage=i.parameters("wg_type_linkage"),e.gender=i.parameters("gender"),e.report_regular_work=i.parameters("wg_report_regular_work"),e.report_week_day=i.parameters("wg_report_week_day"),e.report_working_day=i.parameters("wg_report_working_day"),e.report_accident_type=i.parameters("wg_report_accident_type"),e.report_location=i.parameters("wg_report_location"),e.report_place=i.parameters("wg_report_place"),e.report_lesion_type=i.parameters("wg_report_lesion_type"),e.report_body_part=i.parameters("wg_report_body_part"),e.report_factor=i.parameters("wg_report_factor"),e.report_mechanism=i.parameters("wg_report_mechanism"),e.states=[],e.cities=[],e.report={id:0,customerId:t.customerId,employeeId:0,typeLinkage:null,firstLastName:"",secondLastName:"",firstName:"",secondName:"",documentType:null,documentNumber:"",birthDate:null,gender:null,address:null,telephone:null,fax:null,state:null,city:null,zone:null,job:null,occupation:null,occupationTimeDay:"",occupationTimeMonth:"",startDate:null,salary:"",workingDay:null,eps:null,arl:null,isAfp:null,afp:null,customerEmploymentRelationship:null,customerEconomicActivity:null,customerBusinessName:"",customerDocumentType:null,customerDocumentNumber:"",customerAddress:"",customerEmail:"",customerTelephone:"",customerFax:"",customerState:null,customerCity:null,customerZone:null,isCustomerBranchName:null,customerBranchEconomicActivity:null,customerBranchAddress:"",customerBranchTelephone:"",customerBranchFax:"",customerBranchState:null,customerBranchCity:null,accidentDate:null,accidentWeekDay:null,accidentWorkingDay:null,accidentRegularWork:null,accidentRegularWorkText:null,accidentWorkTime:null,accidentType:null,accidentDeathCause:null,accidentState:null,accidentCity:null,accidentZone:null,accidentLocation:null,accidentPlace:null,accidentLesionDescription:"",accidentBodyPartDescription:"",accidentMechanismDescription:"",isAnotherFactor:!1,anotherFactorDescription:"",accidentDescription:"",isAccidentWitness:null,date:null,responsibleName:"",responsibleDocumentType:null,responsibleDocumentNumber:"",responsibleDocumentJob:"",status:"A",witnesses:[{id:0,name:"",documentType:null,documentNumber:0,job:""},{id:0,name:"",documentType:null,documentNumber:0,job:""}],lesions:[],bodies:[],factors:[],mechanisms:[]};var w=function(){if(null!=e.report.job){var t={};return t.operation="diagnostic",t.customerId=e.customerId,t.jobId=e.report.job.id,c({method:"POST",url:"api/customer/config-sgsst/job-activity/list",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){l(function(){e.employee_occupation=t.data.data})})["catch"](function(e){})["finally"](function(){})}e.employee_occupation=[]},g=function(){var t={};return t.operation="diagnostic",t.customer_id=e.customerId,c({method:"POST",url:"api/customer/config-sgsst/job-activity/listBy",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){l(function(){e.report_regular_task=t.data.data})})["catch"](function(e){})["finally"](function(){})};g(),e.$watch("report.job",function(){w()}),e.$watch("report.accidentDate",function(){v()});var v=function(){l(function(){if(null!=e.report.accidentDate){var t=["Domingo","Lunes","Martes","Miercoles","Jueves","Viernes","Sabado"],r=e.report.accidentDate.getDay(),o={item:t[r],value:r};e.report.accidentWeekDay=o}},400)};e.cancelEdition=function(t){e.isView?null!=e.$parent&&e.$parent.navToSection("list","list"):a.swal({title:"Está seguro?",text:"Perderá todos los cambios realizados en este formulario.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, cancelar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(t){t?l(function(){null!=e.$parent&&e.$parent.navToSection("list","list")}):swal("Cancelación","La operación ha sido cancelada","error")})};var b=function(e){var t=[];return angular.forEach(e,function(e){var r={id:0,customerOccupationalReportAlId:0,itemId:e.value,description:e.item,isActive:!1};t.push(r)}),t},_=function(t){if(t){var r={id:t};c({method:"GET",url:"api/occupational-report-incident",params:r})["catch"](function(e,t){if(403==t){var r=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";a.swal("No Autorizado","No estas autorizado para ver esta información.","error"),l(function(){n.go(r)},3e3)}else 404==t?l(function(){}):a.swal("Error","Se ha presentado un error al intentar acceder a la información del seguimiento","error")}).then(function(t){e.reloadEmployee=!1,l(function(){e.report=t.data.result,D(),e.report.lesions=B(e.report.lesions),e.report.bodies=B(e.report.bodies),e.report.factors=B(e.report.factors),e.report.mechanisms=B(e.report.mechanisms),e.changeState(e.report.state),e.changeCustomerState(e.report.customerState),e.changeCustomerBranchState(e.report.customerBranchState),e.changeAccidentState(e.report.accidentState)}),l(function(){e.reloadEmployee=!0},100)})["finally"](function(){l(function(){e.loading=!1},400)})}else e.report.lesions=b(e.report_lesion_type),e.report.bodies=b(e.report_body_part),e.report.factors=b(e.report_factor),e.report.mechanisms=b(e.report_mechanism)};_(e.$parent.currentReport);var D=function(){e.report.birthDate&&(e.report.birthDate=new Date(e.report.birthDate.date)),e.report.startDate&&(e.report.startDate=new Date(e.report.startDate.date)),e.report.accidentDate&&(e.report.accidentDate=new Date(e.report.accidentDate.date)),e.report.date&&(e.report.date=new Date(e.report.date.date))};e.master=e.report,e.form={next:function(t){if(e.toTheTop(),t.$valid)C();else{var r=null,o=null;for(r in t)"$"!=r[0]&&(null!==o||t[r].$valid||(o=t[r].$name),t[r].$pristine&&(t[r].$dirty=!0));angular.element(".ng-invalid[name="+o+"]").focus(),T()}},prev:function(t){e.toTheTop(),S()},goTo:function(t,r){parseInt(e.currentStep)>parseInt(r)?(e.toTheTop(),A(r)):t.$valid?(e.toTheTop(),A(r)):T()},submit:function(t){var r=null;if(t.$invalid){var o=null,r=null;for(o in t)"$"!=o[0]&&(null!==r||t[o].$valid||(r=t[o].$name),t[o].$pristine&&(t[o].$dirty=!0));return h.info(e.customer),angular.element(".ng-invalid[name="+r+"]").focus(),void a.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}h.info(e.customer),E()},reset:function(t){e.report=angular.copy(e.master),t.$setPristine(!0)}};var T=function(e){f.pop("error","Error","Por favor complete el formulario en este paso antes de continuar")},C=function(){e.currentStep++},S=function(){e.currentStep--},A=function(t){e.currentStep=t},E=function(){var t={},o=JSON.stringify(e.report);t.data=Base64.encode(o);var n=0==e.report.id;return c({method:"POST",url:"api/occupational-report-incident/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){l(function(){a.swal("Registro","La información ha sido guardada satisfactoriamente","success"),n?(e.$parent.currentReport=t.data.result.id,_(e.$parent.currentReport)):(e.report=t.data.result,D(),e.report.lesions=B(e.report.lesions),e.report.bodies=B(e.report.bodies),e.report.factors=B(e.report.factors),e.report.mechanisms=B(e.report.mechanisms),e.changeState(e.report.state),e.changeCustomerState(e.report.customerState),e.changeCustomerBranchState(e.report.customerBranchState),e.changeAccidentState(e.report.accidentState))})})["catch"](function(e){r.error(e),a.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})},N=function(){var t={cid:68};c({method:"GET",url:"api/states",params:t})["catch"](function(e,t){}).then(function(t){e.states=t.data.result,e.cities=[]})["finally"](function(){})},O=function(t){if(t){h.info("editando cliente con código: "+e.customer.id);var r={id:t};c({method:"GET",url:"api/customer",params:r})["catch"](function(e,t){if(403==t){var r=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";a.swal("No Autorizado","No estas autorizado para ver esta información.","error"),l(function(){n.go(r)},3e3)}else 404==t?(a.swal("Información no disponible","Cliente no encontrado","error"),l(function(){n.go("app.clientes.list")})):a.swal("Error","Se ha presentado un error al intentar acceder a la información del cliente","error")}).then(function(t){l(function(){e.customer=t.data.result,e.report.customerBusinessName=e.customer.businessName,e.report.customerDocumentType=e.customer.documentType,e.report.customerDocumentNumber=e.customer.documentNumber;var r=I(e.customer.contacts,"dir"),o=I(e.customer.contacts,"tel"),n=I(e.customer.contacts,"fax"),a=I(e.customer.contacts,"email");e.report.customerAddress=r.length>0?r[0].value:"",e.report.customerTelephone=o.length>0?o[0].value:"",e.report.customerFax=n.length>0?n[0].value:"",e.report.customerEmail=a.length>0?a[0].value:"",e.report.customerState=e.customer.state,e.changeCustomerState(e.report.customerState),e.report.customerCity=e.customer.town})})["finally"](function(){})}};N(),O(e.report.customerId),e.$watch("report.employee",function(){if(null!=e.report.employee&&null!=e.report.employee.entity&&e.reloadEmployee){e.report.employeeId=e.report.employee.entity.id,e.report.firstLastName=e.report.employee.entity.lastName,e.report.firstName=e.report.employee.entity.firstName,e.report.documentType=e.report.employee.entity.documentType,e.report.documentNumber=e.report.employee.entity.documentNumber,e.report.birthDate=null,e.report.employee.entity.birthDate&&(e.report.birthDate=new Date(e.report.employee.entity.birthDate.date)),e.report.gender=e.report.employee.entity.gender,e.report.state=e.report.employee.entity.state,e.changeState(e.report.state),e.report.city=e.report.employee.entity.town,e.report.eps=e.report.employee.entity.eps,e.report.arl=e.report.employee.entity.arl,null!=e.report.employee.entity.afp?e.report.isAfp={item:"Si",value:"1"}:e.report.isAfp={item:"No",value:"0"},e.report.afp=e.report.employee.entity.afp;var t=I(e.report.employee.entity.details,"dir"),r=I(e.report.employee.entity.details,"tel"),o=I(e.report.employee.entity.details,"fax");e.report.address=t.length>0?t[0].value:"",e.report.telephone=r.length>0?r[0].value:"",e.report.fax=o.length>0?o[0].value:"",e.report.salary=e.report.employee.salary,e.report.job=e.report.employee.job.job?e.report.employee.job.job:e.report.employee.job,e.report.occupation=e.report.occupation&&""!=e.report.occupation?e.report.occupation:e.report.employee.occupation}});var I=function(e,t){var r=[];return angular.forEach(e,function(e){null!=e.type&&e.type.value===t&&r.push(e)}),r},B=function(e){return angular.forEach(e,function(e){e.isActive="0"!=e.isActive}),e};e.changeState=function(t,r){e.employeeCities=[];var o={sid:t.id};c({method:"GET",url:"api/towns",params:o}).then(function(t){e.employeeCities=t.data.result})["finally"](function(){})},e.changeCustomerState=function(t,r){e.customerCities=[];var o={sid:t.id};c({method:"GET",url:"api/towns",params:o}).then(function(t){e.customerCities=t.data.result})["finally"](function(){})},e.changeCustomerBranchState=function(t,r){if(null!=t){e.customerBranchCities=[];var o={sid:t.id};c({method:"GET",url:"api/towns",params:o}).then(function(t){e.customerBranchCities=t.data.result})["finally"](function(){})}},e.changeAccidentState=function(t,r){e.accidentCities=[];var o={sid:t.id};c({method:"GET",url:"api/towns",params:o}).then(function(t){e.accidentCities=t.data.result})["finally"](function(){})},e.onCancel=function(){null!=e.$parent&&e.$parent.navToSection("list","list",0)},e.onPreview=function(){null!=e.$parent&&e.$parent.navToSection("preview","preview",e.$parent.currentReport)},e.onAddEmployeeList=function(){var t=d.open({templateUrl:i.app.views.urlRoot+"modules/customer/occupational/report-incident/customer_absenteeism_disability_employee_list_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideOccupationalEmployeeListCtrl",scope:e});t.result.then(function(t){var r=m("filter")(e.employees,{id:t.id});0==r.length&&e.employees.push(t),e.report.employee=t})}}]),app.controller("ModalInstanceSideOccupationalEmployeeListCtrl",["$rootScope","$stateParams","$scope","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile",function(e,t,r,o,n,a,i,c,l,s,p,u,m,d){r.employee={id:0},r.onCloseModal=function(){o.close(r.employee)},r.onCancel=function(){o.dismiss("cancel")},r.onLoadRecord=function(){if(0!=r.employee.id){var e={id:r.employee.id};c({method:"GET",url:"api/customer-employee",params:e})["catch"](function(e,t){if(403==t){var r=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";i.swal("No Autorizado","No estas autorizado para ver esta información.","error"),a(function(){$state.go(r)},3e3)}else 404==t?i.swal("Información no disponible","Diagnóstico no encontrado","error"):i.swal("Error","Se ha presentado un error al intentar acceder a la información del proceso","error")}).then(function(e){a(function(){r.employee=e.data.result})})["finally"](function(){a(function(){r.onCloseModal()},400)})}else r.loading=!1},r.dtInstanceDisabilityEmployeeList={},r.dtOptionsDisabilityEmployeeList=m.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerId=t.customerId,JSON.stringify(e)},url:"api/customer-employee-modal-basic",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){f()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,t,o){d(angular.element(e).contents())(r)}),r.dtColumnsDisabilityEmployeeList=[u.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,t,r,o){var n="",a="",i='<a class="btn btn-success btn-xs editRow lnk" href="#" uib-tooltip="Adicionar empleado" tooltip-placement="right"  data-id="'+e.id+'"'+a+' >   <i class="fa fa-plus-square"></i></a> ';return n+=i}),u.newColumn("documentNumber").withTitle("Número Identificación").withOption("width",200),u.newColumn("firstName").withTitle("Nombre").withOption("width",200),u.newColumn("lastName").withTitle("Apellidos").withOption("width",200),u.newColumn("workPlace").withTitle("Centro de Trabajo").withOption("width",200),u.newColumn("job").withTitle("Cargo").withOption("width",200),u.newColumn("neighborhood").withTitle("Centro de Costos").withOption("width",200),u.newColumn(null).withTitle("Estado").withOption("width",200).renderWith(function(e,t,r,o){var n="label label-danger",a="Inactivo";null==e.isActiveCode&&void 0==e.isActiveCode||("Activo"==e.isActiveCode?(n="label label-success",a="Activo"):(n="label label-danger",a="Inactivo"));var i='<span class="'+n+'">'+a+"</span>";return i}),u.newColumn(null).withTitle("Autorización").withOption("width",200).renderWith(function(e,t,r,o){var n="label label-danger",a="Inactivo";null==e.isAuthorized&&void 0==e.isAuthorized||("Autorizado"==e.isAuthorized?(n="label label-success",a="Autorizado"):"No Autorizado"==e.isAuthorized?(n="label label-danger",a="No Autorizado"):(n="label label-info",a="N/A"));var i='<span class="'+n+'">'+a+"</span>";return i})];var f=function(){$("#dtDisabilityEmployeeList a.editRow").on("click",function(){var e=$(this).data("id");r.editDisabilityEmployee(e)})};r.reloadData=function(){r.dtInstanceDisabilityEmployeeList.reloadData()},r.viewDisabilityEmployee=function(e){r.employee.id=e,r.isView=!0,r.onLoadRecord()},r.editDisabilityEmployee=function(e){r.employee.id=e,r.isView=!1,r.onLoadRecord()}}]);
"use strict";app.controller("customerOccupationalReportIncidentListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","SweetAlert","$http","$filter","$document","$aside",function(e,t,n,a,i,o,r,l,c,s,d,u,m,p,f,w){e.agents=s.agents(),e.dtInstanceCustomerOccupationalReportIncident={},e.dtOptionsCustomerOccupationalReportIncident=a.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerId=t.customerId,JSON.stringify(e)},url:"api/customer-occupational-report-incident",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){h()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,n,a){r(angular.element(t).contents())(e)}),e.dtColumnsCustomerOccupationalReportIncident=[i.newColumn(null).withTitle("Acciones").withOption("width",180).notSortable().renderWith(function(e,t,n,a){var i="",o="A"==e.statusCode?0:1,r='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+e.id+'" >   <i class="fa fa-edit"></i></a> ',l='<a class="btn btn-info btn-xs viewRow lnk" href="#" uib-tooltip="Ver" data-id="'+e.id+'" >   <i class="fa fa-eye"></i></a> ',c=('<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+e.id+'" >   <i class="fa fa-trash-o"></i></a> ','<a target="_self" class="btn btn-success btn-xs downloadRow lnk" href="#" uib-tooltip="Descargar reporte" data-id="'+e.id+'" data-url="" >   <i class="fa fa-download"></i></a> ',' | <a class="btn btn-orange btn-xs improvementPlanRow lnk" href="#" uib-tooltip="Plan Mejoramiento" data-disable="'+o+'" data-id="'+e.id+'">   <i class="fa fa-plus-square"></i></a> '),d=' | <a class="btn btn-success btn-xs completeRow lnk" href="#" uib-tooltip="Cerrar" data-id="'+e.id+'" >   <i class="fa fa-check-circle-o"></i></a> ',u=' | <a class="btn btn-dark-azure btn-xs openRow lnk" href="#" uib-tooltip="Reabrir" data-id="'+e.id+'" >   <i class="fa fa-refresh"></i></a> ';return"C"==e.statusCode?(i+=l,i+=c):(i+=r,i+=c),"A"==e.statusCode&&s.can("reporte_incidente_close")&&(i+=d),"C"==e.statusCode&&s.can("reporte_incidente_reopen")&&(i+=u),i}),i.newColumn("documentType").withTitle("Tipo de Identificación").withOption("width",200),i.newColumn("documentNumber").withTitle("Número de Identificación").withOption("width",200),i.newColumn("firstName").withTitle("Nombre"),i.newColumn("lastName").withTitle("Apellidos"),i.newColumn("job").withTitle("Cargo"),i.newColumn("eps").withTitle("EPS"),i.newColumn("arl").withTitle("ARL"),i.newColumn("afp").withTitle("AFP"),i.newColumn("accidentDate").withTitle("Fecha Accidente").withOption("width",150),i.newColumn(null).withTitle("Estado").withOption("width",100).renderWith(function(e,t,n,a){var i="",o=e.status;switch(e.statusCode){case"A":i="label label-dark-azure";break;case"C":i="label label-success"}return'<span class="'+i+'">'+o+"</span>"})];var h=function(){angular.element("#dtCustomerOccupationalReportIncident a.editRow").on("click",function(){var t=angular.element(this).data("id");e.onEditIncidentAL(t)}),angular.element("#dtCustomerOccupationalReportIncident a.downloadRow").on("click",function(){var e=angular.element(this).data("id"),t=angular.element(this).data("url");""==t&&(jQuery("#downloadDocument")[0].src="api/occupational-report-incident/download?id="+e)}),angular.element("#dtCustomerOccupationalReportIncident a.viewRow").on("click",function(){var t=angular.element(this).data("id");e.onViewIncidentAL(t)}),angular.element("#dtCustomerOccupationalReportIncident a.improvementPlanRow").on("click",function(){var t=angular.element(this).data("id"),n=angular.element(this).data("disable"),a=e.isView;e.isView||(a="1"==n),e.onAddImprovementPlan(t,a)}),angular.element("#dtCustomerOccupationalReportIncident a.openRow").on("click",function(){var e=angular.element(this).data("id");v({id:e,status:"A"})}),angular.element("#dtCustomerOccupationalReportIncident a.completeRow").on("click",function(){var e=angular.element(this).data("id");g(e)}),angular.element("#dtCustomerOccupationalReportIncident a.delRow").on("click",function(){var t=angular.element(this).data("id");u.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(a){if(a){var i={};i.id=t,m({method:"POST",url:"api/customer-occupational-report-incident/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){n.error(e),u.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){e.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};e.dtInstanceCustomerOccupationalReportIncidentCallback=function(t){e.dtInstanceCustomerOccupationalReportIncident=t},e.reloadData=function(){e.dtInstanceCustomerOccupationalReportIncident.reloadData()},e.onCreateIncidentAL=function(t){null!=e.$parent&&e.$parent.navToSection("form","edit",0)},e.onEditIncidentAL=function(t){null!=e.$parent&&e.$parent.navToSection("form","edit",t)},e.onViewIncidentAL=function(t){null!=e.$parent&&e.$parent.navToSection("form","view",t)},e.onViewIncidentAnalysis=function(t){null!=e.$parent&&e.$parent.navToSection("analysis","analysis",0)},e.onAddImprovementPlan=function(t,n){var a={id:t},i=w.open({templateUrl:s.app.views.urlRoot+"modules/customer/common/modals/customer_improvement_plan_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideCustomerOccupationalReportIncidentImprovementPlanCtrl",scope:e,resolve:{item:function(){return a},isView:function(){return n},cycle:function(){return null}}});i.result.then(function(){},function(){})};var v=function(t){var n=w.open({templateUrl:s.app.views.urlRoot+"modules/customer/action-plan/tabs/customer_improvement_plan_action_plan_comment_edit_modal.htm",placement:"right",size:"sm",backdrop:!0,controller:"ModalInstanceSideCustomerOccupationalReportIncidentUpdateCtrl",scope:e,resolve:{entity:function(){return t}}});n.result.then(function(){e.reloadData()},function(){e.reloadData()})},g=function(t){var n=JSON.stringify({id:t,reason:null,status:{value:"C"}}),a={data:Base64.encode(n)};return m({method:"POST",url:"api/customer-occupational-report-incident/update",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(t){d(function(){l.pop("success","Operación Exitosa","Actualización exitosa."),e.reloadData()})})["catch"](function(e){u.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){e.reloadData()})}}]),app.controller("ModalInstanceSideCustomerOccupationalReportIncidentImprovementPlanCtrl",["$stateParams","$rootScope","$scope","$uibModalInstance","item","cycle","$log","$timeout","SweetAlert","isView","$filter","FileUploader","$http","DTOptionsBuilder","DTColumnBuilder","$compile",function(e,t,n,a,i,o,r,l,c,s,d,u,m,p,f,w){n.maxDate=new Date,n.datePickerConfig={culture:"es-CO",format:"dd/MM/yyyy HH:mm"},n.responsibleList=[],n.typesAlert=d("orderBy")(t.parameters("tracking_alert_type"),"id",!1),n.typesTime=t.parameters("tracking_alert_timeType"),n.statusAlert=t.parameters("tracking_alert_status"),n.preferencesAlert=t.parameters("tracking_alert_preference"),n.typeList=t.parameters("improvement_plan_type"),n.isView=s;var h=function(){n.improvement={id:0,customerId:e.customerId,classificationName:"INCIDENTE",classificationId:null,entityName:"RI",entityId:i.id,type:null,endDate:null,description:"",observation:"",responsible:null,isRequiresAnalysis:!1,status:{id:0,value:"CR",item:"Creada"},trackingList:[],alertList:[]}};h(),n.onLoadRecord=function(e){if(0!=e){var t={id:e};m({method:"GET",url:"api/customer/improvement-plan",params:t})["catch"](function(e,t){if(403==t){var n=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";c.swal("No Autorizado","No estas autorizado para ver esta información.","error"),l(function(){$state.go(n)},3e3)}else 404==t?c.swal("Información no disponible","Registro no encontrado","error"):c.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(e){l(function(){null!=e.data.result&&""!=e.data.result&&(n.improvement=e.data.result,C())},400)})["finally"](function(){})}else n.loading=!1},n.onCloseModal=function(){a.close(1)},n.onCancel=function(){a.dismiss("cancel")},n.onClear=function(){};var v=function(){var t={customer_id:e.customerId};return m({method:"POST",url:"api/customer/improvement-plan/list-data",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(e){l(function(){n.responsibleList=e.data.data.responsible})})["catch"](function(e){c.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};v(),n.master=n.improvement,n.form={submit:function(e){var t=null;if(e.$invalid){var n=null,t=null;for(n in e)"$"!=n[0]&&(null!==t||e[n].$valid||(t=e[n].$name),e[n].$pristine&&(e[n].$dirty=!0));return angular.element(".ng-invalid[name="+t+"]").focus(),void c.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}c.swal("Validación exitosa","Procediendo con el guardado...","success"),g()},reset:function(e){n.improvement=angular.copy(n.master),e.$setPristine(!0)}};var g=function(){var e={},t=JSON.stringify(n.improvement);return e.data=Base64.encode(t),m({method:"POST",url:"api/customer/improvement-plan/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){l(function(){h()})})["catch"](function(e){c.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){n.reloadData()})},C=function(){null!=n.improvement.endDate&&(n.improvement.endDate=new Date(n.improvement.endDate.date)),angular.forEach(n.improvement.trackingList,function(e,t){null!=e.startDate&&(e.startDate=new Date(e.startDate.date))})};n.onAddTracking=function(){l(function(){null==n.improvement.trackingList&&(n.improvement.trackingList=[]),n.improvement.trackingList.push({id:0,customerImprovementPlanId:0,responsible:null,startDate:null})})},n.onRemoveTracking=function(e){c.swal({title:"Está seguro?",text:"Desea confirmar la eliminación de este registro ?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(t){t?l(function(){var t=n.improvement.trackingList[e];if(n.improvement.trackingList.splice(e,1),0!=t.id){var a={};a.id=t.id,m({method:"POST",url:"api/customer/improvement-plan-tracking/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){r.error(e),c.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})},n.onAddAlert=function(){l(function(){null==n.improvement.alertList&&(n.improvement.alertList=[]),n.improvement.alertList.push({id:0,customerImprovementPlanId:0,type:null,preference:null,time:0,timeType:null,status:null})})},n.onRemoveAlert=function(e){c.swal({title:"Está seguro?",text:"Desea confirmar la eliminación de este registro ?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(t){t?l(function(){var t=n.improvement.alertList[e];if(n.improvement.alertList.splice(e,1),0!=t.id){var a={};a.id=t.id,m({method:"POST",url:"api/customer/improvement-plan-alert/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){r.error(e),c.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})},n.dtInstanceImprovementPlan={},n.dtOptionsImprovementPlan=p.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerId=n.improvement.customerId,e.entityId=n.improvement.entityId,e.entityName=n.improvement.entityName,JSON.stringify(e)},url:"api/customer-improvement-plan-entity",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){O()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,t,a){w(angular.element(e).contents())(n)}),n.dtColumnsImprovementPlan=[f.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,a,i,o){var r="",l='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+e.id+'" >   <i class="fa fa-edit"></i></a> ',c='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+e.id+'" >   <i class="fa fa-trash-o"></i></a> ';return t.can("cliente_plan_mejoramiento_edit")&&(r+=l),t.can("cliente_plan_mejoramiento_delete")&&(r+=c),n.isView?null:r}),f.newColumn("origin").withTitle("Origen").withOption("width",200).withOption("defaultContent",""),f.newColumn("classification").withTitle("Clasificación").withOption("width",200).withOption("defaultContent",""),f.newColumn("type").withTitle("Tipo").withOption("width",200).withOption("defaultContent",""),f.newColumn("description").withTitle("Hallazgo").withOption("width",200).withOption("defaultContent",""),f.newColumn("responsibleName").withTitle("Responsable").withOption("defaultContent",""),f.newColumn(null).withTitle("Fecha Cierre").withOption("width",200).renderWith(function(e,t,n,a){return"object"==typeof e.endDate&&null!=e.endDate?moment(e.endDate.date).format("DD/MM/YYYY"):null!=e.endDate?moment(e.endDate).format("DD/MM/YYYY"):""}),f.newColumn(null).withTitle("Estado").withOption("width",200).withOption("defaultContent","").renderWith(function(e,t,n,a){var i="label label-success",o=e.status;switch(e.statusCode){case"AB":i="label label-info";break;case"CO":i="label label-success";break;case"CA":i="label label-danger"}return'<span class="'+i+'">'+o+"</span>"})];var O=function(){angular.element("#dtImprovementPlan a.editRow").on("click",function(){var e=angular.element(this).data("id");n.onLoadRecord(e)}),angular.element("#dtImprovementPlan a.delRow").on("click",function(){var e=angular.element(this).data("id");c.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(t){if(t){var a={};a.id=e,m({method:"POST",url:"api/customer/improvement-plan/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){r.error(e),c.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){n.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};n.dtInstanceImprovementPlanCallback=function(e){n.dtInstanceImprovementPlan=e},n.reloadData=function(){n.dtInstanceImprovementPlan.reloadData()}}]),app.controller("ModalInstanceSideCustomerOccupationalReportIncidentUpdateCtrl",["$rootScope","$stateParams","$scope","$uibModal","$uibModalInstance","entity","$log","$timeout","SweetAlert","$http","toaster","$filter","$aside","$document","DTColumnBuilder","DTOptionsBuilder","$compile",function(e,t,n,a,i,o,r,l,c,s,d,u,m,p,f,w,h){n.loading=!0,n.onCloseModal=function(){i.close(1)},n.onCancel=function(){i.dismiss("cancel")};var v=function(){n.entity={id:o.id,reason:"",status:{value:o.status}}};v(),n.form={submit:function(e){var t=null;if(e.$invalid){var n=null,t=null;for(n in e)"$"!=n[0]&&(null!==t||e[n].$valid||(t=e[n].$name),e[n].$pristine&&(e[n].$dirty=!0));return angular.element(".ng-invalid[name="+t+"]").focus(),void c.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}g()},reset:function(e){}};var g=function(){var e=JSON.stringify(n.entity),t={data:Base64.encode(e)};return s({method:"POST",url:"api/customer-occupational-report-incident/update",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(e){l(function(){d.pop("success","Operación Exitosa","Actualización exitosa."),n.onCloseModal()})})["catch"](function(e){c.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})}}]);
"use strict";app.controller("customerOccupationalReportIncidentPreviewCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","SweetAlert","$http","$filter","$document",function(t,e,r,n,o,i,a,c,p,l,u,$,s,d,m){var f=r;f.info("loading..customerOccupationalReportIncidentPreviewCtrl.js "),t.agents=l.agents(),t.currentURL="api/occupational-report-incident/preview?id="+t.$parent.currentReport+"&rnd="+Math.random(),t.onCancel=function(e){null!=t.$parent&&t.$parent.navToSection("form","edit",t.$parent.currentReport)}}]);
"use strict";app.controller("customerWorkMedicineCtrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout",function(t,o,e,c,i,n){var r=e;r.info("loading..customerWorkMedicineCtrl!!! "),t.tracking_section="list",t.currentId=0,t.modeDsp="edit",t.navToSection=function(o,e,c){n(function(){t.tracking_section=o,t.modeDsp=e,t.$parent.switchSubTab(e),t.currentId=c})}}]);
"use strict";app.controller("customerWorkMedicineListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","SweetAlert","$http","$filter","$document","$aside",function(e,n,t,o,i,a,l,r,c,s,d,u,m,p,f,w){var h=t;e.agents=s.agents(),e.dtOptionsWorkMedicine=o.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerId=n.customerId,JSON.stringify(e)},url:"api/customer-work-medicine",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){g()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(n,t,o){l(angular.element(n).contents())(e)}),e.dtColumnsWorkMedicine=[i.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,n,t,o){var i="",a='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+e.id+'" >   <i class="fa fa-edit"></i></a> ',l='<a class="btn btn-info btn-xs viewRow lnk" href="#" uib-tooltip="Ver" data-id="'+e.id+'" >   <i class="fa fa-eye"></i></a> ',r='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+e.id+'" >   <i class="fa fa-trash-o"></i></a> ';return s.can("seguimiento_view")&&(i+=l),s.can("seguimiento_edit")&&(i+=a),s.can("seguimiento_delete")&&(i+=r),i}),i.newColumn("examinationDate").withTitle("Fecha Exámen").withOption("width",200).withOption("defaultContent",""),i.newColumn("examinationType").withTitle("Tipo de Exámen").withOption("width",200).withOption("defaultContent",""),i.newColumn("firstName").withTitle("Nombre").withOption("width",200).withOption("defaultContent",""),i.newColumn("lastName").withTitle("Apellidos").withOption("width",200).withOption("defaultContent",""),i.newColumn("job").withTitle("Cargo").withOption("width",200).withOption("defaultContent","")];var g=function(){$("#dtWorkMedicine a.editRow").on("click",function(){var n=$(this).data("id");e.onEdit(n)}),$("#dtWorkMedicine a.viewRow").on("click",function(){var n=$(this).data("id");e.onView(n)}),$("#dtWorkMedicine a.delRow").on("click",function(){var n=$(this).data("id");h.info("intenta eliminar el registro: "+n),u.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(o){if(o){var i={};i.id=n,m({method:"POST",url:"api/customer/work-medicine/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){t.error(e),u.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){e.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};e.dtInstanceWorkMedicineCallback=function(n){e.dtInstanceWorkMedicine=n},e.reloadData=function(){e.dtInstanceWorkMedicine.reloadData()},e.onEdit=function(n){null!=e.$parent&&e.$parent.navToSection("form","edit",n)},e.onView=function(n){null!=e.$parent&&e.$parent.navToSection("form","view",n)},e.onUpload=function(){var n=w.open({templateUrl:s.app.views.urlRoot+"modules/customer/medicine/customer_work_medicine_import_modal.html",placement:"bottom",size:"lg",backdrop:!0,controller:"ModalInstanceSideUploadEmployeeOccupationalExaminationCtrl",scope:e});n.result.then(function(){response&&response.sessionId&&(response.hasCustomerEmployeeId?s.hasCustomerEmployeeId=response.hasCustomerEmployeeId:s.hasCustomerEmployeeId=null,null!=e.$parent&&e.$parent.navToSection("stagingEmployee","stagingEmployee",response.sessionId))})}}]),app.controller("ModalInstanceSideUploadEmployeeOccupationalExaminationCtrl",["$rootScope","$stateParams","$scope","FileUploader","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","ngNotify","ListService",function(e,n,t,o,i,a,l,r,c,s,d,u){function m(){var e=[{name:"export_url",value:null}];u.getDataList(e).then(function(e){p=e.data.data.exportUrl.item,f.url=p+"api/v1/customer-employee-occupational-examination-import"},function(e){t.status="Unable to load customer data: "+e.message})}var p="",f=t.uploader=new o({url:p+"api/v1/customer-employee-occupational-examination-import",formData:[]});m(),t.title="Importar examenes ocupacionales",t.buttonDownloadTitle="Plantilla importación examenes ocupacionales",t.download=function(){angular.element("#downloadDocument")[0].src="api/customer-work-medicine/download-template"},f.filters.push({name:"customFilter",fn:function(e,n){return this.queue.length<10}}),f.onWhenAddingFileFailed=function(e,n,t){console.info("onWhenAddingFileFailed",e,n,t)},f.onAfterAddingFile=function(e){console.info("onAfterAddingFile",e)},f.onAfterAddingAll=function(e){console.info("onAfterAddingAll",e)},f.onBeforeUploadItem=function(e){console.info("onBeforeUploadItem",e);var t={id:n.customerId};e.formData.push(t)},f.onProgressItem=function(e,n){console.info("onProgressItem",e,n)},f.onProgressAll=function(e){console.info("onProgressAll",e)},f.onSuccessItem=function(e,n,t,o){console.info("onSuccessItem",e,n,t,o)},f.onErrorItem=function(e,n,t,o){console.info("onErrorItem",e,n,t,o)},f.onCancelItem=function(e,n,t,o){console.info("onCancelItem",e,n,t,o)},f.onCompleteItem=function(e,n,t,o){console.info("onCompleteItem",e,n,t,o)},f.onCompleteAll=function(){console.info("onCompleteAll"),swal("Correcto","Se inserto la información correctamente","success"),t.dtInstanceWorkMedicine.reloadData(),i.close(1)}}]);
"use strict";app.controller("customerWorkMedicineEditCtrl",["$scope","$stateParams","$log","$compile","$state","SweetAlert","$rootScope","$http","$timeout","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$uibModal","flowFactory","cfpLoadingBar","$filter","$aside","$document","ListService",function(e,t,n,i,o,a,r,l,c,d,s,u,m,p,f,w,h,y,g){var v=n,k={},b=e.$parent.currentId;e.isAgent="agent"==r.currentUser().wg_type,e.isAdmin="system"==r.currentUser().wg_type,e.isCustomer="customerAdmin"==r.currentUser().wg_type||"customerUser"==r.currentUser().wg_type,v.info("loading..customerWorkMedicineEditCtrl con el id de tracking: ",b),e.examinationTypes=r.parameters("work_medicine_examination_type"),e.medicalConcepts=r.parameters("work_medicine_medical_concept"),e.complementaryTests=r.parameters("work_medicine_complementary_test"),e.sveTypes=r.parameters("work_medicine_sve_type"),e.trackingTypes=r.parameters("work_medicine_tracking_type"),e.contractTypes=r.parameters("employee_contract_type"),e.documentType=r.parameters("customer_document_type"),e.tiposdoc=r.parameters("tipodoc"),e.isView="view"==e.$parent.modeDsp,console.log(e.isView),e.canShow=!1,e.minDateCurrent=new Date,e.customerId=t.customerId,e.maxDate=new Date,e.dateTimePickerConfig={culture:"es-CO",format:"dd/MM/yyyy HH:mm"},e.datePickerConfig={culture:"es-CO",format:"dd/MM/yyyy"},e.employees=[],e.onLoadRecord=function(){if(0!=e.medicine.id){v.info("editando cliente con código: "+e.medicine.id);var t={id:e.medicine.id};l({method:"GET",url:"api/customer/work-medicine",params:t})["catch"](function(e,t){if(403==t){var n=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";a.swal("No Autorizado","No estas autorizado para ver esta información.","error"),c(function(){o.go(n)},3e3)}else 404==t?a.swal("Información no disponible","Centro de trabajo no encontrado","error"):a.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(t){c(function(){e.medicine=t.data.result,e.medicine.examinationDate=new Date(e.medicine.examinationDate.date),e.canShow=!0})})["finally"](function(){c(function(){e.loading=!1},400),c(function(){y.scrollTop(40,2e3)})})}else v.info("creacion de nuevo cliente"),e.loading=!1},e.medicine={id:b,employee:null,examinationType:null,examinationDate:null,occupationalConclusion:"",occupationalBehavior:"",generalRecommendation:"",medicalConcept:null};var C=function(){e.complementary={id:0,customerWorkMedicineId:e.medicine.id,complementaryTest:null,result:null,interpretation:""},e.sve={id:0,customerWorkMedicineId:e.medicine.id,type:null,isActive:!1},e.tracking={id:0,customerWorkMedicineId:e.medicine.id,type:null,dateOf:null,observation:""}};C(),e.onLoadRecord(),e.master=e.medicine,e.form={submit:function(t){var n=null;if(t.$invalid){var i=null,n=null;for(i in t)"$"!=i[0]&&(null!==n||t[i].$valid||(n=t[i].$name),t[i].$pristine&&(t[i].$dirty=!0));return v.info(e.customer),angular.element(".ng-invalid[name="+n+"]").focus(),void a.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}v.info(e.customer),O()},reset:function(t){e.tracking=angular.copy(e.master),t.$setPristine(!0)}};var O=function(){var t={};e.medicine.examinationDate=e.medicine.examinationDate.toISOString();var i=JSON.stringify(e.medicine);return t.data=Base64.encode(i),l({method:"POST",url:"api/customer/work-medicine/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){c(function(){a.swal("Registro","La información ha sido guardada satisfactoriamente","success"),e.medicine=t.data.result,e.medicine.examinationDate=new Date(e.medicine.examinationDate.date),e.canShow=!0,k.customer_work_medicine_id=e.medicine.id,b=e.medicine.id,C()})})["catch"](function(e){n.error(e),a.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};e.cancelEdition=function(){null!=e.$parent&&e.$parent.navToSection("list","list")},k.customer_work_medicine_id=b,e.dtInstanceWorkMedicineComplementary={},e.dtOptionsWorkMedicineComplementary=d.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customer_work_medicine_id=b,e},url:"api/customer/work-medicine/complementary-test",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){T()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,n,o){i(angular.element(t).contents())(e)}),e.dtColumnsWorkMedicineComplementary=[s.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,n,i,o){var a="",l='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+t.id+'" >   <i class="fa fa-edit"></i></a> ',c='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+t.id+'" >   <i class="fa fa-trash-o"></i></a> ';return r.can("seguimiento_edit")&&(a+=l),r.can("seguimiento_delete")&&(a+=c),e.isView?"":a}),s.newColumn("complementaryTest.item").withTitle("Prueba Complementaria").withOption("defaultContent",""),s.newColumn("result.item").withTitle("Resultado").withOption("defaultContent",""),s.newColumn("interpretation").withTitle("Interpretación").withOption("defaultContent","")];var T=function(){$("#dtWorkMedicineComplementary a.editRow").on("click",function(){var t=$(this).data("id");e.editWorkMedicineComplementary(t)}),$("#dtWorkMedicineComplementary a.delRow").on("click",function(){var t=$(this).data("id");v.info("intenta eliminar el registro: "+t),a.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(i){if(i){var o={};o.id=t,l({method:"POST",url:"api/customer/work-medicine/complementary-test/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){n.error(e),a.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){e.reloadDataComplementary()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};e.dtInstanceWorkMedicineComplementaryCallback=function(t){e.dtInstanceWorkMedicineComplementary=t},e.reloadDataComplementary=function(){e.dtInstanceWorkMedicineComplementary.reloadData()},e.editWorkMedicineComplementary=function(t){if(t){var n={id:t};l({method:"GET",url:"api/customer/work-medicine/complementary-test",params:n})["catch"](function(e,t){if(403==t){var n=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";a.swal("No Autorizado","No estas autorizado para ver esta información.","error"),c(function(){o.go(n)},3e3)}else 404==t?a.swal("Información no disponible","Centro de trabajo no encontrado","error"):a.swal("Error","Se ha presentado un error al intentar acceder a la información","error")}).then(function(t){console.log(t),c(function(){e.complementary=t.data.result;var n=e.complementary.result;e.onSelectComplementaryTest(null,null),e.complementary.result=n})})["finally"](function(){c(function(){e.loading=!1},400),c(function(){})})}else v.info("creacion de nuevo cliente"),e.loading=!1},e.saveWorkMedicineComplementary=function(){var t={},i="";if(null==e.complementary.complementaryTest&&(i+="Debe seleccionar la Prueba complementaria <br/>"),null==e.complementary.result&&(i+="Debe seleccionar el Resultado <br/>"),null!=e.complementary.interpretation&&""!=e.complementary.interpretation||(i+="Debe ingresar la Interpretación <br/>"),""!=i)return void a.swal({html:!0,title:"Error de validación",text:i,type:"error"});var o=JSON.stringify(e.complementary);return t.data=Base64.encode(o),l({method:"POST",url:"api/customer/work-medicine/complementary-test/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){c(function(){e.clearWorkMedicineComplementary(),e.reloadDataComplementary()})})["catch"](function(e){n.error(e),a.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})},e.clearWorkMedicineComplementary=function(){e.complementary={id:0,customerWorkMedicineId:e.medicine.id,complementaryTest:null,result:null,interpretation:""}},e.dtInstanceWorkMedicineSve={},e.dtOptionsWorkMedicineSve=d.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customer_work_medicine_id=b,e},url:"api/customer/work-medicine/sve",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){S()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,n,o){i(angular.element(t).contents())(e)}),e.dtColumnsWorkMedicineSve=[s.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,n,i,o){var a="",l='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+t.id+'" >   <i class="fa fa-edit"></i></a> ',c='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+t.id+'" >   <i class="fa fa-trash-o"></i></a> ';return r.can("seguimiento_edit")&&(a+=l),r.can("seguimiento_delete")&&(a+=c),e.isView?"":a}),s.newColumn("type.item").withTitle("SVE Tipo").withOption("defaultContent",""),s.newColumn("isActive").withTitle("Estado").withOption("defaultContent","").renderWith(function(e,t,n,i){var o="",a="";return e||"1"==e?(a="Si",o="label label-success"):(a="No",o="label label-danger"),'<span class="'+o+'">'+a+"</span>"})];var S=function(){$("#dtWorkMedicineSve a.editRow").on("click",function(){var t=$(this).data("id");e.editWorkMedicineSve(t)}),$("#dtWorkMedicineSve a.delRow").on("click",function(){var t=$(this).data("id");v.info("intenta eliminar el registro: "+t),a.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(i){if(i){var o={};o.id=t,l({method:"POST",url:"api/customer/work-medicine/sve/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){n.error(e),a.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){e.reloadDataSve()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};e.dtInstanceWorkMedicineSveCallback=function(t){e.dtInstanceWorkMedicineSve=t},e.reloadDataSve=function(){e.dtInstanceWorkMedicineSve.reloadData()},e.editWorkMedicineSve=function(t){if(t){var n={id:t};l({method:"GET",url:"api/customer/work-medicine/sve",params:n})["catch"](function(e,t){if(403==t){var n=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";a.swal("No Autorizado","No estas autorizado para ver esta información.","error"),c(function(){o.go(n)},3e3)}else 404==t?a.swal("Información no disponible","Centro de trabajo no encontrado","error"):a.swal("Error","Se ha presentado un error al intentar acceder a la información","error")}).then(function(t){c(function(){e.sve=t.data.result})})["finally"](function(){c(function(){e.loading=!1},400),c(function(){})})}else v.info("creacion de nuevo cliente"),e.loading=!1},e.saveWorkMedicineSve=function(){var t={},i="";if(null==e.sve.type&&(i+="Debe seleccionar la Prueba complementaria <br/>"),""!=i)return void a.swal({html:!0,title:"Error de validación",text:i,type:"error"});var o=JSON.stringify(e.sve);return t.data=Base64.encode(o),l({method:"POST",url:"api/customer/work-medicine/sve/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){c(function(){e.clearWorkMedicineSve(),e.reloadDataSve()})})["catch"](function(e){n.error(e),a.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})},e.clearWorkMedicineSve=function(){e.sve={id:0,customerWorkMedicineId:e.medicine.id,type:null,isActive:!1}},e.dtInstanceWorkMedicineTracking={},e.dtOptionsWorkMedicineTracking=d.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customer_work_medicine_id=b,e},url:"api/customer/work-medicine/tracking",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){D()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,n,o){i(angular.element(t).contents())(e)}),e.dtColumnsWorkMedicineTracking=[s.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,n,i,o){var a="",l='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+t.id+'" >   <i class="fa fa-edit"></i></a> ',c='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+t.id+'" >   <i class="fa fa-trash-o"></i></a> ';return r.can("seguimiento_edit")&&(a+=l),r.can("seguimiento_delete")&&(a+=c),e.isView?"":a}),s.newColumn("dateOfFormat").withTitle("Fecha Seguimiento").withOption("width",200).withOption("defaultContent",""),s.newColumn("type.item").withTitle("Tipo de Seguimiento").withOption("defaultContent",""),s.newColumn("observation").withTitle("Observación").withOption("defaultContent","")];var D=function(){$("#dtWorkMedicineTracking a.editRow").on("click",function(){var t=$(this).data("id");e.editWorkMedicineTracking(t)}),$("#dtWorkMedicineTracking a.delRow").on("click",function(){var t=$(this).data("id");v.info("intenta eliminar el registro: "+t),a.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(i){if(i){var o={};o.id=t,l({method:"POST",url:"api/customer/work-medicine/tracking/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){n.error(e),a.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){e.reloadDataTracking()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};e.dtInstanceWorkMedicineTrackingCallback=function(t){e.dtInstanceWorkMedicineTracking=t},e.reloadDataTracking=function(){e.dtInstanceWorkMedicineTracking.reloadData()},e.editWorkMedicineTracking=function(t){if(t){var n={id:t};l({method:"GET",url:"api/customer/work-medicine/tracking",params:n})["catch"](function(e,t){if(403==t){var n=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";a.swal("No Autorizado","No estas autorizado para ver esta información.","error"),c(function(){o.go(n)},3e3)}else 404==t?a.swal("Información no disponible","Centro de trabajo no encontrado","error"):a.swal("Error","Se ha presentado un error al intentar acceder a la información","error")}).then(function(t){e.tracking=t.data.result,e.tracking.dateOf=new Date(e.tracking.dateOf.date),null!=e.tracking.dateOf})["finally"](function(){c(function(){e.loading=!1},400),c(function(){})})}else v.info("creacion de nuevo cliente"),e.loading=!1},e.saveWorkMedicineTracking=function(){var t={},i="";if(null==e.tracking.type&&(i+="Debe seleccionar el Tipo de seguimiento <br/>"),null!=e.tracking.dateOf&&""!=e.tracking.dateOf||(i+="Debe ingresar la Fecha del seguimiento <br/>"),null!=e.tracking.observation&&""!=e.tracking.observation||(i+="Debe ingresar la Observación <br/>"),""!=i)return void a.swal({html:!0,title:"Error de validación",text:i,type:"error"});var o=JSON.stringify(e.tracking);return t.data=Base64.encode(o),l({method:"POST",url:"api/customer/work-medicine/tracking/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){c(function(){e.clearWorkMedicineTracking(),e.reloadDataTracking()})})["catch"](function(e){n.error(e),a.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})},e.clearWorkMedicineTracking=function(){e.tracking={id:0,customerWorkMedicineId:e.medicine.id,type:null,dateOf:null,observation:""}},e.onAddEmployee=function(){var t=h.open({templateUrl:r.app.views.urlRoot+"modules/customer/medicine/customer_absenteeism_disability_employee_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideWorkMedicineEmployeeCtrl",scope:e});t.result.then(function(){})},e.onAddDisabilityEmployeeList=function(){var t=h.open({templateUrl:r.app.views.urlRoot+"modules/customer/medicine/customer_absenteeism_disability_employee_list_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideWorkMedicineEmployeeListCtrl",scope:e});t.result.then(function(t){var n=w("filter")(e.employees,{id:t.id});0==n.length&&e.employees.push(t),e.medicine.employee=t})},e.onSelectComplementaryTest=function(t,n){if(null!=e.complementary.complementaryTest){e.complementary.result=null;var i=[{name:"work_medicine_complementary_test_result",value:e.complementary.complementaryTest.value}];g.getDataList(i).then(function(t){e.complementaryTestResults=t.data.data.workMedicineComplementaryTestResult},function(t){e.status="Unable to load customer data: "+t.message})}}}]),app.controller("ModalInstanceSideWorkMedicineEmployeeCtrl",["$rootScope","$stateParams","$scope","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile",function(e,t,n,i,o,a,r,l,c,d,s,u,m,p){n.contractTypes=e.parameters("employee_contract_type"),n.documentTypes=e.parameters("employee_document_type");var f=function(){n.employee={id:0,customerId:t.customerId,isActive:!0,contractType:null,job:null,workPlace:null,salary:0,entity:{id:0,documentType:null,documentNumber:"",firstName:"",lastName:"",isActive:!0}}};f();var w=function(){var e={};return e.operation="diagnostic",e.customerId=t.customerId,l({method:"POST",url:"api/customer/config-sgsst/workplace/listProcess",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){a(function(){n.workPlaces=e.data.data})})["catch"](function(e){})["finally"](function(){})};w();var h=function(){if(null!=n.employee.workPlace){var e={};return e.operation="diagnostic",e.customerId=t.customerId,e.workPlaceId=n.employee.workPlace.id,l({method:"POST",url:"api/customer/config-sgsst/job/listByWorkPlace",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){a(function(){n.jobs=e.data.data})})["catch"](function(e){})["finally"](function(){})}n.jobs=[]};n.$watch("employee.workPlace",function(){h()}),n.onCloseModal=function(){i.close(1)},n.onCancelEmployee=function(){i.dismiss("cancel")},n.form={submit:function(e){var t=null;if(e.$invalid){var i=null,t=null;for(i in e)"$"!=i[0]&&(null!==t||e[i].$valid||(t=e[i].$name),e[i].$pristine&&(e[i].$dirty=!0));return angular.element(".ng-invalid[name="+t+"]").focus(),void a(function(){c.pop("error","Error","Por favor verifique los datos requeridos del formulario y vuelva a intentarlo")},500)}n.onSaveEmployee()},reset:function(e){e.$setPristine(!0)}},n.onSaveEmployee=function(){var e={},t=JSON.stringify(n.employee);return e.data=Base64.encode(t),l({method:"POST",url:"api/customer-employee/quickSave",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){a(function(){n.attachment=e.data.result,c.pop("success","Operación Exitosa","Registro eliminado"),n.onCloseModal()})})["catch"](function(e){o.error(e),c.pop("error","Error","Por favor ingrese los campos requeridos.")})["finally"](function(){})}}]),app.controller("ModalInstanceSideWorkMedicineEmployeeListCtrl",["$rootScope","$stateParams","$scope","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile",function(e,t,n,i,o,a,r,l,c,d,s,u,m,p){n.employee={id:0},n.onCloseModal=function(){i.close(n.employee)},n.onCancel=function(){i.dismiss("cancel")},n.onLoadRecord=function(){if(0!=n.employee.id){var e={id:n.employee.id};l({method:"GET",url:"api/customer-employee",params:e})["catch"](function(e,t){if(403==t){var n=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";r.swal("No Autorizado","No estas autorizado para ver esta información.","error"),a(function(){$state.go(n)},3e3)}else 404==t?r.swal("Información no disponible","Diagnóstico no encontrado","error"):r.swal("Error","Se ha presentado un error al intentar acceder a la información del proceso","error")}).then(function(e){a(function(){n.employee=e.data.result,f()})})["finally"](function(){a(function(){n.onCloseModal()},400)})}else n.loading=!1};var f=function(){null!=n.employee.entity.expeditionDate&&(n.employee.entity.expeditionDate=new Date(n.employee.entity.expeditionDate.date)),null!=n.employee.entity.birthDate&&(n.employee.entity.birthDate=new Date(n.employee.entity.birthDate.date))};n.dtInstanceDisabilityEmployeeList={},n.dtOptionsDisabilityEmployeeList=m.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.operation="diagnostic",e.customer_id=t.customerId,e.data="",e},url:"api/customer-employee",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){w()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,t,i){p(angular.element(e).contents())(n)}),n.dtColumnsDisabilityEmployeeList=[u.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,t,n,i){var o="",a="",r='<a class="btn btn-success btn-xs editRow lnk" href="#" uib-tooltip="Adicionar empleado" tooltip-placement="right" data-id="'+e.id+'"'+a+' >   <i class="fa fa-plus-square"></i></a> ';return o+=r}),u.newColumn("documentNumber").withTitle("Número Identificación").withOption("width",200).withOption("defaultContent",""),u.newColumn("firstName").withTitle("Nombre").withOption("width",200).withOption("defaultContent",""),u.newColumn("lastName").withTitle("Apellidos").withOption("width",200).withOption("defaultContent",""),u.newColumn("workPlace").withTitle("Centro de Trabajo").withOption("width",200).withOption("defaultContent",""),u.newColumn("job").withTitle("Cargo").withOption("width",200).withOption("defaultContent",""),u.newColumn("neighborhood").withTitle("Centro de Costos").withOption("width",200).withOption("defaultContent",""),u.newColumn(null).withTitle("Estado").withOption("width",200).renderWith(function(e,t,n,i){var o="label label-danger",a="Inactivo";null==e.isActive&&void 0==e.isActive||("Activo"==e.isActive?(o="label label-success",a="Activo"):(o="label label-danger",a="Inactivo"));var r='<span class="'+o+'">'+a+"</span>";return r}),u.newColumn(null).withTitle("Autorización").withOption("width",200).renderWith(function(e,t,n,i){var o="label label-danger",a="Inactivo";null==e.isAuthorized&&void 0==e.isAuthorized||("Autorizado"==e.isAuthorized?(o="label label-success",a="Autorizado"):"No Autorizado"==e.isAuthorized?(o="label label-danger",a="No Autorizado"):(o="label label-info",a="N/A"));var r='<span class="'+o+'">'+a+"</span>";return r})];var w=function(){$("#dtDisabilityEmployeeList a.editRow").on("click",function(){var e=$(this).data("id");n.editDisabilityEmployee(e)})};n.reloadData=function(){n.dtInstanceDisabilityEmployeeList.reloadData()},n.viewDisabilityEmployee=function(e){n.employee.id=e,n.isView=!0,n.onLoadRecord()},n.editDisabilityEmployee=function(e){n.employee.id=e,n.isView=!1,n.onLoadRecord()}}]);
"use strict";app.controller("customerDocumentCtrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout",function(t,e,o,c,n,a){var r=o;r.info("loading..customerDocumentCtrl!!! "),t.attachment_section="list",t.currentAttachment=0,t.modeDsp="edit",t.navToSection=function(e,o,c){a(function(){t.attachment_section=e,t.modeDsp=o,t.$parent.switchSubTab(o),t.currentAttachment=c})}}]);
"use strict";app.controller("customerDocumentListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","SweetAlert","$http","$filter","$document","FileUploader","$localStorage","$ngConfirm","ngNotify","ListService",function(t,n,e,o,a,i,r,l,s,c,u,d,m,f,p,w,h,g,C,v){function A(){var e=[{name:"customer_document_type",value:n.customerId}];v.getDataList(e).then(function(n){t.documentType=n.data.data.customerDocumentType},function(n){t.status="Unable to load customer data: "+n.message})}var b=null,D=n.customerId,O=0;t.$storage=h.$default({hideCustomerAttachmentCanceled:!0}),t.isAgent="agent"==c.currentUser().wg_type,t.isAdmin="system"==c.currentUser().wg_type,t.isCustomer="customerAdmin"==c.currentUser().wg_type||"customerUser"==c.currentUser().wg_type,t.documentClassification=c.parameters("customer_document_classification"),t.documentStatus=c.parameters("customer_document_status"),t.isView="view"==t.$parent.modeDsp,t.downloadUrl="",A();var y=function(){t.attachment={id:0,customerId:D,agent:null,type:null,classification:null,status:t.documentStatus?t.documentStatus[0]:null,version:1,description:""},b&&b.$setPristine(!0)};y();var T=function(n){var e={id:n};m({method:"GET",url:"api/customer/document",params:e})["catch"](function(t,n){if(403==n){var e=null!==t.message&&void 0!==t.message?t.message:"app.clientes.list";d.swal("No Autorizado","No estas autorizado para ver esta información.","error"),u(function(){s.go(e)},3e3)}else 404==n?(d.swal("Información no disponible","Anexo no encontrado","error"),u(function(){s.go("app.clientes.list")})):d.swal("Error","Se ha presentado un error al intentar acceder a la información del anexo","error")}).then(function(n){u(function(){t.attachment=n.data.result,t.attachment.version=parseInt(t.attachment.version)+1})})["finally"](function(){u(function(){t.loading=!1},400)})};t.form={submit:function(t){b=t;var n=null;if(t.$invalid){var e=null,n=null;for(e in t)"$"!=e[0]&&(null!==n||t[e].$valid||(n=t[e].$name),t[e].$pristine&&(t[e].$dirty=!0));return angular.element(".ng-invalid[name="+n+"]").focus(),void d.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}I()},reset:function(t){t.$setPristine(!0)}};var I=function(){var n={},o=JSON.stringify(t.attachment);return n.data=Base64.encode(o),m({method:"POST",url:"api/document/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(n){u(function(){x.queue.length>0?(O=n.data.result.id,x.uploadAll()):(d.swal("Acción exitosa","La información ha sido guardada satisfactoriamente","success"),t.reloadData(),t.onClear())})})["catch"](function(t){e.error(t),d.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){t.reloadData()})},x=t.uploader=new w({url:"api/document/upload",formData:[],removeAfterUpload:!0});x.filters.push({name:"customFilter",fn:function(t,n){return this.queue.length<10}}),x.onWhenAddingFileFailed=function(t,n,e){console.info("onWhenAddingFileFailed",t,n,e)},x.onAfterAddingFile=function(t){console.info("onAfterAddingFile",t)},x.onAfterAddingAll=function(t){console.info("onAfterAddingAll",t)},x.onBeforeUploadItem=function(t){console.info("onBeforeUploadItem",t);var n={id:O};t.formData.push(n)},x.onProgressItem=function(t,n){console.info("onProgressItem",t,n)},x.onProgressAll=function(t){console.info("onProgressAll",t)},x.onSuccessItem=function(t,n,e,o){console.info("onSuccessItem",t,n,e,o)},x.onErrorItem=function(t,n,e,o){console.info("onErrorItem",t,n,e,o)},x.onCancelItem=function(t,n,e,o){console.info("onCancelItem",t,n,e,o)},x.onCompleteItem=function(t,n,e,o){console.info("onCompleteItem",t,n,e,o)},x.onCompleteAll=function(){console.info("onCompleteAll"),t.reloadData(),t.onClear(),d.swal("Acción exitosa","La información ha sido guardada satisfactoriamente","success")},t.dtInstanceCustomerDocument={},t.dtOptionsCustomerDocument=o.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.operation="document",e.customerId=n.customerId,t.$storage.hideCustomerAttachmentCanceled&&(e.statusCode="2"),JSON.stringify(e)},url:"api/customer-document",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){S()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(n,e,o){r(angular.element(n).contents())(t)}),t.dtColumnsCustomerDocument=[a.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,n,e,o){var a=t.documentUrl?t.documentUrl:"",i="api/document/download?id="+t.id,r="",l='<a target="_self" class="btn btn-primary btn-xs downloadDocumentRow lnk" href="'+i+'" uib-tooltip="Descargar anexo" data-id="'+t.id+'" >   <i class="fa fa-download"></i></a> ',s='<a class="btn btn-info btn-xs openDocumentRow lnk" target="_blank" href="'+a+'" uib-tooltip="Abrir anexo" data-id="'+t.id+'" >   <i class="fa fa-folder-open-o"></i></a> ',u='<a class="btn btn-danger btn-xs delDocumentRow lnk" href="#" uib-tooltip="Anular anexo" data-id="'+t.id+'" >   <i class="fa fa-ban"></i></a> ',d=!1;return null==t.protectionType?d=!0:"public"==t.protectionType?d=!0:"private"==t.protectionType&&1==t.hasPermission&&(d=!0),c.can("clientes_anexo_open")&&""!=a&&(r+=s),c.can("clientes_anexo_download")&&""!=a&&(r+=l),c.can("clientes_anexo_invalidate")&&(r+=u),d?r:""}),a.newColumn("documentType").withTitle("Tipo de documento").withOption("width",200).withOption("defaultContent",""),a.newColumn("classification").withTitle("Clasificación").withOption("width",200).withOption("defaultContent",""),a.newColumn("description").withTitle("Descripción").withOption("width",200).withOption("defaultContent",""),a.newColumn("version").withTitle("Versión").withOption("width",200).withOption("defaultContent",""),a.newColumn("dateOfCreation").withTitle("Fecha Creación").withOption("width",200).withOption("defaultContent",""),a.newColumn("createdBy").withTitle("Usuario").withOption("width",200).withOption("defaultContent",""),a.newColumn("status").withTitle("Estado").withOption("width",200).renderWith(function(t,n,e,o){var a="";switch(t){case"Vigente":a="label label-success";break;case"Anulado":a="label label-danger"}var i='<span class="'+a+'">'+t+"</span>";return i})];var S=function(){angular.element("#dtCustomerDocument a.delDocumentRow").on("click",function(){var n=angular.element(this).data("id");g({boxWidth:"35%",useBootstrap:!1,animation:"bottom",closeAnimation:"scale",title:"Está seguro?",content:"<strong>Anulará</strong> el anexo seleccionado",scope:t,type:"red",typeAnimated:!0,buttons:{cancel:{text:"Anular y cambiar versión",btnClass:"btn-primary",action:function(e,o){t.attachment.id=n,t.isView=!1,T(n),l.pop("info","Anulación Anexo","El anexo se cargó satisfactoriamente, seleccione una nueva versión del documento")}},fullCancel:{text:"Anular definitivamente",btnClass:"btn-red",action:function(o,a){var i={};i.id=n,m({method:"POST",url:"api/document/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(n){swal("Eliminado","Anexo anulado satisfactoriamente","info"),t.reloadData()})["catch"](function(t){e.error(t),d.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}},closeAll:{text:"Cancelar",btnClass:"btn-default",action:function(t,n){}}}})})};t.dtInstanceCustomerDocumentCallback=function(n){t.dtInstanceCustomerDocument=n},t.reloadData=function(){t.dtInstanceCustomerDocument.reloadData()},t.onEdit=function(n){t.isView=!1,T(n)},t.onShowCancelledChange=function(){t.reloadData()},t.onClear=function(){y()},t.settings=function(){null!=t.$parent&&t.$parent.navToSection("setting","setting",n.customerId)}}]);
"use strict";app.controller("customerDocumentSettingCtrl",["$scope","$stateParams","$log","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","ListService","DTOptionsBuilder","DTColumnBuilder",function(t,e,n,o,i,a,r,u,c,s,l,d,m){function p(){var n=[{name:"customer_document_type",value:e.customerId}];l.getDataList(n).then(function(e){t.documentTypeList=e.data.data.customerDocumentType},function(e){t.status="Unable to load customer data: "+e.message})}t.documentTypes=[];var f=function(){t.setting={id:0,customerId:e.customerId,documentType:null,isPublic:!1,isProtected:!1,users:[]}};f(),p();var h=function(){var e={type:t.setting.documentType?t.setting.documentType.value:null,origin:t.setting.documentType?t.setting.documentType.origin:null,customerId:t.setting.customerId};c({method:"POST",url:"api/customer-document-security/get-relation",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)})["catch"](function(t,e){if(403==e){var n=null!==t.message&&void 0!==t.message?t.message:"app.clientes.list";s.swal("No Autorizado","No estas autorizado para ver esta información.","error"),u(function(){a.go(n)},3e3)}else 404==e?(s.swal("Información no disponible","Anexo no encontrado","error"),u(function(){a.go("app.clientes.list")})):s.swal("Error","Se ha presentado un error al intentar acceder a la información del anexo","error")}).then(function(e){u(function(){var n=t.setting.documentType;t.setting=e.data.result,null==t.setting.documentType&&(t.setting.documentType=n)})})["finally"](function(){u(function(){t.loading=!1},400)})};t.onSave=function(){var e={},o=JSON.stringify(t.setting);return e.data=Base64.encode(o),c({method:"POST",url:"api/customer-document-security/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){u(function(){i.pop("success","Operación Exitosa","Actualización exitosa.");var n=angular.copy(t.setting.documentType);t.setting=e.data.result,null==t.setting.documentType&&(t.setting.documentType=n)})})["catch"](function(t){n.error(t),i.pop("error","Error","Error guardando el registro. Por favor verifique los datos ingresados!")})["finally"](function(){})};var g=function(o,a,r){var s={},l=JSON.stringify({id:o,customerId:e.customerId,userId:a,documentType:t.setting.documentType,isActive:0!=r&&r?0:1});return s.data=Base64.encode(l),c({method:"POST",url:"api/customer-document-security-user/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(s)}).then(function(e){u(function(){i.pop("success","Operación Exitosa","Actualización exitosa."),t.reloadData()})})["catch"](function(t){n.error(t),i.pop("error","Error","Error guardando el registro. Por favor verifique los datos ingresados!")})["finally"](function(){})};t.onSelectDocumentType=function(e,n){u(function(){null!=t.setting.documentType&&(h(),t.reloadData())})},t.onClear=function(){u(function(){f()})},t.onCancel=function(e){null!=t.$parent&&t.$parent.navToSection("list","list")},t.dtOptionsCustomerDocumentSecurityUser=d.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerId=t.setting.customerId,e.documentType=t.setting.documentType?t.setting.documentType.value:-1,e.origin=t.setting.documentType?t.setting.documentType.origin:-1,JSON.stringify(e)},url:"api/customer-document-security-user",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){w()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,n,i){o(angular.element(e).contents())(t)}),t.dtColumnsCustomerDocumentSecurityUser=[m.newColumn("userName").withTitle("Nombre").withOption("defaultContent",""),m.newColumn("userType").withTitle("Tipo Usuario").withOption("defaultContent",""),m.newColumn("userEmail").withTitle("E-mail").withOption("defaultContent",""),m.newColumn(null).withTitle("Permitir").withOption("width",200).notSortable().renderWith(function(e,n,o,i){var a="",r=e.id?e.id:0,u=9998*Math.random()+1,c="1"==e.isActive?"checked":"",s=t.isView?" disabled='disabled'":"",l='<div class="checkbox clip-check check-success "><input class="selectedRowSecurity" type="checkbox" id="chk_'+u+'" data-id="'+r+'" data-value="'+e.isActive+'" data-user="'+e.userId+'" '+c+s+' ><label for="chk_'+u+'"> Seleccionar </label></div>';return e.isDeleted||(a+=l),a}),m.newColumn(null).withTitle("Fecha Modificación").withOption("width",200).renderWith(function(t,e,n,o){return t.updatedAt?moment(t.updatedAt.date).format("DD/MM/YYYY HH:mm"):null}),m.newColumn("updatedBy").withTitle("Usuario").withOption("width",200).withOption("defaultContent","")];var w=function(){angular.element("#dtCustomerDocumentSecurityUser input.selectedRowSecurity").on("change",function(){var t=angular.element(this).data("id"),e=angular.element(this).data("user"),n=angular.element(this).data("value");g(t,e,n)})};t.dtInstanceCustomerDocumentSecurityUserCallback=function(e){t.dtInstanceCustomerDocumentSecurityUser=e},t.reloadData=function(){null!=t.dtInstanceCustomerDocumentSecurityUser&&t.dtInstanceCustomerDocumentSecurityUser.reloadData()}}]);
"use strict";app.controller("customerPollCtrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout",function(o,t,l,e,c,n){var r=l;r.info("loading..customerPollCtrl!!! "),o.poll_section="list",o.currentPoll=0,o.modeDsp="edit",o.navToSection=function(t,l,e){n(function(){o.poll_section=t,o.modeDsp=l,o.$parent.switchSubTab(l),o.currentPoll=e})}}]);
"use strict";app.controller("customerPollListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","SweetAlert","$http","$filter","$document",function(t,i,e,n,a,o,l,s,r,c,u,d,w,p,h){var m=e,f={};m.info("loading..customerPollListCtrl "),f.operation="poll",f.customer_id=i.customerId,t.agents=c.agents(),t.dtInstancePoll={},t.dtOptionsPoll=n.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:f,url:"api/customer/poll",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){b()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(i,e,n){l(angular.element(i).contents())(t)}),t.dtColumnsPoll=[a.newColumn(null).withTitle("Acciones").withOption("width",110).notSortable().renderWith(function(t,i,e,n){var a="",o='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Contestar encuesta" data-id="'+t.id+'" >   <i class="fa fa-play-circle"></i></a> ',l='<a class="btn btn-info btn-xs viewRow lnk" href="#" uib-tooltip="Ver encuesta" data-id="'+t.id+'" >   <i class="fa fa-eye"></i></a> ';return c.can("seguimiento_view")&&(a+=l),c.can("seguimiento_edit")&&("Iniciada"!=t.status.item&&"Asignada"!=t.status.item||(a+=o)),a}),a.newColumn("poll.name").withTitle("Encuesta").withOption("width",300),a.newColumn("poll.description").withTitle("Descripción").withOption("width"),a.newColumn("poll.endDateTime").withTitle("Fecha Vencimiento").withOption("width",200),a.newColumn("answerCount").withTitle("Respuestas").withOption("width",150),a.newColumn("status.item").withTitle("Estado").withOption("width",150).renderWith(function(t,i,e,n){var a="";switch(t){case"Iniciada":a="label label-info";break;case"Completada":a="label label-success";break;case"Asignada":a="label label-warning";break;case"Vencida":a="label label-danger"}var o='<span class="'+a+'">'+t+"</span>";return o})];var b=function(){$("#dtCustomerPoll a.editRow").on("click",function(){var i=$(this).data("id");t.editPoll(i)}),$("#dtCustomerPoll a.viewRow").on("click",function(){var i=$(this).data("id");t.viewPoll(i)})};t.reloadData=function(){t.dtInstancePoll.reloadData()},t.editPoll=function(i){null!=t.$parent&&t.$parent.navToSection("form","edit",i)},t.viewPoll=function(i){null!=t.$parent&&t.$parent.navToSection("form","view",i)}}]);
"use strict";app.controller("customerPollEditCtrl",["$scope","$stateParams","$log","toaster","$compile","$state","SweetAlert","$rootScope","$http","$timeout","$uibModal","flowFactory","cfpLoadingBar","$filter",function(o,e,n,r,t,a,i,l,s,c,u,d,f,m){var p=n,w=o.$parent.currentPoll;o.isAgent="agent"==l.currentUser().wg_type,o.isAdmin="system"==l.currentUser().wg_type,o.isCustomer="customerAdmin"==l.currentUser().wg_type||"customerUser"==l.currentUser().wg_type,p.info("loading..customerPollEditCtrl con el id de poll: ",w),o.isView="view"==o.$parent.modeDsp,o.customerId=e.customerId,o.answerCount=0,p.info(o.isView),o.booleanAnswers=[{id:"0",item:"Si",value:"1"},{id:"1",item:"No",value:"0"}],o.customerPoll={id:0,poll:null},o.cancelEdition=function(){o.isView?null!=o.$parent&&o.$parent.navToSection("list","list"):i.swal({title:"Está seguro?",text:"Perderá todos los cambios realizados en este formulario.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, cancelar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(e){e?c(function(){null!=o.$parent&&o.$parent.navToSection("list","list")}):swal("Cancelación","La operación ha sido cancelada","error")})};var g=function(e){var n={id:e};s({method:"GET",url:"api/customer/poll",params:n})["catch"](function(o,e){if(403==e){var n=null!==o.message&&void 0!==o.message?o.message:"app.clientes.list";i.swal("No Autorizado","No estas autorizado para ver esta información.","error"),c(function(){a.go(n)},3e3)}else 404==e?(i.swal("Información no disponible","Seguimiento no encontrado","error"),c(function(){a.go("app.clientes.list")})):i.swal("Error","Se ha presentado un error al intentar acceder a la información del seguimiento","error")}).then(function(e){c(function(){o.customerPoll=e.data.result,o.answerCount=o.customerPoll.answerCount})})["finally"](function(){c(function(){v(),o.loading=!1},400)})};c(function(){v()},10);var v=function(){};0!=w&&g(w),o.master=o.poll,o.form={submit:function(e){var n=null;if(e.$invalid){var r=null,n=null;for(r in e)"$"!=r[0]&&(null!==n||e[r].$valid||(n=e[r].$name),e[r].$pristine&&(e[r].$dirty=!0));return p.info(o.customer),angular.element(".ng-invalid[name="+n+"]").focus(),void i.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}i.swal("Validación exitosa","Procediendo con el guardado...","success"),p.info(o.customer),P()},reset:function(e){o.poll=angular.copy(o.master),e.$setPristine(!0)}};var P=function(){angular.forEach(o.customerPoll.poll.questions,function(e,n){o.savePartial(e)})};o.onSendPoll=function(e){i.swal({title:"Está seguro?",text:"Luego de enviar la encuesta no se podra modificar.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, enviar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(e){e?c(function(){var e={},t=JSON.stringify(o.customerPoll);return e.data=Base64.encode(t),s({method:"POST",url:"api/customer/poll/send",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){c(function(){o.$parent.navToSection("list","list")})})["catch"](function(o){n.error(o),r.pop("error","Error","Error guardando el registro. Por favor verifique los datos ingresados!")})["finally"](function(){})}):swal("Cancelación","La operación ha sido cancelada","error")})},o.savePartial=function(e){var t={},a={customerPollId:o.customerPoll.id,question:e,isActive:1},i=JSON.stringify(a);return t.data=Base64.encode(i),s({method:"POST",url:"api/customer/poll/answer/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(n){e.answerId=n.data.result.id,o.answerCount=n.data.result.poll.answerCount,c(function(){r.pop("success","Operación Exitosa","Actualización exitosa.")})})["catch"](function(o){n.error(o),r.pop("error","Error","Error guardando el registro. Por favor verifique los datos ingresados!")})["finally"](function(){})}}]);
"use strict";app.controller("customerSafetyInspectionTabsCtrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout","$state","$filter","flowFactory","$http",function(t,e,r,s,n,o,c,a,i,u){t.isAgent="agent"==n.currentUser().wg_type,t.isAdmin="system"==n.currentUser().wg_type,t.isCustomer="customerAdmin"==n.currentUser().wg_type||"customerUser"==n.currentUser().wg_type,t.tabname="program",t.switchTab=function(e,r){o(function(){t.tabname=e,t.titletab=r,t.tabsloaded.push(e)})},t.switchSubTab=function(e){o(function(){t.subtab=e})}}]);
"use strict";app.controller("customerSafetyInspectionConfigHeaderCtrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout",function(t,e,o,n,i,r){var c=o;c.info("loading..customerTrackingCtrl!!! "),t.tracking_section="list",t.currentConfigHeaderId=0,t.modeDsp="edit",t.navToSection=function(e,o,n){r(function(){t.tracking_section=e,t.modeDsp=o,t.$parent.switchSubTab(o),t.currentConfigHeaderId=n})}}]);
"use strict";app.controller("customerSafetyInspectionConfigHeaderEditCtrl",["$scope","$stateParams","$log","$compile","$state","SweetAlert","$rootScope","$http","$timeout","$uibModal","flowFactory","cfpLoadingBar","$filter","$aside",function(e,r,n,a,o,t,i,s,l,c,d,u,f,m){var p=n,g=e.$parent.currentConfigHeaderId;e.isAgent="agent"==i.currentUser().wg_type,e.isAdmin="system"==i.currentUser().wg_type,e.isCustomer="customerAdmin"==i.currentUser().wg_type||"customerUser"==i.currentUser().wg_type,p.info("loading..customerTrackingEditCtrl con el id de tracking: ",g),e.customerId=r.customerId,e.dataTypes=i.parameters("wg_data_type"),e.dateConfig={culture:"es-CO",format:"dd/MM/yyyy"},e.header={id:0,customerId:e.customerId,name:"",description:"",version:"",dateFrom:null,isActive:0,fields:[]};var h=e.$parent.$parent.$parent.modeDsp.toString();"view"===h.toString()?e.isView=!0:e.isView=!1,e.cancelEdition=function(r){e.isView?null!=e.$parent&&e.$parent.navToSection("list","list"):t.swal({title:"Está seguro?",text:"Perderá todos los cambios realizados en este formulario.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, cancelar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(r){r?l(function(){null!=e.$parent&&e.$parent.navToSection("list","list")}):swal("Cancelación","La operación ha sido cancelada","error")})};var w=function(r){if(0!=r){var n={id:r};s({method:"GET",url:"api/customer/safety-inspection-config-header",params:n})["catch"](function(e,r){if(403==r){var n=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";t.swal("No Autorizado","No estas autorizado para ver esta información.","error"),l(function(){o.go(n)},3e3)}else 404==r?(t.swal("Información no disponible","Seguimiento no encontrado","error"),l(function(){o.go("app.clientes.list")})):t.swal("Error","Se ha presentado un error al intentar acceder a la información del seguimiento","error")}).then(function(r){l(function(){e.header=r.data.result,null!=e.header.dateFrom&&void 0!=e.header.dateFrom.date&&(e.header.dateFrom=new Date(e.header.dateFrom.date))})})["finally"](function(){l(function(){e.loading=!1},400)})}};w(g),e.master=e.header,e.form={submit:function(r){var n=null;if(r.$invalid){var a=null,n=null;for(a in r)"$"!=a[0]&&(null!==n||r[a].$valid||(n=r[a].$name),r[a].$pristine&&(r[a].$dirty=!0));return p.info(e.customer),angular.element(".ng-invalid[name="+n+"]").focus(),void t.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}t.swal("Validación exitosa","Procediendo con el guardado...","success"),p.info(e.customer),v()},reset:function(r){e.header=angular.copy(e.master),r.$setPristine(!0)}};var v=function(){var r={},a=JSON.stringify(e.header);return r.data=Base64.encode(a),s({method:"POST",url:"api/customer/safety-inspection-config-header/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(r)}).then(function(r){l(function(){e.header=r.data.result,null!=e.$parent&&e.$parent.navToSection("list","list")})})["catch"](function(e){n.error(e),t.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};e.onAddField=function(){l(function(){null==e.header.fields&&(e.header.fields=[]),e.header.fields.push({id:0,customerSafetyInspectionHeaderId:g,name:"",dataType:null,sort:0,isActive:!0})})},e.onRemoveField=function(r){t.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(a){a?l(function(){var a=e.header.fields[r];if(0!=a.id){var o={};o.id=a.id,s({method:"POST",url:"api/customer/safety-inspection-config-header-field/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(n){swal("Eliminado","Registro eliminado satisfactoriamente","info"),e.header.fields.splice(r,1)})["catch"](function(e){n.error(e),t.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}else e.header.fields.splice(r,1)}):swal("Cancelación","La operación ha sido cancelada","error")})}}]);
"use strict";app.controller("customerSafetyInspectionConfigHeaderListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","SweetAlert","$http","$filter","$document",function(t,e,n,i,o,a,r,c,l,s,d,u,f,p,w){var h=n,m={};h.info("loading..customerSafetyInspectionConfigHeaderListCtrl "),m.operation="safety",m.customer_id=e.customerId,t.dtInstanceSafetyInspectionConfigHeader={},t.dtOptionsSafetyInspectionConfigHeader=i.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:m,url:"api/customer/safety-inspection-config-header",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){C()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,n,i){r(angular.element(e).contents())(t)}),t.dtColumnsSafetyInspectionConfigHeader=[o.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,e,n,i){var o="",a='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+t.id+'" >   <i class="fa fa-edit"></i></a> ',r='<a class="btn btn-info btn-xs viewRow lnk" href="#" uib-tooltip="Ver" data-id="'+t.id+'" >   <i class="fa fa-eye"></i></a> ',c='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+t.id+'" >   <i class="fa fa-trash-o"></i></a> ';return s.can("seguimiento_view")&&(o+=r),s.can("seguimiento_edit")&&(o+=a),s.can("seguimiento_delete")&&(o+=c),o}),o.newColumn("name").withTitle("Nombre").withOption("width",300),o.newColumn("description").withTitle("Descripción"),o.newColumn("dateFromText").withTitle("Fecha Creación").withOption("width",150).withOption("defaultContent",""),o.newColumn("version").withTitle("Version").withOption("width",100),o.newColumn("isActive").withTitle("Estado").withOption("width",100).renderWith(function(t,e,n,i){var o="",a="";t?(o="label label-success",a="Activo"):(o="label label-danger",a="Inactivo");var r='<span class="'+o+'">'+a+"</span>";return r})];var C=function(){$("#dtSafetyInspectionConfigHeader a.editRow").on("click",function(){var e=$(this).data("id");t.onEditRecord(e)}),$("a.downloadRow").on("click",function(){var t=$(this).data("id"),e=$(this).data("url");""==e&&(jQuery("#downloadDocument")[0].src="api/customer/safety-inspection-config-header/download?id="+t)}),$("#dtSafetyInspectionConfigHeader a.viewRow").on("click",function(){var e=$(this).data("id");t.onViewRecord(e)}),$("#dtSafetyInspectionConfigHeader a.delRow").on("click",function(){var e=$(this).data("id");h.info("intenta eliminar el registro: "+e),u.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(i){if(i){var o={};o.id=e,f({method:"POST",url:"api/customer/safety-inspection-config-header/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){n.error(t),u.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){t.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};t.reloadData=function(){t.dtInstanceSafetyInspectionConfigHeader.reloadData()},t.onCreateNew=function(e){null!=t.$parent&&t.$parent.navToSection("form","edit",0)},t.onEditRecord=function(e){null!=t.$parent&&t.$parent.navToSection("form","edit",e)},t.onViewRecord=function(e){null!=t.$parent&&t.$parent.navToSection("form","view",e)}}]);
"use strict";app.controller("customerSafetyInspectionConfigListCtrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout",function(t,o,i,n,c,e){var r=i;r.info("loading..customerTrackingCtrl!!! "),t.tracking_section="list",t.currentConfigListId=0,t.modeDsp="edit",t.navToSection=function(o,i,n){e(function(){t.tracking_section=o,t.modeDsp=i,t.$parent.switchSubTab(i),t.currentConfigListId=n})}}]);
"use strict";app.controller("customerSafetyInspectionConfigListEditCtrl",["$scope","$stateParams","$log","$compile","$state","SweetAlert","$rootScope","$http","$timeout","$uibModal","flowFactory","cfpLoadingBar","$filter","$aside",function(e,n,i,t,o,r,a,s,l,c,u,d,f,m){var p=i,g=e.$parent.currentConfigListId;e.isAgent="agent"==a.currentUser().wg_type,e.isAdmin="system"==a.currentUser().wg_type,e.isCustomer="customerAdmin"==a.currentUser().wg_type||"customerUser"==a.currentUser().wg_type,p.info("loading..customerTrackingEditCtrl con el id de tracking: ",g),e.customerId=n.customerId,e.dataTypes=a.parameters("wg_data_type"),e.dateConfig={culture:"es-CO",format:"dd/MM/yyyy"},e.list={id:0,customerId:e.customerId,name:"",description:"",version:"",dateFrom:null,isActive:0,groups:[],dangerousnessList:[],priorityList:[],existingControlList:[]};var w=e.$parent.$parent.$parent.$parent.$parent.$parent.modeDsp.toString();"view"===w.toString()?e.isView=!0:e.isView=!1,e.cancelEdition=function(n){e.isView?null!=e.$parent&&e.$parent.navToSection("list","list"):r.swal({title:"Está seguro?",text:"Perderá todos los cambios realizados en este formulario.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, cancelar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(n){n?l(function(){null!=e.$parent&&e.$parent.navToSection("list","list")}):swal("Cancelación","La operación ha sido cancelada","error")})};var v=function(n){if(0!=n){var i={id:n};s({method:"GET",url:"api/customer/safety-inspection-config-list",params:i})["catch"](function(e,n){if(403==n){var i=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";r.swal("No Autorizado","No estas autorizado para ver esta información.","error"),l(function(){o.go(i)},3e3)}else 404==n?(r.swal("Información no disponible","Seguimiento no encontrado","error"),l(function(){o.go("app.clientes.list")})):r.swal("Error","Se ha presentado un error al intentar acceder a la información del seguimiento","error")}).then(function(n){l(function(){e.list=n.data.result,null!=e.list.dateFrom&&void 0!=e.list.dateFrom.date&&(e.list.dateFrom=new Date(e.list.dateFrom.date))})})["finally"](function(){l(function(){e.loading=!1},400)})}};v(g),e.master=e.list,e.form={submit:function(n){var i=null;if(n.$invalid){var t=null,i=null;for(t in n)"$"!=t[0]&&(null!==i||n[t].$valid||(i=n[t].$name),n[t].$pristine&&(n[t].$dirty=!0));return p.info(e.customer),angular.element(".ng-invalid[name="+i+"]").focus(),void r.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}r.swal("Validación exitosa","Procediendo con el guardado...","success"),p.info(e.customer),y()},reset:function(n){e.list=angular.copy(e.master),n.$setPristine(!0)}};var y=function(){var n={},t=JSON.stringify(e.list);return n.data=Base64.encode(t),s({method:"POST",url:"api/customer/safety-inspection-config-list/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(n){l(function(){e.list=n.data.result,null!=e.$parent&&e.$parent.navToSection("list","list")})})["catch"](function(e){i.error(e),r.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};e.onAddGroup=function(){l(function(){null==e.list.groups&&(e.list.groups=[]),e.list.groups.push({id:0,customerSafetyInspectionHeaderId:g,name:"",dataType:null,sort:0,isActive:!0})})},e.onRemoveGroup=function(n){r.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(t){t?l(function(){var t=e.list.groups[n];if(0!=t.id){var o={};o.id=t.id,s({method:"POST",url:"api/customer/safety-inspection-config-list-group/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(i){swal("Eliminado","Registro eliminado satisfactoriamente","info"),e.list.groups.splice(n,1)})["catch"](function(e){i.error(e),r.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}else e.list.groups.splice(n,1)}):swal("Cancelación","La operación ha sido cancelada","error")})},e.onAddExistingControl=function(){l(function(){null==e.list.existingControlList&&(e.list.existingControlList=[]),e.list.existingControlList.push({id:0,customerSafetyInspectionHeaderId:g,type:"existingControl",description:"",value:0,isActive:!0})})},e.onRemoveExistingControl=function(n){r.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(t){t?l(function(){var t=e.list.existingControlList[n];if(0!=t.id){var o={};o.id=t.id,s({method:"POST",url:"api/customer/safety-inspection-config-list-validation/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(i){swal("Eliminado","Registro eliminado satisfactoriamente","info"),e.list.existingControlList.splice(n,1)})["catch"](function(e){i.error(e),r.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}else e.list.existingControlList.splice(n,1)}):swal("Cancelación","La operación ha sido cancelada","error")})},e.onAddDangerousness=function(){l(function(){null==e.list.dangerousnessList&&(e.list.dangerousnessList=[]),e.list.dangerousnessList.push({id:0,customerSafetyInspectionHeaderId:g,type:"dangerousness",description:"",value:0,isActive:!0})})},e.onRemoveDangerousness=function(n){r.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(t){t?l(function(){var t=e.list.dangerousnessList[n];if(0!=t.id){var o={};o.id=t.id,s({method:"POST",url:"api/customer/safety-inspection-config-list-validation/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(i){swal("Eliminado","Registro eliminado satisfactoriamente","info"),e.list.dangerousnessList.splice(n,1)})["catch"](function(e){i.error(e),r.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}else e.list.dangerousnessList.splice(n,1)}):swal("Cancelación","La operación ha sido cancelada","error")})},e.onAddPriority=function(){l(function(){null==e.list.priorityList&&(e.list.priorityList=[]),e.list.priorityList.push({id:0,customerSafetyInspectionHeaderId:g,type:"priority",description:"",value:0,isActive:!0})})},e.onRemovePriority=function(n){r.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(t){t?l(function(){var t=e.list.priorityList[n];if(0!=t.id){var o={};o.id=t.id,s({method:"POST",url:"api/customer/safety-inspection-config-list-validation/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(i){swal("Eliminado","Registro eliminado satisfactoriamente","info"),e.list.priorityList.splice(n,1)})["catch"](function(e){i.error(e),r.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}else e.list.priorityList.splice(n,1)}):swal("Cancelación","La operación ha sido cancelada","error")})}}]);
"use strict";app.controller("customerSafetyInspectionConfigListGroupEditCtrl",["$scope","$stateParams","$log","$compile","$state","SweetAlert","$rootScope","$http","$timeout","$uibModal","flowFactory","cfpLoadingBar","$filter","$aside","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$document",function(e,t,i,n,o,r,a,s,l,c,d,u,f,p,m,w,g,h){var v=i,C={},b=e.$parent.currentConfigListId;e.isAgent="agent"==a.currentUser().wg_type,e.isAdmin="system"==a.currentUser().wg_type,e.isCustomer="customerAdmin"==a.currentUser().wg_type||"customerUser"==a.currentUser().wg_type,e.loading=!0,e.customerId=t.customerId,console.log();var y=e.$parent.$parent.$parent.$parent.$parent.$parent.modeDsp.toString();"view"===y.toString()?e.isView=!0:e.isView=!1,console.log(e.isView),e.item={},e.groups=[],e.onLoadRecord=function(){if(0!=e.item.id){v.info("editando cliente con código: "+e.item.id);var t={id:e.item.id};s({method:"GET",url:"api/customer/safety-inspection-config-list-item",params:t})["catch"](function(e,t){if(403==t){var i=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";r.swal("No Autorizado","No estas autorizado para ver esta información.","error"),l(function(){o.go(i)},3e3)}else 404==t?r.swal("Información no disponible","Centro de trabajo no encontrado","error"):r.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(t){l(function(){e.item=t.data.result})})["finally"](function(){l(function(){e.loading=!1},400),l(function(){h.scrollTop(40,2e3)})})}else v.info("creacion de nuevo cliente"),e.loading=!1};var I=function(){var t={};return t.operation="list",t.listId=b,s({method:"POST",url:"api/customer/safety-inspection-config-list-group/list",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){l(function(){e.groups=t.data.data})})["catch"](function(e){i.error(e),r.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})},O=function(){e.item={id:0,group:null,description:"",isActive:!0}};O(),I(),e.master=e.process,e.form={submit:function(t){var i=null;if(t.$invalid){var n=null,i=null;for(n in t)"$"!=n[0]&&(null!==i||t[n].$valid||(i=t[n].$name),t[n].$pristine&&(t[n].$dirty=!0));return v.info(e.process),angular.element(".ng-invalid[name="+i+"]").focus(),void r.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}r.swal("Validación exitosa","Guardando información del centro de trabajo...","success"),e.save()},reset:function(t){e.clear()}},e.onClear=function(){l(function(){O()}),e.isView=!1},e.save=function(){var t={},n=JSON.stringify(e.item);return t.data=Base64.encode(n),s({method:"POST",url:"api/customer/safety-inspection-config-list-item/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){l(function(){e.item=t.data.result,r.swal("Validación exitosa","Información guardada","success"),e.reloadData()})})["catch"](function(e){i.error(e),r.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){e.onClear()})},C.operation="list",C.listId=b,e.dtInstanceConfigListGroupItem={},e.dtOptionsConfigListGroupItem=m.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:C,url:"api/customer/safety-inspection-config-list-item",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){T()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,i,o){n(angular.element(t).contents())(e)}),e.dtColumnsConfigListGroupItem=[w.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,i,n,o){var r="",s="",l='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar"  data-id="'+t.id+'"'+s+' >   <i class="fa fa-edit"></i></a> ',c=('<a class="btn btn-info btn-xs viewRow lnk" href="#"  uib-tooltip="Ver" data-id="'+t.id+'" >   <i class="fa fa-eye"></i></a> ','<a class="btn btn-danger btn-xs delRow lnk" href="#"  uib-tooltip="Eliminar" data-id="'+t.id+'"'+s+' >   <i class="fa fa-trash-o"></i></a> ');return a.can("clientes_edit")&&(r+=l),a.can("clientes_delete")&&(r+=c),e.isView?"":r}),w.newColumn("group.description").withTitle("Grupo").withOption("width",400).withOption("defaultContent",""),w.newColumn("description").withTitle("Item"),w.newColumn("isActive").withTitle("Estado").withOption("width",100).renderWith(function(e,t,i,n){var o="",r="";e?(o="label label-success",r="Activo"):(o="label label-danger",r="Inactivo");var a='<span class="'+o+'">'+r+"</span>";return a})],e.editItem=function(t){e.item.id=t,e.isView=!1,e.onLoadRecord()},e.viewItem=function(t){e.process.id=t,e.isView=!0,e.onLoadRecord()},e.cancelEdition=function(t){null!=e.$parent&&e.$parent.navToSection("list","list")};var T=function(){$("#dtConfigListGroupItem a.editRow").on("click",function(){var t=$(this).data("id");e.editItem(t)}),$("#dtConfigListGroupItem a.viewRow").on("click",function(){var t=$(this).data("id");e.process.id=t,e.viewItem(t)}),$("#dtConfigListGroupItem a.delRow").on("click",function(){var t=$(this).data("id");v.info("intenta eliminar el registro: "+t),r.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(n){if(n){var o={};o.id=t,s({method:"POST",url:"api/customer/safety-inspection-config-list-item/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){i.error(e),r.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){e.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};e.reloadData=function(){e.dtInstanceConfigListGroupItem.reloadData()},e.refreshGroup=function(){I()}}]);
"use strict";app.controller("customerSafetyInspectionConfigListListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","SweetAlert","$http","$filter","$document",function(t,i,n,e,o,a,r,s,l,c,d,f,u,p,w){var m=n,h={};m.info("loading..customerSafetyInspectionConfigListListCtrl "),h.operation="safety",h.customer_id=i.customerId,t.dtInstanceSafetyInspectionConfigList={},t.dtOptionsSafetyInspectionConfigList=e.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:h,url:"api/customer/safety-inspection-config-list",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){C()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(i,n,e){r(angular.element(i).contents())(t)}),t.dtColumnsSafetyInspectionConfigList=[o.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,i,n,e){var o="",a='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+t.id+'" >   <i class="fa fa-edit"></i></a> ',r='<a class="btn btn-info btn-xs viewRow lnk" href="#" uib-tooltip="Ver" data-id="'+t.id+'" >   <i class="fa fa-eye"></i></a> ',s='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+t.id+'" >   <i class="fa fa-trash-o"></i></a> ';return c.can("seguimiento_view")&&(o+=r),c.can("seguimiento_edit")&&(o+=a),c.can("seguimiento_delete")&&(o+=s),o}),o.newColumn("name").withTitle("Nombre").withOption("width",300),o.newColumn("description").withTitle("Descripción"),o.newColumn("dateFromText").withTitle("Fecha Creación").withOption("width",150).withOption("defaultContent",""),o.newColumn("version").withTitle("Version").withOption("width",100),o.newColumn("isActive").withTitle("Estado").withOption("width",100).renderWith(function(t,i,n,e){var o="",a="";t?(o="label label-success",a="Activo"):(o="label label-danger",a="Inactivo");var r='<span class="'+o+'">'+a+"</span>";return r})];var C=function(){$("#dtSafetyInspectionConfigList a.editRow").on("click",function(){var i=$(this).data("id");t.onEditRecord(i)}),$("#dtSafetyInspectionConfigList a.downloadRow").on("click",function(){var t=$(this).data("id"),i=$(this).data("url");""==i&&(jQuery("#downloadDocument")[0].src="api/customer/safety-inspection-config-list/download?id="+t)}),$("#dtSafetyInspectionConfigList a.viewRow").on("click",function(){var i=$(this).data("id");t.onViewRecord(i)}),$("#dtSafetyInspectionConfigList a.delRow").on("click",function(){var i=$(this).data("id");m.info("intenta eliminar el registro: "+i),f.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(e){if(e){var o={};o.id=i,u({method:"POST",url:"api/customer/safety-inspection-config-list/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){n.error(t),f.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){t.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};t.reloadData=function(){t.dtInstanceSafetyInspectionConfigList.reloadData()},t.onCreateNew=function(i){null!=t.$parent&&t.$parent.navToSection("form","edit",0)},t.onEditRecord=function(i){null!=t.$parent&&t.$parent.navToSection("form","edit",i)},t.onViewRecord=function(i){null!=t.$parent&&t.$parent.navToSection("form","view",i)}}]);
"use strict";app.controller("customerSafetyInspectionCtrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout",function(t,e,n,o,c,i){var r=n;r.info("loading..customerSafetyInspectionCtrl!!! "),t.tracking_section="list",t.currentSafetyInspectionId=0,t.modeDsp="edit",t.navToSection=function(e,n,o){i(function(){t.tracking_section=e,t.modeDsp=n,t.$parent.switchSubTab(n),t.currentSafetyInspectionId=o})}}]);
"use strict";app.controller("customerSafetyInspectionListItemEditCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","SweetAlert","$rootScope","$http","$timeout","$uibModal","flowFactory","cfpLoadingBar","$document","$filter","$aside","FileUploader","ListService","ngNotify",function(t,e,n,i,o,a,r,s,l,c,u,d,p,m,f,h,w,g,v,y,b,C){function O(){var e=[{name:"customer_safety_inspection_list",value:D},{name:"customer_safety_inspection_header_fields",value:D}];b.getDataList(e).then(function(e){t.lists=e.data.data.customerSafetyInspectionList,t.headerFields=e.data.data.customerSafetyInspectionHeaderFields,!t.criteria.list&&t.lists.length>0&&(t.criteria.list=t.lists[0]),A()},function(e){t.status="Unable to load customer data: "+e.message})}function I(){var e=[{name:"customer_safety_inspection_header_fields",value:D}];b.getDataList(e).then(function(e){t.headerFields=e.data.data.customerSafetyInspectionHeaderFields,A()},function(e){t.status="Unable to load customer data: "+e.message})}t.currentStep=0,t.criteria={list:null},t.actions=u.parameters("wg_safety_inspection_action"),t.dangerousnessList=[],t.existingControlList=[];var S={refresh:!0,index:0},x={id:0,code:null},T={model:null},D=t.$parent.currentSafetyInspectionId;O(),t.actionOptions={dataSource:t.actions,dataTextField:"item",dataValueField:"value",select:function(t){var e=this.dataItem(t.item);p(function(){T.model.set("action",e),T.model.set("actionValue",e.value),P()})}};var k=!1,P=function(){k||(C.set("<strong>Recuerde guardar los cambios.</strong>",{position:"bottom",sticky:!1,button:!1,duration:6e3,html:!0,type:"info"},function(){k=!1,n.info("Callback triggered after message fades.")}),k=!0)},A=function(){angular.forEach(t.headerFields,function(t,e){"date"==t.dataType&&t.dateValue&&(t.dateValue=new Date(t.dateValue.date))})},L=function(t){if(t&&null!=t.existingControl&&null!=t.dangerousness){var e=parseFloat(t.existingControl.value),n=parseFloat(t.dangerousness.value);return e*n}return 0},_=function(){O(),t.grid.dataSource.read()};p(function(){t.mainGridOptions={dataSource:{type:"odata",transport:{read:{url:"api/customer-safety-inspection-list-item",dataType:"json",type:"POST",data:function(){var t={customerSafetyInspectionId:D,customerSafetyInspectionConfigListId:x.id};return t}},parameterMap:function(t,e){return JSON.stringify(t)}},schema:{model:{id:"id",fields:{description:{editable:!1,nullable:!0}}},data:function(t){return t.data||t},total:function(t){return t.recordsTotal||t.data.length||0}},batch:!0,pageSize:10,serverPaging:!0,serverFiltering:!0,serverSorting:!0},sortable:{mode:"multiple"},pageable:{change:function(t){S.index=t.index,log.info("page.index",S.index)}},filterable:{mode:"row"},toolbar:kendo.template('<a class="k-button k-button-icontext k-grid-custom-save-changes" href="\\#"><span class="k-icon k-update"></span>Guardar Cambios</a>'),dataBound:function(e){t.existingControlOptions={dataSource:t.existingControlList,dataTextField:"description",dataValueField:"id",select:function(t){var e=this.dataItem(t.item);p(function(){T.model.set("existingControl",e),T.model.set("calculate",L(T.model)),P()})}},t.dangerousnessOptions={dataSource:t.dangerousnessList,dataTextField:"description",dataValueField:"id",select:function(t){var e=this.dataItem(t.item);p(function(){T.model.set("dangerousness",e),T.model.set("calculate",L(T.model)),P()})}},this.expandRow(this.tbody.find("tr.k-master-row"))},columns:[{field:"description",title:"Grupo",attributes:{"class":"text-orange text-large"},filterable:{cell:{operator:"contains",suggestionOperator:"contains"}}},{field:null,title:"Avance",width:"150px",attributes:{style:"text-align: center"},filterable:!1,template:function(t){var e='<h4 class="no-margin">'+t.advance+"%</h4>";return e+='<uib-progressbar value="'+t.advance+'" class="progress-xs no-radius no-margin" type="success"></uib-progressbar>',e+=t.answers+" de "+t.questions}},{field:null,title:"Promedio",width:"150px",attributes:{style:"text-align: center"},filterable:!1,template:function(t){var e='<h4 class="no-margin">'+t.average+"%</h4>";return e+='<uib-progressbar value="'+t.total+'" class="progress-xs no-radius no-margin" type="success"></uib-progressbar>',e+="Promedio Total"}}]},t.detailGridOptions=function(t){return{dataSource:{type:"odata",transport:{read:{url:"api/customer-safety-inspection-list-item-question",dataType:"json",type:"POST",data:function(){var e={customerSafetyInspectionId:D,customerSafetyInspectionConfigListId:x.id,groupId:t.id};return e}},parameterMap:function(t,e){return JSON.stringify(t)}},schema:{model:{id:"id",fields:{description:{editable:!1,nullable:!0},existingControl:{editable:!0,defaultValue:{id:0,text:null,code:null}},dangerousness:{editable:!0,defaultValue:{id:0,text:null,code:null}},action:{editable:!0,defaultValue:{id:0,item:null,value:null}},calculate:{editable:!0,nullable:!0},actionValue:{editable:!0,nullable:!0}}},data:function(t){return t.data||t},total:function(t){return t.recordsTotal||t.data.length||0}},batch:!0,serverPaging:!1,serverSorting:!0,serverFiltering:!1,filter:{field:"groupId",operator:"eq",value:t.id}},editable:"incell",edit:function(t){var e=t.container.find("[name]").first().attr("name");"calculate"!=e&&"actionValue"!=e||t.sender.closeCell(),T.model=t.model},scrollable:!1,sortable:!0,pageable:!1,columns:[{command:[{text:" ",template:"<a class='btn btn-dark-azure btn btn-sm' ng-click='onSave(dataItem)' uib-tooltip='Guardar Cambios' tooltip-placement='right'><i class='fa fa-save'></i></a> "},{text:" ",template:"<a class='btn btn-light-red btn btn-sm' ng-click='onAddComment(dataItem)' uib-tooltip='Comentarios' tooltip-placement='right'><i class='fa fa-comments'></i></a> "},{text:" ",template:"<a class='btn btn-warning btn btn-sm' ng-click='onAddImprovementPlan(dataItem)' uib-tooltip='Plan Mejoramiento' tooltip-placement='right'><i class='fa fa-plus-square'></i></a> "},{text:" ",template:"<a class='btn btn-info btn btn-sm' ng-click='onAddAttachment(dataItem)' uib-tooltip='Anexos' tooltip-placement='right'><i class='fa fa-paperclip'></i></a> "}],width:"160px",headerAttributes:{style:"display: none"}},{field:"description",title:"Descripción",width:"420px",headerAttributes:{style:"display: none"}},{field:"existingControl",title:"Control",width:"220px",editor:'<input kendo-drop-down-list k-value-primitive="true" k-options="existingControlOptions"  />',template:function(t){return t.existingControl?t.existingControl.description:"-Seleccionar-"},headerAttributes:{style:"display: none"},attributes:{style:"text-align: center;font-weight: bold;","class":"text-capitalize text-dark"}},{field:"dangerousness",title:"Peligrosidad",width:"220px",editor:'<input kendo-drop-down-list k-value-primitive="true" k-options="dangerousnessOptions"  />',template:function(t){return t.dangerousness?t.dangerousness.description:"-Seleccionar-"},headerAttributes:{style:"display: none"},attributes:{style:"text-align: center;font-weight: bold;","class":"text-capitalize text-dark"}},{field:"calculate",title:"icon",width:"70px",headerAttributes:{style:"display: none"},template:function(t){var e=t.calculate?t.calculate:0;return'<span class="badge badge-success text-extra-large">'+e+"</span>"},attributes:{style:"text-align: center;font-weight: bold;"}},{field:"action",title:"Acción",width:"220px",editor:'<input kendo-drop-down-list k-value-primitive="true" k-options="actionOptions"  />',template:function(t){return t.action?t.action.item:"-Seleccionar-"},headerAttributes:{style:"display: none"},attributes:{style:"text-align: center;font-weight: bold;","class":"text-capitalize text-dark"}},{field:"actionValue",title:"icon",width:"70px",headerAttributes:{style:"display: none"},template:function(t){var e="";switch(t.actionValue){case"s-o":e='<i class="fa fa-ban text-yellow text-extra-extra-large"></i>';break;case"s-p":e='<i class="fa fa-minus-circle text-azure-blue text-extra-extra-large"></i>';break;case"s-a":e='<i class="fa fa-circle-o text-red text-extra-extra-large"></i>';break;case"s-t":e='<i class="fa fa-check-circle-o text-green text-extra-extra-large"></i>';break;default:e='<i class="fa fa-question-circle text-orange text-extra-extra-large"></i>'}return e},attributes:{style:"text-align: center;font-weight: bold;"}}]}}}),t.$on("kendoWidgetCreated",function(e,n){void 0!==t.grid&&null!==t.grid||(t.grid=n,t.grid.wrapper.find(".k-grid-toolbar").on("click",".k-grid-custom-save-changes",function(e){var n=[];t.grid.wrapper.find(".hide-grid-header").each(function(t,e){var i=angular.element(this).data("kendoGrid");i.dataSource.hasChanges()&&angular.forEach(i.dataSource.data(),function(t,e){t.dirty&&n.push(t)})}),R(n)}))}),t.form={next:function(t){B()},prev:function(t){E()},goTo:function(t,e){F(e)},submit:function(t){var e=null;if(t.$invalid){var n=null,e=null;for(n in t)"$"!=n[0]&&(null!==e||t[n].$valid||(e=t[n].$name),t[n].$pristine&&(t[n].$dirty=!0));return angular.element(".ng-invalid[name="+e+"]").focus(),void p(function(){c.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")},500)}M()},reset:function(){}};var B=function(){t.currentStep++,q()},E=function(){t.currentStep--,q()},F=function(e){t.currentStep=e,q()},q=function(){t.currentStep>0&&t.currentStep<t.lists.length+1?(x.id=t.lists[t.currentStep-1].id,t.dangerousnessList=t.lists[t.currentStep-1].dangerousnessList,t.existingControlList=t.lists[t.currentStep-1].existingControlList,t.grid.dataSource.page(1)):t.currentStep==t.lists.length+1&&(N(),j(),z())};t.onSelectList=function(){j(),z()},t.onCancel=function(e){null!=t.$parent&&t.$parent.navToSection("summary","summary",D)},t.onSave=function(t){R([t])};var R=function(t){var e={},i=JSON.stringify(t);return e.data=Base64.encode(i),d({method:"POST",url:"api/customer-safety-inspection-list-item/batch",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(t){p(function(){s.pop("success","Actualización","La información ha sido actualizada satisfactoriamente."),_()})})["catch"](function(t){n.error(t),s.pop("error","Error","Error guardando el registro. Por favor verifique los datos ingresados!")})["finally"](function(){})};t.onSaveHeader=function(e){t.onSaveHeaderBatch([e])},t.onSaveHeaderBatch=function(t){var e={},i=JSON.stringify(t);return e.data=Base64.encode(i),d({method:"POST",url:"api/customer-safety-inspection-header-field/batch",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(t){p(function(){s.pop("success","Actualización","La información ha sido actualizada satisfactoriamente."),I()})})["catch"](function(t){n.error(t),s.pop("error","Error","Error guardando el registro. Por favor verifique los datos ingresados!")})["finally"](function(){})};var V=function(){t.entity={id:0,customerSafetyInspectionId:D,customerSafetyInspectionList:null,observation:null}};V();var M=function(){var e={},i=JSON.stringify(t.entity);return e.data=Base64.encode(i),d({method:"POST",url:"api/customer-safety-inspection-list-observation/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(t){p(function(){s.pop("success","Actualización","La información ha sido actualizada satisfactoriamente."),N(),V()})})["catch"](function(t){n.error(t),s.pop("error","Error","Error guardando el registro. Por favor verifique los datos ingresados!")})["finally"](function(){})};t.dtInstanceCustomerSafetyInspectionObservation={},t.dtOptionsCustomerSafetyInspectionObservation=i.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.customerSafetyInspectionId=D,JSON.stringify(t)},url:"api/customer-safety-inspection-list-observation",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,n,i){r(angular.element(e).contents())(t)}),t.dtColumnsCustomerSafetyInspectionObservation=[o.newColumn("list").withTitle("Lista").withOption("defaultContent",""),o.newColumn("observation").withTitle("Observación").withOption("defaultContent",""),o.newColumn("user").withTitle("Uusario").withOption("width",200).withOption("defaultContent",""),o.newColumn("createdAt").withTitle("Fecha Creación").withOption("width",150).withOption("defaultContent","")],t.dtInstanceCustomerSafetyInspectionObservationCallback=function(e){t.dtInstanceCustomerSafetyInspectionObservation=e};var N=function(){t.dtInstanceCustomerSafetyInspectionObservation.reloadData()};t.dtOptionsCustomerSafetyInspectionDangerousness=i.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerSafetyInspectionId=D,e.customerSafetyInspectionListId=t.criteria.list?t.criteria.list.id:0,JSON.stringify(e)},url:"api/customer-safety-inspection-list-item-dangerousness",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,n,i){r(angular.element(e).contents())(t)}),t.dtColumnsCustomerSafetyInspectionDangerousness=[o.newColumn("description").withTitle("Peligrosidad").withOption("defaultContent",""),o.newColumn("quantity").withTitle("Cantidad").withOption("defaultContent","")],t.dtInstanceCustomerSafetyInspectionDangerousnessCallback=function(e){t.dtInstanceCustomerSafetyInspectionDangerousness=e};var j=function(){t.dtInstanceCustomerSafetyInspectionDangerousness.reloadData()};t.dtOptionsCustomerSafetyInspectionActions=i.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerSafetyInspectionId=D,e.customerSafetyInspectionListId=t.criteria.list?t.criteria.list.id:0,JSON.stringify(e)},url:"api/customer-safety-inspection-list-item-action",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,n,i){r(angular.element(e).contents())(t)}),t.dtColumnsCustomerSafetyInspectionActions=[o.newColumn("description").withTitle("Acciones").withOption("defaultContent",""),o.newColumn("quantity").withTitle("Cantidad").withOption("defaultContent","")],t.dtInstanceCustomerSafetyInspectionActionsCallback=function(e){t.dtInstanceCustomerSafetyInspectionActions=e};var z=function(){t.dtInstanceCustomerSafetyInspectionActions.reloadData()};t.onAddComment=function(e){var i=v.open({templateUrl:u.app.views.urlRoot+"modules/customer/common/modals/customer_questions_comment_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideCustomerSafetyInspectionListItemCommentCtrl",scope:t,resolve:{question:function(){return e}}});i.result.then(function(){},function(){n.info("Modal dismissed at: "+new Date)})},t.onAddImprovementPlan=function(e){var i=v.open({templateUrl:u.app.views.urlRoot+"modules/customer/common/modals/customer_improvement_plan_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideCustomerSafetyInspectionListItemImprovementPlanCtrl",scope:t,resolve:{question:function(){return e},isView:function(){return t.isView}}});i.result.then(function(){},function(){n.info("Modal dismissed at: "+new Date)})},t.onAddAttachment=function(e){var i=v.open({templateUrl:u.app.views.urlRoot+"modules/customer/safety/inspection/customer_safety_inspection_attachment_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideCustomerSafetyInspectionListItemAttachmentCtrl",scope:t,resolve:{isView:function(){return t.isView},question:function(){return e}}});i.result.then(function(){},function(){n.info("Modal dismissed at: "+new Date)})}}]),app.controller("ModalInstanceSideCustomerSafetyInspectionListItemCommentCtrl",["$stateParams","$rootScope","$scope","$uibModalInstance","question","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile","$document",function(t,e,n,i,o,a,r,s,l,c,u,d,p,m,f,h){n.isView=!1;var w=function(){n.entity={id:0,customerSafetyInspectionListItemId:o.id,comment:""}};w(),n.onCloseModal=function(){i.close(1)},n.onCancel=function(){i.dismiss("cancel")},n.onClear=function(){w()},n.form={submit:function(t){var e=null;if(t.$invalid){var i=null,e=null;for(i in t)"$"!=i[0]&&(null!==e||t[i].$valid||(e=t[i].$name),t[i].$pristine&&(t[i].$dirty=!0));return angular.element(".ng-invalid[name="+e+"]").focus(),void r(function(){c.pop("error","Error","Por favor verifique los datos requeridos del formulario y vuelva a intentarlo")},500)}n.onSave()},reset:function(t){t.$setPristine(!0)}},n.onSave=function(){var t={},e=JSON.stringify(n.entity);return t.data=Base64.encode(e),l({method:"POST",url:"api/customer-safety-inspection-list-item-comment/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){r(function(){c.pop("success","Operación Exitosa","Actualización exitosa."),n.onClear(),n.reloadData()})})["catch"](function(t){c.pop("Error","Error inesperado",t)})["finally"](function(){})},n.dtInstanceQuestionComment={},n.dtOptionsQuestionComment=m.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.customerSafetyInspectionListItemId=o.id,JSON.stringify(t)},url:"api/customer-safety-inspection-list-item-comment",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,e,i){f(angular.element(t).contents())(n)}),n.dtColumnsQuestionComment=[p.newColumn("comment").withTitle("Comentario"),p.newColumn("user").withTitle("Usuario").withOption("width",200).withOption("defaultContent",200),p.newColumn("createdAt").withTitle("Fecha").withOption("width",200)],n.dtInstanceQuestionCommentCallback=function(t){n.dtInstanceQuestionComment=t},n.reloadData=function(){n.dtInstanceQuestionComment.reloadData()}}]),app.controller("ModalInstanceSideCustomerSafetyInspectionListItemImprovementPlanCtrl",["$stateParams","$rootScope","$scope","$uibModalInstance","question","$log","$timeout","SweetAlert","isView","$filter","FileUploader","$http","DTOptionsBuilder","DTColumnBuilder","$compile",function(t,e,n,i,o,a,r,s,l,c,u,d,p,m,f){n.isView=!1,n.maxDate=new Date,n.datePickerConfig={culture:"es-CO",format:"dd/MM/yyyy HH:mm"},n.responsibleList=[],n.typesAlert=c("orderBy")(e.parameters("tracking_alert_type"),"id",!1),n.typesTime=e.parameters("tracking_alert_timeType"),n.statusAlert=e.parameters("tracking_alert_status"),n.preferencesAlert=e.parameters("tracking_alert_preference"),n.typeList=e.parameters("improvement_plan_type");var h=function(){n.improvement={id:0,customerId:t.customerId,classificationName:o.groupId,classificationId:o.groupId,entityName:"IS",entityId:o.id,type:null,endDate:null,description:"",observation:"",responsible:null,isRequiresAnalysis:!1,status:{id:0,value:"CR",item:"Creada"},trackingList:[],alertList:[]}};h(),n.onLoadRecord=function(t){if(0!=t){var e={id:t};d({method:"GET",url:"api/customer/improvement-plan",params:e})["catch"](function(t,e){if(403==e){var n=null!==t.message&&void 0!==t.message?t.message:"app.clientes.list";s.swal("No Autorizado","No estas autorizado para ver esta información.","error"),r(function(){$state.go(n)},3e3)}else 404==e?s.swal("Información no disponible","Centro de trabajo no encontrado","error"):s.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(t){r(function(){null!=t.data.result&&""!=t.data.result&&(n.improvement=t.data.result,v())},400)})["finally"](function(){})}else n.loading=!1},n.onCloseModal=function(){i.close(1)},n.onCancel=function(){i.dismiss("cancel")},n.onClear=function(){};var w=function(){var e={customer_id:t.customerId};return d({method:"POST",url:"api/customer/improvement-plan/list-data",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(t){r(function(){n.responsibleList=t.data.data.responsible})})["catch"](function(t){s.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};w(),n.master=n.improvement,n.form={submit:function(t){var e=null;if(t.$invalid){var n=null,e=null;for(n in t)"$"!=n[0]&&(null!==e||t[n].$valid||(e=t[n].$name),t[n].$pristine&&(t[n].$dirty=!0));return angular.element(".ng-invalid[name="+e+"]").focus(),void s.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}s.swal("Validación exitosa","Procediendo con el guardado...","success"),g()},reset:function(t){n.improvement=angular.copy(n.master),t.$setPristine(!0)}};var g=function(){var t={},e=JSON.stringify(n.improvement);return t.data=Base64.encode(e),d({method:"POST",url:"api/customer/improvement-plan/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){r(function(){h()})})["catch"](function(t){s.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){n.reloadData()})},v=function(){null!=n.improvement.endDate&&(n.improvement.endDate=new Date(n.improvement.endDate.date)),angular.forEach(n.improvement.trackingList,function(t,e){null!=t.startDate&&(t.startDate=new Date(t.startDate.date))})};n.onAddTracking=function(){r(function(){null==n.improvement.trackingList&&(n.improvement.trackingList=[]),n.improvement.trackingList.push({id:0,customerImprovementPlanId:0,responsible:null,startDate:null})})},n.onRemoveTracking=function(t){s.swal({title:"Está seguro?",text:"Desea confirmar la eliminación de este registro ?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(e){e?r(function(){var e=n.improvement.trackingList[t];if(n.improvement.trackingList.splice(t,1),0!=e.id){var i={};i.id=e.id,d({method:"POST",url:"api/customer/improvement-plan-tracking/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){a.error(t),s.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})},n.onAddAlert=function(){r(function(){null==n.improvement.alertList&&(n.improvement.alertList=[]),n.improvement.alertList.push({id:0,customerImprovementPlanId:0,type:null,preference:null,time:0,timeType:null,status:null})})},n.onRemoveAlert=function(t){s.swal({title:"Está seguro?",text:"Desea confirmar la eliminación de este registro ?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(e){e?r(function(){var e=n.improvement.alertList[t];if(n.improvement.alertList.splice(t,1),0!=e.id){var i={};i.id=e.id,d({method:"POST",url:"api/customer/improvement-plan-alert/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){a.error(t),s.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})},n.dtInstanceImprovementPlan={},n.dtOptionsImprovementPlan=p.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.customerId=n.improvement.customerId,t.entityId=n.improvement.entityId,t.entityName=n.improvement.entityName,JSON.stringify(t)},url:"api/customer-improvement-plan-entity",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){y()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,e,i){f(angular.element(t).contents())(n)}),n.dtColumnsImprovementPlan=[m.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,i,o,a){var r="",s='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+t.id+'" >   <i class="fa fa-edit"></i></a> ',l='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+t.id+'" >   <i class="fa fa-trash-o"></i></a> ';return e.can("cliente_plan_mejoramiento_edit")&&(r+=s),e.can("cliente_plan_mejoramiento_delete")&&(r+=l),n.isView?null:r}),m.newColumn("origin").withTitle("Origen").withOption("width",200).withOption("defaultContent",""),m.newColumn("classification").withTitle("Clasificación").withOption("width",200).withOption("defaultContent",""),m.newColumn("type").withTitle("Tipo").withOption("width",200).withOption("defaultContent",""),m.newColumn("description").withTitle("Hallazgo").withOption("width",200).withOption("defaultContent",""),m.newColumn("responsibleName").withTitle("Responsable").withOption("defaultContent",""),m.newColumn(null).withTitle("Fecha Cierre").withOption("width",200).renderWith(function(t,e,n,i){return"object"==typeof t.endDate&&null!=t.endDate?moment(t.endDate.date).format("DD/MM/YYYY"):null!=t.endDate?moment(t.endDate).format("DD/MM/YYYY"):""}),m.newColumn(null).withTitle("Estado").withOption("width",200).withOption("defaultContent","").renderWith(function(t,e,n,i){var o="label label-success",a=t.status;switch(t.statusCode){case"AB":o="label label-info";break;case"CO":o="label label-success";break;case"CA":o="label label-danger"}return'<span class="'+o+'">'+a+"</span>"})];var y=function(){$("#dtImprovementPlan a.editRow").on("click",function(){var t=$(this).data("id");n.onLoadRecord(t)}),$("#dtImprovementPlan a.delRow").on("click",function(){var t=$(this).data("id");s.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(e){if(e){var i={};i.id=t,d({method:"POST",url:"api/customer/improvement-plan/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){a.error(t),s.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){n.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};n.dtInstanceImprovementPlanCallback=function(t){n.dtInstanceImprovementPlan=t},n.reloadData=function(){n.dtInstanceImprovementPlan.reloadData()}}]),app.controller("ModalInstanceSideCustomerSafetyInspectionListItemAttachmentCtrl",["$stateParams","$rootScope","$scope","$uibModalInstance","$log","$timeout","SweetAlert","isView","question","$filter","FileUploader","$http","DTColumnBuilder","DTOptionsBuilder","$compile","ListService","toaster",function(t,e,n,i,o,a,r,s,l,c,u,d,p,m,f,h,w){var g=0;n.documentType=e.parameters("contract_detail_document_type"),n.documentStatus=e.parameters("customer_document_status"),n.isView=!1;var v=function(){n.attachment={id:0,customerSafetyInspectionListItemId:l.id,type:null,classification:null,status:n.documentStatus?n.documentStatus[0]:null,version:1,description:""}};v(),n.onCloseModal=function(){i.close(1)},n.onCancel=function(){i.dismiss("cancel")},n.onClear=function(){v()};var y=n.uploader=new u({url:"api/customer/safety-inspection-list-item-document/upload",formData:[],removeAfterUpload:!0});y.filters.push({name:"customFilter",fn:function(t,e){return this.queue.length<10}}),y.onWhenAddingFileFailed=function(t,e,n){console.info("onWhenAddingFileFailed",t,e,n)},y.onAfterAddingFile=function(t){console.info("onAfterAddingFile",t)},y.onAfterAddingAll=function(t){console.info("onAfterAddingAll",t)},y.onBeforeUploadItem=function(t){console.info("onBeforeUploadItem",t);var e={id:g};t.formData.push(e)},y.onProgressItem=function(t,e){console.info("onProgressItem",t,e)},y.onProgressAll=function(t){console.info("onProgressAll",t)},y.onSuccessItem=function(t,e,n,i){console.info("onSuccessItem",t,e,n,i)},y.onErrorItem=function(t,e,n,i){console.info("onErrorItem",t,e,n,i)},y.onCancelItem=function(t,e,n,i){console.info("onCancelItem",t,e,n,i)},y.onCompleteItem=function(t,e,n,i){console.info("onCompleteItem",t,e,n,i)},y.onCompleteAll=function(){console.info("onCompleteAll"),w.pop("success","Operación Exitosa","La información ha sido guardada satisfactoriamente"),n.reloadData(),n.onClear()},n.form={submit:function(t){var e=null;if(t.$invalid){var n=null,e=null;for(n in t)"$"!=n[0]&&(null!==e||t[n].$valid||(e=t[n].$name),t[n].$pristine&&(t[n].$dirty=!0));return angular.element(".ng-invalid[name="+e+"]").focus(),void r.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}b()},reset:function(t){t.$setPristine(!0)}};var b=function(){var t={},e=JSON.stringify(n.attachment);return t.data=Base64.encode(e),d({method:"POST",url:"api/customer-safety-inspection-list-item-document/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){a(function(){y.queue.length>0?(g=t.data.result.id,y.uploadAll()):(w.pop("success","Operación Exitosa","La información ha sido guardada satisfactoriamente"),n.reloadData(),n.onClear())})})["catch"](function(t){r.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){n.reloadData()})};n.dtOptionsSafetyInspectionDocument=m.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.customerSafetyInspectionListItemId=l.id,t.statusCode="2",JSON.stringify(t)},url:"api/customer-safety-inspection-list-item-document",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){C()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,e,i){f(angular.element(t).contents())(n)}),n.dtColumnsSafetyInspectionDocument=[p.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,e,n,i){
var o=t.documentUrl?t.documentUrl:"",a="api/customer-safety-inspection-list-item-document/download?id="+t.id,r="",s='<a target="_self" class="btn btn-primary btn-xs downloadDocumentRow lnk" href="'+a+'" uib-tooltip="Descargar anexo" data-id="'+t.id+'" data-url="'+o+'" >   <i class="fa fa-download"></i></a> ',l='<a class="btn btn-info btn-xs openDocumentRow lnk" target="_blank" href="'+o+'" uib-tooltip="Abrir anexo" data-id="'+t.id+'" >   <i class="fa fa-folder-open-o"></i></a> ';return""!=o&&(r+=l,r+=s),r}),p.newColumn("documentType").withTitle("Tipo de documento").withOption("width",200),p.newColumn("description").withTitle("Descripción").withOption("width",200),p.newColumn("version").withTitle("Versión").withOption("width",200),p.newColumn("createdAt").withTitle("Fecha Creación").withOption("width",200).withOption("defaultContent",""),p.newColumn("status").withTitle("Estado").withOption("width",200).renderWith(function(t,e,n,i){var o="";switch(t){case"Vigente":o="label label-success";break;case"Anulado":o="label label-danger"}var a='<span class="'+o+'">'+t+"</span>";return a})];var C=function(){$("#dtSafetyInspectionDocument a.editRow").on("click",function(){})};n.dtInstanceSafetyInspectionDocumentCallback=function(t){n.dtInstanceSafetyInspectionDocument=t},n.reloadData=function(){n.dtInstanceSafetyInspectionDocument.reloadData()}}]);
"use strict";app.controller("customerSafetyInspectionListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","SweetAlert","$http","$filter","$document","$aside",function(e,t,n,a,o,i,r,s,l,c,d,u,f,p,m,w){var y=n;e.dtInstanceSafetyInspection={},e.dtOptionsSafetyInspection=a.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.operation="safety",e.customer_id=t.customerId,e},url:"api/customer/safety-inspection",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){h()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,n,a){r(angular.element(t).contents())(e)}),e.dtColumnsSafetyInspection=[o.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,t,n,a){var o="",i="",r='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Configurar inspección" data-id="'+e.id+'" >   <i class="fa fa-cogs"></i></a> ',s='<a class="btn btn-info btn-xs viewRow lnk" href="#" uib-tooltip="Ver inspección" data-id="'+e.id+'" >   <i class="fa fa-eye"></i></a> ',l='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar inspección" data-id="'+e.id+'" >   <i class="fa fa-trash-o"></i></a> ',c='<a class="btn btn-success btn-xs managementRow lnk" href="#" uib-tooltip="Gestionar inspección"  data-id="'+e.id+'"'+i+' >   <i class="fa fa-play-circle"></i></a> ';return o+=s,o+=r,o+=l,e.isContractor||(o+=c),o}),o.newColumn("description").withTitle("Descripción"),o.newColumn("isContractor").withTitle("Contratista").withOption("width",100).renderWith(function(e,t,n,a){var o="",i="";e?(o="label label-success",i="Si"):(o="label label-danger",i="No");var r='<span class="'+o+'">'+i+"</span>";return r}),o.newColumn("contractorType.value").withTitle("Tipo de Contratista").withOption("defaultContent",""),o.newColumn("dateText").withTitle("Fecha Creación").withOption("width",150).withOption("defaultContent",""),o.newColumn("version").withTitle("Version").withOption("width",100),o.newColumn("isActive").withTitle("Estado").withOption("width",100).renderWith(function(e,t,n,a){var o="",i="";e?(o="label label-success",i="Activo"):(o="label label-danger",i="Inactivo");var r='<span class="'+o+'">'+i+"</span>";return r})];var h=function(){angular.element("#dtSafetyInspection a.editRow").on("click",function(){var t=angular.element(this).data("id");e.onEditRecord(t)}),angular.element("#dtSafetyInspection a.managementRow").on("click",function(){var t=angular.element(this).data("id");e.onViewSummary(t)}),angular.element("#dtSafetyInspection a.viewRow").on("click",function(){var t=angular.element(this).data("id");e.onViewRecord(t)}),angular.element("#dtSafetyInspection a.delRow").on("click",function(){var t=angular.element(this).data("id");y.info("intenta eliminar el registro: "+t),u.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(a){if(a){var o={};o.id=t,f({method:"POST",url:"api/customer/safety-inspection/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){n.error(e),u.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){e.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};e.dtInstanceSafetyInspectionCallback=function(t){e.dtInstanceSafetyInspection=t},e.reloadData=function(){e.dtInstanceSafetyInspection.reloadData()},e.onCreateNew=function(e){g(0)},e.onEditRecord=function(e){g(e)},e.onViewSummary=function(t){null!=e.$parent&&e.$parent.navToSection("summary","edit",t)},e.onViewRecord=function(t){null!=e.$parent&&e.$parent.navToSection("form","view",t)};var g=function(t){var n={id:t},a=w.open({templateUrl:c.app.views.urlRoot+"modules/customer/safety/inspection/customer_safety_inspection_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"customerSafetyInspectionModalEditCtrl",scope:e,resolve:{safety:function(){return n}}});a.result.then(function(){e.reloadData()},function(){e.reloadData()})}}]),app.controller("customerSafetyInspectionModalEditCtrl",["$rootScope","$stateParams","$scope","$uibModalInstance","safety","$log","$timeout","SweetAlert","$http","toaster","$filter","$aside","$document","DTColumnBuilder","DTOptionsBuilder","$compile",function(e,t,n,a,o,i,r,s,l,c,d,u,f,p,m,w){var y=i;n.maxDate=new Date,n.datePickerConfig={culture:"es-CO",format:"dd/MM/yyyy HH:mm"},n.loading=!0,n.customer_id=t.customerId,n.isView=!1,n.isCreate=!0,n.format="dd-MM-yyyy",n.minDate=new Date-1,n.safety={},n.agents=[],n.lists=[],n.headers=[],n.onCloseModal=function(){a.close(1)},n.onCancel=function(){a.dismiss("cancel")},n.onLoadRecord=function(){if(0!=n.safety.id){y.info("editando cliente con código: "+n.safety.id);var e={id:n.safety.id};l({method:"GET",url:"api/customer/safety-inspection",params:e})["catch"](function(e,t){if(403==t){var n=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";s.swal("No Autorizado","No estas autorizado para ver esta información.","error"),r(function(){$state.go(n)},3e3)}else 404==t?s.swal("Información no disponible","Centro de trabajo no encontrado","error"):s.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(e){r(function(){n.safety=e.data.result,h()})})["finally"](function(){r(function(){n.loading=!1},400),r(function(){f.scrollTop(40,2e3)})})}else y.info("creacion de nuevo cliente"),n.loading=!1};var h=function(){null!=n.safety.date&&(n.safety.date=new Date(n.safety.date.date)),null!=n.safety.dateFrom&&(n.safety.dateFrom=new Date(n.safety.dateFrom.date)),null!=n.safety.dateTo&&(n.safety.dateTo=new Date(n.safety.dateTo.date))},g=function(){var e={};return e.operation="list",e.customerId=t.customerId,l({method:"POST",url:"api/customer/safety-inspection-config-list/list",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){r(function(){n.lists=e.data.data})})["catch"](function(e){i.error(e),s.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})},v=function(){var e={};return e.operation="list",e.customerId=t.customerId,l({method:"POST",url:"api/customer/safety-inspection-config-header/list",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){r(function(){n.headers=e.data.data})})["catch"](function(e){i.error(e),s.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})},C=function(){var e={};return e.operation="list",e.customerId=t.customerId,l({method:"POST",url:"api/customer/agentList",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){r(function(){n.agents=e.data.data})})["catch"](function(e){i.error(e),s.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})},S=function(){n.safety={id:o.id,customerId:t.customerId,description:"",reason:"",date:new Date,dateFrom:new Date,dateTo:new Date,isActive:!0,responsible:"",responsibleJob:"",responsibleEmail:"",isContractor:!1,contractorType:null,agent:null,header:null,lists:[]}};S(),g(),C(),v(),n.onLoadRecord(),n.master=n.safety,n.form={submit:function(e){var t=null;if(e.$invalid){var a=null,t=null;for(a in e)"$"!=a[0]&&(null!==t||e[a].$valid||(t=e[a].$name),e[a].$pristine&&(e[a].$dirty=!0));return y.info(n.safety),angular.element(".ng-invalid[name="+t+"]").focus(),void s.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}T()},reset:function(e){n.clear()}},n.clear=function(){n.isView=!1,r(function(){S()})};var T=function(){var e={};n.safety.date=n.safety.date.toISOString(),n.safety.dateFrom=n.safety.dateFrom.toISOString(),n.safety.dateTo=n.safety.dateTo.toISOString();var t=JSON.stringify(n.safety);return e.data=Base64.encode(t),l({method:"POST",url:"api/customer/safety-inspection/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){s.swal("Registro","La información ha sido guardada satisfactoriamente","success"),r(function(){n.onCloseModal()})})["catch"](function(e){i.error(e),s.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){n.clear()})};n.onAddList=function(){null==n.safety.lists&&(n.safety.lists=[]),n.safety.lists.push({id:0,customerSafetyInspectionId:o.id,list:null,isActive:!0})},n.onRemoveList=function(e){s.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(t){t?r(function(){if(0==n.safety.lists[e].id)n.safety.lists.splice(e,1);else{var t={id:n.safety.lists[e].id};l({method:"POST",url:"api/customer-safety-inspection-list/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){n.safety.lists.splice(e,1)})["catch"](function(e){i.error(e),c.pop("error","Error","Error guardando el registro. Por favor verifique los datos ingresados!")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})}}]);
"use strict";app.controller("customerSafetyInspectionReportCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert",function(e,t,n,o,r,a,i,c,u,p,s,d,l){var f={};e.question={rate:null},f.operation="diagnostic",f.customer_id=t.customerId,f.safety_inspection_id=e.$parent.currentSafetyInspectionId,e.action=null,e.categories=[],e.rates=p.parameters("wg_safety_inspection_action"),e.changeRate=function(t,n,o){s(function(){e.action=t.value,m()})};var m=function(){var t={};t.safetyInspectionId=e.$parent.currentSafetyInspectionId,t.action=e.action,d({method:"POST",url:"api/customer/safety-inspection-list-item/report",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){e.categories=t.data.data.wizard,e.loaded=!0})["catch"](function(e){n.error(e),l.swal("Error Consultando Preguntas","Se ha presentado un error durante la consulta del cuestionario, por favor intentelo de nuevo.","error")})["finally"](function(){})};m(),e.onEditSafetyInspection=function(){null!=e.$parent&&e.$parent.navToSection("form","edit",e.$parent.currentSafetyInspectionId)},e.cancelEdition=function(t){null!=e.$parent&&e.$parent.navToSection("summary","summary",e.$parent.currentSafetyInspectionId)},e.clearFilter=function(){e.question={rate:null},e.action=null,m()},e.onSummaryExportPdf=function(){kendo.drawing.drawDOM($(".export-pdf")).then(function(e){return kendo.drawing.exportPDF(e,{paperSize:"auto",margin:{left:"1cm",top:"1cm",right:"1cm",bottom:"1cm"}})}).done(function(e){kendo.saveAs({dataURI:e,fileName:"InspeccionesSeguridadReporte.pdf",proxyURL:"//demos.telerik.com/kendo-ui/service/export"})})},e.onSummaryExportExcel=function(){jQuery("#downloadDocument")[0].src="api/customer/safety-inspection/export-excel?id="+e.$parent.currentSafetyInspectionId}}]);
"use strict";app.controller("customerSafetyInspectionSummaryCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert",function(t,n,e,o,i,a,r,s,c,p,l,u,d){var m=t.$parent.currentSafetyInspectionId;t.dtOptionsSafetyInspectionSummary=o.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.operation="diagnostic",t.customerId=n.customerId,t.safetyInspectionId=m,t},url:"api/customer/safety-inspection/summary",type:"POST",beforeSend:function(){},complete:function(t){l(function(){})}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withDOM("tr").withOption("language",{}).withOption("createdRow",function(n,e,o){r(angular.element(n).contents())(t)}),t.dtColumnsSafetyInspectionSummary=[i.newColumn("name").withTitle("Lista").withOption("width",400),i.newColumn("questions").withTitle("Preguntas").withOption("width",200),i.newColumn("answers").withTitle("Respuestas").withOption("width",200),i.newColumn("advance").withTitle("Avance (%)").withOption("width",200),i.newColumn("average").withTitle("Promedio Total (%)").withOption("width",200),i.newColumn(null).withTitle("Estado").withOption("width",200).renderWith(function(t,n,e,o){var i="label label-danger",a="Sin Iniciar";parseInt(t.answers)==parseInt(t.questions)?(a="Completado",i="label label-info"):parseInt(t.answers)>0&&(a="Iniciado",i="label label-success");var r='<span class="'+i+'">'+a+"</span>";return r}).notSortable()],t.dtInstanceSafetyInspectionSummaryCallback=function(n){t.dtInstanceSafetyInspectionSummary=n},t.reloadData=function(){t.dtInstanceSafetyInspectionSummary.reloadData()},t.onEditSafetyInspection=function(){null!=t.$parent&&t.$parent.navToSection("form","edit",m)},t.cancelEdition=function(n){null!=t.$parent&&t.$parent.navToSection("list","list")},t.onExportPdf=function(){kendo.drawing.drawDOM($(".safety-inspection-export-pdf")).then(function(t){return kendo.drawing.exportPDF(t,{paperSize:"auto",margin:{left:"1cm",top:"1cm",right:"1cm",bottom:"1cm"}})}).done(function(t){kendo.saveAs({dataURI:t,fileName:"Inspeccion-seguridad.pdf",proxyURL:"//demos.telerik.com/kendo-ui/service/export"})})},t.onExportExcel=function(){jQuery("#downloadDocument")[0].src="api/customer/safety-inspection/summary-export-excel?id="+t.$parent.currentSafetyInspectionId},t.onViewReport=function(){null!=t.$parent&&t.$parent.navToSection("report","report",t.$parent.currentSafetyInspectionId)}}]);
"use strict";app.controller("customerAuditCtrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout",function(t,o,e,i,c,n){t.audit_section="list",t.currentAudit=0,t.modeDsp="edit",t.navToSection=function(o,e,i){n(function(){t.audit_section=o,t.modeDsp=e,t.$parent.switchSubTab(e),t.currentAudit=i})}}]);
"use strict";app.controller("customerAuditListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","SweetAlert","$http","$filter","$document",function(t,i,e,n,a,o,r,l,u,s,d,c,p,f,m){var w=e;t.request={},w.info("loading..customerAuditListCtrl "),t.criteria=[{name:"Igual",value:"eq"},{name:"Contiene",value:"contains"},{name:"Diferente",value:"neq"}],t.conditions=[{name:"Y",value:"AND"},{name:"O",value:"OR"}],t.audit={fields:[{name:"created_at",alias:"Fecha"},{name:"email",alias:"Usuario"},{name:"userType",alias:"Tipo Usuario"},{name:"action",alias:"Acción"},{name:"observation",alias:"Descripción"}],filters:[]},t.dtOptionsCustomerAudit=n.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.operation="audit",e.customerId=i.customerId,e.data=Base64.encode(JSON.stringify(t.audit)),angular.isDefined(t.audit)&&angular.isDefined(t.audit.filters)&&(e.filter={filters:$.map(t.audit.filters,function(t){return{field:t.field.name,operator:t.criteria.value,condition:t.condition.value,value:t.value}})}),JSON.stringify(e)},url:"api/customer-audit",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(i,e,n){r(angular.element(i).contents())(t)}),t.dtColumnsCustomerAudit=[a.newColumn("createdAt").withTitle("Fecha").withOption("width",200),a.newColumn("userType").withTitle("Tipo Usuario").withOption("width",200),a.newColumn("email").withTitle("Usuario").withOption("width",200),a.newColumn("action").withTitle("Acción").withOption("width",200),a.newColumn("observation").withTitle("Descripción")],t.dtInstanceCustomerAuditCallback=function(i){t.dtInstanceCustomerAudit=i},t.reloadData=function(){t.dtInstanceCustomerAudit.reloadData()},t.addFilter=function(){null==t.audit.filters&&(t.audit.filters=[]),t.audit.filters.push({id:0,field:null,criteria:null,condition:null,value:""})},t.onFilter=function(){t.reloadData()},t.onCleanFilter=function(){t.audit.filters=[],t.reloadData()},t.removeFilter=function(i){t.audit.filters.splice(i,1),t.onFilter()}}]);
"use strict";app.controller("customerContractCtrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout",function(t,o,c,n,a,r){var e=c;e.info("loading..customerContractCtrl!!! "),t.contract_section="list",t.currentContract=0,t.dataContract=[],t.navToSection=function(o,c,n){r(function(){t.contract_section=o,t.$parent.switchSubTab(c),t.currentContract=n})},t.setDataSummary=function(o){t.dataSummary=o}}]);
"use strict";app.controller("customerContractListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert",function(t,n,i,o,e,a,r,c,l,s,u,d,p){var w=i,h={};w.info("loading..customerContractListCtrl "),t.isNewDiagnostic=!1,h.operation="contract",h.customer_id=n.customerId,t.dtInstanceContract={},t.dtOptionsContract=o.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.contractorId=n.customerId,JSON.stringify(t)},url:"api/customer-contractor-index",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){m()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(n,i,o){r(angular.element(n).contents())(t)}),t.dtColumnsContract=[e.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,n,i,o){var e="",a="";t.isActive||(a='disabled="disabled"');var r='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Continuar"  data-id="'+t.id+'"'+a+' >   <i class="fa fa-play-circle"></i></a> ';return e+=r}),e.newColumn("documentType").withTitle("Tipo de Documento").withOption("width",160),e.newColumn("documentNumber").withTitle("Documento").withOption("width",200),e.newColumn("businessName").withTitle("Razón social"),e.newColumn("contract").withTitle("Contrato").withOption("width",200),e.newColumn(null).withTitle("Estado").withOption("width",60).renderWith(function(t,n,i,o){var e="label label-danger",a="Inactivo";null==t.isActive&&void 0==t.isActive||(t.isActive?(e="label label-success",a="Activo"):(e="label label-danger",a="Inactivo"));var r='<span class="'+e+'">'+a+"</span>";return r})];var m=function(){$("#dtCustomerContract a.editRow").on("click",function(){var n=$(this).data("id"),o={};o.id=n,d({method:"POST",url:"api/customer/contract-detail/bulk",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(t){})["catch"](function(t){i.error(t),p.swal("Error en la carga","Se ha presentado un error durante la carga del registro por favor intentelo de nuevo","error")})["finally"](function(){t.editContract(n)})}),$("#dtCustomerContract a.viewRow").on("click",function(){var t=$(this).data("id");w.info("Step 11"),l.go("app.clientes.view",{customerId:t})})};t.reloadData=function(){t.dtInstanceContract.reloadData()},t.editContract=function(n){null!=t.$parent&&t.$parent.navToSection("summary","summary",n)}}]);
"use strict";app.controller("customerContractSummaryCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$document","ChartService","ListService",function(t,a,n,e,o,r,i,c,l,u,s,d,p,m,h,w){function f(){var a={contractorId:O},n=[{name:"chart_bar_options",criteria:null},{name:"chart_doughnut_options",criteria:null},{name:"customer_contract",criteria:a}];h.getDataChart(n).then(function(a){t.chart.bar.options=a.data.data.chartBarOptions,t.chart.doughnut.options=a.data.data.chartLineOptions,t.chart.programs.data=a.data.data.customerContractPeriod,t.chart.progress.data=a.data.data.customerContractProgress,t.chart.progress.total=a.data.data.customerContractAverage},function(a){t.status="Unable to load customer data: "+a.message})}function C(){var a=[{name:"customer_contract_period",value:O}];w.getDataList(a).then(function(a){t.periodList=a.data.data.customerContractPeriod,!t.criteria.period&&t.periodList.length>0&&(t.criteria.period=t.periodList[0],t.reloadSummaryData())},function(a){t.status="Unable to load customer data: "+a.message})}var O=t.$parent.currentContract;t.criteria={period:null},t.chart={bar:{options:null},doughnut:{options:null},programs:{data:null},progress:{data:null,total:0}},f(),C();var S=function(){var a={id:O};d({method:"GET",url:"api/customer/contractor",params:a})["catch"](function(t,a){}).then(function(a){s(function(){t.contractor=a.data.result})})["finally"](function(){s(function(){m.scrollTop(0,2e3)})})};S(),t.dtInstanceContractSummary={},t.dtOptionsContractSummary=e.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(n){return n.operation="management",n.customer_id=a.customerId,n.contract_id=t.$parent.currentContract,n},url:"api/customer/contractor/summary",type:"POST",beforeSend:function(){},complete:function(a){s(function(){t.$parent.setDataSummary(a.responseJSON.data)})}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withDOM("tr").withOption("language",{}).withOption("createdRow",function(a,n,e){i(angular.element(a).contents())(t)}),t.dtColumnsContractSummary=[o.newColumn("period").withTitle("Periodo").withOption("width",200),o.newColumn("requirements").withTitle("Nro Requisitos").withOption("width",200),o.newColumn("answers").withTitle("Nro Ejecutados").withOption("width",200),o.newColumn("advance").withTitle("Avance (%)").withOption("width",200),o.newColumn("average").withTitle("Promedio Total (%)").withOption("width",200),o.newColumn("startDate").withTitle("Fecha Inicio").withOption("width",200),o.newColumn("endDate").withTitle("Fecha Finaliza").withOption("width",200),o.newColumn(null).withTitle("Estado").withOption("width",200).renderWith(function(t,a,n,e){var o="label label-danger",r="Sin Iniciar";parseInt(t.answers)==parseInt(t.requirements)?(r="Completado",o="label label-info"):parseInt(t.answers)>0&&(r="Iniciado",o="label label-success");var i='<span class="'+o+'">'+r+"</span>";return i}).notSortable()],t.reloadData=function(){t.dtInstanceContractSummary.reloadData()},t.onContinue=function(){null!=t.$parent&&t.$parent.navToSection("edit","edit",t.$parent.currentContract)},t.onCancel=function(a){null!=t.$parent&&t.$parent.navToSection("list","list")},t.dtInstanceContractInfoSummary=null,t.dtOptionsContractInfoSummary=e.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(a){var n={operation:"info",contract_id:O,period:t.criteria.period?t.criteria.period.value:0};return a.data=Base64.encode(JSON.stringify(n)),a},url:"api/customer/contractor/infoSummary",type:"POST",beforeSend:function(){},complete:function(t){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withDOM("tr").withOption("language",{}).withOption("createdRow",function(a,n,e){i(angular.element(a).contents())(t)}),t.dtColumnsContractInfoSummary=[o.newColumn("requirement").withTitle("Requisito"),o.newColumn(null).withTitle("Anexos").notSortable().renderWith(function(t,a,n,e){var o="",r=1==t.hasAttachment?"checked":"",i=1==t.hasAttachment?"Si":"No",c='<div class="checkbox clip-check check-success "><input class="editRow" ng-disabled="true" type="checkbox" id="chk_'+t.id+'" data-id="'+t.id+'" '+r+' ><label for="chk_'+t.id+'">'+i+"</label></div>";return o+=c}).notSortable().withOption("width",200),o.newColumn(null).withTitle("Estado").withOption("width",200).renderWith(function(t,a,n,e){var o="label label-danger",r="Sin Contestar";"Cumple"==t.rate?(r=t.rate,o="label label-success"):"Cumple Parcial"==t.rate?(r=t.rate,o="label label-warning"):"No Cumple"==t.rate?(r=t.rate,o="label label-danger"):"No Aplica"==t.rate?(r=t.rate,o="label label-info"):(r=t.rate,o="label label-inverse");var i='<span class="'+o+'">'+r+"</span>";return i}).notSortable()],t.dtInstanceContractInfoSummaryCallback=function(a){t.dtInstanceContractInfoSummary=a},t.reloadSummaryData=function(){null!=t.dtInstanceContractInfoSummary&&t.dtInstanceContractInfoSummary.reloadData()},t.onSelectPeriod=function(){s(function(){t.reloadSummaryData()})},t.onClearPeriod=function(){s(function(){t.criteria.period=null,t.reloadSummaryData()})},t.onExport=function(){var a={operation:"info",contract_id:O,period:t.criteria.period?t.criteria.period.value:0},n=Base64.encode(JSON.stringify(a));jQuery("#download")[0].src="api/customer/contractor/export-excel?data="+n}}]);
"use strict";app.controller("customerContractEditCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","SweetAlert","$rootScope","$http","$timeout","$uibModal","flowFactory","cfpLoadingBar","$document","$filter","$aside","FileUploader","ChartService","ListService",function(t,e,n,a,o,i,r,l,c,s,d,u,m,p,f,h,w,g,v,C,b,y){function O(){var e={contractorId:A},n=[{name:"chart_bar_options",criteria:null},{name:"chart_doughnut_options",criteria:null},{name:"customer_contract",criteria:e}];b.getDataChart(n).then(function(e){t.chart.bar.options=e.data.data.chartBarOptions,t.chart.doughnut.options=e.data.data.chartLineOptions,t.chart.programs.data=e.data.data.customerContractPeriod,t.chart.progress.data=e.data.data.customerContractProgress,t.chart.progress.total=e.data.data.customerContractAverage},function(e){t.status="Unable to load customer data: "+e.message})}function D(){var e=[{name:"customer_contract_year",value:A}];y.getDataList(e).then(function(e){t.yearList=e.data.data.customerContractYear,!t.criteria.year&&t.yearList.length>0&&(t.criteria.year=t.yearList[0],void 0!==t.grid&&t.grid.dataSource.read())},function(e){t.status="Unable to load customer data: "+e.message})}var x=n;t.criteria={year:null};var T={refresh:!0,index:0},S={model:null},A=t.$parent.currentContract;t.rateList=d.rates(),t.chart={bar:{options:null},doughnut:{options:null},programs:{data:null},progress:{data:null,total:0}},O(),D();var I=function(){n.info("refreshOnChange"),O(),t.grid.dataSource.read()};t.rateOptions={dataSource:t.rateList,dataTextField:"text",dataValueField:"id",change:function(){},select:function(e){var n=this.dataItem(e.item);S.model&&S.model.rateId!=n.id&&(S.model.rate=n,t.onSave(S.model))}},m(function(){t.mainGridOptions={dataSource:{type:"odata",transport:{read:{url:"api/customer-contract-detail",dataType:"json",type:"POST",data:function(){var e={contractorId:A,year:t.criteria.year?t.criteria.year.value:0};return e}},parameterMap:function(t,e){return JSON.stringify(t)}},schema:{model:{id:"id",fields:{description:{editable:!1,nullable:!0},documentNumber:{editable:!1,nullable:!0},businessName:{editable:!1,nullable:!0},isActive:{editable:!1,nullable:!0,type:"boolean"}}},data:function(t){return t.data||t},total:function(t){return t.recordsTotal||t.data.length||0}},pageSize:10,serverPaging:!0,serverFiltering:!0,serverSorting:!0},sortable:{mode:"multiple"},pageable:{change:function(t){T.index=t.index,x.info("page.index",T.index)}},filterable:{mode:"row"},dataBound:function(t){this.expandRow(this.tbody.find("tr.k-master-row"))},columns:[{field:"description",title:"Periodo",attributes:{"class":"text-orange text-large"},filterable:{cell:{operator:"contains",suggestionOperator:"contains"}}},{field:null,title:"Avance",width:"150px",attributes:{style:"text-align: center"},filterable:!1,template:function(t){var e='<h4 class="no-margin">'+t.advance+"%</h4>";return e+='<uib-progressbar value="'+t.advance+'" class="progress-xs no-radius no-margin" type="success"></uib-progressbar>',e+=t.answers+" de "+t.items}},{field:null,title:"Promedio",width:"150px",attributes:{style:"text-align: center"},filterable:!1,template:function(t){var e='<h4 class="no-margin">'+t.average+"%</h4>";return e+='<uib-progressbar value="'+t.total+'" class="progress-xs no-radius no-margin" type="success"></uib-progressbar>',e+="Promedio Total"}}]},t.detailGridOptions=function(t){return{dataSource:{type:"odata",transport:{read:{url:"api/customer-contract-detail-question",dataType:"json",type:"POST",data:function(){var e={period:t.description,contractorId:A};return e}},parameterMap:function(t,e){return JSON.stringify(t)}},requestEnd:function(t){},schema:{model:{id:"id",fields:{description:{editable:!1,nullable:!0},article:{editable:!1,nullable:!0},rate:{editable:!0,defaultValue:{id:0,text:null,code:null}}}},data:function(t){return t.data||t},total:function(t){return t.recordsTotal||t.data.length||0}},serverPaging:!1,serverSorting:!0,serverFiltering:!1,filter:{field:"period",operator:"eq",value:t.description}},editable:"incell",edit:function(t){t.model.isActive||t.sender.closeCell(),S.model=t.model},scrollable:!1,sortable:!0,pageable:!1,columns:[{command:[{text:" ",template:"<a class='btn btn-light-red btn btn-sm' ng-click='onAddComment(dataItem)' uib-tooltip='Comentarios' tooltip-placement='right'><i class='fa fa-comments'></i></a> "},{text:" ",template:"<a class='btn btn-warning btn btn-sm' ng-click='onAddImprovementPlan(dataItem)' uib-tooltip='Plan Mejoramiento' tooltip-placement='right'><i class='fa fa-plus-square'></i></a> "},{text:" ",template:"<a class='btn btn-info btn btn-sm' ng-click='onAddAttachment(dataItem)' uib-tooltip='Anexos' tooltip-placement='right'><i class='fa fa-paperclip'></i></a> "}],width:"130px",headerAttributes:{style:"display: none"}},{field:"description",title:"Descripción",headerAttributes:{style:"display: none"}},{field:"rate",title:"Calificación",width:"220px",editor:'<input kendo-drop-down-list k-value-primitive="true" k-options="rateOptions"  />',template:function(t){var e=t.isActive?"-Seleccionar-":'<span class="text-light">Deshabilitado</span>';return t.rate?t.rate.text:e},headerAttributes:{style:"display: none"},attributes:{style:"text-align: center;font-weight: bold;","class":"text-capitalize text-dark"}},{title:"icon",width:"70px",headerAttributes:{style:"display: none"},template:function(t){var e="";switch(t.rateCode){case"na":e='<i class="fa fa-ban text-yellow text-extra-extra-large"></i>';break;case"cp":e='<i class="fa fa-minus-circle text-muted text-extra-extra-large"></i>';break;case"nc":e='<i class="fa fa-circle-o text-red text-extra-extra-large"></i>';break;case"c":e='<i class="fa fa-check-circle-o text-green text-extra-extra-large"></i>';break;default:e='<i class="fa fa-question-circle text-orange text-extra-extra-large"></i>'}return e},attributes:{style:"text-align: center;font-weight: bold;"}}]}}}),t.$on("kendoWidgetCreated",function(e,n){void 0!==t.grid&&null!==t.grid||(t.grid=n)}),t.onSave=function(t){var e={},a=JSON.stringify(t);return e.data=Base64.encode(a),u({method:"POST",url:"api/customer-contract-detail/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(t){m(function(){l.pop("success","Actualización","La información ha sido actualizada satisfactoriamente."),I()})})["catch"](function(t){n.error(t),l.pop("error","Error","Error guardando el registro. Por favor verifique los datos ingresados!")})["finally"](function(){})},t.onCancel=function(){null!=t.$parent&&t.$parent.navToSection("summary","summary",A)},t.onSelectYear=function(){t.grid.dataSource.page(1)},t.onAddComment=function(e){var a=v.open({templateUrl:d.app.views.urlRoot+"modules/customer/common/modals/customer_questions_comment_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideCustomerContractDetailCommentCtrl",scope:t,resolve:{question:function(){return e}}});a.result.then(function(){},function(){n.info("Modal dismissed at: "+new Date)})},t.onAddAttachment=function(e){var a=v.open({templateUrl:d.app.views.urlRoot+"modules/customer/contract/customer_contract_detail_attachment_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideCustomerContractDetailAttachmentCtrl",scope:t,resolve:{isView:function(){return t.isView},question:function(){return e}}});a.result.then(function(){},function(){n.info("Modal dismissed at: "+new Date)})},t.onAddImprovementPlan=function(e){var a=v.open({templateUrl:d.app.views.urlRoot+"modules/customer/common/modals/customer_improvement_plan_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideCustomerContractDetailImprovementPlanCtrl",scope:t,resolve:{question:function(){return e},isView:function(){return t.isView}}});a.result.then(function(){},function(){n.info("Modal dismissed at: "+new Date)})},t.onSummaryExportExcel=function(){jQuery("#downloadDocument")[0].src="api/management/export-excel?management_id="+t.$parent.currentManagement+"&program_id="+t.program_id+"&rate_id="+t.rate_id}}]),app.controller("ModalInstanceSideCustomerContractDetailCommentCtrl",["$stateParams","$rootScope","$scope","$uibModalInstance","question","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile","$document",function(t,e,n,a,o,i,r,l,c,s,d,u,m,p,f,h){n.isView=!o.isActive;var w=function(){n.entity={id:0,customerContractDetailId:o.id,comment:""}};w(),n.onCloseModal=function(){a.close(1)},n.onCancel=function(){a.dismiss("cancel")},n.onClear=function(){w()},n.form={submit:function(t){var e=null;if(t.$invalid){var a=null,e=null;for(a in t)"$"!=a[0]&&(null!==e||t[a].$valid||(e=t[a].$name),t[a].$pristine&&(t[a].$dirty=!0));return angular.element(".ng-invalid[name="+e+"]").focus(),void r(function(){s.pop("error","Error","Por favor verifique los datos requeridos del formulario y vuelva a intentarlo")},500)}n.onSave()},reset:function(t){t.$setPristine(!0)}},n.onSave=function(){var t={},e=JSON.stringify(n.entity);return t.data=Base64.encode(e),c({method:"POST",url:"api/customer-contract-detail-comment/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){r(function(){s.pop("success","Operación Exitosa","Actualización exitosa."),n.onClear(),n.reloadData()})})["catch"](function(t){s.pop("Error","Error inesperado",t)})["finally"](function(){})},n.dtInstanceQuestionComment={},n.dtOptionsQuestionComment=p.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.customerContractDetailId=o.id,JSON.stringify(t)},url:"api/customer-contract-detail-comment",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,e,a){f(angular.element(t).contents())(n)}),n.dtColumnsQuestionComment=[m.newColumn("comment").withTitle("Comentario"),m.newColumn("user").withTitle("Usuario").withOption("width",200).withOption("defaultContent",200),m.newColumn("createdAt").withTitle("Fecha").withOption("width",200)],n.dtInstanceQuestionCommentCallback=function(t){n.dtInstanceQuestionComment=t},n.reloadData=function(){n.dtInstanceQuestionComment.reloadData()}}]),app.controller("ModalInstanceSideCustomerContractDetailImprovementPlanCtrl",["$stateParams","$rootScope","$scope","$uibModalInstance","question","$log","$timeout","SweetAlert","isView","$filter","FileUploader","$http","DTOptionsBuilder","DTColumnBuilder","$compile",function(t,e,n,a,o,i,r,l,c,s,d,u,m,p,f){n.isView=!o.isActive,n.maxDate=new Date,n.datePickerConfig={culture:"es-CO",format:"dd/MM/yyyy HH:mm"},n.responsibleList=[],n.typesAlert=s("orderBy")(e.parameters("tracking_alert_type"),"id",!1),n.typesTime=e.parameters("tracking_alert_timeType"),n.statusAlert=e.parameters("tracking_alert_status"),n.preferencesAlert=e.parameters("tracking_alert_preference"),n.typeList=e.parameters("improvement_plan_type");var h=function(){n.improvement={id:0,customerId:t.customerId,classificationName:o.period,classificationId:o.period,entityName:"CT",entityId:o.id,type:null,endDate:null,description:"",observation:"",responsible:null,isRequiresAnalysis:!1,status:{id:0,value:"CR",item:"Creada"},trackingList:[],alertList:[]}};h(),n.onLoadRecord=function(t){if(0!=t){var e={id:t};u({method:"GET",url:"api/customer/improvement-plan",params:e})["catch"](function(t,e){if(403==e){var n=null!==t.message&&void 0!==t.message?t.message:"app.clientes.list";l.swal("No Autorizado","No estas autorizado para ver esta información.","error"),r(function(){$state.go(n)},3e3)}else 404==e?l.swal("Información no disponible","Centro de trabajo no encontrado","error"):l.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(t){r(function(){null!=t.data.result&&""!=t.data.result&&(n.improvement=t.data.result,v())},400)})["finally"](function(){})}else n.loading=!1},n.onCloseModal=function(){a.close(1)},n.onCancel=function(){a.dismiss("cancel")},n.onClear=function(){};var w=function(){var e={customer_id:t.customerId};return u({method:"POST",url:"api/customer/improvement-plan/list-data",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(t){r(function(){n.responsibleList=t.data.data.responsible})})["catch"](function(t){l.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};w(),n.master=n.improvement,n.form={submit:function(t){var e=null;if(t.$invalid){var n=null,e=null;for(n in t)"$"!=n[0]&&(null!==e||t[n].$valid||(e=t[n].$name),t[n].$pristine&&(t[n].$dirty=!0));return angular.element(".ng-invalid[name="+e+"]").focus(),void l.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}l.swal("Validación exitosa","Procediendo con el guardado...","success"),g()},reset:function(t){n.improvement=angular.copy(n.master),t.$setPristine(!0)}};var g=function(){var t={},e=JSON.stringify(n.improvement);return t.data=Base64.encode(e),u({method:"POST",url:"api/customer/improvement-plan/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){r(function(){h()})})["catch"](function(t){l.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){n.reloadData()})},v=function(){null!=n.improvement.endDate&&(n.improvement.endDate=new Date(n.improvement.endDate.date)),angular.forEach(n.improvement.trackingList,function(t,e){null!=t.startDate&&(t.startDate=new Date(t.startDate.date))})};n.onAddTracking=function(){r(function(){null==n.improvement.trackingList&&(n.improvement.trackingList=[]),n.improvement.trackingList.push({id:0,customerImprovementPlanId:0,responsible:null,startDate:null})})},n.onRemoveTracking=function(t){l.swal({title:"Está seguro?",text:"Desea confirmar la eliminación de este registro ?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(e){e?r(function(){var e=n.improvement.trackingList[t];if(n.improvement.trackingList.splice(t,1),0!=e.id){var a={};a.id=e.id,u({method:"POST",url:"api/customer/improvement-plan-tracking/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){i.error(t),l.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})},n.onAddAlert=function(){r(function(){null==n.improvement.alertList&&(n.improvement.alertList=[]),n.improvement.alertList.push({id:0,customerImprovementPlanId:0,type:null,preference:null,time:0,timeType:null,status:null})})},n.onRemoveAlert=function(t){l.swal({title:"Está seguro?",text:"Desea confirmar la eliminación de este registro ?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(e){e?r(function(){var e=n.improvement.alertList[t];if(n.improvement.alertList.splice(t,1),0!=e.id){var a={};a.id=e.id,u({method:"POST",url:"api/customer/improvement-plan-alert/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){i.error(t),l.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})},n.dtInstanceImprovementPlan={},n.dtOptionsImprovementPlan=m.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.customerId=n.improvement.customerId,t.entityId=n.improvement.entityId,t.entityName=n.improvement.entityName,JSON.stringify(t)},url:"api/customer-improvement-plan-entity",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){C()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,e,a){f(angular.element(t).contents())(n)}),n.dtColumnsImprovementPlan=[p.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,a,o,i){var r="",l='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+t.id+'" >   <i class="fa fa-edit"></i></a> ',c='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+t.id+'" >   <i class="fa fa-trash-o"></i></a> ';return e.can("cliente_plan_mejoramiento_edit")&&(r+=l),e.can("cliente_plan_mejoramiento_delete")&&(r+=c),n.isView?null:r}),p.newColumn("origin").withTitle("Origen").withOption("width",200).withOption("defaultContent",""),p.newColumn("classification").withTitle("Clasificación").withOption("width",200).withOption("defaultContent",""),p.newColumn("type").withTitle("Tipo").withOption("width",200).withOption("defaultContent",""),p.newColumn("description").withTitle("Hallazgo").withOption("width",200).withOption("defaultContent",""),p.newColumn("responsibleName").withTitle("Responsable").withOption("defaultContent",""),p.newColumn(null).withTitle("Fecha Cierre").withOption("width",200).renderWith(function(t,e,n,a){return"object"==typeof t.endDate&&null!=t.endDate?moment(t.endDate.date).format("DD/MM/YYYY"):null!=t.endDate?moment(t.endDate).format("DD/MM/YYYY"):""}),p.newColumn(null).withTitle("Estado").withOption("width",200).withOption("defaultContent","").renderWith(function(t,e,n,a){var o="label label-success",i=t.status;switch(t.statusCode){case"AB":o="label label-info";break;case"CO":o="label label-success";break;case"CA":o="label label-danger"}return'<span class="'+o+'">'+i+"</span>"})];var C=function(){$("#dtImprovementPlan a.editRow").on("click",function(){var t=$(this).data("id");n.onLoadRecord(t)}),$("#dtImprovementPlan a.delRow").on("click",function(){var t=$(this).data("id");l.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(e){if(e){var a={};a.id=t,u({method:"POST",url:"api/customer/improvement-plan/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){i.error(t),l.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){n.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};n.dtInstanceImprovementPlanCallback=function(t){n.dtInstanceImprovementPlan=t},n.reloadData=function(){n.dtInstanceImprovementPlan.reloadData()}}]),app.controller("ModalInstanceSideCustomerContractDetailAttachmentCtrl",["$stateParams","$rootScope","$scope","$uibModalInstance","$log","$timeout","SweetAlert","isView","question","$filter","FileUploader","$http","DTColumnBuilder","DTOptionsBuilder","$compile","ListService",function(t,e,n,a,o,i,r,l,c,s,d,u,m,p,f,h){var w=0;n.documentType=e.parameters("contract_detail_document_type"),n.documentStatus=e.parameters("customer_document_status"),n.isView=!c.isActive;var g=function(){n.attachment={id:0,customerContractDetailId:c.id,type:null,classification:null,status:n.documentStatus?n.documentStatus[0]:null,version:1,description:""}};g(),n.onCloseModal=function(){a.close(1)},n.onCancel=function(){a.dismiss("cancel")},n.onClear=function(){g()};var v=n.uploader=new d({url:"api/customer/contract-detail-document/upload",formData:[],removeAfterUpload:!0});v.filters.push({name:"customFilter",fn:function(t,e){return this.queue.length<10}}),v.onWhenAddingFileFailed=function(t,e,n){console.info("onWhenAddingFileFailed",t,e,n)},v.onAfterAddingFile=function(t){console.info("onAfterAddingFile",t)},v.onAfterAddingAll=function(t){console.info("onAfterAddingAll",t)},v.onBeforeUploadItem=function(t){console.info("onBeforeUploadItem",t);var e={id:w};t.formData.push(e)},v.onProgressItem=function(t,e){console.info("onProgressItem",t,e)},v.onProgressAll=function(t){console.info("onProgressAll",t)},v.onSuccessItem=function(t,e,n,a){console.info("onSuccessItem",t,e,n,a)},v.onErrorItem=function(t,e,n,a){console.info("onErrorItem",t,e,n,a)},v.onCancelItem=function(t,e,n,a){console.info("onCancelItem",t,e,n,a)},v.onCompleteItem=function(t,e,n,a){console.info("onCompleteItem",t,e,n,a)},v.onCompleteAll=function(){console.info("onCompleteAll"),n.reloadData(),n.onClear()},n.form={submit:function(t){console.log("GUARDANDO...");var e=null;if(t.$invalid){var n=null,e=null;for(n in t)"$"!=n[0]&&(null!==e||t[n].$valid||(e=t[n].$name),t[n].$pristine&&(t[n].$dirty=!0));return angular.element(".ng-invalid[name="+e+"]").focus(),void r.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}r.swal("Validación exitosa","Procediendo con el guardado...","success"),C()},reset:function(t){t.$setPristine(!0)}};var C=function(){var t={},e=JSON.stringify(n.attachment);return t.data=Base64.encode(e),u({method:"POST",url:"api/customer-contract-detail-document/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){i(function(){v.queue.length>0?(w=t.data.result.id,v.uploadAll()):(n.reloadData(),n.onClear())})})["catch"](function(t){r.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){n.reloadData()})};n.dtInstanceContractDocumentAtt={},n.dtOptionsContractDocumentAtt=p.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.customerContractDetailId=c.id,t.statusCode="2",JSON.stringify(t)},url:"api/customer-contract-detail-document",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){b()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,e,a){f(angular.element(t).contents())(n)}),n.dtColumnsContractDocumentAtt=[m.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,e,n,a){var o=t.documentUrl?t.documentUrl:"",i="api/customer/contract-detail-document/download?id="+t.id,r="",l='<a target="_self" class="btn btn-primary btn-xs downloadDocumentRow lnk" href="'+i+'" uib-tooltip="Descargar anexo" data-id="'+t.id+'" data-url="'+o+'" >   <i class="fa fa-download"></i></a> ',c='<a class="btn btn-info btn-xs openDocumentRow lnk" target="_blank" href="'+o+'" uib-tooltip="Abrir anexo" data-id="'+t.id+'" >   <i class="fa fa-folder-open-o"></i></a> ';return""!=o&&(r+=c,r+=l),r}),m.newColumn("documentType").withTitle("Tipo de documento").withOption("width",200),m.newColumn("description").withTitle("Descripción").withOption("width",200),m.newColumn("version").withTitle("Versión").withOption("width",200),m.newColumn("createdAt").withTitle("Fecha Creación").withOption("width",200).withOption("defaultContent",""),m.newColumn("status").withTitle("Estado").withOption("width",200).renderWith(function(t,e,n,a){var o="";switch(t){case"Vigente":o="label label-success";break;case"Anulado":o="label label-danger"}var i='<span class="'+o+'">'+t+"</span>";return i})];var b=function(){$("#dtContractDocumentAtt a.editRow").on("click",function(){})};n.dtInstanceContractDocumentAttCallback=function(t){n.dtInstanceContractDocumentAtt=t},n.reloadData=function(){n.dtInstanceContractDocumentAtt.reloadData()}}]);
"use strict";app.controller("customerContractorSafetyInspectionListItemEditCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","SweetAlert","$rootScope","$http","$timeout","$uibModal","flowFactory","cfpLoadingBar","$document","$filter","$aside","FileUploader","ListService","ngNotify",function(t,e,n,i,o,a,r,s,l,c,u,d,p,m,f,h,w,g,v,C,y,b){function O(){var e=[{name:"customer_contract_safety_inspection_list",value:D},{name:"customer_contract_safety_inspection_header_fields",value:D},{name:"customer_contract_safety_inspection_period",value:D}];y.getDataList(e).then(function(e){t.lists=e.data.data.customerContractSafetyInspectionList,t.headerFields=e.data.data.customerContractSafetyInspectionHeaderFields,t.periodList=e.data.data.customerContractSafetyInspectionPeriod,!t.criteria.period&&t.periodList.length>0&&(t.criteria.period=t.periodList[0]),!t.criteria.list&&t.lists.length>0&&(t.criteria.list=t.lists[0]),A()},function(e){t.status="Unable to load customer data: "+e.message})}function S(){var e=[{name:"customer_contract_safety_inspection_header_fields",value:D}];y.getDataList(e).then(function(e){t.headerFields=e.data.data.customerContractSafetyInspectionHeaderFields,A()},function(e){t.status="Unable to load customer data: "+e.message})}t.currentStep=0,t.criteria={period:null,list:null},t.actions=u.parameters("wg_safety_inspection_action"),t.dangerousnessList=[],t.existingControlList=[];var I={refresh:!0,index:0},x={id:0,code:null},T={model:null},D=t.$parent.currentContract;O(),t.actionOptions={dataSource:t.actions,dataTextField:"item",dataValueField:"value",select:function(t){var e=this.dataItem(t.item);p(function(){T.model.set("action",e),T.model.set("actionValue",e.value),k()})}};var P=!1,k=function(){P||(b.set("<strong>Recuerde guardar los cambios.</strong>",{position:"bottom",sticky:!1,button:!1,duration:6e3,html:!0,type:"info"},function(){P=!1,n.info("Callback triggered after message fades.")}),P=!0)},A=function(){angular.forEach(t.headerFields,function(t,e){"date"==t.dataType&&t.dateValue&&(t.dateValue=new Date(t.dateValue.date))})},_=function(t){if(t&&null!=t.existingControl&&null!=t.dangerousness){var e=parseFloat(t.existingControl.value),n=parseFloat(t.dangerousness.value);return e*n}return 0},L=function(){O(),t.grid.dataSource.read()};p(function(){t.mainGridOptions={dataSource:{type:"odata",transport:{read:{url:"api/customer-contract-safety-inspection-list-item",dataType:"json",type:"POST",data:function(){var e={customerContractorId:D,customerSafetyInspectionConfigListId:x.id,period:t.criteria.period?t.criteria.period.value:0};return e}},parameterMap:function(t,e){return JSON.stringify(t)}},schema:{model:{id:"id",fields:{description:{editable:!1,nullable:!0},documentNumber:{editable:!1,nullable:!0},businessName:{editable:!1,nullable:!0},isActive:{editable:!1,nullable:!0,type:"boolean"}}},data:function(t){return t.data||t},total:function(t){return t.recordsTotal||t.data.length||0}},batch:!0,pageSize:10,serverPaging:!0,serverFiltering:!0,serverSorting:!0},sortable:{mode:"multiple"},pageable:{change:function(t){I.index=t.index,log.info("page.index",I.index)}},filterable:{mode:"row"},toolbar:kendo.template('<a class="k-button k-button-icontext k-grid-custom-save-changes" href="\\#"><span class="k-icon k-update"></span>Guardar Cambios</a>'),dataBound:function(e){t.existingControlOptions={dataSource:t.existingControlList,dataTextField:"description",dataValueField:"id",select:function(t){var e=this.dataItem(t.item);p(function(){T.model.set("existingControl",e),T.model.set("calculate",_(T.model)),k()})}},t.dangerousnessOptions={dataSource:t.dangerousnessList,dataTextField:"description",dataValueField:"id",select:function(t){var e=this.dataItem(t.item);p(function(){T.model.set("dangerousness",e),T.model.set("calculate",_(T.model)),k()})}},this.expandRow(this.tbody.find("tr.k-master-row"))},columns:[{field:"description",title:"Grupo",attributes:{"class":"text-orange text-large"},filterable:{cell:{operator:"contains",suggestionOperator:"contains"}}},{field:null,title:"Avance",width:"150px",attributes:{style:"text-align: center"},filterable:!1,template:function(t){var e='<h4 class="no-margin">'+t.advance+"%</h4>";return e+='<uib-progressbar value="'+t.advance+'" class="progress-xs no-radius no-margin" type="success"></uib-progressbar>',e+=t.answers+" de "+t.questions}},{field:null,title:"Promedio",width:"150px",attributes:{style:"text-align: center"},filterable:!1,template:function(t){var e='<h4 class="no-margin">'+t.average+"%</h4>";return e+='<uib-progressbar value="'+t.total+'" class="progress-xs no-radius no-margin" type="success"></uib-progressbar>',e+="Promedio Total"}}]},t.detailGridOptions=function(e){return{dataSource:{type:"odata",transport:{read:{url:"api/customer-contract-safety-inspection-list-item-question",dataType:"json",type:"POST",data:function(){var n={customerContractorId:D,customerSafetyInspectionConfigListId:x.id,groupId:e.id,period:t.criteria.period?t.criteria.period.value:0};return n}},parameterMap:function(t,e){return JSON.stringify(t)}},schema:{model:{id:"id",fields:{description:{editable:!1,nullable:!0},existingControl:{editable:!0,defaultValue:{id:0,text:null,code:null}},dangerousness:{editable:!0,defaultValue:{id:0,text:null,code:null}},action:{editable:!0,defaultValue:{id:0,item:null,value:null}},calculate:{editable:!0,nullable:!0},actionValue:{editable:!0,nullable:!0}}},data:function(t){return t.data||t},total:function(t){return t.recordsTotal||t.data.length||0}},batch:!0,serverPaging:!1,serverSorting:!0,serverFiltering:!1,filter:{field:"groupId",operator:"eq",value:e.id}},editable:"incell",edit:function(t){var e=t.container.find("[name]").first().attr("name");"calculate"!=e&&"actionValue"!=e||t.sender.closeCell(),T.model=t.model},scrollable:!1,sortable:!0,pageable:!1,columns:[{command:[{text:" ",template:"<a class='btn btn-dark-azure btn btn-sm' ng-click='onSave(dataItem)' uib-tooltip='Guardar Cambios' tooltip-placement='right'><i class='fa fa-save'></i></a> "},{text:" ",template:"<a class='btn btn-light-red btn btn-sm' ng-click='onAddComment(dataItem)' uib-tooltip='Comentarios' tooltip-placement='right'><i class='fa fa-comments'></i></a> "},{text:" ",template:"<a class='btn btn-warning btn btn-sm' ng-click='onAddImprovementPlan(dataItem)' uib-tooltip='Plan Mejoramiento' tooltip-placement='right'><i class='fa fa-plus-square'></i></a> "},{text:" ",template:"<a class='btn btn-info btn btn-sm' ng-click='onAddAttachment(dataItem)' uib-tooltip='Anexos' tooltip-placement='right'><i class='fa fa-paperclip'></i></a> "}],width:"160px",headerAttributes:{style:"display: none"}},{field:"description",title:"Descripción",headerAttributes:{style:"display: none"}},{field:"existingControl",title:"Control",width:"220px",editor:'<input kendo-drop-down-list k-value-primitive="true" k-options="existingControlOptions"  />',template:function(t){return t.existingControl?t.existingControl.description:"-Seleccionar-"},headerAttributes:{style:"display: none"},attributes:{style:"text-align: center;font-weight: bold;","class":"text-capitalize text-dark"}},{field:"dangerousness",title:"Peligrosidad",width:"220px",editor:'<input kendo-drop-down-list k-value-primitive="true" k-options="dangerousnessOptions"  />',template:function(t){return t.dangerousness?t.dangerousness.description:"-Seleccionar-"},headerAttributes:{style:"display: none"},attributes:{style:"text-align: center;font-weight: bold;","class":"text-capitalize text-dark"}},{field:"calculate",title:"icon",width:"70px",headerAttributes:{style:"display: none"},template:function(t){var e=t.calculate?t.calculate:0;return'<span class="badge badge-success text-extra-large">'+e+"</span>"},attributes:{style:"text-align: center;font-weight: bold;"}},{field:"action",title:"Acción",width:"220px",editor:'<input kendo-drop-down-list k-value-primitive="true" k-options="actionOptions"  />',template:function(t){return t.action?t.action.item:"-Seleccionar-"},headerAttributes:{style:"display: none"},attributes:{style:"text-align: center;font-weight: bold;","class":"text-capitalize text-dark"}},{field:"actionValue",title:"icon",width:"70px",headerAttributes:{style:"display: none"},template:function(t){var e="";switch(t.actionValue){case"s-o":e='<i class="fa fa-ban text-yellow text-extra-extra-large"></i>';break;case"s-p":e='<i class="fa fa-minus-circle text-azure-blue text-extra-extra-large"></i>';break;case"s-a":e='<i class="fa fa-circle-o text-red text-extra-extra-large"></i>';break;case"s-t":e='<i class="fa fa-check-circle-o text-green text-extra-extra-large"></i>';break;default:e='<i class="fa fa-question-circle text-orange text-extra-extra-large"></i>'}return e},attributes:{style:"text-align: center;font-weight: bold;"}}]}}}),t.$on("kendoWidgetCreated",function(e,n){void 0!==t.grid&&null!==t.grid||(t.grid=n,t.grid.wrapper.find(".k-grid-toolbar").on("click",".k-grid-custom-save-changes",function(e){var n=[];t.grid.wrapper.find(".hide-grid-header").each(function(t,e){var i=angular.element(this).data("kendoGrid");i.dataSource.hasChanges()&&angular.forEach(i.dataSource.data(),function(t,e){t.dirty&&n.push(t)})}),R(n)}))}),t.form={next:function(t){B()},prev:function(t){E()},goTo:function(t,e){F(e)},submit:function(t){var e=null;if(t.$invalid){var n=null,e=null;for(n in t)"$"!=n[0]&&(null!==e||t[n].$valid||(e=t[n].$name),t[n].$pristine&&(t[n].$dirty=!0));return angular.element(".ng-invalid[name="+e+"]").focus(),void p(function(){c.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")},500)}V()},reset:function(){}};var B=function(){t.currentStep++,q()},E=function(){t.currentStep--,q()},F=function(e){t.currentStep=e,q()},q=function(){t.currentStep>0&&t.currentStep<t.lists.length+1?(x.id=t.lists[t.currentStep-1].id,t.dangerousnessList=t.lists[t.currentStep-1].dangerousnessList,t.existingControlList=t.lists[t.currentStep-1].existingControlList,t.grid.dataSource.page(1)):t.currentStep==t.lists.length+1&&(M(),j(),z())};t.onSelectPeriod=function(){t.grid.dataSource.page(1),M(),j(),z()},t.onSelectList=function(){j(),z()},t.onCancel=function(e){null!=t.$parent&&t.$parent.navToSection("summary","summary",D)},t.onSave=function(t){R([t])};var R=function(t){var e={},i=JSON.stringify(t);return e.data=Base64.encode(i),d({method:"POST",url:"api/customer-contract-safety-inspection-list-item/batch",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(t){p(function(){s.pop("success","Actualización","La información ha sido actualizada satisfactoriamente."),L()})})["catch"](function(t){n.error(t),s.pop("error","Error","Error guardando el registro. Por favor verifique los datos ingresados!")})["finally"](function(){})};t.onSaveHeader=function(e){t.onSaveHeaderBatch([e])},t.onSaveHeaderBatch=function(t){var e={},i=JSON.stringify(t);return e.data=Base64.encode(i),d({method:"POST",url:"api/customer-contract-safety-inspection-header-field/batch",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(t){p(function(){s.pop("success","Actualización","La información ha sido actualizada satisfactoriamente."),S()})})["catch"](function(t){n.error(t),s.pop("error","Error","Error guardando el registro. Por favor verifique los datos ingresados!")})["finally"](function(){})};var N=function(){t.entity={id:0,customerContractorId:D,customerSafetyInspectionList:null,observation:null,period:t.criteria.period}};N();var V=function(){t.entity.period=t.criteria.period;var e={},i=JSON.stringify(t.entity);return e.data=Base64.encode(i),d({method:"POST",url:"api/customer-contract-safety-inspection-list-observation/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(t){p(function(){s.pop("success","Actualización","La información ha sido actualizada satisfactoriamente."),M(),N()})})["catch"](function(t){n.error(t),s.pop("error","Error","Error guardando el registro. Por favor verifique los datos ingresados!")})["finally"](function(){})};t.dtInstanceCustomerContractSafetyInspectionObservation={},t.dtOptionsCustomerContractSafetyInspectionObservation=i.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerContractorId=D,e.period=t.criteria.period?t.criteria.period.value:0,JSON.stringify(e)},url:"api/customer-contract-safety-inspection-list-observation",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,n,i){r(angular.element(e).contents())(t)}),t.dtColumnsCustomerContractSafetyInspectionObservation=[o.newColumn("period").withTitle("Periodo").withOption("width",300).withOption("defaultContent",""),o.newColumn("list").withTitle("Lista").withOption("defaultContent",""),o.newColumn("observation").withTitle("Observación").withOption("defaultContent",""),o.newColumn("user").withTitle("Uusario").withOption("width",200).withOption("defaultContent",""),o.newColumn("createdAt").withTitle("Fecha Creación").withOption("width",150).withOption("defaultContent","")],t.dtInstanceCustomerContractSafetyInspectionObservationCallback=function(e){t.dtInstanceCustomerContractSafetyInspectionObservation=e};var M=function(){t.dtInstanceCustomerContractSafetyInspectionObservation.reloadData()};t.dtOptionsCustomerContractSafetyInspectionDangerousness=i.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerContractorId=D,e.customerSafetyInspectionListId=t.criteria.list?t.criteria.list.id:0,e.period=t.criteria.period?t.criteria.period.value:0,JSON.stringify(e)},url:"api/customer-contract-safety-inspection-list-item-dangerousness",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,n,i){r(angular.element(e).contents())(t)}),t.dtColumnsCustomerContractSafetyInspectionDangerousness=[o.newColumn("period").withTitle("Periodo").withOption("width",150).withOption("defaultContent",""),o.newColumn("description").withTitle("Peligrosidad").withOption("defaultContent",""),o.newColumn("quantity").withTitle("Cantidad").withOption("defaultContent","")],t.dtInstanceCustomerContractSafetyInspectionDangerousnessCallback=function(e){t.dtInstanceCustomerContractSafetyInspectionDangerousness=e};var j=function(){t.dtInstanceCustomerContractSafetyInspectionDangerousness.reloadData()};t.dtOptionsCustomerContractSafetyInspectionActions=i.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerContractorId=D,e.customerSafetyInspectionListId=t.criteria.list?t.criteria.list.id:0,e.period=t.criteria.period?t.criteria.period.value:0,JSON.stringify(e)},url:"api/customer-contract-safety-inspection-list-item-action",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,n,i){r(angular.element(e).contents())(t)}),t.dtColumnsCustomerContractSafetyInspectionActions=[o.newColumn("period").withTitle("Periodo").withOption("width",150).withOption("defaultContent",""),o.newColumn("description").withTitle("Acciones").withOption("defaultContent",""),o.newColumn("quantity").withTitle("Cantidad").withOption("defaultContent","")],t.dtInstanceCustomerContractSafetyInspectionActionsCallback=function(e){t.dtInstanceCustomerContractSafetyInspectionActions=e};var z=function(){t.dtInstanceCustomerContractSafetyInspectionActions.reloadData()};t.onAddComment=function(e){var i=v.open({templateUrl:u.app.views.urlRoot+"modules/customer/common/modals/customer_questions_comment_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideCustomerContractorSafetyInspectionListItemCommentCtrl",scope:t,resolve:{question:function(){return e}}});i.result.then(function(){},function(){n.info("Modal dismissed at: "+new Date)})},t.onAddImprovementPlan=function(e){var i=v.open({templateUrl:u.app.views.urlRoot+"modules/customer/common/modals/customer_improvement_plan_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideCustomerContractorSafetyInspectionListItemImprovementPlanCtrl",scope:t,resolve:{question:function(){return e},isView:function(){return t.isView}}});i.result.then(function(){},function(){n.info("Modal dismissed at: "+new Date)})},t.onAddAttachment=function(e){var i=v.open({templateUrl:u.app.views.urlRoot+"modules/customer/contract/safety/customer_contractor_safety_inspection_attachment_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideCustomerContractorSafetyInspectionListItemAttachmentCtrl",scope:t,resolve:{isView:function(){return t.isView},question:function(){return e}}});i.result.then(function(){},function(){n.info("Modal dismissed at: "+new Date)})}}]),app.controller("ModalInstanceSideCustomerContractorSafetyInspectionListItemCommentCtrl",["$stateParams","$rootScope","$scope","$uibModalInstance","question","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile","$document",function(t,e,n,i,o,a,r,s,l,c,u,d,p,m,f,h){n.isView=!1;var w=function(){n.entity={id:0,customerContractorSafetyInspectionListItemId:o.id,comment:""}};w(),n.onCloseModal=function(){i.close(1)},n.onCancel=function(){i.dismiss("cancel")},n.onClear=function(){w()},n.form={submit:function(t){var e=null;if(t.$invalid){var i=null,e=null;for(i in t)"$"!=i[0]&&(null!==e||t[i].$valid||(e=t[i].$name),t[i].$pristine&&(t[i].$dirty=!0));return angular.element(".ng-invalid[name="+e+"]").focus(),void r(function(){c.pop("error","Error","Por favor verifique los datos requeridos del formulario y vuelva a intentarlo")},500)}n.onSave()},reset:function(t){t.$setPristine(!0)}},n.onSave=function(){var t={},e=JSON.stringify(n.entity);return t.data=Base64.encode(e),l({method:"POST",url:"api/customer-contract-safety-inspection-list-item-comment/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){r(function(){c.pop("success","Operación Exitosa","Actualización exitosa."),n.onClear(),n.reloadData()})})["catch"](function(t){c.pop("Error","Error inesperado",t)})["finally"](function(){})},n.dtInstanceQuestionComment={},n.dtOptionsQuestionComment=m.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.customerContractorSafetyInspectionListItemId=o.id,JSON.stringify(t)},url:"api/customer-contract-safety-inspection-list-item-comment",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,e,i){f(angular.element(t).contents())(n)}),n.dtColumnsQuestionComment=[p.newColumn("comment").withTitle("Comentario"),p.newColumn("user").withTitle("Usuario").withOption("width",200).withOption("defaultContent",200),p.newColumn("createdAt").withTitle("Fecha").withOption("width",200)],n.dtInstanceQuestionCommentCallback=function(t){n.dtInstanceQuestionComment=t},n.reloadData=function(){n.dtInstanceQuestionComment.reloadData()}}]),app.controller("ModalInstanceSideCustomerContractorSafetyInspectionListItemImprovementPlanCtrl",["$stateParams","$rootScope","$scope","$uibModalInstance","question","$log","$timeout","SweetAlert","isView","$filter","FileUploader","$http","DTOptionsBuilder","DTColumnBuilder","$compile",function(t,e,n,i,o,a,r,s,l,c,u,d,p,m,f){n.isView=!1,n.maxDate=new Date,n.datePickerConfig={culture:"es-CO",format:"dd/MM/yyyy HH:mm"},n.responsibleList=[],n.typesAlert=c("orderBy")(e.parameters("tracking_alert_type"),"id",!1),n.typesTime=e.parameters("tracking_alert_timeType"),n.statusAlert=e.parameters("tracking_alert_status"),n.preferencesAlert=e.parameters("tracking_alert_preference"),n.typeList=e.parameters("improvement_plan_type");var h=function(){n.improvement={id:0,customerId:t.customerId,classificationName:o.period,classificationId:o.period,entityName:"CS",entityId:o.id,type:null,endDate:null,description:"",observation:"",responsible:null,isRequiresAnalysis:!1,status:{id:0,value:"CR",item:"Creada"},trackingList:[],alertList:[]}};h(),n.onLoadRecord=function(t){if(0!=t){var e={id:t};d({method:"GET",url:"api/customer/improvement-plan",params:e})["catch"](function(t,e){if(403==e){var n=null!==t.message&&void 0!==t.message?t.message:"app.clientes.list";s.swal("No Autorizado","No estas autorizado para ver esta información.","error"),r(function(){$state.go(n)},3e3)}else 404==e?s.swal("Información no disponible","Centro de trabajo no encontrado","error"):s.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(t){r(function(){null!=t.data.result&&""!=t.data.result&&(n.improvement=t.data.result,v())},400)})["finally"](function(){})}else n.loading=!1},n.onCloseModal=function(){i.close(1)},n.onCancel=function(){i.dismiss("cancel")},n.onClear=function(){};var w=function(){var e={customer_id:t.customerId};return d({method:"POST",url:"api/customer/improvement-plan/list-data",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(t){r(function(){n.responsibleList=t.data.data.responsible})})["catch"](function(t){s.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};w(),n.master=n.improvement,n.form={submit:function(t){var e=null;if(t.$invalid){var n=null,e=null;for(n in t)"$"!=n[0]&&(null!==e||t[n].$valid||(e=t[n].$name),t[n].$pristine&&(t[n].$dirty=!0));return angular.element(".ng-invalid[name="+e+"]").focus(),void s.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}s.swal("Validación exitosa","Procediendo con el guardado...","success"),g()},reset:function(t){n.improvement=angular.copy(n.master),t.$setPristine(!0)}};var g=function(){var t={},e=JSON.stringify(n.improvement);return t.data=Base64.encode(e),d({method:"POST",url:"api/customer/improvement-plan/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){r(function(){h()})})["catch"](function(t){s.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){n.reloadData()})},v=function(){null!=n.improvement.endDate&&(n.improvement.endDate=new Date(n.improvement.endDate.date)),angular.forEach(n.improvement.trackingList,function(t,e){null!=t.startDate&&(t.startDate=new Date(t.startDate.date))})};n.onAddTracking=function(){r(function(){null==n.improvement.trackingList&&(n.improvement.trackingList=[]),n.improvement.trackingList.push({id:0,customerImprovementPlanId:0,responsible:null,startDate:null})})},n.onRemoveTracking=function(t){s.swal({title:"Está seguro?",text:"Desea confirmar la eliminación de este registro ?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(e){e?r(function(){var e=n.improvement.trackingList[t];if(n.improvement.trackingList.splice(t,1),0!=e.id){var i={};i.id=e.id,d({method:"POST",url:"api/customer/improvement-plan-tracking/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){a.error(t),s.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})},n.onAddAlert=function(){r(function(){null==n.improvement.alertList&&(n.improvement.alertList=[]),n.improvement.alertList.push({id:0,customerImprovementPlanId:0,type:null,preference:null,time:0,timeType:null,status:null})})},n.onRemoveAlert=function(t){s.swal({title:"Está seguro?",text:"Desea confirmar la eliminación de este registro ?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(e){e?r(function(){var e=n.improvement.alertList[t];if(n.improvement.alertList.splice(t,1),0!=e.id){var i={};i.id=e.id,d({method:"POST",url:"api/customer/improvement-plan-alert/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){a.error(t),s.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})},n.dtInstanceImprovementPlan={},n.dtOptionsImprovementPlan=p.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.customerId=n.improvement.customerId,t.entityId=n.improvement.entityId,t.entityName=n.improvement.entityName,JSON.stringify(t)},url:"api/customer-improvement-plan-entity",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){C()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,e,i){f(angular.element(t).contents())(n)}),n.dtColumnsImprovementPlan=[m.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,i,o,a){var r="",s='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+t.id+'" >   <i class="fa fa-edit"></i></a> ',l='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+t.id+'" >   <i class="fa fa-trash-o"></i></a> ';return e.can("cliente_plan_mejoramiento_edit")&&(r+=s),e.can("cliente_plan_mejoramiento_delete")&&(r+=l),n.isView?null:r}),m.newColumn("origin").withTitle("Origen").withOption("width",200).withOption("defaultContent",""),m.newColumn("classification").withTitle("Clasificación").withOption("width",200).withOption("defaultContent",""),m.newColumn("type").withTitle("Tipo").withOption("width",200).withOption("defaultContent",""),m.newColumn("description").withTitle("Hallazgo").withOption("width",200).withOption("defaultContent",""),m.newColumn("responsibleName").withTitle("Responsable").withOption("defaultContent",""),m.newColumn(null).withTitle("Fecha Cierre").withOption("width",200).renderWith(function(t,e,n,i){return"object"==typeof t.endDate&&null!=t.endDate?moment(t.endDate.date).format("DD/MM/YYYY"):null!=t.endDate?moment(t.endDate).format("DD/MM/YYYY"):""}),m.newColumn(null).withTitle("Estado").withOption("width",200).withOption("defaultContent","").renderWith(function(t,e,n,i){var o="label label-success",a=t.status;switch(t.statusCode){case"AB":o="label label-info";break;case"CO":o="label label-success";break;case"CA":o="label label-danger"}return'<span class="'+o+'">'+a+"</span>"})];var C=function(){$("#dtImprovementPlan a.editRow").on("click",function(){var t=$(this).data("id");n.onLoadRecord(t)}),$("#dtImprovementPlan a.delRow").on("click",function(){var t=$(this).data("id");s.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(e){if(e){var i={};i.id=t,d({method:"POST",url:"api/customer/improvement-plan/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){a.error(t),s.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){n.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};n.dtInstanceImprovementPlanCallback=function(t){n.dtInstanceImprovementPlan=t},n.reloadData=function(){n.dtInstanceImprovementPlan.reloadData()}}]),app.controller("ModalInstanceSideCustomerContractorSafetyInspectionListItemAttachmentCtrl",["$stateParams","$rootScope","$scope","$uibModalInstance","$log","$timeout","SweetAlert","isView","question","$filter","FileUploader","$http","DTColumnBuilder","DTOptionsBuilder","$compile","ListService","toaster",function(t,e,n,i,o,a,r,s,l,c,u,d,p,m,f,h,w){var g=0;n.documentType=e.parameters("contract_detail_document_type"),n.documentStatus=e.parameters("customer_document_status"),n.isView=!1;var v=function(){n.attachment={id:0,customerContractorSafetyInspectionListItemId:l.id,type:null,classification:null,status:n.documentStatus?n.documentStatus[0]:null,version:1,description:""}};v(),n.onCloseModal=function(){i.close(1)},n.onCancel=function(){i.dismiss("cancel")},n.onClear=function(){v()};var C=n.uploader=new u({url:"api/customer-contract-safety-inspection-list-item-document/upload",formData:[],removeAfterUpload:!0});C.filters.push({name:"customFilter",fn:function(t,e){return this.queue.length<10}}),C.onWhenAddingFileFailed=function(t,e,n){console.info("onWhenAddingFileFailed",t,e,n)},C.onAfterAddingFile=function(t){console.info("onAfterAddingFile",t)},C.onAfterAddingAll=function(t){console.info("onAfterAddingAll",t)},C.onBeforeUploadItem=function(t){console.info("onBeforeUploadItem",t);var e={id:g};t.formData.push(e)},C.onProgressItem=function(t,e){console.info("onProgressItem",t,e)},C.onProgressAll=function(t){console.info("onProgressAll",t)},C.onSuccessItem=function(t,e,n,i){console.info("onSuccessItem",t,e,n,i)},C.onErrorItem=function(t,e,n,i){console.info("onErrorItem",t,e,n,i)},C.onCancelItem=function(t,e,n,i){console.info("onCancelItem",t,e,n,i)},C.onCompleteItem=function(t,e,n,i){console.info("onCompleteItem",t,e,n,i)},C.onCompleteAll=function(){console.info("onCompleteAll"),w.pop("success","Operación Exitosa","La información ha sido guardada satisfactoriamente"),n.reloadData(),n.onClear()},n.form={submit:function(t){var e=null;if(t.$invalid){var n=null,e=null;for(n in t)"$"!=n[0]&&(null!==e||t[n].$valid||(e=t[n].$name),t[n].$pristine&&(t[n].$dirty=!0));return angular.element(".ng-invalid[name="+e+"]").focus(),void r.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}y()},reset:function(t){t.$setPristine(!0)}};var y=function(){var t={},e=JSON.stringify(n.attachment);
return t.data=Base64.encode(e),d({method:"POST",url:"api/customer-contract-safety-inspection-list-item-document/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){a(function(){C.queue.length>0?(g=t.data.result.id,C.uploadAll()):(w.pop("success","Operación Exitosa","La información ha sido guardada satisfactoriamente"),n.reloadData(),n.onClear())})})["catch"](function(t){r.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){n.reloadData()})};n.dtInstanceContractSafetyInspectionDocument={},n.dtOptionsContractfetyInspectionDocument=m.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.customerContractorSafetyInspectionListItemId=l.id,t.statusCode="2",JSON.stringify(t)},url:"api/customer-contract-safety-inspection-list-item-document",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){b()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,e,i){f(angular.element(t).contents())(n)}),n.dtColumnsContractfetyInspectionDocument=[p.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,e,n,i){var o=t.documentUrl?t.documentUrl:"",a="api/customer-contract-safety-inspection-list-item-document/download?id="+t.id,r="",s='<a target="_self" class="btn btn-primary btn-xs downloadDocumentRow lnk" href="'+a+'" uib-tooltip="Descargar anexo" data-id="'+t.id+'" data-url="'+o+'" >   <i class="fa fa-download"></i></a> ',l='<a class="btn btn-info btn-xs openDocumentRow lnk" target="_blank" href="'+o+'" uib-tooltip="Abrir anexo" data-id="'+t.id+'" >   <i class="fa fa-folder-open-o"></i></a> ';return""!=o&&(r+=l,r+=s),r}),p.newColumn("documentType").withTitle("Tipo de documento").withOption("width",200),p.newColumn("description").withTitle("Descripción").withOption("width",200),p.newColumn("version").withTitle("Versión").withOption("width",200),p.newColumn("createdAt").withTitle("Fecha Creación").withOption("width",200).withOption("defaultContent",""),p.newColumn("status").withTitle("Estado").withOption("width",200).renderWith(function(t,e,n,i){var o="";switch(t){case"Vigente":o="label label-success";break;case"Anulado":o="label label-danger"}var a='<span class="'+o+'">'+t+"</span>";return a})];var b=function(){$("#dtContractfetyInspectionDocument a.editRow").on("click",function(){})};n.dtInstanceContractSafetyInspectionDocumentCallback=function(t){n.dtInstanceContractSafetyInspectionDocument=t},n.reloadData=function(){n.dtInstanceContractSafetyInspectionDocument.reloadData()}}]);
"use strict";app.controller("customerImprovementPlanCtrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout",function(t,e,o,n,a,i){var r=o;r.info("loading..customerImprovementPlanCtrl!!! "),t.improvement_section="list",t.currentId=0,t.reload=!1,t.statusMode="create",t.navToSection=function(e,o,n){i(function(){t.improvement_section=e,t.editMode=o,t.$parent.switchSubTab(o),t.currentId=n})},t.tabsloaded=["profile"],t.tabname="profile",t.titletab="",t.switchTab=function(e,o){i(function(){t.tabname=e,t.titletab=o,t.tabsloaded.push(e)})}}]);
"use strict";app.controller("customerImprovementPlanListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","SweetAlert","$http","$filter","$document","$aside","$uibModal",function(e,t,n,a,o,i,r,l,s,c,u,d,m,p,f,w,h){e.dtInstanceCustomerImprovementPlan={},e.dtOptionsCustomerImprovementPlan=a.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerId=t.customerId,JSON.stringify(e)},url:"api/customer-improvement-plan",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){v()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,n,a){r(angular.element(t).contents())(e)}),e.dtColumnsCustomerImprovementPlan=[o.newColumn(null).withTitle("Acciones").withOption("width",120).notSortable().renderWith(function(e,t,n,a){var o="",i="",r='<a class="btn btn-info btn-xs viewRow lnk" href="#" uib-tooltip="Ver" data-id="'+e.id+'" >   <i class="fa fa-eye"></i></a> ',l='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar"  data-id="'+e.id+'"'+i+' >   <i class="fa fa-play-circle"></i></a> ',s='<a class="btn btn-danger btn-xs cancelRow lnk" href="#" uib-tooltip="Cancelar" data-id="'+e.id+'" >   <i class="fa fa-ban"></i></a> ',u=' | <a class="btn btn-success btn-xs completeRow lnk" href="#" uib-tooltip="Completar" data-id="'+e.id+'" >   <i class="fa fa-check-circle-o"></i></a> ',d=' | <a class="btn btn-dark-azure btn-xs openRow lnk" href="#" uib-tooltip="Reabrir" data-id="'+e.id+'" >   <i class="fa fa-refresh"></i></a> ';'<a class="btn btn-danger btn-xs delRow lnk" href="#"  uib-tooltip="Eliminar" data-id="'+e.id+'"'+i+' >   <i class="fa fa-trash-o"></i></a> ';return o+="CO"==e.statusCode||"CA"==e.statusCode?r:l,"AB"==e.statusCode&&(c.can("plan_mejoramiento_complete")&&1==e.canComplete&&(o+=u),c.can("plan_mejoramiento_cancel")&&(o+=s)),"CO"==e.statusCode&&c.can("plan_mejoramiento_reopen")&&(o+=d),o}),o.newColumn("origin").withTitle("Origen").withOption("width",200).withOption("defaultContent",""),o.newColumn("classification").withTitle("Clasificación").withOption("width",200).withOption("defaultContent",""),o.newColumn("type").withTitle("Tipo").withOption("width",200).withOption("defaultContent",""),o.newColumn("description").withTitle("Hallazgo").withOption("width",200).withOption("defaultContent",""),o.newColumn(null).withTitle("Análisis de Causas").withOption("width",200).renderWith(function(e,t,n,a){var o=e.isRequiresAnalysis||1==e.isRequiresAnalysis?"label label-success":"label label-danger",i=e.isRequireAnalysisText,r='<span class="'+o+'">'+i+"</span>";return r}),o.newColumn("responsibleName").withTitle("Responsable").withOption("defaultContent",""),o.newColumn(null).withTitle("Fecha Cierre").withOption("width",200).renderWith(function(e,t,n,a){return"object"==typeof e.endDate&&null!=e.endDate?moment(e.endDate.date).format("DD/MM/YYYY"):null!=e.endDate?moment(e.endDate).format("DD/MM/YYYY"):""}),o.newColumn(null).withTitle("Planes de Acción?").withOption("width",200).withOption("defaultContent","").renderWith(function(e,t,n,a){var o="label label-success",i=e.hasActionPlan;switch(e.hasActionPlan){case"Si":o="label label-success";break;case"No":o="label label-danger"}return'<span class="'+o+'">'+i+"</span>"}),o.newColumn(null).withTitle("Estado").withOption("width",200).withOption("defaultContent","").renderWith(function(e,t,n,a){var o="label label-success",i=e.status;switch(e.statusCode){case"AB":o="label label-dark-azure";break;case"CO":o="label label-success";break;case"CA":o="label label-danger"}return'<span class="'+o+'">'+i+"</span>"})];var v=function(){angular.element("#dtCustomerImprovementPlan a.viewRow").on("click",function(){var t=angular.element(this).data("id");e.onView(t)}),angular.element("#dtCustomerImprovementPlan a.editRow").on("click",function(){var t=angular.element(this).data("id");e.onEdit(t)}),angular.element("#dtCustomerImprovementPlan a.cancelRow").on("click",function(){var e=angular.element(this).data("id");b({id:e,status:"CA"})}),angular.element("#dtCustomerImprovementPlan a.openRow").on("click",function(){var e=angular.element(this).data("id");b({id:e,status:"AB"})}),angular.element("#dtCustomerImprovementPlan a.completeRow").on("click",function(){var e=angular.element(this).data("id");C(e)}),angular.element("#dtCustomerImprovementPlan a.delRow").on("click",function(){var t=angular.element(this).data("id");d.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(a){if(a){var o={};o.id=t,m({method:"POST",url:"api/minimum-standard-item/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){n.error(e),d.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){e.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};e.dtInstanceCustomerImprovementPlanCallback=function(t){e.dtInstanceCustomerImprovementPlan=t},e.reloadData=function(){e.dtInstanceCustomerImprovementPlan.reloadData()},e.onEdit=function(t){null!=e.$parent&&e.$parent.navToSection("edit","edit",t)},e.onView=function(t){null!=e.$parent&&e.$parent.navToSection("edit","view",t)},e.onAttachment=function(t){null!=e.$parent&&e.$parent.navToSection("attachment","attachment",t)},e.onDownloadAttachment=function(t){var n=h.open({templateUrl:c.app.views.urlRoot+"modules/common/modals/document_filter_modal.htm",controller:"ModalInstanceSideImprovementPlanDownloadAttachmentCtrl",windowTopClass:"top-modal",resolve:{improvement:function(){return{id:0}},title:function(){return"Descargar anexos de planes de mejoramiento"},action:function(){return"Cancelar"}}});n.result.then(function(){e.reloadData()},function(){})},e.onExportExcel=function(){var e=JSON.stringify({customerId:t.customerId});angular.element("#downloadDocument")[0].src="api/customer-improvement-plan/export-excel?data="+Base64.encode(e)},e.addFilter=function(){null==e.audit.filters&&(e.audit.filters=[]),e.audit.filters.push({id:0,field:null,criteria:null,condition:null,value:""})},e.onFilter=function(){e.request.data=Base64.encode(JSON.stringify(e.audit)),e.reloadData()},e.removeFilter=function(t){e.audit.filters.splice(t,1)};var C=function(t){var n=JSON.stringify({id:t,reason:null,status:{value:"CO"}}),a={data:Base64.encode(n)};return m({method:"POST",url:"api/customer-improvement-plan/update",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(t){u(function(){l.pop("success","Operación Exitosa","Actualización exitosa."),e.reloadData()})})["catch"](function(e){d.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){e.reloadData()})},b=function(t){var n=w.open({templateUrl:c.app.views.urlRoot+"modules/customer/action-plan/tabs/customer_improvement_plan_action_plan_comment_edit_modal.htm",placement:"right",size:"sm",backdrop:!0,controller:"ModalInstanceSideImprovementPlanUpdateCtrl",scope:e,resolve:{improvement:function(){return t}}});n.result.then(function(){e.reloadData()},function(){e.reloadData()})}}]),app.controller("ModalInstanceSideImprovementPlanUpdateCtrl",["$rootScope","$stateParams","$scope","$uibModal","$uibModalInstance","improvement","$log","$timeout","SweetAlert","$http","toaster","$filter","$aside","$document","DTColumnBuilder","DTOptionsBuilder","$compile",function(e,t,n,a,o,i,r,l,s,c,u,d,m,p,f,w,h){n.loading=!0,n.onCloseModal=function(){o.close(1)},n.onCancel=function(){o.dismiss("cancel")};var v=function(){n.entity={id:i.id,reason:"",status:{value:i.status}}};v(),n.form={submit:function(e){var t=null;if(e.$invalid){var n=null,t=null;for(n in e)"$"!=n[0]&&(null!==t||e[n].$valid||(t=e[n].$name),e[n].$pristine&&(e[n].$dirty=!0));return angular.element(".ng-invalid[name="+t+"]").focus(),void s.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}C()},reset:function(e){}};var C=function(){var e=JSON.stringify(n.entity),t={data:Base64.encode(e)};return c({method:"POST",url:"api/customer-improvement-plan/update",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(e){l(function(){u.pop("success","Operación Exitosa","Actualización exitosa."),n.onCloseModal()})})["catch"](function(e){s.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})}}]),app.controller("ModalInstanceSideImprovementPlanDownloadAttachmentCtrl",["$rootScope","$stateParams","$scope","$uibModal","$uibModalInstance","improvement","title","$log","$timeout","SweetAlert","$http","toaster","$filter","$aside","$document","DTColumnBuilder","DTOptionsBuilder","$compile","ListService","ngNotify",function(e,t,n,a,o,i,r,l,s,c,u,d,m,p,f,w,h,v,C,b){function g(){var e=n.filter.year?n.filter.year.value:null,a=[{name:"customer_document_type",value:t.customerId},{name:"customer_improvement_plan_document_periods",value:t.customerId,year:e}];C.getDataList(a).then(function(e){n.documentType=e.data.data.customerDocumentType,n.years=e.data.data.customerImprovementPlanDocumentPeriod.years,n.months=e.data.data.customerImprovementPlanDocumentPeriod.months},function(e){n.status="Unable to load customer data: "+e.message})}n.loading=!0,n.title=r,n.onCloseModal=function(){o.close(1)},n.onCancel=function(){o.dismiss("cancel")},n.onSelectYear=function(){g()};var O=function(){n.filter={id:t.customerId}};O(),g(),n.form={submit:function(e){var t=null;if(e.$invalid){var a=null,t=null;for(a in e)"$"!=a[0]&&(null!==t||e[a].$valid||(t=e[a].$name),e[a].$pristine&&(e[a].$dirty=!0));return angular.element(".ng-invalid[name="+t+"]").focus(),void c.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}return n.filter.type||n.filter.year||n.filter.month?void y():void c.swal("El formulario contiene errores!","Por favor seleccione al menos un filtro e intentelo nuevamente.","error")},reset:function(e){}};var y=function(){b.set("El archivo se está generando.",{position:"bottom",sticky:!0,button:!1,html:!0});var e={customerId:t.customerId,audit:n.filter},a={},o=JSON.stringify(e);a.data=Base64.encode(o),u({method:"POST",url:"api/customer-improvement-plan-document/export",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(e){var t='<div class="row"><div class="col-sm-12 text-center">Por favor espere y verifique su correo y la bandeja de mensajes!</div> </div>';b.set(t,{position:"bottom",sticky:!0,type:"success",button:!0,html:!0}),n.onCloseModal()})["catch"](function(e){b.set(e.data.message,{position:"bottom",sticky:!0,type:"error",button:!0,html:!0})})["finally"](function(){})}}]);
"use strict";app.controller("customerImprovementPlanAttachmentCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","SweetAlert","$rootScope","$http","$timeout","$uibModal","flowFactory","cfpLoadingBar","$filter","$document","FileUploader","$localStorage","$aside","ListService","$ngConfirm",function(n,t,e,o,a,i,r,l,c,s,u,d,m,p,f,h,w,v,g,b,C,A,D){function S(){var e=[{name:"customer_document_type",value:t.customerId}];A.getDataList(e).then(function(t){n.documentType=t.data.data.customerDocumentType},function(t){n.status="Unable to load customer data: "+t.message})}console.log("editMode attachment",n.$parent.editMode),n.isVisible="view"!=n.$parent.editMode;var I=null,y=0;n.currentId=n.$parent.currentId,n.documentClassification=u.parameters("customer_document_classification"),n.documentStatus=u.parameters("customer_document_status"),n.$storage=b.$default({hideMinimumStandardAttachmentCanceled:!0}),S(),n.onCancel=function(){null!=n.$parent&&n.$parent.navToSection("list","list",n.currentId)},n.onClear=function(){T()};var T=function(){n.attachment={id:0,customerImprovementPlanItemId:0,type:null,classification:null,description:"",status:n.documentStatus?n.documentStatus[0]:null,version:1},I&&I.$setPristine(!0)};T();var O=function(t){var e={id:t};d({method:"GET",url:"api/customer-improvement-plan-document/get",params:e})["catch"](function(n,t){}).then(function(t){m(function(){n.attachment=t.data.result,n.attachment.version=parseInt(n.attachment.version)+1})})["finally"](function(){})},x=n.uploader=new g({url:"api/customer-improvement-plan-document/upload",formData:[],removeAfterUpload:!0});x.filters.push({name:"customFilter",fn:function(n,t){return this.queue.length<10}}),x.onWhenAddingFileFailed=function(n,t,e){console.info("onWhenAddingFileFailed",n,t,e)},x.onAfterAddingFile=function(n){console.info("onAfterAddingFile",n)},x.onAfterAddingAll=function(n){console.info("onAfterAddingAll",n)},x.onBeforeUploadItem=function(n){console.info("onBeforeUploadItem",n);var t={id:y};n.formData.push(t)},x.onProgressItem=function(n,t){console.info("onProgressItem",n,t)},x.onProgressAll=function(n){console.info("onProgressAll",n)},x.onSuccessItem=function(n,t,e,o){console.info("onSuccessItem",n,t,e,o)},x.onErrorItem=function(n,t,e,o){console.info("onErrorItem",n,t,e,o)},x.onCancelItem=function(n,t,e,o){console.info("onCancelItem",n,t,e,o)},x.onCompleteItem=function(n,t,e,o){console.info("onCompleteItem",n,t,e,o)},x.onCompleteAll=function(){console.info("onCompleteAll"),n.reloadData(),n.onClear()},n.form={submit:function(n){I=n;var t=null;if(n.$invalid){var e=null,t=null;for(e in n)"$"!=e[0]&&(null!==t||n[e].$valid||(t=n[e].$name),n[e].$pristine&&(n[e].$dirty=!0));return angular.element(".ng-invalid[name="+t+"]").focus(),void s.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}s.swal("Validación exitosa","Procediendo con el guardado...","success"),P()},reset:function(n){n.$setPristine(!0)}};var P=function(){var t={},e=JSON.stringify(n.attachment);return t.data=Base64.encode(e),d({method:"POST",url:"api/customer-improvement-plan-document/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){m(function(){x.queue.length>0?(y=t.data.result.id,x.uploadAll()):(n.reloadData(),n.onClear())})})["catch"](function(n){s.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){n.reloadData()})};n.dtOptionsMinimumStandardDocument40595=o.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerId=t.customerId,n.$storage.hideMinimumStandardAttachmentCanceled&&(e.statusCode="2"),JSON.stringify(e)},url:"api/customer-improvement-plan-document",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){_()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,e,o){r(angular.element(t).contents())(n)}),n.dtColumnsMinimumStandardDocument40595=[a.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,e,o,a){var i=t.documentUrl?t.documentUrl:"",r="api/customer-improvement-plan-document/download?id="+t.id,l="",c='<a target="_self" class="btn btn-primary btn-xs downloadDocumentRow lnk" href="'+r+'" uib-tooltip="Descargar anexo" data-id="'+t.id+'" >   <i class="fa fa-download"></i></a> ',s='<a class="btn btn-info btn-xs openDocumentRow lnk" target="_blank" href="'+i+'" uib-tooltip="Abrir anexo" data-id="'+t.id+'" >   <i class="fa fa-folder-open-o"></i></a> ',d='<a class="btn btn-danger btn-xs delDocumentRow lnk" href="#" uib-tooltip="Anular anexo" data-id="'+t.id+'" >   <i class="fa fa-ban"></i></a> ',m=!1;return null==t.protectionType?m=!0:"public"==t.protectionType?m=!0:"private"==t.protectionType&&1==t.hasPermission&&(m=!0),u.can("clientes_anexo_open")&&""!=i&&(l+=s),u.can("clientes_anexo_download")&&""!=i&&(l+=c),u.can("clientes_anexo_invalidate")&&n.isVisible&&"2"!=t.statusCode&&(l+=d),m?l:""}),a.newColumn("documentType").withTitle("Tipo de documento").withOption("width",200),a.newColumn("classification").withTitle("Clasificación").withOption("width",200),a.newColumn("description").withTitle("Descripción").withOption("width",200),a.newColumn("version").withTitle("Versión").withOption("width",200),a.newColumn("createdAt").withTitle("Fecha Creación").withOption("width",200).withOption("defaultContent",""),a.newColumn("status").withTitle("Estado").withOption("width",200).renderWith(function(n,t,e,o){var a="";switch(n){case"Vigente":a="label label-success";break;case"Anulado":a="label label-danger"}var i='<span class="'+a+'">'+n+"</span>";return i})];var _=function(){$("#dtMinimumStandardDocument40595 a.editRow").on("click",function(){var n=$(this).data("id"),t=$(this).data("url");""==t?s.swal("Error en la descarga","No existe un anexo para descargar","error"):jQuery("#downloadDocument")[0].src="api/customer-improvement-plan-document/download?id="+n}),angular.element("#dtMinimumStandardDocument40595 a.delDocumentRow").on("click",function(){var t=angular.element(this).data("id");D({boxWidth:"35%",useBootstrap:!1,animation:"bottom",closeAnimation:"scale",title:"Está seguro?",content:"<strong>Anulará</strong> el anexo seleccionado",scope:n,type:"red",typeAnimated:!0,buttons:{cancel:{text:"Anular y cambiar versión",btnClass:"btn-primary",action:function(e,o){n.attachment.id=t,n.isView=!1,O(t),l.pop("info","Anulación Anexo","El anexo se cargó satisfactoriamente, seleccione una nueva versión del documento")}},fullCancel:{text:"Anular definitivamente",btnClass:"btn-red",action:function(o,a){var i={};i.id=t,d({method:"POST",url:"api/customer-improvement-plan-document/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(t){swal("Eliminado","Anexo anulado satisfactoriamente","info"),n.reloadData()})["catch"](function(n){e.error(n),s.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}},closeAll:{text:"Cancelar",btnClass:"btn-default",action:function(n,t){}}}})})};n.dtInstanceMinimumStandardDocument40595Callback=function(t){n.dtInstanceMinimumStandardDocument40595=t},n.reloadData=function(){n.dtInstanceMinimumStandardDocument40595.reloadData()},n.onShowCancelledChange=function(){n.reloadData()}}]);
"use strict";app.controller("customerImprovementPlanEditCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","SweetAlert","$rootScope","$http","$timeout","$uibModal","flowFactory","cfpLoadingBar","$filter","$document","FileUploader","$localStorage","$aside",function(e,n,a,t,o,r,i,l,s,c,u,d,m,p,f,v,w,h,C,g,b){var y=this;y.btnDisabled=!1,e.loading=!0,e.isCreate=0==e.$parent.currentId,e.isView="view"==e.$parent.editMode,e.fishBoneUrl="fish-bone-improvement/"+e.$parent.currentId+"/"+Math.random(),console.log(e.fishBoneUrl),e.maxDate=new Date,e.datePickerConfig={culture:"es-CO",format:"dd/MM/yyyy HH:mm"},e.responsibleList=[],e.typesAlert=w("orderBy")(u.parameters("tracking_alert_type"),"id",!1),e.typesTime=u.parameters("tracking_alert_timeType"),e.statusAlert=u.parameters("tracking_alert_status"),e.preferencesAlert=u.parameters("tracking_alert_preference"),e.typeList=u.parameters("improvement_plan_type"),e.causeList=[],e.subCauseList=[],e.subCauseListAll=[];var P=function(){e.improvement={id:e.$parent.currentId,customerId:null,entity:null,entityId:null,type:null,endDate:null,description:"",observation:"",responsible:null,isRequiresAnalysis:!1,status:null,trackingList:[],alertList:[]}};P();var O=function(){e.cause={id:0,customerImprovementPlanId:e.$parent.currentId,cause:null,subCauseList:[],rootCauseList:[]}};O(),e.onLoadRecord=function(){if(0!=e.improvement.id){var n={id:e.improvement.id};d({method:"GET",url:"api/customer/improvement-plan",params:n})["catch"](function(e,n){if(403==n){var a=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";c.swal("No Autorizado","No estas autorizado para ver esta información.","error"),m(function(){s.go(a)},3e3)}else 404==n?c.swal("Información no disponible","Centro de trabajo no encontrado","error"):c.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(n){m(function(){null!=n.data.result&&""!=n.data.result&&(e.improvement=n.data.result,D())},400)})["finally"](function(){})}else e.loading=!1},e.onLoadRecord(),e.onLoadCauseRecord=function(n){if(0!=n){var a={id:n};d({method:"GET",url:"api/customer/improvement-plan-cause",params:a})["catch"](function(e,n){if(403==n){var a=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";c.swal("No Autorizado","No estas autorizado para ver esta información.","error"),m(function(){s.go(a)},3e3)}else 404==n?c.swal("Información no disponible","Centro de trabajo no encontrado","error"):c.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(n){m(function(){null!=n.data.result&&""!=n.data.result&&(e.cause=n.data.result)},400)})["finally"](function(){})}else e.loading=!1};var L=function(){var n={customer_id:e.customerId};return d({method:"POST",url:"api/customer/improvement-plan/list-data",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(n){m(function(){e.responsibleList=n.data.data.responsible,e.causeList=n.data.data.causeList,e.subCauseListAll=n.data.data.subCauseList})})["catch"](function(e){c.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};L(),e.master=e.cause,e.form={submit:function(e){var n=null;if(e.$invalid){var a=null,n=null;for(a in e)"$"!=a[0]&&(null!==n||e[a].$valid||(n=e[a].$name),e[a].$pristine&&(e[a].$dirty=!0));return angular.element(".ng-invalid[name="+n+"]").focus(),void c.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}I()},reset:function(n){e.cause=angular.copy(e.master),n.$setPristine(!0)}};var I=function(){var n={},a=JSON.stringify(e.cause);return n.data=Base64.encode(a),d({method:"POST",url:"api/customer/improvement-plan-cause/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(n){m(function(){c.swal("Registro","La información ha sido guardada satisfactoriamente","success"),O(),e.$parent.reload=!0})})["catch"](function(e){c.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){e.reloadData()})},T=function(){var n={},a=JSON.stringify(e.improvement);return n.data=Base64.encode(a),d({method:"POST",url:"api/customer/improvement-plan/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(e){})["catch"](function(e){c.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})},D=function(){null!=e.improvement.endDate&&(e.improvement.endDate=new Date(e.improvement.endDate.date)),angular.forEach(e.improvement.trackingList,function(e,n){null!=e.startDate&&(e.startDate=new Date(e.startDate.date))})};e.onAddTracking=function(){y.btnDisabled&&m(function(){null==e.improvement.trackingList&&(e.improvement.trackingList=[]),e.improvement.trackingList.push({id:0,customerImprovementPlanId:0,responsible:null,startDate:null})})},e.onRemoveTracking=function(n){y.btnDisabled&&c.swal({title:"Está seguro?",text:"Desea confirmar la eliminación de este registro ?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(t){t?m(function(){var t=e.improvement.trackingList[n];if(e.improvement.trackingList.splice(n,1),0!=t.id){var o={};o.id=t.id,d({method:"POST",url:"api/customer/improvement-plan-tracking/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){a.error(e),c.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})},e.onAddAlert=function(){m(function(){y.btnDisabled&&(null==e.improvement.alertList&&(e.improvement.alertList=[]),e.improvement.alertList.push({id:0,customerImprovementPlanId:0,type:null,preference:null,time:0,timeType:null,status:null}))})},e.onRemoveAlert=function(n){y.btnDisabled&&c.swal({title:"Está seguro?",text:"Desea confirmar la eliminación de este registro ?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(t){t?m(function(){var t=e.improvement.alertList[n];if(e.improvement.alertList.splice(n,1),0!=t.id){var o={};o.id=t.id,d({method:"POST",url:"api/customer/improvement-plan-alert/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){a.error(e),c.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})},e.onAddSubCause=function(){m(function(){null==e.cause.subCauseList&&(e.cause.subCauseList=[]),e.cause.subCauseList.push({id:0,customerImprovementPlanCauseId:0,cause:null})})},e.onRemoveSubCause=function(n){c.swal({title:"Está seguro?",text:"Desea confirmar la eliminación de este registro ?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(t){t?m(function(){var t=e.cause.subCauseList[n];if(e.cause.subCauseList.splice(n,1),0!=t.id){var o={};o.id=t.id,d({method:"POST",url:"api/customer/improvement-plan-cause-sub-cause/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){a.error(e),c.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})},e.onAddRootCause=function(){m(function(){null==e.cause.rootCauseList&&(e.cause.rootCauseList=[]),e.cause.rootCauseList.push({id:0,customerImprovementPlanCauseId:0,cause:null,probabilityOccurrence:null,effect:null,detectionLevel:null,factor:0})})},e.onRemoveRootCause=function(n){c.swal({title:"Está seguro?",text:"Desea confirmar la eliminación de este registro ?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(t){t?m(function(){var t=e.cause.rootCauseList[n];if(e.cause.rootCauseList.splice(n,1),0!=t.id){var o={};o.id=t.id,d({method:"POST",url:"api/customer/improvement-plan-cause-root-cause/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){a.error(e),c.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})};var S={improvement_id:e.improvement.id};e.dtInstanceImprovementPlanCause={},e.dtOptionsImprovementPlanCause=t.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:S,url:"api/customer/improvement-plan-cause",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){E()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(n,a,t){i(angular.element(n).contents())(e)}),e.dtColumnsImprovementPlanCause=[o.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(n,a,t,o){var r="",i='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+n.id+'" >   <i class="fa fa-edit"></i></a> ',l='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-root-id="'+n.rootCauseId+'" data-id="'+n.id+'" >   <i class="fa fa-trash-o"></i></a> ',s=' | <a class="btn btn-info btn-xs configRow lnk" href="#" uib-tooltip="Configurar factor de priorización" data-root-id="'+n.rootCauseId+'"  data-id="'+n.id+'" >   <i class="fa fa-cog"></i></a> ',c='<a class="btn btn-dark-orange btn-xs actionPlanRow lnk" href="#" uib-tooltip="Planes de Acción" data-root-id="'+n.rootCauseId+'"  data-id="'+n.id+'" >   <i class="fa fa-plus-square"></i></a> ';return r+=i,e.isView||(r+=l),null!=n.rootCauseId&&(r+=s,r+=c),r}),o.newColumn("causeCreatedAt").withTitle("Fecha").withOption("width",150).withOption("defaultContent",""),o.newColumn("name").withTitle("Usuario").withOption("width",200).withOption("defaultContent",""),o.newColumn("cause").withTitle("Causa").withOption("defaultContent",""),o.newColumn("rootCause").withTitle("Causa Raíz").withOption("defaultContent",""),o.newColumn("factor").withTitle("Factor de Priorización").withOption("width",100).withOption("defaultContent","")];var E=function(){$("#dtImprovementPlanCause a.editRow").on("click",function(){var n=$(this).data("id");e.onLoadCauseRecord(n)}),$("#dtImprovementPlanCause a.configRow").on("click",function(){var e=($(this).data("id"),$(this).data("root-id"));B(e)}),$("#dtImprovementPlanCause a.actionPlanRow").on("click",function(){var e=$(this).data("id"),n=$(this).data("root-id");R(e,n)}),$("#dtImprovementPlanCause a.delRow").on("click",function(){var n=$(this).data("id");c.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(t){if(t){var o={};o.id=n,d({method:"POST",url:"api/customer/improvement-plan-cause/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){a.error(e),c.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){e.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};e.dtInstanceImprovementPlanCauseCallback=function(n){e.dtInstanceImprovementPlanCause=n},e.reloadData=function(){e.dtInstanceImprovementPlanCause.reloadData(),e.fishBoneUrl="fish-bone-improvement/"+e.improvement.id+"/"+Math.random()},e.onCancel=function(){null!=e.$parent&&(console.log(e.$parent),e.$parent.$parent.$parent.$parent.$parent.$parent.navToSection("list","list",0))},e.onClear=function(){O()};var B=function(n){var a={id:n?n:0},t=b.open({templateUrl:u.app.views.urlRoot+"modules/customer/action-plan/tabs/customer_improvement_plan_cause_root_cause_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideImprovementPlanCauseRootCauseConfigCtrl",scope:e,resolve:{root:function(){return a}}});t.result.then(function(){e.reloadData()})},R=function(n,a){var t={id:a?a:0,customerImprovementPlanCauseId:n?n:0},o=b.open({templateUrl:u.app.views.urlRoot+"modules/customer/action-plan/tabs/customer_improvement_plan_action_plan_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideImprovementPlanActionPlanCtrl",scope:e,resolve:{root:function(){return t},improvement:function(){return e.improvement}}});o.result.then(function(){e.reloadData()},function(){})};e.$watch("improvement.isRequiresAnalysis",function(e,n,a){null==n||angular.equals(e,n)||T()}),e.$watch("cause.cause",function(n,a,t){e.subCauseList=[],null==a||angular.equals(n,a)||angular.forEach(e.cause.subCauseList,function(e,n){e.cause=null}),null!=e.cause.cause&&(e.subCauseList=w("filter")(e.subCauseListAll,{improvementPlanCauseCategoryId:e.cause.cause.id}))})}]),app.controller("ModalInstanceSideImprovementPlanCauseRootCauseConfigCtrl",["$rootScope","$stateParams","$scope","$uibModalInstance","root","$log","$timeout","SweetAlert","$http","toaster","$filter","$aside","$document","DTColumnBuilder","DTOptionsBuilder","$compile",function(e,n,a,t,o,r,i,l,s,c,u,d,m,p,f,v){a.maxDate=new Date,a.datePickerConfig={culture:"es-CO",format:"dd/MM/yyyy HH:mm"},a.loading=!0,a.cause={},a.probabilityOccurrenceList=e.parameters("improvement_plan_root_cause_probability_occur"),a.effectList=e.parameters("improvement_plan_root_cause_effect"),a.levelList=e.parameters("improvement_plan_root_detection_level"),a.prioritizationFactorList=e.parameters("improvement_plan_root_prioritization_factor"),a.prioritizationFactorResultText="",a.onCloseModal=function(){t.close(1)},a.onCancel=function(){t.dismiss("cancel")},a.onLoadRecord=function(){if(0!=a.cause.id){var e={id:a.cause.id};s({method:"GET",url:"api/customer/improvement-plan-cause-root-cause",params:e})["catch"](function(e,n){if(403==n){var a=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";l.swal("No Autorizado","No estas autorizado para ver esta información.","error"),i(function(){$state.go(a)},3e3)}else 404==n?l.swal("Información no disponible","Centro de trabajo no encontrado","error"):l.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(e){i(function(){a.cause=e.data.result},400)})["finally"](function(){i(function(){a.loading=!1},400)})}else a.loading=!1};var w=function(){a.cause={id:o.id,customerImprovementPlanCauseId:null,cause:null,probabilityOccurrence:null,effect:null,detectionLevel:null,factor:0}};w(),a.onLoadRecord(),a.$watch("cause.probabilityOccurrence",function(e,n,a){h()}),a.$watch("cause.effect",function(e,n,a){h()}),a.$watch("cause.detectionLevel",function(e,n,a){h()});var h=function(){var e=a.cause.probabilityOccurrence?parseInt(a.cause.probabilityOccurrence.value):0,n=a.cause.effect?parseInt(a.cause.effect.value):0,t=a.cause.detectionLevel?parseInt(a.cause.detectionLevel.value):0;a.cause.factor=e*n*t;var o=u("filter")(a.prioritizationFactorList,{value:a.cause.factor.toString()},!0);o.length>0&&(a.prioritizationFactorResultText=o[0].item)};a.master=a.cause,a.form={submit:function(e){var n=null;if(e.$invalid){var a=null,n=null;for(a in e)"$"!=a[0]&&(null!==n||e[a].$valid||(n=e[a].$name),e[a].$pristine&&(e[a].$dirty=!0));return angular.element(".ng-invalid[name="+n+"]").focus(),void l.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}C()},reset:function(e){a.clear()}};var C=function(){var e=JSON.stringify(a.cause),n={data:Base64.encode(e)};return s({method:"POST",url:"api/customer/improvement-plan-cause-root-cause/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(e){i(function(){l.swal("Registro","La información ha sido guardada satisfactoriamente","success"),a.onCloseModal()})})["catch"](function(e){l.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})}}]),app.controller("ModalInstanceSideImprovementPlanActionPlanCtrl",["$rootScope","$stateParams","$scope","$uibModalInstance","root","improvement","$log","$timeout","SweetAlert","$http","toaster","$filter","$aside","$document","DTColumnBuilder","DTOptionsBuilder","$compile",function(e,n,a,t,o,r,i,l,s,c,u,d,m,p,f,v,w){a.maxDate=new Date,a.datePickerConfig={culture:"es-CO",format:"dd/MM/yyyy HH:mm"},a.loading=!0,a.cause={id:o.id},a.responsibleList=[],a.entryList=[],a.onCloseModal=function(){t.close(1)},a.onCancel=function(){t.dismiss("cancel")};var h=function(){var e={customer_id:n.customerId,cause_id:o.customerImprovementPlanCauseId};return c({method:"POST",url:"api/customer/improvement-plan-action-plan/list-data",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){l(function(){a.responsibleList=e.data.data.responsible,a.causeList=e.data.data.causeList,a.rootCauseList=e.data.data.rootCauseList,a.entryList=e.data.data.entry})})["catch"](function(e){s.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};h(),a.onLoadRecord=function(e){if(0!=e){var n={id:e};c({method:"GET",url:"api/customer/improvement-plan-action-plan",params:n})["catch"](function(e,n){if(403==n){var a=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";s.swal("No Autorizado","No estas autorizado para ver esta información.","error"),l(function(){$state.go(a)},3e3)}else 404==n?s.swal("Información no disponible","Centro de trabajo no encontrado","error"):s.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(e){l(function(){a.plan=e.data.result,null!=a.plan.endDate&&(a.plan.endDate=new Date(a.plan.endDate.date))},400)})["finally"](function(){})}},a.onLoadCauseRecord=function(){if(0!=a.cause.id){var e={id:a.cause.id};c({method:"GET",url:"api/customer/improvement-plan-cause-root-cause",params:e})["catch"](function(e,n){if(403==n){var a=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";s.swal("No Autorizado","No estas autorizado para ver esta información.","error"),l(function(){$state.go(a)},3e3)}else 404==n?s.swal("Información no disponible","Centro de trabajo no encontrado","error"):s.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(e){l(function(){a.cause=e.data.result,a.plan.cause=a.cause.parent?a.cause.parent:null,a.plan.rootCause=a.cause?a.cause:null},400)})["finally"](function(){})}},a.onLoadCauseRecord();var C=function(){a.plan={id:o.id,customerImprovementPlanId:r.id,cause:a.cause.parent?a.cause.parent:null,rootCause:a.cause?a.cause:null,activity:"",entry:null,amount:0,endDate:null,responsible:null,status:null,notifiedList:[]}};C(),a.master=a.plan,a.form={submit:function(e){var n=null;if(e.$invalid){var a=null,n=null;for(a in e)"$"!=a[0]&&(null!==n||e[a].$valid||(n=e[a].$name),e[a].$pristine&&(e[a].$dirty=!0));return angular.element(".ng-invalid[name="+n+"]").focus(),void s.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}g()},reset:function(e){a.clear()}};var g=function(){var e=JSON.stringify(a.plan),n={data:Base64.encode(e)};return c({method:"POST",url:"api/customer/improvement-plan-action-plan/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(e){l(function(){s.swal("Registro","La información ha sido guardada satisfactoriamente","success"),C()})})["catch"](function(e){s.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){a.reloadData()})};a.dtOptionsImprovementPlanActionPlan=v.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerId=n.customerId,e.customerImprovementPlanCauseRootCauseId=o.id,JSON.stringify(e)},url:"api/customer-improvement-plan-action-plan",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){b()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,n,t){w(angular.element(e).contents())(a)}),a.dtColumnsImprovementPlanActionPlan=[f.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,n,t,o){var r="",i='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+e.id+'" >   <i class="fa fa-edit"></i></a> ',l='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+e.id+'" >   <i class="fa fa-trash-o"></i></a> ';return r+=i,a.isView||(r+=l),r}),f.newColumn(null).withTitle("Fecha Cierre").withOption("width",150).withOption("defaultContent","").renderWith(function(e,n,a,t){return e.endDate?moment(e.endDate).format("DD/MM/YYYY"):null}),f.newColumn("activity").withTitle("Actividad").withOption("width",200).withOption("defaultContent",""),f.newColumn("responsible").withTitle("Responsable").withOption("defaultContent",""),f.newColumn("entry").withTitle("Rubro").withOption("defaultContent",""),f.newColumn("amount").withTitle("Valor").withOption("width",100).withOption("defaultContent",""),f.newColumn(null).withTitle("Estado").withOption("width",200).withOption("defaultContent","").renderWith(function(e,n,a,t){var o="label label-success",r=e.status;switch(e.statusCode){case"AB":o="label label-info";break;case"CO":o="label label-success";break;case"CA":o="label label-danger"}return'<span class="'+o+'">'+r+"</span>"})];var b=function(){$("#dtImprovementPlanActionPlan a.editRow").on("click",function(){var e=$(this).data("id");a.onLoadRecord(e)}),$("#dtImprovementPlanActionPlan a.delRow").on("click",function(){var e=$(this).data("id");s.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(n){if(n){var t={};t.id=e,c({method:"POST",url:"api/customer/improvement-plan-action-plan/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){i.error(e),s.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){a.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};a.dtInstanceImprovementPlanActionPlanCallback=function(e){a.dtInstanceImprovementPlanActionPlan=e},a.reloadData=function(){a.dtInstanceImprovementPlanActionPlan.reloadData()},a.onAddNotified=function(){l(function(){null==a.plan.notifiedList&&(a.plan.notifiedList=[]),a.plan.notifiedList.push({id:0,customerImprovementPlanActionPlanId:0,responsible:null})})},a.onRemoveNotified=function(e){s.swal({title:"Está seguro?",text:"Desea confirmar la eliminación de este registro ?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(n){n?l(function(){var n=a.plan.notifiedList[e];if(a.plan.notifiedList.splice(e,1),0!=n.id){var t={};t.id=n.id,c({method:"POST",url:"api/customer/improvement-plan-action-plan-notified/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){i.error(e),s.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})}}]);
"use strict";app.controller("customerImprovementPlanActionPlanCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","SweetAlert","$rootScope","$http","$timeout","$uibModal","flowFactory","cfpLoadingBar","$filter","$document","FileUploader","$localStorage","$aside",function(n,a,t,e,o,r,i,l,s,c,u,d,m,p,f,v,w,h,g,C,b){n.loading=!0,n.isCreate=0==n.$parent.currentId,n.isView="view"==n.$parent.editMode,n.canShowPanel=!1,console.log(n.$parent.editMode),n.maxDate=new Date,n.datePickerConfig={culture:"es-CO",format:"dd/MM/yyyy HH:mm"},n.responsibleList=[],n.typesAlert=w("orderBy")(u.parameters("tracking_alert_type"),"id",!1),n.typesTime=u.parameters("tracking_alert_timeType"),n.statusAlert=u.parameters("tracking_alert_status"),n.preferencesAlert=u.parameters("tracking_alert_preference"),n.typeList=u.parameters("improvement_plan_type");var P=function(){var t={customer_id:a.customerId,improvement_id:n.$parent.currentId};return d({method:"POST",url:"api/customer/improvement-plan-action-plan/list-data",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(a){m(function(){n.responsibleList=a.data.data.responsible,n.causeList=a.data.data.improvementCauseList,n.entryList=a.data.data.entry})})["catch"](function(n){c.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};P(),n.onLoadRecord=function(a){if(0!=a){var t={id:a};d({method:"GET",url:"api/customer/improvement-plan-action-plan",params:t})["catch"](function(n,a){if(403==a){var t=null!==n.message&&void 0!==n.message?n.message:"app.clientes.list";c.swal("No Autorizado","No estas autorizado para ver esta información.","error"),m(function(){s.go(t)},3e3)}else 404==a?c.swal("Información no disponible","Centro de trabajo no encontrado","error"):c.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(a){console.log(a),m(function(){n.plan=a.data.result,null!=n.plan.endDate&&(n.plan.endDate=new Date(n.plan.endDate.date))},400)})["finally"](function(){h.scrollTop(40,2e3)})}},n.onLoadImprovementPlanRecord=function(a){if(0!=a){var t={id:a};d({method:"GET",url:"api/customer/improvement-plan",params:t})["catch"](function(n,a){if(403==a){var t=null!==n.message&&void 0!==n.message?n.message:"app.clientes.list";c.swal("No Autorizado","No estas autorizado para ver esta información.","error"),m(function(){s.go(t)},3e3)}else 404==a?c.swal("Información no disponible","Centro de trabajo no encontrado","error"):c.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(a){m(function(){n.improvement=a.data.result,n.canShowPanel=!0},400)})["finally"](function(){})}};var k=function(){n.plan={id:0,customerImprovementPlanId:n.$parent.currentId,cause:null,rootCause:null,activity:"",entry:null,amount:0,endDate:null,responsible:null,status:null,notifiedList:[]},n.isView="view"==n.$parent.editMode};k(),n.improvement={id:n.$parent.currentId},n.onLoadImprovementPlanRecord(n.improvement.id),n.master=n.plan,n.form={submit:function(n){var a=null;if(n.$invalid){var t=null,a=null;for(t in n)"$"!=t[0]&&(null!==a||n[t].$valid||(a=n[t].$name),n[t].$pristine&&(n[t].$dirty=!0));return angular.element(".ng-invalid[name="+a+"]").focus(),void c.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}T()},reset:function(a){n.clear()}};var T=function(){var a=JSON.stringify(n.plan),t={data:Base64.encode(a)};return d({method:"POST",url:"api/customer/improvement-plan-action-plan/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(n){m(function(){c.swal("Registro","La información ha sido guardada satisfactoriamente","success"),k()})})["catch"](function(n){c.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){n.reloadData()})},I=function(a){var t=JSON.stringify({id:a,reason:null,status:{value:"CO"}}),e={data:Base64.encode(t)};return d({method:"POST",url:"api/customer-improvement-plan-action-plan/update",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(a){m(function(){l.pop("success","Operación Exitosa","Actualización exitosa."),n.reloadData()})})["catch"](function(n){c.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){n.reloadData()})};n.dtOptionsCustomerImprovementPlanActionPlan=e.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.customerId=a.customerId,t.customerImprovementPlanId=n.$parent.currentId,JSON.stringify(t)},url:"api/customer-improvement-plan-action-plan",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){O()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(a,t,e){i(angular.element(a).contents())(n)}),n.dtColumnsCustomerImprovementPlanActionPlan=[o.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(a,t,e,o){var r="",i="AB"==a.statusCode?0:1,l='<a class="btn btn-info btn-xs viewRow lnk" href="#" uib-tooltip="Ver" data-id="'+a.id+'" >   <i class="fa fa-eye"></i></a> ',s='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+a.id+'" >   <i class="fa fa-edit"></i></a> ',c='<a class="btn btn-danger btn-xs cancelRow lnk" href="#" uib-tooltip="Cancelar" data-id="'+a.id+'" >   <i class="fa fa-ban"></i></a> ',d=' | <a class="btn btn-success btn-xs completeRow lnk" href="#" uib-tooltip="Completar" data-id="'+a.id+'" >   <i class="fa fa-check-circle-o"></i></a> ',m=' | <a class="btn btn-dark-azure btn-xs openRow lnk" href="#" uib-tooltip="Reabrir" data-id="'+a.id+'" >   <i class="fa fa-refresh"></i></a> ',p=' | <a class="btn btn-green btn-xs taskRow lnk" href="#" uib-tooltip="Tareas" data-id="'+a.id+'" data-view="'+i+'">   <i class="fa fa-list"></i></a> ';return r+="CO"==a.statusCode||"CA"==a.statusCode?l:s,r+=p,"AB"==a.statusCode&&(u.can("plan_accion_complete")&&(r+=d),u.can("plan_accion_cancel")&&(r+=c)),"CO"!=a.statusCode||null!=n.improvement.status&&"AB"!=n.improvement.status.value||u.can("plan_accion_reopen")&&(r+=m),r}),o.newColumn(null).withTitle("Fecha Cierre").withOption("width",150).withOption("defaultContent","").renderWith(function(n,a,t,e){return n.endDate?moment(n.endDate).format("DD/MM/YYYY"):null}),o.newColumn("activity").withTitle("Actividad").withOption("width",200).withOption("defaultContent",""),o.newColumn("responsible").withTitle("Responsable").withOption("defaultContent",""),o.newColumn("entry").withTitle("Rubro").withOption("defaultContent",""),o.newColumn("amount").withTitle("Valor").withOption("width",100).withOption("defaultContent",""),o.newColumn(null).withTitle("Estado").withOption("width",200).withOption("defaultContent","").renderWith(function(n,a,t,e){var o="label label-success",r=n.status;switch(n.statusCode){case"AB":o="label label-dark-azure";break;case"CO":o="label label-success";break;case"CA":o="label label-danger"}return'<span class="'+o+'">'+r+"</span>"})];var O=function(){angular.element("#dtCustomerImprovementPlanActionPlan a.viewRow").on("click",function(){var a=angular.element(this).data("id");n.isView=!0,n.onLoadRecord(a)}),angular.element("#dtCustomerImprovementPlanActionPlan a.editRow").on("click",function(){var a=angular.element(this).data("id");n.isView=!1,n.onLoadRecord(a)}),angular.element("#dtCustomerImprovementPlanActionPlan a.taskRow").on("click",function(){var n=angular.element(this).data("id"),a=1==angular.element(this).data("view");y({id:n},a)}),angular.element("#dtCustomerImprovementPlanActionPlan a.cancelRow").on("click",function(){var n=angular.element(this).data("id");_({id:n,status:"CA"})}),angular.element("#dtCustomerImprovementPlanActionPlan a.openRow").on("click",function(){var n=angular.element(this).data("id");_({id:n,status:"AB"})}),angular.element("#dtCustomerImprovementPlanActionPlan a.completeRow").on("click",function(){var n=angular.element(this).data("id");I(n)}),angular.element("#dtCustomerImprovementPlanActionPlan a.delRow").on("click",function(){var a=angular.element(this).data("id");c.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(e){if(e){var o={};o.id=a,d({method:"POST",url:"api/customer/improvement-plan-action-plan/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(n){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(n){t.error(n),c.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){n.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};n.dtInstanceCustomerImprovementPlanActionPlanCallback=function(a){n.dtInstanceCustomerImprovementPlanActionPlan=a},n.reloadData=function(){n.dtInstanceCustomerImprovementPlanActionPlan.reloadData()},n.onAddNotified=function(){m(function(){null==n.plan.notifiedList?n.plan.notifiedList=[]:(console.log(n.plan.notifiedList),n.plan.notifiedList.push({id:0,customerImprovementPlanActionPlanId:0,responsible:null}))})},n.onRemoveNotified=function(a){c.swal({title:"Está seguro?",text:"Desea confirmar la eliminación de este registro ?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(e){e?m(function(){var e=n.plan.notifiedList[a];if(n.plan.notifiedList.splice(a,1),0!=e.id){var o={};o.id=e.id,d({method:"POST",url:"api/customer/improvement-plan-action-plan-notified/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(n){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(n){t.error(n),c.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})};var y=function(a,t){var e=b.open({templateUrl:u.app.views.urlRoot+"modules/customer/action-plan/tabs/customer_improvement_plan_action_plan_task_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideImprovementPlanActionPlanTaskCtrl",scope:n,resolve:{plan:function(){return a},isView:function(){return t},improvement:function(){return{id:n.$parent.currentId}}}});e.result.then(function(){n.reloadData()},function(){n.reloadData()})},_=function(a){var t=b.open({templateUrl:u.app.views.urlRoot+"modules/customer/action-plan/tabs/customer_improvement_plan_action_plan_comment_edit_modal.htm",placement:"right",size:"sm",backdrop:!0,controller:"ModalInstanceSideImprovementPlanActionPlanUpdateCtrl",scope:n,resolve:{plan:function(){return a},improvement:function(){return{id:n.$parent.currentId}}}});t.result.then(function(){n.reloadData()},function(){n.reloadData()})};n.$watch("$parent.reload",function(){n.$parent.reload&&(n.onLoadImprovementPlanRecord(n.$parent.currentId),n.$parent.reload=!1)}),n.cancelEdition=function(){k()},n.onCancel=function(){null!=n.$parent&&n.$parent.$parent.$parent.$parent.$parent.navToSection("list","list",0)},n.refreshCause=function(){P()}}]),app.controller("ModalInstanceSideImprovementPlanActionPlanTaskCtrl",["$rootScope","$stateParams","$scope","$uibModal","$uibModalInstance","plan","isView","improvement","$log","$timeout","SweetAlert","$http","toaster","$filter","$aside","$document","DTColumnBuilder","DTOptionsBuilder","$compile",function(n,a,t,e,o,r,i,l,s,c,u,d,m,p,f,v,w,h,g){t.datePickerConfig={culture:"es-CO",format:"dd/MM/yyyy HH:mm"},t.loading=!0,t.isView=i,t.responsibleList=[],t.taskTypeList=n.parameters("improvement_plan_action_plan_task_type"),t.statusList=n.parameters("improvement_plan_action_plan_task_status"),t.onCloseModal=function(){o.close(1)},t.onCancel=function(){o.dismiss("cancel")};var C=function(){var n={customer_id:a.customerId,improvement_id:l.id};return d({method:"POST",url:"api/customer/improvement-plan-action-plan/list-data",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(n){c(function(){t.responsibleList=n.data.data.responsible})})["catch"](function(n){u.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};C(),t.onLoadRecord=function(n){if(0!=n){var a={id:n};d({method:"GET",url:"api/customer/improvement-plan-action-plan-task",params:a})["catch"](function(n,a){if(403==a){var t=null!==n.message&&void 0!==n.message?n.message:"app.clientes.list";u.swal("No Autorizado","No estas autorizado para ver esta información.","error"),c(function(){$state.go(t)},3e3)}else 404==a?u.swal("Información no disponible","Centro de trabajo no encontrado","error"):u.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(n){c(function(){t.task=n.data.result,k()},400)})["finally"](function(){})}},t.onLoadActionPlanRecord=function(n){if(0!=n){var a={id:n};d({method:"GET",url:"api/customer/improvement-plan-action-plan",params:a})["catch"](function(n,a){if(403==a){var t=null!==n.message&&void 0!==n.message?n.message:"app.clientes.list";u.swal("No Autorizado","No estas autorizado para ver esta información.","error"),c(function(){$state.go(t)},3e3)}else 404==a?u.swal("Información no disponible","Centro de trabajo no encontrado","error"):u.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(n){c(function(){t.plan=n.data.result},400)})["finally"](function(){})}};var b=function(){t.task={id:0,customerImprovementPlanActionPlanId:r.id,description:"",type:null,responsible:null,startDate:null,endDate:null,duration:null,status:null}};b();var P=function(){t.plan={id:r.id,cause:null,rootCause:null,activity:""}};P();var k=function(){null!=t.task.startDate&&(t.task.startDate=new Date(t.task.startDate.date)),null!=t.task.endDate&&(t.task.endDate=new Date(t.task.endDate.date))};t.onLoadActionPlanRecord(t.plan.id),t.master=t.task,t.form={submit:function(n){var a=null;if(n.$invalid){var t=null,a=null;for(t in n)"$"!=t[0]&&(null!==a||n[t].$valid||(a=n[t].$name),n[t].$pristine&&(n[t].$dirty=!0));return angular.element(".ng-invalid[name="+a+"]").focus(),void u.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}T()},reset:function(n){t.clear()}};var T=function(){var n=JSON.stringify(t.task),a={data:Base64.encode(n)};return d({method:"POST",url:"api/customer/improvement-plan-action-plan-task/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(n){c(function(){u.swal("Registro","La información ha sido guardada satisfactoriamente","success"),b()})})["catch"](function(n){u.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){t.reloadData()})},I=function(n){var a=JSON.stringify(n),e={data:Base64.encode(a)};return d({method:"POST",url:"api/customer/improvement-plan-action-plan-task/update",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(n){c(function(){b()})})["catch"](function(n){u.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){t.reloadData()})},O={improvement_action_plan_id:r.id};t.dtInstanceCustomerImprovementPlanActionPlanTask={},t.dtOptionsCustomerImprovementPlanActionPlanTask=h.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:O,url:"api/customer/improvement-plan-action-plan-task",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){y()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(n,a,e){g(angular.element(n).contents())(t)}),t.dtColumnsCustomerImprovementPlanActionPlanTask=[w.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(n,a,e,o){var r="",i='<a class="btn btn-info btn-xs viewRow lnk" href="#" uib-tooltip="Editar" data-id="'+n.id+'" >   <i class="fa fa-eye"></i></a> ',l='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+n.id+'" >   <i class="fa fa-edit"></i></a> ',s='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Cancelar" data-id="'+n.id+'" >   <i class="fa fa-ban"></i></a> ',c=' | <a class="btn btn-info btn-xs reScheduleRow lnk" href="#" uib-tooltip="Reprogramar" data-id="'+n.id+'" >   <i class="fa fa-bell-o"></i></a> ',u=' | <a class="btn btn-success btn-xs approvedRow lnk" href="#" uib-tooltip="Aprobar" data-id="'+n.id+'" >   <i class="fa fa-check-circle"></i></a> ',d='<a class="btn btn-warning btn-xs reOpenRow lnk" href="#" uib-tooltip="Reabrir" data-id="'+n.id+'" >   <i class="fa fa-recycle"></i></a> ';return t.isView?r+=i:"A"==n.status.value||"R"==n.status.value?(r+=l,r+=s,r+=c,r+=u):r+=d,r}),w.newColumn("type.item").withTitle("Tipo").withOption("width",200).withOption("defaultContent",""),w.newColumn("description").withTitle("Tarea").withOption("width",200).withOption("defaultContent",""),w.newColumn("startDateFormat").withTitle("Inicio").withOption("defaultContent",""),w.newColumn("endDateFormat").withTitle("Fin").withOption("defaultContent",""),w.newColumn(null).withTitle("Estado").withOption("width",150).renderWith(function(n,a,t,e){var o="";if(n.status)switch(n.status.value){case"A":o="label label-success";break;case"R":o="label label-warning";break;case"F":o="label label-info";break;case"C":o="label label-danger"}var r='<span class="'+o+'">'+n.status.item+"</span>";return r})];var y=function(){angular.element("#dtCustomerImprovementPlanActionPlanTask a.viewRow").on("click",function(){var n=angular.element(this).data("id");t.onLoadRecord(n)}),angular.element("#dtCustomerImprovementPlanActionPlanTask a.editRow").on("click",function(){var n=angular.element(this).data("id");t.onLoadRecord(n)}),angular.element("#dtCustomerImprovementPlanActionPlanTask a.reScheduleRow").on("click",function(){var n=angular.element(this).data("id");D(n)}),angular.element("#dtCustomerImprovementPlanActionPlanTask a.approvedRow").on("click",function(){var n=angular.element(this).data("id");A(n)}),angular.element("#dtCustomerImprovementPlanActionPlanTask a.reOpenRow").on("click",function(){var n=angular.element(this).data("id");R(n)}),angular.element("#dtCustomerImprovementPlanActionPlanTask a.delRow").on("click",function(){var n=angular.element(this).data("id");u.swal({title:"Está seguro?",text:"Cancelará la tarea seleccionada.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(a){a?_(n):swal("Cancelación","La operación ha sido cancelada","error")})})};t.dtInstanceCustomerImprovementPlanActionPlanTaskCallback=function(n){t.dtInstanceCustomerImprovementPlanActionPlanTask=n},t.reloadData=function(){t.dtInstanceCustomerImprovementPlanActionPlanTask.reloadData()};var _=function(a){var o={id:a,status:"C"},r=e.open({templateUrl:n.app.views.urlRoot+"modules/customer/action-plan/tabs/customer_improvement_plan_action_plan_task_tracking_modal.htm",controller:"ModalInstanceSideImprovementPlanActionPlanTaskTrackingCtrl",windowTopClass:"top-modal",resolve:{task:function(){return o},action:function(){return"Cancelar"}}});r.result.then(function(){t.reloadData()},function(){})},A=function(n){var a={id:n,status:"F"};I(a)},D=function(a){var o={id:a,status:"R"},r=e.open({templateUrl:n.app.views.urlRoot+"modules/customer/action-plan/tabs/customer_improvement_plan_action_plan_task_tracking_modal.htm",placement:"right",windowTopClass:"top-modal",size:"lg",backdrop:!0,controller:"ModalInstanceSideImprovementPlanActionPlanTaskTrackingCtrl",scope:t,resolve:{task:function(){return o},action:function(){return"Reprogramar"}}});r.result.then(function(){t.reloadData()},function(){})},R=function(a){var o={id:a,status:"A"},r=e.open({templateUrl:n.app.views.urlRoot+"modules/customer/action-plan/tabs/customer_improvement_plan_action_plan_task_tracking_modal.htm",placement:"right",size:"lg",backdrop:!0,windowTopClass:"top-modal",controller:"ModalInstanceSideImprovementPlanActionPlanTaskTrackingCtrl",scope:t,resolve:{task:function(){return o},action:function(){return"Reabrir"}}});r.result.then(function(){t.reloadData()},function(){})};t.$watch("task.endDate - task.startDate",function(){var n=Math.abs(t.task.endDate-t.task.startDate),a=Math.ceil(n/864e5);console.log(a),a>0&&a<2e3&&(t.task.duration=a)})}]),app.controller("ModalInstanceSideImprovementPlanActionPlanTaskTrackingCtrl",["$scope","$uibModalInstance","task","action","$log","$timeout","SweetAlert","$http",function(n,a,t,e,o,r,i,l){n.task={id:t.id,status:t.status,tracking:{action:e,description:""}},n.onCloseModal=function(){a.close(1)},n.onCancel=function(){a.dismiss("cancel")},n.master=n.task,n.form={submit:function(n){var a=null;if(n.$invalid){var t=null,a=null;for(t in n)"$"!=t[0]&&(null!==a||n[t].$valid||(a=n[t].$name),n[t].$pristine&&(n[t].$dirty=!0));return angular.element(".ng-invalid[name="+a+"]").focus(),void i.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}s()},reset:function(a){n.clear()}};var s=function(){var a={},t=JSON.stringify(n.task);return a.data=Base64.encode(t),l({method:"POST",url:"api/customer/improvement-plan-action-plan-task/update",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(a){r(function(){i.swal("Registro","La información ha sido guardada satisfactoriamente","success"),n.onCloseModal()})})["catch"](function(n){o.error(n),i.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})}}]),app.controller("ModalInstanceSideImprovementPlanActionPlanUpdateCtrl",["$rootScope","$stateParams","$scope","$uibModal","$uibModalInstance","plan","improvement","$log","$timeout","SweetAlert","$http","toaster","$filter","$aside","$document","DTColumnBuilder","DTOptionsBuilder","$compile",function(n,a,t,e,o,r,i,l,s,c,u,d,m,p,f,v,w,h){t.loading=!0,t.isView=!1,t.onCloseModal=function(){o.close(1)},t.onCancel=function(){o.dismiss("cancel")};var g=function(){t.entity={id:r.id,reason:"",status:{value:r.status}}};g(),t.form={submit:function(n){var a=null;if(n.$invalid){var t=null,a=null;for(t in n)"$"!=t[0]&&(null!==a||n[t].$valid||(a=n[t].$name),n[t].$pristine&&(n[t].$dirty=!0));return angular.element(".ng-invalid[name="+a+"]").focus(),void c.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}C()},reset:function(n){}};var C=function(){var n=JSON.stringify(t.entity),a={data:Base64.encode(n)};return u({method:"POST",url:"api/customer-improvement-plan-action-plan/update",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(n){s(function(){d.pop("success","Operación Exitosa","Actualización exitosa."),t.onCloseModal()})})["catch"](function(n){c.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})}}]);
"use strict";app.controller("customerImprovementPlanTrackingCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","SweetAlert","$rootScope","$http","$timeout","$uibModal","flowFactory","cfpLoadingBar","$filter","$document","FileUploader","$localStorage","$aside",function(e,t,n,r,a,o,i,l,s,c,u,d,m,p,f,g,v,w,h,k,C){e.loading=!0,e.isCreate=0==e.$parent.currentId,e.isView="view"==e.$parent.editMode,e.responsibleList=[],e.typesAlert=v("orderBy")(u.parameters("tracking_alert_type"),"id",!1),e.typesTime=u.parameters("tracking_alert_timeType"),e.statusAlert=u.parameters("tracking_alert_status"),e.preferencesAlert=u.parameters("tracking_alert_preference"),e.typeList=u.parameters("improvement_plan_type");var T=function(){var n={customer_id:t.customerId};return d({method:"POST",url:"api/customer/improvement-plan/list-data",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(t){m(function(){e.responsibleList=t.data.data.responsible})})["catch"](function(e){c.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};T(),e.master=e.tracking,e.form={submit:function(e){var t=null;if(e.$invalid){var n=null,t=null;for(n in e)"$"!=n[0]&&(null!==t||e[n].$valid||(t=e[n].$name),e[n].$pristine&&(e[n].$dirty=!0));return angular.element(".ng-invalid[name="+t+"]").focus(),void c.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}b()},reset:function(t){e.tracking=angular.copy(e.master),t.$setPristine(!0)}};var b=function(){var t={},n=JSON.stringify(e.tracking);return t.data=Base64.encode(n),d({method:"POST",url:"api/customer/improvement-plan-tracking/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(e){m(function(){c.swal("Registro","La información ha sido guardada satisfactoriamente","success"),init()})})["catch"](function(e){c.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){e.reloadData()})},I={improvement_id:e.$parent.currentId};e.dtInstanceCustomerImprovementPlanTracking={},e.dtOptionsCustomerImprovementPlanTracking=r.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:I,url:"api/customer/improvement-plan-tracking",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){P()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,n,r){i(angular.element(t).contents())(e)}),e.dtColumnsCustomerImprovementPlanTracking=[a.newColumn(null).withTitle("Acciones").withOption("width",80).notSortable().renderWith(function(t,n,r,a){var o="",i='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+t.id+'" >   <i class="fa fa-edit"></i></a> ';return o+=i,e.isView?null:o}),a.newColumn("startDateFormat").withTitle("Fecha").withOption("width",150).withOption("defaultContent",""),a.newColumn(null).withTitle("Estado").withOption("width",200).renderWith(function(e,t,n,r){if(null==e.status)return"";var a="";switch(e.status.value){case"A":a="label label-success";break;case"F":a="label label-danger"}var o='<span class="'+a+'">'+e.status.item+"</span>";return o}),a.newColumn("responsible.name").withTitle("Responsable").withOption("defaultContent",""),a.newColumn("updated_at").withTitle("Fecha modificación").withOption("defaultContent",""),a.newColumn("observation").withTitle("Observación").withOption("width",100).withOption("defaultContent","")];var P=function(){$("#dtCustomerImprovementPlanTracking a.editRow").on("click",function(){var e=$(this).data("id");O(e)}),$("#dtCustomerImprovementPlanTracking a.delRow").on("click",function(){var t=$(this).data("id");c.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(r){if(r){var a={};a.id=t,d({method:"POST",url:"api/customer/improvement-plan-tracking/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){n.error(e),c.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){e.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};e.dtInstanceCustomerImprovementPlanTrackingCallback=function(t){e.dtInstanceCustomerImprovementPlanTracking=t},e.reloadData=function(){e.dtInstanceCustomerImprovementPlanTracking.reloadData()},e.onAddTracking=function(){O()};var O=function(t){var n={id:t?t:0,customerImprovementPlanId:e.$parent.currentId},r=C.open({templateUrl:u.app.views.urlRoot+"modules/customer/action-plan/tabs/customer_improvement_plan_tracking_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideImprovementPlanTrackingCtrl",scope:e,resolve:{tracking:function(){return n},improvement:function(){return{id:e.$parent.currentId}}}});r.result.then(function(){e.reloadData()})}}]),app.controller("ModalInstanceSideImprovementPlanTrackingCtrl",["$rootScope","$stateParams","$scope","$uibModalInstance","tracking","improvement","$log","$timeout","SweetAlert","$http","toaster","$filter","$aside","$document","DTColumnBuilder","DTOptionsBuilder","$compile",function(e,t,n,r,a,o,i,l,s,c,u,d,m,p,f,g,v){0==a.id&&(n.maxDate=new Date),n.datePickerConfig={culture:"es-CO",format:"dd/MM/yyyy HH:mm"},n.loading=!0,n.responsibleList=[],n.statusList=e.parameters("improvement_plan_tracking_status"),n.onCloseModal=function(){r.close(1)},n.onCancel=function(){r.dismiss("cancel")};var w=function(){n.tracking={id:a.id,customerImprovementPlanId:a.customerImprovementPlanId,startDate:null,responsible:null,observation:"",status:null}};w();var h=function(){var e={customer_id:t.customerId};return c({method:"POST",url:"api/customer/improvement-plan/list-data",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){l(function(){n.responsibleList=e.data.data.responsible})})["catch"](function(e){s.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};h(),n.onLoadRecord=function(e){if(0!=e){var t={id:e};c({method:"GET",url:"api/customer/improvement-plan-tracking",params:t})["catch"](function(e,t){if(403==t){var n=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";s.swal("No Autorizado","No estas autorizado para ver esta información.","error"),l(function(){$state.go(n)},3e3)}else 404==t?s.swal("Información no disponible","Centro de trabajo no encontrado","error"):s.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(e){l(function(){n.tracking=e.data.result,k()},400)})["finally"](function(){})}};var w=function(){n.tracking={id:a.id,customerImprovementPlanId:o.id,startDate:null,responsible:null,observation:"",status:null}};w();var k=function(){null!=n.tracking.startDate&&(n.tracking.startDate=new Date(n.tracking.startDate.date),n.maxDate=n.tracking.startDate)};n.onLoadRecord(n.tracking.id),n.master=n.tracking,n.form={submit:function(e){var t=null;if(e.$invalid){var n=null,t=null;for(n in e)"$"!=n[0]&&(null!==t||e[n].$valid||(t=e[n].$name),e[n].$pristine&&(e[n].$dirty=!0));return angular.element(".ng-invalid[name="+t+"]").focus(),void s.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}C()},reset:function(e){n.clear()}};var C=function(){var e=JSON.stringify(n.tracking),t={data:Base64.encode(e)};return c({method:"POST",url:"api/customer/improvement-plan-tracking/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(e){l(function(){s.swal("Registro","La información ha sido guardada satisfactoriamente","success"),n.onCloseModal()})})["catch"](function(e){s.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})}}]);
"use strict";app.controller("customerImprovementPlanDocumentCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","SweetAlert","$rootScope","$http","$timeout","$uibModal","flowFactory","cfpLoadingBar","$filter","$document","FileUploader","$localStorage","$aside","ListService",function(t,e,n,o,a,i,r,l,c,u,s,d,m,p,f,w,h,v,C,g,b,D){function O(){var n=[{name:"customer_document_type",value:e.customerId}];D.getDataList(n).then(function(e){t.documentType=e.data.data.customerDocumentType},function(e){t.status="Unable to load customer data: "+e.message})}t.loading=!0,t.isCreate=0==t.$parent.currentId,t.isView="view"==t.$parent.editMode;var T=0,I="M";t.documentClassification=s.parameters("customer_document_classification"),t.documentStatus=s.parameters("customer_document_status"),O();var P=function(){t.attachment={id:0,customerImprovementPlanId:t.$parent.currentId,type:null,classification:null,description:"",status:t.documentStatus?t.documentStatus[0]:null,version:1,label:I}};P(),t.onCloseModal=function(){$uibModalInstance.close(1)},t.onCancel=function(){$uibModalInstance.dismiss("cancel")},t.onClear=function(){P()};var y=t.uploader=new C({url:"api/customer-improvement-plan-document/upload",formData:[],removeAfterUpload:!0});y.filters.push({name:"customFilter",fn:function(t,e){return this.queue.length<10}}),y.onBeforeUploadItem=function(t){var e={id:T};t.formData.push(e)},y.onCompleteAll=function(){t.reloadData(),t.onClear()},t.form={submit:function(t){var e=null;if(t.$invalid){var n=null,e=null;for(n in t)"$"!=n[0]&&(null!==e||t[n].$valid||(e=t[n].$name),t[n].$pristine&&(t[n].$dirty=!0));return angular.element(".ng-invalid[name="+e+"]").focus(),void u.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}u.swal("Validación exitosa","Procediendo con el guardado...","success"),S()},reset:function(t){t.$setPristine(!0)}};var S=function(){I=t.attachment.label;var e={},n=JSON.stringify(t.attachment);return e.data=Base64.encode(n),d({method:"POST",url:"api/customer-improvement-plan-document/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){m(function(){y.queue.length>0?(T=e.data.result.id,y.uploadAll()):(t.reloadData(),t.onClear())})})["catch"](function(t){u.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){t.reloadData()})};t.dtOptionsCustomerImprovementPlanDoc=o.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerImprovementPlanId=t.$parent.currentId,e.statusCode="2",JSON.stringify(e)},url:"api/customer-improvement-plan-document",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){_()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,n,o){r(angular.element(e).contents())(t)}),t.dtColumnsCustomerImprovementPlanDoc=[a.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,e,n,o){var a=t.documentUrl?t.documentUrl:"",i="api/customer-improvement-plan-document/download?id="+t.id,r="",l='<a target="_self" class="btn btn-primary btn-xs downloadDocumentRow lnk" href="'+i+'" uib-tooltip="Descargar anexo" data-id="'+t.id+'" >   <i class="fa fa-download"></i></a> ',c='<a class="btn btn-info btn-xs openDocumentRow lnk" target="_blank" href="'+a+'" uib-tooltip="Abrir anexo" data-id="'+t.id+'" >   <i class="fa fa-folder-open-o"></i></a> ',u=!1;return null==t.protectionType?u=!0:"public"==t.protectionType?u=!0:"private"==t.protectionType&&1==t.hasPermission&&(u=!0),s.can("clientes_anexo_open")&&""!=a&&(r+=c),s.can("clientes_anexo_download")&&""!=a&&(r+=l),u?r:""}),a.newColumn("documentType").withTitle("Tipo de documento").withOption("width",200),a.newColumn("classification").withTitle("Clasificación").withOption("width",200),a.newColumn("description").withTitle("Descripción").withOption("width",200),a.newColumn("version").withTitle("Versión").withOption("width",200),a.newColumn("createdAt").withTitle("Fecha Creación").withOption("width",200).withOption("defaultContent",""),a.newColumn("status").withTitle("Estado").withOption("width",200).renderWith(function(t,e,n,o){var a="";switch(t){case"Vigente":a="label label-success";break;case"Anulado":a="label label-danger"}var i='<span class="'+a+'">'+t+"</span>";return i}),a.newColumn("label").withTitle("Origen").withOption("width",200).withOption("defaultContent","")];var _=function(){$("#dtCustomerImprovementPlanDoc a.editRow").on("click",function(){var t=$(this).data("id"),e=$(this).data("url");""==e?u.swal("Error en la descarga","No existe un anexo para descargar","error"):jQuery("#downloadDocument")[0].src="api/customer-improvement-plan-document/download?id="+t})};t.dtInstanceCustomerImprovementPlanDocCallback=function(e){t.dtInstanceCustomerImprovementPlanDoc=e},t.reloadData=function(){t.dtInstanceCustomerImprovementPlanDoc.reloadData()},t.onCancel=function(){null!=t.$parent&&t.$parent.$parent.$parent.$parent.$parent.navToSection("list","list",0)}}]);
"use strict";app.controller("customerImprovementPlanAuditCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","SweetAlert","$http","$filter","$document",function(t,e,i,n,a,o,u,r,l,s,d,c,p,m,w){var h=i;t.request={},h.info("loading..customerImprovementPlanAuditCtrl "),t.criteria=[{name:"Igual",value:"="},{name:"Contiene",value:"LIKE"},{name:"Diferente",value:"<>"},{name:"Mayor que",value:">"},{name:"Menor que",value:"<"}],t.conditions=[{name:"Y",value:"AND"},{name:"O",value:"OR"}],t.audit={fields:[{name:"date",alias:"Fecha"},{name:"fullName",alias:"Usurio"},{name:"userType",alias:"Tipo Usuario"},{name:"action",alias:"Acción"},{name:"observation",alias:"Descripción"}],filters:[]},t.request.operation="audit",t.request.customer_id=e.customerId,t.request.data="",t.dtInstanceAudit={},t.dtOptionsAudit=n.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:t.request,url:"api/audit",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,i,n){u(angular.element(e).contents())(t)}),t.dtColumnsAudit=[a.newColumn("date").withTitle("Fecha").withOption("width",200),a.newColumn("userType").withTitle("Tipo Usuario").withOption("width",200),a.newColumn("user").withTitle("Usuario").withOption("width",200),a.newColumn("action").withTitle("Acción").withOption("width",200),a.newColumn("shortObservation").withTitle("Descripción")],t.reloadData=function(){t.dtInstanceAudit.reloadData()},t.addFilter=function(){null==t.audit.filters&&(t.audit.filters=[]),t.audit.filters.push({id:0,field:null,criteria:null,condition:null,value:""})},t.onFilter=function(){t.request.data=Base64.encode(JSON.stringify(t.audit)),t.reloadData()},t.removeFilter=function(e){t.audit.filters.splice(e,1)}}]);
"use strict";app.controller("customerInternalCertificateAdminTabsCtrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout","$state","$filter","flowFactory","$http",function(t,e,i,a,r,c,n,s,o,m){n.is("app.certificate.admin.view")?t.certificate_admin_title_tab="view":n.is("app.certificate.admin.create")?t.certificate_admin_title_tab="create":t.certificate_admin_title_tab="edit",t.isAgent="agent"==r.currentUser().wg_type,t.isAdmin="system"==r.currentUser().wg_type,t.isCustomer="customerAdmin"==r.currentUser().wg_type||"customerUser"==r.currentUser().wg_type,t.tabsloaded=["program"],t.tabname="program",t.titletab=t.certificate_admin_title_tab,t.switchTab=function(e,i){c(function(){t.tabname=e,t.titletab=i,t.tabsloaded.push(e)})},t.switchSubTab=function(e){c(function(){t.subtab=e})}}]);
"use strict";app.controller("customerInternalCertificateAdminProgramCtrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout",function(t,r,o,e,n,i){var c=o;c.info("loading..customerInternalCertificateAdminProgramCtrl!!! "),t.program_section="list",t.currentId=0,t.formMode="edit",t.navToSection=function(r,o,e){i(function(){t.program_section=r,t.formMode=o,t.$parent.switchSubTab(o),t.currentId=e})}}]);
"use strict";app.controller("customerInternalCertificateAdminProgramEditCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","SweetAlert","$rootScope","$http","$timeout","$uibModal","flowFactory","cfpLoadingBar","$filter","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder",function(e,r,a,i,o,n,t,l,c,s,u,m,d,p,f,g,v){var y=a;if(e.loading=!0,e.isView="view"==e.$parent.formMode,e.isCreate="create"==e.$parent.formMode,e.currencies=u.parameters("certificate_program_currency"),e.categories=u.parameters("certificate_program_category"),e.specialities=u.parameters("agent_skill"),e.validities=u.parameters("certificate_program_validity_type"),e.specialityCategories=u.parameters("certificate_program_speciality_category"),e.requirements=u.parameters("certificate_program_requirement"),e.program={id:e.isCreate?0:e.$parent.currentId,customerId:r.customerId,code:"",name:"",amount:0,currency:null,category:null,speciality:null,capacity:0,hourDuration:0,validityNumber:0,validityType:null,authorizationResolution:"",authorizingEntity:"",captionHeader:"",captionFooter:"",description:"",isActive:!0,specialities:[],requirements:[],isMandatory:!1},0!=e.program.id){y.info("editando cliente con código: "+e.program.id);var w={id:e.program.id};m({method:"GET",url:"api/customer-internal-certificate-program",params:w})["catch"](function(e,r){if(403==r){var a=null!==e.message&&void 0!==e.message?e.message:"app.certificate.admin";s.swal("No Autorizado","No estas autorizado para ver esta información.","error"),d(function(){c.go(a)},3e3)}else 404==r?(s.swal("Información no disponible","Encuesta no encontrada","error"),d(function(){})):s.swal("Error","Se ha presentado un error al intentar acceder a la información del cliente","error")}).then(function(r){d(function(){e.program=r.data.result})})["finally"](function(){d(function(){e.loading=!1},400)})}else y.info("creacion de nuevo asesor "),e.loading=!1;e.removeImage=function(){e.noImage=!0},e.master=e.program,e.form={submit:function(r){var a=null;if(r.$invalid){var i=null,a=null;for(i in r)"$"!=i[0]&&(null!==a||r[i].$valid||(a=r[i].$name),r[i].$pristine&&(r[i].$dirty=!0));return y.info(e.poll),angular.element(".ng-invalid[name="+a+"]").focus(),void s.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}s.swal("Validación exitosa","Guardando información de la encuesta...","success"),y.info(e.program),C()},reset:function(r){e.program=angular.copy(e.master),r.$setPristine(!0)}};var C=function(){var r={},i=JSON.stringify(e.program);return r.data=Base64.encode(i),m({method:"POST",url:"api/customer-internal-certificate-program/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(r)}).then(function(r){d(function(){null!=e.$parent&&e.$parent.navToSection("list","list")})})["catch"](function(e){a.error(e),s.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};e.onCancel=function(){e.isView?null!=e.$parent&&e.$parent.navToSection("list","list"):s.swal({title:"Está seguro?",text:"Perderá todos los cambios realizados en este formulario.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, cancelar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(r){r?d(function(){null!=e.$parent&&e.$parent.navToSection("list","list")}):swal("Cancelación","La operación ha sido cancelada","error")})},e.onAddSpeciality=function(){if(null==e.program.specialityCategory)s.swal("Error","Debe seleccionar la especialidad. Por favor verifique! !","error");else{var r=v("filter")(e.program.specialities,{categoryId:e.program.specialityCategory.id});if(0==r.length){var a={id:0,certificateProgramId:e.isCreate?0:e.$parent.currentId,categoryId:e.program.specialityCategory.id,category:e.program.specialityCategory};e.program.specialities.push(a)}}},e.onRemoveSpeciality=function(r){s.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(i){i?d(function(){var i=e.program.specialities[r];if(e.program.specialities.splice(r,1),0!=i.id){var o={};o.id=i.id,m({method:"POST",url:"api/customer-internal-certificate-program-speciality/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){a.error(e),s.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})},e.onAddRequirement=function(){if(null==e.program.requirement)s.swal("Error","Debe seleccionar el requerimiento. Por favor verifique! !","error");else{var r=v("filter")(e.program.requirements,{requirementId:e.program.requirement.id});if(0==r.length){var a={id:0,certificateProgramId:e.isCreate?0:e.$parent.currentId,requirementId:e.program.requirement.value,requirement:e.program.requirement,isMandatory:void 0!=e.program.isMandatory&&e.program.isMandatory};e.program.requirements.push(a)}}},e.onRemoveRequirement=function(r){s.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(i){i?d(function(){var i=e.program.requirements[r];if(e.program.requirements.splice(r,1),0!=i.id){var o={};o.id=i.id,m({method:"POST",url:"api/customer-internal-certificate-program-requirement/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){a.error(e),s.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})}}]);
"use strict";app.controller("customerInternalCertificateAdminProgramListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","SweetAlert","$http",function(t,e,n,i,a,r,o,l,c,s,u,d){var m=n;t.isAgent="agent"==s.currentUser().wg_type,t.isAdmin="system"==s.currentUser().wg_type,t.isCustomer="customerAdmin"==s.currentUser().wg_type||"customerUser"==s.currentUser().wg_type,t.isAgent?c.go("app.clientes.list"):t.isCustomer&&c.go("app.clientes.view",{customerId:s.currentUser().company}),t.dtOptionsCustomerInternalCertificateProgram=i.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.customerId=e.customerId,JSON.stringify(t)},url:"api/customer-internal-certificate-program/v2",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){p()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,n,i){o(angular.element(e).contents())(t)}),t.dtColumnsCustomerInternalCertificateProgram=[a.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,e,n,i){var a="",r='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar"  data-id="'+t.id+'" >   <i class="fa fa-edit"></i></a> ',o='<a class="btn btn-info btn-xs viewRow lnk" href="#" uib-tooltip="Ver" data-id="'+t.id+'" >   <i class="fa fa-eye"></i></a> ',l='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+t.id+'" >   <i class="fa fa-trash-o"></i></a> ';return s.can("certificate_program_view")&&(a+=o),s.can("certificate_program_edit")&&(a+=r),s.can("certificate_program_delete")&&(a+=l),a}),a.newColumn("name").withTitle("Nombre").withOption("width",200),a.newColumn("category").withTitle("Categoría"),a.newColumn("capacity").withTitle("Capacidad",200),a.newColumn("hourDuration").withTitle("Duración (Hora)",200),a.newColumn("authorizationResolution").withTitle("Resolución",200),a.newColumn(null).withTitle("Estado").withOption("width",200).renderWith(function(t,e,n,i){var a=t.isActive?"label label-success":"label label-danger",r=t.status,o='<span class="'+a+'">'+r+"</span>";return o})];var p=function(){$("#dtCustomerInternalCertificateProgram a.editRow").on("click",function(){var e=$(this).data("id");t.onEdit(e)}),$("#dtCustomerInternalCertificateProgram a.viewRow").on("click",function(){var e=$(this).data("id");t.onView(e)}),$("#dtCustomerInternalCertificateProgram a.delRow").on("click",function(){var e=$(this).data("id");m.info("intenta eliminar el registro: "+e),u.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(i){if(i){var a={};a.id=e,d({method:"POST",url:"api/customer-internal-certificate-program/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){n.error(t),u.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){t.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};t.dtInstanceCustomerInternalCertificateProgramCallback=function(e){t.dtInstanceCustomerInternalCertificateProgram=e},t.reloadData=function(){t.dtInstanceCustomerInternalCertificateProgram.reloadData()},t.onCreate=function(){null!=t.$parent&&t.$parent.navToSection("form","edit",0)},t.onEdit=function(e){null!=t.$parent&&t.$parent.navToSection("form","edit",e)},t.onView=function(e){null!=t.$parent&&t.$parent.navToSection("form","view",e)}}]);
"use strict";app.controller("customerInternalCertificateAdminGradeCtrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout",function(t,e,r,o,n,i){var c=r;c.info("loading..customerInternalCertificateAdminGradeCtrl!!! "),t.grade_section="list",t.currentId=0,t.formMode="edit",t.navToSection=function(e,r,o){i(function(){t.grade_section=e,t.formMode=r,t.$parent.switchSubTab(r),t.currentId=o})}}]);
"use strict";app.controller("customerInternalCertificateAdminGradeEditCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","SweetAlert","$rootScope","$http","$timeout","$uibModal","flowFactory","cfpLoadingBar","$filter","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder",function(e,a,r,n,t,o,i,l,c,s,d,u,f,g,m,p,h){var v=r;if(e.loading=!0,e.isView="view"==e.$parent.formMode,e.isCreate="create"==e.$parent.formMode,e.programs=[],e.status=d.parameters("certificate_grade_status"),e.locations=d.parameters("certificate_grade_location"),e.workCenters=d.parameters("certificate_grade_work_center"),e.channels=d.parameters("certificate_grade_channel"),e.validities=d.parameters("certificate_program_validity_type"),e.specialities=d.parameters("agent_skill"),e.agents=[],e.totalHourDuration=0,e.grade={id:e.isCreate?0:e.$parent.currentId,program:null,code:"",name:"",location:null,description:"",status:null,calendar:[],agents:[]},e.grade.id>0){v.info("editando cliente con código: "+e.grade.id);var w={id:e.grade.id};u({method:"GET",url:"api/customer-internal-certificate-grade",params:w})["catch"](function(e,a){if(403==a){var r=null!==e.message&&void 0!==e.message?e.message:"app.asesores.list";s.swal("No Autorizado","No estas autorizado para ver esta información.","error"),f(function(){c.go(r)},3e3)}else 404==a?(s.swal("Información no disponible","Encuesta no encontrada","error"),f(function(){})):s.swal("Error","Se ha presentado un error al intentar acceder a la información del cliente","error")}).then(function(a){f(function(){e.grade=a.data.result,e.grade.defaultSpeciality=e.grade.program.speciality,e.loadAgents(e.grade.defaultSpeciality.value)})})["finally"](function(){f(function(){D(),e.loading=!1},400)})}else v.info("creacion de nuevo asesor "),e.loading=!1;e.removeImage=function(){e.noImage=!0},e.master=e.grade,e.form={submit:function(a){var r=null;if(a.$invalid){var n=null,r=null;for(n in a)"$"!=n[0]&&(null!==r||a[n].$valid||(r=a[n].$name),a[n].$pristine&&(a[n].$dirty=!0));return v.info(e.grade),angular.element(".ng-invalid[name="+r+"]").focus(),void s.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}s.swal("Validación exitosa","Guardando información del curso...","success"),v.info(e.grade),C()},reset:function(a){e.grade=angular.copy(e.master),a.$setPristine(!0)}};var C=function(){var a={},n=JSON.stringify(e.grade);return a.data=Base64.encode(n),u({method:"POST",url:"api/customer-internal-certificate-grade/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(a){f(function(){null!=e.$parent&&e.$parent.navToSection("list","list")})})["catch"](function(e){r.error(e),s.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};e.onCancel=function(){e.isView||s.swal({title:"Está seguro?",text:"Perderá todos los cambios realizados en este formulario.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, cancelar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(a){a?f(function(){null!=e.$parent&&e.$parent.navToSection("list","list")}):swal("Cancelación","La operación ha sido cancelada","error")})};var D=function(){var r={};r.operation="program-list",r.customer_id=a.customerId,u({method:"POST",url:"api/customer-internal-certificate-program",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(r)})["catch"](function(e,a){}).then(function(a){f(function(){e.programs=a.data.data})})["finally"](function(){})};D(),e.onAddCalendarDate=function(){if(null==e.grade.startDateTime||null==e.grade.hourDuration||0==e.grade.hourDuration)s.swal("Error","Debe ingresar la información requerida. Por favor verifique! !","error");else{if(e.grade.hourDuration>24)return void l.pop("error","Error","La duración supera las horas disponibles por fecha.");if(e.totalHourDuration+parseInt(e.grade.hourDuration)>parseInt(e.grade.program.hourDuration))return void l.pop("error","Error","La duración total supera las horas asignadas al programa.");var a,r=h("date")(e.grade.startDateTime,"dd/MM/yyyy"),n=!1;for(a=0;a<e.grade.calendar.length;a++)e.grade.calendar[a].startDateFormat==r&&(n=!0);if(n)l.pop("error","Error","La fecha ya ha sido asignada al programa.");else{var t={id:0,certificateGradeId:e.isCreate?0:e.$parent.currentId,startDateFormat:h("date")(e.grade.startDateTime,"dd/MM/yyyy"),startDate:e.grade.startDateTime,hourDuration:e.grade.hourDuration};e.grade.calendar.push(t)}}},e.$watch("grade.calendar",function(){r.info(e.grade.calendar.length),e.totalHourDuration=0,e.grade.calendar.length>0&&angular.forEach(e.grade.calendar,function(a){e.totalHourDuration+=parseInt(a.hourDuration)})},!0),e.onRemoveCalendarDate=function(a){s.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(n){n&&f(function(){var n=e.grade.calendar[a];if(e.grade.calendar.splice(a,1),0!=n.id){var t={};t.id=n.id,u({method:"POST",url:"api/customer-internal-certificate-grade-calendar/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){r.error(e),s.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}})})},e.changeSkill=function(a,r){e.grade.agents=[],e.loadAgents(a.value)},e.changeprograma=function(a,r){e.grade.defaultSpeciality=a.speciality,e.loadAgents(a.speciality.value)},e.loadAgents=function(a){var n={};return n.skill=a,u({method:"POST",url:"api/project/agent",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(a){f(function(){e.agents=a.data.data})})["catch"](function(e){r.error(e),s.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})},e.onAddAgent=function(a){s.swal({title:"Está seguro?",text:"Confirmas adicionar este recurso al proyecto?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, adicionar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(r){r?f(function(){var r=h("filter")(e.grade.agents,{agentId:e.agents[a].id});0==r.length&&e.grade.agents.push({id:0,agentId:e.agents[a].id,certificateGradeId:e.isCreate?0:e.$parent.currentId,estimatedHours:e.agents[a].estimatedHours,notAssignedHours:e.agents[a].notAssignedHours,name:e.agents[a].name})}):swal("Cancelación","La operación ha sido cancelada","error")})},e.onRemoveAgent=function(a){s.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(n){n?f(function(){var n=e.grade.agents[a];if(e.grade.agents.splice(a,1),0!=n.id){var t={};t.id=n.id,u({method:"POST",url:"api/customer-internal-certificate-grade-agent/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){r.error(e),s.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})}}]);
"use strict";app.controller("customerInternalCertificateAdminGradeListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","SweetAlert","$http","$timeout","ListService",function(t,e,n,a,i,r,o,l,c,s,u,d,f,m){function p(){var n={customerId:e.customerId},a=[{name:"customer_internal_certificate_program",value:null,criteria:n}];m.getDataList(a).then(function(e){t.programs=e.data.data.customerInternalCertificateProgram},function(e){t.status="Unable to load customer data: "+e.message})}var w=n;t.isAgent="agent"==s.currentUser().wg_type,t.isAdmin="system"==s.currentUser().wg_type,t.isCustomer="customerAdmin"==s.currentUser().wg_type||"customerUser"==s.currentUser().wg_type,t.status=s.parameters("certificate_grade_status"),t.locations=s.parameters("certificate_grade_location"),t.agents=s.agents(),p(),t.filter={selectedStatus:null,selectedAgent:null,selectedLocation:null,startDate:null,endDate:null,selectedProgram:null},t.isAgent?c.go("app.clientes.list"):t.isCustomer&&c.go("app.clientes.view",{customerId:s.currentUser().company}),t.dtOptionsCustomerInternalGrade=a.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(n){return n.customerId=e.customerId,n.location=t.filter.selectedLocation?t.filter.selectedLocation.value:null,n.statusCode=t.filter.selectedStatus?t.filter.selectedStatus.value:null,n.programId=t.filter.selectedProgram?t.filter.selectedProgram.id:null,n.agentId=t.filter.selectedAgent?t.filter.selectedAgent.id:null,n.startDate=t.filter.startDate?kendo.toString(t.filter.startDate,"yyyy-MM-dd"):null,n.endDate=t.filter.endDate?kendo.toString(t.filter.endDate,"yyyy-MM-dd"):null,JSON.stringify(n)},url:"api/customer-internal-certificate-grade/v2",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){g()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,n,a){o(angular.element(e).contents())(t)}),t.dtColumnsCustomerInternalGrade=[i.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,e,n,a){var i="",r='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar"  data-id="'+t.id+'" >   <i class="fa fa-edit"></i></a> ',o='<a class="btn btn-info btn-xs viewRow lnk" href="#" uib-tooltip="Ver" data-id="'+t.id+'" >   <i class="fa fa-eye"></i></a> ',l='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+t.id+'" >   <i class="fa fa-trash-o"></i></a> ';return s.can("certificate_program_view")&&(i+=o),s.can("certificate_program_edit")&&(i+=r),s.can("certificate_program_delete")&&(i+=l),i}),i.newColumn("name").withTitle("Nombre").withOption("width",200),i.newColumn("program").withTitle("Programa").withOption("width",200),i.newColumn("category").withTitle("Categoría"),i.newColumn("capacity").withTitle("Capacidad",200),i.newColumn("registered").withTitle("Inscritos",200),i.newColumn("quota").withTitle("Cupos",200),i.newColumn(null).withTitle("Estado").withOption("width",200).renderWith(function(t,e,n,a){var i="";switch(t.status){case"Registro":i="label label-success";break;case"Cerrado":i="label label-danger";break;case"Ejecución":i="label label-warning";break;case"Cancelado":i="label label-default"}var r='<span class="'+i+'">'+t.status+"</span>";return r})];var g=function(){$("#dtCustomerInternalCertificateGrade a.editRow").on("click",function(){var e=$(this).data("id");t.onEdit(e)}),$("#dtCustomerInternalCertificateGrade a.viewRow").on("click",function(){var e=$(this).data("id");t.onView(e)}),$("#dtCustomerInternalCertificateGrade a.delRow").on("click",function(){var e=$(this).data("id");w.info("intenta eliminar el registro: "+e),u.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(a){if(a){var i={};i.id=e,d({method:"POST",url:"api/customer-internal-certificate-program/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){n.error(t),u.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){t.reloadData()})}})})};t.dtInstanceCustomerInternalGradeCallback=function(e){t.dtInstanceCustomerInternalGrade=e},t.reloadData=function(){t.dtInstanceCustomerInternalGrade.reloadData()},t.onCreate=function(){null!=t.$parent&&t.$parent.navToSection("form","edit",0)},t.onEdit=function(e){null!=t.$parent&&t.$parent.navToSection("form","edit",e)},t.onView=function(e){null!=t.$parent&&t.$parent.navToSection("form","view",e)},t.onSearch=function(){f(function(){t.reloadData()})},t.onClearLocation=function(){f(function(){t.filter.selectedLocation=null,t.reloadData()})},t.onClearStatus=function(){f(function(){t.filter.selectedStatus=null,t.reloadData()})},t.onClearProgram=function(){f(function(){t.filter.selectedProgram=null,t.reloadData()})},t.onClearAgent=function(){f(function(){t.filter.selectedAgent=null,t.reloadData()})},t.onClearStartDate=function(){f(function(){t.filter.startDate=null,t.reloadData()})},t.onClearEndDate=function(){f(function(){t.filter.endDate=null,t.reloadData()})}}]);
"use strict";app.controller("customerInternalCertificateAdminGradeParticipantCertificateListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","SweetAlert","$rootScope","$http","$timeout","$uibModal","flowFactory","cfpLoadingBar","$filter","$aside",function(t,e,n,i,a,r,o,c,l,s,d,u,p,f,m,w,h,C){var g=n,v={};t.customerId=0,t.grade={},t.loading=!0,t.isView="view"==t.$parent.formMode,t.isCreate="create"==t.$parent.formMode,t.currentId=0,t.participant={id:t.isCreate?0:t.currentId,certificateGradeId:t.$parent.currentId,customer:null,documentType:null,identificationNumber:"",name:"",lastName:"",workCenter:null,price:null,channel:null,countryOrigin:null,countryResidence:null,isApproved:!1,contacts:[]};t.removeImage=function(){t.noImage=!0},t.onCancel=function(){t.isView||s.swal({title:"Está seguro?",text:"Perderá todos los cambios realizados en este formulario.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, cancelar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(e){e?p(function(){null!=t.$parent&&t.$parent.navToSection("list","list")}):swal("Cancelación","La operación ha sido cancelada","error")})},t.changeProgram=function(e,n){t.participant.defaultSpeciality=e.speciality,t.loadAgents(e.speciality.value)},p(function(){O()},10);var O=function(){if(t.$parent.currentId>0){var e={id:t.$parent.currentId};u({method:"GET",url:"api/customer-internal-certificate-grade",params:e})["catch"](function(t,e){if(403==e){var n=null!==t.message&&void 0!==t.message?t.message:"app.asesores.list";s.swal("No Autorizado","No estas autorizado para ver esta información.","error"),p(function(){l.go(n)},3e3)}else 404==e?(s.swal("Información no disponible","Encuesta no encontrada","error"),p(function(){})):s.swal("Error","Se ha presentado un error al intentar acceder a la información del cliente","error")}).then(function(e){p(function(){t.grade=e.data.result})})["finally"](function(){p(function(){t.loading=!1},400)})}};t.onRemoveContact=function(e){s.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(i){i?p(function(){var i=t.participant.contacts[e];if(t.participant.contacts.splice(e,1),0!=i.id){var a={};a.id=i.id,u({method:"POST",url:"api/customer-internal-certificate-grade-participant-contact/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){n.error(t),s.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})};var y=function(){var e={},i=JSON.stringify(t.customer);return e.data=i,u({method:"POST",url:"api/project/customer",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){p(function(){t.customers=i.data})})["catch"](function(t){n.error(t),s.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};y(),v.operation="participant",v.certificate_grade_id=t.$parent.currentId,t.dtInstanceCustomerInternalCertificateParticipant={},t.dtOptionsCustomerInternalCertificateParticipant=i.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:v,url:"api/customer-internal-certificate-grade-participant",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){b()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,n,i){o(angular.element(e).contents())(t)}),t.dtColumnsCustomerInternalCertificateParticipant=[a.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,e,n,i){var a="",r=t.hasCertificate?"":"disabled",o='<a target="_self" class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Descargar certificado" data-id="'+t.id+'" >   <i class="fa fa-download"></i></a> ';'<a class="btn btn-info btn-xs viewRow lnk" href="#"  uib-tooltip="Ver participante" data-id="'+t.id+'" >   <i class="fa fa-eye"></i></a> ','<a class="btn btn-danger btn-xs delRow lnk" href="#"  uib-tooltip="Eliminar participante" data-id="'+t.id+'"'+r+' >   <i class="fa fa-trash-o"></i></a> ';return d.can("clientes_view"),d.can("clientes_edit")&&(a+=o),d.can("clientes_delete"),a}),a.newColumn("employee.entity.documentType.item").withTitle("Tipo de Identificación").withOption("width",200).withOption("defaultContent",""),a.newColumn("employee.entity.documentNumber").withTitle("Identificación").withOption("width",200).withOption("defaultContent",""),a.newColumn("employee.entity.firstName").withTitle("Nombres").withOption("width",200).withOption("defaultContent",""),a.newColumn("employee.entity.lastName").withTitle("Apellidos").withOption("width",200).withOption("defaultContent",""),a.newColumn(null).withTitle("Empresa").withOption("width",200).renderWith(function(t,e,n,i){return t.customer.length>0?t.customer[0].item:t.customer.item}),a.newColumn("price.amount").withTitle("Precio").withOption("width",200),a.newColumn(null).withTitle("Anexos").withOption("width",200).renderWith(function(t,e,n,i){var a="label label-warning",r=0;null==t.attachment&&void 0==t.attachment||(r=t.attachment);var o='<span class="'+a+'">'+r+" Anexos </span>";return o}),a.newColumn(null).withTitle("Cumple requisitos").withOption("width",200).renderWith(function(t,e,n,i){var a="label label-danger",r="Inactivo";null==t.isApproved&&void 0==t.isApproved||(t.isApproved?(a="label label-success",r="Si cumple"):(a="label label-danger",r="No Cumple"));var o='<span class="'+a+'">'+r+"</span>";return o})],t.onViewParticipant=function(e){t.currentId=e,t.participant.id=e,t.isView=!0,t.onLoadRecord()},t.onEditParticipant=function(e){t.workplace.id=e,t.isView=!1,t.onLoadRecord()},t.cancelEdition=function(e){null!=t.$parent&&t.$parent.navToSection("list","list",0)},t.onGenerate=function(){var e={};e.id=t.$parent.currentId,u({method:"POST",url:"api/customer-internal-certificate-grade/generate",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(t){swal("Generacion Certificados","Certificados generados satisfactoriamente","info")})["catch"](function(t){n.error(t),s.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){t.reloadData()})},t.onClear=function(){p(function(){t.participant={id:t.isCreate?0:t.currentId,certificateGradeId:t.$parent.currentId,customer:null,documentType:null,identificationNumber:"",name:"",lastName:"",workCenter:null,price:null,channel:null,countryOrigin:null,countryResidence:null,isApproved:!1,contacts:[]}}),t.isView=!1};var b=function(){$("#dtCustomerInternalCertificateParticipants a.editRow").on("click",function(){var t=$(this).data("id"),e=$(this).data("url");""==e?s.swal("Error en la descarga","No existe un anexo para descargar","error"):jQuery("#downloadDocument")[0].src="api/customer-internal-certificate-grade-participant-certificate/download?id="+t}),$("#dtCustomerInternalCertificateParticipants a.viewRow").on("click",function(){var e=$(this).data("id");t.participant.id=e,t.onViewParticipant(e)}),$("#dtCustomerInternalCertificateParticipants a.delRow").on("click",function(){var e=$(this).data("id");g.info("intenta eliminar el registro: "+e),s.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(i){if(i){var a={};a.id=e,u({method:"POST",url:"api/customer-internal-certificate-grade-participant/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){n.error(t),s.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){t.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};t.dtInstanceCustomerInternalCertificateParticipantCallback=function(e){t.dtInstanceCustomerInternalCertificateParticipant=e},t.reloadData=function(){t.dtInstanceCustomerInternalCertificateParticipant.reloadData()},t.onAddCustomer=function(){var e=C.open({templateUrl:d.app.views.urlRoot+"modules/customer/certificate/tabs/course/certificate_grade_participant_modal_customer.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideCustomerCtrl",scope:t,resolve:{participant:function(){return t.participant}}});e.result.then(function(){y()})}}]);
"use strict";app.controller("customerInternalCertificateAdminGradeParticipantEditCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","SweetAlert","$rootScope","$http","$timeout","$uibModal","flowFactory","cfpLoadingBar","$filter","$aside","$document",function(t,e,n,i,a,o,r,l,c,s,d,u,p,m,f,w,h,g,v){var C=n,b={};t.flowConfig={target:"/api/customer-internal-certificate-grade-participant/upload",singleFile:!0},t.customerId=e.customerId,t.grade={},t.loading=!0,t.isView="view"==t.$parent.formMode,t.isCreate="create"==t.$parent.formMode,t.currentId=0,t.customers=[],t.employees=[],t.workCenters=d.parameters("certificate_grade_work_center"),t.channels=d.parameters("certificate_grade_channel"),t.countries=d.countries(),t.documentTypes=d.parameters("tipodoc"),t.extrainfo=d.parameters("extrainfo"),t.agents=[],t.prices=[],t.participant={id:t.isCreate?0:t.currentId,certificateGradeId:t.$parent.currentId,logo:"",customer:{id:e.customerId},employee:null,price:null,channel:null,isApproved:!1},t.uploader=new Flow,""==t.participant.logo&&(t.noImage=!0);t.removeImage=function(){t.noImage=!0},t.master=t.participant,t.form={submit:function(e){var n=null;if(e.$invalid){var i=null,n=null;for(i in e)"$"!=i[0]&&(null!==n||e[i].$valid||(n=e[i].$name),e[i].$pristine&&(e[i].$dirty=!0));return C.info(t.participant),angular.element(".ng-invalid[name="+n+"]").focus(),void s.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}s.swal("Validación exitosa","Guardando información del curso...","success"),C.info(t.participant),y()},reset:function(e){t.participant=angular.copy(t.master),e.$setPristine(!0)}};var y=function(){var e={},i=JSON.stringify(t.participant);return e.data=Base64.encode(i),u({method:"POST",url:"api/customer-internal-certificate-grade-participant/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){p(function(){t.reloadData()})})["catch"](function(t){n.error(t),s.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){t.onClear()})};t.onCancel=function(){t.isView||s.swal({title:"Está seguro?",text:"Perderá todos los cambios realizados en este formulario.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, cancelar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(e){e?p(function(){null!=t.$parent&&t.$parent.navToSection("list","list")}):swal("Cancelación","La operación ha sido cancelada","error")})},t.changeProgram=function(e,n){t.participant.defaultSpeciality=e.speciality,t.loadAgents(e.speciality.value)},p(function(){I(),D()},10);var I=function(){};t.onAddInfoDetail=function(){p(function(){null==t.participant.contacts&&(t.participant.contacts=[]),t.participant.contacts.push({id:0,value:"",type:null})})},t.onLoadRecord=function(){if(console.log(t.participant),t.participant.id){C.info("editando cliente con código: "+t.participant.id);var e={id:t.participant.id};u({method:"GET",url:"api/customer-internal-certificate-grade-participant",params:e})["catch"](function(t,e){if(403==e){var n=null!==t.message&&void 0!==t.message?t.message:"app.asesores.list";s.swal("No Autorizado","No estas autorizado para ver esta información.","error"),p(function(){c.go(n)},3e3)}else 404==e?(s.swal("Información no disponible","Encuesta no encontrada","error"),p(function(){})):s.swal("Error","Se ha presentado un error al intentar acceder a la información del cliente","error")}).then(function(e){p(function(){t.participant=e.data.result,t.customerId=t.participant.customer.id,O(),null!=t.participant.logo&&null!=t.participant.logo.path?t.noImage=!1:t.noImage=!0})})["finally"](function(){p(function(){I(),t.loading=!1},400),p(function(){v.scrollTop(40,2e3)})})}else C.info("creacion de nuevo asesor "),t.loading=!1},t.removeImage=function(){t.noImage=!0};var O=function(){var e={};return e.customer_id=t.customerId,u({method:"POST",url:"api/customer/certificate-program",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){p(function(){var n=e.data.data;if(0==n.length){t.prices=[];var i={id:0,amount:t.grade.program.amount};t.prices.push(i)}else{t.prices=[];var i={id:0,amount:t.grade.program.amount};t.prices.push(i),angular.forEach(n,function(e,n){if(e.program.id==t.grade.program.id){var i={id:e.id,amount:e.amount};t.prices.push(i)}})}})})["catch"](function(t){n.error(t),s.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})},D=function(){if(t.$parent.currentId>0){var e={id:t.$parent.currentId};u({method:"GET",url:"api/customer-internal-certificate-grade",params:e})["catch"](function(t,e){if(403==e){var n=null!==t.message&&void 0!==t.message?t.message:"app.asesores.list";s.swal("No Autorizado","No estas autorizado para ver esta información.","error"),p(function(){c.go(n)},3e3)}else 404==e?(s.swal("Información no disponible","Encuesta no encontrada","error"),p(function(){})):s.swal("Error","Se ha presentado un error al intentar acceder a la información del cliente","error")}).then(function(e){p(function(){t.grade=e.data.result,O()})})["finally"](function(){p(function(){t.loading=!1},400)})}};t.changeCustomer=function(e,n){t.customerId=e.id,t.participant.price=null,O()},t.onRemoveContact=function(e){s.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(i){i?p(function(){var i=t.participant.contacts[e];if(t.participant.contacts.splice(e,1),0!=i.id){var a={};a.id=i.id,u({method:"POST",url:"api/customer-internal-certificate-grade-participant-contact/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){n.error(t),s.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})},b.operation="participant",b.certificate_grade_id=t.$parent.currentId,t.dtInstanceCustomerInternalParticipant={},t.dtOptionsCustomerInternalParticipant=i.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:b,url:"api/customer-internal-certificate-grade-participant",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){A()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,n,i){r(angular.element(e).contents())(t)}),t.dtColumnsCustomerInternalParticipant=[a.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,e,n,i){var a="",o="",r='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar"  data-id="'+t.id+'"'+o+' >   <i class="fa fa-edit"></i></a> ',l='<a class="btn btn-info btn-xs viewRow lnk" href="#"  uib-tooltip="Ver" data-id="'+t.id+'" >   <i class="fa fa-eye"></i></a> ',c='<a class="btn btn-danger btn-xs delRow lnk" href="#"  uib-tooltip="Eliminar" data-id="'+t.id+'"'+o+' >   <i class="fa fa-trash-o"></i></a> ',s='<a class="btn btn-success btn-xs uploadRow lnk" href="#"  uib-tooltip="Adicionar anexo" data-id="'+t.id+'"'+o+' >   <i class="fa fa-paperclip"></i></a> ';return d.can("certificate_program_view")&&(a+=l),d.can("certificate_program_edit")&&(a+=r),d.can("certificate_program_delete")&&(a+=c),d.can("certificate_program_edit")&&(a+=s),a}),a.newColumn("employee.entity.documentType.item").withTitle("Tipo de Identificación").withOption("width",200).withOption("defaultContent",""),a.newColumn("employee.entity.documentNumber").withTitle("Identificación").withOption("width",200).withOption("defaultContent",""),a.newColumn("employee.entity.firstName").withTitle("Nombres").withOption("width",200).withOption("defaultContent",""),a.newColumn("employee.entity.lastName").withTitle("Apellidos").withOption("width",200).withOption("defaultContent",""),a.newColumn(null).withTitle("Empresa").withOption("width",200).renderWith(function(t,e,n,i){return t.customer.length>0?t.customer[0].item:t.customer.item}),a.newColumn("price.amount").withTitle("Precio").withOption("width",200).withOption("defaultContent","0"),a.newColumn(null).withTitle("Anexos").withOption("width",200).renderWith(function(t,e,n,i){var a="label label-warning",o=0;null==t.attachment&&void 0==t.attachment||(o=t.attachment);var r='<span class="'+a+'">'+o+" Anexos </span>";return r}),a.newColumn(null).withTitle("Cumple requisitos").withOption("width",200).renderWith(function(t,e,n,i){var a="label label-danger",o="Inactivo";null==t.isApproved&&void 0==t.isApproved||(t.isApproved?(a="label label-success",o="Si cumple"):(a="label label-danger",o="No Cumple"));var r='<span class="'+a+'">'+o+"</span>";return r})],t.onViewParticipant=function(e){t.currentId=e,t.participant.id=e,t.isView=!0,t.onLoadRecord()},t.onEditParticipant=function(e){t.currentId=e,t.participant.id=e,t.isView=!1,t.onLoadRecord()},t.cancelEdition=function(e){null!=t.$parent&&t.$parent.navToSection("list","list",0)},t.onClear=function(){p(function(){t.participant={id:t.isCreate?0:t.currentId,certificateGradeId:t.$parent.currentId,customer:null,employee:null,price:null,channel:null,isApproved:!1}}),p(function(){t.noImage=!0,v.scrollTop(40,2e3)}),t.isView=!1};var A=function(){$("#dtCustomerInternalParticipants a.editRow").on("click",function(){var e=$(this).data("id");t.onEditParticipant(e)}),$("#dtCustomerInternalParticipants a.viewRow").on("click",function(){var e=$(this).data("id");t.participant.id=e,t.onViewParticipant(e)}),$("#dtCustomerInternalParticipants a.uploadRow").on("click",function(){var e=$(this).data("id");t.participant.id=e,t.onAddDocument()}),$("#dtCustomerInternalParticipants a.delRow").on("click",function(){var e=$(this).data("id");C.info("intenta eliminar el registro: "+e),s.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(i){if(i){var a={};a.id=e,u({method:"POST",url:"api/customer-internal-certificate-grade-participant/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){n.error(t),s.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){t.reloadData()})}})})};t.onAddDocument=function(){var e=g.open({templateUrl:d.app.views.urlRoot+"modules/customer/certificate/tabs/course/certificate_grade_participant_document_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideCustomerInternalParticipantDocumentCtrl",scope:t,resolve:{participant:function(){return t.participant},grade:function(){return t.grade}}});e.result.then(function(){t.reloadData()})},t.dtInstanceCustomerInternalParticipantCallback=function(e){t.dtInstanceCustomerInternalParticipant=e},t.reloadData=function(){t.dtInstanceCustomerInternalParticipant.reloadData()},t.onAddEmployeeList=function(){var e=g.open({templateUrl:d.app.views.urlRoot+"modules/customer/certificate/tabs/course/customer_absenteeism_disability_employee_list_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideOccupationalInternalCertificateEmployeeListCtrl",scope:t,resolve:{customer:function(){return{id:t.customerId}}}});e.result.then(function(t){T(t)})};var T=function(e){var n=h("filter")(t.employees,{id:e.id});0==n.length&&t.employees.push(e),console.log(e),null!=e.entity.birthDate&&(e.entity.birthDate=new Date(e.entity.birthDate.date)),t.participant.employee=e}}]),app.controller("ModalInstanceSideCustomerInternalParticipantDocumentCtrl",["$rootScope","$scope","$uibModalInstance","participant","grade","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile",function(t,e,n,i,a,o,r,l,c,s,d,u,p,m,f){var w=0;e.participantDocumentType=[],e.participantDocumentType=t.parameters("certificate_program_requirement"),e.participant=i,e.attachment={id:0,created_at:d("date")(new Date,"dd/MM/yyyy HH:mm"),certificateGradeParticipantId:e.participant.id,agent:null,requirement:null,classification:null,status:null,version:1,description:""};var h=e.uploader=new u({url:"api/customer-internal-certificate-grade-participant-document/upload",formData:[]});h.filters.push({name:"customFilter",fn:function(t,e){return this.queue.length<10}}),h.onWhenAddingFileFailed=function(t,e,n){console.info("onWhenAddingFileFailed",t,e,n)},h.onAfterAddingFile=function(t){console.info("onAfterAddingFile",t)},h.onAfterAddingAll=function(t){console.info("onAfterAddingAll",t)},h.onBeforeUploadItem=function(t){console.info("onBeforeUploadItem",t);var e={id:w};t.formData.push(e)},h.onProgressItem=function(t,e){console.info("onProgressItem",t,e)},h.onProgressAll=function(t){console.info("onProgressAll",t)},h.onSuccessItem=function(t,e,n,i){console.info("onSuccessItem",t,e,n,i)},h.onErrorItem=function(t,e,n,i){console.info("onErrorItem",t,e,n,i)},h.onCancelItem=function(t,e,n,i){console.info("onCancelItem",t,e,n,i)},h.onCompleteItem=function(t,e,n,i){console.info("onCompleteItem",t,e,n,i)},h.onCompleteAll=function(){console.info("onCompleteAll"),e.clear()},e.onCloseModal=function(){n.close(1)},e.onCancelDocument=function(){n.dismiss("cancel")},e.onSaveDocument=function(){var t={},n=JSON.stringify(e.attachment);return t.data=Base64.encode(n),c({method:"POST",url:"api/customer-internal-certificate-grade-participant-document/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){r(function(){e.attachment=t.data.result,w=t.data.result.id,h.uploadAll(),l.swal("Validación exitosa","Procediendo con el guardado...","success"),e.attachment={id:0,created_at:d("date")(new Date,"dd/MM/yyyy HH:mm"),certificateGradeParticipantId:e.participant.id,agent:null,requirement:null,classification:null,status:null,version:1,description:""}})})["catch"](function(t){o.error(t),l.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){e.reloadData()})};var g={};g.operation="document",g.certificate_grade_participant_id=e.participant.id,e.dtInstanceCertificateParticipantDocumentAtt={},e.dtOptionsCertificateParticipantDocumentAtt=m.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:g,url:"api/customer-internal-certificate-grade-participant-document",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){v()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,n,i){f(angular.element(t).contents())(e)}),e.dtColumnsCertificateParticipantDocumentAtt=[p.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,n,i,a){var o=null!=e.document?e.document.path:"",r="",l='<a target="_self" class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Descargar anexo" data-id="'+e.id+'" data-url="'+o+'" >   <i class="fa fa-download"></i></a> ';'<a class="btn btn-info btn-xs viewRow lnk" target="_blank" href="'+o+'" uib-tooltip="Abrir anexo" data-id="'+e.id+'" >   <i class="fa fa-folder-open-o"></i></a> ','<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Anular anexo" data-id="'+e.id+'" >   <i class="fa fa-ban"></i></a> ';return t.can("seguimiento_view"),t.can("seguimiento_edit")&&(r+=l),t.can("seguimiento_delete"),r}),p.newColumn("requirement").withTitle("Tipo de documento").withOption("width",200),p.newColumn("description").withTitle("Descripción").withOption("width",200),p.newColumn("date").withTitle("Fecha Creación").withOption("width",200),p.newColumn(null).withTitle("Usuario").withOption("width",200).renderWith(function(t,e,n,i){var a="";return null!=t.agent&&(a=t.agent),a})];var v=function(){$("#dtDisabilityDocumentAtt a.editRow").on("click",function(){var t=$(this).data("id"),e=$(this).data("url");""==e?l.swal("Error en la descarga","No existe un anexo para descargar","error"):jQuery("#downloadDocument")[0].src="api/customer-internal-certificate-grade-participant-document/download?id="+t}),$("#dtDisabilityDocumentAtt a.delRow").on("click",function(){var t=$(this).data("id");log.info("intenta eliminar el registro: "+t),l.swal({title:"Está seguro?",text:"Anularás el anexo seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, anular!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(t){t||swal("Cancelación","La operación ha sido cancelada","error")})})};e.dtInstanceCertificateParticipantDocumentAttCallback=function(t){e.dtInstanceCertificateParticipantDocumentAtt=t},e.reloadData=function(){e.dtInstanceCertificateParticipantDocumentAtt.reloadData()}}]),app.controller("ModalInstanceSideOccupationalInternalCertificateEmployeeListCtrl",["$rootScope","$stateParams","$scope","customer","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile",function(t,e,n,i,a,o,r,l,c,s,d,u,p,m,f){n.title="Empleados";var w={};n.employee={id:0},n.onCloseModal=function(){a.close(n.employee)},n.onCancel=function(){a.dismiss("cancel")},n.onLoadRecord=function(){if(0!=n.employee.id){var t={id:n.employee.id};c({method:"GET",url:"api/customer-employee",params:t})["catch"](function(t,e){if(403==e){var n=null!==t.message&&void 0!==t.message?t.message:"app.clientes.list";l.swal("No Autorizado","No estas autorizado para ver esta información.","error"),r(function(){$state.go(n)},3e3)}else 404==e?l.swal("Información no disponible","Diagnóstico no encontrado","error"):l.swal("Error","Se ha presentado un error al intentar acceder a la información del proceso","error")}).then(function(t){r(function(){n.employee=t.data.result})})["finally"](function(){r(function(){n.onCloseModal()},400)})}else n.loading=!1},w.operation="restriction",w.customer_id=i.id,w.data="",n.dtInstanceDisabilityEmployeeList={},n.dtOptionsDisabilityEmployeeList=m.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:w,url:"api/customer-employee",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){h()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,e,i){f(angular.element(t).contents())(n)}),n.dtColumnsDisabilityEmployeeList=[p.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,e,n,i){var a="",o="",r='<a class="btn btn-success btn-xs editRow lnk" href="#" uib-tooltip="Adicionar empleado" tooltip-placement="right"  data-id="'+t.id+'"'+o+' >   <i class="fa fa-plus-square"></i></a> ';return a+=r}),p.newColumn("documentNumber").withTitle("Número Identificación").withOption("width",200),p.newColumn("firstName").withTitle("Nombre").withOption("width",200),p.newColumn("lastName").withTitle("Apellidos").withOption("width",200),p.newColumn("workPlace").withTitle("Centro de Trabajo").withOption("width",200),p.newColumn("job").withTitle("Cargo").withOption("width",200),p.newColumn("neighborhood").withTitle("Centro de Costos").withOption("width",200),p.newColumn(null).withTitle("Estado").withOption("width",200).renderWith(function(t,e,n,i){var a="label label-danger",o="Inactivo";null==t.isActive&&void 0==t.isActive||("Activo"==t.isActive?(a="label label-success",o="Activo"):(a="label label-danger",o="Inactivo"));var r='<span class="'+a+'">'+o+"</span>";return r}),p.newColumn(null).withTitle("Autorización").withOption("width",200).renderWith(function(t,e,n,i){var a="label label-danger",o="Inactivo";null==t.isAuthorized&&void 0==t.isAuthorized||("Autorizado"==t.isAuthorized?(a="label label-success",o="Autorizado"):"No Autorizado"==t.isAuthorized?(a="label label-danger",o="No Autorizado"):(a="label label-info",o="N/A"));var r='<span class="'+a+'">'+o+"</span>";return r})];var h=function(){$("#dtDisabilityEmployeeList a.editRow").on("click",function(){var t=$(this).data("id");n.editDisabilityEmployee(t)})};n.dtInstanceDisabilityEmployeeListCallback=function(t){n.dtInstanceDisabilityEmployeeList=t},n.reloadData=function(){n.dtInstanceDisabilityEmployeeList.reloadData()},n.viewDisabilityEmployee=function(t){n.employee.id=t,n.isView=!0,n.onLoadRecord()},n.editDisabilityEmployee=function(t){console.log(n.employee.id),n.employee.id=t,n.isView=!1,n.onLoadRecord()}}]);
"use strict";app.controller("customerMatrixCtrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout",function(t,o,r,i,c,n){var e=r;e.info("loading..customerMatrixCtrl!!! "),t.matrix_section="list",t.currentId=0,t.navToSection=function(o,r,i){n(function(){t.matrix_section=o,t.$parent.switchSubTab(r),t.currentId=i})}}]);
"use strict";app.controller("customerMatrixListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert",function(t,e,n,a,i,o,r,c,l,s,u,d,p){var m=n;t.isAgent="agent"==s.currentUser().wg_type,t.isAdmin="system"==s.currentUser().wg_type,t.isCustomer="customerAdmin"==s.currentUser().wg_type||"customerUser"==s.currentUser().wg_type,t.dtInstanceCustomerMatrix={},t.dtOptionsCustomerMatrix=a.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.customerId=e.customerId,JSON.stringify(t)},url:"api/customer-matrix",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){f()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,n,a){r(angular.element(e).contents())(t)}),t.dtColumnsCustomerMatrix=[i.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,n,a,i){var o="",r="";null==e.status||"Anulada"!=e.status&&"Cancelado"!=e.status||(r='disabled="disabled"');var c='<a class="btn btn-purple btn-xs configureRow lnk" href="#" uib-tooltip="Configurar Matriz"  data-id="'+e.id+'"'+r+' >   <i class="fa fa-gear"></i></a> ',l='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Continuar Gestión Matriz"  data-id="'+e.id+'"'+r+' >   <i class="fa fa-play-circle"></i></a> ',u='<a class="btn btn-blue btn-xs cancelRow lnk" href="#" uib-tooltip="Cancelar Matriz" data-id="'+e.id+'"'+r+' >   <i class="fa fa-ban"></i></a> ';return t.isAdmin&&s.can("diagnostico_cancel"),o+=c,s.can("diagnostico_continue"),o+=l,s.can("diagnostico_cancel"),o+=u}),i.newColumn("id").withTitle("Consecutivo").withOption("defaultContent",""),i.newColumn("description").withTitle("Descripción").withOption("defaultContent",""),i.newColumn("createdAt").withTitle("Fecha").withOption("width",200).withOption("defaultContent",""),i.newColumn("createdBy").withTitle("Usuario").withOption("width",200).withOption("defaultContent",""),i.newColumn(null).withTitle("Estado").withOption("width",200).withOption("defaultContent","").renderWith(function(t,e,n,a){var i="";switch(t.status){case"Creada":i="label label-success";break;case"Iniciada":i="label label-warning";break;case"Anulada":i="label label-danger"}return'<span class="'+i+'">'+t.status+"</span>"})];var f=function(){$("#dtCustomerMatrix a.configureRow").on("click",function(){var e=$(this).data("id");t.configureMatrix(e)}),$("#dtCustomerMatrix a.editRow").on("click",function(){var e=$(this).data("id");t.managementMatrix(e)}),$("#dtCustomerMatrix a.delRow").on("click",function(){var e=$(this).data("id");m.info("intenta eliminar el registro: "+e),p.swal({title:"Está seguro?",text:"Eliminará la gestión seleccionada.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(a){if(a){var i={};i.id=e,d({method:"POST",url:"api/customer/matrix/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){n.error(t),p.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){t.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})}),$("a.cancelRow").on("click",function(){var e=$(this).data("id");m.info("intenta cancelar el registro: "+e),p.swal({title:"Está seguro?",text:"Cancelar el diagnóstico seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, cancelar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(a){if(a){var i={};i.id=e,d({method:"POST",url:"api/customer/matrix/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(t){swal("Eliminado","Gestión cancelada satisfactoriamente","info")})["catch"](function(t){n.error(t),p.swal("Error en la cancelación","Se ha presentado un error durante la cancelacón la gestión por favor intentelo de nuevo","error")})["finally"](function(){t.reloadData()})}else swal("Terminado","Operación terminada","error")})})};t.reloadData=function(){t.dtInstanceCustomerMatrix.reloadData()},t.configureMatrix=function(e){null!=t.$parent&&t.$parent.navToSection("config","config",e)},t.managementMatrix=function(e){null!=t.$parent&&t.$parent.navToSection("edit","edit",e)},t.onCreate=function(){var a={},i={id:0,customerId:e.customerId,status:{id:0,item:"Creada",value:"Creada"},description:"Matriz de impactos ambientales",type:{id:0,item:"MAIA",value:"MAIA"}},o=JSON.stringify(i);a.data=Base64.encode(o),d({method:"POST",url:"api/customer/matrix/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(e){p.swal("Validación exitosa","Matriz creada satisfactoriamente","success"),t.reloadData()})["catch"](function(t){n.error(t),p.swal("Error Creando","Se ha presentado un error durante la creación de la gestión por favor intentelo de nuevo","error")})["finally"](function(){})}}]);
"use strict";app.controller("customerConfigWizardEditCtrl",["$scope","$location","$stateParams","$log","$compile","$state","SweetAlert","$rootScope","$http","$timeout","$uibModal","flowFactory","cfpLoadingBar","$filter",function(t,e,a,n,r,o,i,l,c,p,u,T,s,$){e.absUrl();"isa"==l.app.instance?(t.matrixTabLabel1="GRUPO OCUPACIONAL O INSTALACIÓN",t.matrixTabLabel2="SUBESTACIÓN",t.matrixTabLabel3="UBICACIÓN, SITIO O ÁREA",t.matrixTabLabel4="LABOR / TAREA"):(t.matrixTabLabel1="CENTROS DE TRABAJO",t.matrixTabLabel2="MACROPROCESOS",t.matrixTabLabel3="PROCESOS",t.matrixTabLabel4="ACTIVIDADES"),t.currentStep=0,t.form={next:function(e){if(t.toTheTop(),e.$valid)b();else{var a=null,n=null;for(a in e)"$"!=a[0]&&(null!==n||e[a].$valid||(n=e[a].$name),e[a].$pristine&&(e[a].$dirty=!0));angular.element(".ng-invalid[name="+n+"]").focus()}},prev:function(e){t.toTheTop(),S()},goTo:function(e,a){parseInt(t.currentStep)>parseInt(a)?(t.toTheTop(),f(a)):(t.toTheTop(),f(a))},reset:function(e){t.report=angular.copy(t.master),e.$setPristine(!0)}};var b=function(){t.currentStep++},S=function(){t.currentStep--},f=function(e){t.currentStep=e};t.onCancel=function(){null!=t.$parent&&t.$parent.navToSection("list","list",0)}}]);
"use strict";app.controller("customerMatrixConfigWizardTabSummaryCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$document",function(a,t,e,r,s,o,d,i,n,l,u,c,g,m){var p=e,f=a.$parent.currentId;p.info("loading..customerMatrixConfigWizardTabSummaryCtrl "),a.loading=!0,a.isView=!1,a.wizards=[],a.optionsPie={responsive:!1,segmentShowStroke:!0,segmentStrokeColor:"#fff",segmentStrokeWidth:2,percentageInnerCutout:0,animationSteps:100,animationEasing:"easeOutBounce",animateRotate:!0,animateScale:!1,legendTemplate:'<ul class="tc-chart-js-legend"><% for (var i=0; i<segments.length; i++){%><li><span style="background-color:<%=segments[i].fillColor%>"></span><%if(segments[i].label){%><%=segments[i].label%><%}%></li><%}%></ul>'};var w=function(){var t={};return t.operation="diagnostic",t.customerMatrixId=f,c({method:"POST",url:"api/customer/matrix/chart-list",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){u(function(){a.datasetwizardsData=[],a.datasetwizardsLabels=[],a.datasetwizardsValues=[],a.datasetwizardsColors=[];for(var e=0;e<t.data.data.length;e++){for(var r=0;r<t.data.data[e].data.length;r++)a.datasetwizardsLabels.push(t.data.data[e].data[r].label),a.datasetwizardsValues.push(t.data.data[e].data[r].value),a.datasetwizardsColors.push(t.data.data[e].data[r].color);a.datasetwizardsData.push({name:t.data.data[e].name,created:t.data.data[e].created,configured:t.data.data[e].configured,pending:t.data.data[e].pending,labels:a.datasetwizardsLabels,datasets:[{data:a.datasetwizardsValues,backgroundColor:a.datasetwizardsColors,hoverBackgroundColor:a.datasetwizardsColors}]}),a.datasetwizardsLabels=[],a.datasetwizardsValues=[],a.datasetwizardsColors=[]}console.log(a.datasetwizardsData),a.charts=a.datasetwizardsData})})["catch"](function(a){e.error(a),g.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};w(),a.onRefresh=function(){w()}}]);
"use strict";app.controller("customerMatrixConfigWizardTabProjectCtrl",["$scope","$stateParams","$log","$compile","$state","SweetAlert","$rootScope","$http","$timeout","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$uibModal","flowFactory","cfpLoadingBar","$filter","$aside","$document","FileUploader","$localStorage","toaster",function(e,t,n,o,r,i,a,c,l,s,d,u,f,m,p,w,g,h,v,C,j){var x=n,P={},b=e.$parent.currentId;e.isAgent="agent"==a.currentUser().wg_type,e.isAdmin="system"==a.currentUser().wg_type,e.isCustomer="customerAdmin"==a.currentUser().wg_type||"customerUser"==a.currentUser().wg_type,e.isView="view"==e.$parent.modeDsp,e.minDateCurrent=new Date,e.customerId=t.customerId,e.maxDate=new Date,e.datePickerConfig={culture:"es-CO",format:"dd/MM/yyyy HH:mm"},e.onLoadRecord=function(){if(0!=e.project.id){x.info("editando cliente con código: "+e.project.id);var t={id:e.project.id};c({method:"GET",url:"api/customer/matrix-project",params:t})["catch"](function(e,t){if(403==t){var n=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";i.swal("No Autorizado","No estas autorizado para ver esta información.","error"),l(function(){r.go(n)},3e3)}else 404==t?i.swal("Información no disponible","Centro de trabajo no encontrado","error"):i.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(t){l(function(){e.project=t.data.result,e.canShow=!0})})["finally"](function(){l(function(){e.loading=!1},400),l(function(){h.scrollTop(40,2e3)})})}else x.info("creacion de nuevo cliente"),e.loading=!1};var y=function(){e.project={id:0,customerMatrixId:b,name:null,isActive:!0}};y(),e.master=e.project,e.form={submit:function(t){var n=null;if(t.$invalid){var o=null,n=null;for(o in t)"$"!=o[0]&&(null!==n||t[o].$valid||(n=t[o].$name),t[o].$pristine&&(t[o].$dirty=!0));return x.info(e.customer),angular.element(".ng-invalid[name="+n+"]").focus(),void i.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}i.swal("Validación exitosa","Procediendo con el guardado...","success"),x.info(e.customer),O()},reset:function(t){e.project=angular.copy(e.master),t.$setPristine(!0)}};var O=function(){var t={},o=JSON.stringify(e.project);return t.data=Base64.encode(o),c({method:"POST",url:"api/customer/matrix-project/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){l(function(){e.project=t.data.result,e.canShow=!0,e.reloadData(),y()})})["catch"](function(e){n.error(e),i.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};e.cancelEdition=function(){null!=e.$parent&&e.$parent.navToSection("list","list")},P.customerMatrixId=b,e.dtInstanceMatrixConfigProject={},e.dtOptionsMatrixConfigProject=s.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:P,url:"api/customer/matrix-project",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){D()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,n,r){o(angular.element(t).contents())(e)}),e.dtColumnsMatrixConfigProject=[d.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,t,n,o){var r="",i=(null!=e.document?e.document.path:"",'<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+e.id+'" >   <i class="fa fa-edit"></i></a> '),c='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+e.id+'" >   <i class="fa fa-trash-o"></i></a> ';return a.can("seguimiento_edit")&&(r+=i),a.can("seguimiento_delete")&&(r+=c),r}),d.newColumn("name").withTitle("Proyecto").withOption("defaultContent",""),d.newColumn("isActive").withTitle("Activo").withOption("width",200).renderWith(function(e,t,n,o){var r="",i="";return e||"1"==e?(i="Si",r="label label-success"):(i="No",r="label label-danger"),'<span class="'+r+'">'+i+"</span>"})];var D=function(){$("#dtMatrixConfigProject a.editRow").on("click",function(){var t=$(this).data("id");e.editMatrixConfigProject(t)}),$("#dtMatrixConfigProject a.delRow").on("click",function(){var t=$(this).data("id");x.info("intenta eliminar el registro: "+t),i.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(o){if(o){var r={};r.id=t,c({method:"POST",url:"api/customer/matrix-project/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(r)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){n.error(e),i.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){e.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};e.reloadData=function(){e.dtInstanceMatrixConfigProject.reloadData()},e.editMatrixConfigProject=function(t){t&&(e.project.id=t,e.onLoadRecord())},e.clearMatrixConfigProject=function(){y()}}]);
"use strict";app.controller("customerMatrixConfigWizardTabActivityCtrl",["$scope","$stateParams","$log","$compile","$state","SweetAlert","$rootScope","$http","$timeout","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$uibModal","flowFactory","cfpLoadingBar","$filter","$aside","$document","FileUploader","$localStorage","toaster",function(t,i,e,n,a,o,r,c,l,s,d,u,f,m,p,w,v,g,h,y,C){var x=e,b={},O=t.$parent.currentId;t.isAgent="agent"==r.currentUser().wg_type,t.isAdmin="system"==r.currentUser().wg_type,t.isCustomer="customerAdmin"==r.currentUser().wg_type||"customerUser"==r.currentUser().wg_type,t.isView="view"==t.$parent.modeDsp,t.minDateCurrent=new Date,t.customerId=i.customerId,t.maxDate=new Date,t.datePickerConfig={culture:"es-CO",format:"dd/MM/yyyy HH:mm"},t.onLoadRecord=function(){if(0!=t.activity.id){x.info("editando cliente con código: "+t.activity.id);var i={id:t.activity.id};c({method:"GET",url:"api/customer/matrix-activity",params:i})["catch"](function(t,i){if(403==i){var e=null!==t.message&&void 0!==t.message?t.message:"app.clientes.list";o.swal("No Autorizado","No estas autorizado para ver esta información.","error"),l(function(){a.go(e)},3e3)}else 404==i?o.swal("Información no disponible","Centro de trabajo no encontrado","error"):o.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(i){l(function(){t.activity=i.data.result,t.canShow=!0})})["finally"](function(){l(function(){t.loading=!1},400),l(function(){g.scrollTop(40,2e3)})})}else x.info("creacion de nuevo cliente"),t.loading=!1};var A=function(){t.activity={id:0,customerMatrixId:O,name:null,isActive:!0}};A(),t.master=t.activity,t.form={submit:function(i){var e=null;if(i.$invalid){var n=null,e=null;for(n in i)"$"!=n[0]&&(null!==e||i[n].$valid||(e=i[n].$name),i[n].$pristine&&(i[n].$dirty=!0));return x.info(t.customer),angular.element(".ng-invalid[name="+e+"]").focus(),void o.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}o.swal("Validación exitosa","Procediendo con el guardado...","success"),x.info(t.customer),D()},reset:function(i){t.activity=angular.copy(t.master),i.$setPristine(!0)}};var D=function(){var i={},n=JSON.stringify(t.activity);return i.data=Base64.encode(n),c({method:"POST",url:"api/customer/matrix-activity/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(i){l(function(){t.activity=i.data.result,t.canShow=!0,t.reloadData(),A()})})["catch"](function(t){e.error(t),o.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};t.cancelEdition=function(){null!=t.$parent&&t.$parent.navToSection("list","list")},b.customerMatrixId=O,t.dtInstanceMatrixConfigActivity={},t.dtOptionsMatrixConfigActivity=s.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:b,url:"api/customer/matrix-activity",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){T()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(i,e,a){n(angular.element(i).contents())(t)}),t.dtColumnsMatrixConfigActivity=[d.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,i,e,n){var a="",o=(null!=t.document?t.document.path:"",'<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+t.id+'" >   <i class="fa fa-edit"></i></a> '),c='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+t.id+'" >   <i class="fa fa-trash-o"></i></a> ';return r.can("seguimiento_edit")&&(a+=o),r.can("seguimiento_delete")&&(a+=c),a}),d.newColumn("name").withTitle("Actividad").withOption("defaultContent",""),d.newColumn("isActive").withTitle("Activo").withOption("width",200).renderWith(function(t,i,e,n){var a="",o="";return t||"1"==t?(o="Si",a="label label-success"):(o="No",a="label label-danger"),'<span class="'+a+'">'+o+"</span>"})];var T=function(){$("#dtMatrixConfigActivity a.editRow").on("click",function(){var i=$(this).data("id");t.editMatrixConfigActivity(i)}),$("#dtMatrixConfigActivity a.delRow").on("click",function(){var i=$(this).data("id");x.info("intenta eliminar el registro: "+i),o.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(n){if(n){var a={};a.id=i,c({method:"POST",url:"api/customer/matrix-activity/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){e.error(t),o.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){t.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};t.reloadData=function(){t.dtInstanceMatrixConfigActivity.reloadData()},t.editMatrixConfigActivity=function(i){i&&(t.activity.id=i,t.onLoadRecord())},t.clearMatrixConfigActivity=function(){A()}}]);
"use strict";app.controller("customerMatrixConfigWizardTabImpactCtrl",["$scope","$stateParams","$log","$compile","$state","SweetAlert","$rootScope","$http","$timeout","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$uibModal","flowFactory","cfpLoadingBar","$filter","$aside","$document","FileUploader","$localStorage","toaster",function(t,e,n,a,i,o,r,c,l,s,d,u,m,p,f,w,g,h,v,C,x){var b=n,y={},O=t.$parent.currentId;t.isAgent="agent"==r.currentUser().wg_type,t.isAdmin="system"==r.currentUser().wg_type,t.isCustomer="customerAdmin"==r.currentUser().wg_type||"customerUser"==r.currentUser().wg_type,t.isView="view"==t.$parent.modeDsp,t.minDateCurrent=new Date,t.customerId=e.customerId,t.maxDate=new Date,t.datePickerConfig={culture:"es-CO",format:"dd/MM/yyyy HH:mm"},t.onLoadRecord=function(){if(0!=t.impact.id){b.info("editando cliente con código: "+t.impact.id);var e={id:t.impact.id};c({method:"GET",url:"api/customer/matrix-impact",params:e})["catch"](function(t,e){if(403==e){var n=null!==t.message&&void 0!==t.message?t.message:"app.clientes.list";o.swal("No Autorizado","No estas autorizado para ver esta información.","error"),l(function(){i.go(n)},3e3)}else 404==e?o.swal("Información no disponible","Centro de trabajo no encontrado","error"):o.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(e){l(function(){console.log(e),t.impact=e.data.result,t.canShow=!0})})["finally"](function(){l(function(){t.loading=!1},400),l(function(){h.scrollTop(40,2e3)})})}else b.info("creacion de nuevo cliente"),t.loading=!1};var I=function(){t.impact={id:0,customerMatrixId:O,name:null,isActive:!0}};I(),t.master=t.impact,t.form={submit:function(e){var n=null;if(e.$invalid){var a=null,n=null;for(a in e)"$"!=a[0]&&(null!==n||e[a].$valid||(n=e[a].$name),e[a].$pristine&&(e[a].$dirty=!0));return b.info(t.customer),angular.element(".ng-invalid[name="+n+"]").focus(),void o.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}o.swal("Validación exitosa","Procediendo con el guardado...","success"),b.info(t.customer),D()},reset:function(e){t.impact=angular.copy(t.master),e.$setPristine(!0)}};var D=function(){var e={},a=JSON.stringify(t.impact);return e.data=Base64.encode(a),c({method:"POST",url:"api/customer/matrix-impact/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){l(function(){t.impact=e.data.result,t.canShow=!0,t.reloadData(),I()})})["catch"](function(t){n.error(t),o.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};t.cancelEdition=function(){null!=t.$parent&&t.$parent.navToSection("list","list")},y.customerMatrixId=O,t.dtInstanceMatrixConfigImpact={},t.dtOptionsMatrixConfigImpact=s.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:y,url:"api/customer/matrix-impact",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){T()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,n,i){a(angular.element(e).contents())(t)}),t.dtColumnsMatrixConfigImpact=[d.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,e,n,a){var i="",o=(null!=t.document?t.document.path:"",'<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+t.id+'" >   <i class="fa fa-edit"></i></a> '),c='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+t.id+'" >   <i class="fa fa-trash-o"></i></a> ';return r.can("seguimiento_edit")&&(i+=o),r.can("seguimiento_delete")&&(i+=c),i}),d.newColumn("name").withTitle("Impacto Ambiental").withOption("defaultContent",""),d.newColumn("isActive").withTitle("Activo").withOption("width",200).renderWith(function(t,e,n,a){var i="",o="";return t||"1"==t?(o="Si",i="label label-success"):(o="No",i="label label-danger"),'<span class="'+i+'">'+o+"</span>"})];var T=function(){$("#dtMatrixConfigImpact a.editRow").on("click",function(){var e=$(this).data("id");t.editMatrixConfigImpact(e)}),$("#dtMatrixConfigImpact a.delRow").on("click",function(){var e=$(this).data("id");b.info("intenta eliminar el registro: "+e),o.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(a){if(a){var i={};i.id=e,c({method:"POST",url:"api/customer/matrix-impact/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){n.error(t),o.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){t.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};t.reloadData=function(){t.dtInstanceMatrixConfigImpact.reloadData()},t.editMatrixConfigImpact=function(e){e&&(t.impact.id=e,t.onLoadRecord())},t.clearMatrixConfigImpact=function(){I()}}]);
"use strict";app.controller("customerMatrixConfigWizardTabAspectCtrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout",function(t,o,e,c,i,r){var n=e;n.info("loading..customerMatrixConfigWizardTabAspectCtrl!!! "),t.aspect_section="list",t.currentId=0,t.modeDsp="edit",t.navToSection=function(o,e,c){r(function(){t.aspect_section=o,t.modeDsp=e,t.currentId=c})}}]);
"use strict";app.controller("customerMatrixConfigWizardTabAspectEditCtrl",["$scope","$stateParams","$log","$compile","$state","SweetAlert","$rootScope","$http","$timeout","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$uibModal","flowFactory","cfpLoadingBar","$filter","$aside","$document","FileUploader","$localStorage","toaster",function(e,a,t,r,n,o,i,c,s,l,d,u,p,m,f,g,v,w,h,y,C){var T=t,x=e.$parent.currentId,E=e.$parent.$parent.$parent.$parent.$parent.$parent.$parent.$parent.currentId;console.log(e.$parent),console.log(E),e.isRecordLoaded=!1,e.isAgent="agent"==i.currentUser().wg_type,e.isAdmin="system"==i.currentUser().wg_type,e.isCustomer="customerAdmin"==i.currentUser().wg_type||"customerUser"==i.currentUser().wg_type,e.impactList=[],e.isView="view"==e.$parent.modeDsp,e.minDateCurrent=new Date,e.maxDate=new Date,e.datePickerConfig={culture:"es-CO",format:"dd/MM/yyyy HH:mm"},e.onLoadRecord=function(){if(0!=e.aspect.id){T.info("editando cliente con código: "+e.aspect.id);var a={id:e.aspect.id};c({method:"GET",url:"api/customer/matrix-aspect",params:a})["catch"](function(e,a){if(403==a){var t=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";o.swal("No Autorizado","No estas autorizado para ver esta información.","error"),s(function(){n.go(t)},3e3)}else 404==a?o.swal("Información no disponible","Centro de trabajo no encontrado","error"):o.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(a){s(function(){e.aspect=a.data.result,null!=e.aspect.impacts&&0!=e.aspect.impacts.length||(e.aspect.impacts=[{id:0,impact:null}]),e.isRecordLoaded=!0})})["finally"](function(){s(function(){e.loading=!1},400),s(function(){w.scrollTop(40,2e3)})})}else T.info("creacion de nuevo cliente"),e.loading=!1};var S=function(){e.aspect={id:x,customerMatrixId:E,name:null,isActive:!0,impacts:[{id:0,impact:null}]}},D=function(){var a={};return a.operation="diagnostic",a.customerMatrixId=E,c({method:"POST",url:"api/customer/matrix-impact/list",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(a){console.log(a),s(function(){e.impactList=a.data.data})})["catch"](function(e){t.error(e),o.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};S(),D(),e.onLoadRecord(),e.master=e.aspect,e.form={submit:function(e){var a=null;if(e.$invalid){var t=null,a=null;for(t in e)"$"!=t[0]&&(null!==a||e[t].$valid||(a=e[t].$name),e[t].$pristine&&(e[t].$dirty=!0));return angular.element(".ng-invalid[name="+a+"]").focus(),void o.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}o.swal("Validación exitosa","Procediendo con el guardado...","success"),P()},reset:function(a){e.aspect=angular.copy(e.master),a.$setPristine(!0)}};var P=function(){var a={},r=JSON.stringify(e.aspect);return a.data=Base64.encode(r),c({method:"POST",url:"api/customer/matrix-aspect/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(a){s(function(){e.aspect=a.data.result})})["catch"](function(e){t.error(e),o.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){e.$parent.navToSection("list","list")})};e.cancelEdition=function(){null!=e.$parent&&e.$parent.navToSection("list","list")},e.onAddImpact=function(){s(function(){null==e.aspect.impacts&&(e.aspect.impacts=[]),e.aspect.impacts.push({id:0,impact:null})})},e.onRemoveImpact=function(a){o.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(r){r?s(function(){var r=e.aspect.impacts[a];if(e.aspect.impacts.splice(a,1),0!=r.id){var n={};n.id=r.id,c({method:"POST",url:"api/customer/matrix-aspect-impact/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){t.error(e),o.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})},e.onRefreshImpact=function(){D()}}]);
"use strict";app.controller("customerMatrixConfigWizardTabAspectListCtrl",["$scope","$stateParams","$log","$compile","$state","SweetAlert","$rootScope","$http","$timeout","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$uibModal","flowFactory","cfpLoadingBar","$filter","$aside","$document","FileUploader","$localStorage","toaster",function(t,e,n,i,a,r,o,c,l,s,d,u,p,f,m,w,h,g,C,b,x){var O=n;t.$parent.$parent.$parent.currentId;t.isAgent="agent"==o.currentUser().wg_type,t.isAdmin="system"==o.currentUser().wg_type,t.isCustomer="customerAdmin"==o.currentUser().wg_type||"customerUser"==o.currentUser().wg_type,t.isView="view"==t.$parent.modeDsp,t.minDateCurrent=new Date,t.customerId=e.customerId;var v=t.$parent.$parent.$parent.$parent.$parent.$parent.$parent.$parent.currentId;t.dtInstanceMatrixConfigAspect={},t.dtOptionsMatrixConfigAspect=s.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.customerMatrixId=v,t},url:"api/customer/matrix-aspect",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){A()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,n,a){i(angular.element(e).contents())(t)}),t.dtColumnsMatrixConfigAspect=[d.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,e,n,i){var a="",r=(null!=t.document?t.document.path:"",'<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+t.id+'" >   <i class="fa fa-edit"></i></a> '),c='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+t.id+'" >   <i class="fa fa-trash-o"></i></a> ';return o.can("seguimiento_edit")&&(a+=r),o.can("seguimiento_delete")&&(a+=c),a}),d.newColumn("name").withTitle("Aspecto").withOption("defaultContent",""),d.newColumn("isActive").withTitle("Activo").withOption("width",200).renderWith(function(t,e,n,i){var a="",r="";return t||"1"==t?(r="Si",a="label label-success"):(r="No",a="label label-danger"),'<span class="'+a+'">'+r+"</span>"})],t.dtInstanceMatrixConfigAspectCallback=function(e){t.dtInstanceMatrixConfigAspect=e};var A=function(){$("#dtMatrixConfigAspect a.editRow").on("click",function(){var e=$(this).data("id");t.onEditRecord(e)}),$("#dtMatrixConfigAspect a.delRow").on("click",function(){var e=$(this).data("id");O.info("intenta eliminar el registro: "+e),r.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(i){if(i){var a={};a.id=e,c({method:"POST",url:"api/customer/matrix-aspect/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){n.error(t),r.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){t.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};t.reloadData=function(){t.dtInstanceMatrixConfigAspect.reloadData()},t.onCreate=function(){null!=t.$parent&&t.$parent.navToSection("form","edit",0)},t.onEditRecord=function(e){null!=t.$parent&&t.$parent.navToSection("form","edit",e)}}]);
"use strict";app.controller("customerMatrixDataTabCtrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout",function(t,o,r,a,e,i){var c=r;c.info("loading..customerMatrixDataTabCtrl!!! "),t.matrix_section="list",t.currentId=0,t.modeDsp="edit",t.navToSection=function(o,r,a){i(function(){t.matrix_section=o,t.modeDsp=r,t.currentId=a})}}]);
"use strict";app.controller("customerMatrixDataTabListCtrl",["$scope","$stateParams","$log","$compile","$state","SweetAlert","$rootScope","$http","$timeout","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$uibModal","flowFactory","cfpLoadingBar","$filter","$aside","$document","FileUploader","$localStorage","toaster",function(t,n,i,e,o,a,l,w,r,p,h,d,u,c,m,C,s,O,f,T,g){var I=t.$parent.$parent.$parent.$parent.currentId;t.isAgent="agent"==l.currentUser().wg_type,t.isAdmin="system"==l.currentUser().wg_type,t.isCustomer="customerAdmin"==l.currentUser().wg_type||"customerUser"==l.currentUser().wg_type,t.isView="view"==t.$parent.modeDsp,t.minDateCurrent=new Date,t.customerId=n.customerId,t.dtInstanceMatrixData={},t.dtOptionsMatrixData=p.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.customerMatrixId=I,JSON.stringify(t)},url:"api/customer-matrix-data",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){b()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(n,i,o){e(angular.element(n).contents())(t)}),t.dtColumnsMatrixData=[h.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,n,i,e){var o="",a=(null!=t.document?t.document.path:"",'<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+t.id+'" >   <i class="fa fa-edit"></i></a> ');'<a class="btn btn-dark-orange btn-xs delRow lnk" href="#" uib-tooltip="Plan de acción" data-id="'+t.id+'" >   <i class="fa fa-plus-square"></i></a> ';return l.can("seguimiento_edit")&&(o+=a),l.can("seguimiento_delete"),o}),h.newColumn("project").withTitle("Proyecto").withOption("width",200).withOption("defaultContent",""),h.newColumn("activity").withTitle("Actividad").withOption("width",200).withOption("defaultContent",""),h.newColumn("aspect").withTitle("Aspecto Ambiental").withOption("width",200).withOption("defaultContent",""),h.newColumn("impact").withTitle("Impacto Ambiental").withOption("width",200).withOption("defaultContent",""),h.newColumn("environmentalImpactIn").withTitle("Impacto Ambiental In").withOption("width",200).withOption("defaultContent",""),h.newColumn("environmentalImpactEx").withTitle("Impacto Ambiental Ex").withOption("width",200).withOption("defaultContent",""),h.newColumn("environmentalImpactPr").withTitle("Impacto Ambiental Pr").withOption("width",200).withOption("defaultContent",""),h.newColumn("environmentalImpactRe").withTitle("Impacto Ambiental Re").withOption("width",200).withOption("defaultContent",""),h.newColumn("environmentalImpactRv").withTitle("Impacto Ambiental Rv").withOption("width",200).withOption("defaultContent",""),h.newColumn("environmentalImpactSe").withTitle("Impacto Ambiental Se").withOption("width",200).withOption("defaultContent",""),h.newColumn("environmentalImpactFr").withTitle("Impacto Ambiental Fr").withOption("width",200).withOption("defaultContent",""),h.newColumn(null).withTitle("NIA").withOption("width",200).renderWith(function(t,n,i,e){var o="",a=parseFloat(t.nia);return o=a>=9&&a<=18?"label label-info":a>=19&&a<=28?"label label-warning":a>=29&&a<=36?"label label-danger":"",'<span class="'+o+'">'+a+"</span>"}),h.newColumn("legalImpactE").withTitle("Legal E").withOption("width",200).withOption("defaultContent",""),h.newColumn("legalImpactC").withTitle("Legal C").withOption("width",200).withOption("defaultContent",""),h.newColumn("legalImpactCriterion").withTitle("Criterio Legal CL").withOption("width",200).withOption("defaultContent",""),h.newColumn("interestedPartAc").withTitle("Partes Interesadas Ac").withOption("width",200).withOption("defaultContent",""),h.newColumn("interestedPartGe").withTitle("Partes Interesadas Ge").withOption("width",200).withOption("defaultContent",""),h.newColumn("interestedPartCriterion").withTitle("Criterio Part INT CPI").withOption("width",200).withOption("defaultContent",""),h.newColumn("totalAspect").withTitle("Significancia Total Aspecto").withOption("width",200).withOption("defaultContent",""),h.newColumn(null).withTitle("Significancia Total Aspecto").withOption("width",200).renderWith(function(t,n,i,e){var o="",a=parseFloat(t.totalAspect);return o=a>=13&&a<=26?"label label-info":a>=27&&a<=39?"label label-warning":a>=40?"label label-danger":"",'<span class="'+o+'">'+a+"</span>"}),h.newColumn("nature").withTitle("Naturaleza").withOption("width",200).withOption("defaultContent",""),h.newColumn("emergencyConditionIn").withTitle("Cond Emerg. In").withOption("width",200).withOption("defaultContent",""),h.newColumn("emergencyConditionEx").withTitle("Cond Emerg. Ex").withOption("width",200).withOption("defaultContent",""),h.newColumn("emergencyConditionPr").withTitle("Cond Emerg. Pr").withOption("width",200).withOption("defaultContent",""),h.newColumn("emergencyConditionRe").withTitle("Cond Emerg. Re").withOption("width",200).withOption("defaultContent",""),h.newColumn("emergencyConditionRv").withTitle("Cond Emerg. Rv").withOption("width",200).withOption("defaultContent",""),h.newColumn("emergencyConditionSe").withTitle("Cond Emerg. Se").withOption("width",200).withOption("defaultContent",""),h.newColumn("emergencyConditionFr").withTitle("Cond Emerg. Fr").withOption("width",200).withOption("defaultContent",""),h.newColumn(null).withTitle("NIA Emerg").withOption("width",200).renderWith(function(t,n,i,e){var o="",a=parseFloat(t.emergencyNia);return o=a>=9&&a<=18?"label label-info":a>=19&&a<=28?"label label-warning":a>=29&&a<=36?"label label-danger":"",'<span class="'+o+'">'+a+"</span>"}),h.newColumn("controlTypeE").withTitle("ELIMINACIÓN").withOption("width",200).withOption("defaultContent",""),h.newColumn("controlTypeS").withTitle("SUSTITUCIÓN").withOption("width",200).withOption("defaultContent",""),h.newColumn("controlTypeCI").withTitle("CONTROL DE INGENIERIA").withOption("width",200).withOption("defaultContent",""),h.newColumn("controlTypeCA").withTitle("CONTROLES ADMINISTRATIVOS").withOption("width",200).withOption("defaultContent",""),h.newColumn("controlTypeSL").withTitle("SEÑALIZACIÓN").withOption("width",200).withOption("defaultContent",""),h.newColumn("controlTypeEPP").withTitle("ELEMENTOS DE PROTECCIÓN PERSONAL").withOption("width",200).withOption("defaultContent",""),h.newColumn("associateProgram").withTitle("Programa Asociado").withOption("width",200).withOption("defaultContent",""),h.newColumn("registry").withTitle("Registro").withOption("width",200).withOption("defaultContent",""),h.newColumn("responsible").withTitle("Responsables").withOption("width",200).withOption("defaultContent","")],t.dtInstanceMatrixDataCallback=function(n){t.dtInstanceMatrixData=n};var b=function(){$("#dtMatrixData a.editRow").on("click",function(){var n=$(this).data("id");t.onEditRecord(n)}),$("#dtMatrixData a.delRow").on("click",function(){})};t.reloadData=function(){t.dtInstanceMatrixData.reloadData()},t.onCreate=function(){null!=t.$parent&&t.$parent.navToSection("form","edit",0)},t.onEditRecord=function(n){null!=t.$parent&&t.$parent.navToSection("form","edit",n)},t.onCancel=function(n){console.log(t.$parent),null!=t.$parent&&t.$parent.$parent.$parent.$parent.$parent.navToSection("list","list",0)}}]);
"use strict";app.controller("customerMatrixDataTabEditCtrl",["$scope","$stateParams","$log","$compile","$state","SweetAlert","$rootScope","$http","$timeout","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$uibModal","flowFactory","cfpLoadingBar","$filter","$aside","$document","FileUploader","$localStorage","toaster",function(e,t,a,n,r,i,o,m,c,l,s,p,u,d,x,v,f,g,y,I,C){var _=a,w=e.$parent.$parent.$parent.currentId,L=e.$parent.$parent.$parent.$parent.currentId;console.log(e.$parent),e.isAgent="agent"==o.currentUser().wg_type,e.isAdmin="system"==o.currentUser().wg_type,e.isCustomer="customerAdmin"==o.currentUser().wg_type||"customerUser"==o.currentUser().wg_type,e.environmentalImpactInList=o.parameters("matrix_environmental_impact_in"),e.environmentalImpactExList=o.parameters("matrix_environmental_impact_ex"),e.environmentalImpactPrList=o.parameters("matrix_environmental_impact_pr"),e.environmentalImpactReList=o.parameters("matrix_environmental_impact_re"),e.environmentalImpactRvList=o.parameters("matrix_environmental_impact_rv"),e.environmentalImpactSeList=o.parameters("matrix_environmental_impact_se"),e.environmentalImpactFrList=o.parameters("matrix_environmental_impact_fr"),e.legalImpactEList=o.parameters("matrix_legal_impact_e"),e.legalImpactCList=o.parameters("matrix_legal_impact_c"),e.interestedPartAcList=o.parameters("matrix_interested_part_ac"),e.interestedPartGeList=o.parameters("matrix_interested_part_ge"),e.natureList=o.parameters("matrix_nature"),e.emergencyConditionInList=o.parameters("matrix_environmental_impact_in"),e.emergencyConditionExList=o.parameters("matrix_environmental_impact_ex"),e.emergencyConditionPrList=o.parameters("matrix_environmental_impact_pr"),e.emergencyConditionReList=o.parameters("matrix_environmental_impact_re"),e.emergencyConditionRvList=o.parameters("matrix_environmental_impact_rv"),e.emergencyConditionSeList=o.parameters("matrix_environmental_impact_se"),e.emergencyConditionFrList=o.parameters("matrix_environmental_impact_fr"),e.typeList=o.parameters("matrix_control_type"),e.responsibleList=o.parameters("matrix_responsible"),e.scopeList=o.parameters("matrix_scope"),e.projectList=[],e.activityList=[],e.environmentalAspectList=[],e.environmentalImpactList=[],e.isView="view"==e.$parent.modeDsp,e.minDateCurrent=new Date,e.maxDate=new Date,e.datePickerConfig={culture:"es-CO",format:"dd/MM/yyyy HH:mm"},e.onLoadRecord=function(){if(0!=e.matrix.id){_.info("editando cliente con código: "+e.matrix.id);var t={id:e.matrix.id};m({method:"GET",url:"api/customer/matrix-data",params:t})["catch"](function(e,t){if(403==t){var a=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";i.swal("No Autorizado","No estas autorizado para ver esta información.","error"),c(function(){r.go(a)},3e3)}else 404==t?i.swal("Información no disponible","Centro de trabajo no encontrado","error"):i.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(t){c(function(){e.matrix=t.data.result})})["finally"](function(){c(function(){e.loading=!1},400),c(function(){g.scrollTop(40,2e3)})})}else _.info("creacion de nuevo cliente"),e.loading=!1};var h=function(){e.matrix={id:w,customerMatrixId:L,project:null,activity:null,environmentalAspect:null,environmentalImpact:null,environmentalImpactIn:null,environmentalImpactEx:null,environmentalImpactPr:null,environmentalImpactRe:null,environmentalImpactRv:null,environmentalImpactSe:null,environmentalImpactFr:null,nia:0,niaDescription:"",legalImpactE:null,legalImpactC:null,legalImpactCriterion:null,interestedPartAc:null,interestedPartGe:null,interestedPartCriterion:null,totalAspect:0,totalAspectDescription:"",nature:null,emergencyConditionIn:null,emergencyConditionEx:null,emergencyConditionPr:null,emergencyConditionRe:null,emergencyConditionRv:null,emergencyConditionSe:null,emergencyConditionFr:null,emergencyNia:0,emergencyNiaDescription:"",controlList:[],responsibleList:[],associateProgram:"",scope:""}},P=function(){var t={};return t.operation="diagnostic",t.customerMatrixId=L,console.log(L),m({method:"POST",url:"api/customer/matrix-data/list",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){c(function(){e.projectList=t.data.data.projectList,e.activityList=t.data.data.activityList,e.environmentalAspectList=t.data.data.aspectList})})["catch"](function(e){a.error(e),i.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};e.refreshProject=function(){P()};h(),P(),e.onLoadRecord(),e.master=e.matrix,e.form={submit:function(e){var t=null;if(e.$invalid){var a=null,t=null;for(a in e)"$"!=a[0]&&(null!==t||e[a].$valid||(t=e[a].$name),e[a].$pristine&&(e[a].$dirty=!0));return angular.element(".ng-invalid[name="+t+"]").focus(),void i.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}i.swal("Validación exitosa","Procediendo con el guardado...","success"),E()},reset:function(t){e.matrix=angular.copy(e.master),t.$setPristine(!0)}};var E=function(){var t={},n=JSON.stringify(e.matrix);return t.data=Base64.encode(n),m({method:"POST",url:"api/customer/matrix-data/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){c(function(){e.matrix=t.data.result})})["catch"](function(e){a.error(e),i.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};e.cancelEdition=function(){null!=e.$parent&&e.$parent.navToSection("list","list")},e.onAddControlType=function(){c(function(){null==e.matrix.controlList&&(e.matrix.controlList=[]),e.matrix.controlList.push({id:0,type:null,description:""})})},e.onRemoveControlType=function(t){i.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(n){n?c(function(){var n=e.matrix.controlList[t];if(e.matrix.controlList.splice(t,1),0!=n.id){var r={};r.id=n.id,m({method:"POST",url:"api/customer/matrix-data-control/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(r)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){a.error(e),i.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})},e.onAddResponsible=function(){c(function(){null==e.matrix.responsibleList&&(e.matrix.responsibleList=[]),e.matrix.responsibleList.push({id:0,responsible:null})})},e.onRemoveImpact=function(t){i.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(n){n?c(function(){var n=e.matrix.responsibleList[t];if(e.matrix.responsibleList.splice(t,1),0!=n.id){var r={};r.id=n.id,m({method:"POST",url:"api/customer/matrix-data-responsible/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(r)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){a.error(e),i.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})},e.onRefreshImpact=function(){P()},e.$watch("matrix.environmentalAspect",function(t,a,n){e.environmentalImpactList=[],null==a||angular.equals(t,a)||(e.matrix.environmentalImpact=null),null!=e.matrix.environmentalAspect&&angular.forEach(e.matrix.environmentalAspect.impacts,function(t,a){e.environmentalImpactList.push(t.impact)})}),e.$watch("matrix.environmentalImpactIn",function(){A()}),e.$watch("matrix.environmentalImpactEx",function(){A()}),e.$watch("matrix.environmentalImpactPr",function(){A()}),e.$watch("matrix.environmentalImpactRe",function(){A()}),e.$watch("matrix.environmentalImpactRv",function(){A()}),e.$watch("matrix.environmentalImpactSe",function(){A()}),e.$watch("matrix.environmentalImpactFr",function(){A()}),e.$watch("matrix.legalImpactE",function(){F()}),e.$watch("matrix.legalImpactC",function(){F()}),e.$watch("matrix.interestedPartAc",function(){D()}),e.$watch("matrix.interestedPartGe",function(){D()}),e.$watch("matrix.emergencyConditionIn",function(){S()}),e.$watch("matrix.emergencyConditionEx",function(){S()}),e.$watch("matrix.emergencyConditionPr",function(){S()}),e.$watch("matrix.emergencyConditionRe",function(){S()}),e.$watch("matrix.emergencyConditionRv",function(){S()}),e.$watch("matrix.emergencyConditionSe",function(){S()}),e.$watch("matrix.emergencyConditionFr",function(){S()});var A=function(){var t=e.matrix.environmentalImpactIn?parseFloat(e.matrix.environmentalImpactIn.value):0,a=e.matrix.environmentalImpactEx?parseFloat(e.matrix.environmentalImpactEx.value):0,n=e.matrix.environmentalImpactPr?parseFloat(e.matrix.environmentalImpactPr.value):0,r=e.matrix.environmentalImpactRe?parseFloat(e.matrix.environmentalImpactRe.value):0,i=e.matrix.environmentalImpactRv?parseFloat(e.matrix.environmentalImpactRv.value):0,o=e.matrix.environmentalImpactSe?parseFloat(e.matrix.environmentalImpactSe.value):0,m=e.matrix.environmentalImpactFr?parseFloat(e.matrix.environmentalImpactFr.value):0;e.matrix.nia=3*t+2*a+n+r+i+o+m,e.matrix.nia>=9&&e.matrix.nia<=18?e.matrix.niaDescription="BAJO":e.matrix.nia>=19&&e.matrix.nia<=28?e.matrix.niaDescription="MEDIO":e.matrix.nia>=29&&e.matrix.nia<=36?e.matrix.niaDescription="ALTO":e.matrix.niaDescription=""},F=function(){var t=e.matrix.legalImpactE?parseFloat(e.matrix.legalImpactE.value):0,a=e.matrix.legalImpactC?parseFloat(e.matrix.legalImpactC.value):0;e.matrix.legalImpactCriterion=t+a,R()},D=function(){var t=e.matrix.interestedPartAc?parseFloat(e.matrix.interestedPartAc.value):0,a=e.matrix.interestedPartGe?parseFloat(e.matrix.interestedPartGe.value):0;e.matrix.interestedPartCriterion=t+a,R()},R=function(){var t=e.matrix.nia?parseFloat(e.matrix.nia):0,a=e.matrix.legalImpactCriterion?parseFloat(e.matrix.legalImpactCriterion):0,n=e.matrix.interestedPartCriterion?parseFloat(e.matrix.interestedPartCriterion):0;e.matrix.totalAspect=t+a+n,e.matrix.totalAspect>=13&&e.matrix.totalAspect<=26?e.matrix.totalAspectDescription="BAJO":e.matrix.totalAspect>=27&&e.matrix.totalAspect<=39?e.matrix.totalAspectDescription="MEDIO":e.matrix.totalAspect>=40?e.matrix.totalAspectDescription="ALTO":e.matrix.emergencyNiaDescription=""},S=function(){var t=e.matrix.emergencyConditionIn?parseFloat(e.matrix.emergencyConditionIn.value):0,a=e.matrix.emergencyConditionEx?parseFloat(e.matrix.emergencyConditionEx.value):0,n=e.matrix.emergencyConditionPr?parseFloat(e.matrix.emergencyConditionPr.value):0,r=e.matrix.emergencyConditionRe?parseFloat(e.matrix.emergencyConditionRe.value):0,i=e.matrix.emergencyConditionRv?parseFloat(e.matrix.emergencyConditionRv.value):0,o=e.matrix.emergencyConditionSe?parseFloat(e.matrix.emergencyConditionSe.value):0,m=e.matrix.emergencyConditionFr?parseFloat(e.matrix.emergencyConditionFr.value):0;e.matrix.emergencyNia=3*t+2*a+n+r+i+o+m,e.matrix.emergencyNia>=9&&e.matrix.emergencyNia<=18?e.matrix.emergencyNiaDescription="BAJO":e.matrix.emergencyNia>=19&&e.matrix.emergencyNia<=28?e.matrix.emergencyNiaDescription="MEDIO":e.matrix.emergencyNia>=29&&e.matrix.emergencyNia<=36?e.matrix.emergencyNiaDescription="ALTO":e.matrix.emergencyNiaDescription=""}}]);
"use strict";app.controller("customerUnsafeActCtrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout",function(t,o,c,n,i,e){var r=c;r.info("loading..customerUnsafeActCtrl!!! "),t.matrix_section="list",t.action="list",t.currentId=0,t.navToSection=function(o,c,n){e(function(){t.matrix_section=o,t.action=c,t.$parent.switchSubTab(c),t.currentId=n})}}]);
"use strict";app.filter("nl2br",["$sce",function(e){return function(t,n){var n=n||!0,a=n?"<br />":"<br>",t=(t+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1"+a+"$2");return e.trustAsHtml(t)}}]),app.controller("customerUnsafeActListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$aside",function(e,t,n,a,i,o,r,l,s,c,d,u,m,p){var f=n;f.info("loading..customerUnsafeActListCtrl "),e.isAgent="agent"==c.currentUser().wg_type,e.isAdmin="system"==c.currentUser().wg_type,e.isCustomer="customerAdmin"==c.currentUser().wg_type||"customerUser"==c.currentUser().wg_type,e.isCustomerAdmin="customerAdmin"==c.currentUser().wg_type,e.mustFilterByReportedAssigned=!e.isAdmin&&!e.isCustomerAdmin,e.filter={reportedAssigned:e.mustFilterByReportedAssigned?"A":null},e.isView=!1,e.dtInstanceCustomerUnsafeAct={},e.dtOptionsCustomerUnsafeAct=a.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(n){return n.customerId=t.customerId,e.mustFilterByReportedAssigned&&("A"==e.filter.reportedAssigned?n.assignedToId=!0:"R"==e.filter.reportedAssigned&&(n.reportedById=!0)),JSON.stringify(n)},url:"api/customer-unsafe-act",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){g()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,n,a){r(angular.element(t).contents())(e)}),e.dtColumnsCustomerUnsafeAct=[i.newColumn(null).withTitle("Acciones").withOption("width",180).notSortable().renderWith(function(e,t,n,a){var i="",o="";null==e.status||"Completado"!=e.status&&"Cancelado"!=e.status||(o="disabled");var r='<a class="btn btn-primary btn-xs editRow lnk '+o+'" href="#" uib-tooltip="Editar"  data-id="'+e.id+'"'+o+' >   <i class="fa fa-edit"></i></a> ',l='<a class="btn btn-info btn-xs viewRow lnk" href="#" uib-tooltip="Ver" data-id="'+e.id+'">   <i class="fa fa-eye"></i></a> ',s='<a class="btn btn-danger btn-xs deleteRow lnk '+o+'" href="#" uib-tooltip="Eliminar" data-id="'+e.id+'"'+o+' >   <i class="fa fa-trash"></i></a> ',c=' | <a class="btn btn-orange btn-xs improvementPlanRow lnk '+o+'" href="#" uib-tooltip="Plan Mejoramiento" data-id="'+e.id+'"'+o+' >   <i class="fa fa-plus-square"></i></a> ',d=' | <a class="btn btn-success btn-xs downloadRow lnk" href="#" uib-tooltip="Descargar Evidencias" data-id="'+e.id+'">   <i class="fa fa-download"></i></a> ';return i+=l,i+=r,i+=s,i+=c,1==e.hasImage&&(i+=d),i}),i.newColumn("dateOf").withTitle("Fecha").withOption("width",200).withOption("defaultContent",""),i.newColumn("work_place").withTitle("Centro de Trabajo").withOption("defaultContent",""),i.newColumn("risk_type").withTitle("Tipo de Peligro").withOption("width",200).withOption("defaultContent",""),i.newColumn("place").withTitle("Lugar").withOption("width",200).withOption("defaultContent",""),i.newColumn("description").withTitle("Descripción de la Condición Insegura").withOption("defaultContent",""),i.newColumn("assignedTo").withTitle("Asignado A").withOption("defaultContent",""),i.newColumn("reportedBy").withTitle("Reportado Por").withOption("defaultContent",""),i.newColumn(null).withTitle("Estado").withOption("width",200).withOption("defaultContent","").renderWith(function(e,t,n,a){var i="";switch(e.status){case"Creado":i="label label-success";break;case"Revisado":i="label label-warning";break;case"Completado":i="label label-info";break;case"Cancelado":i="label label-danger"}return'<span class="'+i+'">'+e.status+"</span>"})];var g=function(){angular.element("#dtCustomerUnsafeAct a.editRow").on("click",function(){var t=angular.element(this).data("id");e.isView=!1,e.onEdit(t)}),angular.element("#dtCustomerUnsafeAct a.viewRow").on("click",function(){var t=angular.element(this).data("id");e.isView=!0,e.onView(t)}),angular.element("#dtCustomerUnsafeAct a.improvementPlanRow").on("click",function(){var t=angular.element(this).data("id");e.onAddImprovementPlan(t)}),angular.element("#dtCustomerUnsafeAct a.downloadRow").on("click",function(){var e=angular.element(this).data("id");w({id:e})}),angular.element("#dtCustomerUnsafeAct a.imageRow").on("click",function(){var t=(angular.element(this).data("id"),angular.element(this).data("url"));e.openLightboxModal([t])}),angular.element("#dtCustomerUnsafeAct a.deleteRow").on("click",function(){var t=angular.element(this).data("id");f.info("intenta eliminar el registro: "+t),m.swal({title:"Está seguro?",text:"Eliminará la gestión seleccionada.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(a){if(a){var i={};i.id=t,u({method:"POST",url:"api/customer/unsafe-act/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){n.error(e),m.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){e.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};e.dtInstanceCustomerUnsafeActCallback=function(t){e.dtInstanceCustomerUnsafeAct=t},e.reloadData=function(){e.dtInstanceCustomerUnsafeAct.reloadData()},e.onCreate=function(){e.isView=!1,e.onEdit(0)},e.onReport=function(){null!=e.$parent&&e.$parent.navToSection("indicator","indicator",0)},e.onEdit=function(t){null!=e.$parent&&e.$parent.navToSection("form","edit",t)};var w=function(e){angular.element("#download")[0].src="api/customer-unsafe-act/export-zip?data="+Base64.encode(JSON.stringify(e))};e.onView=function(t){null!=e.$parent&&e.$parent.navToSection("form","view",t)},e.onExportPdf=function(){d(function(){kendo.drawing.drawDOM(angular.element(".unsafe-act-export-pdf")).then(function(e){return kendo.drawing.exportPDF(e,{paperSize:"auto",margin:{left:"1cm",top:"1cm",right:"1cm",bottom:"1cm"}})}).done(function(e){kendo.saveAs({dataURI:e,fileName:"Condiciones_Inseguras.pdf",proxyURL:"//demos.telerik.com/kendo-ui/service/export"})})},200)},e.onExportExcel=function(){var n={customerId:t.customerId};e.mustFilterByReportedAssigned&&("A"==e.filter.reportedAssigned?n.assignedToId=!0:"R"==e.filter.reportedAssigned&&(n.reportedById=!0)),angular.element("#download")[0].src="api/customer-unsafe-act/export-excel?data="+Base64.encode(JSON.stringify(n))},e.onExportReport=function(){var n={customerId:t.customerId};e.mustFilterByReportedAssigned&&("A"==e.filter.reportedAssigned?n.assignedToId=!0:"R"==e.filter.reportedAssigned&&(n.reportedById=!0)),angular.element("#download")[0].src="api/customer-unsafe-act/export-report?data="+Base64.encode(JSON.stringify(n))},e.onMassiveDownload=function(){var n={customerId:t.customerId,mustFilterByReportedAssigned:e.mustFilterByReportedAssigned,reportedAssigned:e.filter.reportedAssigned};e.mustFilterByReportedAssigned&&("A"==e.filter.reportedAssigned?n.assignedToId=!0:"R"==e.filter.reportedAssigned&&(n.reportedById=!0));var a=p.open({templateUrl:c.app.views.urlRoot+"modules/customer/unsafe/customer_unsafe_act_list_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideCustomerUnsafeActListCtrl",scope:e,resolve:{data:function(){return n}}});a.result.then(function(){},function(){})},e.onAddImprovementPlan=function(t){var n={id:t},a=p.open({templateUrl:c.app.views.urlRoot+"modules/customer/common/modals/customer_improvement_plan_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideCustomerUnsafeImprovementPlanCtrl",scope:e,resolve:{item:function(){return n},isView:function(){return e.isView},cycle:function(){return null}}});a.result.then(function(){},function(){})},e.openLightboxModal=function(e){Lightbox.openModal(e,0)}}]),app.controller("ModalInstanceSideCustomerUnsafeImprovementPlanCtrl",["$stateParams","$rootScope","$scope","$uibModalInstance","item","cycle","$log","$timeout","SweetAlert","isView","$filter","FileUploader","$http","DTOptionsBuilder","DTColumnBuilder","$compile",function(e,t,n,a,i,o,r,l,s,c,d,u,m,p,f,g){var w=null;n.maxDate=new Date,n.datePickerConfig={culture:"es-CO",format:"dd/MM/yyyy HH:mm"},n.responsibleList=[],n.typesAlert=d("orderBy")(t.parameters("tracking_alert_type"),"id",!1),n.typesTime=t.parameters("tracking_alert_timeType"),n.statusAlert=t.parameters("tracking_alert_status"),n.preferencesAlert=t.parameters("tracking_alert_preference"),n.typeList=t.parameters("improvement_plan_type");var h=function(){n.improvement={id:0,customerId:e.customerId,classificationName:"ACTOS",classificationId:null,entityName:"UA",entityId:i.id,type:null,endDate:null,description:"",observation:"",responsible:null,isRequiresAnalysis:!1,status:{id:0,value:"CR",item:"Creada"},trackingList:[],alertList:[]},w&&w.$setPristine(!0)};h(),n.onLoadRecord=function(e){if(0!=e){var t={id:e};m({method:"GET",url:"api/customer/improvement-plan",params:t})["catch"](function(e,t){if(403==t){var n=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";s.swal("No Autorizado","No estas autorizado para ver esta información.","error"),l(function(){$state.go(n)},3e3)}else 404==t?s.swal("Información no disponible","Registro no encontrado","error"):s.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(e){l(function(){null!=e.data.result&&""!=e.data.result&&(n.improvement=e.data.result,b())},400)})["finally"](function(){})}else n.loading=!1},n.onCloseModal=function(){a.close(1)},n.onCancel=function(){a.dismiss("cancel")},n.onClear=function(){};var v=function(){var t={customer_id:e.customerId};return m({method:"POST",url:"api/customer/improvement-plan/list-data",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(e){l(function(){n.responsibleList=e.data.data.responsible})})["catch"](function(e){s.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};v(),n.master=n.improvement,n.form={submit:function(e){w=e;var t=null;if(e.$invalid){var n=null,t=null;for(n in e)"$"!=n[0]&&(null!==t||e[n].$valid||(t=e[n].$name),e[n].$pristine&&(e[n].$dirty=!0));return angular.element(".ng-invalid[name="+t+"]").focus(),void s.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}C()},reset:function(e){n.improvement=angular.copy(n.master),e.$setPristine(!0)}};var C=function(){var e={},t=JSON.stringify(n.improvement);return e.data=Base64.encode(t),m({method:"POST",url:"api/customer/improvement-plan/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){l(function(){s.swal("Acción exitosa","La información ha sido guardada satisfactoriamente","success"),h()})})["catch"](function(e){s.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){n.reloadData()})},b=function(){null!=n.improvement.endDate&&(n.improvement.endDate=new Date(n.improvement.endDate.date)),angular.forEach(n.improvement.trackingList,function(e,t){null!=e.startDate&&(e.startDate=new Date(e.startDate.date))})};n.onAddTracking=function(){l(function(){null==n.improvement.trackingList&&(n.improvement.trackingList=[]),n.improvement.trackingList.push({id:0,customerImprovementPlanId:0,responsible:null,startDate:null})})},n.onRemoveTracking=function(e){s.swal({title:"Está seguro?",text:"Desea confirmar la eliminación de este registro?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(t){t?l(function(){var t=n.improvement.trackingList[e];if(n.improvement.trackingList.splice(e,1),0!=t.id){var a={};a.id=t.id,m({method:"POST",url:"api/customer/improvement-plan-tracking/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){r.error(e),s.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})},n.onAddAlert=function(){l(function(){null==n.improvement.alertList&&(n.improvement.alertList=[]),n.improvement.alertList.push({id:0,customerImprovementPlanId:0,type:null,preference:null,time:0,timeType:null,status:null})})},n.onRemoveAlert=function(e){s.swal({title:"Está seguro?",text:"Desea confirmar la eliminación de este registro ?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(t){t?l(function(){var t=n.improvement.alertList[e];if(n.improvement.alertList.splice(e,1),0!=t.id){var a={};a.id=t.id,m({method:"POST",url:"api/customer/improvement-plan-alert/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){r.error(e),s.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})},n.dtInstanceImprovementPlan={},n.dtOptionsImprovementPlan=p.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerId=n.improvement.customerId,e.entityId=n.improvement.entityId,e.entityName=n.improvement.entityName,JSON.stringify(e)},url:"api/customer-improvement-plan-entity",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){A()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,t,a){g(angular.element(e).contents())(n)}),n.dtColumnsImprovementPlan=[f.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,a,i,o){var r="",l='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+e.id+'" >   <i class="fa fa-edit"></i></a> ',s='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+e.id+'" >   <i class="fa fa-trash-o"></i></a> ';return t.can("cliente_plan_mejoramiento_edit")&&(r+=l),t.can("cliente_plan_mejoramiento_delete")&&(r+=s),n.isView?null:r}),f.newColumn("origin").withTitle("Origen").withOption("width",200).withOption("defaultContent",""),f.newColumn("classification").withTitle("Clasificación").withOption("width",200).withOption("defaultContent",""),f.newColumn("type").withTitle("Tipo").withOption("width",200).withOption("defaultContent",""),f.newColumn("description").withTitle("Hallazgo").withOption("width",200).withOption("defaultContent",""),f.newColumn("responsibleName").withTitle("Responsable").withOption("defaultContent",""),f.newColumn(null).withTitle("Fecha Cierre").withOption("width",200).renderWith(function(e,t,n,a){return"object"==typeof e.endDate&&null!=e.endDate?moment(e.endDate.date).format("DD/MM/YYYY"):null!=e.endDate?moment(e.endDate).format("DD/MM/YYYY"):""}),f.newColumn(null).withTitle("Estado").withOption("width",200).withOption("defaultContent","").renderWith(function(e,t,n,a){var i="label label-success",o=e.status;switch(e.statusCode){case"AB":i="label label-info";break;case"CO":i="label label-success";break;case"CA":i="label label-danger"}return'<span class="'+i+'">'+o+"</span>"})];var A=function(){angular.element("#dtImprovementPlan a.editRow").on("click",function(){var e=angular.element(this).data("id");n.onLoadRecord(e)}),angular.element("#dtImprovementPlan a.delRow").on("click",function(){var e=angular.element(this).data("id");s.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(t){if(t){var a={};a.id=e,m({method:"POST",url:"api/customer/improvement-plan/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){r.error(e),s.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){n.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};n.dtInstanceImprovementPlanCallback=function(e){n.dtInstanceImprovementPlan=e},n.reloadData=function(){n.dtInstanceImprovementPlan.reloadData()}}]),app.controller("ModalInstanceSideCustomerUnsafeActListCtrl",["$stateParams","$rootScope","$scope","$uibModalInstance","data","$log","$timeout","SweetAlert","$filter","FileUploader","$http","DTOptionsBuilder","DTColumnBuilder","$compile","ListService",function(e,t,n,a,i,o,r,l,s,c,d,u,m,p,f){function g(){var e=[{name:"criteria_operators",value:null},{name:"criteria_conditions",value:null},{name:"customer_unsafe_act_massive_filter_field",value:null}];f.getDataList(e).then(function(e){n.criteria=e.data.data.criteriaOperatorList,n.conditions=e.data.data.criteriaConditionList,n.audit.fields=e.data.data.customerUnsafeActMassiveFilterField},function(e){n.status="Unable to load customer data: "+e.message})}var w="A"==i.reportedAssigned?" Asignadas":" Reportadas";n.title="Condiciones Inseguras"+(i.mustFilterByReportedAssigned?w:""),n.onCloseModal=function(){a.close(1)},n.onCancel=function(){a.dismiss("cancel")},n.audit={fields:[],filters:[]},g(),n.addFilter=function(){null==n.audit.filters&&(n.audit.filters=[]),n.audit.filters.push({id:0,field:null,criteria:n.criteria.length>0?n.criteria[1]:null,condition:n.conditions.length>0?n.conditions[0]:null,value:""})},n.onFilter=function(){n.reloadData()},n.removeFilter=function(e){n.audit.filters.splice(e,1)},n.onCleanFilter=function(){n.audit.filters=[],n.reloadData()},n.toggle={isChecked:!1,selectAll:!1},n.records={hasSelected:!1,countSelected:0,countSelectedAll:0};var h={},v={},C={},b=null,A=function(){var e=[m.newColumn(null).withOption("width",30).notSortable().withClass("center").renderWith(function(e,t,n,a){var i="",o=h[e.id].selected,r=o?"checked":"";return i='<div class="checkbox clip-check check-danger "><input class="selectedRow" type="checkbox" id="chk_unsafe_act_select_'+e.id+'" data-id="'+e.id+'" '+r+' ><label class="padding-left-10" for="chk_unsafe_act_select_'+e.id+'"> </label></div>'})];return e.push(O("dateOf","Fecha","",200)),e.push(O("work_place","Centro de Trabajo","",200)),e.push(O("risk_type","Tipo de Peligro","",200)),e.push(O("description","Descripción de la Condición Insegura","",200)),e.push(O(null,"Estado","",200).notSortable().renderWith(function(e,t,n,a){var i="";switch(e.status){case"Creado":i="label label-success";break;case"Revisado":i="label label-warning";break;case"Completado":i="label label-info";break;case"Cancelado":i="label label-danger"}return'<span class="'+i+'">'+e.status+"</span>"})),e},O=function(e,t,n,a){return m.newColumn(e).withTitle(t).withOption("defaultContent",n).withOption("width",a)},y=function(){var e="";n.dtOptionsCustomerUnsafeActDataTableList=u.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerId=i.customerId,e.assignedToId=i.assignedToId,e.reportedById=i.reportedById,angular.isDefined(n.audit)&&angular.isDefined(n.audit.filters)&&(e.filter={filters:n.audit.filters.filter(function(e){return null!=e&&null!=e.field&&null!=e.criteria}).map(function(e,t,n){return{field:e.field.name,operator:e.criteria.value,value:e.value,condition:e.condition.value}})}),b=e,JSON.stringify(e)},dataSrc:function(t){return C=t.data.map(function(e,t,n){return e.id}),v=t.extra,angular.forEach(v,function(e,t){void 0!==h[e]&&null!==h[e]||(h[e]={selected:!1})}),n.records.currentPage=C.length,n.records.total=v.length,e!==b.search.value&&(n.toggle.isChecked=!1,n.toggle.selectAll=!1,D(v,n.toggle.isChecked,!0),e=b.search.value),t.data},url:"api/customer-unsafe-act-massive",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){T()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,t,a){p(angular.element(e).contents())(n)}),n.dtColumnsCustomerUnsafeActDataTableList=A()},T=function(){angular.element("#dtCustomerUnsafeActDataTableList input.selectedRow").on("change",function(){var e=angular.element(this).data("id");"selectedRow"==this.className&&(h[e].selected=this.checked),r(function(){var e=0;angular.forEach(h,function(t,n){e+=t.selected?1:0}),n.records.hasSelected=e>0,n.records.countSelected=e},100)})};y(),n.dtInstanceCustomerUnsafeActDataTableListCallback=function(e){n.dtInstanceCustomerUnsafeActDataTableList=e,n.dtInstanceCustomerUnsafeActDataTableList.DataTable.on("page",function(){r(function(){n.toggle.isChecked=n.toggle.selectAll},300)}),n.dtInstanceCustomerUnsafeActDataTableList.DataTable.on("order",function(){r(function(){n.toggle.isChecked=n.toggle.selectAll},300)})},n.reloadData=function(){null!=n.dtInstanceCustomerUnsafeActDataTableList&&n.dtInstanceCustomerUnsafeActDataTableList.reloadData(null,!1)},n.onToggle=function(){n.toggle.isChecked=!n.toggle.isChecked,D(C,n.toggle.isChecked)},n.onSelectCurrentPage=function(){n.toggle.isChecked=!0,n.toggle.selectAll&&(D(v,!1),n.toggle.selectAll=!1),D(C,n.toggle.isChecked)},n.onSelectAll=function(){n.toggle.isChecked=!0,n.toggle.selectAll=!0,D(v,n.toggle.selectAll)},n.onDeselectAll=function(){n.toggle.isChecked=!1,n.toggle.selectAll=!1,D(v,n.toggle.selectAll)};var D=function(e,t,a){var i=0;angular.forEach(h,function(n,o){void 0!==a&&a&&(h[o].selected=!1),e.indexOf(parseInt(o))!==-1&&(h[o].selected=t),i+=h[o].selected?1:0});var o=angular.element(".selectedRow");angular.forEach(o,function(e,t){var n=angular.element(e).data("id");angular.element(e).prop("checked",h[n].selected)}),n.records.hasSelected=i>0,n.records.countSelected=i};n.onDownload=function(){var t={customerId:e.customerId,selectedItems:h};angular.element("#download")[0].src="api/customer-unsafe-act/export-massive-zip?data="+Base64.encode(JSON.stringify(t))}}]);
"use strict";app.controller("customerUnsafeActEditCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$aside","GeoLocationService","ListService","$uibModal","FileUploader","$document",function(e,n,t,o,a,i,r,s,l,u,c,d,f,m,g,p,h,b,y){function v(){var n=[{name:"unsafe_act_classification",value:e.entity.riskType.id}];p.getDataList(n).then(function(n){e.classificationList=n.data.data.unsafe_act_classification},function(n){e.status="Unable to load customer data: "+n.message})}function I(){var n=[{name:"unsafe_act_risk_type"}];p.getDataList(n).then(function(n){e.riskTypeList=n.data.data.unsafe_act_risk_type},function(n){e.status="Unable to load customer data: "+n.message})}e.statusList=u.parameters("customer_unsafe_act_status");var w=0,A=null,C=e.uploader=new b({url:"api/customer/unsafe-act/upload",formData:[],removeAfterUpload:!0,queueLimit:5});e.conf={imgAnim:"fadeup"},C.filters.push({name:"imageFilter",fn:function(e,n){var t="|"+e.type.slice(e.type.lastIndexOf("/")+1)+"|";return"|jpg|png|jpeg|bmp|gif|".indexOf(t)!==-1}}),e.isView="view"==e.$parent.action,e.onCancel=function(){null!=e.$parent&&e.$parent.navToSection("list","list",0)},e.onDownload=function(){var n={id:e.entity.id};angular.element("#download")[0].src="api/customer-unsafe-act/export-zip?data="+Base64.encode(JSON.stringify(n))},I();var P=function(){var o={};return o.operation="diagnostic",o.customerId=n.customerId,d({method:"POST",url:"api/customer/config-sgsst/workplace/listProcess",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(n){c(function(){e.workPlaceList=n.data.data})})["catch"](function(e){t.error(e),f.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};P();var L=function(){var t={customer_id:n.customerId};return d({method:"POST",url:"api/customer/improvement-plan/list-data",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(n){c(function(){e.responsibleList=n.data.data.responsible})})["catch"](function(e){f.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};L(),e.onSelectRiskType=function(n,t){null!=e.entity.riskType&&v()},e.onReset=function(){e.entity={id:e.$parent.currentId?e.$parent.currentId:0,customerId:n.customerId,status:e.statusList.length>0?e.statusList[0]:null,dateOf:new Date,workPlace:null,riskType:null,classification:null,place:"",lat:0,lng:0,description:"",images:[],responsible:null,reportedBy:u.currentUserName()},A&&A.$setPristine(!0)},e.onReset(),u.$emit("onCustomerUnsafeActLoaded",{newValue:e.entity.id,message:"Unsafe Act with id "+e.entity.id+" has been loaded!"}),e.onResetObservation=function(){e.observation={id:0,customerUnsafeActId:e.$parent.currentId?e.$parent.currentId:0,status:null,dateOf:new Date,description:""}},e.onResetObservation(),e.onLoadRecord=function(){if(0!=e.entity.id){var n={id:e.entity.id};d({method:"GET",url:"api/customer/unsafe-act",params:n})["catch"](function(e,n){if(403==n){var t=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";f.swal("No Autorizado","No estas autorizado para ver esta informaci�n.","error"),c(function(){l.go(t)},3e3)}else 404==n?f.swal("Informaci�n no disponible","Centro de trabajo no encontrado","error"):f.swal("Error","Se ha presentado un error al intentar acceder a la informaci�n del centro de trabajo","error")}).then(function(n){c(function(){e.entity=n.data.result,e.$parent.currentId=e.entity.id,v(),null!=e.entity.dateOf&&(e.entity.dateOf=new Date(e.entity.dateOf.date)),null!=e.entity.image&&null!=e.entity.image.path?e.noImage=!1:e.noImage=!0,null!=e.entity.images&&(C.queueLimit=5-e.entity.images.length),console.log(n)})})["finally"](function(){c(function(){e.loading=!1},400)})}else g.getCurrentPosition().then(function(n){console.log(n,"current position"),e.entity.lat=n.coords.latitude,e.entity.lng=n.coords.longitude}),e.loading=!1},e.onLoadRecord(),null==e.entity.image&&(e.noImage=!0),e.removeImage=function(){e.noImage=!0},e.master=e.indicator,e.form={submit:function(e){A=e;var n=null;if(e.$invalid){var t=null,n=null;for(t in e)"$"!=t[0]&&(null!==n||e[t].$valid||(n=e[t].$name),e[t].$pristine&&(e[t].$dirty=!0));return angular.element(".ng-invalid[name="+n+"]").focus(),void f.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}O()},reset:function(n){e.clear()}};var O=function(){var n={},o=JSON.stringify(e.entity);return n.data=Base64.encode(o),d({method:"POST",url:"api/customer/unsafe-act/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(n){c(function(){f.swal("Validación exitosa","Reporte creado correctamente","success"),w=n.data.result.id,C.queue.length>0?(e.entity=n.data.result,C.uploadAll()):e.onCancel()},500)})["catch"](function(e){t.error(e),f.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};C.onWhenAddingFileFailed=function(e,n,t){console.info("onWhenAddingFileFailed",e,n,t)},C.onAfterAddingFile=function(e){console.info("onAfterAddingFile",e)},C.onAfterAddingAll=function(e){console.info("onAfterAddingAll",e)},C.onBeforeUploadItem=function(e){console.info("onBeforeUploadItem",e);var n={id:w};e.formData.push(n)},C.onProgressItem=function(e,n){console.info("onProgressItem",e,n)},C.onProgressAll=function(e){console.info("onProgressAll",e)},C.onSuccessItem=function(e,n,t,o){console.info("onSuccessItem",e,n,t,o)},C.onErrorItem=function(e,n,t,o){console.info("onErrorItem",e,n,t,o)},C.onCancelItem=function(e,n,t,o){console.info("onCancelItem",e,n,t,o)},C.onCompleteItem=function(e,n,t,o){console.info("onCompleteItem",e,n,t,o)},C.onCompleteAll=function(){console.info("onCompleteAll"),e.onLoadRecord(),s.pop("success","Operación exitosa","Se subío correctamente la imagen")},e.addPhoto=function(){var n=Math.floor(13*Math.random())+1,t=Math.floor(9999999999*Math.random())+1;e.images.push({id:t,url:"https://thatisuday.github.io/ng-image-gallery/demo-images/"+n+".jpg",thumbUrl:"https://thatisuday.github.io/ng-image-gallery/demo-images/thumbs/"+n+".jpg",bubbleUrl:"https://thatisuday.github.io/ng-image-gallery/demo-images/bubbles/"+n+".jpg"})},e.removePhoto=function(){e.images.length>1&&e.images.pop()},e.thumbnails=!0,e.toggleThumbnails=function(){e.thumbnails=!e.thumbnails},e.inline=!1,e.toggleInline=function(){e.inline=!e.inline},e.bubbles=!0,e.toggleBubbles=function(){e.bubbles=!e.bubbles},e.imgBubbles=!1,e.toggleImgBubbles=function(){e.imgBubbles=!e.imgBubbles},e.bgClose=!1,e.closeOnBackground=function(){e.bgClose=!e.bgClose},e.methods={},e.openGallery=function(){e.methods.open()},e.opened=function(){console.info("Gallery opened!")},e.closed=function(){console.warn("Gallery closed!")},e["delete"]=function(e,n){}}]);
"use strict";app.controller("customerUnsafeActIndicatorCtrl",["$scope","$stateParams","$log","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$aside","ListService","ChartService",function(t,e,a,n,o,r,c,l,s,i,d,u,f){function p(){var a={customerId:e.customerId,year:t.filter.selectedYear?t.filter.selectedYear.value:0,month:t.filter.selectedMonth?t.filter.selectedMonth.value:null,workplace:t.filter.selectedWorkplace?t.filter.selectedWorkplace:null},n=[{name:"chart_bar_options",criteria:null},{name:"chart_line_options",criteria:null},{name:"customer_unsafe_act",criteria:a}];f.getDataChart(n).then(function(e){t.chart.bar.options=e.data.data.chartBarOptions,t.chart.line.options=e.data.data.chartLineOptions,t.chart.bar.options.legend.position="bottom",t.chart.line.options.legend.position="bottom",t.chart.workplace.data=e.data.data.customerUnsafeActWorkplace,t.chart.hazard.data=e.data.data.customerUnsafeActHazard,t.chart.period.data=e.data.data.customerUnsafeActPeriod,t.chart.status.data=e.data.data.customerUnsafeActStatus},function(e){t.status="Unable to load customer data: "+e.message})}function m(){var a={customerId:e.customerId},n=[{name:"customer_unsafe_act_years",value:null,criteria:a},{name:"customer_unsafe_act_workplace",value:null,criteria:a},{name:"month_options",value:null}];u.getDataList(n).then(function(e){t.years=e.data.data.customerUnsafeActYears,t.months=e.data.data.monthOptions,t.workplaceList=e.data.data.customerUnsafeActWorkplace,t.years.length>0&&(t.filter.selectedYear=t.years[0],p())},function(e){t.status="Unable to load customer data: "+e.message})}t.chart={bar:{options:null},line:{options:null},workplace:{data:null},hazard:{data:null},period:{data:null},status:{data:null}},t.filter={selectedYear:null,selectedMonth:null,selectedWorkplace:null},m(),t.onExportPdf=function(){l(function(){kendo.drawing.drawDOM(angular.element(".indicator-unsafe-act-export-pdf")).then(function(t){return kendo.drawing.exportPDF(t,{paperSize:"auto",margin:{left:"1cm",top:"1cm",right:"1cm",bottom:"1cm"}})}).done(function(t){kendo.saveAs({dataURI:t,fileName:"Estadísticas_Condiciones_Inseguras.pdf",proxyURL:"//demos.telerik.com/kendo-ui/service/export"})})},200)},t.cancelEdition=function(){null!=t.$parent&&t.$parent.navToSection("list","list",0)},t.onSelectYear=function(t,e){p()},t.onSelectMonth=function(t,e){p()},t.onSelectWorkPlace=function(t,e){p()},t.onClearYear=function(){t.filter.selectedYear=t.years[0],p()},t.onClearMonth=function(){t.filter.selectedMonth=null,p()},t.onClearWorkPlace=function(){t.filter.selectedWorkplace=null,p()}}]);
"use strict";app.controller("customerUnsafeActObservationListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$aside","$q","$filter",function(t,e,n,a,r,o,i,s,l,u,c,d,f,p,w,m){var v=null;t.currentId=t.$parent.currentId?t.$parent.currentId:0,t.isView="view"==t.$parent.action,t.statusList=u.parameters("customer_unsafe_act_status").map(function(t){if("Completado"==t.item||"Cancelado"==t.item)return t});var h=u.$on("onCustomerUnsafeActLoaded",function(e,n){t.currentId=n.newValue,O(),t.reloadData()});t.$on("$destroy",function(){h()});var O=function(){t.observation={id:0,customerUnsafeActId:t.currentId,status:null,dateOf:new Date,description:""},v&&v.$setPristine(!0)};O(),t.form={submit:function(t){v=t;var e=null;if(t.$invalid){var n=null,e=null;for(n in t)"$"!=n[0]&&(null!==e||t[n].$valid||(e=t[n].$name),t[n].$pristine&&(t[n].$dirty=!0));return angular.element(".ng-invalid[name="+e+"]").focus(),void f.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}b()},reset:function(e){t.clear()}};var b=function(){if(null==t.observation.status)return f.swal("Error en el formulario","Por favor seleccione el estado","error"),!1;if(null==t.observation.dateOf)return f.swal("Error en el formulario","Por favor seleccione la fecha","error"),!1;var e={},a=JSON.stringify(t.observation);return e.data=Base64.encode(a),d({method:"POST",url:"api/customer/unsafe-act-observation/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){c(function(){f.swal("Validación exitosa","Registro guardado correctamente.","success"),t.onCancel()},500)})["catch"](function(t){n.error(t),f.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};t.dtInstanceCustomerUnsafeActObservation={},t.dtOptionsCustomerUnsafeActObservation=a.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerUnsafeActId=t.currentId,e},url:"api/customer/unsafe-act-observation",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){C()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,n,a){i(angular.element(e).contents())(t)}),t.dtColumnsCustomerUnsafeActObservation=[r.newColumn("dateOfFormat").withTitle("Fecha").withOption("width",200).withOption("defaultContent",""),r.newColumn("creator.name").withTitle("Usuario").withOption("width",200).withOption("defaultContent",""),r.newColumn("description").withTitle("Observación").withOption("defaultContent",""),r.newColumn("status.item").withTitle("Estado").withOption("width",200).withOption("defaultContent","").renderWith(function(t,e,n,a){var r="";switch(t){case"Creado":r="label label-success";break;case"Revisado":r="label label-warning";break;case"Completado":r="label label-info";break;case"Cancelado":r="label label-danger"}var o='<span class="'+r+'">'+t+"</span>";return o})];var C=function(){};t.dtInstanceCustomerUnsafeActObservationCallback=function(e){t.dtInstanceCustomerUnsafeActObservation=e},t.reloadData=function(){t.dtInstanceCustomerUnsafeActObservation.reloadData()},t.onCancel=function(e){e&&(v=e),O(),t.reloadData()}}]);
"use strict";app.controller("customerProfileConfigSgsstTabsCtrl",["$scope","$location","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","SweetAlert","$rootScope","$http","$timeout","$uibModal","flowFactory","cfpLoadingBar","$filter","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder",function(s,e,t,o,r,a,i,u,c,l,m,n,p,_,g,d,f,w){s.views=[{name:"workplace",url:n.app.views.urlRoot+"modules/customer/sgsst/center/customer_profile_config_sgsst_work_center_tab.htm"},{name:"macroprocess",url:n.app.views.urlRoot+"modules/customer/sgsst/macro-processes/customer_profile_config_sgsst_macro_processes_tab.htm"},{name:"process",url:n.app.views.urlRoot+"modules/customer/sgsst/process/customer_profile_config_sgsst_process_tab.htm"},{name:"activity",url:n.app.views.urlRoot+"modules/customer/sgsst/activities/customer_profile_config_sgsst_acivity_tab.htm"},{name:"job",url:n.app.views.urlRoot+"modules/customer/sgsst/job/customer_profile_config_sgsst_job_tab.htm"},{name:"hazard",url:n.app.views.urlRoot+"modules/customer/sgsst/hazard/customer_profile_config_sgsst_job_activity_hazard_edit.htm"},{name:"wizard",url:n.app.views.urlRoot+"modules/customer/sgsst/massive/customer_profile_config_sgsst_wizard_tab.htm"}],s.isAgent="agent"==n.currentUser().wg_type,s.isAdmin="system"==n.currentUser().wg_type,s.isCustomer="customerAdmin"==n.currentUser().wg_type||"customerUser"==n.currentUser().wg_type,s.statusMode="create",s.loading=!1,s.tabsloaded=["workplace"],s.tabname="workplace",s.titletab=s.statusMode,s.getView=function(e){var t=w("filter")(s.views,{name:e},!0);return t[0]},s.switchTab=function(e){o.info(e),_(function(){s.tabname=e,s.tabsloaded.push(e)})}}]);
"use strict";app.controller("customerConfigWorkPlaceListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$document","$location","$translate","ListService","$filter",function(t,n,e,i,a,o,r,l,c,s,u,d,f,p,w,m,h,y){function g(){var n=[{name:"country",value:null},{name:"state",value:t.entity.country?t.entity.country.id:68},{name:"city",value:t.entity.state?t.entity.state.id:0},{name:"wg_structure_type",value:null},{name:"config_workplace_status",value:null}];h.getDataList(n).then(function(n){if(t.countryList=n.data.data.countryList,t.stateList=n.data.data.stateList,t.cityList=n.data.data.cityList,t.typeList=n.data.data.wg_structure_type,t.statusList=n.data.data.config_workplace_status,null==t.entity.country){var e=y("filter")(t.countryList,{code:"CO"},!0);t.entity.country=e.length>0?e[0]:null}},function(n){t.status="Unable to load customer data: "+n.message})}var v=null;t.loading=!0,t.isView=c.is("app.clientes.view");var C=function(){t.entity={id:0,customerId:n.customerId,country:null,state:null,city:null,name:null,address:"",economicActivity:0,employeeDirect:0,employeeContractor:0,employeeMision:0,risk1:0,risk2:0,risk3:0,risk4:0,risk5:0,status:!0},v&&v.$setPristine(!0)};C(),g();var k=function(n){if(n){var e={id:n};d({method:"GET",url:"api/customer-config-workplace/get-gtc",params:e})["catch"](function(t,n){}).then(function(n){t.entity=n.data.result,t.onChangeEmployeeNumber(),g()})["finally"](function(){})}};t.form={submit:function(t){v=t;var n=null;if(t.$invalid){var e=null,n=null;for(e in t)"$"!=e[0]&&(null!==n||t[e].$valid||(n=t[e].$name),t[e].$pristine&&(t[e].$dirty=!0));return angular.element(".ng-invalid[name="+n+"]").focus(),void f.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}O()},reset:function(t){C()}};var O=function(){var n={},e=JSON.stringify(t.entity);return n.data=Base64.encode(e),d({method:"POST",url:"api/customer-config-workplace/save-gtc",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(n){u(function(){f.swal("Registro","La información ha sido guardada satisfactoriamente","success"),t.reloadData()})})["catch"](function(t){f.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){t.onCancel()})};t.onChangeEmployeeNumber=function(){t.entity.total=parseInt(t.entity.risk1)+parseInt(t.entity.risk2)+parseInt(t.entity.risk3)+parseInt(t.entity.risk4)+parseInt(t.entity.risk5)},t.onCancel=function(){C()},t.onSelectCountry=function(){t.entity.state=null,t.entity.city=null,g()},t.onSelectState=function(){t.entity.city=null,g()},t.dtOptionsConfigWorkPlace=i.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.customerId=n.customerId,JSON.stringify(t)},url:"api/customer-config-workplace",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){b()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(n,e,i){r(angular.element(n).contents())(t)}),t.dtColumnsConfigWorkPlace=[a.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(n,e,i,a){var o="",r="",l='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar"  data-id="'+n.id+'"'+r+' >   <i class="fa fa-edit"></i></a> ',c='<a class="btn btn-info btn-xs viewRow lnk" href="#"  uib-tooltip="Ver" data-id="'+n.id+'" >   <i class="fa fa-eye"></i></a> ',u='<a class="btn btn-danger btn-xs delRow lnk" href="#"  uib-tooltip="Eliminar" data-id="'+n.id+'"'+r+' >   <i class="fa fa-trash-o"></i></a> ';return s.can("clientes_view")&&(o+=c),s.can("clientes_edit")&&(o+=l),s.can("clientes_delete")&&(o+=u),t.isView?c:o}),a.newColumn("name").withTitle(m.instant("grid.matrix.WORK-PLACE")).withOption("width",200).withOption("defaultContent",""),a.newColumn("country").withTitle("País").withOption("width",200).withOption("defaultContent",""),a.newColumn("state").withTitle("Departamento").withOption("width",200).withOption("defaultContent",""),a.newColumn("city").withTitle("Ciudad").withOption("width",200).withOption("defaultContent",""),a.newColumn(null).withTitle("Estado").withOption("width",200).renderWith(function(t,n,e,i){var a="";switch(t.status){case"Activo":a="label label-success";break;case"Inactivo":a="label label-danger";break;case"En Proceso":a="label label-inverse"}return'<span class="'+a+'">'+t.status+"</span>"})];var b=function(){angular.element("#dtConfigWorkPlace a.editRow").on("click",function(){var t=angular.element(this).data("id");T(t)}),angular.element("#dtConfigWorkPlace a.viewRow").on("click",function(){var t=angular.element(this).data("id");P(t)}),angular.element("#dtConfigWorkPlace a.delRow").on("click",function(){var n=angular.element(this).data("id");f.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(e){if(e){var i={};i.id=n,d({method:"POST",url:"api/customer-config-workplace/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){f.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){t.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};t.dtInstanceConfigWorkPlaceCallback=function(n){t.dtInstanceConfigWorkPlace=n},t.reloadData=function(){t.dtInstanceConfigWorkPlace.reloadData()};var P=function(n){t.isView=!0,k(n)},T=function(n){t.isView=!1,k(n)}}]);
"use strict";app.controller("customerConfigMacroProcessesCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$document","$location","$translate",function(a,o,e,n,t,r,i,c,s,l,d,u,f,m,p,w){var g=e,h={};a.loading=!0,a.customerId=o.customerId,a.isView=s.is("app.clientes.view"),a.macro={},a.status=l.parameters("config_workplace_status"),a.types=l.parameters("wg_structure_type"),a.workplaces=[],a.countries=l.countries(),a.onLoadRecord=function(){if(0!=a.macro.id){g.info("editando cliente con código: "+a.macro.id);var o={id:a.macro.id};u({method:"GET",url:"api/customer/config-sgsst/macro/get",params:o})["catch"](function(a,o){if(403==o){var e=null!==a.message&&void 0!==a.message?a.message:"app.clientes.list";f.swal("No Autorizado","No estas autorizado para ver esta información.","error"),d(function(){s.go(e)},3e3)}else 404==o?f.swal("Información no disponible","Centro de trabajo no encontrado","error"):f.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(o){d(function(){a.macro=o.data.result})})["finally"](function(){d(function(){a.loading=!1},400),d(function(){m.scrollTop(40,2e3)})})}else g.info("creacion de nuevo cliente"),a.loading=!1};var v=function(){var o={};return o.operation="diagnostic",o.customerId=a.customerId,u({method:"POST",url:"api/customer/config-sgsst/workplace/list",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(o){d(function(){a.workplaces=o.data.data})})["catch"](function(a){e.error(a),f.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){a.clear()})};v();var C=function(){a.macro={id:0,customerId:a.customerId,name:"",workplace:null,status:null}};C(),a.onLoadRecord();a.master=a.macro,a.form={submit:function(o){var e=null;if(o.$invalid){var n=null,e=null;for(n in o)"$"!=n[0]&&(null!==e||o[n].$valid||(e=o[n].$name),o[n].$pristine&&(o[n].$dirty=!0));return g.info(a.macro),angular.element(".ng-invalid[name="+e+"]").focus(),void f.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}b()},reset:function(o){a.clear()}},a.clear=function(){d(function(){C()})};var b=function(){var o={},n=JSON.stringify(a.macro);return o.data=Base64.encode(n),u({method:"POST",url:"api/customer/config-sgsst/macro/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(o){d(function(){a.macro=o.data.result,f.swal("Registro","La información ha sido guardada satisfactoriamente","success"),a.reloadData()})})["catch"](function(a){e.error(a),f.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){a.clear()})};h.operation="diagnostic",h.customerId=a.customerId,a.dtInstanceConfigMacro={},a.dtOptionsConfigMacro=n.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:h,url:"api/customer/config-sgsst/macro",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){O()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(o,e,n){i(angular.element(o).contents())(a)}),a.dtColumnsConfigMacro=[t.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(o,e,n,t){var r="",i="",c='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar"  data-id="'+o.id+'"'+i+' >   <i class="fa fa-edit"></i></a> ',s='<a class="btn btn-info btn-xs viewRow lnk" href="#"  uib-tooltip="Ver" data-id="'+o.id+'" >   <i class="fa fa-eye"></i></a> ',d='<a class="btn btn-danger btn-xs delRow lnk" href="#"  uib-tooltip="Eliminar" data-id="'+o.id+'"'+i+' >   <i class="fa fa-trash-o"></i></a> ';return l.can("clientes_view")&&(r+=s),l.can("clientes_edit")&&(r+=c),l.can("clientes_delete")&&(r+=d),a.isView?s:r}),t.newColumn("workplaceText").withTitle(w.instant("grid.matrix.WORK-PLACE")).withOption("width",200),t.newColumn("name").withTitle(w.instant("grid.matrix.MACROPROCESS")),t.newColumn("status.item").withTitle("Estado").withOption("width",200).renderWith(function(a,o,e,n){var t="";switch(a){case"Activo":t="label label-success";break;case"Inactivo":t="label label-danger";break;case"Retirado":t="label label-warning"}var r='<span class="'+t+'">'+a+"</span>";return r})],a.viewConfigMacro=function(o){a.macro.id=o,a.isView=!0,a.onLoadRecord()},a.cancelEdition=function(o){null!=a.$parent&&a.$parent.navToSection("summary","summary",a.customerId)};var O=function(){$("#dtConfigMacro a.editRow").on("click",function(){var o=$(this).data("id");a.editConfigMacro(o)}),$("#dtConfigMacro a.viewRow").on("click",function(){var o=$(this).data("id");a.macro.id=o,a.viewConfigMacro(o)}),$("#dtConfigMacro a.delRow").on("click",function(){var o=$(this).data("id");g.info("intenta eliminar el registro: "+o),f.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(n){if(n){var t={};t.id=o,u({method:"POST",url:"api/customer/config-sgsst/macro/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(a){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(a){e.error(a),f.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){a.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};a.reloadData=function(){a.dtInstanceConfigMacro.reloadData()},a.editConfigMacro=function(o){a.macro.id=o,a.isView=!1,a.onLoadRecord()},a.createConfigMacro=function(){var n={},t={id:0,customerId:o.customerId,status:{id:0,item:"Iniciado",value:"iniciado"}},r=JSON.stringify(t);n.data=Base64.encode(r),u({method:"POST",url:"api/customer/config-sgsst/macro/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(o){null!=a.$parent&&(a.reloadData(),swal("Creado","Centro de trabajo adicionado satisfactoriamente","info"))})["catch"](function(a){e.error(a),f.swal("Error Creando","Se ha presentado un error durante la creación del centro de trabajo por favor intentelo de nuevo","error")})["finally"](function(){})},a.refreshWorkPlace=function(){v()}}]);
"use strict";app.controller("customerConfigProcessesCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$document","$location","$translate",function(e,o,n,t,a,r,i,s,c,l,d,u,f,p,m,w){var g=n,h={};e.loading=!0,e.customerId=o.customerId,e.isView=c.is("app.clientes.view"),e.process={},e.status=l.parameters("config_workplace_status"),e.types=l.parameters("wg_structure_type"),e.workplaces=[],e.macros=[],e.countries=l.countries(),e.onLoadRecord=function(){if(0!=e.process.id){g.info("editando cliente con código: "+e.process.id);var o={id:e.process.id};u({method:"GET",url:"api/customer/config-sgsst/process/get",params:o})["catch"](function(e,o){if(403==o){var n=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";f.swal("No Autorizado","No estas autorizado para ver esta información.","error"),d(function(){c.go(n)},3e3)}else 404==o?f.swal("Información no disponible","Centro de trabajo no encontrado","error"):f.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(o){d(function(){e.process=o.data.result})})["finally"](function(){d(function(){e.loading=!1},400),d(function(){p.scrollTop(40,2e3)})})}else g.info("creacion de nuevo cliente"),e.loading=!1};var v=function(){var o={};return o.operation="diagnostic",o.customerId=e.customerId,u({method:"POST",url:"api/customer/config-sgsst/workplace/listProcess",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(o){d(function(){e.workplaces=o.data.data})})["catch"](function(e){n.error(e),f.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})},C=function(){e.process={id:0,customerId:e.customerId,name:"",workplace:null,macro:null,status:null}};C(),v();var P=function(){if(null!=e.process.workplace){var o={};return o.operation="diagnostic",o.customerId=e.customerId,o.workPlaceId=e.process.workplace.id,u({method:"POST",url:"api/customer/config-sgsst/macro/list",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(o){d(function(){e.macros=o.data.data})})["catch"](function(e){})["finally"](function(){})}e.macros=[]};e.$watch("process.workplace",function(){P()}),e.onLoadRecord();e.master=e.process,e.form={submit:function(o){var n=null;if(o.$invalid){var t=null,n=null;for(t in o)"$"!=t[0]&&(null!==n||o[t].$valid||(n=o[t].$name),o[t].$pristine&&(o[t].$dirty=!0));return g.info(e.process),angular.element(".ng-invalid[name="+n+"]").focus(),void f.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}b()},reset:function(o){e.clear()}},e.clear=function(){d(function(){C()})};var b=function(){var o={},t=JSON.stringify(e.process);return o.data=Base64.encode(t),u({method:"POST",url:"api/customer/config-sgsst/process/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(o){d(function(){e.process=o.data.result,f.swal("Registro","La información ha sido guardada satisfactoriamente","success"),e.reloadData()})})["catch"](function(e){n.error(e),f.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){e.clear()})};h.operation="diagnostic",h.customerId=e.customerId,e.dtInstanceConfigProcess={},e.dtOptionsConfigProcess=t.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:h,url:"api/customer/config-sgsst/process",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){O()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(o,n,t){i(angular.element(o).contents())(e)}),e.dtColumnsConfigProcess=[a.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(o,n,t,a){var r="",i="",s='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar"  data-id="'+o.id+'"'+i+' >   <i class="fa fa-edit"></i></a> ',c=('<a class="btn btn-info btn-xs viewRow lnk" href="#"  uib-tooltip="Ver" data-id="'+o.id+'" >   <i class="fa fa-eye"></i></a> ','<a class="btn btn-danger btn-xs delRow lnk" href="#"  uib-tooltip="Eliminar" data-id="'+o.id+'"'+i+' >   <i class="fa fa-trash-o"></i></a> ');return l.can("clientes_view"),l.can("clientes_edit"),r+=s,l.can("clientes_delete")&&(r+=c),e.isView?null:r}),a.newColumn("workplaceText").withTitle(w.instant("grid.matrix.WORK-PLACE")).withOption("width",200),a.newColumn("macroText").withTitle(w.instant("grid.matrix.MACROPROCESS")).withOption("width",200),a.newColumn("name").withTitle(w.instant("grid.matrix.PROCESS")),a.newColumn("status.item").withTitle("Estado").withOption("width",200).renderWith(function(e,o,n,t){var a="";switch(e){case"Activo":a="label label-success";break;case"Inactivo":a="label label-danger";break;case"Retirado":a="label label-warning"}var r='<span class="'+a+'">'+e+"</span>";return r})],e.viewConfigProcess=function(o){e.process.id=o,e.isView=!0,e.onLoadRecord()},e.cancelEdition=function(o){null!=e.$parent&&e.$parent.navToSection("summary","summary",e.customerId)};var O=function(){$("#dtConfigProcess a.editRow").on("click",function(){var o=$(this).data("id");e.editConfigProcess(o)}),$("#dtConfigProcess a.viewRow").on("click",function(){var o=$(this).data("id");e.process.id=o,e.viewConfigProcess(o)}),$("#dtConfigProcess a.delRow").on("click",function(){var o=$(this).data("id");g.info("intenta eliminar el registro: "+o),f.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(t){if(t){var a={};a.id=o,u({method:"POST",url:"api/customer/config-sgsst/process/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){n.error(e),f.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){e.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};e.reloadData=function(){e.dtInstanceConfigProcess.reloadData()},e.editConfigProcess=function(o){e.process.id=o,e.isView=!1,e.onLoadRecord()},e.createConfigProcess=function(){var t={},a={id:0,customerId:o.customerId,status:{id:0,item:"Iniciado",value:"iniciado"}},r=JSON.stringify(a);t.data=Base64.encode(r),u({method:"POST",url:"api/customer/config-sgsst/process/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(o){null!=e.$parent&&(e.reloadData(),swal("Creado","Centro de trabajo adicionado satisfactoriamente","info"))})["catch"](function(e){n.error(e),f.swal("Error Creando","Se ha presentado un error durante la creación del centro de trabajo por favor intentelo de nuevo","error")})["finally"](function(){})},e.refreshWorkPlace=function(){v()},e.refreshMacro=function(){P()}}]);
"use strict";app.controller("customerConfigActivityListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$uibModal","$http","SweetAlert","$document","$aside","$location","$translate",function(t,a,e,i,n,o,r,c,s,l,d,u,f,p,m,h,v,g){var w=e;t.loading=!0,t.customerId=a.customerId,t.isView=s.is("app.clientes.view"),t.job={},t.activity={},t.status=l.parameters("config_workplace_status"),t.types=l.parameters("wg_structure_type"),t.trackingList=l.parameters("hazard_tracking"),t.workplaces=[],t.macros=[],t.processes=[],t.request={},t.onLoadRecordActivity=function(){if(0!=t.activity.id){w.info("editando cliente con código: "+t.activity.id);var a={id:t.activity.id};f({method:"GET",url:"api/customer/config-sgsst/activity/get",params:a})["catch"](function(t,a){if(403==a){var e=null!==t.message&&void 0!==t.message?t.message:"app.clientes.list";p.swal("No Autorizado","No estas autorizado para ver esta información.","error"),d(function(){s.go(e)},3e3)}else 404==a?p.swal("Información no disponible","Centro de trabajo no encontrado","error"):p.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(a){console.log(a),d(function(){t.activity=a.data.result})})["finally"](function(){d(function(){t.loading=!1},400),d(function(){m.scrollTop(40,2e3)})})}else w.info("creacion de nuevo cliente"),t.loading=!1};var y=function(){t.activity={id:0,customerId:t.customerId,status:null,isCritical:!1}};y(),t.master=t.job,t.form={submit:function(a){var e=null;if(a.$invalid){var i=null,e=null;for(i in a)"$"!=i[0]&&(null!==e||a[i].$valid||(e=a[i].$name),a[i].$pristine&&(a[i].$dirty=!0));return w.info(t.job),angular.element(".ng-invalid[name="+e+"]").focus(),void p.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}b()},reset:function(a){t.clear()}};var b=function(){var a={},i=JSON.stringify(t.activity);return a.data=Base64.encode(i),f({method:"POST",url:"api/customer/config-sgsst/activity/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(a){console.log(a),d(function(){t.activity=a.data.result,p.swal("Registro","La información ha sido guardada satisfactoriamente","success"),t.clearActivity(),t.reloadData()})})["catch"](function(t){e.error(t),p.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};t.onAddProcess=function(a){var e={id:a},i=h.open({templateUrl:l.app.views.urlRoot+"modules/customer/sgsst/activities/customer_profile_config_sgsst_activity_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideConfigActivityProcessCtrl",scope:t,resolve:{activity:function(){return e}}});i.result.then(function(){t.reloadData()})},t.onAddDocumentTypes=function(a){var e={id:a},i=h.open({templateUrl:l.app.views.urlRoot+"modules/customer/sgsst/activities/customer_profile_config_sgsst_job_activity_document_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideConfigActivityDocumentCtrl",scope:t,resolve:{activity:function(){return e}}});i.result.then(function(){t.reloadData()})},t.request.operation="diagnostic",t.request.customerId=t.customerId,t.dtInstanceConfigJobActivity={},t.dtOptionsConfigJobActivity=i.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:t.request,url:"api/customer/config-sgsst/activity",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){C()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(a,e,i){r(angular.element(a).contents())(t)}),t.dtColumnsConfigJobActivity=[n.newColumn(null).withTitle("Acciones").withOption("width",180).notSortable().renderWith(function(a,e,i,n){var o="",r="",c='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar"  data-id="'+a.id+'"'+r+' >   <i class="fa fa-edit"></i></a> ',s='<a class="btn btn-info btn-xs hazardRow lnk" href="#"  uib-tooltip="Configurar peligro" data-id="'+a.id+'" >   <i class="fa fa-cog"></i></a> ',d='<a class="btn btn-danger btn-xs delRow lnk" href="#"  uib-tooltip="Eliminar" data-id="'+a.id+'"'+r+' >   <i class="fa fa-trash-o"></i></a> ',u=('<a class="btn btn-success btn-xs setupRow lnk" href="#"  uib-tooltip="Configurar Procesos" data-id="'+a.id+'"'+r+' >   <i class="fa fa-file-text-o"></i></a> ','<a class="btn btn-purple btn-xs documentRow lnk" href="#"  uib-tooltip="Configurar Tipo Documento" data-id="'+a.id+'"'+r+' >   <i class="fa fa-file-archive-o"></i></a> ');return o+=s,l.can("clientes_edit")&&(o+=c),l.can("clientes_delete")&&(o+=d),a.isCritical&&(o+=u),t.isView?null:o}),n.newColumn("name").withTitle(g.instant("grid.matrix.ACTIVITY")),n.newColumn("isCritical").withTitle("Crítica").withOption("width",200).renderWith(function(t,a,e,i){var n="",o="";t?(n="label label-info",o="Si"):(n="label label-warning",o="No");var r='<span class="'+n+'">'+o+"</span>";return r}),n.newColumn("status.item").withTitle("Estado").withOption("width",200).renderWith(function(t,a,e,i){var n="";switch(t){case"Activo":n="label label-success";break;case"Inactivo":n="label label-danger";break;case"Retirado":n="label label-warning"}var o='<span class="'+n+'">'+t+"</span>";return o})],t.clearActivity=function(a){y(),t.reloadData()},t.setupConfigJobActivity=function(a){t.onAddProcess(a)},t.setupConfigActivityDocument=function(a){t.onAddDocumentTypes(a)};var C=function(){$("#dtConfigJobActivity a.editRow").on("click",function(){var a=$(this).data("id");t.editConfigJobActivity(a)}),$("#dtConfigJobActivity a.hazardRow").on("click",function(){var a=$(this).data("id");t.onAddHazard({id:a})}),$("#dtConfigJobActivity a.setupRow").on("click",function(){var a=$(this).data("id");t.setupConfigJobActivity(a)}),$("#dtConfigJobActivity a.documentRow").on("click",function(){var a=$(this).data("id");t.setupConfigActivityDocument(a)}),$("#dtConfigJobActivity a.delRow").on("click",function(){var a=$(this).data("id");w.info("intenta eliminar el registro: "+a),p.swal({title:"Está seguro?",text:"Eliminará el registro seleccionada.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(i){if(i){var n={};n.id=a,f({method:"POST",url:"api/customer/config-sgsst/activity/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){e.error(t),p.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){t.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};t.reloadData=function(){t.dtInstanceConfigJobActivity.reloadData()},t.editConfigJobActivity=function(a){t.activity.id=a,t.onLoadRecordActivity()},t.onAddHazard=function(a){var e=h.open({templateUrl:l.app.views.urlRoot+"modules/customer/sgsst/activities/customer_profile_config_sgsst_job_activity_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideCustomerConfigActivityHazardCtrl",scope:t,resolve:{activity:function(){return a}}});e.result.then(function(){t.reloadData()})}}]),app.controller("ModalInstanceSideCustomerConfigActivityHazardCtrl",["$uibModalInstance","$rootScope","$location","$uibModal","$scope","activity","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile","$document","ListService",function(t,a,e,i,n,o,r,c,s,l,d,u,f,p,m,h,v,g){function w(){var t=[{name:"customer_config_activity_hazard_reason",value:null}];g.getDataList(t).then(function(t){n.reasonList=t.data.data.customer_config_activity_hazard_reason},function(t){n.status="Unable to load customer data: "+t.message})}var y=null;w(),n.controlMethods=a.parameters("config_control_method"),n.typesMeasure=a.parameters("config_type_measure"),n.entity=o;var b=function(){n.hazard={id:0,jobActivityId:n.entity.id,type:null,classification:null,description:null,health:null,exposure:0,observation:"",controlMethodSourceText:"",controlMethodMediumText:"",controlMethodPersonText:"",controlMethodAdministrativeText:"",measureND:null,measureNE:null,measureNC:null,levelP:null,levelIP:null,levelR:null,riskValue:null,riskText:null,exposed:0,contractors:0,visitors:0,interventions:[],reason:null,reasonObservation:null},null!==y&&y.$setPristine(!0)};b(),n.types=[],n.onLoadRecordHazard=function(){if(0!=n.hazard.id){var t={id:n.hazard.id};l({method:"GET",url:"api/customer/config-sgsst/job-activity-hazard/get",params:t})["catch"](function(t,a){}).then(function(t){c(function(){n.hazard=t.data.result,n.reloadDataReason()})})["catch"](function(){c(function(){v.scrollTop(40,2e3)})})}},n.onLoadRecordActivity=function(){if(0!=n.entity.id){var t={id:n.entity.id};l({method:"GET",url:"api/customer/config-sgsst/activity/get",params:t})["catch"](function(t,a){}).then(function(t){c(function(){n.entity=t.data.result})})["finally"](function(){})}else n.loading=!1},n.onLoadRecordHazard(),n.onLoadRecordActivity();var C=function(){var t={};return t.operation="diagnostic",t.customerId=n.customerId,l({method:"POST",url:"api/customer/config-sgsst/wizard/listClassification",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){console.log(t),c(function(){n.classifications=t.data.data})})["catch"](function(t){r.error(t),s.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})},O=function(){var t={};return t.operation="diagnostic",t.customerId=n.customerId,l({method:"POST",url:"api/customer/config-sgsst/wizard/listLevel",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){console.log(t),c(function(){n.measuresND=t.data.data.ND,n.measuresNE=t.data.data.NE,n.measuresNC=t.data.data.NC})})["catch"](function(t){r.error(t),s.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};C(),O(),n.$watch("hazard.classification",function(){if(null!=n.hazard.classification){var t={};return t.operation="diagnostic",t.classificationId=n.hazard.classification.id,l({method:"POST",url:"api/customer/config-sgsst/wizard/listType",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){c(function(){n.types=t.data.data})})["catch"](function(t){})["finally"](function(){})}}),n.$watch("hazard.type",function(){if(null!=n.hazard.classification){var t={};t.operation="diagnostic",t.typeId=n.hazard.type.id,l({method:"POST",url:"api/customer/config-sgsst/wizard/listDescription",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){c(function(){n.descriptions=t.data.data})})["catch"](function(t){})["finally"](function(){}),l({method:"POST",url:"api/customer/config-sgsst/wizard/listEffect",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){c(function(){n.healthEffects=t.data.data})})["catch"](function(t){})["finally"](function(){})}});var T=function(){n.hazard.riskValue=null,n.hazard.riskText=null,null!=n.hazard.measureND&&null!=n.hazard.measureNE&&(n.hazard.levelP=parseFloat(n.hazard.measureND.value)*parseFloat(n.hazard.measureNE.value),n.hazard.levelP>20?n.hazard.levelIP="Muy Alto":n.hazard.levelP>=10&&n.hazard.levelP<=20?n.hazard.levelIP="Alto":n.hazard.levelP>=6&&n.hazard.levelP<=8?n.hazard.levelIP="Medio":n.hazard.levelP>=1&&n.hazard.levelP<=4&&(n.hazard.levelIP="Bajo"),null!=n.hazard.measureNC&&(n.hazard.levelR=parseFloat(n.hazard.levelP)*parseFloat(n.hazard.measureNC.value),n.hazard.levelR>=600&&n.hazard.levelR<=4e3?(n.hazard.riskValue="No Aceptable",n.hazard.riskText="Situación crítica. Suspender actividades hasta que el riesgo esté bajo control. Intervención urgente"):n.hazard.levelR>=150&&n.hazard.levelR<=500?(n.hazard.riskValue="No Aceptable o Aceptable con control especifico",n.hazard.riskText="Corregir y adoptar medidas de control de inmediato. Sin embargo, suspenda actividades si el nivel de riesgo está por encima o igual de 360"):n.hazard.levelR>=40&&n.hazard.levelR<=120?(n.hazard.riskValue="Mejorable",n.hazard.riskText="Mejorar si es posible. Sería conveniente justificar la intervención y su rentabilidad"):n.hazard.levelR>=10&&n.hazard.levelR<=39&&(n.hazard.riskValue="Aceptable",n.hazard.riskText="Mantener las medidas de control existentes, pero se deberían considerar soluciones o mejoras y se deben hacer comprobaciones periódicas para asegurar que el riesgo aún es aceptable")))};n.$watch("hazard.measureND",function(){T()}),n.$watch("hazard.measureNE",function(){T()}),n.$watch("hazard.measureNC",function(){T()}),n.onCloseModal=function(){t.close(1)},n.onCancel=function(){t.dismiss("cancel")},n.onClear=function(){b()},n.form={submit:function(t){y=t;var a=null;if(t.$invalid){var e=null,a=null;for(e in t)"$"!=e[0]&&(null!==a||t[e].$valid||(a=t[e].$name),t[e].$pristine&&(t[e].$dirty=!0));return angular.element(".ng-invalid[name="+a+"]").focus(),void c(function(){d.pop("error","Error","Por favor verifique los datos requeridos del formulario y vuelva a intentarlo")},500)}n.onSave()},reset:function(t){t.$setPristine(!0)}},n.onSave=function(){var t={},a=JSON.stringify(n.hazard);return t.data=Base64.encode(a),l({method:"POST",url:"api/customer/config-sgsst/job-activity-hazard/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){c(function(){d.pop("success","Registro","La información ha sido guardada satisfactoriamente"),n.onClear(),n.reloadData()})})["catch"](function(t){r.error(t),s.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};var z=function(){var t=[p.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,e,i,n){var o=null!=t.document?t.document.path:"",r="",c='<a target="_self" class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+t.id+'" data-url="'+o+'" >   <i class="fa fa-edit"></i></a> ',s=('<a class="btn btn-info btn-xs viewRow lnk" target="_blank" href="'+o+'" uib-tooltip="Abrir anexo" data-id="'+t.id+'" >   <i class="fa fa-folder-open-o"></i></a> ','<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+t.id+'" >   <i class="fa fa-ban"></i></a> '),l='<a class="btn btn-info btn-xs aprovedRow lnk" href="#" uib-tooltip="Revisado Aprobado" data-id="'+t.id+'" >   <i class="fa fa-check"></i></a> ',d='<a class="btn btn-danger btn-xs deniedRow lnk" href="#" uib-tooltip="Revisado Denegado" data-id="'+t.id+'" >   <i class="fa fa-trash"></i></a> ';return a.can("seguimiento_view"),a.can("seguimiento_edit")&&(r+=c),a.can("seguimiento_delete")&&(r+=s),r+=l,r+=d})];return t.push(A("classification.name","Clasificación","",200)),t.push(A("type.name","Tipo Peligro","",200)),t.push(A("description.name","Descripción Peligro","",200)),t.push(A("health.name","Efectos a la Salud","",200)),t.push(A("measureND.name","ND","",200)),t.push(A("measureNE.name","NE","",200)),t.push(A("measureNC.name","NC","",200)),t.push(A(null,"Verificado","",200).renderWith(function(t,a,e,i){var n="",o=null!=t.status?t.status:"";switch(t.status){case"Denegado":n="label label-danger";break;case"Pendiente":n="label label-warning";break;case"Aprobado":n="label label-success"}var r='<span class="'+n+'">'+o+"</span>";return r})),t},A=function(t,a,e,i){return p.newColumn(t).withTitle(a).withOption("defaultContent",e).withOption("width",i)};n.dtInstanceConfigJobActivityHazard={},n.dtOptionsConfigJobActivityHazard=m.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.operation="document",t.jobActivityId=n.entity.id,t},url:"api/customer/config-sgsst/job-activity-hazard",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){P()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,a,e){h(angular.element(t).contents())(n)}),n.dtColumnsConfigJobActivityHazard=z();var P=function(){$("#dtConfigJobActivityHazard a.editRow").on("click",function(){var t=$(this).data("id");n.hazard.id=t,n.onLoadRecordHazard()}),$("#dtConfigJobActivityHazard a.aprovedRow").on("click",function(){var t=$(this).data("id");D(t)}),$("#dtConfigJobActivityHazard a.deniedRow").on("click",function(){var t=$(this).data("id");S(t)}),$("#dtConfigJobActivityHazard a.delRow").on("click",function(){var t=$(this).data("id");s.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(a){if(a){var e={};e.id=t,l({method:"POST",url:"api/customer/config-sgsst/job-activity-hazard/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){r.error(t),s.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){n.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};n.reloadData=function(){n.dtInstanceConfigJobActivityHazard.reloadData()},n.onAddIntervention=function(){c(function(){null==n.hazard.interventions&&(n.hazard.interventions=[]),n.hazard.interventions.push({id:0,hazardId:n.hazard.id,type:null,description:""})})},n.onRemoveIntervention=function(t){s.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(a){a?c(function(){var a=n.hazard.interventions[t];if(0!=a.id){var e={};e.id=a.id,l({method:"POST",url:"api/customer/config-sgsst/job-activity-hazard/intervention/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(a){d.pop("success","Eliminación","Registro eliminado satisfactoriamente"),n.hazard.interventions.splice(t,1)})["catch"](function(t){r.error(t),s.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}else n.hazard.interventions.splice(t,1)}):swal("Cancelación","La operación ha sido cancelada","error")})};var D=function(t){var a={},e={id:t,status:"Aprobado"},i=JSON.stringify(e);return a.data=Base64.encode(i),l({method:"POST",url:"api/customer/config-sgsst/job-activity-hazard/update",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(t){c(function(){d.pop("success","Registro","La información ha sido guardada satisfactoriamente"),n.reloadData()})})["catch"](function(t){r.error(t),s.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})},S=function(t){var e=i.open({templateUrl:a.app.views.urlRoot+"modules/customer/sgsst/activities/customer_profile_config_sgsst_job_activity_tracking_modal.htm",placement:"right",size:"lg",windowTopClass:"top-modal",backdrop:!0,controller:"ModalInstanceSideConfigActivityDangerTrackingCtrl",scope:n,resolve:{hazard:function(){return{id:t}},action:function(){return"Denegado"}}});e.result.then(function(){n.reloadData()})},R=function(){var t=[];return t.push(A("createdAt","Fecha","",200)),t.push(A("name","Usuario","",200)),t.push(A("reason","Motivo","",200)),t.push(A("reasonObservation","Observación","",200)),t};n.dtOptionsConfigJobActivityHazardReason=m.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.jobActivityHazardId=n.hazard.id,JSON.stringify(t)},url:"api/customer-config-activity-hazard-historical-reason",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,a,e){h(angular.element(t).contents())(n)}),n.dtColumnsConfigJobActivityHazardReason=R(),n.dtInstanceConfigJobActivityHazardReasonCallback=function(t){n.dtInstanceConfigJobActivityHazardReason=t},n.reloadDataReason=function(){n.dtInstanceConfigJobActivityHazardReason.reloadData()}}]),app.controller("ModalInstanceSideConfigActivityProcessCtrl",["$uibModal","$rootScope","$location","$scope","$uibModalInstance","activity","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile","$document",function(t,a,e,i,n,o,r,c,s,l,d,u,f,p,m,h,v){i.workplaces=[],i.macros=[],i.processes=[],i.activity=o,i.process={id:0,activityId:i.activity.id,workplace:null,macro:null,process:null,isRoutine:!1},i.types=[];var g=function(){var t={};return t.operation="diagnostic",t.customerId=i.customerId,l({method:"POST",url:"api/customer/config-sgsst/workplace/list",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){c(function(){i.workplaces=t.data.data})})["catch"](function(t){r.error(t),s.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})},w=function(){if(null!=i.process.workplace){var t={};return t.operation="diagnostic",t.customerId=i.customerId,t.workPlaceId=i.process.workplace.id,l({method:"POST",url:"api/customer/config-sgsst/macro/list",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){console.log(t),c(function(){i.macros=t.data.data})})["catch"](function(t){})["finally"](function(){})}i.macros=[]},y=function(){if(null!=i.process.macro){var t={};return t.operation="diagnostic",t.customerId=i.customerId,t.workPlaceId=i.process.workplace.id,t.macroProcessid=i.process.macro.id,l({method:"POST",url:"api/customer/config-sgsst/process/list",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){c(function(){i.processes=t.data.data})})["catch"](function(t){})["finally"](function(){})}i.processes=[]};i.$watch("process.workplace",function(){w()}),i.$watch("process.macro",function(){y()}),g(),i.onLoadRecordActivity=function(){if(0!=i.activity.id){var t={id:i.activity.id};l({method:"GET",url:"api/customer/config-sgsst/activity/get",params:t})["catch"](function(t,a){}).then(function(t){c(function(){i.activity=t.data.result})})["finally"](function(){})}else i.loading=!1},i.onLoadRecordActivity(),i.onCloseModal=function(){n.close(1)},i.onCancel=function(){n.dismiss("cancel")},i.onClear=function(){i.process={id:0,activityId:i.activity.id,workplace:null,macro:null,process:null,isRoutine:!1}},i.form={submit:function(t){var a=null;if(t.$invalid){var e=null,a=null;for(e in t)"$"!=e[0]&&(null!==a||t[e].$valid||(a=t[e].$name),t[e].$pristine&&(t[e].$dirty=!0));return angular.element(".ng-invalid[name="+a+"]").focus(),void c(function(){d.pop("error","Error","Por favor verifique los datos requeridos del formulario y vuelva a intentarlo")},500)}i.onSave()},reset:function(t){t.$setPristine(!0)}},i.onSave=function(){var t={},a=JSON.stringify(i.process);return t.data=Base64.encode(a),l({method:"POST",url:"api/customer/config-sgsst/activity-process/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){c(function(){d.pop("success","Registro","La información ha sido guardada satisfactoriamente"),i.onClear(),i.reloadData()})})["catch"](function(t){r.error(t),s.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};var b={};b.operation="document",b.activityId=i.activity.id,i.dtInstanceConfigActivityProcess={},i.dtOptionsConfigActivityProcess=m.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:b,url:"api/customer/config-sgsst/activity-process",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){C()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,a,e){h(angular.element(t).contents())(i)}),i.dtColumnsConfigActivityProcess=[p.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,e,i,n){var o="",r="",c=('<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar"  data-id="'+t.id+'"'+r+' >   <i class="fa fa-edit"></i></a> ','<a class="btn btn-danger btn-xs delRow lnk" href="#"  uib-tooltip="Eliminar" data-id="'+t.id+'"'+r+' >   <i class="fa fa-trash-o"></i></a> ');return a.can("clientes_delete"),o+=c}),p.newColumn("workplaceText").withTitle(i.matrixColumnLabel1).withOption("width",200),p.newColumn("macroText").withTitle(i.matrixColumnLabel2).withOption("width",200),p.newColumn("processText").withTitle(i.matrixColumnLabel3).withOption("width",200),p.newColumn("isRoutine").withTitle("Rutinaria").withOption("width",200).renderWith(function(t,a,e,i){var n="",o="";t?(n="label label-info",o="Si"):(n="label label-warning",o="No");var r='<span class="'+n+'">'+o+"</span>";return r})];var C=function(){$("#dtConfigActivityProcess a.editRow").on("click",function(){$(this).data("id")}),$("#dtConfigActivityProcess a.delRow").on("click",function(){var t=$(this).data("id");s.swal({title:"Está seguro?",text:"Se eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(a){if(a){var e={};e.id=t,l({method:"POST",url:"api/customer/config-sgsst/activity-process/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(t){d.pop("success","Eliminación","Registro eliminado satisfactoriamente")})["catch"](function(t){r.error(t),s.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){i.reloadData()})}})})};i.reloadData=function(){i.dtInstanceConfigActivityProcess.reloadData()}}]),app.controller("ModalInstanceSideConfigActivityDocumentCtrl",["$stateParams","$rootScope","$scope","$uibModalInstance","$uibModal","activity","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile","$document","ListService",function(t,a,e,i,n,o,r,c,s,l,d,u,f,p,m,h,v,g){function w(){var a=[{name:"customer_employee_document_type",value:t.customerId}];g.getDataList(a).then(function(t){e.requirements=t.data.data.customerEmployeeDocumentType},function(t){e.status="Unable to load customer data: "+t.message})}e.controlMethods=a.parameters("config_control_method"),e.typesMeasure=a.parameters("config_type_measure"),e.activity=o,e.document={id:0,jobActivityId:e.activity.id,type:null},e.types=[],w(),e.onLoadRecordDocument=function(){if(0!=e.document.id){var t={id:e.hazard.id};l({method:"GET",url:"api/customer/config-sgsst/job-activity-document/get",params:t})["catch"](function(t,a){if(403==a){var e=null!==t.message&&void 0!==t.message?t.message:"app.clientes.list";s.swal("No Autorizado","No estas autorizado para ver esta información.","error"),c(function(){$state.go(e)},3e3)}else 404==a?s.swal("Información no disponible","Centro de trabajo no encontrado","error"):s.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(t){c(function(){e.hazard=t.data.result})})["finally"](function(){c(function(){v.scrollTop(40,2e3)})})}},e.onLoadRecordDocument(),e.onLoadRecordActivity=function(){if(0!=e.activity.id){var t={id:e.activity.id};l({method:"GET",url:"api/customer/config-sgsst/activity/get",params:t})["catch"](function(t,a){}).then(function(t){c(function(){e.activity=t.data.result})})["finally"](function(){})}else e.loading=!1},e.onLoadRecordActivity(),e.onCloseModal=function(){i.close(1)},e.onCancel=function(){i.dismiss("cancel")},e.onClear=function(){e.document={id:0,jobActivityId:e.activity.id,type:null}},e.form={submit:function(t){var a=null;if(t.$invalid){var i=null,a=null;for(i in t)"$"!=i[0]&&(null!==a||t[i].$valid||(a=t[i].$name),t[i].$pristine&&(t[i].$dirty=!0));return angular.element(".ng-invalid[name="+a+"]").focus(),void c(function(){d.pop("error","Error","Por favor verifique los datos requeridos del formulario y vuelva a intentarlo")},500)}e.onSave()},reset:function(t){t.$setPristine(!0)}},e.onSave=function(){var t={},a=JSON.stringify(e.document);return t.data=Base64.encode(a),l({method:"POST",url:"api/customer/config-sgsst/job-activity-document/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){c(function(){d.pop("success","Registro","La información ha sido guardada satisfactoriamente"),e.onClear(),e.reloadData()})})["catch"](function(t){r.error(t),s.swal("Error de guardado","El tipo de documento ya existe!","error")})["finally"](function(){})},e.dtInstanceConfigJobActivityDocument={},e.dtOptionsConfigJobActivityDocument=m.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.jobActivityId=e.activity.id,JSON.stringify(t)},url:"api/customer-config-job-activity-document",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){y()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,a,i){h(angular.element(t).contents())(e)}),e.dtColumnsConfigJobActivityDocument=[p.newColumn(null).withTitle("Acciones").withOption("width",80).notSortable().renderWith(function(t,e,i,n){var o="",r='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+t.id+'" >   <i class="fa fa-ban"></i></a> ';return a.can("seguimiento_view"),a.can("seguimiento_edit"),a.can("seguimiento_delete"),o+=r}),p.newColumn("type").withTitle("Tipo Documento").withOption("defaultContent",200),p.newColumn("createdAt").withTitle("Fecha").withOption("width",200),p.newColumn("createdBy").withTitle("Usuario").withOption("defaultContent",200)];var y=function(){$("#dtConfigJobActivityDocument a.editRow").on("click",function(){var t=$(this).data("id");e.hazard.id=t,e.onLoadRecordDocument()}),$("#dtConfigJobActivityDocument a.delRow").on("click",function(){
var t=$(this).data("id");s.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(a){if(a){var i={};i.id=t,l({method:"POST",url:"api/customer/config-sgsst/job-activity-document/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){r.error(t),s.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){e.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};e.reloadData=function(){e.dtInstanceConfigJobActivityDocument.reloadData()}}]),app.controller("ModalInstanceSideConfigActivityDangerTrackingCtrl",["$scope","$uibModalInstance","$uibModal","hazard","action","$log","$timeout","SweetAlert","$http","toaster",function(t,a,e,i,n,o,r,c,s,l){t.tracking={id:i.id,status:n,description:""},t.onCloseModal=function(){a.close(1)},t.onCancel=function(){a.dismiss("cancel")},t.master=t.tracking,t.form={submit:function(t){var a=null;if(t.$invalid){var e=null,a=null;for(e in t)"$"!=e[0]&&(null!==a||t[e].$valid||(a=t[e].$name),t[e].$pristine&&(t[e].$dirty=!0));return angular.element(".ng-invalid[name="+a+"]").focus(),void l.pop("error","Error","Por favor verifique los datos requeridos del formulario y vuelva a intentarlo")}d()},reset:function(a){t.clear()}};var d=function(){var a={},e=JSON.stringify(t.tracking);return a.data=Base64.encode(e),s({method:"POST",url:"api/customer/config-sgsst/job-activity-hazard/update",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(a){r(function(){l.pop("success","Registro","La información ha sido guardada satisfactoriamente"),t.onCloseModal()})})["catch"](function(t){o.error(t),c.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})}}]);
"use strict";app.controller("customerConfigJobCtrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout",function(o,t,e,n,r,c){var i=e;i.info("loading..customerTrackingCtrl!!! "),o.job_section="list",o.currentId=0,o.editMode="edit",o.controllerName="customerConfigJobCtrl",o.navToSection=function(t,e,n){c(function(){o.job_section=t,o.editMode=e,o.currentId=n})}}]);
"use strict";app.controller("customerConfigJobListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$document",function(n,t,e,a,i,o,r,s,l,c,d,u,f,w){var m=e,p=null;n.loading=!0,n.isView=l.is("app.clientes.view"),n.status=c.parameters("config_workplace_status"),n.onLoadRecord=function(t){if(0!=t){var e={id:t};u({method:"GET",url:"api/customer/config-sgsst/job-data/get",params:e})["catch"](function(n,t){if(403==t){var e=null!==n.message&&void 0!==n.message?n.message:"app.clientes.list";f.swal("No Autorizado","No estas autorizado para ver esta información.","error"),d(function(){l.go(e)},3e3)}else 404==t?f.swal("Información no disponible","Centro de trabajo no encontrado","error"):f.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(t){d(function(){n.entity=t.data.result})})["finally"](function(){})}else m.info("creacion de nuevo cliente"),n.loading=!1};var g=function(){n.entity={id:0,customerId:t.customerId,name:"",status:null},null!==p&&p.$setPristine(!0)};g(),n.form={submit:function(t){p=t;var e=null;if(t.$invalid){var a=null,e=null;for(a in t)"$"!=a[0]&&(null!==e||t[a].$valid||(e=t[a].$name),t[a].$pristine&&(t[a].$dirty=!0));return m.info(n.job),angular.element(".ng-invalid[name="+e+"]").focus(),void f.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}h()},reset:function(n){n.$setPristine(!0)}};var h=function(){var t={},a=JSON.stringify(n.entity);return t.data=Base64.encode(a),u({method:"POST",url:"api/customer/config-sgsst/job-data/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){d(function(){f.swal("Registro","La información ha sido guardada satisfactoriamente","success"),n.reloadData(),n.onCancel()})})["catch"](function(n){e.error(n),f.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};n.dtOptionsConfigJob=a.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(n){return n.customerId=t.customerId,n},url:"api/customer/config-sgsst/job-data",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){b()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,e,a){r(angular.element(t).contents())(n)}),n.dtColumnsConfigJob=[i.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,e,a,i){var o="",r="",s='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar"  data-id="'+t.id+'"'+r+' >   <i class="fa fa-edit"></i></a> ',l='<a class="btn btn-info btn-xs viewRow lnk" href="#"  uib-tooltip="Ver" data-id="'+t.id+'" >   <i class="fa fa-eye"></i></a> ',d='<a class="btn btn-danger btn-xs delRow lnk" href="#"  uib-tooltip="Eliminar" data-id="'+t.id+'"'+r+' >   <i class="fa fa-trash-o"></i></a> ';return c.can("clientes_view")&&(o+=l),c.can("clientes_edit")&&(o+=s),c.can("clientes_delete")&&(o+=d),n.isView?l:o}),i.newColumn("name").withTitle("Cargo"),i.newColumn("status.item").withTitle("Estado").withOption("width",200).renderWith(function(n,t,e,a){var i="";switch(n){case"Activo":i="label label-success";break;case"Inactivo":i="label label-danger";break;case"Retirado":i="label label-warning"}var o='<span class="'+i+'">'+n+"</span>";return o})];var b=function(){$("#dtConfigJob a.editRow").on("click",function(){var t=$(this).data("id");n.isView=!1,n.onLoadRecord(t)}),$("#dtConfigJob a.viewRow").on("click",function(){var t=$(this).data("id");n.isView=!0,n.onLoadRecord(t)}),$("#dtConfigJob a.delRow").on("click",function(){var t=$(this).data("id");m.info("intenta eliminar el registro: "+t),f.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(e){if(e){var a={};a.id=t,u({method:"POST",url:"api/customer/config-sgsst/job-data/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(n){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(n){f.swal("Error en la eliminación",n.data.message,"error")})["finally"](function(){n.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};n.dtInstanceConfigJobCallback=function(t){n.dtInstanceConfigJob=t},n.reloadData=function(){n.dtInstanceConfigJob.reloadData()},n.onCancel=function(){g(),n.isView=!1}}]);
"use strict";app.controller("customerConfigJobActivityHazardCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$document","$aside","$location","ListService","$filter","moment","$translate",function(t,i,e,n,a,o,r,l,c,s,d,u,m,f,p,w,h,v,C,g){function b(){var e={customerId:i.customerId,workplaceId:t.entity.workplace?t.entity.workplace.id:0,macroprocessId:t.entity.macroprocess?t.entity.macroprocess.id:0},n=[{name:"customer_workplace",value:i.customerId,criteria:e},{name:"customer_macroprocess",value:i.customerId,criteria:e},{name:"customer_process",value:i.customerId,criteria:e},{name:"customer_job",value:i.customerId,criteria:e}];h.getDataList(n).then(function(i){t.workplaceList=i.data.data.workplaceList,t.macroprocessList=i.data.data.macroprocessList,t.processList=i.data.data.processList,t.jobList=i.data.data.jobList},function(i){t.status="Unable to load customer data: "+i.message})}var y=e,O=null;t.loading=!1;var T=function(){t.entity={id:0,customerId:i.customerId,workplace:null,macroprocess:null,process:null,job:null,activityList:[]},null!==O&&(O.$setPristine(!0),t.macroprocessList=[],t.processList=[],t.jobList=[])};T(),b();var A=function(i){if(0!=i){var e={id:i};u({method:"GET",url:"api/customer-config-job-activity/get",params:e})["catch"](function(t,i){if(403==i){var e=null!==t.message&&void 0!==t.message?t.message:"app.clientes.list";m.swal("No Autorizado","No estas autorizado para ver esta información.","error"),d(function(){c.go(e)},3e3)}else 404==i?m.swal("Información no disponible","Centro de trabajo no encontrado","error"):m.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(i){d(function(){t.entity=i.data.result,b()})})["finally"](function(){})}else t.loading=!1};t.form={submit:function(i){O=i;var e=null;if(i.$invalid){var n=null,e=null;for(n in i)"$"!=n[0]&&(null!==e||i[n].$valid||(e=i[n].$name),i[n].$pristine&&(i[n].$dirty=!0));return y.info(t.job),angular.element(".ng-invalid[name="+e+"]").focus(),void m.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}I()},reset:function(t){t.$setPristine(!0)}};var I=function(){var i="";if(null!=t.entity.activityList&&0!=t.entity.activityList.length||(i+="Debe seleccionar al menos una actividad"),""!=i)return void m.swal({html:!0,title:"Error de validación",text:i,type:"error"});var e={},n=JSON.stringify(t.entity);return e.data=Base64.encode(n),u({method:"POST",url:"api/customer-config-job-activity/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(i){d(function(){void 0!==i.data.result.sucess&&void 0===i.data.result.error?(m.swal("Registro","La información ha sido guardada satisfactoriamente","success"),t.reloadData(),t.onClear()):void 0!==i.data.result.sucess&&void 0!==i.data.result.error?(m.swal({html:!1,title:"Operación exitosa con excepciones",text:"La información ha sido guardada satisfactoriamente, excepto para:\n\n"+i.data.result.error.join("."),type:"success"}),t.reloadData(),t.onClear()):m.swal({html:!1,title:"Error de validación",text:i.data.result.error.join("."),type:"error"})})})["catch"](function(t){m.swal("Error de guardado",t.data.message,"error")})["finally"](function(){})};t.onCancel=function(){null!=t.$parent&&t.$parent.navToSection("list","list",0)},t.onClear=function(){T()},t.refreshWorkPlace=function(){b()},t.refreshMacro=function(){b()},t.refreshProcess=function(){b()},t.onRefreshJob=function(){b()},t.onRefreshActivity=function(){b()},t.onSelectWorkplace=function(){b()},t.onSelectMacroprocess=function(){b()},t.onSelectProcess=function(){b()},t.onAddActivity=function(){var i=p.open({templateUrl:s.app.views.urlRoot+"modules/common/modals/data_table_list_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideCustomerConfigActivityListCtrl",scope:t});i.result.then(function(){},function(){})},t.initializeActivity=function(i){void 0!==t.entity.activityList&&null!=t.entity.activityList||(t.entity.activityList=[]);var e=v("filter")(t.entity.activityList,{id:i.id});0==e.length&&(l.pop("success","Adición","El registro ha sido adicionada satisfactoriamente"),t.entity.activityList.push({id:i.id,name:i.name,isRoutine:!1}))},t.onRemoveActivity=function(i){m.swal({title:"Está seguro?",text:"Desea confirmar la eliminación de este registro?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(e){e?d(function(){t.entity.activityList.splice(i,1)}):swal("Cancelación","La operación ha sido cancelada","error")})},t.dtOptionsCustomerConfigJobActivity=n.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.customerId=i.customerId,JSON.stringify(t)},url:"api/customer-config-job-activity",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){L()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(i,e,n){r(angular.element(i).contents())(t)}),t.dtColumnsCustomerConfigJobActivity=[a.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,i,e,n){var a="",o='<a class="btn btn-info btn-xs hazardRow lnk" href="#"  uib-tooltip="Adicionar Peligro Existente" data-id="'+t.id+'" >   <i class="fa fa-cog"></i></a> ',r='<a class="btn btn-primary btn-xs editRow lnk" href="#"  uib-tooltip="Editar" data-id="'+t.id+'" >   <i class="fa fa-edit"></i></a> ',l='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+t.id+'" >   <i class="fa fa-trash-o"></i></a> ';return s.can("entity_view"),a+=o,s.can("entity_edit"),s.can("entity_delete"),a+=r,a+=l}),a.newColumn("workplace").withTitle(g.instant("grid.matrix.WORK-PLACE")).withOption("width",200).withOption("defaultContent",""),a.newColumn("macroprocess").withTitle(g.instant("grid.matrix.MACROPROCESS")).withOption("width",200).withOption("defaultContent",""),a.newColumn("process").withTitle(g.instant("grid.matrix.PROCESS")).withOption("width",200).withOption("defaultContent",""),a.newColumn("job").withTitle("Cargo").withOption("width",200).withOption("defaultContent",""),a.newColumn("activity").withTitle(g.instant("grid.matrix.ACTIVITY")).withOption("width",200).withOption("defaultContent",""),a.newColumn("updatedBy").withTitle("Usuario").withOption("width",200).withOption("defaultContent",""),a.newColumn(null).withTitle("Fecha Última Actualización").withOption("width",200).renderWith(function(t,i,e,n){if("object"==typeof t.updatedAt&&t.updatedAt){var a=new C(t.updatedAt.date);return a.format("DD-MM-YYYY HH:mm")}return t.updatedAt})];var L=function(){angular.element("#dtCustomerConfigJobActivity a.editRow").on("click",function(){var t=angular.element(this).data("id");A(t)}),angular.element("#dtCustomerConfigJobActivity a.hazardRow").on("click",function(){var i=angular.element(this).data("id");t.onAddHazard({id:i})}),angular.element("#dtCustomerConfigJobActivity a.delRow").on("click",function(){var i=angular.element(this).data("id");m.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(e){if(e){var n={};n.id=i,u({method:"POST",url:"api/customer-config-job-activity/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(t){swal("Eliminado","Regitro eliminado satisfactoriamente","info")})["catch"](function(t){m.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro por favor intentelo de nuevo","error")})["finally"](function(){t.reloadData()})}else swal("Cancelado","Operacion cancelada","error")})})};t.dtInstanceCustomerConfigJobActivityCallback=function(i){t.dtInstanceCustomerConfigJobActivity=i},t.reloadData=function(){null!=t.dtInstanceCustomerConfigJobActivity&&t.dtInstanceCustomerConfigJobActivity.reloadData()},t.onAddHazard=function(i){var e=p.open({templateUrl:s.app.views.urlRoot+"modules/customer/sgsst/hazard/customer_profile_config_sgsst_job_activity_hazard_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideCustomerConfigJobActivityHazardCtrl",scope:t,resolve:{activity:function(){return i}}});e.result.then(function(){t.reloadData()},function(){})}}]),app.controller("ModalInstanceSideCustomerConfigActivityListCtrl",["$rootScope","$stateParams","$scope","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile","$translate",function(t,i,e,n,a,o,r,l,c,s,d,u,m,f,p){e.title=p.instant("views.MATRIX-ACTIVITY-AVAILABLE"),e.onCloseModal=function(){n.close()},e.onCancel=function(){n.dismiss("cancel")};e.dtInstanceCommonDataTableList={},e.dtOptionsCommonDataTableList=m.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.customerId=i.customerId,t},url:"api/customer/config-sgsst/activity",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){w()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,i,n){f(angular.element(t).contents())(e)}),e.dtColumnsCommonDataTableList=[u.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,i,e,n){var a="",o="",r='<a class="btn btn-success btn-xs editRow lnk" href="#" uib-tooltip="Adicionar"  data-id="'+t.id+'"  data-text="'+t.name+'"'+o+' >   <i class="fa fa-plus-square"></i></a> ';return a+=r}),u.newColumn("name").withTitle(p.instant("grid.matrix.ACTIVITY")),u.newColumn("isCritical").withTitle("Crítica").withOption("width",200).renderWith(function(t,i,e,n){var a="",o="";t?(a="label label-info",o="Si"):(a="label label-warning",o="No");var r='<span class="'+a+'">'+o+"</span>";return r}),u.newColumn("status.item").withTitle("Estado").withOption("width",200).renderWith(function(t,i,e,n){var a="";switch(t){case"Activo":a="label label-success";break;case"Inactivo":a="label label-danger";break;case"Retirado":a="label label-warning"}var o='<span class="'+a+'">'+t+"</span>";return o})];var w=function(){$("#dtCommonDataTableList a.editRow").on("click",function(){var t=$(this).data("id"),i=$(this).data("text");e.initializeActivity({id:t,name:i})})};e.dtInstanceCommonDataTableListCallback=function(t){e.dtInstanceCommonDataTableList=t},e.reloadData=function(){e.dtInstanceCommonDataTableList.reloadData()}}]);
"use strict";app.controller("ModalInstanceSideCustomerConfigJobActivityHazardCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$document","$aside","$location","ListService","$filter","$uibModalInstance","$uibModal","activity",function(t,i,a,n,o,e,r,l,c,s,d,u,f,p,m,v,g,C,h,b,w){var y=null;t.relation=w;var A=function(){t.entity={id:0,customerConfigJobActivityId:t.relation.id,customerConfigJobActivityHazard:null,jobActivityId:0},null!==y&&y.$setPristine(!0)};A(),t.onLoadRecordRelation=function(){if(0!=t.relation.id){var i={id:t.relation.id};u({method:"GET",url:"api/customer-config-job-activity/get",params:i})["catch"](function(t,i){}).then(function(i){d(function(){t.relation=i.data.result,t.reloadDataAvailable()})})["finally"](function(){})}else t.loading=!1},t.onLoadRecordRelation(),t.onCloseModal=function(){h.close(1)},t.onCancel=function(){h.dismiss("cancel")},t.onClear=function(){A()},t.form={submit:function(i){y=i;var a=null;if(i.$invalid){var n=null,a=null;for(n in i)"$"!=n[0]&&(null!==a||i[n].$valid||(a=i[n].$name),i[n].$pristine&&(i[n].$dirty=!0));return angular.element(".ng-invalid[name="+a+"]").focus(),void d(function(){l.pop("error","Error","Por favor verifique los datos requeridos del formulario y vuelva a intentarlo")},500)}t.onSave()},reset:function(t){t.$setPristine(!0)}},t.onSave=function(){var i={},n=JSON.stringify(t.entity);return i.data=Base64.encode(n),u({method:"POST",url:"api/customer-config-job-activity-hazard-relation/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(i){d(function(){l.pop("success","Registro","La información ha sido guardada satisfactoriamente"),t.onClear(),t.reloadData(),t.reloadDataAvailable()})})["catch"](function(t){a.error(t),f.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})},t.onBatch=function(){t.entity.jobActivityId=t.relation.activityList?t.relation.activityList[0].id:0;var i={},n=JSON.stringify(t.entity);return i.data=Base64.encode(n),u({method:"POST",url:"api/customer-config-job-activity-hazard-relation/batch",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(i){d(function(){l.pop("success","Registro","La información ha sido guardada satisfactoriamente"),t.onClear(),t.reloadData(),t.reloadDataAvailable()})})["catch"](function(t){a.error(t),f.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};var O=function(t,i,a,n){return o.newColumn(t).withTitle(i).withOption("defaultContent",a).withOption("width",n)};t.dtOptionsCustomerConfigJobActivityHazardRelation=n.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(i){return i.customerConfigJobActivityId=t.relation.id,JSON.stringify(i)},url:"api/customer-config-job-activity-hazard-relation",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){D()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(i,a,n){r(angular.element(i).contents())(t)}),t.dtColumnsCustomerConfigJobActivityHazardRelation=[o.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,i,a,n){var o="",e='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+t.id+'" >   <i class="fa fa-trash"></i></a> ';return o+=e}),O("classification","Clasificación","",200),O("type","Tipo Peligro","",200),O("description","Descripción Peligro","",200),O("effect","Efectos a la salud","",200),O("measureND","ND","",200),O("measureNE","NE","",200),O("measureNC","NC","",200),O("riskValue","Valoración del Riesgo","",200)];var D=function(){angular.element("#dtCustomerConfigJobActivityHazardRelation a.delRow").on("click",function(){var i=angular.element(this).data("id");f.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(a){if(a){var n={};n.id=i,u({method:"POST",url:"api/customer-config-job-activity-hazard-relation/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(t){swal("Eliminado","Regitro eliminado satisfactoriamente","info")})["catch"](function(t){f.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro por favor intentelo de nuevo","error")})["finally"](function(){t.reloadData(),t.reloadDataAvailable()})}else swal("Cancelado","Operacion cancelada","error")})})};t.dtInstanceCustomerConfigJobActivityHazardRelationCallback=function(i){t.dtInstanceCustomerConfigJobActivityHazardRelation=i},t.reloadData=function(){null!=t.dtInstanceCustomerConfigJobActivityHazardRelation&&t.dtInstanceCustomerConfigJobActivityHazardRelation.reloadData()},t.dtOptionsCustomerConfigJobActivityHazardAvailable=n.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(i){return i.jobActivityId=t.relation.activityList?t.relation.activityList[0].id:0,i.customerConfigJobActivityId=t.relation.id,JSON.stringify(i)},url:"api/customer-config-job-activity-hazard-available",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){J()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(i,a,n){r(angular.element(i).contents())(t)}),t.dtColumnsCustomerConfigJobActivityHazardAvailable=[o.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,i,a,n){var o="",e='<a class="btn btn-success btn-xs addRow lnk" href="#" uib-tooltip="Adicionar" data-id="'+t.id+'" >   <i class="fa fa-plus-square"></i></a> ';return o+=e}),O("classification","Clasificación","",200),O("type","Tipo Peligro","",200),O("description","Descripción Peligro","",200),O("effect","Efectos a la salud","",200),O("measureND","ND","",200),O("measureNE","NE","",200),O("measureNC","NC","",200),O("riskValue","Valoración del Riesgo","",200)];var J=function(){angular.element("#dtCustomerConfigJobActivityHazardAvailable a.addRow").on("click",function(){if(!angular.element(this).hasClass("disabled")){angular.element(this).addClass("disabled");var i=angular.element(this).data("id");t.entity.customerConfigJobActivityHazard={id:i},t.onSave()}}),angular.element("#dtCustomerConfigJobActivityHazardAvailable a.viewRow").on("click",function(){var i=angular.element(this).data("id");t.onView(i)})};t.dtInstanceCustomerConfigJobActivityHazardAvailableCallback=function(i){t.dtInstanceCustomerConfigJobActivityHazardAvailable=i},t.reloadDataAvailable=function(){null!=t.dtInstanceCustomerConfigJobActivityHazardAvailable&&t.dtInstanceCustomerConfigJobActivityHazardAvailable.reloadData()}}]);
"use strict";app.controller("customerConfigWizardCtrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout",function(o,t,i,r,e,n){var c=i;c.info("loading..customerConfigWizardCtrl!!! "),o.wizard_section="list",o.currentId=0,o.modeDsp="edit",o.navToSection=function(t,i,r){n(function(){o.wizard_section=t,o.modeDsp=i,o.currentId=r})}}]);
"use strict";app.controller("customerConfigWizardEditCtrl",["$scope","$location","$stateParams","$log","$compile","$state","SweetAlert","$rootScope","$http","$timeout","$uibModal","flowFactory","cfpLoadingBar","$filter",function(t,n,e,o,r,i,a,l,c,u,p,$,s,f){t.currentStep=0,t.form={next:function(n){if(t.toTheTop(),n.$valid)T();else{var e=null,o=null;for(e in n)"$"!=e[0]&&(null!==o||n[e].$valid||(o=n[e].$name),n[e].$pristine&&(n[e].$dirty=!0));angular.element(".ng-invalid[name="+o+"]").focus()}},prev:function(n){t.toTheTop(),m()},goTo:function(n,e){parseInt(t.currentStep)>parseInt(e)?(t.toTheTop(),d(e)):(t.toTheTop(),d(e))},reset:function(n){t.report=angular.copy(t.master),n.$setPristine(!0)}};var T=function(){t.currentStep++},m=function(){t.currentStep--},d=function(n){t.currentStep=n};t.onCancel=function(){null!=t.$parent&&t.$parent.navToSection("list","list",0)}}]);
"use strict";app.controller("customerConfigWizardActivityCtrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout",function(o,t,e,n,c,i){o.view_component="list",o.currentId=0,o.modeDsp="edit",o.navToSection=function(t,e,n){i(function(){o.view_component=t,o.modeDsp=e,o.currentId=n})}}]);
"use strict";app.controller("customerConfigWizardActivityImportCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$document","FileUploader","$location","$translate","ListService",function(t,n,o,e,i,a,r,l,c,u,s,d,p,m,f,g,w,h){function v(){var n=[{name:"export_url",value:null}];h.getDataList(n).then(function(n){I=n.data.data.exportUrl.item,C.url=I+b,t.uploader.url=I+b},function(n){t.status="Unable to load customer data: "+n.message})}t.loading=!0,t.customerId=n.customerId;var I="",b="api/v1/customer-config-activity-import",C=t.uploader=new f({url:I+b,formData:[],removeAfterUpload:!0});v(),C.filters.push({name:"customFilter",fn:function(t,n){return this.queue.length<10}}),C.onWhenAddingFileFailed=function(t,n,o){},C.onAfterAddingFile=function(t){},C.onAfterAddingAll=function(t){},C.onBeforeUploadItem=function(t){var o={customerId:n.customerId};t.formData.push(o)},C.onProgressItem=function(t,n){},C.onProgressAll=function(t){},C.onSuccessItem=function(t,n,o,e){},C.onErrorItem=function(t,n,o,e){},C.onCancelItem=function(t,n,o,e){},C.onCompleteItem=function(n,o,e,i){o&&o.sessionId&&null!=t.$parent&&t.$parent.navToSection("staging","staging",o.sessionId)},C.onCompleteAll=function(){t.reloadData()},t.onImport=function(){return 0==t.uploader.queue.length?void p.swal("El formulario contiene errores!","Por favor seleccione un archivo e Intentalo de nuevo.","error"):void C.uploadAll()},t.onClear=function(){},t.onDownload=function(){angular.element("#downloadDocument")[0].src="api/customer-config-activity/download-template"},t.dtInstanceConfigJobActivityImport={},t.dtOptionsConfigJobActivityImport=e.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.operation="diagnostic",t.customerId=n.customerId,t},url:"api/customer/config-sgsst/activity",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(n,o,e){r(angular.element(n).contents())(t)}),t.dtColumnsConfigJobActivityImport=[i.newColumn("name").withTitle(w.instant("grid.matrix.ACTIVITY")),i.newColumn("isCritical").withTitle("Crítica").withOption("width",200).renderWith(function(t,n,o,e){var i="",a="";t?(i="label label-info",a="Si"):(i="label label-warning",a="No");var r='<span class="'+i+'">'+a+"</span>";return r}),i.newColumn("status.item").withTitle("Estado").withOption("width",200).renderWith(function(t,n,o,e){var i="";switch(t){case"Activo":i="label label-success";break;case"Inactivo":i="label label-danger";break;case"Retirado":i="label label-warning"}var a='<span class="'+i+'">'+t+"</span>";return a})],t.reloadData=function(){t.dtInstanceConfigJobActivityImport.reloadData()},t.cancelEdition=function(o){null!=t.$parent&&t.$parent.navToSection("summary","summary",n.customerId)}}]);
"use strict";app.controller("customerConfigWizardActivityStagingListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$document","$filter","$aside","ListService","$translate",function(t,i,n,e,o,a,r,l,s,c,u,d,f,p,w,h,m,g){function v(){var i=[{name:"export_url",value:null}];m.getDataList(i).then(function(t){C=t.data.data.exportUrl.item},function(i){t.status="Unable to load customer data: "+i.message})}var C="";t.audit={fields:[],filters:[]},v(),t.dtInstanceCustomerConfigWizardActivityStagingDT={},t.dtOptionsCustomerConfigWizardActivityStagingDT=e.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(n){return n.customerId=i.customerId,n.sessionId=t.$parent.currentId,JSON.stringify(n)},url:"api/customer-config-activity-staging",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[1,"asc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){y()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(i,n,e){r(angular.element(i).contents())(t)}),t.dtColumnsCustomerConfigWizardActivityStagingDT=[o.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,i,n,e){var o="",a='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar"  data-id="'+t.id+'"'+o+' >   <i class="fa fa-edit"></i></a> ';return 0!=t.isValid&&t.isValid?null:a}),o.newColumn(null).withTitle("Fila").withOption("width",50).renderWith(function(t,i,n,e){var o=1==t.isValid||t.isValid?"badge badge-success":"badge badge-danger",a=1==t.isValid||t.isValid?' <i class=" fa fa-check"></i>':' <i class=" fa fa-ban"></i>';return'<span class="'+o+'">'+t.index+a+"</span>"}),o.newColumn("name").withTitle(g.instant("grid.matrix.ACTIVITY")).withOption("width",200),o.newColumn("status").withTitle("Estado").withOption("width",200),o.newColumn("isCritical").withTitle("Crítica").withOption("width",200),o.newColumn("classification").withTitle("Clasificación").withOption("width",200),o.newColumn("type").withTitle("Tipo Peligro").withOption("width",200),o.newColumn("description").withTitle("Descripción").withOption("width",200),o.newColumn("healthEffect").withTitle("Efectos en la Salud").withOption("width",200),o.newColumn("observationHazard").withTitle("Observación").withOption("width",200),o.newColumn("timeExposure").withTitle("Tiempo Exposición").withOption("width",200),o.newColumn("controlMethodSourceText").withTitle("Método de Control Fuente").withOption("width",200),o.newColumn("controlMethodMediumText").withTitle("Método de Control Medio").withOption("width",200),o.newColumn("controlMethodPersonText").withTitle("Método de Control Persona").withOption("width",200),o.newColumn("measureNd").withTitle("Nivel Deficiencia (ND)").withOption("width",200),o.newColumn("measureNe").withTitle("Nivel Exposición (NE)").withOption("width",200),o.newColumn("measureNc").withTitle("Nivel Consecuencia (NC)").withOption("width",200),o.newColumn("exposed").withTitle("Trabajadores Vinculados o en Misión").withOption("width",200),o.newColumn("contractors").withTitle("Trabajadores Contratistas").withOption("width",200),o.newColumn("visitors").withTitle("Visitantes").withOption("width",200),o.newColumn("typeIntervention").withTitle("Tipo Medida de Intervención").withOption("width",200),o.newColumn("descriptionIntervention").withTitle("Medida").withOption("width",200),o.newColumn("trackingIntervention").withTitle("Seguimiento y Medición").withOption("width",200),o.newColumn("observationIntervention").withTitle("Observación Intervención").withOption("width",200),o.newColumn("observation").withTitle("Observación").withOption("width",280).withOption("defaultContent","")];var y=function(){angular.element("#dataCustomerConfigWizardActivityStagingDT a.editRow").on("click",function(){var t=angular.element(this).data("id");T(t)})};t.dtInstanceCustomerConfigWizardActivityStagingDTCallback=function(i){t.dtInstanceCustomerConfigWizardActivityStagingDT=i},t.reloadData=function(){t.dtInstanceCustomerConfigWizardActivityStagingDT.reloadData()};var T=function(i){var n=h.open({templateUrl:c.app.views.urlRoot+"modules/customer/sgsst/massive/activity/customer_profile_config_sgsst_wizard_tab_activity_staging_modal.htm",placement:"right",windowTopClass:"top-modal",size:"lg",backdrop:!0,controller:"ModalInstanceSideCustomerConfigWizardActivityStagingEditCtrl",scope:t,resolve:{dataItem:function(){return{id:i?i:0}},isView:function(){return t.isView}}});n.result.then(function(i){t.reloadData()},function(){})};t.onCancel=function(){p.scrollTop(40,2e3),null!=t.$parent&&t.$parent.navToSection("list","list")},t.onProcess=function(){f.swal({title:"Confirma la importación de los registros?",text:"Se importarán los registros válidos. Una vez realizado este proceso no se podrán realizar cambios.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, confirmar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(e){if(e)return d({method:"POST",url:C+"api/v1/customer-config-activity-confirm",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param({id:i.customerId,sessionId:t.$parent.currentId})}).then(function(i){u(function(){f.swal("Registro","La información ha sido importada satisfactoriamente","success"),t.onCancel()})})["catch"](function(t){n.error(t),f.swal("Error de guardado",t.data.message,"error")})["finally"](function(){})})}}]),app.controller("ModalInstanceSideCustomerConfigWizardActivityStagingEditCtrl",["$rootScope","$stateParams","$scope","dataItem","isView","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","ngNotify","$document","$filter","$aside","ListService",function(t,i,n,e,o,a,r,l,s,c,u,d,f,p,w,h){function m(){var t=[{name:"config_hazard_classification",value:null},{name:"config_workplace_status",value:null},{name:"yes_no_letter_options",value:null},{name:"config_type_measure",value:null},{name:"hazard_tracking",value:null}];h.getDataList(t).then(function(t){n.classificationList=t.data.data.configHazardClassification,n.statusList=t.data.data.config_workplace_status,n.yesNoList=t.data.data.activeOptions,n.typesMeasureList=t.data.data.config_type_measure,n.trackingInterventionList=t.data.data.hazard_tracking},function(t){n.status="Unable to load customer data: "+t.message})}function g(){var t=[{name:"config_hazard_description",value:n.entity.type?n.entity.type.id:null},{name:"config_hazard_health_effect",value:n.entity.type?n.entity.type.id:null}];h.getDataList(t).then(function(t){n.descriptionList=t.data.data.configHazardDescription,n.healthEffectList=t.data.data.configHazardHealthEffect},function(t){n.status="Unable to load customer data: "+t.message})}function v(){var t=[{name:"config_hazard_type",value:n.entity.classification?n.entity.classification.id:null}];h.getDataList(t).then(function(t){n.typeList=t.data.data.configHazardType},function(t){n.status="Unable to load customer data: "+t.message})}n.onCloseModal=function(){a.close(null)},n.onCancel=function(){a.dismiss("cancel")},m(),n.isView=o;var C=function(){n.entity={id:e.id,customerId:n.customerId,name:null,status:null,isCritital:null,classification:null,type:null,description:null,healthEffect:null,timeExposure:0,observationHazard:null,controlMethodSourceText:null,controlMethodMediumText:null,controlMethodPersonText:null,measureNd:null,measureNe:null,measureNc:null,exposed:0,contractors:0,visitors:0,typeIntervention:null,descriptionIntervention:null,trackingIntervention:null,observationIntervention:null}};C(),n.onLoadRecord=function(){c({method:"GET",url:"api/customer-config-activity-staging/get",params:{id:n.entity.id}})["catch"](function(t,i){}).then(function(t){n.entity=t.data.result,v(),g()})["finally"](function(){})},n.onLoadRecord(),n.onSelectClassification=function(){v()},n.onSelectType=function(){g()},n.form={submit:function(t){var i=null;if(t.$invalid){var n=null,i=null;for(n in t)"$"!=n[0]&&(null!==i||t[n].$valid||(i=t[n].$name),t[n].$pristine&&(t[n].$dirty=!0));return angular.element(".ng-invalid[name="+i+"]").focus(),void s.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}T()},reset:function(t){}};var y=function(t){return null==t||0==t.replace(/^\s+|\s+$/g,"").length},T=function(){if(null!=n.entity.typeIntervention||!y(n.entity.descriptionIntervention)||null!=n.entity.trackingIntervention||!y(n.entity.observationIntervention)){var t=[];if(null==n.entity.typeIntervention&&t.push("Debe seleccionar Tipo Medida de Intervención"),y(n.entity.descriptionIntervention)&&t.push("Debe ingresar Medida"),null==n.entity.trackingIntervention&&t.push("Debe seleccionar Seguimiento y Medición"),y(n.entity.observationIntervention)&&t.push("Debe ingresar Observación"),t.length>0)return void s.swal({html:!0,title:"Error de validación",text:t.join("<br/>"),type:"error"})}var i=JSON.stringify(n.entity),e={data:Base64.encode(i)};return c({method:"POST",url:"api/customer-config-activity-staging/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(t){l(function(){s.swal("Registro","La información ha sido guardada satisfactoriamente","success"),a.close(null)})})["catch"](function(t){r.error(t),s.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})}}]);
"use strict";app.controller("customerConfigWizardMacroProcessesCtrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout",function(o,e,t,c,n,r){o.view_component="list",o.currentId=0,o.modeDsp="edit",o.navToSection=function(e,t,c){r(function(){o.view_component=e,o.modeDsp=t,o.currentId=c})}}]);
"use strict";app.controller("customerConfigWizardMacroProcessesImportCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$document","FileUploader","$location","$translate","ListService",function(t,n,o,e,r,a,i,l,c,s,u,d,p,m,f,w,g,h){function I(){var n=[{name:"export_url",value:null}];h.getDataList(n).then(function(n){C=n.data.data.exportUrl.item,O.url=C+v,t.uploader.url=C+v},function(n){t.status="Unable to load customer data: "+n.message})}t.loading=!0,t.customerId=n.customerId;var C="",v="api/v1/customer-config-macroprocess-import",O=t.uploader=new f({url:C+v,formData:[],removeAfterUpload:!0});I(),O.filters.push({name:"customFilter",fn:function(t,n){return this.queue.length<10}}),O.onWhenAddingFileFailed=function(t,n,o){},O.onAfterAddingFile=function(t){},O.onAfterAddingAll=function(t){},O.onBeforeUploadItem=function(t){var o={customerId:n.customerId};t.formData.push(o)},O.onProgressItem=function(t,n){},O.onProgressAll=function(t){},O.onSuccessItem=function(t,n,o,e){},O.onErrorItem=function(t,n,o,e){},O.onCancelItem=function(t,n,o,e){},O.onCompleteItem=function(n,o,e,r){o&&o.sessionId&&null!=t.$parent&&t.$parent.navToSection("staging","staging",o.sessionId)},O.onCompleteAll=function(){t.reloadData()},t.onImport=function(){return 0==t.uploader.queue.length?void p.swal("El formulario contiene errores!","Por favor seleccione un archivo e Intentalo de nuevo.","error"):void O.uploadAll()},t.onClear=function(){},t.onDownload=function(){angular.element("#downloadDocument")[0].src="api/customer-config-macro-process/download-template?customerId="+n.customerId},t.dtInstanceConfigMacroImport={},t.dtOptionsConfigMacroImport=e.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.operation="diagnostic",t.customerId=n.customerId,JSON.stringify(t)},url:"api/customer-config-macro-process",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(n,o,e){i(angular.element(n).contents())(t)}),t.dtColumnsConfigMacroImport=[r.newColumn("workplace").withTitle(g.instant("grid.matrix.WORK-PLACE")).withOption("width",200),r.newColumn("name").withTitle(g.instant("grid.matrix.MACROPROCESS")).withOption("width",200),r.newColumn("status").withTitle("Estado").withOption("width",200).renderWith(function(t,n,o,e){var r="";switch(t){case"Activo":r="label label-success";break;case"Inactivo":r="label label-danger";break;case"Retirado":r="label label-warning"}var a='<span class="'+r+'">'+t+"</span>";return a})],t.cancelEdition=function(o){null!=t.$parent&&t.$parent.navToSection("summary","summary",n.customerId)},t.reloadData=function(){t.dtInstanceConfigMacroImport.reloadData()}}]);
"use strict";app.controller("customerConfigWizardMacroProcessesStagingListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$document","$filter","$aside","ListService","$translate",function(t,n,e,a,o,i,r,s,c,l,u,d,f,m,p,g,w,h){function C(){var n=[{name:"export_url",value:null}];w.getDataList(n).then(function(t){v=t.data.data.exportUrl.item},function(n){t.status="Unable to load customer data: "+n.message})}var v="";t.audit={fields:[],filters:[]},C(),t.dtInstanceCustomerConfigWizardMacroProcessesStagingDT={},t.dtOptionsCustomerConfigWizardMacroProcessesStagingDT=a.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerId=n.customerId,e.sessionId=t.$parent.currentId,JSON.stringify(e)},url:"api/customer-config-macro-process-staging",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[1,"asc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){S()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(n,e,a){r(angular.element(n).contents())(t)}),t.dtColumnsCustomerConfigWizardMacroProcessesStagingDT=[o.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,n,e,a){var o="",i='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar"  data-id="'+t.id+'"'+o+' >   <i class="fa fa-edit"></i></a> ';return 0!=t.isValid&&t.isValid?null:i}),o.newColumn(null).withTitle("Fila").withOption("width",50).renderWith(function(t,n,e,a){var o=1==t.isValid||t.isValid?"badge badge-success":"badge badge-danger",i=1==t.isValid||t.isValid?' <i class=" fa fa-check"></i>':' <i class=" fa fa-ban"></i>';return'<span class="'+o+'">'+t.index+i+"</span>"}),o.newColumn("workplace").withTitle(h.instant("grid.matrix.WORK-PLACE")).withOption("width",200),o.newColumn("name").withTitle(h.instant("grid.matrix.MACROPROCESS")).withOption("width",200),o.newColumn("status").withTitle("Estado").withOption("width",200),o.newColumn("observation").withTitle("Observación").withOption("width",280).withOption("defaultContent","")];var S=function(){angular.element("#dataCustomerConfigWizardMacroProcessesStagingDT a.editRow").on("click",function(){var t=angular.element(this).data("id");O(t)})};t.dtInstanceCustomerConfigWizardMacroProcessesStagingDTCallback=function(n){t.dtInstanceCustomerConfigWizardMacroProcessesStagingDT=n},t.reloadData=function(){t.dtInstanceCustomerConfigWizardMacroProcessesStagingDT.reloadData()};var O=function(n){var e=g.open({templateUrl:l.app.views.urlRoot+"modules/customer/sgsst/massive/macroprocess/customer_profile_config_sgsst_wizard_tab_macro_processes_staging_modal.htm",placement:"right",windowTopClass:"top-modal",size:"lg",backdrop:!0,controller:"ModalInstanceSidecustomerConfigWizardMacroProcessesStagingEditCtrl",scope:t,resolve:{dataItem:function(){return{id:n?n:0}},isView:function(){return t.isView}}});e.result.then(function(n){t.reloadData()},function(){})};t.onCancel=function(){m.scrollTop(40,2e3),null!=t.$parent&&t.$parent.navToSection("list","list")},t.onProcess=function(){f.swal({title:"Confirma la importación de los registros?",text:"Se importarán los registros válidos. Una vez realizado este proceso no se podrán realizar cambios.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, confirmar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(a){if(a)return d({method:"POST",url:v+"api/v1/customer-config-macroprocess-confirm",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param({id:n.customerId,sessionId:t.$parent.currentId})}).then(function(n){u(function(){f.swal("Registro","La información ha sido importada satisfactoriamente","success"),t.onCancel()})})["catch"](function(t){e.error(t),f.swal("Error de guardado",t.data.message,"error")})["finally"](function(){})})}}]),app.controller("ModalInstanceSidecustomerConfigWizardMacroProcessesStagingEditCtrl",["$rootScope","$stateParams","$scope","dataItem","isView","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","ngNotify","$document","$filter","$aside","ListService",function(t,n,e,a,o,i,r,s,c,l,u,d,f,m,p,g){function w(){var t=[{name:"customer_workplace",value:n.customerId},{name:"config_workplace_status",value:null}];g.getDataList(t).then(function(t){e.workplaceList=t.data.data.workplaceList,e.statusList=t.data.data.config_workplace_status},function(t){e.status="Unable to load customer data: "+t.message})}e.onCloseModal=function(){i.close(null)},e.onCancel=function(){i.dismiss("cancel")},w(),e.isView=o;var h=function(){e.entity={id:a.id,customerId:e.customerId,workplace:null,name:null,status:null}};h(),e.onLoadRecord=function(){l({method:"GET",url:"api/customer-config-macro-process-staging/get",params:{id:e.entity.id}})["catch"](function(t,n){}).then(function(t){e.entity=t.data.result,e.entity.workplace&&"PCS"==e.entity.workplace.type&&(e.entity.name=null)})["finally"](function(){})},e.onLoadRecord(),e.form={submit:function(t){var n=null;if(t.$invalid){var e=null,n=null;for(e in t)"$"!=e[0]&&(null!==n||t[e].$valid||(n=t[e].$name),t[e].$pristine&&(t[e].$dirty=!0));return angular.element(".ng-invalid[name="+n+"]").focus(),void c.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}C()},reset:function(t){}};var C=function(){var t=JSON.stringify(e.entity),n={data:Base64.encode(t)};return l({method:"POST",url:"api/customer-config-macro-process-staging/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(t){s(function(){c.swal("Registro","La información ha sido guardada satisfactoriamente","success"),i.close(null)})})["catch"](function(t){r.error(t),c.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})}}]);
"use strict";app.controller("customerConfigWizardProcessCtrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout",function(o,t,e,n,c,i){o.view_component="list",o.currentId=0,o.modeDsp="edit",o.navToSection=function(t,e,n){i(function(){o.view_component=t,o.modeDsp=e,o.currentId=n})}}]);
"use strict";app.controller("customerConfigWizardProcessImportCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$document","FileUploader","$location","$translate","ListService",function(t,n,o,e,i,r,a,s,l,c,u,d,p,m,f,w,g,h){function C(){var n=[{name:"export_url",value:null}];h.getDataList(n).then(function(n){I=n.data.data.exportUrl.item,v.url=I+O,t.uploader.url=I+O},function(n){t.status="Unable to load customer data: "+n.message})}t.loading=!0,t.customerId=n.customerId;var I="",O="api/v1/customer-config-process-import",v=t.uploader=new f({url:I+O,formData:[],removeAfterUpload:!0});C(),v.filters.push({name:"customFilter",fn:function(t,n){return this.queue.length<10}}),v.onWhenAddingFileFailed=function(t,n,o){},v.onAfterAddingFile=function(t){},v.onAfterAddingAll=function(t){},v.onBeforeUploadItem=function(t){var o={customerId:n.customerId};t.formData.push(o)},v.onProgressItem=function(t,n){},v.onProgressAll=function(t){},v.onSuccessItem=function(t,n,o,e){},v.onErrorItem=function(t,n,o,e){},v.onCancelItem=function(t,n,o,e){},v.onCompleteItem=function(n,o,e,i){o&&o.sessionId&&null!=t.$parent&&t.$parent.navToSection("staging","staging",o.sessionId)},v.onCompleteAll=function(){t.reloadData()},t.onImport=function(){return 0==t.uploader.queue.length?void p.swal("El formulario contiene errores!","Por favor seleccione un archivo e Intentalo de nuevo.","error"):void v.uploadAll()},t.onClear=function(){},t.onDownload=function(){angular.element("#downloadDocument")[0].src="api/customer-config-process/download-template?customerId="+n.customerId},t.dtInstanceConfigProcess={},t.dtOptionsConfigProcess=e.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(n){return n.operation="diagnostic",n.customerId=t.customerId,JSON.stringify(n)},url:"api/customer-config-process",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(n,o,e){a(angular.element(n).contents())(t)}),t.dtColumnsConfigProcess=[i.newColumn("workplace").withTitle(g.instant("grid.matrix.WORK-PLACE")).withOption("width",200),i.newColumn("macroprocess").withTitle(g.instant("grid.matrix.MACROPROCESS")).withOption("width",200),i.newColumn("name").withTitle(g.instant("grid.matrix.PROCESS")).withOption("width",200),i.newColumn("status").withTitle("Estado").withOption("width",200).renderWith(function(t,n,o,e){var i="";switch(t){case"Activo":i="label label-success";break;case"Inactivo":i="label label-danger";break;case"Retirado":i="label label-warning"}var r='<span class="'+i+'">'+t+"</span>";return r})],t.cancelEdition=function(n){null!=t.$parent&&t.$parent.navToSection("summary","summary",t.customerId)},t.reloadData=function(){t.dtInstanceConfigProcess.reloadData()}}]);
"use strict";app.controller("customerConfigWizardProcessStagingListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$document","$filter","$aside","ListService","$translate",function(t,n,e,o,a,i,r,s,c,l,u,d,f,m,p,g,w,h){function C(){var n=[{name:"export_url",value:null}];w.getDataList(n).then(function(t){v=t.data.data.exportUrl.item},function(n){t.status="Unable to load customer data: "+n.message})}var v="";t.audit={fields:[],filters:[]},C(),t.dtInstanceCustomerConfigWizardProcessStagingDT={},t.dtOptionsCustomerConfigWizardProcessStagingDT=o.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerId=n.customerId,e.sessionId=t.$parent.currentId,JSON.stringify(e)},url:"api/customer-config-process-staging",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[1,"asc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){S()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(n,e,o){r(angular.element(n).contents())(t)}),t.dtColumnsCustomerConfigWizardProcessStagingDT=[a.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,n,e,o){var a="",i='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar"  data-id="'+t.id+'"'+a+' >   <i class="fa fa-edit"></i></a> ';return 0!=t.isValid&&t.isValid?null:i}),a.newColumn(null).withTitle("Fila").withOption("width",50).renderWith(function(t,n,e,o){var a=1==t.isValid||t.isValid?"badge badge-success":"badge badge-danger",i=1==t.isValid||t.isValid?' <i class=" fa fa-check"></i>':' <i class=" fa fa-ban"></i>';return'<span class="'+a+'">'+t.index+i+"</span>"}),a.newColumn("workplace").withTitle(h.instant("grid.matrix.WORK-PLACE")).withOption("width",200),a.newColumn("macroprocess").withTitle(h.instant("grid.matrix.MACROPROCESS")).withOption("width",200),a.newColumn("name").withTitle(h.instant("grid.matrix.PROCESS")).withOption("width",200),a.newColumn("status").withTitle("Estado").withOption("width",200),a.newColumn("observation").withTitle("Observación").withOption("width",280).withOption("defaultContent","")];var S=function(){angular.element("#dataCustomerConfigWizardProcessStagingDT a.editRow").on("click",function(){var t=angular.element(this).data("id");O(t)})};t.dtInstanceCustomerConfigWizardProcessStagingDTCallback=function(n){t.dtInstanceCustomerConfigWizardProcessStagingDT=n},t.reloadData=function(){t.dtInstanceCustomerConfigWizardProcessStagingDT.reloadData()};var O=function(n){var e=g.open({templateUrl:l.app.views.urlRoot+"modules/customer/sgsst/massive/process/customer_profile_config_sgsst_wizard_tab_process_staging_modal.htm",placement:"right",windowTopClass:"top-modal",size:"lg",backdrop:!0,controller:"ModalInstanceSideCustomerConfigWizardProcessStagingEditCtrl",scope:t,resolve:{dataItem:function(){return{id:n?n:0}},isView:function(){return t.isView}}});e.result.then(function(n){t.reloadData()},function(){})};t.onCancel=function(){m.scrollTop(40,2e3),null!=t.$parent&&t.$parent.navToSection("list","list")},t.onProcess=function(){f.swal({title:"Confirma la importación de los registros?",text:"Se importarán los registros válidos. Una vez realizado este proceso no se podrán realizar cambios.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, confirmar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(o){if(o)return d({method:"POST",url:v+"api/v1/customer-config-process-confirm",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param({id:n.customerId,sessionId:t.$parent.currentId})}).then(function(n){u(function(){f.swal("Registro","La información ha sido importada satisfactoriamente","success"),t.onCancel()})})["catch"](function(t){e.error(t),f.swal("Error de guardado",t.data.message,"error")})["finally"](function(){})})}}]),app.controller("ModalInstanceSideCustomerConfigWizardProcessStagingEditCtrl",["$rootScope","$stateParams","$scope","dataItem","isView","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","ngNotify","$document","$filter","$aside","ListService",function(t,n,e,o,a,i,r,s,c,l,u,d,f,m,p,g){function w(){var t=[{name:"customer_workplace",value:n.customerId},{name:"config_workplace_status",value:null}];g.getDataList(t).then(function(t){e.workplaceList=t.data.data.workplaceList,e.statusList=t.data.data.config_workplace_status},function(t){e.status="Unable to load customer data: "+t.message})}function h(){var t=[{name:"customer_macroprocess",criteria:{customerId:n.customerId,workplaceId:e.entity.workplace?e.entity.workplace.id:null}}];g.getDataList(t).then(function(t){e.macroprocessList=t.data.data.macroprocessList},function(t){e.status="Unable to load customer data: "+t.message})}e.onCloseModal=function(){i.close(null)},e.onCancel=function(){i.dismiss("cancel")},w(),e.isView=a;var C=function(){e.entity={id:o.id,customerId:e.customerId,workplace:null,macroprocess:null,name:null,status:null}};C(),e.onLoadRecord=function(){l({method:"GET",url:"api/customer-config-process-staging/get",params:{id:e.entity.id}})["catch"](function(t,n){}).then(function(t){e.entity=t.data.result,h()})["finally"](function(){})},e.onLoadRecord(),e.onSelectWorkplace=function(){h()},e.refreshWorkPlace=function(){w()},e.refreshMacroprocess=function(){h()},e.form={submit:function(t){var n=null;if(t.$invalid){var e=null,n=null;for(e in t)"$"!=e[0]&&(null!==n||t[e].$valid||(n=t[e].$name),t[e].$pristine&&(t[e].$dirty=!0));return angular.element(".ng-invalid[name="+n+"]").focus(),void c.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}v()},reset:function(t){}};var v=function(){var t=JSON.stringify(e.entity),n={data:Base64.encode(t)};return l({method:"POST",url:"api/customer-config-process-staging/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(t){s(function(){c.swal("Registro","La información ha sido guardada satisfactoriamente","success"),i.close(null)})})["catch"](function(t){r.error(t),c.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})}}]);
"use strict";app.controller("customerConfigWizardWorkPlaceImportCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$document","FileUploader","$location","$translate",function(o,n,t,e,i,r,a,l,c,s,u,d,f,m,p,w,h){var g=t,C={};g.info("loading..customerConfigWorkPlaceListCtrl ");o.loading=!0,o.customerId=n.customerId,o.isView=!1,o.workplace={};var I=o.uploader=new p({url:"api/customer/config-sgsst/workplace/import",formData:[],removeAfterUpload:!0});I.filters.push({name:"customFilter",fn:function(o,n){return this.queue.length<10}}),I.onWhenAddingFileFailed=function(o,n,t){console.info("onWhenAddingFileFailed",o,n,t)},I.onAfterAddingFile=function(o){console.info("onAfterAddingFile",o)},I.onAfterAddingAll=function(o){console.info("onAfterAddingAll",o)},I.onBeforeUploadItem=function(n){console.info("onBeforeUploadItem",n);var t={customerId:o.customerId};n.formData.push(t)},I.onProgressItem=function(o,n){console.info("onProgressItem",o,n)},I.onProgressAll=function(o){console.info("onProgressAll",o)},I.onSuccessItem=function(o,n,t,e){console.info("onSuccessItem",o,n,t,e)},I.onErrorItem=function(o,n,t,e){console.info("onErrorItem",o,n,t,e)},I.onCancelItem=function(o,n,t,e){console.info("onCancelItem",o,n,t,e)},I.onCompleteItem=function(o,n,t,e){console.info("onCompleteItem",o,n,t,e)},I.onCompleteAll=function(){console.info("onCompleteAll"),o.reloadData(),o.clear()},o.clear=function(){u(function(){}),o.isView=!1},o.save=function(){return 0==o.uploader.queue.length?void f.swal("El formulario contiene errores!","Por favor seleccione un anexo e Intentalo de nuevo.","error"):void I.uploadAll()},o.download=function(){jQuery("#downloadDocument")[0].src="api/customer/config-sgsst/workplace/download"},C.operation="diagnostic",C.customerId=o.customerId,o.dtInstanceConfigWorkPlaceImport={},o.dtOptionsConfigWorkPlaceImport=e.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:C,url:"api/customer/config-sgsst/workplace",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(n,t,e){a(angular.element(n).contents())(o)}),o.dtColumnsConfigWorkPlaceImport=[i.newColumn("name").withTitle(h.instant("grid.matrix.WORK-PLACE")).withOption("width",200),i.newColumn("country.name").withOption("defaultContent","").withTitle("País").withOption("width",200),i.newColumn("state.name").withOption("defaultContent","").withTitle("Departamento").withOption("width",200),i.newColumn("town.name").withOption("defaultContent","").withTitle("Ciudad").withOption("width",200),i.newColumn("status.item").withOption("defaultContent","").withTitle("Estado").withOption("width",200).renderWith(function(o,n,t,e){var i="";switch(o){case"Activo":i="label label-success";break;case"Inactivo":i="label label-danger";break;case"Retirado":i="label label-warning"}var r='<span class="'+i+'">'+o+"</span>";return r})],o.viewConfigWorkPlaceImport=function(n){o.workplace.id=n,o.isView=!0,o.onLoadRecord()},o.cancelEdition=function(n){null!=o.$parent&&o.$parent.navToSection("summary","summary",o.customerId)},o.reloadData=function(){o.dtInstanceConfigWorkPlaceImport.reloadData()}}]);
"use strict";app.controller("customerConfigWizardSummaryCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$document",function(a,t,e,r,s,o,d,i,n,l,u,c,m,g){var f=e;f.info("loading..customerConfigWizardSummaryCtrl "),a.loading=!0,a.customerId=t.customerId,a.isView=!1,a.wizards=[],a.optionsPie={responsive:!1,segmentShowStroke:!0,segmentStrokeColor:"#fff",segmentStrokeWidth:2,percentageInnerCutout:0,animationSteps:100,animationEasing:"easeOutBounce",animateRotate:!0,animateScale:!1,legendTemplate:'<ul class="tc-chart-js-legend"><% for (var i=0; i<segments.length; i++){%><li><span style="background-color:<%=segments[i].fillColor%>"></span><%if(segments[i].label){%><%=segments[i].label%><%}%></li><%}%></ul>'};var p=function(){var t={};return t.operation="diagnostic",t.customerId=a.customerId,c({method:"POST",url:"api/customer/config-sgsst/wizard/list",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){u(function(){a.datasetwizardsData=[],a.datasetwizardsLabels=[],a.datasetwizardsValues=[],a.datasetwizardsColors=[];for(var e=0;e<t.data.data.length;e++){for(var r=0;r<t.data.data[e].data.length;r++)a.datasetwizardsLabels.push(t.data.data[e].data[r].label),a.datasetwizardsValues.push(t.data.data[e].data[r].value),a.datasetwizardsColors.push(t.data.data[e].data[r].color);a.datasetwizardsData.push({name:t.data.data[e].name,created:t.data.data[e].created,configured:t.data.data[e].configured,pending:t.data.data[e].pending,labels:a.datasetwizardsLabels,datasets:[{data:a.datasetwizardsValues,backgroundColor:a.datasetwizardsColors,hoverBackgroundColor:a.datasetwizardsColors}]}),a.datasetwizardsLabels=[],a.datasetwizardsValues=[],a.datasetwizardsColors=[]}a.wizards=a.datasetwizardsData,console.log(a.datasetwizardsData)})})["catch"](function(a){e.error(a),m.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};p(),a.onOpenWizard=function(){null!=a.$parent&&a.$parent.navToSection("form","edit",0)},a.onRefresh=function(){p()}}]);
"use strict";app.controller("customerConfigWizardJobImport",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$document","FileUploader",function(o,n,e,t,r,i,a,c,l,s,u,d,f,m,p){var w=e,g={};w.info("loading..customerConfigProcessesCtrl "),o.loading=!0,o.customerId=n.customerId,o.isView=!1,o.process={},o.macros=[],o.processes=[],o.job={id:o.$parent.currentId,customerId:o.customerId,name:"",status:null};var h=function(){var n={};return n.operation="diagnostic",n.customerId=o.customerId,d({method:"POST",url:"api/customer/config-sgsst/workplace/list",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(n){u(function(){o.workplaces=n.data.data})})["catch"](function(o){e.error(o),f.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};h();var I=function(){if(null!=o.job.workplace){var n={};return n.operation="diagnostic",n.customerId=o.customerId,n.workPlaceId=o.job.workplace.id,o.job.macro=null,o.job.process=null,d({method:"POST",url:"api/customer/config-sgsst/macro/list",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(n){u(function(){o.macros=n.data.data})})["catch"](function(o){})["finally"](function(){})}o.macros=[]},b=function(){if(null!=o.job.macro){var n={};return n.operation="diagnostic",n.customerId=o.customerId,n.workPlaceId=o.job.workplace.id,n.macroProcessid=o.job.macro.id,o.job.process=null,d({method:"POST",url:"api/customer/config-sgsst/process/list",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(n){u(function(){o.processes=n.data.data})})["catch"](function(o){})["finally"](function(){})}o.processes=[]};o.$watch("job.workplace",function(){I()}),o.$watch("job.macro",function(){b()});var C=o.uploader=new p({url:"api/customer/config-sgsst/job/import",formData:[],removeAfterUpload:!0});C.filters.push({name:"customFilter",fn:function(o,n){return this.queue.length<10}}),C.onWhenAddingFileFailed=function(o,n,e){console.info("onWhenAddingFileFailed",o,n,e)},C.onAfterAddingFile=function(o){console.info("onAfterAddingFile",o)},C.onAfterAddingAll=function(o){console.info("onAfterAddingAll",o)},C.onBeforeUploadItem=function(n){console.info("onBeforeUploadItem",n);var e={customerId:o.customerId};n.formData.push(e)},C.onProgressItem=function(o,n){console.info("onProgressItem",o,n)},C.onProgressAll=function(o){console.info("onProgressAll",o)},C.onSuccessItem=function(o,n,e,t){console.info("onSuccessItem",o,n,e,t)},C.onErrorItem=function(o,n,e,t){console.info("onErrorItem",o,n,e,t)},C.onCancelItem=function(o,n,e,t){console.info("onCancelItem",o,n,e,t)},C.onCompleteItem=function(o,n,e,t){console.info("onCompleteItem",o,n,e,t)},C.onCompleteAll=function(){console.info("onCompleteAll"),o.reloadData(),o.clear()},o.clear=function(){o.isView=!1},o.save=function(){return 0==o.uploader.queue.length?void f.swal("El formulario contiene errores!","Por favor seleccione un anexo e Intentalo de nuevo.","error"):void C.uploadAll()},o.download=function(){jQuery("#downloadDocument")[0].src="api/customer/config-sgsst/job/download"},g.operation="diagnostic",g.customerId=o.customerId,o.dtInstanceConfigJobImport={},o.dtOptionsConfigJobImport=t.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:g,url:"api/customer/config-sgsst/job-data",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){v()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(n,e,t){a(angular.element(n).contents())(o)}),o.dtColumnsConfigJobImport=[r.newColumn("name").withTitle("Cargo"),r.newColumn("status.item").withTitle("Estado").withOption("width",200).renderWith(function(o,n,e,t){var r="";switch(o){case"Activo":r="label label-success";break;case"Inactivo":r="label label-danger";break;case"Retirado":r="label label-warning"}var i='<span class="'+r+'">'+o+"</span>";return i})],o.viewConfigJobImport=function(n){null!=o.$parent&&o.$parent.navToSection("form","edit",n)},o.cancelEdition=function(n){null!=o.$parent&&o.$parent.navToSection("list","list",o.customerId)};var v=function(){$("#dtConfigJobImport a.editRow").on("click",function(){var n=$(this).data("id");o.editConfigJobImport(n)}),$("#dtConfigJobImport a.viewRow").on("click",function(){var n=$(this).data("id");o.process.id=n,o.viewConfigJobImport(n)}),$("#dtConfigJobImport a.delRow").on("click",function(){var n=$(this).data("id");w.info("intenta eliminar el registro: "+n),f.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(t){if(t){var r={};r.id=n,d({method:"POST",url:"api/customer/config-sgsst/job/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(r)}).then(function(o){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(o){e.error(o),f.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){o.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};o.reloadData=function(){o.dtInstanceConfigJobImport.reloadData()},o.editConfigJobImport=function(n){null!=o.$parent&&o.$parent.navToSection("form","edit",n)},o.createConfigJobImport=function(){null!=o.$parent&&o.$parent.navToSection("form","edit",0)},o.refreshWorkPlace=function(){h()},o.refreshMacro=function(){I()},o.refreshProcess=function(){b()}}]);
"use strict";app.controller("customerConfigWizardJobActivityCtrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout",function(o,t,e,n,c,i){o.view_component="list",o.currentId=0,o.modeDsp="edit",o.navToSection=function(t,e,n){i(function(){o.view_component=t,o.modeDsp=e,o.currentId=n})}}]);
"use strict";app.controller("customerConfigWizardJobActivityImportCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$document","FileUploader","$location","$translate","ListService",function(t,n,o,e,i,r,a,u,l,c,d,s,m,p,f,w,h,C){function g(){var n=[{name:"export_url",value:null}];C.getDataList(n).then(function(n){I=n.data.data.exportUrl.item,v.url=I+O,t.uploader.url=I+O},function(n){t.status="Unable to load customer data: "+n.message})}t.loading=!0,t.customerId=n.customerId;var I="",O="api/v1/customer-config-job-activity-import",v=t.uploader=new f({url:I+O,formData:[],removeAfterUpload:!0});g(),v.filters.push({name:"customFilter",fn:function(t,n){return this.queue.length<10}}),v.onWhenAddingFileFailed=function(t,n,o){},v.onAfterAddingFile=function(t){},v.onAfterAddingAll=function(t){},v.onBeforeUploadItem=function(t){var o={customerId:n.customerId,userId:c.currentUser().id};t.formData.push(o)},v.onProgressItem=function(t,n){},v.onProgressAll=function(t){},v.onSuccessItem=function(t,n,o,e){},v.onErrorItem=function(t,n,o,e){},v.onCancelItem=function(t,n,o,e){},v.onCompleteItem=function(n,o,e,i){o&&o.sessionId&&null!=t.$parent&&t.$parent.navToSection("staging","staging",o.sessionId)},v.onCompleteAll=function(){t.reloadData()},t.onImport=function(){return 0==t.uploader.queue.length?void m.swal("El formulario contiene errores!","Por favor seleccione un archivo e Intentalo de nuevo.","error"):void v.uploadAll()},t.onClear=function(){},t.onDownload=function(){angular.element("#downloadDocument")[0].src="api/customer-config-job-activity-staging/download-template?customerId="+n.customerId},t.dtOptionsCustomerConfigJobActivityImport=e.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.customerId=n.customerId,JSON.stringify(t)},url:"api/customer-config-job-activity",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(n,o,e){a(angular.element(n).contents())(t)}),t.dtColumnsCustomerConfigJobActivityImport=[i.newColumn("workplace").withTitle(h.instant("grid.matrix.WORK-PLACE")).withOption("width",200).withOption("defaultContent",""),i.newColumn("macroprocess").withTitle(h.instant("grid.matrix.MACROPROCESS")).withOption("width",200).withOption("defaultContent",""),i.newColumn("process").withTitle(h.instant("grid.matrix.PROCESS")).withOption("width",200).withOption("defaultContent",""),i.newColumn("job").withTitle("Cargo").withOption("width",200).withOption("defaultContent",""),i.newColumn("activity").withTitle(h.instant("grid.matrix.ACTIVITY")).withOption("width",200).withOption("defaultContent",""),i.newColumn("updatedBy").withTitle("Usuario").withOption("width",200).withOption("defaultContent",""),i.newColumn(null).withTitle("Fecha Última Actualización").withOption("width",200).renderWith(function(t,n,o,e){if("object"==typeof t.updatedAt&&t.updatedAt){var i=new moment(t.updatedAt.date);return i.format("DD-MM-YYYY HH:mm")}return t.updatedAt})],t.dtInstanceCustomerConfigJobActivityImportCallback=function(n){t.dtInstanceCustomerConfigJobActivityImport=n},t.reloadData=function(){null!=t.dtInstanceCustomerConfigJobActivityImport&&t.dtInstanceCustomerConfigJobActivityImport.reloadData()},t.cancelEdition=function(o){null!=t.$parent&&t.$parent.navToSection("summary","summary",n.customerId)}}]);
"use strict";app.controller("customerConfigWizardJobActivityStagingListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$document","$filter","$aside","ListService","$translate",function(t,i,n,o,e,a,r,s,c,l,u,d,f,m,p,g,w,h){function v(){var i=[{name:"export_url",value:null}];w.getDataList(i).then(function(t){C=t.data.data.exportUrl.item},function(i){t.status="Unable to load customer data: "+i.message})}var C="";t.audit={fields:[],filters:[]},v(),t.dtInstanceCustomerConfigWizardJobActivityStagingDT={},t.dtOptionsCustomerConfigWizardJobActivityStagingDT=o.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(n){return n.customerId=i.customerId,n.sessionId=t.$parent.currentId,JSON.stringify(n)},url:"api/customer-config-job-activity-staging",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[1,"asc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){y()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(i,n,o){r(angular.element(i).contents())(t)}),t.dtColumnsCustomerConfigWizardJobActivityStagingDT=[e.newColumn(null).withTitle("Acciones").withOption("width",100).notSortable().renderWith(function(t,i,n,o){var e="",a='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar"  data-id="'+t.id+'"'+e+' >   <i class="fa fa-edit"></i></a> ';return 0!=t.isValid&&t.isValid?null:a}),e.newColumn(null).withTitle("Fila").withOption("width",50).renderWith(function(t,i,n,o){var e=1==t.isValid||t.isValid?"badge badge-success":"badge badge-danger",a=1==t.isValid||t.isValid?' <i class=" fa fa-check"></i>':' <i class=" fa fa-ban"></i>';return'<span class="'+e+'">'+t.index+a+"</span>"}),e.newColumn("workplace").withTitle(h.instant("grid.matrix.WORK-PLACE")).withOption("width",200),e.newColumn("macroprocess").withTitle(h.instant("grid.matrix.MACROPROCESS")).withOption("width",200),e.newColumn("process").withTitle(h.instant("grid.matrix.PROCESS")).withOption("width",200).withOption("defaultContent",""),e.newColumn("job").withTitle("Cargo").withOption("width",200).withOption("defaultContent",""),e.newColumn("activity").withTitle(h.instant("grid.matrix.ACTIVITY")).withOption("width",200).withOption("defaultContent",""),e.newColumn("observation").withTitle("Observación").withOption("width",280).withOption("defaultContent","")];var y=function(){angular.element("#dataCustomerConfigWizardJobActivityStagingDT a.editRow").on("click",function(){var t=angular.element(this).data("id");b(t)})};t.dtInstanceCustomerConfigWizardJobActivityStagingDTCallback=function(i){t.dtInstanceCustomerConfigWizardJobActivityStagingDT=i},t.reloadData=function(){t.dtInstanceCustomerConfigWizardJobActivityStagingDT.reloadData()};var b=function(i){var n=g.open({templateUrl:l.app.views.urlRoot+"modules/customer/sgsst/massive/jobactivity/customer_profile_config_sgsst_wizard_tab_job_activity_staging_modal.htm",placement:"right",windowTopClass:"top-modal",size:"lg",backdrop:!0,controller:"ModalInstanceSideCustomerConfigWizardJobActivityStagingEditCtrl",scope:t,resolve:{dataItem:function(){return{id:i?i:0}},isView:function(){return t.isView}}});n.result.then(function(i){t.reloadData()},function(){})};t.onCancel=function(){m.scrollTop(40,2e3),null!=t.$parent&&t.$parent.navToSection("list","list")},t.onProcess=function(){f.swal({title:"Confirma la importación de los registros?",text:"Se importarán los registros válidos. Una vez realizado este proceso no se podrán realizar cambios.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, confirmar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(o){if(o)return d({method:"POST",url:C+"api/v1/customer-config-job-activity-confirm",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param({id:i.customerId,sessionId:t.$parent.currentId})}).then(function(i){u(function(){f.swal("Registro","La información ha sido importada satisfactoriamente","success"),t.onCancel()})})["catch"](function(t){n.error(t),f.swal("Error de guardado",t.data.message,"error")})["finally"](function(){})})}}]),app.controller("ModalInstanceSideCustomerConfigWizardJobActivityStagingEditCtrl",["$rootScope","$stateParams","$scope","dataItem","isView","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","ngNotify","$document","$filter","$aside","ListService",function(t,i,n,o,e,a,r,s,c,l,u,d,f,m,p,g){function w(){var t=[{name:"customer_workplace",value:i.customerId},{name:"customer_job",value:i.customerId},{name:"customer_activity",value:i.customerId},{name:"yes_no_letter_options",value:null}];g.getDataList(t).then(function(t){n.workplaceList=t.data.data.workplaceList,n.jobList=t.data.data.jobList,n.activityList=t.data.data.activityList,n.yesNoList=t.data.data.activeOptions},function(t){n.status="Unable to load customer data: "+t.message})}function h(){var t=[{name:"customer_macroprocess",criteria:{customerId:i.customerId,workplaceId:n.entity.workplace?n.entity.workplace.id:null}}];g.getDataList(t).then(function(t){n.macroprocessList=t.data.data.macroprocessList},function(t){n.status="Unable to load customer data: "+t.message})}function v(){var t=[{name:"customer_process",criteria:{customerId:i.customerId,workplaceId:n.entity.workplace?n.entity.workplace.id:null,macroprocessId:n.entity.macroprocess?n.entity.macroprocess.id:null}}];g.getDataList(t).then(function(t){n.processList=t.data.data.processList},function(t){n.status="Unable to load customer data: "+t.message})}n.onCloseModal=function(){a.close(null)},n.onCancel=function(){a.dismiss("cancel")},w(),n.onSelectWorkplace=function(){h()},n.onSelectMacroprocess=function(){v()},n.refreshWorkPlace=function(){w()},n.refreshMacroprocess=function(){h()},n.refreshProcess=function(){v()},n.isView=e;var C=function(){n.entity={id:o.id,customerId:n.customerId,workplace:null,macroprocess:null,process:null,job:null,activity:null,isRoutine:null}};C(),n.onLoadRecord=function(){l({method:"GET",url:"api/customer-config-job-activity-staging/get",params:{id:n.entity.id}})["catch"](function(t,i){}).then(function(t){n.entity=t.data.result,h(),v()})["finally"](function(){})},n.onLoadRecord(),n.onSelectClassification=function(){onDemandType()},n.onSelectType=function(){onDemandDescriptionAndEffect()},n.form={submit:function(t){var i=null;if(t.$invalid){var n=null,i=null;for(n in t)"$"!=n[0]&&(null!==i||t[n].$valid||(i=t[n].$name),t[n].$pristine&&(t[n].$dirty=!0));return angular.element(".ng-invalid[name="+i+"]").focus(),void c.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}y()},reset:function(t){}};var y=function(){var t=JSON.stringify(n.entity),i={data:Base64.encode(t)};return l({method:"POST",url:"api/customer-config-job-activity-staging/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(t){s(function(){c.swal("Registro","La información ha sido guardada satisfactoriamente","success"),a.close(null)})})["catch"](function(t){r.error(t),c.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})}}]);
"use strict";app.controller("customerCovidTabsCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","SweetAlert","$rootScope","$http","$timeout","$uibModal","flowFactory","cfpLoadingBar","$document","$filter","$aside","FileUploader",function(o,t,i,a,e,c,r,n,u,s,l,d,m,p,b,$,f,v,w,T){o.views=[{name:"basic",url:l.app.views.urlRoot+"modules/customer/occupational/covid-19/customer_covid.htm"},{name:"indicatorTabs",url:l.app.views.urlRoot+"modules/customer/occupational/covid-19/indicator/customer_covid_indicator_tabs.htm"}],o.loading=!1,o.tabname="basic",o.loadedIndicator=!1,o.getView=function(t){var i=v("filter")(o.views,{name:t});return i[0]},o.switchTab=function(t){m(function(){o.tabname=t,"indicatorTabs"==t&&(o.loadedIndicator=!0)})},o.switchSubTab=function(t){m(function(){o.subtab=t})}}]);
"use strict";app.controller("customerCovidCtrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout",function(t,o,e,c,i,n){t.covid_section="list",t.currentId=0,t.editMode="create",t.navToSection=function(o,e,c){n(function(){t.covid_section=o,t.editMode=e,t.$parent.switchSubTab(e),t.currentId=c})}}]);
"use strict";app.factory("CustomerCovidService",function(){var t={},n=null,u=null;return t.setId=function(t){n=t},t.getId=function(){return n},t.setDailyId=function(t){u=t},t.getDailyId=function(){return u},t});
"use strict";app.controller("customerCovidEditCtrl",["$scope","$stateParams","$log","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$document","$filter","$aside","ListService","bsLoadingOverlayService","$q","DTColumnBuilder","DTOptionsBuilder","$compile","CustomerCovidService","moment",function(e,t,i,n,o,a,l,r,s,d,u,c,m,p,y,f,h,b,w,v){function g(){var i=[{name:"customer_workplace",value:t.customerId},{name:"customer_contractor_simple",criteria:{parentId:t.customerId}}];m.getDataList(i).then(function(t){e.workplaceList=t.data.data.workplaceList,e.contractorList=t.data.data.customerContractorList,D(),e.onLoadRecord()},function(t){e.status="Unable to load customer data: "+t.message})}var C=null;e.contractTypes=a.parameters("employee_contract_type"),e.documentTypeList=a.parameters("employee_document_type"),e.externalTypeList=a.parameters("customer_covid_external_type"),e.extrainfo=e.customer.extraContactInformationList,e.employees=[],e.isContractor=!1,e.disableTelephone=!1,e.disableMobile=!1,e.disableAddress=!1,e.invalideDate=!1,e.updateEmployeeBirthdate=!1,e.isView="view"==e.$parent.editMode,e.isCreate=!0,w.setId(e.$parent.currentId||0),e.maxDate=new Date,e.datePickerConfig={culture:"es-CO",format:"dd/MM/yyyy",change:function(){if(e.entity.isExternal||e.updateEmployeeBirthdate){var t=v().diff(e.entity.birthDate,"years");e.entity.age=t,e.updateEmployeeBirthdate&&(e.invalideDate=!1)}}};var D=function(){e.entity={id:e.$parent.currentId||0,customerId:t.customerId,employee:null,isExternal:!1,customerEmployeeId:null,documentType:null,documentNumber:null,firstName:null,lastName:null,fullName:null,customerWorkplaceId:null,externalType:null,contractorId:null,contractor:null,age:null,birthDate:"",telephone:null,mobile:null,address:null,email:null,observation:null,contractorId:null,informationList:null,origin:"WEB"},e.entity.registrationDate=e.maxDate,C&&C.$setPristine(!0)};g(),e.onLoadRecord=function(){if(0!=e.entity.id){var t={id:e.entity.id};r({method:"GET",url:"api/customer-covid/get",params:t})["catch"](function(e,t){}).then(function(t){l(function(){e.entity=t.data.result,I(),null!=e.entity.employee?A(e.entity.employee):T(),E()})})["finally"](function(){l(function(){e.loading=!1,d.scrollTop(40,2e3)},400)})}else e.loading=!1};var T=function(){null!=e.entity.telephone?e.disableTelephone=!0:e.disableTelephone=!1,null!=e.entity.mobile?e.disableMobile=!0:e.disableMobile=!1,null!=e.entity.address?e.disableAddress=!0:e.disableAddress=!1};e.onSelectedExternalType=function(t){"Contratista"==t.item?e.isContractor=!0:(e.isContractor=!1,e.entity.contractorId=null)};var E=function(){e.entity.isExternal&&("Contratista"==e.entity.externalType.item?e.isContractor=!0:(e.isContractor=!1,e.entity.contractorId=null))},I=function(){e.entity.registrationDate&&(e.entity.registrationDate=new Date(e.entity.registrationDate.date)),e.entity.birthDate&&(e.entity.birthDate=new Date(e.entity.birthDate.date))};e.onChangeExternal=function(){e.entity.employee=null,e.entity.customerEmployeeId=null,e.entity.documentType=null,e.entity.documentNumber=null,e.entity.firstName=null,e.entity.lastName=null,e.entity.telephone=null,e.entity.mobile=null,e.entity.address=null,e.entity.email=null,e.entity.customerWorkplaceId=null,e.entity.externalType=null,e.entity.age=null,e.entity.birthDate=null,e.isContractor=!1,e.disableTelephone=null,e.disableMobile=null,e.disableAddress=null,e.disableEmail=null},e.form={submit:function(t){C=t;var i=null;if(t.$invalid){var n=null,i=null;for(n in t)"$"!=n[0]&&(null!==i||t[n].$valid||(i=t[n].$name),t[n].$pristine&&(t[n].$dirty=!0));return""==e.entity.birthDate||null==e.entity.birthDate?e.invalideDate=!0:e.invalideDate=!1,angular.element(".ng-invalid[name="+i+"]").focus(),void s.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}return""==e.entity.birthDate||null==e.entity.birthDate?(e.invalideDate=!0,angular.element(".ng-invalid[name="+i+"]").focus(),void s.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")):void N()},reset:function(e){}};var N=function(){var t={};e.entity.informationList=e.extrainfo,e.entity.updateEmployeeBirthdate=e.updateEmployeeBirthdate;var i=JSON.stringify(e.entity);return t.data=Base64.encode(i),r({method:"POST",url:"api/customer-covid/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){l(function(){s.swal("Registro","La información ha sido guardada satisfactoriamente","success"),e.entity=t.data.result,I(),w.setId(e.entity.id),T(),E(),e.updateEmployeeBirthdate=!1})})["catch"](function(e){s.swal("Error de guardado",e.data.message,"error")})["finally"](function(){})},O=function(e,t){if(null==e)return null;var i=null;return angular.forEach(e,function(e){e.type&&e.type.value==t&&(i=e.value)}),i};e.onSearchEmployee=function(){var t=c.open({templateUrl:a.app.views.urlRoot+"modules/customer/occupational/absenteeism/disability/customer_absenteeism_disability_employee_list_modal.htm",placement:"right",windowTopClass:"top-modal",size:"lg",backdrop:!0,controller:"ModalInstanceSideCovidEmployeeListCtrl",scope:e});t.result.then(function(e){A(e)},function(){})};var A=function(t){var i="";t.entity.birthDate?i=new Date(t.entity.birthDate.date):e.updateEmployeeBirthdate=!0;var n={id:t.id,customerId:t.customerId,workPlace:t.workPlace,documentType:t.entity.documentType,contractType:t.contractType,job:t.job,documentNumber:t.entity.documentNumber,firstName:t.entity.firstName,lastName:t.entity.lastName,fullName:t.entity.fullName,birthDate:i,age:t.entity.age,gender:t.entity.gender,entity:t.entity};e.employees=[],e.employees.push(n),e.entity.employee=n,e.entity.customerWorkplaceId=n.workPlace,e.entity.age=n.age,e.entity.birthDate=n.birthDate,e.entity.firstName=n.firstName,e.entity.lastName=n.lastName,e.entity.documentType=n.documentType,e.entity.documentNumber=n.documentNumber,e.entity.telephone=O(t.entity.details,"tel"),e.entity.mobile=O(t.entity.details,"cel"),e.entity.address=O(t.entity.details,"dir"),e.entity.email=O(t.entity.details,"email"),T()};e.onCancel=function(){d.scrollTop(40,2e3),null!=e.$parent&&e.$parent.navToSection("list","list")}}]),app.controller("ModalInstanceSideCovidEmployeeListCtrl",["$rootScope","$stateParams","$scope","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile",function(e,t,i,n,o,a,l,r,s,d,u,c,m,p){i.employee={id:0},i.onCloseModal=function(){n.close(i.employee)},i.onCancel=function(){n.dismiss("cancel")},i.onLoadRecord=function(){if(0!=i.employee.id){var e={id:i.employee.id};r({method:"GET",url:"api/customer-employee",params:e})["catch"](function(e,t){if(403==t){var i=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";l.swal("No Autorizado","No estas autorizado para ver esta información.","error"),a(function(){$state.go(i)},3e3)}else 404==t?l.swal("Información no disponible","Diagnóstico no encontrado","error"):l.swal("Error","Se ha presentado un error al intentar acceder a la información del proceso","error")}).then(function(e){console.log(e),a(function(){i.employee=e.data.result})})["finally"](function(){a(function(){i.onCloseModal()},400)})}else i.loading=!1},i.dtInstanceDisabilityEmployeeList={},i.dtOptionsDisabilityEmployeeList=m.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerId=t.customerId,JSON.stringify(e)},url:"api/customer-employee-modal-basic",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){y()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,t,n){p(angular.element(e).contents())(i)}),i.dtColumnsDisabilityEmployeeList=[c.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,t,i,n){var o="",a="",l='<a class="btn btn-success btn-xs editRow lnk" href="#" uib-tooltip="Adicionar empleado" tooltip-placement="right"  data-id="'+e.id+'"'+a+' >   <i class="fa fa-plus-square"></i></a> ';return o+=l}),c.newColumn("documentNumber").withTitle("Número Identificación").withOption("width",200),c.newColumn("firstName").withTitle("Nombre").withOption("width",200),c.newColumn("lastName").withTitle("Apellidos").withOption("width",200),c.newColumn("workPlace").withTitle("Centro de Trabajo").withOption("width",200),c.newColumn("job").withTitle("Cargo").withOption("width",200),c.newColumn("neighborhood").withTitle("Centro de Costos").withOption("width",200),c.newColumn(null).withTitle("Estado").withOption("width",200).renderWith(function(e,t,i,n){var o="label label-danger",a="Inactivo";null==e.isActiveCode&&void 0==e.isActiveCode||("Activo"==e.isActiveCode?(o="label label-success",a="Activo"):(o="label label-danger",a="Inactivo"));var l='<span class="'+o+'">'+a+"</span>";return l}),c.newColumn(null).withTitle("Autorización").withOption("width",200).renderWith(function(e,t,i,n){var o="label label-danger",a="Inactivo";null==e.isAuthorized&&void 0==e.isAuthorized||("Autorizado"==e.isAuthorized?(o="label label-success",a="Autorizado"):"No Autorizado"==e.isAuthorized?(o="label label-danger",a="No Autorizado"):(o="label label-info",a="N/A"));var l='<span class="'+o+'">'+a+"</span>";return l})];var y=function(){angular.element("#dtDisabilityEmployeeList a.editRow").on("click",function(){var e=angular.element(this).data("id");i.editDisabilityEmployee(e)})};i.reloadData=function(){i.dtInstanceDisabilityEmployeeList.reloadData()},i.viewDisabilityEmployee=function(e){i.employee.id=e,i.isView=!0,i.onLoadRecord()},i.editDisabilityEmployee=function(e){i.employee.id=e,i.isView=!1,i.onLoadRecord()}}]);
"use strict";app.controller("customerCovidListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$document","$filter","$aside","ListService","ngNotify",function(t,e,n,o,i,a,r,l,s,c,u,d,f,m,p,v,w,h){function C(){var e=[{name:"criteria_operators",value:null},{name:"criteria_conditions",value:null},{name:"customer_covid_filter_field",value:null},{name:"export_url",value:null}];w.getDataList(e).then(function(e){g=e.data.data.exportUrl.item,t.criteria=e.data.data.criteriaOperatorList,t.conditions=e.data.data.criteriaConditionList,t.audit.fields=e.data.data.customerCovidFilterField},function(e){t.status="Unable to load customer data: "+e.message})}var g="";t.audit={fields:[],filters:[]},C(),t.addFilter=function(){null==t.audit.filters&&(t.audit.filters=[]),t.audit.filters.push({id:0,field:null,criteria:t.criteria.length>0?t.criteria[1]:null,condition:t.conditions.length>0?t.conditions[0]:null,value:""})},t.onFilter=function(){t.reloadData()},t.removeFilter=function(e){t.audit.filters.splice(e,1)},t.onCleanFilter=function(){t.audit.filters=[],t.reloadData()},t.dtInstanceCustomerCovid={},t.dtOptionsCustomerCovid=o.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(n){return n.customerId=e.customerId,c.isCustomerUser()&&(n.createdBy=c.currentUser().id),angular.isDefined(t.audit)&&angular.isDefined(t.audit.filters)&&(n.filter={filters:t.audit.filters.filter(function(t){return null!=t&&null!=t.field&&null!=t.criteria}).map(function(t,e,n){return{field:t.field.name,operator:t.criteria.value,value:t.value,condition:t.condition.value}})}),JSON.stringify(n)},url:"api/customer-covid",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[1,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){b()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,n,o){r(angular.element(e).contents())(t)}),t.dtColumnsCustomerCovid=[i.newColumn(null).withTitle("Acciones").withOption("width",220).notSortable().renderWith(function(t,e,n,o){var i="",a="",r='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar"  data-id="'+t.id+'"'+a+' >   <i class="fa fa-edit"></i></a> ',l='<a class="btn btn-info btn-xs viewRow lnk" href="#"  uib-tooltip="Ver" data-id="'+t.id+'" >   <i class="fa fa-eye"></i></a> ',s='<a class="btn btn-success btn-xs exportExcel lnk" href="#"  uib-tooltip="Exportar a Excel" data-id="'+t.id+'"  '+a+' >   <i class="fa fa-file-excel-o"></i></a> ';return c.can("clientes_view")&&(i+=l),c.can("clientes_edit")&&(i+=r),i+=s}),i.newColumn("personType").withTitle("Tipo Personal").withOption("width",200).withOption("defaultContent",""),i.newColumn("documentType").withTitle("Tipo Identificación").withOption("width",200).withOption("defaultContent",""),i.newColumn("documentNumber").withTitle("Identificación").withOption("width",200).withOption("defaultContent",""),i.newColumn("fullName").withTitle("Nombre").withOption("width",200).withOption("defaultContent",""),i.newColumn("workplace").withTitle("Centro de Trabajo").withOption("width",200).withOption("defaultContent",""),i.newColumn("contractor").withTitle("Empresa Contratista").withOption("width",200).withOption("defaultContent",""),i.newColumn("lastDate").withTitle("Fecha Último Registro").withOption("width",200).withOption("defaultContent",""),i.newColumn(null).withTitle("Nivel de Riesgo").withOption("width",200).renderWith(function(t,e,n,o){var i="label";return null!=t.lastRiskLevelText?'<span class="'+i+'" style="background-color:'+t.lastRiskLevelColor+'">'+t.lastRiskLevelText+"</span>":""})];var b=function(){angular.element("#dtCustomerCovid a.editRow").on("click",function(){var t=angular.element(this).data("id");x(t)}),angular.element("#dtCustomerCovid a.viewRow").on("click",function(){var t=angular.element(this).data("id");T(t)}),angular.element("#dtCustomerCovid a.exportExcel").on("click",function(){var t=angular.element(this).data("id");O(t)}),angular.element("#dtCustomerCovid a.delRow").on("click",function(){var e=angular.element(this).data("id");f.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(o){if(o){var i={};i.id=e,d({method:"POST",url:"api/customer-covid/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){n.error(t),f.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){t.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};t.dtInstanceCustomerCovidCallback=function(e){t.dtInstanceCustomerCovid=e},t.reloadData=function(){t.dtInstanceCustomerCovid.reloadData()},t.onCreate=function(){null!=t.$parent&&t.$parent.navToSection("edit","edit",0)};var O=function(t){var n={customerCovidId:t,customerId:e.customerId};angular.element("#downloadDocument")[0].src="api/customer-covid/export?data="+Base64.encode(JSON.stringify(n))};t.onExportExcelEmployee=function(){I("api/v1/customer-covid-export-employee")},t.onExportExcelExternal=function(){I("api/v1/customer-covid-export-external")};var I=function(n){h.set('<div class="row"><div class="col-sm-5"><div class="loader-spinner pull-right"></div> </div> <div class="col-sm-6 text-left">El reporte se está generando. Por favor espere!</div> </div>',{position:"bottom",sticky:!0,button:!1,html:!0});var o={customerId:e.customerId,userId:c.currentUser().id,filter:{}};angular.isDefined(t.audit)&&angular.isDefined(t.audit.filters)&&(o.filter={filters:t.audit.filters.filter(function(t){return null!=t&&null!=t.field&&null!=t.criteria}).map(function(t,e,n){return{field:t.field.name,operator:t.criteria.value,value:t.value,condition:t.condition.value}})});var i={data:Base64.encode(JSON.stringify(o))};return d({method:"POST",url:g+n,headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(t){var e=g+"storage/"+t.data.filename,n='<a class="btn btn-wide btn-default" href="'+e+'" target="_self"><i class="glyphicon glyphicon-download"></i> Descargar el reporte</a>';t.data.isQueue&&(e="app/user/messages",n=t.data.message+' <a  class="btn btn-wide btn-default" href="'+e+'" translate="Ver mensajes"> Ver mensajes </a>'),h.set(n,{position:"bottom",sticky:!0,type:t.data.isQueue?"info":"success",button:!0,html:!0})})["catch"](function(t){null!=t.data&&void 0!==t.data.message?h.set(t.data.message,{position:"bottom",sticky:!0,type:"error",button:!0,html:!0}):h.set("Lo sentimos, ha ocurrido un error en la generación del reporte",{position:"bottom",sticky:!0,type:"error",button:!0,html:!0})})["finally"](function(){})},x=function(e){null!=t.$parent&&t.$parent.navToSection("edit","edit",e)},T=function(e){null!=t.$parent&&t.$parent.navToSection("edit","view",e)};t.onUpload=function(){var e=v.open({templateUrl:c.app.views.urlRoot+"modules/customer/occupational/covid-19/customer_covid_import_modal.htm",placement:"bottom",size:"lg",backdrop:!0,controller:"ModalInstanceSideCustomerCovidImportCtrl",scope:t});e.result.then(function(e){t.reloadData()},function(){})}}]),app.controller("ModalInstanceSideCustomerCovidImportCtrl",["$rootScope","$stateParams","$scope","FileUploader","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","ngNotify","ListService",function(t,e,n,o,i,a,r,l,s,c,u,d){function f(){var t=[{name:"export_url",value:null}];d.getDataList(t).then(function(t){m=t.data.data.exportUrl.item,v.url=m+"api/v1/customer-covid-import",n.uploader.url=m+"api/v1/customer-covid-import"},function(t){n.status="Unable to load customer data: "+t.message})}var m="",p=null,v=n.uploader=new o({url:m+"api/v1/customer-covid-import",formData:[]});f(),n.download=function(){angular.element("#downloadDocument")[0].src="api/customer-covid/download-template?customerId="+e.customerId},v.filters.push({name:"customFilter",fn:function(t,e){return this.queue.length<10}}),v.onWhenAddingFileFailed=function(t,e,n){console.info("onWhenAddingFileFailed",t,e,n)},v.onAfterAddingFile=function(t){console.info("onAfterAddingFile",t)},v.onAfterAddingAll=function(t){console.info("onAfterAddingAll",t)},v.onBeforeUploadItem=function(n){console.info("onBeforeUploadItem",n);var o={id:e.customerId,user:t.currentUser().id};n.formData.push(o)},v.onProgressItem=function(t,e){console.info("onProgressItem",t,e)},v.onProgressAll=function(t){console.info("onProgressAll",t)},v.onSuccessItem=function(t,e,n,o){console.info("onSuccessItem",t,e,n,o)},v.onErrorItem=function(t,e,n,o){console.info("onErrorItem",t,e,n,o)},v.onCancelItem=function(t,e,n,o){console.info("onCancelItem",t,e,n,o)},v.onCompleteItem=function(t,e,n,o){console.info("onCompleteItem",t,e,n,o),p=e},v.onCompleteAll=function(){console.info("onCompleteAll"),i.close(p)}}]);
"use strict";app.controller("customerCovidHealthConditionCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$aside","CustomerCovidService","ListService","ChartService",function(t,e,i,n,o,a,l,r,d,c,s,u,h,p,f,m,w){function v(){var e=[{name:"customer_covid_date_list",criteria:{covidHeadId:O}}];m.getDataList(e).then(function(e){t.dailyList=e.data.data.customerCovidDateList,t.dailyList.length&&(t.filter.selectedMonth=t.dailyList[0]),t.initLoad=!1,t.reloadData(),C()},function(e){t.status="Unable to load customer data: "+e.message});var i=[{name:"chart_line_options",value:null}];w.getDataChart(i).then(function(e){t.chart.line.options=e.data.data.chartLineOptions},function(e){t.status="Unable to load customer data: "+e.message})}function C(){var e=[{name:"customer_covid_daily_form",criteria:{month:t.filter.selectedMonth?t.filter.selectedMonth.value:null,entityid:O}}];w.getDataChart(e).then(function(e){t.chart.daysvstemperature.data=e.data.data.chartDailyForm},function(e){t.status="Unable to load customer data: "+e.message})}var O=f.getId();t.dailyList=[],t.initLoad=!0,t.filter={selectedMonth:null},t.chart={line:{options:null},daysvstemperature:{data:null}};var g=function(){t.entity={id:0,customerCovidId:O,temperature:null,observation:null,registrationDate:new Date}};g(),v(),t.onSelectMonth=function(){t.reloadData(),C()},t.onClearFilter=function(){t.filter.selectedMonth=null,t.reloadData(),C()},t.dtInstance={},t.dtOptions=n.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerCovidHeadId=O,t.filter.selectedMonth&&(e.selectedMonth=t.filter.selectedMonth.value),JSON.stringify(e)},url:"api/customer-covid-daily",contentType:"application/json",type:"POST",beforeSend:function(){if(t.initLoad)return!1},complete:function(){}}).withDataProp("data").withOption("order",[[1,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){y()}).withPaginationType("full_numbers").withOption("createdRow",function(e,i,n){l(angular.element(e).contents())(t)}),t.dtColumns=[o.newColumn(null).withTitle("Acciones").withOption("width",15).notSortable().renderWith(function(e){var i="",n='<a class="btn btn-info btn-xs viewRow lnk" href="#" uib-tooltip="Ver" data-id="'+e.id+'" >   <i class="fa fa-eye"></i></a> ',o="";return t.isView||(o='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+e.id+'" >   <i class="fa fa-edit"></i></a> '),i+=n,i+=o}),o.newColumn("registrationDate").withTitle("Fecha").withOption("width",200).withOption("defaultContent",""),o.newColumn("symptoms").withTitle("Síntomas").withOption("width",200).withOption("defaultContent",""),o.newColumn(null).withTitle("Nivel de Riesgo").withOption("width",200).renderWith(function(t,e,i,n){var o="label";return'<span class="'+o+'" style="background-color:'+t.riskLevelColor+'">'+t.riskLevel+"</span>"}),o.newColumn("origin").withTitle("Origen").withOption("width",200).withOption("defaultContent","")];var y=function(){$("#dtCovid a.editRow").on("click",function(){var e=$(this).data("id");t.openHealthCondition(e,!0)}),$("#dtCovid a.viewRow").on("click",function(){var e=$(this).data("id");t.openHealthCondition(e,!1)})};t.dtInstanceCallback=function(e){t.dtInstance=e},t.reloadData=function(){null!=t.dtInstance&&t.dtInstance.reloadData()},t.onExportExcel=function(){var i={customerId:e.customerId,customerCovidHeadId:O,period:t.filter.selectedMonth.value};angular.element("#downloadDocument")[0].src="api/customer-covid-daily/export?data="+Base64.encode(JSON.stringify(i))},t.openHealthCondition=function(e,i){t.modalDailyId=e,t.isView=!i;var n=p.open({templateUrl:c.app.views.urlRoot+"modules/customer/occupational/covid-19/health-condition/customer_covid_health_condition_modal.htm",placement:"right",backdrop:"static",size:"lg",controller:"customerCovidHealthConditionModalCtrl",scope:t});n.result.then(function(){v()},function(){})}}]);
"use strict";app.controller("customerCovidHealthConditionModalCtrl",["$scope","$stateParams","$log","$timeout","$http","SweetAlert","$document","CustomerCovidService","ListService","$uibModalInstance","$filter",function(e,t,i,n,o,a,r,s,l,u,d){function v(){var t=[{name:"covid_question_list",value:null},{name:"covid_question_group_list",value:null}];l.getDataList(t).then(function(t){e.questionList=t.data.data.covidQuestionList,e.questionGroupList=t.data.data.covidQuestionGroupList,e.questionList&&e.questionList.length>0&&(e.entity.questionList=e.questionList.map(function(e){return{id:0,customerCovidId:0,covidQuestionCode:e.code,name:e.sort+" "+e.name,isActive:!1,observation:null,riskLevelText:e.riskLevelText,riskLevelValue:e.riskLevelValue,riskLevelColor:e.riskLevelColor,riskLevelPriority:parseInt(e.riskLevelPriority)}})),e.onLoadRecord()},function(t){e.status="Unable to load customer data: "+t.message})}var c=null,f=s.getId();s.setDailyId(e.modalDailyId),e.riskLevelList=[],e.showBreathing=!1,e.disableSymptoms=!0,e.autoSave=!1,e.maxDate=new Date,e.datePickerConfig={culture:"es-CO",format:"dd/MM/yyyy"};var L=function(){e.entity={id:e.modalDailyId,customerCovidHeadId:f,registrationDate:new Date,riskLevel:{riskLevelValue:"B",riskLevelText:"Bajo",riskLevelColor:"#5CB85C"},origin:"MANUAL",questionList:[],conditionalRiskLevel:null},c&&c.$setPristine(!0)};L(),v(),e.onLoadRecord=function(){0!=e.entity.id&&o({method:"GET",url:"api/customer-covid-daily/get",params:{id:e.entity.id}})["catch"](function(e,t){}).then(function(t){e.entity=t.data.result,e.entity.registrationDate=new Date(e.entity.registrationDate.date),e.autoSave&&y()})["finally"](function(){e.loading=!1,r.scrollTop(40,2e3)})},e.onChangeAnswer=function(e){y()},e.form={submit:function(t){c=t;var i=null;if(t.$invalid){var n=null,i=null;for(n in t)"$"!=n[0]&&(null!==i||t[n].$valid||(i=t[n].$name),t[n].$pristine&&(t[n].$dirty=!0));return angular.element(".ng-invalid[name="+i+"]").focus(),void a.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}y(),setTimeout(function(){e.onSave()},500)},reset:function(e){e.$setPristine(!0)}};var y=function(){var t=[];if(e.entity.conditionalRiskLevel){var i=d("filter")(e.questionGroupList,{riskLevelValue:e.entity.conditionalRiskLevel},!0);i&&i.length&&(e.entity.riskLevel=i[0])}else{angular.forEach(e.questionList,function(i,n){var o=e.entity.questionList.find(function(e){return e.covidQuestionCode==i.code});o&&o.isActive&&(i.riskLevelPriority=parseInt(i.riskLevelPriority),t.push(i))});var n=d("filter")(t,{riskLevelValue:"M"},!0);if(n&&n.length>=2){var i=d("filter")(e.questionGroupList,{riskLevelValue:"A"},!0);if(i&&i.length)return void(e.entity.riskLevel=i[0])}var o=d("filter")(t,{riskLevelValue:"B"},!0);if(o&&o.length>=2&&n&&1==n.length){var i=d("filter")(e.questionGroupList,{riskLevelValue:"A"},!0);if(i&&i.length)return void(e.entity.riskLevel=i[0])}if(o&&o.length>=3||1==n.length&&1==o.length){var i=d("filter")(e.questionGroupList,{riskLevelValue:"M"},!0);if(i&&i.length)return void(e.entity.riskLevel=i[0])}var i=d("filter")(e.questionList,{riskLevelValue:"B"},!0);i&&i.length&&(e.entity.riskLevel=i[0])}e.autoSave&&e.onSave()};e.onSave=function(){var t={},i=JSON.stringify(e.entity);return t.data=Base64.encode(i),o({method:"POST",url:"api/customer-covid-daily/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){e.entity=t.data.result,e.entity.registrationDate=new Date(e.entity.registrationDate.date),s.setDailyId(e.entity.id),e.autoSave||a.swal("Registro","La información ha sido guardada satisfactoriamente","success"),e.autoSave=!1})["catch"](function(t){e.autoSave||a.swal("Error de guardado",t.data.message,"error")})["finally"](function(){})},e.onCloseModal=function(){u.close(1)},e.$on("realoadQuestion",function(t,i){e.onLoadRecord(),e.autoSave=!0})}]);
"use strict";app.controller("customerCovidTemperatureListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$aside","CustomerCovidService",function(t,e,n,i,o,r,a,l,u,d,s,c,m,p,f){var w=null,h=f.getDailyId();t.dateTimePickerConfig={culture:"es-CO",format:"HH:mm"};var C=function(){t.entity={id:0,customerCovidId:h,temperature:null,pulse:null,oximetria:null,registrationDate:new Date,observation:null,address:null,origin:"MANUAL",reload:!1},w&&w.$setPristine(!0)};C(),t.onLoadRecord=function(){if(0!=t.entity.id){var e={id:t.entity.id};c({method:"GET",url:"api/customer-covid-temperature/get",params:e})["catch"](function(t,e){}).then(function(e){s(function(){t.entity=e.data.result,t.entity.registrationDate&&(t.entity.registrationDate=new Date(t.entity.registrationDate.date))})})["finally"](function(){s(function(){t.loading=!1})})}else t.loading=!1},t.form={submit:function(t){w=t;var e=null;if(t.$invalid){var n=null,e=null;for(n in t)"$"!=n[0]&&(null!==e||t[n].$valid||(e=t[n].$name),t[n].$pristine&&(t[n].$dirty=!0));return angular.element(".ng-invalid[name="+e+"]").focus(),void m.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}return!0},reset:function(t){t.$setPristine(!0)}},t.onSave=function(e){if(null==t.entity.registrationDate||null==t.entity.temperature||NaN===t.entity.temperature||null==t.entity.pulse||NaN===t.entity.pulse||null==t.entity.oximetria||NaN===t.entity.oximetria)return void m.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error");var i={},o=JSON.stringify(t.entity);return i.data=Base64.encode(o),c({method:"POST",url:"api/customer-covid-temperature/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(e){s(function(){e.data.result.reload&&t.$emit("realoadQuestion"),t.onCancel()})})["catch"](function(t){n.error(t),m.swal("Error de guardado","Error guardando el registro por favor verifique los datos ingresados!","error")})["finally"](function(){})},t.dtInstanceCustomerCovidTemperature={},t.dtOptionsCustomerCovidTemperature=i.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.customerCovidId=h,JSON.stringify(t)},url:"api/customer-covid-temperature",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){v()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,n,i){a(angular.element(e).contents())(t)}),t.dtColumnsCustomerCovidTemperature=[o.newColumn(null).withTitle("Acciones").withOption("width",120).notSortable().renderWith(function(e,n,i,o){var r="",a='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar"  data-id="'+e.id+'" >   <i class="fa fa-edit"></i></a> ',l='<a class="btn btn-danger btn-xs delRow lnk" href="#" tooltip="Eliminar registro" data-id="'+e.id+'" >   <i class="fa fa-trash-o"></i></a> ';return t.isView||(r+=a,r+=l),r}),o.newColumn("hour").withTitle("Hora").withOption("width",200).withOption("defaultContent",""),o.newColumn("temperature").withTitle("Temperatura").withOption("width",200).withOption("defaultContent",""),o.newColumn("pulse").withTitle("Pulso").withOption("width",200).withOption("defaultContent",""),o.newColumn("oximetria").withTitle("Oximetría").withOption("width",200).withOption("defaultContent",""),o.newColumn("observation").withTitle("Observacion").withOption("width",200).withOption("defaultContent","")];var v=function(){angular.element("#dtCustomerCovidTemperature a.editRow").on("click",function(){var e=angular.element(this).data("id");t.entity.id=e,t.onLoadRecord()}),$("#dtCustomerCovidTemperature a.delRow").on("click",function(){var e=$(this).data("id");m.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(n){if(n){var i={};i.id=e,c({method:"POST",url:"api/customer-covid-temperature/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(e){e.data.result&&t.$emit("realoadQuestion")})["catch"](function(t){m.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro por favor intentelo de nuevo","error")})["finally"](function(){t.reloadData()})}else swal("Cancelado","Operacion cancelada","error")})})};t.dtInstanceCustomerCovidTemperatureCallback=function(e){t.dtInstanceCustomerCovidTemperature=e},t.reloadData=function(){null!=t.dtInstanceCustomerCovidTemperature&&t.dtInstanceCustomerCovidTemperature.reloadData()},t.onCancel=function(){t.reloadData(),C()}}]);
"use strict";app.controller("ModalInstanceSideCustomerCovidTemperatureListCtrl",["$rootScope","$stateParams","$scope","$uibModalInstance","entity","isView","$log","$timeout","SweetAlert","DTOptionsBuilder","DTColumnBuilder","$http","toaster","$filter","$aside","$document","$compile",function(e,t,n,o,r,i,a,l,u,s,c,d,m,p,f,w,C){n.isView=i,n.onCloseModal=function(){o.close(1)},n.onCancel=function(){o.dismiss("cancel")},n.onClear=function(){g()};var h=null,v=r.id;n.dateTimePickerConfig={culture:"es-CO",format:"HH:mm"};var g=function(){n.entity={id:0,customerCovidId:v,temperature:null,observation:null,registrationDate:new Date},h&&h.$setPristine(!0)};g(),n.form={submit:function(e){h=e;var t=null;if(e.$invalid){var n=null,t=null;for(n in e)"$"!=n[0]&&(null!==t||e[n].$valid||(t=e[n].$name),e[n].$pristine&&(e[n].$dirty=!0));return angular.element(".ng-invalid[name="+t+"]").focus(),void u.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}O()},reset:function(e){e.$setPristine(!0)}};var O=function(e){if(null==n.entity.registrationDate)return void u.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error");var t={},o=JSON.stringify(n.entity);return t.data=Base64.encode(o),d({method:"POST",url:"api/customer-covid-temperature/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(e){l(function(){u.swal("Registro","La información ha sido guardada satisfactoriamente","success"),g(),n.reloadData()})})["catch"](function(e){a.error(e),u.swal("Error de guardado","Error guardando el registro por favor verifique los datos ingresados!","error")})["finally"](function(){})};n.dtInstanceCustomerCovidTemperature={},n.dtOptionsCustomerCovidTemperature=s.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerCovidId=v,JSON.stringify(e)},url:"api/customer-covid-temperature",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){T()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,t,o){C(angular.element(e).contents())(n)}),n.dtColumnsCustomerCovidTemperature=[c.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,t,n,o){var r="",i='<a class="btn btn-danger btn-xs delRow lnk" href="#" tooltip="Eliminar registro" data-id="'+e.id+'" >   <i class="fa fa-trash-o"></i></a> ';return r+=i}),c.newColumn("registrationDate").withTitle("Hora Temperatura").withOption("width",200).withOption("defaultContent",""),c.newColumn("temperature").withTitle("Temperatura").withOption("width",200).withOption("defaultContent",""),c.newColumn("observation").withTitle("Observación").withOption("width",200).withOption("defaultContent","")];var T=function(){$("#dtCustomerCovidTemperature a.delRow").on("click",function(){var e=$(this).data("id");u.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(t){if(t){var o={};o.id=e,d({method:"POST",url:"api/customer-covid-temperature/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(e){swal("Eliminado","Regitro eliminado satisfactoriamente","info")})["catch"](function(e){u.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro por favor intentelo de nuevo","error")})["finally"](function(){n.reloadData()})}else swal("Cancelado","Operacion cancelada","error")})})};n.dtInstanceCustomerCovidTemperatureCallback=function(e){n.dtInstanceCustomerCovidTemperature=e},n.reloadData=function(){null!=n.dtInstanceCustomerCovidTemperature&&n.dtInstanceCustomerCovidTemperature.reloadData()}}]);
"use strict";app.controller("customerCovidPersonListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$aside","CustomerCovidService",function(n,e,t,o,r,i,a,l,s,u,c,d,f,p,m){var w=null,h=m.getDailyId();n.datePickerConfig={culture:"es-CO",format:"dd/MM/yyyy"};var C=function(){n.entity={id:0,customerCovidId:h,place:null,person:null,registrationDate:new Date},w&&w.$setPristine(!0)};C(),n.form={submit:function(n){w=n;var e=null;if(n.$invalid){var t=null,e=null;for(t in n)"$"!=t[0]&&(null!==e||n[t].$valid||(e=n[t].$name),n[t].$pristine&&(n[t].$dirty=!0));return angular.element(".ng-invalid[name="+e+"]").focus(),void f.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}return!0},reset:function(n){n.$setPristine(!0)}},n.onSave=function(){if(null==n.entity.registrationDate||null==n.entity.person||null==n.entity.place)return void f.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error");var e={},o=JSON.stringify(n.entity);return e.data=Base64.encode(o),d({method:"POST",url:"api/customer-covid-person-in-touch/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){c(function(){f.swal("Registro","La información ha sido guardada satisfactoriamente","success"),n.onCancel()})})["catch"](function(n){t.error(n),f.swal("Error de guardado","Error guardando el registro por favor verifique los datos ingresados!","error")})["finally"](function(){})},n.dtInstanceCustomerCovidPersonInTouch={},n.dtOptionsCustomerCovidPersonInTouch=o.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(n){return n.customerCovidId=h,JSON.stringify(n)},url:"api/customer-covid-person-in-touch",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){v()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,t,o){a(angular.element(e).contents())(n)}),n.dtColumnsCustomerCovidPersonInTouch=[r.newColumn(null).withTitle("Acciones").withOption("width",100).notSortable().renderWith(function(e,t,o,r){var i="",a='<a class="btn btn-danger btn-xs delRow lnk" href="#" tooltip="Eliminar registro" data-id="'+e.id+'" >   <i class="fa fa-trash-o"></i></a> ';return n.isView||(i+=a),i}),r.newColumn("place").withTitle("Lugar").withOption("width",250).withOption("defaultContent",""),r.newColumn("person").withTitle("Persona").withOption("width",350).withOption("defaultContent","")];var v=function(){$("#dtCustomerCovidPersonInTouch a.delRow").on("click",function(){var e=$(this).data("id");f.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(t){if(t){var o={};o.id=e,d({method:"POST",url:"api/customer-covid-person-in-touch/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(n){swal("Eliminado","Regitro eliminado satisfactoriamente","info")})["catch"](function(n){f.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro por favor intentelo de nuevo","error")})["finally"](function(){n.reloadData()})}else swal("Cancelado","Operacion cancelada","error")})})};n.dtInstanceCustomerCovidPersonInTouchCallback=function(e){n.dtInstanceCustomerCovidPersonInTouch=e},n.reloadData=function(){null!=n.dtInstanceCustomerCovidPersonInTouch&&n.dtInstanceCustomerCovidPersonInTouch.reloadData()},n.onCancel=function(){C(),n.reloadData()}}]);
"use strict";app.controller("customerCovidPersonNearListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$aside","CustomerCovidService",function(t,n,e,o,i,a,l,r,d,c,p,s,u,w,h){t.exportExcel=t.exportExcel,console.log(t.exportExcel);var C=h.getDailyId();t.dtInstanceCovid={},t.dtOptionsCovid=o.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.customerCovidId=C,JSON.stringify(t)},url:"api/customer-covid-person-near",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(n,e,o){l(angular.element(n).contents())(t)}),t.dtColumnsCovid=[i.newColumn("manacleId").withTitle("Id Manilla").withOption("width",200).withOption("defaultContent",""),i.newColumn("distance").withTitle("Distancia").withOption("width",200).withOption("defaultContent",""),i.newColumn("name").withTitle("Nombre").withOption("width",200).withOption("defaultContent",""),i.newColumn("lastName").withTitle("Apellido").withOption("width",200).withOption("defaultContent",""),i.newColumn("workplace").withTitle("Centro de Trabajo").withOption("width",200).withOption("defaultContent","")],t.dtInstanceCovidCallback=function(n){t.dtInstanceCovid=n},t.reloadData=function(){null!=t.dtInstanceCovid&&t.dtInstanceCovid.reloadData()},t.onExportExcel=function(){var t={customerCovidId:C};angular.element("#downloadDocument")[0].src="api/customer-covid-person-near/export?data="+Base64.encode(JSON.stringify(t))}}]);
"use strict";app.controller("customerCovidIndicatorTabsCtrl",["$scope","$rootScope","$timeout","$filter",function(o,t,e,i){o.views=[{name:"indicatorEmployee",url:t.app.views.urlRoot+"modules/customer/occupational/covid-19/indicator/employee/customer_covid_indicator_employee.htm"},{name:"indicatorExternal",url:t.app.views.urlRoot+"modules/customer/occupational/covid-19/indicator/external/customer_covid_indicator_external.htm"}],o.loading=!1,o.tabname="indicatorEmployee",o.loadedExternal=!1,o.getView=function(t){var e=i("filter")(o.views,{name:t});return e[0]},o.switchTab=function(t){e(function(){o.tabname=t,"indicatorExternal"==t&&(o.loadedExternal=!0)})},o.switchSubTab=function(t){e(function(){o.subtab=t})}}]);
"use strict";app.controller("customerCovidIndicatorEmployeeCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","$compile","ListService","ChartService","$aside","$rootScope","CustomerCovidService",function(e,t,a,i,o,r,l,n,d,c,s){function u(a,i){var o={customerId:t.customerId,isEmployee:!0};"day"==i&&(o.day=a),"period"==i&&(o.period=a);var r=[{name:"customer_covid_workplace",criteria:o}];l.getDataList(r).then(function(t){e.workplaceList=t.data.data.covidWorkplaceList},function(t){e.status="Unable to load customer data: "+t.message})}function p(){var a={customerId:t.customerId,isEmployee:!0},i=[{name:"customer_covid_period_list",criteria:a},{name:"customer_covid_date_list",criteria:a},{name:"customer_covid_risk_level_list",value:null}];l.getDataList(i).then(function(t){e.periodList=t.data.data.customerCovidPeriodList,e.dayList=t.data.data.customerCovidDateList,e.riskLevelList=t.data.data.customerCovidRiskLevelList},function(t){e.status="Unable to load customer data: "+t.message})}function m(){var a={customerId:t.customerId,type:e.filter.type};a.isEmployee=!0,1==e.filter.type&&(a.day=e.filter.selectedDay?e.filter.selectedDay.value:null),0==e.filter.type&&(a.period=e.filter.selectedPeriod?e.filter.selectedPeriod.value:null),e.filter.selectedWorkplace&&(a.workplaceId=e.filter.selectedWorkplace.id);var i=[{name:"chart_bar_options",criteria:a},{name:"chart_pie_options",criteria:a},{name:"customer_covid_indicators",criteria:a}];n.getDataChart(i).then(function(t){e.chart.bar.options=t.data.data.chartBarOptions,e.chart.pie.options=angular.copy(t.data.data.chartPieOptions),e.chart.pie.options.tooltips={callbacks:{label:function(e,t){v.info(t),v.info(e);var a=t.labels[e.index]||"";return a}}},e.chart.bar.options.legend.position="bottom",e.chart.pie.options.legend.position="bottom",e.chart.bar.options.maintainAspectRatio=!1,e.chart.bar.options.responsive=!1,e.chart.pie.options.maintainAspectRatio=!1,e.chart.pie.options.responsive=!1,e.chart.genre.data=t.data.data.covidGenre,e.chart.pregnant.data=t.data.data.covidPregnant,e.options={unit:"",readOnly:!0,displayPrevious:!0,barCap:25,trackWidth:20,barWidth:20,trackColor:"rgba(92,184,92,.1)",barColor:"#5BC01E",textColor:"#000"},e.chart.fever.data=t.data.data.covidFever,e.chart.employee.data=t.data.data.covidEmployee,e.chart.riskLevel.data=t.data.data.covidRiskLevel,e.chart.oximetria.data=t.data.data.covidOximetria,e.chart.pulsometria.data=t.data.data.covidPulsometria},function(t){e.status="Unable to load customer data: "+t.message})}var v=a;e.options={unit:"",readOnly:!0,barCap:25,trackWidth:20,barWidth:20,trackColor:"rgba(92,184,92,.1)",barColor:"#5BC01E",textColor:"#000"},e.filter={type:"1",selectedDay:null,selectedPeriod:null,selectedRiskLevel:null,selectedWorkplace:null},e.chart={bar:{options:null},pie:{options:null},genre:{data:null},pregnant:{data:null},fever:{data:null},employee:{data:null},riskLevel:{data:null},oximetria:{data:null},pulsometria:{data:null}},e.onSelectDay=function(){e.filter.selectedPeriod=null,m(),e.reloadData(),u(e.filter.selectedDay.value,"day")},e.onSelectPeriod=function(){e.filter.selectedDay=null,m(),e.reloadData(),u(e.filter.selectedPeriod.value,"period")},e.onSelectRiskLevel=function(){e.reloadData()},e.onSelectWorkplace=function(){m(),e.reloadData()},e.onClearWorkplace=function(){null!=e.filter.selectedWorkplace&&(e.filter.workplaceId=null,e.filter.selectedWorkplace=null,m(),e.reloadData())},e.onExportPdf=function(){kendo.drawing.drawDOM($(".covid-indicator-export-pdf")).then(function(e){return kendo.drawing.exportPDF(e,{paperSize:"auto",margin:{left:"1cm",top:"1cm",right:"1cm",bottom:"1cm"}})}).done(function(e){kendo.saveAs({dataURI:e,fileName:"Covid_19_Indicadores.pdf",proxyURL:"//demos.telerik.com/kendo-ui/service/export"})})},e.dtOptionsCustomerCovidRiskLevel=i.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(a){return a.customerId=t.customerId,a.riskLevel=e.filter.selectedRiskLevel?e.filter.selectedRiskLevel.value:null,a.isExternal=0,e.filter.selectedWorkplace&&(a.workplaceId=e.filter.selectedWorkplace.id),1==e.filter.type&&(a.day=e.filter.selectedDay?e.filter.selectedDay.value:null),0==e.filter.type&&(a.period=e.filter.selectedPeriod?e.filter.selectedPeriod.value:null),JSON.stringify(a)},url:"api/customer-covid-indicator",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){f()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,a,i){r(angular.element(t).contents())(e)}),e.dtColumnsCustomerCovidRiskLevel=[o.newColumn(null).withTitle("Acciones").withOption("width",70).notSortable().renderWith(function(e,t,a,i){var o="";if(1==e.hasPersons){var r='<a class="btn btn-info btn-xs viewRow lnk" href="#"  uib-tooltip="Personas Cercanas" data-id="'+e.id+'" ><i class="fa fa-users"></i></a> ';o+=r}return o}),o.newColumn("registrationDate").withTitle("Fecha").withOption("width",180).withOption("defaultContent",""),o.newColumn("fullName").withTitle("Empleado").withOption("width",200).withOption("defaultContent",""),o.newColumn("questions").withTitle("Sintomas").withOption("width",200).withOption("defaultContent",""),o.newColumn(null).withTitle("Nivel Riesgo").withOption("width",200).renderWith(function(e,t,a,i){var o="label";return'<span class="'+o+'" style="background-color:'+e.riskLevelColor+'">'+e.riskLevelText+"</span>"})];var f=function(){angular.element("#dtCustomerCovidRiskLevel a.viewRow").on("click",function(){var e=angular.element(this).data("id");h(e)})},h=function(t){s.setDailyId(t),e.exportExcel=!0,d.open({templateUrl:c.app.views.urlRoot+"modules/customer/occupational/covid-19/health-condition/person-near/customer_covid_person_near.htm",placement:"right",backdrop:"static",size:"lg",scope:e})};e.dtInstanceCustomerCovidRiskLevelCallback=function(t){e.dtInstanceCustomerCovidRiskLevel=t},e.reloadData=function(){e.dtInstanceCustomerCovidRiskLevel.reloadData()},e.onClearRiskLevel=function(){e.filter.selectedRiskLevel=null,e.reloadData()},m(),p()}]);
"use strict";app.controller("customerCovidIndicatorExternalCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","$compile","ListService","ChartService","$aside","$rootScope","CustomerCovidService",function(e,t,a,o,i,r,l,n,c,d,s){function u(a,o){var i={customerId:t.customerId,isExternal:!0};"day"==o&&(i.day=a),"period"==o&&(i.period=a);var r=[{name:"customer_covid_workplace",criteria:i},{name:"customer_covid_contractor",criteria:i}];l.getDataList(r).then(function(t){e.workplaceList=t.data.data.covidWorkplaceList,e.contractorList=t.data.data.covidContractorList},function(t){e.status="Unable to load customer data: "+t.message})}function p(){var a={customerId:t.customerId,isExternal:!0},o=[{name:"customer_covid_period_list",criteria:a},{name:"customer_covid_date_list",criteria:a},{name:"customer_covid_risk_level_list",value:null}];l.getDataList(o).then(function(t){e.periodList=t.data.data.customerCovidPeriodList,e.dayList=t.data.data.customerCovidDateList,e.riskLevelList=t.data.data.customerCovidRiskLevelList},function(t){e.status="Unable to load customer data: "+t.message})}function f(){var a={customerId:t.customerId,type:e.filter.type};1==e.filter.type&&(a.day=e.filter.selectedDay?e.filter.selectedDay.value:null),0==e.filter.type&&(a.period=e.filter.selectedPeriod?e.filter.selectedPeriod.value:null),e.filter.selectedWorkplace&&(a.workplaceId=e.filter.selectedWorkplace.id),e.filter.selectedContractor&&(a.contractorId=e.filter.selectedContractor.id),a.isExternal=!0;var o=[{name:"chart_bar_options",criteria:a},{name:"chart_pie_options",criteria:a},{name:"customer_covid_indicators",criteria:a}];n.getDataChart(o).then(function(t){e.chart.bar.options=t.data.data.chartBarOptions,e.chart.pie.options=angular.copy(t.data.data.chartPieOptions),e.chart.pie.options.tooltips={callbacks:{label:function(e,t){v.info(t),v.info(e);var a=t.labels[e.index]||"";return a}}},e.chart.bar.options.legend.position="bottom",e.chart.pie.options.legend.position="bottom",e.chart.bar.options.maintainAspectRatio=!1,e.chart.bar.options.responsive=!1,e.chart.pie.options.maintainAspectRatio=!1,e.chart.pie.options.responsive=!1,e.chart.genre.data=t.data.data.covidGenre,e.chart.pregnant.data=t.data.data.covidPregnant,e.options={unit:"",readOnly:!0,displayPrevious:!0,barCap:25,trackWidth:20,barWidth:20,trackColor:"rgba(92,184,92,.1)",barColor:"#5BC01E",textColor:"#000"},e.chart.fever.data=t.data.data.covidFever,e.chart.employee.data=t.data.data.covidEmployee,e.chart.employeeWorkplace.data=t.data.data.covidEmployeeWorkPlace,e.chart.riskLevel.data=t.data.data.covidRiskLevel,e.chart.oximetria.data=t.data.data.covidOximetria,e.chart.pulsometria.data=t.data.data.covidPulsometria},function(t){e.status="Unable to load customer data: "+t.message})}var v=a;e.options={unit:"",readOnly:!0,displayPrevious:!0,barCap:25,trackWidth:20,barWidth:20,trackColor:"rgba(92,184,92,.1)",barColor:"#5BC01E",textColor:"#000"},e.filter={type:"1",selectedDay:null,selectedPeriod:null,selectedRiskLevel:null,selectedWorkplace:null,selectedContractor:null},e.chart={bar:{options:null},pie:{options:null},genre:{data:null},pregnant:{data:null},fever:{data:null},employee:{data:null},employeeWorkplace:{data:null},riskLevel:{data:null},oximetria:{data:null},pulsometria:{data:null}},e.onSelectDay=function(){e.filter.selectedPeriod=null,f(),e.reloadData(),u(e.filter.selectedDay.value,"day")},e.onSelectPeriod=function(){e.filter.selectedDay=null,f(),e.reloadData(),u(e.filter.selectedPeriod.value,"period")},e.onSelectRiskLevel=function(){e.reloadData()},e.onSelectWorkplace=function(){f(),e.reloadData()},e.onClearWorkplace=function(){null!=e.filter.selectedWorkplace&&(e.filter.workplaceId=null,e.filter.selectedWorkplace=null,f(),e.reloadData())},e.onSelectContractor=function(){f(),e.reloadData()},e.onClearContractor=function(){null!=e.filter.selectedContractor&&(e.filter.contractorId=null,e.filter.selectedContractor=null,f(),e.reloadData())},e.onExportPdf=function(){kendo.drawing.drawDOM($(".covid-indicator-export-pdf")).then(function(e){return kendo.drawing.exportPDF(e,{paperSize:"auto",margin:{left:"1cm",top:"1cm",right:"1cm",bottom:"1cm"}})}).done(function(e){kendo.saveAs({dataURI:e,fileName:"Covid_19_Indicadores.pdf",proxyURL:"//demos.telerik.com/kendo-ui/service/export"})})},e.dtOptionsCustomerCovidRiskLevel=o.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(a){return a.customerId=t.customerId,a.riskLevel=e.filter.selectedRiskLevel?e.filter.selectedRiskLevel.value:null,a.isExternal=1,e.filter.selectedWorkplace&&(a.workplaceId=e.filter.selectedWorkplace.id),1==e.filter.type&&(a.day=e.filter.selectedDay?e.filter.selectedDay.value:null),0==e.filter.type&&(a.period=e.filter.selectedPeriod?e.filter.selectedPeriod.value:null),JSON.stringify(a)},url:"api/customer-covid-indicator",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){m()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,a,o){r(angular.element(t).contents())(e)}),e.dtColumnsCustomerCovidRiskLevel=[i.newColumn(null).withTitle("Acciones").withOption("width",70).notSortable().renderWith(function(e,t,a,o){var i="";if(1==e.hasPersons){var r='<a class="btn btn-info btn-xs viewRow lnk" href="#"  uib-tooltip="Personas Cercanas" data-id="'+e.id+'" ><i class="fa fa-users"></i></a> ';i+=r}return i}),i.newColumn("registrationDate").withTitle("Fecha").withOption("width",180).withOption("defaultContent",""),i.newColumn("fullName").withTitle("Empleado").withOption("width",200).withOption("defaultContent",""),i.newColumn("questions").withTitle("Sintomas").withOption("width",200).withOption("defaultContent",""),i.newColumn(null).withTitle("Nivel Riesgo").withOption("width",200).renderWith(function(e,t,a,o){var i="label";return'<span class="'+i+'" style="background-color:'+e.riskLevelColor+'">'+e.riskLevelText+"</span>"})];var m=function(){angular.element("#dtCustomerCovidRiskLevel a.viewRow").on("click",function(){var e=angular.element(this).data("id");h(e)})},h=function(t){s.setDailyId(t),e.exportExcel=!0,c.open({templateUrl:d.app.views.urlRoot+"modules/customer/occupational/covid-19/health-condition/person-near/customer_covid_person_near.htm",placement:"right",backdrop:"static",size:"lg",backdrop:!0,scope:e})};e.dtInstanceCustomerCovidRiskLevelCallback=function(t){e.dtInstanceCustomerCovidRiskLevel=t},e.reloadData=function(){e.dtInstanceCustomerCovidRiskLevel.reloadData()},e.onClearRiskLevel=function(){e.filter.selectedRiskLevel=null,e.reloadData()},f(),p()}]);
"use strict";app.controller("customerVrEmployeeCtrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout",function(e,o,t,r,c,n){var i=t;i.info("loading..customerVrEmployeeCtrl!!! "),e.vr_employee_section="list",e.currentId=0,e.editMode="create",e.navToSection=function(o,t,r){n(function(){e.vr_employee_section=o,e.editMode=t,e.$parent.switchSubTab(t),e.currentId=r})}}]);
"use strict";app.factory("customerVrEmployeeService",function(){var t={},n=null,e=null,r=null;return t.setId=function(t){n=t},t.getId=function(){return n},t.setEntity=function(t){e=t},t.getEntity=function(){return e},t.setEntityExperience=function(t){r=t},t.getEntityExperience=function(){return r},t});
"use strict";app.controller("customerVrEmployeeTabsCtrl",["$scope","$rootScope","$timeout","$filter",function(t,e,a,n){t.loading=!1,t.tabname="tab1",t.activeTab=1,t.loadedOther=["tab1"],t.getView=function(e){var a=n("filter")(t.views,{name:e});return a[0]},t.switchTab=function(e){a(function(){t.tabname=e,t.loadedOther.push(e)})},t.switchSubTab=function(e){a(function(){t.subtab=e})}}]);
"use strict";app.controller("customerVrEmployeeRegisterListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$document","$filter","$aside","ListService","$uibModal","ngNotify","customerVrEmployeeService",function(e,t,o,n,a,i,r,l,s,c,d,u,m,f,p,g,v,h,b,y){function I(){var t=[{name:"criteria_operators",value:null},{name:"criteria_conditions",value:null},{name:"customer_vr_employee_filter_field",value:null}];v.getDataList(t).then(function(t){e.criteria=t.data.data.criteriaOperatorList,e.conditions=t.data.data.criteriaConditionList,e.audit.fields=t.data.data.customerVrEmployeeFilterField},function(t){e.status="Unable to load customer data: "+t.message})}function w(e){var t=JSON.stringify({sessionId:e}),n={data:Base64.encode(t)};return u({method:"POST",url:"api/customer-vr-employee-experience-evaluation/destroy-certificate",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(e){console.log("ha finalizado la eliminación de certificados desactualizados")})["catch"](function(e){o.error(e),m.swal("Error al guardar",e.data.message,"error")})}e.audit={fields:[],filters:[]},I(),e.addFilter=function(){null==e.audit.filters&&(e.audit.filters=[]),e.audit.filters.push({id:0,field:null,criteria:e.criteria.length>0?e.criteria[1]:null,condition:e.conditions.length>0?e.conditions[0]:null,value:""})},e.onFilter=function(){e.reloadData()},e.removeFilter=function(t){e.audit.filters.splice(t,1)},e.onCleanFilter=function(){e.audit.filters=[],e.reloadData()},d(function(){e.mainGridOptions={dataSource:{type:"odata",transport:{read:{url:"api/customer-vr-employee",dataType:"json",type:"POST",data:function(){var o={};return o.customerId=t.customerId,angular.isDefined(e.audit)&&angular.isDefined(e.audit.filters)&&(o.filter={filters:e.audit.filters.filter(function(e){return null!=e&&null!=e.field&&null!=e.criteria}).map(function(e,t,o){return{field:e.field.name,operator:e.criteria.value,value:e.value,condition:e.condition.value}})}),o}},parameterMap:function(e,t){return JSON.stringify(e)}},schema:{model:{id:"id"},data:function(e){return e.data||e},total:function(e){return e.recordsTotal||e.data.length||0}},pageSize:10,serverPaging:!0,serverFiltering:!0,serverSorting:!0},sortable:{mode:"multiple"},pageable:{change:function(e){pager.index=e.index}},dataBound:function(t){e.grid.tbody.find("tr").each(function(){var t=e.grid.dataItem(this),o=void 0!==t&&"Finalizado"==t.isActive,n=void 0!==t&&"En Progreso"==t.isActive&&parseFloat(t.average)>0,a=void 0!==t&&"Anulado"!=t.isActive&&"Finalizado"!=t.isActive;a||($(this).find(".btn-warning").remove(),$(this).find(".btn-primary").remove()),o||$(this).find(".btn-danger").remove(),n||$(this).find(".btn-dark-azure").remove()})},columns:[{command:[{text:" ",template:"<a class='btn btn-info btn btn-sm' ng-click='onView(dataItem)' uib-tooltip='Ver' tooltip-placement='right'><i class='fa fa-eye'></i></a> "},{text:" ",template:"<a class='btn btn-primary btn btn-sm' ng-click='onEdit(dataItem)' uib-tooltip='Editar' tooltip-placement='right'><i class='fa fa-edit'></i></a> "},{text:" ",template:"<a class='btn btn-warning btn btn-sm' ng-click='onInvalidate(dataItem)' uib-tooltip='Anular' tooltip-placement='right'><i class='fa fa-ban'></i></a> "},{text:" ",template:"<a class='btn btn-danger btn btn-sm' ng-href='[[dataItem.documentUrl]]'  target='_blank' uib-tooltip='Certificado' tooltip-placement='right'><i class='fa fa-file-pdf-o'></i></a> "},{text:" ",template:"<a class='btn btn-dark-azure btn btn-sm' ng-click='onGenerateCertificate(dataItem)' uib-tooltip='Generar Certificado' tooltip-placement='right'><i class='fa fa-share-square-o'></i></a> "}],width:"160px"},{field:"registrationDate",title:"Fecha",width:"150px",filterable:{cell:{operator:"contains",suggestionOperator:"contains"}}},{field:"documentType",title:"Tipo Identificación",filterable:{cell:{operator:"contains",suggestionOperator:"contains"}}},{field:"documentNumber",title:"Num. Identificación",filterable:{cell:{operator:"contains",suggestionOperator:"contains"}}},{field:"fullName",title:"Nombre",filterable:{cell:{operator:"contains",suggestionOperator:"contains"}}},{field:"dateRealization",title:"Fecha Realización",filterable:{cell:{operator:"contains",suggestionOperator:"contains"}}},{field:"average",title:"% Completado",filterable:{cell:{operator:"contains",suggestionOperator:"contains"}},template:function(e){return"<span>"+e.average+"%</span>"}},{field:"qtyExperience",title:"# Experiencias",filterable:{cell:{operator:"contains",suggestionOperator:"contains"}}},{title:"Estado",width:"200px",filterable:{cell:{operator:"contains",suggestionOperator:"contains"}},template:function(e){var t="label label-default";"Anulado"==e.isActive?t="label label-warning":"Finalizado"==e.isActive&&(t="label label-inverse");var o='<span class="'+t+'">'+e.isActive+"</span>";return o},attributes:{style:"text-align: center;font-weight: bold;"}}]},e.detailGridOptions=function(e){return{dataSource:{type:"odata",transport:{read:{url:"api/customer-vr-employee/detail",dataType:"json",type:"POST",data:function(){var o={customerId:t.customerId,customerVrEmployeeId:e.id};return o}},parameterMap:function(e,t){return JSON.stringify(e)}},requestEnd:function(e){},schema:{model:{id:"id",fields:{description:{editable:!1,nullable:!0},article:{editable:!1,nullable:!0},rate:{editable:!1,defaultValue:{id:0,text:null,code:null}}}},data:function(e){return e.data||e},total:function(e){return e.recordsTotal||e.data.length||0}},serverPaging:!1,serverSorting:!1,serverFiltering:!1,filter:{field:"customerVrEmployeeId",operator:"eq",value:e.id}},editable:"incell",edit:function(e){editedRow.model=e.model},scrollable:!1,sortable:!1,pageable:!1,columns:[{field:"experience",title:"Experiencia"},{title:"Calificación",template:function(e){var t='<h4 class="inline-block padding-top-10 '+e.colorPercent+'">'+e.percent+"%</h4>";return t},attributes:{style:"text-align: left;font-weight: bold;"}}]}}}),e.$on("kendoWidgetCreated",function(t,o){void 0!==e.grid&&null!==e.grid||(e.grid=o)}),e.onCreate=function(t){y.setEntity(null),y.setId(t),null!=e.$parent&&e.$parent.navToSection("form","edit",0)},e.onEdit=function(t){y.setEntity(null),y.setId(t.id),null!=e.$parent&&(t.hasConfig?e.$parent.navToSection("metrics","edit",t.id):e.$parent.navToSection("form","edit",t.id))},e.onView=function(t){y.setEntity(null),y.setId(t.id),null!=e.$parent&&(t.hasConfig?e.$parent.navToSection("metrics","view",t.id):e.$parent.navToSection("form","view",t.id))},e.onInvalidate=function(t){m.swal({title:"Está seguro?",text:"Anulará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, anular!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(n){if(n){var a={};a.id=t.id,u({method:"POST",url:"api/customer-vr-employee/cancel",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info"),e.reloadData()})["catch"](function(e){o.error(e),m.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){e.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})},e.reloadData=function(){e.grid.dataSource.read()},e.onGenerateCertificate=function(t){var n=JSON.stringify({customerVrEmployeeId:t.id}),a={data:Base64.encode(n)};return u({method:"POST",url:"api/customer-vr-employee-experience-evaluation/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(t){e.reloadData()})["catch"](function(e){o.error(e),m.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})},e.onDownload=function(e){console.log(e),angular.element("#downloadDocument")[0].src=e.documentUrl},e.onImport=function(){var t=g.open({templateUrl:c.app.views.urlRoot+"modules/customer/common/modals/import_modal.htm",placement:"bottom",size:"lg",backdrop:!0,controller:"ModalInstanceSideImportCtrl",scope:e});t.result.then(function(t){t&&t.sessionId&&!t.isValid?null!=e.$parent&&e.$parent.navToSection("staging","staging",t.sessionId):(e.reloadData(),w(t.sessionId))})},e.onImportEmployee=function(){var t=g.open({templateUrl:c.app.views.urlRoot+"modules/customer/common/modals/import_modal.htm",placement:"bottom",size:"lg",backdrop:!0,controller:"ModalInstanceSideImportEmployeeCtrl",scope:e});t.result.then(function(t){e.reloadData()})},e.onExport=function(o){var n={customerId:t.customerId,filter:{}};angular.isDefined(e.audit)&&angular.isDefined(e.audit.filters)&&(n.filter={filters:e.audit.filters.filter(function(e){return null!=e&&null!=e.field&&null!=e.criteria}).map(function(e,t,o){return{field:e.field.name,operator:e.criteria.value,value:e.value,condition:e.condition.value}})}),angular.element("#downloadDocument")[0].src="api/customer-vr-employee/export?data="+Base64.encode(JSON.stringify(n))},e.onDownoladAllCertificate=function(){var e=h.open({templateUrl:c.app.views.urlRoot+"modules/customer/vr-employee/register/customer_vr_employee_register_modal.htm",controller:"ModalInstanceCustomerVrEmployeeCertificateCtrl",windowTopClass:"top-modal"});e.result.then(function(e){if(e){b.set("El archivo se está generando.",{position:"bottom",sticky:!0,button:!1,html:!0});var o={customerId:t.customerId,period:e.value},n={},a=JSON.stringify(o);n.data=Base64.encode(a),u({method:"POST",url:"api/customer-vr-employee/export-certificate",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(e){if("ok"==e.data.message){var t=e.data.path+e.data.filename,o='<a class="btn btn-wide btn-default" href="'+t+'" target="_self"><i class="glyphicon glyphicon-download"></i> Descargar zip</a>';b.set(o,{position:"bottom",sticky:!0,type:"success",button:!0,html:!0})}else b.set("Ocurrio un error al generar los certificados",{position:"bottom",sticky:!0,type:"error",button:!0,html:!0})})["catch"](function(e){b.set(e.data.message,{position:"bottom",sticky:!0,type:"error",button:!0,html:!0})})["finally"](function(){})}},function(){})},e.onGeneratellCertificate=function(){b.set("Se está ejecutando el proceso. Por favor espere.",{position:"bottom",sticky:!0,button:!1,html:!0});var o={customerId:t.customerId},n={},a=JSON.stringify(o);n.data=Base64.encode(a),u({method:"POST",url:"api/customer-vr-employee-experience-evaluation/generate-massive-certificates",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(t){"ok"==t.data.message?(e.reloadData(),b.set("Certificados generados satisfactoriamente!.",{position:"bottom",sticky:!0,button:!0,html:!0,type:"success"})):b.set("No se encontraron certificados para generar",{position:"bottom",sticky:!0,type:"error",button:!0,html:!0})})["catch"](function(e){b.set(e.data.message,{position:"bottom",sticky:!0,type:"error",button:!0,html:!0})})["finally"](function(){})}}]),app.controller("ModalInstanceSideImportCtrl",["$rootScope","$stateParams","$scope","FileUploader","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","ngNotify","ListService",function(e,t,o,n,a,i,r,l,s,c,d,u){function m(){var e=[{name:"export_url",value:null}];u.getDataList(e).then(function(e){f=e.data.data.exportUrl.item,v.url=f+g,o.uploader.url=f+g},function(e){o.status="Unable to load customer data: "+e.message})}var f="",p=null,g="api/v1/customer-vr-employee-import";o.title="Realidad Virtual Empleados";var v=o.uploader=new n({url:f+g,formData:[]});m(),o.download=function(){angular.element("#downloadDocument")[0].src="api/customer-vr-employee/download-template?customerId="+t.customerId},v.filters.push({name:"customFilter",fn:function(e,t){return this.queue.length<10}}),v.onWhenAddingFileFailed=function(e,t,o){console.info("onWhenAddingFileFailed",e,t,o)},v.onAfterAddingFile=function(e){console.info("onAfterAddingFile",e)},v.onAfterAddingAll=function(e){console.info("onAfterAddingAll",e)},v.onBeforeUploadItem=function(o){console.info("onBeforeUploadItem",o);var n={id:t.customerId,user:e.currentUser().id};o.formData.push(n)},v.onProgressItem=function(e,t){console.info("onProgressItem",e,t)},v.onProgressAll=function(e){console.info("onProgressAll",e)},v.onSuccessItem=function(e,t,o,n){console.info("onSuccessItem",e,t,o,n)},v.onErrorItem=function(e,t,o,n){console.info("onErrorItem",e,t,o,n)},v.onCancelItem=function(e,t,o,n){console.info("onCancelItem",e,t,o,n)},v.onCompleteItem=function(e,t,o,n){console.info("onCompleteItem",e,t,o,n),p=t},v.onCompleteAll=function(){console.info("onCompleteAll"),a.close(p)}}]),app.controller("ModalInstanceSideImportEmployeeCtrl",["$rootScope","$stateParams","$scope","FileUploader","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","ngNotify","ListService",function(e,t,o,n,a,i,r,l,s,c,d,u){function m(){var e=[{name:"export_url",value:null}];u.getDataList(e).then(function(e){f=e.data.data.exportUrl.item,v.url=f+g,o.uploader.url=f+g},function(e){o.status="Unable to load customer data: "+e.message})}var f="",p=null,g="api/v1/customer-vr-employee-head-import";o.title="Realidad Virtual - Empleados";var v=o.uploader=new n({url:f+g,formData:[]});m(),o.download=function(){angular.element("#downloadDocument")[0].src="api/customer-vr-employee-head/download-template?customerId="+t.customerId},v.filters.push({name:"customFilter",fn:function(e,t){return this.queue.length<10}}),v.onWhenAddingFileFailed=function(e,t,o){console.info("onWhenAddingFileFailed",e,t,o)},v.onAfterAddingFile=function(e){console.info("onAfterAddingFile",e)},v.onAfterAddingAll=function(e){console.info("onAfterAddingAll",e)},v.onBeforeUploadItem=function(o){console.info("onBeforeUploadItem",o);var n={id:t.customerId,user:e.currentUser().id};o.formData.push(n)},v.onProgressItem=function(e,t){console.info("onProgressItem",e,t)},v.onProgressAll=function(e){console.info("onProgressAll",e)},v.onSuccessItem=function(e,t,o,n){console.info("onSuccessItem",e,t,o,n)},v.onErrorItem=function(e,t,o,n){console.info("onErrorItem",e,t,o,n)},v.onCancelItem=function(e,t,o,n){console.info("onCancelItem",e,t,o,n)},v.onCompleteItem=function(e,t,o,n){console.info("onCompleteItem",e,t,o,n),p=t},v.onCompleteAll=function(){console.info("onCompleteAll"),a.close(p)}}]),app.controller("ModalInstanceCustomerVrEmployeeCertificateCtrl",["$rootScope","$stateParams","$scope","FileUploader","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","ngNotify","ListService",function(e,t,o,n,a,i,r,l,s,c,d,u){function m(){var e=[{name:"customer_employee_vr_period_list",criteria:{customerId:t.customerId}}];u.getDataList(e).then(function(e){o.periodList=e.data.data.employeeVrPeriodList},function(e){o.status="Unable to load customer data: "+e.message})}o.periodList=[],m();var f=null,p=function(){o.entity={period:null},null!=f&&f.$setPristine(!0)};o.maxDate=new Date,o.datePickerConfig={culture:"es-CO",format:"dd/MM/yyyy"},p(),o.form={submit:function(e){if(f=e,e.$invalid){var t=null,o=null;for(t in e)"$"!=t[0]&&(null!==o||e[t].$valid||(o=e[t].$name),e[t].$pristine&&(e[t].$dirty=!0));angular.element(".ng-invalid[name="+o+"]").focus(),l.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}else g()},reset:function(e){e.$setPristine(!0)}};var g=function(){a.close(o.entity.period),p()};o.onCancel=function(){a.dismiss()}}]);
"use strict";app.controller("customerVrEmployeeRegisterStagingListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$document","$filter","$aside","ListService",function(i,a,t,e,n,s,l,o,d,r,u,c,y,p,m,b,f){function h(){var a=[{name:"export_url",value:null}];f.getDataList(a).then(function(i){w=i.data.data.exportUrl.item},function(a){i.status="Unable to load customer data: "+a.message})}var w="";i.audit={fields:[],filters:[]},h(),i.dtInstanceCustomerEmployeeVrStagingDT={},i.dtOptionsCustomerEmployeeVrStagingDT=e.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.customerId=a.customerId,t.sessionId=i.$parent.currentId,t.isValid=0,JSON.stringify(t)},url:"api/customer-vr-employee-staging",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[1,"asc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){g()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(a,t,e){l(angular.element(a).contents())(i)}),i.dtColumnsCustomerEmployeeVrStagingDT=[n.newColumn(null).withTitle("Fila").withOption("width",50).renderWith(function(i,a,t,e){var n=1==i.is_valid||i.is_valid?"badge badge-success":"badge badge-danger",s=1==i.is_valid||i.is_valid?' <i class=" fa fa-check"></i>':' <i class=" fa fa-ban"></i>';return'<span class="'+n+'">'+i.index+s+"</span>"}),n.newColumn("registration_date").withTitle("Fecha Realización").withOption("width",200).withOption("defaultContent",""),n.newColumn("document_type").withTitle("Tipo Identificación").withOption("width",200).withOption("defaultContent",""),n.newColumn("document_number").withTitle("Nro Identificación").withOption("width",200).withOption("defaultContent",""),n.newColumn("experience").withTitle("Experiencia").withOption("width",100).withOption("defaultContent",""),n.newColumn("experience_scene").withTitle("Escena").withOption("width",100).withOption("defaultContent",""),n.newColumn("indicator").withTitle("Indicador").withOption("width",100).withOption("defaultContent",""),n.newColumn("value").withTitle("Valoración").withOption("width",100).withOption("defaultContent",""),n.newColumn("justification").withTitle("Justificación").withOption("width",100).withOption("defaultContent",""),n.newColumn("observation_type").withTitle("Tipo de Observación").withOption("width",100).withOption("defaultContent",""),n.newColumn("observation_value").withTitle("Observación").withOption("width",180).withOption("defaultContent",""),n.newColumn("error_validation").withTitle("Mensaje Importación").withOption("width",180).withOption("defaultContent","")];var g=function(){};i.dtInstanceCustomerEmployeeVrStagingDTCallback=function(a){i.dtInstanceCustomerEmployeeVrStagingDT=a},i.reloadData=function(){i.dtInstanceCustomerEmployeeVrStagingDT.reloadData()},i.onCancel=function(){p.scrollTop(40,2e3),null!=i.$parent&&i.$parent.navToSection("list","list")}}]),app.controller("ModalInstanceSideCustomerAbsenteeismDisabilityStagingEditCtrl",["$rootScope","$stateParams","$scope","dataItem","isView","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","ngNotify","$document","$filter","$aside","ListService",function(i,a,t,e,n,s,l,o,d,r,u,c,y,p,m,b){function f(){var i=[{name:"absenteeism_disability_day_charged_is_death",value:null},{name:"absenteeism_disability_current_minimum_daily",value:null},{name:"config_day_charged_part",value:null},{name:"customer_workplace",value:a.customerId}];b.getDataList(i).then(function(i){t.workplaceList=i.data.data.workplaceList,w=i.data.data.absenteeismDisabilityDayChargedIsDeath?i.data.data.absenteeismDisabilityDayChargedIsDeath.value:0,g=i.data.data.absenteeismDisabilityCurrentMinimumDaily?i.data.data.absenteeismDisabilityCurrentMinimumDaily.value:0,t.configDayChargedPartList=i.data.data.configDayChargedPart},function(i){t.status="Unable to load customer data: "+i.message})}t.onCloseModal=function(){s.close(null)},t.onCancel=function(){s.dismiss("cancel")};var h=l,w=0,g=0;t.causeList=i.parameters("absenteeism_disability_causes"),t.causeListAdmin=i.parameters("absenteeism_disability_causes_admin"),t.causes=i.parameters("absenteeism_disability_causes"),t.types=i.parameters("absenteeism_disability_type"),t.contractTypes=i.parameters("employee_contract_type"),t.years=[],t.documentType=i.parameters("customer_document_type"),t.tiposdoc=i.parameters("tipodoc"),t.absenteeismType=i.parameters("absenteeism_category"),t.concept=i.parameters("absenteeism_concept_cost"),t.diagnostics=[],t.employees=[],f(),t.maxDate=new Date,t.datePickerConfig={culture:"es-CO",format:"dd/MM/yyyy"},t.loading=!0,t.customer_id=a.customerId,t.isView=n,t.isCreate=!0,t.format="dd-MM-yyyy",t.currentYear=null,t.filter={selectedCause:null};var v=function(){t.disability={id:e.id,category:null,type:null,cause:null,workplace:null,accidentType:null,diagnostic:null,employee:null,dayLiquidationBasis:0,dayLiquidationBasisFormat:"",hourLiquidationBasis:0,hourLiquidationBasisFormat:"",startDate:new Date,endDate:new Date,numberDays:0,chargedDays:0,charged:!1,amountPaid:0,indirectCost:[],directCostTotal:0,indirectCostTotal:0}};v();var D=function(){var a=t.accidentTypeList=i.parameters("absenteeism_disability_accident_type");null!==a&&t.disability.cause&&(t.accidentTypeList=a.filter(function(i){return null!=t.disability.type&&"Sin Incapacidad"==t.disability.type.value?"L"==i.value||"M"==i.value:"AL"==t.disability.cause.value||"AT"==t.disability.cause.value?"N"!==i.value:"EL"==t.disability.cause.value||"ELC"==t.disability.cause.value?"N"==i.value||"M"==i.value:void 0}))};D(),t.onLoadRecord=function(){if(0!=t.disability.id){var i={id:t.disability.id};r({method:"GET",url:"api/customer-absenteeism-disability-staging/get",params:i})["catch"](function(i,a){if(403==a){var t=null!==i.message&&void 0!==i.message?i.message:"app.clientes.list";d.swal("No Autorizado","No estas autorizado para ver esta información.","error"),o(function(){$state.go(t)},3e3)}else 404==a?d.swal("Información no disponible","Centro de trabajo no encontrado","error"):d.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(i){console.log(i),o(function(){t.disability=i.data.result,null!=t.disability.category&&"Incapacidad"!=t.disability.category.value?t.causes=t.causeListAdmin:t.causes=t.causeList,C(),t.onChangeStartDate(),I(),L(),D();var a=t.accidentTypeList.filter(function(i){return null!=i&&t.disability.accidentType&&i.value==t.disability.accidentType.value});0==a.length&&(t.disability.accidentType=null)})})["finally"](function(){o(function(){t.loading=!1},400),o(function(){y.scrollTop(40,2e3)})})}else h.info("creacion de nuevo cliente"),t.loading=!1},t.onLoadRecord();var C=function(){if(t.disability.startDate=new Date(t.disability.startDate.date),t.disability.endDate=new Date(t.disability.endDate.date),null!=t.disability.diagnostic){var i=p("filter")(t.diagnostics,{id:t.disability.diagnostic.id});0==i.length&&t.diagnostics.push(t.disability.diagnostic)}t.disability.dayLiquidationBasisFormat=p("currency")(t.disability.dayLiquidationBasis,"$ ",2),t.disability.hourLiquidationBasisFormat=p("currency")(t.disability.hourLiquidationBasis,"$ ",2),t.disability.indirectCostTotal=p("currency")(t.disability.indirectCostTotal,"$ ",2)};t.$watch("disability.endDate - disability.startDate",function(){T(),I()});var T=function(){var i=new moment(t.disability.endDate),a=new moment(t.disability.startDate);t.disability.isHour||(null!=t.disability.type&&"Sin Incapacidad"==t.disability.type.value?t.disability.numberDays=0:t.disability.numberDays=i.diff(a,"days")+1)};t.onChangeStartDate=function(i){null!=t.disability.type&&"Sin Incapacidad"==t.disability.type.value&&(t.disability.numberDays=0,t.disability.endDate=new Date(t.disability.startDate))},t.$watch("disability.employee.salary",function(){null!=t.disability.employee&&(t.disability.employee.salary>0&&(t.disability.dayLiquidationBasis=t.disability.employee.salary/30),t.disability.dayLiquidationBasis>0&&(t.disability.hourLiquidationBasis=t.disability.dayLiquidationBasis/8),t.disability.dayLiquidationBasisFormat=p("currency")(t.disability.dayLiquidationBasis,"$ ",2),t.disability.hourLiquidationBasisFormat=p("currency")(t.disability.hourLiquidationBasis,"$ ",2))});var I=function(){var i=0;if(0==t.disability.id){if(t.disability.amountPaid=0,null!=t.disability.cause&&null!=t.disability.employee&&""!=t.disability.employee.salary&&""!=t.disability.numberDays)if("AL"==t.disability.cause.value||"AT"==t.disability.cause.value)parseInt(t.disability.numberDays)>1&&(i=parseFloat(t.disability.employee.salary)/30*(parseInt(t.disability.numberDays)-1),t.disability.amountPaid=Math.round(100*i)/100);else if("EG"==t.disability.cause.value)if(null!=t.disability.type&&"Inicial"==t.disability.type.item){if(parseInt(t.disability.numberDays)>2){var a=parseFloat(t.disability.employee.salary)/30*.6667;a=a<parseFloat(g)?parseFloat(g):a,i=Math.round(a*(parseInt(t.disability.numberDays)-2)),t.disability.amountPaid=i}}else null!=t.disability.type&&"Prorroga"==t.disability.type.item&&(i=parseFloat(t.disability.employee.salary)/30*parseInt(t.disability.numberDays),t.disability.amountPaid=Math.round(100*i)/100);else if("LM"==t.disability.cause.value||"LP"==t.disability.cause.value)i=parseFloat(t.disability.employee.salary)/30*parseInt(t.disability.numberDays),t.disability.amountPaid=Math.round(100*i)/100;else if("EL"==t.disability.cause.value){if(parseInt(t.disability.numberDays)>2){var a=parseFloat(t.disability.employee.salary)/30*.6667;a=a<parseFloat(g)?parseFloat(g):a,i=Math.round(a*(parseInt(t.disability.numberDays)-2)),t.disability.amountPaid=i}}else"ELC"==t.disability.cause.value&&parseInt(t.disability.numberDays)>1&&(i=parseFloat(t.disability.employee.salary)/30*(parseInt(t.disability.numberDays)-1),t.disability.amountPaid=Math.round(100*i)/100);var e=0;null!=t.disability.category&&"Incapacidad"==t.disability.category.value&&null!=t.disability.employee&&""!=t.disability.employee.salary&&""!=t.disability.numberDays&&(null===t.disability.cause||"EG"!=t.disability.cause.value&&"LM"!=t.disability.cause.value||null!=t.disability.type&&"Inicial"==t.disability.type.item&&(e=parseInt(t.disability.numberDays)>=2?parseFloat(t.disability.employee.salary)/30*2:parseFloat(t.disability.employee.salary)/30*parseInt(t.disability.numberDays))),Math.round(100*e)/100>0&&(t.disability.directCostTotal=Math.round(100*e)/100)}},L=function(){var i=t.disability.category?t.disability.category.value:null,a=t.disability.type?t.disability.type.value:null,e=t.disability.cause?t.disability.cause.value:null,n=t.disability.accidentType?t.disability.accidentType.value:null;t.disability.chargedDays=0,"Incapacidad"==i&&"Inicial"==a?"AT"!=e&&"AL"!=e||"M"!=n||(t.disability.chargedDays=w):"Incapacidad"==i&&"Sin Incapacidad"==a&&("AT"!=e&&"AL"!=e||"M"!=n||(t.disability.chargedDays=w))};t.onSelectCategory=function(){null!=t.disability.category&&"Incapacidad"!=t.disability.category.value?(t.disability.type=null,t.disability.cause=null,t.causes=t.causeListAdmin):(t.disability.isHour=!1,t.causes=t.causeList),t.onChangeIsHour(),I(),L()},t.onSelectType=function(){t.disability.accidentType=null,t.onChangeStartDate(),D(),I(),L()},t.onSelectCause=function(){t.disability.accidentType=null,D(),I(),L()},t.onSelectAccidentType=function(){L()},t.onChangeIsHour=function(){t.disability.isHour?t.disability.numberDays=0:(T(),I())},t.$watch("disability.numberDays",function(){I()}),t.$watch("disability.indirectCost",function(){if(null!=t.disability.indirectCost&&t.disability.indirectCost.length>0){var i=0;angular.forEach(t.disability.indirectCost,function(a,t){null!=a.concept&&""!=a.amount&&angular.isNumber(parseFloat(a.amount))&&(i+=parseFloat(a.amount))}),t.disability.indirectCostTotal=i}else t.disability.indirectCostTotal=0},!0),t.master=t.disability,t.form={submit:function(i){var a=null;if(i.$invalid){var e=null,a=null;for(e in i)"$"!=e[0]&&(null!==a||i[e].$valid||(a=i[e].$name),i[e].$pristine&&(i[e].$dirty=!0));return h.info(t.disability),angular.element(".ng-invalid[name="+a+"]").focus(),void d.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}O()},reset:function(i){}};var O=function(){var i=new moment(t.disability.endDate),a=new moment(t.disability.startDate);if(t.disability.type&&"Sin Incapacidad"!=t.disability.type.value&&i<a)return void d.swal("El formulario contiene errores!","La fecha final debe ser mayor a la fecha inicial.","error");var e={},n=JSON.stringify(t.disability);return e.data=Base64.encode(n),r({method:"POST",url:"api/customer-absenteeism-disability-staging/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(i){o(function(){d.swal("Registro","La información ha sido guardada satisfactoriamente","success"),t.onCloseModal()})})["catch"](function(i){l.error(i),d.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};t.onAddDisabilityDiagnostic=function(){var a=m.open({templateUrl:i.app.views.urlRoot+"modules/customer/occupational/absenteeism/disability/customer_absenteeism_disability_diagnostic_modal.htm",placement:"left",windowTopClass:"top-modal",size:"lg",backdrop:!0,controller:"ModalInstanceSideDisabilityDiagnosticListCtrl",scope:t});a.result.then(function(i){var a=p("filter")(t.diagnostics,{id:i.id});0==a.length&&t.diagnostics.push(i),t.disability.diagnostic=i},function(){})},t.onAddDisabilityEmployeeList=function(){var a=m.open({templateUrl:i.app.views.urlRoot+"modules/customer/occupational/absenteeism/disability/customer_absenteeism_disability_employee_list_modal.htm",placement:"left",windowTopClass:"top-modal",size:"lg",backdrop:!0,controller:"ModalInstanceSideDisabilityEmployeeListCtrl",scope:t});a.result.then(function(i){var a=p("filter")(t.employees,{id:i.id});0==a.length&&t.employees.push(i),t.disability.employee=i},function(){})}}]),app.controller("ModalInstanceSideCustomerAbsenteeismDisabilityParentStagingCtrl",["$rootScope","$stateParams","$scope","dataItem","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile","bsLoadingOverlayService",function(i,a,t,e,n,s,l,o,d,r,u,c,y,p,m,b){t.title="AUSENTISMOS INICIALES",t.loadingOverlayTemplateUrl=i.app.themeRootUrl+"templates/loading-overlay-element-template.htm";var f=function(){t.disability={id:e.id,category:null,type:null,cause:null,workplace:null,accidentType:null,diagnostic:null,employee:null,dayLiquidationBasis:0,dayLiquidationBasisFormat:"",hourLiquidationBasis:0,hourLiquidationBasisFormat:"",startDate:new Date,endDate:new Date,numberDays:0,chargedDays:0,charged:!1,amountPaid:0,indirectCost:[],directCostTotal:0,indirectCostTotal:0,disabilityParent:null}};f(),t.onLoadRecord=function(){if(0!=t.disability.id){var i={id:t.disability.id};d({method:"GET",url:"api/customer-absenteeism-disability-staging/get",params:i})["catch"](function(i,a){}).then(function(i){l(function(){t.disability=i.data.result,t.reloadData()})})["finally"](function(){})}},t.onLoadRecord(),t.onCloseModal=function(){n.close(null)},t.onCancel=function(){n.dismiss("cancel")},t.dtOptionsCommonDataTableList=p.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(i){return i.customerId=a.customerId,i.typeValue="Inicial",i.causeValue=t.disability.cause?t.disability.cause.value:"",i.customerEmployeeId=t.disability.employee?t.disability.employee.id:0,JSON.stringify(i)},url:"api/customer-absenteeism-disability-related",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){h()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(i,a,e){m(angular.element(i).contents())(t)}),t.dtColumnsCommonDataTableList=[y.newColumn(null).withTitle("Acciones").withOption("width",80).notSortable().renderWith(function(i,a,t,e){var n="",s='<a class="btn btn-success btn-xs editRow lnk" href="#" uib-tooltip="Adicionar item"  data-id="'+i.id+'" data-cause="'+i.causeItem+'" data-date="'+i.startDateFormat+'" >   <i class="fa fa-plus-square"></i></a> ';return n+=s}),y.newColumn("causeItem").withTitle("Causa Incapacidad").withOption("width",200).withOption("defaultContent",""),y.newColumn("startDateFormat").withTitle("F Inicial").withOption("width",200).withOption("defaultContent",""),y.newColumn("endDateFormat").withTitle("F Final").withOption("width",180).withOption("defaultContent","")];var h=function(){angular.element("#dtCommonDataTableList a.editRow").on("click",function(){var i=angular.element(this).data("id"),a=angular.element(this).data("cause"),e=angular.element(this).data("date");t.disability.disabilityParent={id:i,name:e+" | "+a},w()})},w=function(){var i={},a=JSON.stringify(t.disability);return i.data=Base64.encode(a),d({method:"POST",url:"api/customer-absenteeism-disability-staging/update",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(i){l(function(){o.swal("Registro","La información ha sido guardada satisfactoriamente","success"),n.close(null)})})["catch"](function(i){s.error(i),o.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};t.dtInstanceCommonDataTableListCallback=function(i){t.dtInstanceCommonDataTableList=i},t.reloadData=function(){t.dtInstanceCommonDataTableList.reloadData(null,!1)}}]);
"use strict";app.controller("customerVrEmployeeRegisterEditCtrl",["$scope","$stateParams","$log","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$document","$filter","$aside","ListService","bsLoadingOverlayService","$q","DTColumnBuilder","DTOptionsBuilder","$compile","customerVrEmployeeService","moment",function(e,t,n,o,i,a,l,r,s,c,d,u,m,p,f,y,g,v,h,w){var C=null;e.isView="view"==e.$parent.editMode,e.flowConfig={target:"/api/customer-employee/upload",singleFile:!0},h.setId(e.$parent.currentId||0),e.dynamicPopover={templateUrl:"myPopoverTemplate.html"};var I=function(){e.entity={id:e.$parent.currentId||0,customerId:t.customerId,isActive:1,hasConfig:!1,employee:{id:0,customerId:null,documentType:null,documentNumber:"",firstName:"",lastName:"",gender:null,logo:"",entity:{id:null}}},C&&C.$setPristine(!0)};I(),e.uploader=new Flow,""==e.entity.employee.logo&&(e.noImage=!0),e.onLoadRecord=function(){if(0!=e.entity.id){var t={id:e.entity.id};r({method:"GET",url:"api/customer-vr-employee/get",params:t})["catch"](function(e,t){}).then(function(t){l(function(){e.entity=t.data.result,h.setEntity(e.entity),L({id:e.entity.employee.id,entity:e.entity.employee})})})["finally"](function(){l(function(){e.loading=!1})})}else e.loading=!1},e.onLoadRecord(),e.$on("reloadConfigVr",function(t,n){e.entity.hasConfig=!0,e.experienceList=n,e.saveForm=!0}),e.form={submit:function(e){C=e;var t=null;if(e.$invalid){var n=null,t=null;for(n in e)"$"!=n[0]&&(null!==t||e[n].$valid||(t=e[n].$name),e[n].$pristine&&(e[n].$dirty=!0));return angular.element(".ng-invalid[name="+t+"]").focus(),void s.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}b()},reset:function(e){}};var b=function(){var t={},n=JSON.stringify(e.entity);return t.data=Base64.encode(n),r({method:"POST",url:"api/customer-vr-employee/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){l(function(){s.swal("Registro","La información ha sido guardada satisfactoriamente","success"),e.uploader.flow.opts.query.id=t.data.result.employee.entity.id,e.uploader.flow.resume(),e.entity=t.data.result,h.setId(e.entity.id),h.setEntity(e.entity),null!=e.entity.employee.logo&&null!=e.entity.employee.logo.path?e.noImage=!1:e.noImage=!0})})["catch"](function(e){s.swal("Error de guardado",e.data.message,"error")})["finally"](function(){l(function(){if(e.uploader.flow.files.length){var t=T(e.uploader.flow.files[0].file);T(t)}},1e3)})},T=function(t){var n=new FileReader;n.onloadend=function(){e.entity.employee.logo={path:n.result},e.noImage=!1},t&&n.readAsDataURL(t)};e.onSearchEmployee=function(){var t=u.open({templateUrl:a.app.views.urlRoot+"modules/customer/common/modals/employee_list_modal.htm",placement:"right",windowTopClass:"top-modal",size:"lg",backdrop:!0,controller:"ModalInstanceSideVrEmployeeListCtrl",scope:e});t.result.then(function(t){e.uploader.flow.cancel(),L(t)})};var L=function(t){var n={id:t.id,documentType:t.entity.documentType,documentNumber:t.entity.documentNumber,firstName:t.entity.firstName,lastName:t.entity.lastName,gender:t.entity.gender,logo:t.entity.logo,entity:{id:t.entity.entity?t.entity.entity.id:t.entity.id}};e.entity.employee=n,null!=e.entity.employee.logo&&null!=e.entity.employee.logo.path?e.noImage=!1:e.noImage=!0};e.onCancel=function(){c.scrollTop(40,2e3),null!=e.$parent&&e.$parent.navToSection("list","list")},e.removeImage=function(){e.noImage=!0,e.entity.removeLogo=!0,e.entity.employee.logo=null},e.openCamera=function(){var t=u.open({templateUrl:"ModalContentCamera.html",placement:"right",windowTopClass:"top-modal",size:"md",backdrop:"static",controller:"ModalInstanceCameraCtrl"});t.result.then(function(t){t&&fetch(t).then(function(e){return e.blob()}).then(function(t){t.name="photo.png",e.uploader.flow.addFile(t)})})}}]),app.controller("ModalInstanceCameraCtrl",["$scope","$uibModalInstance",function(e,t){function n(e){video.srcObject=e,i=e}function o(e){console.log("Error: ",e)}e.image=null;var i,a=function(){angular.element("#video"),angular.element("#canvas");navigator.mediaDevices.getUserMedia({video:!0}).then(n)["catch"](o)};e.take=function(){canvas.width=video.videoWidth,canvas.height=video.videoHeight,canvas.getContext("2d").drawImage(video,0,0),e.image=canvas.toDataURL("image/png"),l()},e.takeNew=function(){e.image=null,a()},e.onDissmiss=function(){t.close(e.image),l()},e.onCancel=function(){t.dismiss("cancel"),l()};var l=function(){i.getTracks().forEach(function(e){e.stop()})};a()}]),app.controller("ModalInstanceSideVrEmployeeListCtrl",["$rootScope","$stateParams","$scope","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile","ListService","$aside",function(e,t,n,o,i,a,l,r,s,c,d,u,m,p,f,y){function g(){var e=[{name:"criteria_operators",value:null},{name:"criteria_conditions",value:null}];f.getDataList(e).then(function(e){n.criteria=e.data.data.criteriaOperatorList,n.conditions=e.data.data.criteriaConditionList},function(e){n.status="Unable to load customer data: "+e.message})}n.canCreate=!0,n.canFilter=!0,n.employee={id:0},n.onCloseModal=function(){o.close(n.employee)},n.onCancel=function(){o.dismiss("cancel")},n.audit={fields:[],filters:[]},n.audit.fields=[{alias:"Tipo de Identificación",name:"employeeDocumentType"},{alias:"Número de Identificación",name:"documentNumber"},{alias:"Nombre",name:"firstName"},{alias:"Apellidos",name:"lastName"}],g(),n.addFilter=function(){null==n.audit.filters&&(n.audit.filters=[]),n.audit.filters.push({id:0,field:null,criteria:n.criteria.length>0?n.criteria[1]:null,condition:n.conditions.length>0?n.conditions[0]:null,value:""})},n.onFilter=function(){n.reloadData()},n.removeFilter=function(e){n.audit.filters.splice(e,1)},n.onCleanFilter=function(){n.audit.filters=[],n.reloadData()},n.onLoadRecord=function(){if(0!=n.employee.id){var e={id:n.employee.id};r({method:"GET",url:"api/customer-employee",params:e})["catch"](function(e,t){if(403==t){var n=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";l.swal("No Autorizado","No estas autorizado para ver esta información.","error"),a(function(){$state.go(n)})}else 404==t?l.swal("Información no disponible","Diagnóstico no encontrado","error"):l.swal("Error","Se ha presentado un error al intentar acceder a la información del proceso","error")}).then(function(e){a(function(){n.employee=e.data.result})})["finally"](function(){a(function(){n.onCloseModal()},400)})}else n.loading=!1},n.dtInstanceModalEmployeeList={},n.dtOptionsModalEmployeeList=m.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerId=t.customerId,angular.isDefined(n.audit)&&angular.isDefined(n.audit.filters)&&(e.filter={filters:n.audit.filters.filter(function(e){return null!=e&&null!=e.field&&null!=e.criteria}).map(function(e,t,n){return{field:e.field.name,operator:e.criteria.value,value:e.value,condition:e.condition.value}})}),JSON.stringify(e)},url:"api/customer-employee-modal-basic-2",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){v()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,t,o){p(angular.element(e).contents())(n)}),n.dtColumnsModalEmployeeList=[u.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,t,n,o){var i="",a="",l='<a class="btn btn-success btn-xs editRow lnk" href="#" uib-tooltip="Adicionar empleado" tooltip-placement="right"  data-id="'+e.id+'"'+a+' >   <i class="fa fa-plus-square"></i></a> ';return i+=l}),u.newColumn("employeeDocumentType").withTitle("Tipo Identificación").withOption("width",200),u.newColumn("documentNumber").withTitle("Número Identificación").withOption("width",200),u.newColumn("firstName").withTitle("Nombre").withOption("width",200),u.newColumn("lastName").withTitle("Apellidos").withOption("width",200)];var v=function(){angular.element("#dtModalEmployeeList a.editRow").on("click",function(){var e=angular.element(this).data("id");n.editModalEmployeeList(e)})};n.reloadData=function(){n.dtInstanceModalEmployeeList.reloadData()},n.viewModalEmployeeList=function(e){n.employee.id=e,n.isView=!0,n.onLoadRecord()},n.editModalEmployeeList=function(e){n.employee.id=e,n.isView=!1,n.onLoadRecord()},n.onCreate=function(){var t=y.open({templateUrl:e.app.views.urlRoot+"modules/customer/common/modals/employee_create_modal.htm",placement:"right",windowTopClass:"top-modal",size:"lg",backdrop:!0,controller:"ModalInstanceSideEmployeeCreateCtrl",scope:n});t.result.then(function(e){n.reloadData()})}}]),app.controller("ModalInstanceSideEmployeeCreateCtrl",["$scope","$stateParams","$log","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$document","$uibModalInstance",function(e,t,n,o,i,a,l,r,s,c,d){var u=null;e.genders=a.parameters("gender"),e.documentTypes=a.parameters("employee_document_type");var m=function(){e.employee={id:0,customerId:t.customerId,isActive:!1,contractType:null,occupation:"",job:null,workPlace:null,salary:0,isAuthorized:!1,entity:{id:0,documentType:null,documentNumber:"",expeditionPlace:"",expeditionDate:"",firstName:"",lastName:"",birthDate:"",gender:null,profession:null,eps:null,afp:null,arl:null,country:null,state:null,city:null,rh:"",riskLevel:0,neighborhood:"",observation:"",logo:"",details:[],isActive:!1,age:null},validityList:[]},u&&u.$setPristine(!0)};m(),e.form={submit:function(e){u=e;var t=null;if(e.$invalid){var n=null,t=null;for(n in e)"$"!=n[0]&&(null!==t||e[n].$valid||(t=e[n].$name),e[n].$pristine&&(e[n].$dirty=!0));return angular.element(".ng-invalid[name="+t+"]").focus(),void s.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}p()},reset:function(e){}};var p=function(){var t={},n=JSON.stringify(e.employee);return t.data=Base64.encode(n),r({method:"POST",url:"api/customer-employee/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){l(function(){s.swal("Registro","La información ha sido guardada satisfactoriamente","success"),d.close(e.employee)})})["catch"](function(e){s.swal("Error de guardado",e.data.message,"error")})};e.onCancel=function(){d.dismiss("cancel")}}]);
"use strict";app.controller("customerVrEmployeeExperienceConfigCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$aside","customerVrEmployeeService","ListService",function(e,t,i,o,n,a,r,c,s,p,l,u,m,d,v,f){function $(){var i=[{name:"customer_vr_employee_list",criteria:{customerId:t.customerId,vrEmployeeId:x}}];f.getDataList(i).then(function(t){e.experienceList=t.data.data.experienceList,e.applicationOptions=t.data.data.applicationOptions},function(t){e.status="Unable to load customer data: "+t.message})}var L=null;e.isView="view"==e.$parent.editMode;var x=v.getId();e.experienceList=[],e.applicationOptions=[];var g=function(){e.entity={vrEmployeeId:x,experienceList:[]},L&&L.$setPristine(!0)};g(),$(),e.form={submit:function(e){y()}};var y=function(){e.experienceList.forEach(function(e){e.scenes.map(function(t){e.isActive&&e.isActive===!0?t.application={value:"SI",item:"Sí"}:t.application={value:"NO",item:"No"}})}),e.$emit("reloadConfigVr",e.experienceList)}}]);
"use strict";app.controller("customerVrEmployeeRegisterExperienceCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$aside","customerVrEmployeeService","ListService",function(e,t,r,o,n,i,a,s,l,c,u,p,d,m,v,f){function y(){var r=[{name:"customer_vr_employee_list_options",criteria:{customerId:t.customerId,vrEmployeeId:g}}];f.getDataList(r).then(function(t){e.applicationOptions=t.data.data.applicationOptions},function(t){e.status="Unable to load customer data: "+t.message})}e.isView="view"==e.$parent.editMode;var g=v.getId();e.applicationOptions=[],e.saveForm=!!e.saveForm&&e.saveForm;var w=null,S=function(){e.entity={vrEmployeeId:g,experienceList:[]},w&&w.$setPristine(!0)};S(),y(),e.form={submit:function(e){w=e;var t=null;if(e.$invalid){var r=null,t=null;for(r in e)"$"!=r[0]&&(null!==t||e[r].$valid||(t=e[r].$name),e[r].$pristine&&(e[r].$dirty=!0));return angular.element(".ng-invalid[name="+t+"]").focus(),void d.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}E()},reset:function(e){}},e.updateForm=function(){e.saveForm=!0};var E=function(){e.entity.experienceList=e.experienceList;var t={},r=JSON.stringify(e.entity);return t.data=Base64.encode(r),e.saveForm?p({method:"POST",url:"api/customer-vr-employee-experience/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){u(function(){null!=e.$parent&&e.$parent.navToSection("metrics",e.$parent.editMode)})})["catch"](function(e){d.swal("Error de guardado",e.data.message,"error")}):void(null!=e.$parent&&e.$parent.navToSection("metrics",e.$parent.editMode))}}]);
"use strict";app.controller("customerVrEmployeeRegisterExperienceMetricsTabsCtrl",["$scope","$rootScope","$timeout","$filter",function(t,e,a,i){t.loading=!1,t.tabname="tab1",t.activeTab=1,t.loadedOther=["tab1"],t.getView=function(e){var a=i("filter")(t.views,{name:e});return a[0]},t.switchTab=function(e){a(function(){t.tabname=e,t.loadedOther.push(e)})},t.switchSubTab=function(e){a(function(){t.subtab=e})},t.$on("resumeTab",function(e){t.activeTab=2,t.switchTab("tab2")})}]);
"use strict";app.controller("customerVrEmployeeRegisterExperienceMetricsRegisterCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$aside","customerVrEmployeeService","ListService","ChartService",function(e,t,i,r,n,o,a,s,c,l,p,u,m,d,y,g,f){function D(){if(e.entity.registrationDate){var t=[{name:"customer_vr_employee_experience_list",criteria:{cvreid:e.entity.id,registrationDate:e.entity.registrationDate}},{name:"customer_vr_employee_experience_stats",criteria:{cvreid:e.entity.id,registrationDate:e.entity.registrationDate}}];g.getDataList(t).then(function(t){e.employeeExperienceList=t.data.data.employeeExperienceList,e.experienceStats=t.data.data.experienceStats},function(t){e.status="Unable to load customer data: "+t.message})}}function v(){var t=[{name:"chart_pie_options",criteria:null}];f.getDataChart(t).then(function(t){e.chart.pie.options=angular.copy(t.data.data.chartPieOptions),e.chart.pie.options.legend.position="bottom"})}var h=y.getEntity();e.employeeExperienceList=[],e.isView="view"==e.$parent.editMode,e.experienceStats={percentage:0,answers:0},e.goToFormVrEmployee=!0,e.disabledDate=!1,e.entity={},e.maxDate=new Date,e.datePickerConfig={culture:"es-CO",format:"dd/MM/yyyy"},e.options={unit:"%",readOnly:!0,displayPrevious:!0,barCap:25,trackWidth:20,barWidth:20,trackColor:"rgba(92,184,92,.1)",barColor:"#5BC01E",textColor:"#000"},e.chart={pie:{options:null}},v();var $=function(){e.entity=h,e.entity.registrationDate&&e.entity.registrationDate.date&&(e.entity.registrationDate=new Date(e.entity.registrationDate.date))};if(e.$watch("entity.registrationDate",function(){e.entity.registrationDate&&D()}),h)h.registrationDate&&(e.disabledDate=!0),$(),D();else{e.goToFormVrEmployee=!1,h={id:e.$parent.currentId||0,customerId:t.customerId,isActive:1,employee:{id:0,customerId:null,documentType:null,documentNumber:"",firstName:"",lastName:"",gender:null,logo:"",entity:{id:null}}};var E={id:e.$parent.currentId};u({method:"GET",url:"api/customer-vr-employee/get",params:E})["catch"](function(e,t){}).then(function(e){p(function(){h=e.data.result,y.setId(h.id),y.setEntity(h),$(),D()})})["finally"](function(){p(function(){e.loading=!1})})}e.onAnswerQuestions=function(t){t.employeeExperienceList=e.employeeExperienceList,t.registrationDate=e.entity.registrationDate,y.setEntityExperience(t);var i=d.open({templateUrl:l.app.views.urlRoot+"modules/customer/vr-employee/register/experience-metrics/register/customer_vr_employee_register_experience_metrics_register_modal.htm",placement:"right",windowTopClass:"top-modal",size:"lg",backdrop:"static",controller:"customerVrEmployeeRegisterExperienceMetricsRegisterModalCtrl",scope:e});i.result.then(function(){e.isView||D()})},e.onBack=function(t){null!=e.$parent&&e.$parent.navToSection("form",e.$parent.editMode,e.entity.id)},e.onContinue=function(t){e.$emit("resumeTab")},e.onHome=function(t){null!=e.$parent&&e.$parent.navToSection("list","list")}}]);
"use strict";app.controller("customerVrEmployeeRegisterExperienceMetricsRegisterModalCtrl",["$rootScope","$stateParams","$scope","$log","$timeout","$uibModalInstance","SweetAlert","$http","toaster","$filter","$compile","$aside","customerVrEmployeeService","ListService",function(e,n,t,a,r,i,o,s,c,l,d,u,p,m){function f(){var e=[{name:"customer_vr_employee_list_options"},{name:"customer_vr_employee_observation_options"}];m.getDataList(e).then(function(e){t.applicationOptions=e.data.data.applicationOptions,t.observationTypes=e.data.data.observationOptions},function(e){t.status="Unable to load customer data: "+e.message})}t.data=p.getEntityExperience();var v=p.getId();t.experience=t.data.experience,t.nextEnable=!1,t.finishEnable=!1,t.reloadView=!0,t.experienceListLength=t.data.employeeExperienceList.length,t.currentIndex=t.data.index,t.isOpen=!0,t.isOpenObs=!1,t.applicationOptions=[],t.observationTypes=[];var g=function(){t.entity={id:t.data.id,registrationDate:t.data.registrationDate,customerVrEmployeeId:v,experienceCode:t.data.experienceValue,questionList:[],observationType:null,observationValue:null}};g(),f();var x=function(){var e={},n=JSON.stringify(t.entity);e.data=Base64.encode(n),s({method:"POST",url:"api/customer-vr-employee-experience-answer/get-question",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){r(function(){t.entity=e.data.result,t.entity.answers&&(t.data.answers=t.entity.answers),y()})})["catch"](function(e){o.swal("Error","Ocurrió un problema cargar la información.","error")})};x();var y=function(){return t.currentIndex<t.experienceListLength?(t.nextEnable=!0,void(t.finishEnable=!1)):t.currentIndex==t.experienceListLength?(t.finishEnable=!0,void(t.nextEnable=!1)):(t.nextEnable=!1,void(t.finishEnable=!1))};t.form={submit:function(e){var n=null;if(e.$invalid){var t=null,n=null;for(t in e)"$"!=t[0]&&(null!==n||e[t].$valid||(n=e[t].$name),e[t].$pristine&&(e[t].$dirty=!0));return angular.element(".ng-invalid[name="+n+"]").focus(),void o.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}w()},reset:function(e){}};var w=function(){var e={},n=JSON.stringify(t.entity);return e.data=Base64.encode(n),s({method:"POST",url:"api/customer-vr-employee-experience-answer/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){r(function(){o.swal("Registro","La información ha sido guardada satisfactoriamente","success"),t.reloadView?x():t.reloadView=!0})})["catch"](function(e){a.error(e);var n=e.data&&e.data.message?e.data.message:"Error guardando el registro. Por favor verifique los datos ingresados!";o.swal("Error de guardado",n,"error")})};t.onNext=function(){var e=t.data.registrationDate,n=t.data.employeeExperienceList;t.data=t.data.employeeExperienceList[t.currentIndex],t.data.registrationDate=e,t.data.employeeExperienceList=n,t.experience=t.data.experience,t.currentIndex=t.data.index,t.reloadView=!1,t.form.submit(angular.element("form")),g(),x()},t.onCancel=function(){t.isView?i.close(1):o.swal({title:"Está seguro?",text:"Esta acción no guardara ningún cambio, si continúa puede perder información que aún no se ha almacenado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Sí, cerrar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(e){e&&i.close(1)})},t.onFinish=function(){i.close(1)}}]);
"use strict";app.controller("customerVrEmployeeRegisterExperienceMetricsSummaryCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$document","$filter","$aside","customerVrEmployeeService","$uibModal",function(e,t,n,o,i,a,r,l,s,c,u,d,m,p,f,w,h,v){var g=h.getId();e.allData=h.getEntity(),e.dtInstanceVrEmployeeREMS={},e.dtOptionsVrEmployeeREMS=o.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerId=t.customerId,e.customerVrEmployeeId=g,JSON.stringify(e)},url:"api/customer-vr-employee-scene-answer/summary",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,n,o){r(angular.element(t).contents())(e)}),e.dtColumnsVrEmployeeREMS=[i.newColumn("experience").withTitle("Experiencia").withOption("width",220).withOption("defaultContent",""),i.newColumn("scene").withTitle("Escena").withOption("width",220).withOption("defaultContent",""),i.newColumn("question").withTitle("Indicador").withOption("width",220).withOption("defaultContent",""),i.newColumn(null).withTitle("Valoración").withOption("width",120).renderWith(function(e,t,n,o){var i="";"SI"==e.answerVal?i='<i class=" text-success fa fa-2x fa-check-circle-o" aria-hidden="true"></i>':"NO"==e.answerVal?i='<i class=" text-danger fa fa-2x fa-ban" aria-hidden="true"></i>':"NA"==e.answerVal?i='<i class=" text-inverse fa fa-2x fa-minus-circle" aria-hidden="true"></i>':"NU"==e.answerVal?i='<i class=" text-warning fa fa-2x fa-exclamation-circle" aria-hidden="true"></i>':(i='<i class=" text-warning fa fa-2x fa-question-circle" aria-hidden="true"></i>',e.answer="SELECCIONE");var a='<span class="vertical-align-sub">'+i+" </span>"+e.answer;return a})],e.dtInstanceVrEmployeeREMSCallback=function(t){e.dtInstanceVrEmployeeREMS=t},e.dtInstanceVrEmployeeRegisterREMSO={},e.dtOptionsVrEmployeeRegisterREMSO=o.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerId=t.customerId,e.customerVrEmployeeId=g,JSON.stringify(e)},url:"api/customer-vr-employee-experience-answer/observations",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[1,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){y()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,n,o){r(angular.element(t).contents())(e)}),e.dtColumnsVrEmployeeRegisterREMSO=[i.newColumn(null).withTitle("Acciones").withOption("width",40).notSortable().renderWith(function(e,t,n,o){var i="",a='<a class="btn btn-warning btn-xs planRow lnk" href="#" uib-tooltip="Agregar Plan Mejoramiento" data-experience='+e.experience+" data-id="+e.id+" data-obstype="+e.observationType+' >   <i class="fa fa-plus-square"></i></a> ';return i+=a}),i.newColumn("experience").withTitle("Experiencia").withOption("width",200).withOption("defaultContent",""),i.newColumn("observationType").withTitle("Tipo de Observación").withOption("width",200).withOption("defaultContent",""),i.newColumn("observation").withTitle("Observación").withOption("width",200).withOption("defaultContent","")];var y=function(){$("#dtVrEmployeeRegisterREMSO a.planRow").on("click",function(){var t=$(this).data("id"),n=$(this).data("experience"),o=$(this).data("obstype"),i={id:t,experience:n,observationType:o};e.onAddPlan(i)})};e.dtInstanceVrEmployeeRegisterREMSOCallback=function(t){e.dtInstanceVrEmployeeRegisterREMSO=t},e.onFinish=function(){var t=w.open({templateUrl:c.app.views.urlRoot+"modules/customer/vr-employee/register/experience-metrics/summary/experience_evaluation_modal.htm",placement:"right",windowTopClass:"top-modal",size:"md",backdrop:!0,controller:"ModalInstanceSideEvaluateExperience",scope:e});t.result.then(function(e){})},e.onAddPlan=function(t){var n=w.open({templateUrl:c.app.views.urlRoot+"modules/customer/common/modals/customer_improvement_plan_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideVrEmployeeSummaryImprovementPlanCtrl",scope:e,resolve:{entity:function(){return t}}});n.result.then(function(){},function(){})}}]),app.controller("ModalInstanceSideEvaluateExperience",["$rootScope","$stateParams","$scope","$log","$timeout","$uibModalInstance","SweetAlert","$http","toaster","$filter","$compile","$aside","customerVrEmployeeService","ListService","FileUploader",function(e,t,n,o,i,a,r,l,s,c,u,d,m,p,f){function w(){var e=[{name:"customer_vr_employee_evaluation_options"}];p.getDataList(e).then(function(e){n.evaluationOptions=e.data.data.evaluationOptions},function(e){n.status="Unable to load customer data: "+e.message})}function h(e,t){for(var n=e.split(","),o=n[0].match(/:(.*?);/)[1],i=atob(n[1]),a=i.length,r=new Uint8Array(a);a--;)r[a]=i.charCodeAt(a);return new File([r],t,{type:o})}function v(){P=!0,S.push([])}function g(e){if(e.preventDefault(),P){var t=T.getContext("2d");t.lineJoin=t.lineCap="round",t.lineWidth=5,t.strokeStyle="#000";var n=0,o=0;void 0==e.changedTouches?(n=e.layerX,o=e.layerY):(n=e.changedTouches[0].pageX-x,o=e.changedTouches[0].pageY-D),S[S.length-1].push({x:n,y:o}),t.beginPath(),S.forEach(function(e){t.moveTo(e[0].x,e[0].y),e.forEach(function(e,n){t.lineTo(e.x,e.y)})}),t.stroke()}}function y(){P=!1}var O=m.getId();n.evaluationOptions=[];var C=0,E=function(){n.entity={id:null,observationType:null,observationValue:null,customerVrEmployeeId:O}};E(),w(),n.form={submit:function(e){var t=null;if(e.$invalid){var n=null,t=null;for(n in e)"$"!=n[0]&&(null!==t||e[n].$valid||(t=e[n].$name),e[n].$pristine&&(e[n].$dirty=!0));return angular.element(".ng-invalid[name="+t+"]").focus(),void r.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}if(S.length){var o=h(T.toDataURL("image/png"),"firm.png");R.addToQueue([o])}b()},reset:function(e){}};var b=function(){if(0==S.length)return void r.swal("El formulario contiene errores!","La firma es requerida.","error");var e={},t=JSON.stringify(n.entity);return e.data=Base64.encode(t),l({method:"POST",url:"api/customer-vr-employee-experience-evaluation/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){i(function(){n.entity=e.data.result,R.queue.length>0&&(C=e.data.result.id,R.uploadAll())})})["catch"](function(e){o.error(e),r.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})};n.onCloseModal=function(){a.close(1)};var T,I,S=[],x=0,D=0,P=!1;i(function(){e.$apply(function(){T=document.querySelector("#pizarra"),I=T.getBoundingClientRect(),x=I.x,D=I.y,T.addEventListener("mousedown",v,!1),T.addEventListener("mousemove",g,!1),T.addEventListener("mouseup",y,!1),T.addEventListener("touchstart",v,!1),T.addEventListener("touchmove",g,!1)})},1e3),n.onClear=function(){S=[];var e=T.getContext("2d");e.clearRect(0,0,T.width,T.height)};var R=n.uploaderResource=new f({url:"api/customer-vr-employee-experience-evaluation/upload",formData:[]});R.filters.push({name:"customFilter",fn:function(e,t){return this.queue.length<10}}),R.onWhenAddingFileFailed=function(e,t,n){console.info("onWhenAddingFileFailed",e,t,n)},R.onAfterAddingFile=function(e){console.info("onAfterAddingFile",e)},R.onAfterAddingAll=function(e){console.info("onAfterAddingAll",e)},R.onBeforeUploadItem=function(e){r.swal("Procesando","Estamos generando el certificado, espera un momento.","info");var t={id:C};e.formData.push(t)},R.onProgressItem=function(e,t){console.info("onProgressItem",e,t)},R.onProgressAll=function(e){console.info("onProgressAll",e)},R.onSuccessItem=function(e,t,n,o){console.info("onSuccessItem",e,t,n,o)},R.onErrorItem=function(e,t,n,o){console.info("onErrorItem",e,t,n,o)},R.onCancelItem=function(e,t,n,o){console.info("onCancelItem",e,t,n,o)},R.onCompleteItem=function(e,t,n,o){console.info("onCompleteItem",e,t,n,o)},R.onCompleteAll=function(){r.swal({title:"Registro",text:"La información ha sido guardada satisfactoriamente",type:"success",showCancelButton:!1,confirmButtonText:"OK"},function(){null!=n.$parent&&n.$parent.navToSection("list","list")})}}]),app.controller("ModalInstanceSideVrEmployeeSummaryImprovementPlanCtrl",["$stateParams","$rootScope","$scope","$uibModalInstance","entity","$log","$timeout","SweetAlert","$filter","FileUploader","$http","DTOptionsBuilder","DTColumnBuilder","$compile",function(e,t,n,o,i,a,r,l,s,c,u,d,m,p){n.maxDate=new Date,n.datePickerConfig={culture:"es-CO",format:"dd/MM/yyyy HH:mm"},console.log(i),n.responsibleList=[],n.typesAlert=s("orderBy")(t.parameters("tracking_alert_type"),"id",!1),n.typesTime=t.parameters("tracking_alert_timeType"),n.statusAlert=t.parameters("tracking_alert_status"),n.preferencesAlert=t.parameters("tracking_alert_preference"),n.typeList=t.parameters("improvement_plan_type");var f=function(){n.improvement={id:0,customerId:e.customerId,classificationName:i.experience,classificationId:i.experience,entityName:"RVE",entityId:i.id,type:null,endDate:null,description:i.observationType,observation:"",responsible:null,isRequiresAnalysis:!1,status:{id:0,value:"CR",item:"Creada"},trackingList:[],alertList:[]}};f(),n.onLoadRecord=function(e){if(0!=e){var t={id:e};u({method:"GET",url:"api/customer/improvement-plan",params:t})["catch"](function(e,t){if(403==t){var n=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";l.swal("No Autorizado","No estas autorizado para ver esta información.","error"),r(function(){$state.go(n)},3e3)}else 404==t?l.swal("Información no disponible","Centro de trabajo no encontrado","error"):l.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(e){r(function(){null!=e.data.result&&""!=e.data.result&&(n.improvement=e.data.result,v())},400)})["finally"](function(){})}else n.loading=!1},n.onCloseModal=function(){o.close(1)},n.onCancel=function(){o.dismiss("cancel")},n.onClear=function(){};var w=function(){var t={customer_id:e.customerId};return u({method:"POST",url:"api/customer/improvement-plan/list-data",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(e){r(function(){n.responsibleList=e.data.data.responsible})})["catch"](function(e){l.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};w(),n.master=n.improvement,n.form={submit:function(e){var t=null;if(e.$invalid){var n=null,t=null;for(n in e)"$"!=n[0]&&(null!==t||e[n].$valid||(t=e[n].$name),e[n].$pristine&&(e[n].$dirty=!0));return angular.element(".ng-invalid[name="+t+"]").focus(),void l.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}l.swal("Validación exitosa","Procediendo con el guardado...","success"),h()},reset:function(e){n.improvement=angular.copy(n.master),e.$setPristine(!0)}};var h=function(){var e={},t=JSON.stringify(n.improvement);return e.data=Base64.encode(t),u({method:"POST",url:"api/customer/improvement-plan/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){r(function(){f()})})["catch"](function(e){l.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){n.reloadData()})},v=function(){null!=n.improvement.endDate&&(n.improvement.endDate=new Date(n.improvement.endDate.date)),angular.forEach(n.improvement.trackingList,function(e,t){null!=e.startDate&&(e.startDate=new Date(e.startDate.date))})};n.onAddTracking=function(){r(function(){null==n.improvement.trackingList&&(n.improvement.trackingList=[]),n.improvement.trackingList.push({id:0,customerImprovementPlanId:0,responsible:null,startDate:null})})},n.onRemoveTracking=function(e){l.swal({title:"Está seguro?",text:"Desea confirmar la eliminación de este registro ?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(t){t?r(function(){var t=n.improvement.trackingList[e];if(n.improvement.trackingList.splice(e,1),0!=t.id){var o={};o.id=t.id,u({method:"POST",url:"api/customer/improvement-plan-tracking/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){a.error(e),l.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})},n.onAddAlert=function(){r(function(){null==n.improvement.alertList&&(n.improvement.alertList=[]),n.improvement.alertList.push({id:0,customerImprovementPlanId:0,type:null,preference:null,time:0,timeType:null,status:null})})},n.onRemoveAlert=function(e){l.swal({title:"Está seguro?",text:"Desea confirmar la eliminación de este registro ?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(t){t?r(function(){var t=n.improvement.alertList[e];if(n.improvement.alertList.splice(e,1),0!=t.id){var o={};o.id=t.id,u({method:"POST",url:"api/customer/improvement-plan-alert/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){a.error(e),l.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})},n.dtInstanceImprovementPlan={},n.dtOptionsImprovementPlan=d.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerId=n.improvement.customerId,e.entityId=n.improvement.entityId,e.entityName=n.improvement.entityName,JSON.stringify(e)},url:"api/customer-improvement-plan-entity",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){g()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,t,o){p(angular.element(e).contents())(n)}),n.dtColumnsImprovementPlan=[m.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,o,i,a){var r="",l='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+e.id+'" >   <i class="fa fa-edit"></i></a> ',s='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+e.id+'" >   <i class="fa fa-trash-o"></i></a> ';return t.can("cliente_plan_mejoramiento_edit")&&(r+=l),t.can("cliente_plan_mejoramiento_delete")&&(r+=s),n.isView?null:r}),m.newColumn("origin").withTitle("Origen").withOption("width",200).withOption("defaultContent",""),m.newColumn("classification").withTitle("Clasificación").withOption("width",200).withOption("defaultContent",""),m.newColumn("type").withTitle("Tipo").withOption("width",200).withOption("defaultContent",""),m.newColumn("description").withTitle("Hallazgo").withOption("width",200).withOption("defaultContent",""),m.newColumn("responsibleName").withTitle("Responsable").withOption("defaultContent",""),m.newColumn(null).withTitle("Fecha Cierre").withOption("width",200).renderWith(function(e,t,n,o){return"object"==typeof e.endDate&&null!=e.endDate?moment(e.endDate.date).format("DD/MM/YYYY"):null!=e.endDate?moment(e.endDate).format("DD/MM/YYYY"):""}),m.newColumn(null).withTitle("Estado").withOption("width",200).withOption("defaultContent","").renderWith(function(e,t,n,o){var i="label label-success",a=e.status;switch(e.statusCode){case"AB":i="label label-info";break;case"CO":i="label label-success";break;case"CA":i="label label-danger"}return'<span class="'+i+'">'+a+"</span>"})];var g=function(){$("#dtImprovementPlan a.editRow").on("click",function(){var e=$(this).data("id");n.onLoadRecord(e)}),$("#dtImprovementPlan a.delRow").on("click",function(){var e=$(this).data("id");l.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(t){if(t){var o={};o.id=e,u({method:"POST",url:"api/customer/improvement-plan/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){a.error(e),l.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){n.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};n.dtInstanceImprovementPlanCallback=function(e){n.dtInstanceImprovementPlan=e},n.reloadData=function(){n.dtInstanceImprovementPlan.reloadData()}}]);
"use strict";app.controller("customerVrEmployeeIndicatorsEmployeeCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$document","$filter","$aside","ListService","ChartService",function(e,t,i,n,o,a,r,l,c,s,d,p,u,m,f,y,w,h){function E(){var t=[{name:"customer_vr_employee_historical_period_list",criteria:{employeeId:e.entity.employee.id}}];w.getDataList(t).then(function(t){e.periodList=t.data.data.periodList},function(t){e.status="Unable to load customer data: "+t.message})}function I(){var t=[{name:"chart_line_options",criteria:null},{name:"customer_vr_experience_employee_indicators",criteria:{customerEmployeeId:e.entity.employee.id,year:e.entity.selectedYear.value}}];h.getDataChart(t).then(function(t){e.chart.line.options=angular.copy(t.data.data.chartLineOptions),e.chart.line.options.legend.display=!1,e.chart.data.experienceByEmployee=t.data.data.customerVrExperienceEmployeeIndicators,e.chart.data.experienceByEmployee.forEach(function(t){e.openedGrids[t.experienceCode]=!0})},function(t){e.status="Unable to load customer data: "+t.message})}e.periodList=[],e.entity={customerId:t.customerId,selectedYear:null,employee:{id:0,documentNumber:"",firstName:"",lastName:""}},e.chart={line:{options:null},data:{experienceByEmployee:null}},e.openedGrids={},e.onSelectMonth=function(){e.reloadData(),I()},e.onExportPdf=function(){kendo.drawing.drawDOM($(".customer-vr-employee-indicators-export-pdf")).then(function(e){return kendo.drawing.exportPDF(e,{paperSize:"auto",margin:{left:"1cm",top:"1cm",right:"1cm",bottom:"1cm"}})}).done(function(t){kendo.saveAs({dataURI:t,fileName:"INDICADORES_REALIDAD_VIRTUAL_"+e.entity.employee.firstName+"_"+e.entity.employee.lastName+".pdf",proxyURL:"//demos.telerik.com/kendo-ui/service/export"})})},e.dtInstanceVrEmployeeIE={},e.dtOptionsVrEmployeeIE=n.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(i){return i.customerId=t.customerId,e.entity.employee.id&&(i.customerEmployeeId=e.entity.employee.id),e.entity.selectedYear&&(i.selectedYear=e.entity.selectedYear.value),JSON.stringify(i)},url:"api/customer-vr-employee-scene-answer/summary-all",contentType:"application/json",type:"POST",beforeSend:function(t){e.entity.selectedYear||t.abort()}}).withDataProp("data").withOption("order",[[0,"desc"],[1,"asc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!!e.entity.selectedYear}).withPaginationType("full_numbers").withOption("createdRow",function(t,i,n){r(angular.element(t).contents())(e)}),e.dtColumnsVrEmployeeIE=[o.newColumn("date").withTitle("Fecha").withOption("width",220).withOption("defaultContent",""),o.newColumn("experience").withTitle("Experiencia").withOption("width",220).withOption("defaultContent",""),o.newColumn("scene").withTitle("Escena").withOption("width",220).withOption("defaultContent",""),o.newColumn("question").withTitle("Indicador").withOption("width",220).withOption("defaultContent",""),o.newColumn(null).withTitle("Valoración").withOption("width",120).renderWith(function(e,t,i,n){var o="";"SI"==e.answer?o='<i class=" text-success fa fa-2x fa-check-circle-o" aria-hidden="true"></i>':"NO"==e.answer?o='<i class=" text-danger fa fa-2x fa-ban" aria-hidden="true"></i>':"NO APLICA"==e.answer?o='<i class=" text-inverse fa fa-2x fa-minus-circle" aria-hidden="true"></i>':"NEGACIÓN DEL USUARIO"==e.answer?o='<i class=" text-warning fa fa-2x fa-exclamation-circle" aria-hidden="true"></i>':(o='<i class=" text-warning fa fa-2x fa-question-circle" aria-hidden="true"></i>',e.question="SELECCIONE");var a='<span class="vertical-align-sub">'+o+" </span>"+e.answer;return a})],e.dtInstanceVrEmployeeIECallback=function(t){e.dtInstanceVrEmployeeIE=t},e.reloadData=function(){e.dtInstanceVrEmployeeIE.reloadData()},e.dtInstanceCustomerVrExperienceByEmployeeIndicator={},e.dtInstanceCustomerVrExperienceByEmployeeIndicatorCallback=function(t){e.dtInstanceCustomerVrExperienceByEmployeeIndicator[t.id]=t},e.reloadDataAllGrids=function(){for(var t in e.dtInstanceCustomerVrExperienceByEmployeeIndicator){var i=e.dtInstanceCustomerVrExperienceByEmployeeIndicator[t].id,n=i.split("-")[1]||0;Object.keys(e.openedGrids).forEach(function(t){e.openedGrids[t]=!1});var o="api/customer-vr-employee-scene-answer/grid/";e.dtInstanceCustomerVrExperienceByEmployeeIndicator[t].DataTable.ajax.url(o+n),e.dtInstanceCustomerVrExperienceByEmployeeIndicator[t].reloadData()}},e.onOpenGridByExperience=function(t){if(e.openedGrids[t]=!e.openedGrids[t],!e.openedGrids[t]){var i="api/customer-vr-employee-scene-answer/grid/",n="dtCustomerVrExperienceByEmployeeIndicator-"+t;e.dtInstanceCustomerVrExperienceByEmployeeIndicator[n].DataTable.ajax.url(i+t),e.dtInstanceCustomerVrExperienceByEmployeeIndicator[n].reloadData()}},e.dtOptionsCustomerVrExperienceByEmployeeIndicator=n.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.customerEmployeeId=e.entity.employee.id,t.year=e.entity.selectedYear.value,JSON.stringify(t)},url:"api/customer-vr-employee-scene-answer/grid/0",type:"POST"}).withDataProp("data").withOption("order",[[0,"asc    "]]).withOption("serverSide",!0).withOption("processing",!0).withOption("searching",!1).withOption("ordering",!1).withOption("paging",!1).withOption("paginate",!1).withOption("info",!1).withPaginationType("full_numbers").withOption("createdRow",function(t){r(angular.element(t).contents())(e)}),e.dtColumnsCustomerVrExperienceByEmployeeIndicator=[o.newColumn("date").withTitle("Fecha"),o.newColumn(null).withTitle("Porcentaje").renderWith(function(e,t,i,n){return e.percent+"%"})],e.onSearchEmployee=function(){var t=y.open({templateUrl:s.app.views.urlRoot+"modules/customer/common/modals/employee_list_modal.htm",placement:"right",windowTopClass:"top-modal",size:"lg",backdrop:!0,controller:"ModalInstanceSideEmployeeListCtrl",scope:e});t.result.then(function(e){O(e)})};var O=function(t){var i={id:t.id,documentNumber:t.entity.documentNumber,firstName:t.entity.firstName,lastName:t.entity.lastName};e.entity.employee=i,e.selectedYear=null,e.chart.data.experienceByEmployee=[],E(),e.reloadData()}}]),app.controller("ModalInstanceSideEmployeeListCtrl",["$rootScope","$stateParams","$scope","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile","ListService","$aside",function(e,t,i,n,o,a,r,l,c,s,d,p,u,m,f,y){function w(){var e=[{name:"criteria_operators",value:null},{name:"criteria_conditions",value:null}];f.getDataList(e).then(function(e){i.criteria=e.data.data.criteriaOperatorList,i.conditions=e.data.data.criteriaConditionList},function(e){i.status="Unable to load customer data: "+e.message})}i.canCreate=!1,i.canFilter=!0,i.employee={id:0},i.onCloseModal=function(){n.close(i.employee)},i.onCancel=function(){n.dismiss("cancel")},i.audit={fields:[],filters:[]},i.audit.fields=[{alias:"Tipo de Identificación",name:"employeeDocumentType"},{alias:"Número de Identificación",name:"documentNumber"},{alias:"Nombre",name:"firstName"},{alias:"Apellidos",name:"lastName"}],w(),i.addFilter=function(){null==i.audit.filters&&(i.audit.filters=[]),i.audit.filters.push({id:0,field:null,criteria:i.criteria.length>0?i.criteria[1]:null,condition:i.conditions.length>0?i.conditions[0]:null,value:""})},i.onFilter=function(){i.reloadData()},i.removeFilter=function(e){i.audit.filters.splice(e,1)},i.onCleanFilter=function(){i.audit.filters=[],i.reloadData()},i.onLoadRecord=function(){if(0!=i.employee.id){var e={id:i.employee.id};l({method:"GET",url:"api/customer-employee",params:e})["catch"](function(e,t){if(403==t){var i=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";r.swal("No Autorizado","No estas autorizado para ver esta información.","error"),a(function(){$state.go(i)})}else 404==t?r.swal("Información no disponible","Diagnóstico no encontrado","error"):r.swal("Error","Se ha presentado un error al intentar acceder a la información del proceso","error")}).then(function(e){a(function(){i.employee=e.data.result})})["finally"](function(){a(function(){i.onCloseModal()},400)})}else i.loading=!1},i.dtInstanceModalEmployeeList={},i.dtOptionsModalEmployeeList=u.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerId=t.customerId,angular.isDefined(i.audit)&&angular.isDefined(i.audit.filters)&&(e.filter={filters:i.audit.filters.filter(function(e){return null!=e&&null!=e.field&&null!=e.criteria}).map(function(e,t,i){return{field:e.field.name,operator:e.criteria.value,value:e.value,condition:e.condition.value}})}),JSON.stringify(e)},url:"api/customer-employee-modal-basic-2",contentType:"application/json",type:"POST"}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){h()}).withPaginationType("full_numbers").withOption("createdRow",function(e,t,n){m(angular.element(e).contents())(i)}),i.dtColumnsModalEmployeeList=[p.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,t,i,n){var o="",a="",r='<a class="btn btn-success btn-xs editRow lnk" href="#" uib-tooltip="Adicionar empleado" tooltip-placement="right"  data-id="'+e.id+'"'+a+' >   <i class="fa fa-plus-square"></i></a> ';return o+=r}),p.newColumn("employeeDocumentType").withTitle("Tipo Identificación").withOption("width",200),p.newColumn("documentNumber").withTitle("Número Identificación").withOption("width",200),p.newColumn("firstName").withTitle("Nombre").withOption("width",200),p.newColumn("lastName").withTitle("Apellidos").withOption("width",200)];var h=function(){angular.element("#dtModalEmployeeList a.editRow").on("click",function(){var e=angular.element(this).data("id");i.editModalEmployeeList(e)})};i.reloadData=function(){i.dtInstanceModalEmployeeList.reloadData()},i.viewModalEmployeeList=function(e){i.employee.id=e,i.isView=!0,i.onLoadRecord()},i.editModalEmployeeList=function(e){i.employee.id=e,i.isView=!1,i.onLoadRecord()},i.onCreate=function(){var t=y.open({templateUrl:e.app.views.urlRoot+"modules/customer/common/modals/employee_create_modal.htm",placement:"right",windowTopClass:"top-modal",size:"lg",backdrop:!0,controller:"ModalInstanceSideEmployeeCreateCtrl",scope:i});t.result.then(function(e){i.reloadData()})}}]);
"use strict";app.controller("customerVrEmployeeObservationsCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$document","$filter","$aside","ChartService","ListService",function(e,t,n,i,a,o,r,l,s,c,d,u,m,p,f,w,h,v){function O(){var n=[{name:"customer_vr_employee_observations_charts",criteria:{customerId:t.customerId,selectedYear:e.entity.selectedYear?e.entity.selectedYear.value:null}},{name:"chart_bar_options"}];h.getDataChart(n).then(function(t){e.chart.bar.options=t.data.data.chartBarOptions,e.chart.genre=t.data.data.genre,e.chart.obsTypes=t.data.data.obsTypes,e.chart.genreTotal=t.data.data.genreTotal},function(t){e.status="Unable to load customer data: "+t.message})}function g(){var n=[{name:"customer_vr_employee_historical_period_observation_list",criteria:{customerId:t.customerId}},{name:"customer_vr_employee_observation",criteria:{customerId:t.customerId}}];v.getDataList(n).then(function(t){e.periodList=t.data.data.periodList,e.observationList=t.data.data.customer_vr_employee_observation,e.periodList.length&&(e.entity.selectedYear=e.periodList[0],O(),e.reloadDataTypes(),e.reloadDataDetails()),e.observationList.push({item:"Otra",value:"O"})},function(t){e.status="Unable to load customer data: "+t.message})}e.entity={selectedYear:null},e.periodList=[],e.observationList=[],e.chart={bar:{options:null},doughnut:{options:null},genre:null,obsTypes:null,genreTotal:null},g(),e.onSelectMonth=function(){e.reloadDataTypes(),e.reloadDataDetails(),O()},e.onClearFilter=function(){e.entity.selectedYear=null,e.reloadDataTypes(),e.reloadDataDetails(),O()},e.dtInstanceVrEmployeeO={},e.dtOptionsVrEmployeeO=i.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(n){return n.customerId=t.customerId,e.entity.selectedYear&&(n.selectedYear=e.entity.selectedYear.value),JSON.stringify(n)},url:"api/customer-vr-employee-experience-answer/observations-count",contentType:"application/json",type:"POST",beforeSend:function(t){e.entity.selectedYear||t.abort(t)},complete:function(e){}}).withDataProp("data").withOption("order",[[1,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!!e.entity.selectedYear}).withOption("fnDrawCallback",function(){y()}).withPaginationType("full_numbers").withOption("createdRow",function(t,n,i){r(angular.element(t).contents())(e)}),e.dtColumnsVrEmployeeO=[a.newColumn(null).withTitle("Acciones").withOption("width",40).notSortable().renderWith(function(e,t,n,i){var a="",o='<a class="btn btn-warning btn-xs planRow lnk" href="#" uib-tooltip="Agregar Plan Mejoramiento" data-experience='+e.experience+" data-id="+e.id+" data-obstype="+e.observationType+' >   <i class="fa fa-plus-square"></i></a> ';return a+=o}),a.newColumn("experience").withTitle("Experiencia").withOption("width",200).withOption("defaultContent",""),a.newColumn("observationType").withTitle("Tipo de Observación").withOption("width",200).withOption("defaultContent",""),a.newColumn("total").withTitle("Número de Observaciones").withOption("width",200).withOption("defaultContent","")];var y=function(){$("#dtVrEmployeeO a.planRow").on("click",function(){var t=$(this).data("id"),n=$(this).data("experience"),i=$(this).data("obstype"),a={id:t,experience:n,observationType:i};e.onAddPlan(a)})};e.dtInstanceVrEmployeeOCallback=function(t){e.dtInstanceVrEmployeeO=t},e.reloadDataTypes=function(){e.dtInstanceVrEmployeeO.reloadData()},e.onAddPlan=function(t){var n=w.open({templateUrl:c.app.views.urlRoot+"modules/customer/common/modals/customer_improvement_plan_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideVrEmployeeImprovementPlanCtrl",scope:e,resolve:{entity:function(){return t}}});n.result.then(function(){},function(){})},e.dtOptionsVrEmployeeOD=i.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(n){return n.customerId=t.customerId,e.entity.selectedYear&&(n.selectedYear=e.entity.selectedYear.value),JSON.stringify(n)},url:"api/customer-vr-employee-experience-answer/observations-detail",contentType:"application/json",type:"POST",beforeSend:function(t){e.entity.selectedYear||t.abort(t)},complete:function(e){}}).withDataProp("data").withOption("order",[[1,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!!e.entity.selectedYear}).withOption("fnDrawCallback",function(){}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,n,i){r(angular.element(t).contents())(e)}),e.dtColumnsVrEmployeeOD=[a.newColumn(null).withTitle("Acciones").withOption("width",40).notSortable().renderWith(function(e,t,n,i){return""}),a.newColumn("date").withTitle("Fecha").withOption("width",200).withOption("defaultContent",""),a.newColumn("experience").withTitle("Experiencia").withOption("width",200).withOption("defaultContent",""),a.newColumn("observationType").withTitle("Tipo de Observación").withOption("width",200).withOption("defaultContent",""),a.newColumn("observation").withTitle("Observación").withOption("width",200).withOption("defaultContent",""),a.newColumn("documentNumber").withTitle("Número Identificación").withOption("width",200).withOption("defaultContent",""),a.newColumn("firstName").withTitle("Nombres").withOption("width",200).withOption("defaultContent",""),a.newColumn("lastName").withTitle("Apellidos").withOption("width",200).withOption("defaultContent","")],e.dtInstanceVrEmployeeODCallback=function(t){e.dtInstanceVrEmployeeOD=t},e.reloadDataDetails=function(){e.dtInstanceVrEmployeeOD.reloadData()},e.onExportExcel=function(){if(!e.entity.selectedYear)return void m.swal("Alerta","No se puede generar el excel, no hay información de periodos","error");var n={selectedYear:e.entity.selectedYear,customerId:t.customerId};angular.element("#downloadDocument")[0].src="api/customer-vr-employee-experience-answer/observations-export?data="+Base64.encode(JSON.stringify(n))};var b=null,C=function(){e.entity={id:0,customerId:e.customer.id,registrationDate:null,observation:null},null!=b&&b.$setPristine(!0)};e.maxDate=new Date,e.datePickerConfig={culture:"es-CO",format:"dd/MM/yyyy"},C();var D=function(t){var n={id:t};u({method:"GET",url:"api/customer-vr-general-observation/get",params:n})["catch"](function(e,t){if(403==t){var n=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";m.swal("No Autorizado","No estas autorizado para ver esta información.","error"),d(function(){s.go(n)},3e3)}else 404==t?(m.swal("Información no disponible","Aporte no encontrado","error"),d(function(){s.go("app.clientes.list")})):m.swal("Error","Se ha presentado un error al intentar acceder a la información del aporte","error")}).then(function(t){d(function(){e.entity=t.data.result,e.entity.registrationDate&&(e.entity.registrationDate=new Date(e.entity.registrationDate.date))})})["finally"](function(){})};e.form={submit:function(t){if(b=t,t.$invalid){var n=null,i=null;for(n in t)"$"!=n[0]&&(null!==i||t[n].$valid||(i=t[n].$name),t[n].$pristine&&(t[n].$dirty=!0));angular.element(".ng-invalid[name="+i+"]").focus(),m.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}else{if(!e.entity.registrationDate)return void m.swal("Alerta","La fecha es requerida","error");T()}},reset:function(t){e.customer=angular.copy(e.master),t.$setPristine(!0)}};var T=function(){var t={},i=e.entity.observation.value,a=!1;if("O"==i&&(i=e.entity.observationText,a=!0,e.observationList.some(function(e){return e.value.trim().toLowerCase()===i.trim().toLowerCase()})))return void m.swal("El formulario contiene errores!","La observación ingresada ya existe en la lista.","error");var o={id:e.entity.id,customerId:e.customer.id,registrationDate:e.entity.registrationDate,observation:i,isCustomObservation:a},r=JSON.stringify(o);return t.data=Base64.encode(r),u({method:"POST",url:"api/customer-vr-general-observation/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){d(function(){m.swal("Operación exitosa","Registro agregado satisfactoriamente","success"),e.entity=t.data.result,e.entity.registrationDate&&(e.entity.registrationDate=new Date(e.entity.registrationDate.date)),g(),e.reloadData(),e.onCancelObservation()})})["catch"](function(e){n.error(e),m.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})};e.dtOptionsVrGeneralObservation=i.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.customerId=e.customer.id,JSON.stringify(t)},url:"api/customer-vr-general-observation",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){I()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,n,i){r(angular.element(t).contents())(e)}),e.dtColumnsVrGeneralObservation=[a.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,t,n,i){var a="",o='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+e.id+'" >   <i class="fa fa-edit"></i></a> ',r='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+e.id+'" >   <i class="fa fa-trash-o"></i></a> ';return c.can("clientes_vr_general_observation_edit")&&(a+=o),c.can("clientes_vr_general_observation_delete")&&(a+=r),a}),a.newColumn("registrationDate").withTitle("Fecha").withOption("width",200).withOption("defaultContent",""),a.newColumn("observation").withTitle("Observación").withOption("defaultContent",""),a.newColumn("createdByUser").withTitle("Creado Por").withOption("width",300).withOption("defaultContent","")];var I=function(){angular.element("#dtCustomerVrGeneralObservation a.editRow").on("click",function(){var t=angular.element(this).data("id");e.onEdit(t)}),angular.element("#dtCustomerVrGeneralObservation a.delRow").on("click",function(){var t=angular.element(this).data("id");m.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(i){if(i){var a={};a.id=t,u({method:"POST",url:"api/customer-vr-general-observation/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){n.error(e),m.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){e.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};e.onEdit=function(t){e.isView=!1,D(t)},e.dtInstanceVrGeneralObservationCallback=function(t){e.dtInstanceVrGeneralObservation=t},e.reloadData=function(){e.dtInstanceVrGeneralObservation.reloadData()},e.onCancelObservation=function(){C()}}]),app.controller("ModalInstanceSideVrEmployeeImprovementPlanCtrl",["$stateParams","$rootScope","$scope","$uibModalInstance","entity","$log","$timeout","SweetAlert","$filter","FileUploader","$http","DTOptionsBuilder","DTColumnBuilder","$compile",function(e,t,n,i,a,o,r,l,s,c,d,u,m,p){n.maxDate=new Date,n.datePickerConfig={culture:"es-CO",format:"dd/MM/yyyy HH:mm"},n.responsibleList=[],n.typesAlert=s("orderBy")(t.parameters("tracking_alert_type"),"id",!1),n.typesTime=t.parameters("tracking_alert_timeType"),n.statusAlert=t.parameters("tracking_alert_status"),n.preferencesAlert=t.parameters("tracking_alert_preference"),n.typeList=t.parameters("improvement_plan_type");var f=function(){n.improvement={id:0,customerId:e.customerId,classificationName:a.experience,classificationId:a.experience,entityName:"RVE",entityId:a.id,type:null,endDate:null,description:a.observationType,observation:"",responsible:null,isRequiresAnalysis:!1,status:{id:0,value:"CR",item:"Creada"},trackingList:[],alertList:[]}};f(),n.onLoadRecord=function(e){if(0!=e){var t={id:e};d({method:"GET",url:"api/customer/improvement-plan",params:t})["catch"](function(e,t){if(403==t){var n=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";l.swal("No Autorizado","No estas autorizado para ver esta información.","error"),r(function(){$state.go(n)},3e3)}else 404==t?l.swal("Información no disponible","Centro de trabajo no encontrado","error"):l.swal("Error","Se ha presentado un error al intentar acceder a la información del centro de trabajo","error")}).then(function(e){r(function(){null!=e.data.result&&""!=e.data.result&&(n.improvement=e.data.result,v())},400)})["finally"](function(){})}else n.loading=!1},n.onCloseModal=function(){i.close(1)},n.onCancel=function(){i.dismiss("cancel")},n.onClear=function(){};var w=function(){var t={customer_id:e.customerId};return d({method:"POST",url:"api/customer/improvement-plan/list-data",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(e){r(function(){n.responsibleList=e.data.data.responsible})})["catch"](function(e){l.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};w(),n.master=n.improvement,n.form={submit:function(e){var t=null;if(e.$invalid){var n=null,t=null;for(n in e)"$"!=n[0]&&(null!==t||e[n].$valid||(t=e[n].$name),e[n].$pristine&&(e[n].$dirty=!0));return angular.element(".ng-invalid[name="+t+"]").focus(),void l.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}l.swal("Validación exitosa","Procediendo con el guardado...","success"),h()},reset:function(e){n.improvement=angular.copy(n.master),e.$setPristine(!0)}};var h=function(){var e={},t=JSON.stringify(n.improvement);return e.data=Base64.encode(t),d({method:"POST",url:"api/customer/improvement-plan/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){r(function(){f()})})["catch"](function(e){l.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){n.reloadData()})},v=function(){null!=n.improvement.endDate&&(n.improvement.endDate=new Date(n.improvement.endDate.date)),angular.forEach(n.improvement.trackingList,function(e,t){null!=e.startDate&&(e.startDate=new Date(e.startDate.date))})};n.onAddTracking=function(){r(function(){null==n.improvement.trackingList&&(n.improvement.trackingList=[]),n.improvement.trackingList.push({id:0,customerImprovementPlanId:0,responsible:null,startDate:null})})},n.onRemoveTracking=function(e){l.swal({title:"Está seguro?",text:"Desea confirmar la eliminación de este registro ?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(t){t?r(function(){var t=n.improvement.trackingList[e];if(n.improvement.trackingList.splice(e,1),0!=t.id){var i={};i.id=t.id,d({method:"POST",url:"api/customer/improvement-plan-tracking/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){o.error(e),l.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})},n.onAddAlert=function(){r(function(){null==n.improvement.alertList&&(n.improvement.alertList=[]),n.improvement.alertList.push({id:0,customerImprovementPlanId:0,type:null,preference:null,time:0,timeType:null,status:null})})},n.onRemoveAlert=function(e){l.swal({title:"Está seguro?",text:"Desea confirmar la eliminación de este registro ?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(t){t?r(function(){var t=n.improvement.alertList[e];if(n.improvement.alertList.splice(e,1),0!=t.id){var i={};i.id=t.id,d({method:"POST",url:"api/customer/improvement-plan-alert/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){o.error(e),l.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})},n.dtInstanceImprovementPlan={},n.dtOptionsImprovementPlan=u.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerId=n.improvement.customerId,e.entityId=n.improvement.entityId,e.entityName=n.improvement.entityName,JSON.stringify(e)},url:"api/customer-improvement-plan-entity",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){O()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,t,i){p(angular.element(e).contents())(n)}),n.dtColumnsImprovementPlan=[m.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,i,a,o){var r="",l='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+e.id+'" >   <i class="fa fa-edit"></i></a> ',s='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+e.id+'" >   <i class="fa fa-trash-o"></i></a> ';return t.can("cliente_plan_mejoramiento_edit")&&(r+=l),t.can("cliente_plan_mejoramiento_delete")&&(r+=s),n.isView?null:r}),m.newColumn("origin").withTitle("Origen").withOption("width",200).withOption("defaultContent",""),m.newColumn("classification").withTitle("Clasificación").withOption("width",200).withOption("defaultContent",""),m.newColumn("type").withTitle("Tipo").withOption("width",200).withOption("defaultContent",""),m.newColumn("description").withTitle("Hallazgo").withOption("width",200).withOption("defaultContent",""),m.newColumn("responsibleName").withTitle("Responsable").withOption("defaultContent",""),m.newColumn(null).withTitle("Fecha Cierre").withOption("width",200).renderWith(function(e,t,n,i){return"object"==typeof e.endDate&&null!=e.endDate?moment(e.endDate.date).format("DD/MM/YYYY"):null!=e.endDate?moment(e.endDate).format("DD/MM/YYYY"):""}),m.newColumn(null).withTitle("Estado").withOption("width",200).withOption("defaultContent","").renderWith(function(e,t,n,i){var a="label label-success",o=e.status;switch(e.statusCode){case"AB":a="label label-info";break;case"CO":a="label label-success";break;case"CA":a="label label-danger"}return'<span class="'+a+'">'+o+"</span>"})];var O=function(){$("#dtImprovementPlan a.editRow").on("click",function(){var e=$(this).data("id");n.onLoadRecord(e)}),$("#dtImprovementPlan a.delRow").on("click",function(){var e=$(this).data("id");l.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(t){if(t){var i={};i.id=e,d({method:"POST",url:"api/customer/improvement-plan/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){o.error(e),l.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){n.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};n.dtInstanceImprovementPlanCallback=function(e){n.dtInstanceImprovementPlan=e},n.reloadData=function(){n.dtInstanceImprovementPlan.reloadData()}}]);
"use strict";app.controller("customerVrEmployeeIndicatorsCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$document","$filter","$aside","ChartService","ListService",function(e,t,n,a,r,i,c,l,o,s,d,u,p,m,y,f,h,g){function v(){var t=e.entity.selectedYear.value+"-01-01",n=e.entity.selectedYear.value+"-12-31";e.dateRangePicker.min=t,e.dateRangePicker.max=n}function x(){var n=[{name:"customer_vr_employee_indicators_charts",criteria:{customerId:t.customerId,selectedYear:e.entity.selectedYear?e.entity.selectedYear.value:null,selectedDateRange:e.entity.selectedRangeDates?e.entity.selectedRangeDates:null,selectedExperience:e.entity.selectedExperience?e.entity.selectedExperience.value:null}},{name:"chart_bar_options"}];h.getDataChart(n).then(function(t){e.chart.bar.options=t.data.data.chartBarOptions,e.chart.genre=t.data.data.genre,e.chart.genreTotal=t.data.data.genreTotal,e.chart.competitorExperience=t.data.data.competitorExperience},function(t){e.status="Unable to load customer data: "+t.message})}function L(){var n=e.entity.selectedYear?e.entity.selectedYear.value:null,a=[{name:"customer_vr_employee_indicators_period_list",criteria:{customerId:t.customerId,period:n}},{name:"customer_vr_employee_experience_scenes_customer",value:t.customerId}];g.getDataList(a).then(function(t){e.periodList=t.data.data.periodList,e.experienceOptionsList=t.data.data.experienceOptionsList,e.sceneList=t.data.data.sceneOptionsList,e.experienceFilterList=t.data.data.experienceFilterList,e.periodList.length&&!Y&&(Y=!0,e.entity.selectedYear=e.periodList[0],v(),x(),D(),e.onClearOptions(),e.entity.periodChart=e.periodList[0],e.chartLines.period.push(e.entity.periodChart.value))},function(t){e.status="Unable to load customer data: "+t.message})}var Y=!1;e.entity={selectedYear:null,customerId:t.customerId,experience:null,scene:null,periodChart:null,selectedRangeDates:null},e.dateRangePicker={picker:null,min:moment().startOf("year").format("YYYY-MM-DD"),max:moment().endOf("year").format("YYYY-MM-DD"),clearable:!0,options:{buttonClasses:"btn",applyButtonClasses:"btn-primary",cancelButtonClasses:"btn-danger",locale:{applyLabel:"Aplicar",cancelLabel:"Cancelar",clearLabel:"Limpiar",separator:" - ",format:"DD/MM/YYYY"},eventHandlers:{"apply.daterangepicker":function(e,t){D(),x()},"cancel.daterangepicker":function(e,t){D(),x()}}}},e.activeTabIndex=0,e.periodList=[],e.experienceList=[],e.experienceOptionsList=[],e.sceneOptionsList=[],e.sceneList=[],e.experienceFilterList=[],e.chartLines={customerId:t.customerId,experience:null,scene:null,period:[],data:[]},e.chart={bar:{options:null},doughnut:{options:null},lines:{options:{scales:{yAxes:[{ticks:{beginAtZero:!0,stepSize:1}}]}}},genre:null,competitorExperience:null,genreTotal:null},L();var D=function(){var t={},n=JSON.stringify(e.entity);t.data=Base64.encode(n),u({method:"POST",url:"api/customer-vr-employee-experience-answer/get-all",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){e.experienceList=t.data.result,d(function(){angular.element("li.parentTab0 > a.nav-link").triggerHandler("click")})})["catch"](function(e){p.swal("Error","Ocurrió un problema cargar la información.","error")})};e.onConsolidate=function(){var e={};e.customerId=t.customerId,u({method:"POST",url:"api/customer-vr-employee/consolidate",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){d(function(){L()})})["catch"](function(e){p.swal("Error","Ocurrió un problema cargar la información.","error")})},e.onGenerateReport=function(){if(!e.entity.selectedYear)return void p.swal("Error","Debe seleccionar el periodo.","error");var n={customerId:t.customerId,selectedYear:e.entity.selectedYear?e.entity.selectedYear.value:null,selectedDateRange:e.entity.selectedRangeDates?e.entity.selectedRangeDates:null,selectedExperience:e.entity.selectedExperience?e.entity.selectedExperience.value:null};angular.element("#downloadDocument")[0].src="api/customer-vr-employee/generate-report-pdf?data="+Base64.encode(JSON.stringify(n))},e.onSelectYear=function(){e.entity.selectedRangeDates=null,e.entity.selectedExperience=null,e.entity.selectedYear&&v(),L(),D(),x()},e.onSelectFilterExperience=function(){D(),x()},e.onClearFilterExperience=function(){D(),x()},e.onClearOptions=function(){e.entity.experience=null,e.entity.scene=null,e.entity.periodChart=null,e.chartLines.period=[],e.chartLines.data=[]},e.onSelectPeriod=function(){e.chartLines.period.push(e.entity.periodChart.value),e.onSelectScene()},e.valideSingle=function(t){return e.chartLines.period.indexOf(t.value)>-1},e.removePeriodChart=function(t){e.chartLines.period.map(function(n,a){if(t==n)return void e.chartLines.period.splice(a,1)})},e.onSelectExperience=function(){var t=y("filter")(e.sceneList,{code:e.entity.experience.value},!0);e.sceneOptionsList=t,e.entity.scene=null},e.onSelectScene=function(){e.chartLines.data=[],e.chartLines.experience=e.entity.experience.value,e.chartLines.scene=e.entity.scene.value;var t=[{name:"customer_vr_employee_indicators_period_chart",criteria:e.chartLines}];h.getDataChart(t).then(function(t){e.chartLines.data=t.data.data.periodChart},function(t){e.status="Unable to load customer data: "+t.message})},e.onExportExcel=function(){var n={customerId:t.customerId,selectedYear:e.entity.selectedYear?e.entity.selectedYear.value:null,selectedDateRange:e.entity.selectedRangeDates?e.entity.selectedRangeDates:null,selectedExperience:e.entity.selectedExperience?e.entity.selectedExperience.value:null};angular.element("#downloadDocument")[0].src="api/customer-vr-employee/export-indicators?data="+Base64.encode(JSON.stringify(n))}}]);
"use strict";app.controller("customerVrEmployeeSatisfactionIndicatorsCtrl",["$scope",function(t){t.isView=!1,t.section="list",t.date=null,t.participants=0,t.navToSection=function(i,n,a){t.section=i,"list"==i?(t.date=null,t.participants=0):(t.date=n,t.participants=a)}}]);
"use strict";app.controller("CustomerVrEmployeeSatisfactionIndicatorListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$aside","ListService","ChartService",function(t,a,i,n,e,o,r,s,c,l,u,d,p){function m(){var i=[{name:"customer_vr_employee_satisfaction_indicator_years",criteria:{customerId:a.customerId}}];d.getDataList(i).then(function(a){t.yearList=a.data.data.customerVrSatisfactionIndicatorYears,t.yearList.length&&(t.entity.year=t.yearList[0],t.reloadData())},function(a){t.status="Unable to load customer data: "+a.message})}function h(){var i=[{name:"chart_bar_with_scales_options",criteria:null},{name:"customer_vr_satisfaction_general",criteria:{customerId:a.customerId}}];p.getDataChart(i).then(function(a){t.chart.bar.options=a.data.data.chartBarOptionsWithScales,t.chart.bar.options.legend.position="right",t.chart.data.registeredVsParticipants=a.data.data.registeredVsParticipants,t.chart.data.amountBySatisfaction=a.data.data.amountBySatisfaction},function(a){t.status="Unable to load customer data: "+a.message})}t.yearList=[];var f=function(){t.entity={year:null}};t.chart={line:{options:null},doughnut:{options:null},bar:{options:null},data:{registeredVsParticipants:null,amountBySatisfaction:[]}},f(),m(),h(),t.dtInstanceCustomerVRSatisfactionList={},t.dtOptionsCustomerVRSatisfactionList=n.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(i){return i.consultantId=t.consultantId,i.customerId=a.customerId,i.year=t.entity.year.year,JSON.stringify(i)},url:"api/customer-vr-employee/satisfaction-indicator",contentType:"application/json",type:"POST"}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return null!=t.entity.year}).withOption("fnDrawCallback",function(){w()}).withPaginationType("full_numbers").withOption("createdRow",function(a){r(angular.element(a).contents())(t)}),t.dtColumnsCustomerVRSatisfactionList=[e.newColumn(null).withTitle("Acciones").withOption("width",120).notSortable().renderWith(function(t){var a="",i='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-date="'+t.date+'"  data-participants="'+t.participants+'"  >   <i class="fa fa-edit"></i></a> ';return a+=i}),e.newColumn("date").withTitle("Fecha").withOption("width",200),e.newColumn("participants").withTitle("Número de Participantes en la encuesta").withOption("width",200)];var w=function(){$("#dtCustomerVRSatisfactionList a.editRow").on("click",function(){var a=$(this).data("date"),i=$(this).data("participants");null!=t.$parent&&t.$parent.navToSection("indicators",a,i)})};t.reloadData=function(){t.dtInstanceCustomerVRSatisfactionList.reloadData()},t.onUpload=function(){var a=u.open({templateUrl:l.app.views.urlRoot+"modules/common/modals/import_modal.htm",placement:"bottom",size:"lg",backdrop:!0,controller:"ModalCustomerVRSatisfactionImportCtrl",scope:t});a.result.then(function(){m(),h()})},t.onChangeYear=function(){t.reloadData()}}]);
app.controller("ModalCustomerVRSatisfactionImportCtrl",["$rootScope","$stateParams","$scope","FileUploader","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","ngNotify","ListService",function(o,e,n,t,r,i,l,s,a,c,u,f){function m(){var o=[{name:"export_url",value:null}];f.getDataList(o).then(function(o){d=o.data.data.exportUrl.item,I.url=d+"api/v1/customer-vr-satisfaction-import",n.uploader.url=d+"api/v1/customer-vr-satisfaction-import"},function(o){n.status="Unable to load customer data: "+o.message})}var d="",p=null;n.showTemplate=!0;var I=n.uploader=new t({url:d+"api/v1/customer-vr-satisfaction-import",formData:[]});m(),n.download=function(){var o="api/customer-vr-employee/satisfaction-indicator/export-template?customerId="+e.customerId;angular.element("#downloadDocument")[0].src=o},I.filters.push({name:"customFilter",fn:function(o,e){return this.queue.length<10}}),I.onWhenAddingFileFailed=function(o,e,n){console.info("onWhenAddingFileFailed",o,e,n)},I.onAfterAddingFile=function(o){console.info("onAfterAddingFile",o)},I.onAfterAddingAll=function(o){console.info("onAfterAddingAll",o)},I.onBeforeUploadItem=function(n){console.info("onBeforeUploadItem",n);var t={customerId:e.customerId,user:o.currentUser().id};n.formData.push(t)},I.onProgressItem=function(o,e){console.info("onProgressItem",o,e)},I.onProgressAll=function(o){console.info("onProgressAll",o)},I.onSuccessItem=function(o,e,n,t){console.info("onSuccessItem",o,e,n,t)},I.onErrorItem=function(o,e,n,t){console.info("onErrorItem",o,e,n,t)},I.onCancelItem=function(o,e,n,t){console.info("onCancelItem",o,e,n,t)},I.onCompleteItem=function(o,e,n,t){console.info("onCompleteItem",o,e,n,t),p=e},I.onCompleteAll=function(){console.info("onCompleteAll"),r.close(p)}}]);
"use strict";app.controller("CustomerVrEmployeeSatisfactionIndicatorIndicatorsCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","ChartService",function(t,n,a,i,o,e,r,s){function c(){var a=[{name:"chart_bar_options",criteria:null},{name:"chart_pie_options",criteria:null},{name:"customer_vr_satisfaction_by_responses",criteria:{customerId:n.customerId,date:t.entity.date}}];s.getDataChart(a).then(function(n){t.chart.bar.options=n.data.data.chartBarOptions,t.chart.bar.options.legend.position="bottom",t.chart.pie.options=n.data.data.chartPieOptions,t.chart.pie.options.legend.position="bottom",t.chart.data.indicators=n.data.data.customerVrSatisfactionByResponses},function(n){t.status="Unable to load customer data: "+n.message})}var l=function(){t.entity={customerId:n.customerId,date:t.$parent.date,participants:t.$parent.participants}};t.chart={bar:{options:null},pie:{options:null},data:{indicators:null}},l(),c(),t.dtInstanceCustomerVRSatisfactionIndicators={},t.dtOptionsCustomerVRSatisfactionIndicators=i.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(n){return n.consultantId=t.consultantId,n.date=t.date,JSON.stringify(n)},url:"api/customer-vr-employee/satisfaction-indicator/valuation",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("searching",!1).withOption("ordering",!1).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(n){r(angular.element(n).contents())(t)}),t.dtColumnsCustomerVRSatisfactionIndicators=[o.newColumn("experience").withTitle("Experiencia").withOption("width",200).notSortable(),o.newColumn("valuationAvailable").withTitle("Valoración Disponible").withOption("width",200).notSortable().renderWith(function(t){var n="No",a="text-danger",i=' <i class=" fa fa-ban"></i>';return t>0&&(n="Si",a="text-success",i=' <i class=" fa fa-check-circle-o"></i>'),n+' <span class="'+a+'">'+i+"</span>"}),o.newColumn("amount").withTitle("Número de registros").withOption("width",200).notSortable()],t.onBack=function(){null!=t.$parent&&t.$parent.navToSection("list",null,null)},t.reloadData=function(){t.dtInstanceCustomerVRSatisfactionIndicators.reloadData()}}]);
"use strict";app.controller("customerJobConditionsRegisterTabsCtrl",["$scope","$rootScope","$timeout","$filter",function(t,e,n,o){t.loading=!1,t.tabname="tab1",t.activeTab=1,t.loadedOther=["tab1"],t.getView=function(e){var n=o("filter")(t.views,{name:e});return n[0]},t.switchTab=function(e){n(function(){t.tabname=e,t.loadedOther.push(e)})},t.switchSubTab=function(e){n(function(){t.subtab=e})}}]);
"use strict";app.controller("CustomerJobConditionsRegisterCtrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout","SweetAlert","ModuleListService","jobConditionRegisterNavigationService",function(o,e,t,i,n,r,s,c,d){function a(){var e=[{name:"job_condition_by_current_user"}];c.getDataList("/customer-jobconditions/config",e).then(function(e){var t=e.data.result.jobConditionByCurrentUser;t&&t.jobConditionId?(o.currentId=t.jobConditionId,d.setJobConditionId(t.jobConditionId),o.section="edit"):!t.jobConditionId&&t.employee?(d.setEmployeeTemp(t.employee),o.section="edit"):t.jobConditionId||t.employee?(o.section="list",o.currentId=0):s.swal("Advertencia!","El usuario no tiene configurado un empleado del cliente actual.","warning")},function(e){o.status="Unable to load customer data: "+e.message})}o.isView=!1,n.isCustomerUser()?a():(o.section="list",o.currentId=0),o.navToSection=function(e,t,i){r(function(){o.section=e,o.isView=t,o.currentId=i})}}]);
"use strict";app.factory("jobConditionRegisterNavigationService",function(){var n={},t=null,e=null,i=null,o=!1;return n.getJobConditionId=function(){return t},n.setJobConditionId=function(n){t=n},n.getEvaluationId=function(){return e},n.setEvaluationId=function(n){e=n},n.getEmployeeTemp=function(){return i},n.setEmployeeTemp=function(n){i=n},n.isViewRegisterEdit=function(){return o},n.setViewRegisterEdit=function(n){o=n},n});
"use strict";app.factory("jobConditionRegisterService",function(){var i={},n=null,t=[];return i.getCurrentClassification=function(){return n},i.setCurrentClassification=function(i){n=i},i.setClassifications=function(i){t=i},i.getNextClassification=function(){var i=n.index;return n=t[i+1]},i.getBeforeClassification=function(){var i=n.index;return n=t[i-1]},i.isLastClassification=function(){return n.index==t.length-1},i});
"use strict";app.controller("customerJobConditionsRegisterListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$aside","$document","ListService","$localStorage","jobConditionRegisterNavigationService",function(t,n,o,e,i,a,r,l,s,d,c,u,f,p,m,w,h,b){function g(){var n=[{name:"criteria_operators",value:null},{name:"criteria_conditions",value:null},{name:"customer_job_conditions_filter_field",value:null}];w.getDataList(n).then(function(n){t.criteria=n.data.data.criteriaOperatorList,t.conditions=n.data.data.criteriaConditionList,t.audit.fields=n.data.data.filterField},function(n){t.status="Unable to load customer data: "+n.message})}t.audit={fields:[],filters:[]},g(),t.addFilter=function(){null==t.audit.filters&&(t.audit.filters=[]),t.audit.filters.push({id:0,field:null,criteria:t.criteria.length>0?t.criteria[1]:null,condition:t.conditions.length>0?t.conditions[0]:null,value:""})},t.onFilter=function(){t.reloadData()},t.removeFilter=function(n){t.audit.filters.splice(n,1)},t.onCleanFilter=function(){t.audit.filters=[],t.reloadData()};var C="jobConditionsRegisterListCtrl-"+window.currentUser.id;t.dtInstanceJobConditionsRegister={},t.dtOptionsJobConditionsRegister=e.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(o){return angular.isDefined(t.audit)&&angular.isDefined(t.audit.filters)&&(o.filter={filters:t.audit.filters.filter(function(t){return null!=t&&null!=t.field&&null!=t.criteria}).map(function(t,n,o){return{field:t.field.name,operator:t.criteria.value,value:t.value,condition:t.condition.value}})}),o.customerId=n.customerId,JSON.stringify(o)},url:"api/customer-jobconditions",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("stateSave",!0).withOption("stateSaveCallback",function(t,n){h[C]=n}).withOption("stateLoadCallback",function(){return h[C]}).withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){v()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(n,o,e){r(angular.element(n).contents())(t)}),t.dtColumnsJobConditions=[i.newColumn(null).withTitle("Acciones").withOption("width",120).notSortable().renderWith(function(t){var n="",o="";return d.can("view_job_conditions")&&(n+='<a class="btn btn-info btn-xs viewRow lnk" href="#"  uib-tooltip="Ver" data-id="'+t.id+'" >   <em class="fa fa-eye"></em></a> '),d.can("edit_conditions_register")&&(n+='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar"  data-id="'+t.id+'"'+o+' >   <em class="fa fa-edit"></em></a> '),n}),i.newColumn("documentType").withTitle("Tipo Identificación").withOption("width",200).withOption("defaultContent",""),i.newColumn("documentNumber").withTitle("Número Identificación").withOption("width",200).withOption("defaultContent",""),i.newColumn("name").withTitle("Nombre").withOption("width",200).withOption("defaultContent",""),i.newColumn("date").withTitle("Fecha").withOption("width",200).withOption("defaultContent",""),i.newColumn("state").withTitle("Estado").withOption("width",120).renderWith(function(t){switch(t){case"EN PROCESO":var n="label-warning";break;case"COMPLETADA":var n="label-success";break;case"INICIAL":default:var n="label-info"}return'<span class="label '+n+'">'+t+"</span>"})];var v=function(){$("#dtJobConditions a.viewRow").on("click",function(){var n=$(this).data("id");b.setJobConditionId(n),b.setViewRegisterEdit(!0),t.$parent.navToSection("edit",!0,n)}),$("#dtJobConditions a.editRow").on("click",function(){var n=$(this).data("id");b.setJobConditionId(n),b.setViewRegisterEdit(!1),t.$parent.navToSection("edit",!1,n)})};t.reloadData=function(){t.dtInstanceJobConditionsRegister.reloadData()},t.onCreate=function(){null!=t.$parent&&t.$parent.navToSection("edit",!1,0)},t.onUpload=function(){var n=p.open({templateUrl:d.app.views.urlRoot+"modules/customer/job-conditions/register/import/job_condition_import_modal.htm",placement:"bottom",size:"lg",backdrop:!0,controller:"ModalJobConditionsImportCtrl",scope:t});n.result.then(function(n){n&&n.sessionId&&(d.isAuthorizationTemplate=n.isAuthorizationTemplate,d.hasCustomerEmployeeId=n.hasCustomerEmployeeId,null!=t.$parent&&t.$parent.navToSection("stagingEmployee","stagingEmployee",n.sessionId))})}}]),app.controller("ModalJobConditionsImportCtrl",["$rootScope","$stateParams","$scope","FileUploader","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","ngNotify","ListService",function(t,n,o,e,i,a,r,l,s,d,c,u){function f(){var t=[{name:"export_url",value:null}];u.getDataList(t).then(function(t){p=t.data.data.exportUrl.item,w.url=p+"api/v1/job-conditions-import",o.uploader.url=p+"api/v1/job-conditions-import"},function(t){o.status="Unable to load customer data: "+t.message})}var p="",m=null,w=o.uploader=new e({url:p+"api/v1/job-conditions-import",formData:[]});f(),o.title="Importar condiciones puestos de trabajo",o.buttonDownloadTitle="Descargar plantilla",o.download=function(){var t=n.customerId;angular.element("#downloadDocument")[0].src="api/customer-jobconditions/download-template?customerId="+t},w.filters.push({name:"customFilter",fn:function(t,n){return this.queue.length<10}}),w.onWhenAddingFileFailed=function(t,n,o){console.info("onWhenAddingFileFailed",t,n,o)},w.onAfterAddingFile=function(t){console.info("onAfterAddingFile",t)},w.onAfterAddingAll=function(t){console.info("onAfterAddingAll",t)},w.onBeforeUploadItem=function(t){console.info("onBeforeUploadItem",t);var o={id:n.customerId};t.formData.push(o)},w.onProgressItem=function(t,n){console.info("onProgressItem",t,n)},w.onProgressAll=function(t){console.info("onProgressAll",t)},w.onSuccessItem=function(t,o,e,i){console.info("onSuccessItem",t,o,e,i),n.sessionId=o.sessionId},w.onErrorItem=function(t,n,o,e){console.info("onErrorItem",t,n,o,e),l.swal("No fue posible anexar el archivo seleccionado!",n.message,"error")},w.onCancelItem=function(t,n,o,e){console.info("onCancelItem",t,n,o,e)},w.onCompleteItem=function(t,n,o,e){m=n},w.onCompleteAll=function(){i.close(m)}}]);
"use strict";app.controller("jobConditionsRegisterEditCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","ModuleListService","$aside","$localStorage","jobConditionRegisterNavigationService",function(t,e,o,n,i,a,r,l,s,d,u,c,p,w,f,m,h){t.isView=h.isViewRegisterEdit(),t.dailyList=[],t.periods=[],t.filter={selectedMonth:!1},t.hasAutoevaluations=!1;var b=function(){t.entity={id:t.$parent.currentId||0,customerId:e.customerId,employee:null,boss:null,period:null,createdBy:null}};b(),t.form={submit:function(e){if(t.Form=e,e.$valid)return void v();var o=null,n=null;for(o in e)"$"!=o[0]&&(null!==n||e[o].$valid||(n=e[o].$name),e[o].$pristine&&(e[o].$dirty=!0));angular.element(".ng-invalid[name="+n+"]").focus(),p.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e intentalo de nuevo.","error")},reset:function(){t.Form.$setPristine(!0),b()}};var v=function(){var e=JSON.stringify(t.entity),n={data:Base64.encode(e)};return c({method:"POST",url:"api/customer-jobconditions/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(e){t.entity=e.data.result,p.swal("Proceso Exitoso","Se ha almacenado correctamente la información.","success"),h.setJobConditionId(t.entity.id)})["catch"](function(t){o.error(t),p.swal("Error al guardar",t.data.message,"error")})};t.onBack=function(){null!=t.$parent&&t.$parent.navToSection("list","edition",0)};var C=function(){if(0==t.entity.id)return void(t.entity.employee=h.getEmployeeTemp());var e={},n=JSON.stringify({id:t.entity.id});return e.data=Base64.encode(n),c({method:"post",url:"api/customer-jobconditions/show",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){t.entity=e.data.result,y()})["catch"](function(t){o.error(t),p.swal("Error al consultar la información.",t.data.message,"error")})};C();var y=function(){if(0!=t.entity.id){var e=[{name:"periods",jobConditionId:t.entity.id}];w.getDataList("/customer-jobconditions/config",e).then(function(e){t.periods=e.data.result.periods,t.entity.period=t.periods.length?t.periods[0]:null,t.filter.selectedMonth=!0,t.reloadData()},function(e){t.status="Unable to load customer data: "+e.message})}};t.onSearchEmployee=function(){if(!d.isCustomerUser()){var e=f.open({templateUrl:d.app.views.urlRoot+"modules/customer/common/modals/employee_list_modal.htm",placement:"right",windowTopClass:"top-modal",size:"lg",backdrop:!0,controller:"ModalInstanceSideJobConditionsEmployeeListCtrl",scope:t});e.result.then(function(e){t.entity.employee=e.entity})}},t.onSearchBoss=function(){var e=f.open({templateUrl:d.app.views.urlRoot+"modules/customer/common/modals/employee_list_modal.htm",placement:"right",windowTopClass:"top-modal",size:"lg",backdrop:!0,controller:"ModalInstanceSideJobConditionsEmployeeListCtrl",scope:t});e.result.then(function(e){t.entity.boss=e.entity})},t.onDoSelfAssessment=function(){t.$parent.navToSection("evaluation",!1,0)};var g="jobConditionsEvaluationCtrl-"+window.currentUser.id;t.dtInstanceJobConditionsSelfEvaluationsCallback=function(e){t.dtInstanceJobConditionsSelfEvaluations=e},t.dtOptionsJobConditionsSelfEvaluations=n.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.jobConditionId=t.entity.id,e.period=t.entity.period?t.entity.period.date:null,JSON.stringify(e)},url:"api/customer-jobconditions/evaluation/",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("stateSave",!0).withOption("stateSaveCallback",function(t,e){m[g]=e}).withOption("stateLoadCallback",function(){return m[g]}).withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return t.filter.selectedMonth}).withOption("fnDrawCallback",function(e){t.hasAutoevaluations=e._iRecordsTotal>0,O()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,o,n){r(angular.element(e).contents())(t)}),t.dtColumnsJobConditionsSelfEvaluations=[i.newColumn(null).withTitle("Acciones").withOption("width",120).notSortable().renderWith(function(e){var o="",n="";return o+='<a class="btn btn-info btn-xs viewRow lnk" href="#"  uib-tooltip="Ver" data-id="'+e.id+'" >   <i class="fa fa-eye"></i></a> ',d.isCustomerUser()?e.createdBy==d.currentUser().id&&(o+='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar"  data-id="'+e.id+'"'+n+' >   <i class="fa fa-edit"></i></a> '):t.isView||(o+='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar"  data-id="'+e.id+'"'+n+' >   <i class="fa fa-edit"></i></a> '),o}),i.newColumn("date").withTitle("Fecha").withOption("width",200).withOption("defaultContent",""),i.newColumn("workmodel").withTitle("Modelo de Trabajo").withOption("width",200).withOption("defaultContent",""),i.newColumn("location").withTitle("Lugar de Trabajo").withOption("width",200).withOption("defaultContent",""),i.newColumn("occupation").withTitle("Cargo").withOption("width",200).withOption("defaultContent",""),i.newColumn("workplace").withTitle("Puesto de Trabajo").withOption("width",200).withOption("defaultContent",""),i.newColumn("risk").withTitle("Riesgo").withOption("width",120).renderWith(function(t){var e;return e="Alto"==t?"label-danger":"Medio"==t?"label-warning":"Bajo"==t?"label-success":"info",t?'<span class="label '+e+'">'+t+"</span>":""}),i.newColumn("state").withTitle("Estado").withOption("width",120).renderWith(function(t){var e="label-warning";return"Cerrado"==t&&(e="label-success"),'<span class="label '+e+'">'+t+"</span>"})];var O=function(){$("#dtJobConditionsSelfEvaluations a.viewRow").on("click",function(){var e=$(this).data("id");t.$parent.navToSection("evaluation",!0,e)}),$("#dtJobConditionsSelfEvaluations a.editRow").on("click",function(){var e=$(this).data("id");t.$parent.navToSection("evaluation",!1,e)})};t.reloadData=function(){t.dtInstanceJobConditionsSelfEvaluations.reloadData()},t.onFilterByPeriod=function(){t.reloadData()},t.onClearFilter=function(){t.entity.period=null,t.reloadData()},t.onClear=function(){t.entity.boss=null},t.hasChangeEmployee=function(){return!d.isCustomerUser()&&!t.hasAutoevaluations}}]);
app.controller("ModalInstanceSideJobConditionsEmployeeListCtrl",["$rootScope","$stateParams","$scope","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile","ListService","$aside",function(e,o,t,i,n,a,l,r,s,d,c,p,m,u,w,h){t.canCreate=!e.isCustomerUser(),t.canFilter=!1,t.employee={id:0},t.onCloseModal=function(){i.close(t.employee)},t.onCancel=function(){i.dismiss("cancel")},t.onLoadRecord=function(){if(0==t.employee.id)return void(t.loading=!1);var e={id:t.employee.id};r({method:"GET",url:"api/customer-employee",params:e})["catch"](function(e,o){if(403==o){var t=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";l.swal("No Autorizado","No estas autorizado para ver esta información.","error"),a(function(){$state.go(t)})}else 404==o?l.swal("Información no disponible","Diagnóstico no encontrado","error"):l.swal("Error","Se ha presentado un error al intentar acceder a la información del proceso","error")}).then(function(e){a(function(){t.employee=e.data.result})})["finally"](function(){a(function(){t.onCloseModal()},400)})},t.dtInstanceModalEmployeeList={},t.dtOptionsModalEmployeeList=m.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerId=o.customerId,JSON.stringify(e)},url:"api/customer-employee-modal-basic",contentType:"application/json",type:"POST"}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){f()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,o,i){u(angular.element(e).contents())(t)}),t.dtColumnsModalEmployeeList=[p.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,o,t,i){var n="";return'<a class="btn btn-success btn-xs editRow lnk" href="#" uib-tooltip="Adicionar empleado" tooltip-placement="right"  data-id="'+e.id+'"'+n+' >   <i class="fa fa-plus-square"></i></a> '}),p.newColumn("documentNumber").withTitle("Número Identificación").withOption("width",200),p.newColumn("firstName").withTitle("Nombre").withOption("width",200),p.newColumn("lastName").withTitle("Apellidos").withOption("width",200),p.newColumn("workPlace").withTitle("Centro Trabajo").withOption("width",200),p.newColumn("job").withTitle("Cargo").withOption("width",200)];var f=function(){angular.element("#dtModalEmployeeList a.editRow").on("click",function(){var e=angular.element(this).data("id");t.editModalEmployeeList(e)})};t.reloadData=function(){t.dtInstanceModalEmployeeList.reloadData()},t.viewModalEmployeeList=function(e){t.employee.id=e,t.isView=!0,t.onLoadRecord()},t.editModalEmployeeList=function(e){t.employee.id=e,t.isView=!1,t.onLoadRecord()},t.onCreate=function(){var o=h.open({templateUrl:e.app.views.urlRoot+"modules/customer/common/modals/employee_create_modal.htm",placement:"right",windowTopClass:"top-modal",size:"lg",backdrop:!0,controller:"ModalInstanceSideJobConditionsEmployeeCreateCtrl",scope:t});o.result.then(function(e){t.reloadData()})}}]);
app.controller("ModalInstanceSideJobConditionsEmployeeCreateCtrl",["$scope","$stateParams","$log","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$document","$uibModalInstance","$aside","$filter",function(e,o,t,r,a,n,i,l,s,c,d,u,p){var m=null;e.genders=n.parameters("gender"),e.documentTypes=n.parameters("employee_document_type"),e.showWorkplaces=!0,e.job=!0;var f=function(){e.employee={id:0,customerId:o.customerId,isActive:!1,contractType:null,occupation:"",job:null,workPlace:null,salary:0,isAuthorized:!1,entity:{id:0,documentType:null,documentNumber:"",expeditionPlace:"",expeditionDate:"",firstName:"",lastName:"",birthDate:"",gender:null,profession:null,eps:null,afp:null,arl:null,country:null,state:null,city:null,rh:"",riskLevel:0,neighborhood:"",observation:"",logo:"",details:[],isActive:!1,age:null},validityList:[]},m&&m.$setPristine(!0)};f();var v=function(){var t={};return t.operation="diagnostic",t.customerId=o.customerId,l({method:"POST",url:"api/customer/config-sgsst/workplace/listProcess",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(o){e.workPlaces=o.data.data})};v(),e.onSearchJob=function(){if(!e.employee.workPlace)return void r.pop("error","Validación","Debe seleccionar un centro de trabajo válido");var o=u.open({templateUrl:n.app.views.urlRoot+"modules/common/modals/data_table_list_modal.htm",placement:"right",windowTopClass:"top-modal",size:"md",backdrop:"static",resolve:{workPlace:function(){return e.employee.workPlace}},controller:"ModalInstanceSideCustomerJobConditionsJobsListCtrl",scope:e});o.result.then(function(o){void 0!==e.jobs&&null!=e.jobs||(e.jobs=[]);var t=p("filter")(e.jobs,{id:o.id});0==t.length&&e.jobs.push(o),e.employee.job=o,e.changeJob()})},e.changeJob=function(o,a){i(function(){if(null!=e.employee.job&&0!=e.employee.id){var o={};return o.id=e.employee.id,o.job_id=e.currentJobId,l({method:"POST",url:"api/customer-employee/critical-activity/duplicate",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(o){y(),e.reloadData()})["catch"](function(e){t.error(e),r.pop("error","Error","Error guardando el registro. Por favor verifique los datos ingresados!")})}},400)};var y=function(){if(null!=e.employee.job){var o={};return o.operation="diagnostic",o.customerId=e.customerId,o.jobId=e.employee.job.id,o.id=e.employee.id,l({method:"POST",url:"api/customer-employee/critical-activity/list",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(o){i(function(){e.activities=o.data.data})})}e.activities=[]};e.form={submit:function(e){m=e;var o=null;if(e.$invalid){var t=null,o=null;for(t in e)"$"!=t[0]&&(null!==o||e[t].$valid||(o=e[t].$name),e[t].$pristine&&(e[t].$dirty=!0));return angular.element(".ng-invalid[name="+o+"]").focus(),void s.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}b()}};var b=function(){var o={},t=JSON.stringify(e.employee);return o.data=Base64.encode(t),l({method:"POST",url:"api/customer-employee/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(o){i(function(){s.swal("Registro","La información ha sido guardada satisfactoriamente","success"),d.close(e.employee)})})["catch"](function(e){s.swal("Error de guardado",e.data.message,"error")})};e.onCancel=function(){d.dismiss("cancel")}}]);
app.controller("ModalInstanceSideCustomerJobConditionsJobsListCtrl",["$rootScope","$stateParams","$scope","workPlace","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile",function(t,n,o,i,a,e,l,s,r,c,u,d,p,w,m){o.title="CARGOS DISPONIBLES",o.entity={},o.onCloseModal=function(){a.close(o.entity)},o.onCancel=function(){a.dismiss("cancel")};var f=function(t){if(0!=t){var n={id:t};r({method:"GET",url:"api/customer-config-job",params:n}).then(function(t){l(function(){o.entity=t.data.result})})["finally"](function(){l(function(){o.onCloseModal()},400)})}else o.loading=!1};o.dtInstanceCommonDataTableList={},o.dtOptionsCommonDataTableList=w.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.customerId=n.customerId,t.workPlaceId=i.id,JSON.stringify(t)},url:"api/customer-config-job",contentType:"application/json",type:"POST"}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){h()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,n,i){m(angular.element(t).contents())(o)}),o.dtColumnsCommonDataTableList=[p.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,n,o,i){var a="";return'<a class="btn btn-success btn-xs editRow lnk" href="#" uib-tooltip="Adicionar"  data-id="'+t.id+'"'+a+' >   <i class="fa fa-plus-square"></i></a> '}),p.newColumn("work_place").withTitle("Centro de Trabajo").withOption("width",200),p.newColumn("macro_process").withTitle("Macro Proceso"),p.newColumn("process").withTitle("Proceso"),p.newColumn("job").withTitle("Cargo")];var h=function(){$("#dtCommonDataTableList a.editRow").on("click",function(){var t=$(this).data("id");f(t)})};o.dtInstanceCommonDataTableListCallback=function(t){o.dtInstanceCommonDataTableList=t},o.reloadData=function(){o.dtInstanceCommonDataTableList.reloadData()}}]);
"use strict";app.controller("customerJobConditionsEvaluationEditCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","ListService","ModuleListService","$aside","$filter","jobConditionRegisterNavigationService","jobConditionRegisterService",function(t,o,e,a,n,i,r,s,c,l,u,d,p,m,f,v,w,g,y){function C(){var e=[{name:"occupations",customerId:o.customerId},{name:"workplaces"}];0==t.entity.id&&e.push({name:"occupationEmployee",jobConditionId:g.getJobConditionId()}),f.getDataList("/customer-jobconditions/config",e).then(function(o){var e=o.data.result;t.workplaceList=e.workplaces,t.occupationList=e.occupations,e.occupationEmployee&&(t.entity.occupation=e.occupationEmployee)},function(o){t.status="Unable to load customer data: "+o.message})}function b(){var o=[{name:"classifications",evaluationId:t.entity.id}];f.getDataList("/customer-jobconditions/config",o).then(function(o){t.classificationList=o.data.result.classifications,y.setClassifications(t.classificationList),h()},function(o){t.status="Unable to load customer data: "+o.message})}function h(){var o=JSON.stringify({id:t.entity.id}),a={data:Base64.encode(o)};d({method:"POST",url:"api/customer-jobconditions/evaluation/stats",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(o){t.statsEvaluation.percent=o.data.result.percent,t.statsEvaluation.countAnswers=o.data.result.countAnswers,t.statsEvaluation.countQuestions=o.data.result.countQuestions})["catch"](function(t){e.error(t),p.swal("Error al obtener las estadísticas",t.data.message,"error")})}t.isView=t.$parent.isView,t.statsEvaluation={percent:0,countAnswers:0,countQuestions:0},t.workplaceList=[],t.occupationList=[],t.classificationList=[],t.workModelList=l.parameters("wg_customer_job_conditions_work_model"),t.locationList=l.parameters("wg_customer_job_conditions_location"),t.stateSaved=null,t.datePickerConfig={culture:"es-CO",format:"dd/MM/yyyy"},t.options={unit:"%",readOnly:!0,displayPrevious:!0,barCap:25,trackWidth:20,barWidth:20,trackColor:"rgba(92,184,92,.1)",barColor:"#5BC01E",textColor:"#000"};var E=function(){t.entity={id:t.$parent.currentId||0,jobConditionId:g.getJobConditionId(),date:null,workModel:null,location:null,occupation:null,workplace:null,state:!0}};E(),t.$on("$destroy",function(o){console.log("pasa por acá"),t.options=null,t.statsEvaluation=null}),C(),t.form={submit:function(o){if(t.Form=o,o.$valid)return void S();var e=null,a=null;for(e in o)"$"!=e[0]&&(null!==a||o[e].$valid||(a=o[e].$name),o[e].$pristine&&(o[e].$dirty=!0));angular.element(".ng-invalid[name="+a+"]").focus(),p.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e intentalo de nuevo.","error")},reset:function(){t.Form.$setPristine(!0),E()}};var S=function(){var o=JSON.stringify(t.entity),a={data:Base64.encode(o)};return d({method:"POST",url:"api/customer-jobconditions/evaluation/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(o){t.entity=o.data.result,t.stateSaved=t.entity.state,g.setEvaluationId(t.entity.id),p.swal("Proceso Exitoso","Se ha almacenado correctamente la información.","success"),b()})["catch"](function(t){e.error(t),p.swal("Error al guardar",t.data.message,"error")})};t.onBack=function(){null!=t.$parent&&t.$parent.navToSection("edit",t.$parent.isView,g.getJobConditionId())};var k=function(){if(0!=t.entity.id){var o={},a=JSON.stringify({id:t.entity.id});return o.data=Base64.encode(a),d({method:"post",url:"api/customer-jobconditions/evaluation/show",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(o){t.entity=o.data.result,t.stateSaved=t.entity.state,g.setEvaluationId(t.entity.id),b()})["catch"](function(t){e.error(t),p.swal("Error al consultar la información.",t.data.message,"error")})}};t.onAnswerQuestions=function(o){if(!("pending"==o.answered&&o.index>0)){y.setCurrentClassification(o);var e=t.isView;0==t.stateSaved&&(e=!0);var a=v.open({templateUrl:l.app.views.urlRoot+"modules/customer/job-conditions/register/evaluation/evaluation_modal.htm",placement:"right",windowTopClass:"top-modal",size:"lg",backdrop:"static",controller:"customerJobConditionsEvaluationModalCtrl",scope:t,resolve:{dataSource:{isView:e}}});a.result.then(function(){e||(b(),h())})}},k()}]);
"use strict";app.controller("customerJobConditionsEvaluationModalCtrl",["$rootScope","$stateParams","$scope","$log","$timeout","$uibModalInstance","SweetAlert","$http","toaster","$filter","$compile","$aside","jobConditionRegisterNavigationService","jobConditionRegisterService","FileUploader","dataSource",function(o,e,n,i,t,a,s,r,l,c,u,d,f,m,g,p){function b(){1==n.goToBefore?n.loadDataBeforeClassification():n.isLast?(n.isView||s.swal("Registro","La información ha sido guardada satisfactoriamente","success"),a.close(1)):n.loadNextClassification()}n.data=m.getCurrentClassification(),n.answerOptions=o.parameters("wg_customer_job_conditions_answer_types"),n.isView=p.isView,n.goToBefore=!1;var v=n.uploader=new g({url:"api/customer-jobconditions/evaluation/evidence/upload",formData:[],removeAfterUpload:!0,queueLimit:5});n.conf={imgAnim:"fadeup"},v.filters.push({name:"imageFilter",fn:function(o,e){var n="|"+o.type.slice(o.type.lastIndexOf("/")+1)+"|";return"|jpg|png|jpeg|bmp|gif|".indexOf(n)!==-1}});var h=function(){n.entity={classificationId:n.data.id,evaluationId:f.getEvaluationId(),questionList:[],images:[]},n.isLast=m.isLastClassification()};h(),n.onChangeAnswer=function(){n.entity.questionList[0]&&(n.nextEnable=!n.entity.questionList[0].questions.some(function(o){return null===o.answer}))},n.loadQuestions=function(){var o=JSON.stringify(n.entity),e={data:Base64.encode(o)};r({method:"post",url:"api/customer-jobconditions/evaluation/get-questions",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(o){n.entity.questionList=o.data.result,n.onChangeAnswer()})["catch"](function(o){s.swal("Error","Ocurrió un problema cargar la información.","error")})},n.loadEvidences=function(){var o=JSON.stringify(n.entity),e={data:Base64.encode(o)};r({method:"post",url:"api/customer-jobconditions/evaluation/evidences",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(o){n.entity.images=o.data.result,v.queueLimit=5-n.entity.images.length})["catch"](function(o){s.swal("Error","Ocurrió un problema cargar la información.","error")})};var w=function(){n.loadQuestions(),n.loadEvidences(),n.goToBefore=!1};w(),n.form={submit:function(o){if(n.isView)return void b();if(o.$invalid){var e=null,i=null;for(e in o)"$"!=e[0]&&(null!==i||o[e].$valid||(i=o[e].$name),o[e].$pristine&&(o[e].$dirty=!0));return angular.element(".ng-invalid[name="+i+"]").focus(),void s.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}y()}};var y=function(){var o={},e=JSON.stringify(n.entity);return o.data=Base64.encode(e),r({method:"POST",url:"api/customer-jobconditions/evaluation/save-answers",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(o){t(function(){b()})})["catch"](function(o){i.error(o),s.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})};n.loadNextClassification=function(){n.data=m.getNextClassification(),h(),w()},n.loadBeforeClassification=function(){return n.goToBefore=!0,n.isView?void n.loadDataBeforeClassification():void n.form.submit(angular.element("form"))},n.loadDataBeforeClassification=function(){n.data=m.getBeforeClassification(),h(),w()},n.onClose=function(){n.isView||(n.form.submit(angular.element("form")),s.swal("Registro","La información ha sido guardada satisfactoriamente","success")),a.close(1)},n.onUploadEvidences=function(){v.uploadAll()},n.onDownload=function(){var o={evaluationId:n.entity.evaluationId,classificationId:n.entity.classificationId};angular.element("#download")[0].src="api/customer-jobconditions/evaluation/evidence/download?data="+Base64.encode(JSON.stringify(o))},v.onWhenAddingFileFailed=function(o,e,n){console.info("onWhenAddingFileFailed",o,e,n)},v.onAfterAddingFile=function(o){console.info("onAfterAddingFile",o)},v.onAfterAddingAll=function(o){console.info("onAfterAddingAll",o)},v.onBeforeUploadItem=function(o){console.info("onBeforeUploadItem",o);var e={classificationId:n.entity.classificationId,evaluationId:f.getEvaluationId()};o.formData.push(e)},v.onProgressItem=function(o,e){console.info("onProgressItem",o,e)},v.onProgressAll=function(o){console.info("onProgressAll",o)},v.onSuccessItem=function(o,e,n,i){console.info("onSuccessItem",o,e,n,i)},v.onErrorItem=function(o,e,n,i){console.info("onErrorItem",o,e,n,i)},v.onCancelItem=function(o,e,n,i){console.info("onCancelItem",o,e,n,i)},v.onCompleteItem=function(o,e,n,i){console.info("onCompleteItem",o,e,n,i)},v.onCompleteAll=function(){console.info("onCompleteAll"),n.loadEvidences(),l.pop("success","Operación exitosa","Se subío correctamente la imagen")},n.addPhoto=function(){var o=Math.floor(13*Math.random())+1,e=Math.floor(9999999999*Math.random())+1;n.images.push({id:e,url:"https://thatisuday.github.io/ng-image-gallery/demo-images/"+o+".jpg",thumbUrl:"https://thatisuday.github.io/ng-image-gallery/demo-images/thumbs/"+o+".jpg",bubbleUrl:"https://thatisuday.github.io/ng-image-gallery/demo-images/bubbles/"+o+".jpg"})},n.removePhoto=function(){n.images.length>1&&n.images.pop()},n.thumbnails=!0,n.toggleThumbnails=function(){n.thumbnails=!n.thumbnails},n.inline=!1,n.toggleInline=function(){n.inline=!n.inline},n.bubbles=!0,n.toggleBubbles=function(){n.bubbles=!n.bubbles},n.imgBubbles=!1,n.toggleImgBubbles=function(){n.imgBubbles=!n.imgBubbles},n.bgClose=!1,n.closeOnBackground=function(){n.bgClose=!n.bgClose},n.methods={},n.openGallery=function(){n.methods.open()},n.opened=function(){console.info("Gallery opened!")},n.closed=function(){console.warn("Gallery closed!")},n["delete"]=function(o,e){}}]);
"use strict";app.controller("JobConditionStagingListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$document","$filter","$aside","ListService","$localStorage",function(t,o,n,e,i,a,r,l,s,d,c,u,m,p,f,w,h,g){function C(){var o=[{name:"export_url",value:null}];h.getDataList(o).then(function(t){b=t.data.data.exportUrl.item},function(o){t.status="Unable to load customer data: "+o.message})}var b="";C();var v="jobConditionsStagingListCtrl-"+window.currentUser.id;t.dtInstanceJobConditionStaging={},t.dtOptionsJobConditionStaging=e.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(n){return angular.isDefined(t.audit)&&angular.isDefined(t.audit.filters)&&(n.filter={filters:t.audit.filters.filter(function(t){return null!=t&&null!=t.field&&null!=t.criteria}).map(function(t,o,n){return{field:t.field.name,operator:t.criteria.value,value:t.value,condition:t.condition.value}})}),n.customerId=o.customerId,n.sessionId=o.sessionId,JSON.stringify(n)},url:"api/job-conditions-staging",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("stateSave",!0).withOption("stateSaveCallback",function(t,o){g[v]=o}).withOption("stateLoadCallback",function(){return g[v]}).withOption("order",[[1,"asc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){y()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(o,n,e){r(angular.element(o).contents())(t)}),t.dtColumnsJobConditionStagingDT=[i.newColumn(null).withTitle("Acciones").withOption("width",120).notSortable().renderWith(function(t){var o="",n='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar"  data-id="'+t.id+'"'+o+' >   <i class="fa fa-edit"></i></a> ',e=0!=t.isValid&&t.isValid?"":n;return e}),i.newColumn(null).withTitle("Fila").withOption("width",50).renderWith(function(t,o,n,e){if(1==t.isValid)var i="badge badge-success",a=' | <i class=" fa fa-check"></i>',r="Es correcto";else var i="badge badge-danger",a=' | <i class=" fa fa-ban"></i>',r=t.errors;return'<span uib-tooltip="'+r+'" class="'+i+'">'+t.index+a+"</span>"}),i.newColumn("documentType").withTitle("Tipo Identificación").withOption("width",200).withOption("defaultContent",""),i.newColumn("document_number").withTitle("Número Identificación").withOption("width",200).withOption("defaultContent",""),i.newColumn("registrationDate").withTitle("Fecha").withOption("width",200).withOption("defaultContent",""),i.newColumn("workmodel").withTitle("Modelo de trabajo").withOption("width",200).withOption("defaultContent",""),i.newColumn("location").withTitle("Lugar de trabajo").withOption("width",200).withOption("defaultContent",""),i.newColumn("job").withTitle("Cargo").withOption("width",200).withOption("defaultContent",""),i.newColumn("workplace").withTitle("Puesto de trabajo").withOption("width",200).withOption("defaultContent","")];var y=function(){angular.element("#dataJobConditionStagingDT a.editRow").on("click",function(){var t=angular.element(this).data("id");O(t)})};t.reloadData=function(){t.dtInstanceJobConditionsRegister.reloadData()},t.onCreate=function(){null!=t.$parent&&t.$parent.navToSection("edit",!1,0)},t.dtInstanceEmployeeStagingDTCallback=function(o){t.dtInstanceJobConditionStaging=o},t.reloadData=function(){t.dtInstanceJobConditionStaging.reloadData()};var O=function(o){var n=w.open({templateUrl:d.app.views.urlRoot+"modules/customer/job-conditions/register/import/job_condition_staging_modal.htm",placement:"right",windowTopClass:"top-modal",size:"lg",backdrop:!0,controller:"ModalInstanceSideJobConditionsStagingEditCtrl",scope:t,resolve:{dataItem:function(){return{id:o?o:0}},isView:function(){return t.isView}}});n.result.then(function(){t.reloadData()},function(){t.reloadData()})};t.onCancel=function(){null!=t.$parent&&t.$parent.navToSection("list","list")},t.onProcess=function(){m.swal({title:"Confirma la importación de los registros?",text:"Se importarán los registros válidos. Una vez realizado este proceso no se podrán realizar cambios.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, confirmar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(e){if(e)return u({method:"POST",url:b+"api/v1/job-conditions-import/confirm",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param({id:o.customerId,sessionId:o.sessionId,hasCustomerEmployeeId:d.hasCustomerEmployeeId})}).then(function(o){c(function(){m.swal("Registro","La información ha sido importada satisfactoriamente","success"),t.onCancel()})})["catch"](function(t){n.error(t),m.swal("Error de guardado",t.data.message,"error")})["finally"](function(){})})}}]),app.controller("ModalInstanceSideJobConditionsStagingEditCtrl",["$rootScope","$stateParams","$scope","dataItem","isView","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","ngNotify","$document","$filter","$aside","ListService",function(t,o,n,e,i,a,r,l,s,d,c,u,m,p,f,w){function h(){var t={customerId:o.customerId},e=[{name:"customer_job",value:o.customerId,criteria:t},{name:"workplaces"}];w.getDataList(e).then(function(t){n.jobs=t.data.data.jobList},function(t){n.status="Unable to load customer data: "+t.message})}n.onCloseModal=function(){a.close(null)},n.onCancel=function(){a.dismiss("cancel")};var g=r;n.employee=[],n.workplaceList=[],n.documentTypes=t.parameters("employee_document_type"),n.modelWork=t.parameters("wg_customer_job_conditions_work_model"),n.location=t.parameters("wg_customer_job_conditions_location"),n.jobs=[],n.showAuthorized=t.isAuthorizationTemplate&&t.can("empleado_authorize"),n.maxDate=new Date,n.datePickerConfig={format:"dd/MM/yyyy"};var C=function(){n.employee={id:e.id,index:null,customerId:null,documentType:null,documentNumber:null,registrationDate:null,workmodel:null,location:null,job:null,workplace:null,sessionId:null,isActive:null,isAuthorized:null,errors:null,isView:!1}};C(),h(),n.onSearchEmployee=function(){var o=f.open({templateUrl:t.app.views.urlRoot+"modules/customer/common/modals/employee_list_modal.htm",placement:"right",windowTopClass:"top-modal",size:"lg",backdrop:!0,controller:"ModalInstanceSideJobConditionsStagingEmployeeListCtrl",jobConditios:"1",scope:n});o.result.then(function(t){n.employee.documentNumber=t.entity.documentNumber,n.employee.documentType=t.entity.documentType})},n.onLoadRecord=function(){0!=n.employee.id&&d({method:"GET",url:"api/job-conditions-staging/get",params:{id:n.employee.id}})["catch"](function(t,o){}).then(function(t){l(function(){n.employee=t.data.result})})["finally"](function(){})},n.onLoadRecord(),n.form={submit:function(t){var o=null;if(t.$invalid){var e=null,o=null;for(e in t)"$"!=e[0]&&(null!==o||t[e].$valid||(o=t[e].$name),t[e].$pristine&&(t[e].$dirty=!0));return g.info(n.employee),angular.element(".ng-invalid[name="+o+"]").focus(),void s.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}b()},reset:function(t){}};var b=function(){var t={},o=JSON.stringify(n.employee);return t.data=Base64.encode(o),d({method:"POST",url:"api/job-conditions-staging/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){l(function(){s.swal("Registro","La información ha sido guardada satisfactoriamente","success"),n.onCloseModal()})})["catch"](function(t){r.error(t),s.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})}}]);
app.controller("ModalInstanceSideJobConditionsStagingEmployeeListCtrl",["$rootScope","$stateParams","$scope","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile",function(e,t,o,i,n,a,l,r,s,d,c,p,u,m){o.canCreate=!1,o.title="Listado Empleados",o.canFilter=!1,o.employee={id:0},o.onCloseModal=function(){i.close(o.employee)},o.onCancel=function(){i.dismiss("cancel")},o.onLoadRecord=function(){if(0==o.employee.id)return void(o.loading=!1);var e={id:o.employee.id};r({method:"GET",url:"api/customer-employee",params:e})["catch"](function(e,t){if(403==t){var o=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";l.swal("No Autorizado","No estas autorizado para ver esta información.","error"),a(function(){$state.go(o)})}else 404==t?l.swal("Información no disponible","Empleado no encontrado","error"):l.swal("Error","Se ha presentado un error al intentar acceder a la información del proceso","error")}).then(function(e){a(function(){o.employee=e.data.result})})["finally"](function(){a(function(){o.onCloseModal()},400)})},o.dtInstanceModalEmployeeList={},o.dtOptionsModalEmployeeList=u.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerId=t.customerId,JSON.stringify(e)},url:"api/customer-employee-modal-basic",contentType:"application/json",type:"POST"}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){w()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,t,i){m(angular.element(e).contents())(o)}),o.dtColumnsModalEmployeeList=[p.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,t,o,i){var n="";return'<a class="btn btn-success btn-xs editRow lnk" href="#" uib-tooltip="Adicionar empleado" tooltip-placement="right"  data-id="'+e.id+'"'+n+' >   <i class="fa fa-plus-square"></i></a> '}),p.newColumn("documentNumber").withTitle("Número Identificación").withOption("width",200),p.newColumn("firstName").withTitle("Nombre").withOption("width",200),p.newColumn("lastName").withTitle("Apellidos").withOption("width",200),p.newColumn("workPlace").withTitle("Centro Trabajo").withOption("width",200),p.newColumn("job").withTitle("Cargo").withOption("width",200)];var w=function(){angular.element("#dtModalEmployeeList a.editRow").on("click",function(){var e=angular.element(this).data("id");o.editModalEmployeeList(e)})};o.reloadData=function(){o.dtInstanceModalEmployeeList.reloadData()},o.editModalEmployeeList=function(e){o.employee.id=e,o.isView=!1,o.onLoadRecord()}}]);
"use strict";app.controller("CustomerJobConditionsIndicatorCtrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout",function(o,t,i,n,e,c){o.isView=!1,o.section="dashboard",o.currentId=0,o.navToSection=function(t,i,n){c(function(){o.section=t,o.isView=i,o.currentId=n})}}]);
"use strict";app.controller("jobConditionsIndicatorDashboardCtrl",["$scope","$stateParams","$log","$compile","toaster","$state","$rootScope","$timeout","$http","ngNotify","SweetAlert","$aside","CustomerJobConditionsIndicatorService",function(t,e,o,n,a,i,r,l,c,s,d,u,m){function p(){var e=JSON.stringify({evaluationId:t.entity.location.evaluationId}),n={data:Base64.encode(e)};return c({method:"POST",url:"api/customer-jobconditions/indicators/get-indicator-by-evaluation",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(e){t.evaluation=e.data.result})["catch"](function(t){o.error(t),d.swal("Error al consultar",t.data.message,"error")})}function f(n){var a=JSON.stringify({customerId:e.customerId,employeeId:t.entity.employee.id}),i={data:Base64.encode(a)};return c({method:"POST",url:"api/customer-jobconditions/indicators/get-dates-evaluations-by-employees",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(e){t.dateList=e.data.result,1==t.dateList.length&&(t.entity.date=t.dateList[0]),n?t.locationList=t.entity.date.locations:t.onChangeDate()})["catch"](function(t){o.error(t),d.swal("Error al consultar",t.data.message,"error")})}t.dateList=[],t.locationList=[],t.evaluation={},t.datePickerConfig={culture:"es-CO",format:"dd/MM/yyyy"};var y=function(){var o=m.getFilters();o?(t.entity=o,f(!0),p()):t.entity={customerId:e.customerId,employee:null,date:null,location:null}};y(),t.form={submit:function(e){if(t.Form=e,e.$valid)return void p();var o=null,n=null;for(o in e)"$"!=o[0]&&(null!==n||e[o].$valid||(n=e[o].$name),e[o].$pristine&&(e[o].$dirty=!0));angular.element(".ng-invalid[name="+n+"]").focus(),d.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e intentalo de nuevo.","error")},reset:function(){t.Form.$setPristine(!0),y()}},t.onSearchEmployee=function(){var e=u.open({templateUrl:r.app.views.urlRoot+"modules/customer/common/modals/employee_list_modal.htm",placement:"right",windowTopClass:"top-modal",size:"lg",backdrop:!0,controller:"ModalInstanceSideJobConditionsIndicatorEmployeeListCtrl",scope:t});e.result.then(function(e){t.entity.employee=e.entity,t.entity.date=null,t.entity.location=null,t.evaluation.id="",f(!1)})},t.onChangeDate=function(){t.entity.date&&(t.evaluation.id="",t.locationList=t.entity.date.locations,1==t.locationList.length?(t.entity.location=t.locationList[0],t.onChangeLocation()):t.entity.location=null)},t.onChangeLocation=function(){t.entity.location&&(t.evaluation.id="")},t.clear=function(){t.evaluation.id=""},t.onGoToGeneralIndicators=function(){null!=t.$parent&&t.$parent.navToSection("indicators","list",0)},t.onGoToInterventionPlans=function(e,o){m.setFilters(t.entity),m.setEvaluationId(e),m.setClassificationId(o),null!=t.$parent&&t.$parent.navToSection("intervention","edit",0)},t.onGoToBoardGeneral=function(){null!=t.$parent&&t.$parent.navToSection("general","edit",0)},t.onExportPdf=function(t,e){console.log(t.employee.fullName),kendo.drawing.drawDOM($(".job-conditions-export-pdf")).then(function(t){return kendo.drawing.exportPDF(t,{paperSize:"auto",margin:{left:"1cm",top:"1cm",right:"1cm",bottom:"1cm"}})}).done(function(e){kendo.saveAs({dataURI:e,fileName:"TABLERO_DE_CONDICIONES_INSEGURAS_"+t.employee.fullName+".pdf",proxyURL:"//demos.telerik.com/kendo-ui/service/export"})})},t.onExportExcel=function(t){s.set("El archivo se está generando.",{position:"bottom",sticky:!0,type:"warning",button:!0,html:!0});var e={customerId:t.customerId,employeeId:t.employee.id,date:t.date.date,location:t.location.value,isHistorical:0},o={},n=JSON.stringify(e);o.data=Base64.encode(n),c({method:"POST",url:"api/customer-jobconditions/indicators/export-excel",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(t){angular.element("#downloadHazardExcel")[0].src="api/customer-jobconditions/indicators/export-excel?data="+Base64.encode(n),s.set("Se genero correctamente el archivo",{position:"bottom",sticky:!0,type:"success",button:!0,html:!0})})["catch"](function(t){s.set("No se cuenta con información para generar el reporte",{position:"bottom",sticky:!1,type:"warning",button:!1,html:!0})})["finally"](function(){})}}]);
app.controller("ModalInstanceSideJobConditionsIndicatorEmployeeListCtrl",["$rootScope","$stateParams","$scope","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile",function(e,t,o,i,n,a,l,r,s,d,c,p,u,m){o.canCreate=!1,o.title="Listado Empleados",o.canFilter=!1,o.employee={id:0},o.onCloseModal=function(){i.close(o.employee)},o.onCancel=function(){i.dismiss("cancel")},o.onLoadRecord=function(){if(0==o.employee.id)return void(o.loading=!1);var e={id:o.employee.id};r({method:"GET",url:"api/customer-employee",params:e})["catch"](function(e,t){if(403==t){var o=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";l.swal("No Autorizado","No estas autorizado para ver esta información.","error"),a(function(){$state.go(o)})}else 404==t?l.swal("Información no disponible","Empleado no encontrado","error"):l.swal("Error","Se ha presentado un error al intentar acceder a la información del proceso","error")}).then(function(e){a(function(){o.employee=e.data.result})})["finally"](function(){a(function(){o.onCloseModal()},400)})},o.dtInstanceModalEmployeeList={},o.dtOptionsModalEmployeeList=u.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.customerId=t.customerId,e.jobConditions=!0,JSON.stringify(e)},url:"api/customer-employee-modal-basic",contentType:"application/json",type:"POST"}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){w()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,t,i){m(angular.element(e).contents())(o)}),o.dtColumnsModalEmployeeList=[p.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,t,o,i){var n="";return'<a class="btn btn-success btn-xs editRow lnk" href="#" uib-tooltip="Adicionar empleado" tooltip-placement="right"  data-id="'+e.id+'"'+n+' >   <i class="fa fa-plus-square"></i></a> '}),p.newColumn("documentNumber").withTitle("Número Identificación").withOption("width",200),p.newColumn("firstName").withTitle("Nombre").withOption("width",200),p.newColumn("lastName").withTitle("Apellidos").withOption("width",200),p.newColumn("workPlace").withTitle("Centro Trabajo").withOption("width",200),p.newColumn("job").withTitle("Cargo").withOption("width",200)];var w=function(){angular.element("#dtModalEmployeeList a.editRow").on("click",function(){var e=angular.element(this).data("id");o.editModalEmployeeList(e)})};o.reloadData=function(){o.dtInstanceModalEmployeeList.reloadData()},o.editModalEmployeeList=function(e){o.employee.id=e,o.isView=!1,o.onLoadRecord()}}]);
"use strict";app.controller("CustomerJobConditionsIndicatorInterventionCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","CustomerJobConditionsIndicatorService",function(t,e,n,i,o,r,s,a,c,l,u,d,f,v){t.currentIndex=0,t.filter={view:"C"},v.setView(t.filter.view);var I=function(){t.entity={evaluationId:v.getEvaluationId(),classificationId:v.getClassificationId(),customerId:e.customerId,classification:null,questions:[]}};I(),t.$on("refreshQuestions",function(t){m()});var m=function(){l.$emit("clearIntervention",{message:"onClearIntervention"});var e={id:t.entity.id,evaluationId:t.entity.evaluationId,classificationId:t.entity.classificationId,isHistorical:"H"===t.filter.view},n=JSON.stringify(e),i={data:Base64.encode(n)};d({method:"POST",url:"api/customer-jobconditions/intervention/",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(e){u(function(){var n=e.data.result;t.entity.questions=n,v.setQuestions(n),n.length>0&&(t.entity.classification=t.entity.questions[0].classification,t.onSelectQuestion(n[0],0))})})["catch"](function(t){f.swal("Error de guardado","Error al consultar el registro. Por favor verifique los datos ingresados!","error")})};m(),t.onSelectQuestion=function(e,n){t.currentIndex=n,v.setCurrentQuestion(e),l.$emit("selectQuestion")},t.onChangeView=function(){t.currentIndex=-1,v.setView(t.filter.view),m()},t.onBack=function(){null!=t.$parent&&t.$parent.navToSection("dashboard","list",0)};var C=l.$on("refreshHazardList",function(t,e){console.log("CustomerJobConditionsIndicatorInterventionCtrl refreshHazardList"),m()});t.$on("$destroy",function(){C()})}]);
"use strict";app.controller("CustomerJobConditionsIndicatorInterventionDetailEditCtrl",["$scope","$stateParams","$log","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$document","$location","$translate","$aside","ListService","FileUploader","CustomerJobConditionsIndicatorService",function(e,n,t,o,i,r,l,a,s,u,d,f,c,p,m,v,g){function h(){var t=[{name:"customer_related_agent_user",value:n.customerId}];m.getDataList(t).then(function(n){e.responsibleList=n.data.data.customerRelatedAgentAndUserList},function(n){e.status="Unable to load customer data: "+n.message})}var U=0;e.responsibleList=[],e.datePickerConfig={culture:"es-CO",format:"dd/MM/yyyy"};var w=l.$on("selectQuestion",function(e,n){C(),h()}),I=l.$on("clearIntervention",function(n,t){e.interventionList=[],e.filter.selectedQuestion=null,e.filter.selectedView=g.getView()});e.$on("$destroy",function(){w(),I()});var C=function(){e.filter={selectedView:g.getView(),selectedQuestion:g.getCurrentQuestion()||null},e.entity={id:e.filter.selectedQuestion.selfEvaluationAnswerId,name:null},e.interventionList=e.filter.selectedQuestion.interventions,L()},L=function(){void 0!==e.fileUploader&&null!=e.fileUploader||(e.fileUploader=[]);var n=new v({url:"api/customer-jobconditions/intervention/upload",formData:[],removeAfterUpload:!0});n.filters.push({name:"enforceMaxFileSize",fn:function(e){return e.size<=10485760}}),n.filters.push({name:"enforceExtension",fn:function(e){return/\.(jpg|jpeg|png|pdf|doc|docx|xls|xlsx)$/i.test(e.name)}}),e.fileUploader.push(n),e.fileUploader[e.fileUploader.length-1].onBeforeUploadItem=function(e){console.info("onBeforeUploadItem",e);var n={id:U};e.formData.push(n)},e.fileUploader[e.fileUploader.length-1].onCompleteItem=function(n,t,o,i){t&&t.result&&e.$emit("refreshQuestions")},e.fileUploader[e.fileUploader.length-1].onCompleteAll=function(){console.info("onCompleteAll")},e.fileUploader[e.fileUploader.length-1].filters.push({name:"customFilter",fn:function(e,n){return this.queue.length<10}})};L(),e.onAddIntervention=function(){null==e.interventionList&&(e.interventionList=[]);var n=e.interventionList.some(function(e){return 0===e.interventionId});n||(e.interventionList.push({interventionId:0,selfEvaluationAnswerId:e.entity.id,name:"",description:"",responsible:null,budget:0,executionDate:null,isClosed:!1,isClosedOriginal:!1,status:!1,files:[],isOpen:!0}),L())},e.onDownload=function(e){angular.element("#downloadIntervention")[0].src="api/customer-config-question-express-intervention/download?id="+e},e.onSubmit=function(e,n,t){var o=e["FormIntervention"+n];if(o.$valid)return void b(n,t);var i=null,r=null;for(i in o)"$"!=i[0]&&(null!==r||o[i].$valid||(r=o[i].$name),o[i].$pristine&&(o[i].$dirty=!0));angular.element(".ng-invalid[name="+r+"]").focus(),u.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")},e.getForm=function(e){return this["Form"+e]};var b=function(n,t){var o=JSON.stringify(t),i={data:Base64.encode(o)};return s({method:"POST",url:"api/customer-jobconditions/intervention/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(t){a(function(){e.interventionList[n]=t.data.result,e.fileUploader[n].queue.length>0?(U=t.data.result.interventionId,e.fileUploader[n].uploadAll()):e.$emit("refreshQuestions"),u.swal("Registro","La información ha sido guardada satisfactoriamente","success")})})["catch"](function(e){u.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})};h()}]);
"use strict";app.factory("CustomerJobConditionsIndicatorService",["$stateParams","ListService",function(t,n){var e={},u=null,i=null,r=null,s=null,o=null,a=null,c=[];return e.setFilters=function(t){u=t},e.getFilters=function(){return u},e.setEvaluationId=function(t){r=t},e.getEvaluationId=function(){return r},e.setClassificationId=function(t){s=t},e.getClassificationId=function(){return s},e.setQuestions=function(t){o=t},e.getQuestions=function(){return o},e.setCurrentQuestion=function(t){a=t},e.getCurrentQuestion=function(){return a},e.setView=function(t){i=t},e.getView=function(){return i},e.getCustomerAgentUser=function(){if(c.length>0)return c;var e=[{name:"customer_related_agent_user",value:t.customerId}];n.getDataList(e).then(function(t){return c=t.data.data.customerRelatedAgentAndUserList},function(t){$scope.status="Unable to load customer data: "+t.message})},e}]);
"use strict";app.controller("jobConditionsIndicatorCtrl",["$scope","$stateParams","$log","$compile","toaster","$state","$rootScope","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$localStorage","$timeout","$http","ngNotify","SweetAlert","$aside","ChartService","ListService","ModuleListService",function(t,n,i,o,e,a,r,s,c,l,d,u,p,h,w,m,y,C,f){function O(){var i=[{name:"general_indicators_get_years",customerId:n.customerId}];f.getDataList("/customer-jobconditions/config",i).then(function(n){t.yearList=n.data.result.yearsGeneralIndicators})}function I(){var n={customerId:t.entity.customerId,year:t.entity.year?t.entity.year.year:null,years:t.compareYearListCompliancePeriod.concat([t.entity.year?t.entity.year.year:null]),location:t.entity.location?t.entity.location.value:null},i=[{name:"chart_bar_options",criteria:null},{name:"chart_doughnut_options",criteria:null},{name:"chart_line_options",criteria:null},{name:"customer_job_condition_indicators",criteria:n}];y.getDataChart(i).then(function(n){t.chart.bar.options=n.data.data.chartBarOptions,t.chart.bar.options.legend.position="bottom",t.chart.line.options=n.data.data.chartLineOptions,t.chart.doughnut.options=angular.copy(n.data.data.chartDoughnutOptions),t.chart.doughnut.options.legend.position="bottom",t.chart.doughnut.options.maintainAspectRatio=!1,t.chart.doughnut.options.responsive=!1,t.chart.doughnut.options.cutoutPercentage=70,t.chart.data.intervention=n.data.data.customerJobConditionIndicatorsInterventions,t.chart.data.levelRisks=n.data.data.customerJobConditionIndicatorsLevelRiskByMonth,t.chart.data.complianceByPeriod=n.data.data.customerJobConditionIndicatorsComplianceByPeriod},function(n){t.status="Unable to load customer data: "+n.message})}function b(){t.yearListGraphic=t.yearList.filter(function(n){return n.year!=t.entity.year.year})}function g(){t.dtInstanceJobConditionsIndicatorsLevelRisksByMonths.reloadData(),t.dtInstanceJobConditionsIndicatorsInterventions.reloadData(),t.dtInstanceJobConditionsIndicatorsResponsibles.reloadData(),v(),I()}function v(){var i={customerId:n.customerId,year:t.entity.year?t.entity.year.year:null,location:t.entity.location?t.entity.location.value:null},o=[{name:"customer_job_conditions_intervention_list",criteria:i}];f.getDataList("/customer-jobconditions/config",o).then(function(n){t.generalStats=n.data.result.jobConditionsInterventionGetStast})}t.yearList=[],t.locationList=[],t.yearListCompliancePeriod=[],t.compareYearListCompliancePeriod=[];var P=function(){t.entity={customerId:n.customerId,year:null,location:null,addYearPeriod:null},t.chart={doughnut:{options:null},bar:{options:null},line:{options:null},data:{levelRisks:[],complianceByPeriod:[],intervention:{chartPie:{},percent:0,budget:0}}},t.generalStats={highPriorityPercent:0,mediumPriorityPercent:0,lowPriorityPercent:0,highPriority:0,mediumPriority:0,lowPriority:0}};P(),O(),t.onChangeYear=function(){var i=[{name:"general_indicators_get_locations",customerId:n.customerId,year:t.entity.year.year}];f.getDataList("/customer-jobconditions/config",i).then(function(n){t.locationList=n.data.result.locationsGeneralIndicators}),t.entity.location=null,b(),g()},t.onChangeLocation=function(){g()},t.onAddCompareYear=function(){t.compareYearListCompliancePeriod.push(t.entity.addYearPeriod.year),t.yearListGraphic=t.yearListGraphic.filter(function(n){return n.year!=t.entity.addYearPeriod.year}),t.entity.addYearPeriod=null,I()},t.onRemoveCompareYear=function(){t.compareYearListCompliancePeriod=[],t.yearListGraphic=t.yearList,b(),I()},t.onGoToDashboard=function(){null!=t.$parent&&t.$parent.navToSection("dashboard","list",0)};var L="jobConditionsIndicatorsLevelRisksByMonthsListCtrl-"+window.currentUser.id;t.dtInstanceJobConditionsIndicatorsLevelRisksByMonths={},t.dtOptionsJobConditionsIndicatorsLevelRisksByMonths=s.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(n){return n.customerId=t.entity.customerId,n.year=t.entity.year?t.entity.year.year:null,n.location=t.entity.location?t.entity.location.value:null,JSON.stringify(n)},url:"api/customer-jobconditions/indicators/get-level-risks-by-months-list",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(t){}}).withDataProp("data").withOption("stateSave",!0).withOption("stateSaveCallback",function(t,n){d[L]=n}).withOption("stateLoadCallback",function(){return d[L]}).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withOption("info",!1).withOption("ordering",!1).withOption("paging",!1).withOption("searching",!1).withOption("createdRow",function(n){o(angular.element(n).contents())(t)}),t.dtColumnsJobConditionsIndicatorsLevelRisksByMonths=[c.newColumn("indicator").withTitle("INDICADORES").withOption("width",200).withOption("defaultContent",""),c.newColumn("JAN").withTitle("ENE").withOption("width",200),c.newColumn("FEB").withTitle("FEB").withOption("width",200),c.newColumn("MAR").withTitle("MAR").withOption("width",200),c.newColumn("APR").withTitle("ABR").withOption("width",200),c.newColumn("MAY").withTitle("MAY").withOption("width",200),c.newColumn("JUN").withTitle("JUN").withOption("width",200),c.newColumn("JUL").withTitle("JUL").withOption("width",200),c.newColumn("AUG").withTitle("AGO").withOption("width",200),c.newColumn("SEP").withTitle("SEP").withOption("width",200),c.newColumn("OCT").withTitle("OCT").withOption("width",200),c.newColumn("NOV").withTitle("NOV").withOption("width",200),c.newColumn("DEC").withTitle("DIC").withOption("width",200)];var S="jobConditionsIndicatorsInterventionsListCtrl-"+window.currentUser.id;t.dtInstanceJobConditionsIndicatorsInterventions={},t.dtOptionsJobConditionsIndicatorsInterventions=s.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(n){return n.customerId=t.entity.customerId,n.year=t.entity.year?t.entity.year.year:null,n.location=t.entity.location?t.entity.location.value:null,JSON.stringify(n)},url:"api/customer-jobconditions/indicators/get-interventions",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("stateSave",!0).withOption("stateSaveCallback",function(t,n){d[S]=n}).withOption("stateLoadCallback",function(){return d[S]}).withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){T()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(n,i,e){o(angular.element(n).contents())(t)}),t.dtColumnsJobConditionsIndicatorsInterventions=[c.newColumn(null).withTitle("Acciones").withOption("width",20).notSortable().renderWith(function(t){return'<a class="btn btn-info btn-xs viewRow lnk" href="#" uib-tooltip="Ver" data-classification="'+t.classificationId+'" data-question="'+t.questionId+'" >   <i class="fa fa-eye"></i></a> '}),c.newColumn("classification").withTitle("Condiciones").withOption("width",200).withOption("defaultContent",""),c.newColumn("question").withTitle("Pregunta").withOption("width",400).withOption("defaultContent",""),c.newColumn("totalPlans").withTitle("Total Planes").withOption("width",100).withOption("defaultContent","")];var T=function(){angular.element("#dtJobConditionsIndicatorsInterventions a.viewRow").on("click",function(){var n=angular.element(this).data("classification"),i=angular.element(this).data("question"),o=m.open({templateUrl:r.app.views.urlRoot+"modules/customer/job-conditions/indicator/indicators/intervention_list_modal.htm",placement:"right",windowTopClass:"top-modal",size:"lg",backdrop:!0,controller:"JobConditionsIndicatorIndicatorsInterventionsListCtrlModalInstanceSide",scope:t,resolve:{dataSource:{customerId:t.entity.customerId,classificationId:n,questionId:i}}});o.result.then(function(){g()})})},R="jobConditionsIndicatorsResponsiblesListCtrl-"+window.currentUser.id;t.dtInstanceJobConditionsIndicatorsResponsibles={},t.dtOptionsJobConditionsIndicatorsResponsibles=s.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(n){return n.customerId=t.entity.customerId,n.year=t.entity.year?t.entity.year.year:null,n.location=t.entity.location?t.entity.location.value:null,JSON.stringify(n)},url:"api/customer-jobconditions/indicators/interventions-by-responsibles",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("stateSave",!0).withOption("stateSaveCallback",function(t,n){d[R]=n}).withOption("stateLoadCallback",function(){return d[R]}).withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(n,i,e){o(angular.element(n).contents())(t)}),t.dtColumnsJobConditionsIndicatorsResponsibles=[c.newColumn("name").withTitle("Nombre").withOption("width",200).withOption("defaultContent",""),c.newColumn("email").withTitle("Correo").withOption("width",200).withOption("defaultContent",""),c.newColumn("assignedPlans").withTitle("Planes Asignados").withOption("width",200).withOption("defaultContent","")],t.onExportPdf=function(){kendo.drawing.drawDOM($(".job-indicator-general-export-pdf")).then(function(t){return kendo.drawing.exportPDF(t,{paperSize:"auto",margin:{left:"1cm",top:"1cm",right:"1cm",bottom:"1cm"}})}).done(function(t){kendo.saveAs({dataURI:t,fileName:"TABLERO_INDICADORES_GENERAL_DE_CONDICIONES_INSEGURAS.pdf",proxyURL:"//demos.telerik.com/kendo-ui/service/export"})})},t.onExportExcel=function(t){var n={customerId:t.customerId,year:t.year?t.year.year:null,location:t.location?t.location.value:null,typeIndicator:"general"},i=JSON.stringify(n);jQuery("#downloadIndicatorGeneralExcel")[0].src="api/customer-jobconditions/indicators/export-excel?data="+Base64.encode(i)},t.onRemoveIndicators=function(){P(),t.dtInstanceJobConditionsIndicatorsLevelRisksByMonths.reloadData(),t.dtInstanceJobConditionsIndicatorsInterventions.reloadData(),t.dtInstanceJobConditionsIndicatorsResponsibles.reloadData()}}]);
"use strict";app.controller("JobConditionsIndicatorIndicatorsInterventionsListCtrlModalInstanceSide",["$rootScope","$stateParams","$scope","$uibModalInstance","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$localStorage","$log","$timeout","SweetAlert","$http","$compile","toaster","$document","$aside","dataSource",function(t,n,i,e,o,a,r,s,c,d,l,u,p,w,h,f,m){function I(n){var e=f.open({templateUrl:t.app.views.urlRoot+"modules/customer/job-conditions/indicator/intervention/intervention_detail_edit_modal.htm",placement:"right",windowTopClass:"top-modal",size:"lg",backdrop:"static",controller:"ModalInstanceSideCustomerJobConditionsIndicatorInterventionDetailEditCtrl",scope:i,resolve:{entity:function(){return n},isView:function(){return!1}}});e.result.then(function(){i.reloadData()})}var v=function(){i.entity={customerId:m.customerId,classificationId:m.classificationId,questionId:m.questionId}};v(),i.onClose=function(){e.close(1)},i.onFinish=function(){e.dismiss("cancel")};var O="jobConditionIndicatorIndicatorsInterventionListListCtrl-"+window.currentUser.id;i.dtInstanceIndicatorsInterventionList={},i.dtOptionsIndicatorsInterventionList=o.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.customerId=i.entity.customerId,t.classificationId=i.entity.classificationId,t.questionId=i.entity.questionId,JSON.stringify(t)},url:"api/customer-jobconditions/indicators/interventions-questions-historical",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("stateSave",!0).withOption("stateSaveCallback",function(t,n){s[O]=n}).withOption("stateLoadCallback",function(){return s[O]}).withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){b()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,n,e){p(angular.element(t).contents())(i)}),i.dtColumnsIndicatorsInterventionList=[a.newColumn(null).withTitle("Acciones").withOption("width",120).notSortable().renderWith(function(t){var n="",i='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+t.id+'" >   <i class="fa fa-edit"></i></a> ',e='<a class="btn btn-danger btn-xs closeRow lnk" href="#" uib-tooltip="Cerrar" data-id="'+t.id+'" >   <i class="fa fa-close"></i></a> ';return n+=i,n+=e}),a.newColumn("employee").withTitle("Nombre Empleado").withOption("width",200).withOption("defaultContent",""),a.newColumn("intervention").withTitle("Nombre Intervención").withOption("width",200).withOption("defaultContent",""),a.newColumn("responsibleName").withTitle("Responsable").withOption("width",200).withOption("defaultContent",""),a.newColumn("date").withTitle("Fecha Ejecución").withOption("width",200).withOption("defaultContent","")];var b=function(){$("#indicatorsInterventionList a.editRow").on("click",function(){var t=$(this).data("id");I(t)}),$("#indicatorsInterventionList a.closeRow").on("click",function(){var t=$(this).data("id");C(t)})};i.reloadData=function(){i.dtInstanceIndicatorsInterventionList.reloadData()};var C=function(t){var n=JSON.stringify({id:t}),e={data:Base64.encode(n)};u({method:"POST",url:"api/customer-jobconditions/intervention/close",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(t){l.swal("Proceso Exitoso","Se ha cerrado el plan de intervención correctamente.","success")})["catch"](function(t){l.swal("Error al cerrar","Se ha presentado un error durante el cierre del plan de intervención, por favor intentelo de nuevo","error")})["finally"](function(){i.reloadData()})}}]);
"use strict";app.controller("ModalInstanceSideCustomerJobConditionsIndicatorInterventionDetailEditCtrl",["$rootScope","$stateParams","$scope","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","$filter","$aside","$document","$compile","ListService","FileUploader","entity","isView",function(e,n,t,o,r,i,a,l,s,u,d,c,f,m,p,v,g){function h(){var e=[{name:"customer_related_agent_user",value:n.customerId}];m.getDataList(e).then(function(e){t.responsibleList=e.data.data.customerRelatedAgentAndUserList},function(e){t.status="Unable to load customer data: "+e.message})}var y=v;t.responsibleList=[],t.datePickerConfig={culture:"es-CO",format:"dd/MM/yyyy"},t.onCancel=function(){o.close(1)};var w=function(){t.entity={interventionId:v,name:null,description:null,budget:null,responsible:null}};w();var I=function(){var e=new p({url:"api/customer-jobconditions/intervention/upload",formData:[],removeAfterUpload:!0});e.filters.push({name:"enforceMaxFileSize",fn:function(e){return e.size<=10485760}}),e.filters.push({name:"enforceExtension",fn:function(e){return/\.(jpg|jpeg|png|pdf|doc|docx|xls|xlsx)$/i.test(e.name)}}),t.fileUploader=e,t.fileUploader.onBeforeUploadItem=function(e){console.info("onBeforeUploadItem",e);var n={id:y};e.formData.push(n)},t.fileUploader.onCompleteItem=function(e,n,o,r){n&&n.result&&(t.entity=n.result,t.entity.interventionId=v)},t.fileUploader.onCompleteAll=function(){console.info("onCompleteAll")},t.fileUploader.filters.push({name:"customFilter",fn:function(e,n){return this.queue.length<10}})};I();var C=function(){var e={},n=JSON.stringify({id:t.entity.interventionId});return e.data=Base64.encode(n),l({method:"post",url:"api/customer-jobconditions/intervention/show",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){t.entity=e.data.result,t.entity.interventionId=v})["catch"](function(e){r.error(e),a.swal("Error al consultar la información.",e.data.message,"error")})};C(),h(),t.form={submit:function(e){var n=null;if(e.$invalid){var o=null,n=null;for(o in e)"$"!=o[0]&&(null!==n||e[o].$valid||(n=e[o].$name),e[o].$pristine&&(e[o].$dirty=!0));return log.info(t.standard),angular.element(".ng-invalid[name="+n+"]").focus(),void a.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}U()},reset:function(e){}};var U=function(){var e=JSON.stringify(t.entity),n={data:Base64.encode(e)};return l({method:"POST",url:"api/customer-jobconditions/intervention/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(e){t.fileUploader.uploadAll(),t.onCancel(),a.swal("Registro","La información ha sido guardada satisfactoriamente","success")})["catch"](function(e){a.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})}}]);
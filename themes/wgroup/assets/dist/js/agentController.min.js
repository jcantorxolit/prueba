"use strict";app.controller("agentCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","SweetAlert","$http",function(t,e,n,i,o,a,r,l,s,c,d,u){var p=n,w={};p.info("entrando en... agentCtrl"),t.isAgent="agent"==c.currentUser().wg_type,t.isAdmin="system"==c.currentUser().wg_type,t.isCustomer="customerAdmin"==c.currentUser().wg_type||"customerUser"==c.currentUser().wg_type,t.isAgent?s.go("app.clientes.list"):t.isCustomer&&(p.info("Step 6"),s.go("app.clientes.view",{customerId:c.currentUser().company})),w.operation="agents",t.dtOptions=i.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:w,url:"api/agents",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){m()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,n,i){r(angular.element(e).contents())(t)}),t.dtColumns=[o.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,e,n,i){var o="",a='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar"  data-id="'+t.id+'" >   <i class="fa fa-edit"></i></a> ',r='<a class="btn btn-info btn-xs viewRow lnk" href="#" uib-tooltip="Ver" data-id="'+t.id+'" >   <i class="fa fa-eye"></i></a> ',l='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+t.id+'" >   <i class="fa fa-trash-o"></i></a> ';return c.can("clientes_view")&&(o+=r),c.can("clientes_edit")&&(o+=a),c.can("clientes_delete")&&(o+=l),o}),o.newColumn("documentType.item").withTitle("Tipo de Documento").withOption("defaultContent","").withOption("width",200),o.newColumn("documentNumber").withTitle("Documento").withOption("defaultContent","").withOption("width",200),o.newColumn("fullName").withTitle("Nombre").withOption("defaultContent","").withOption("width",200),o.newColumn("gender.item").withTitle("Género").withOption("defaultContent","").withOption("width",200),o.newColumn("type.item").withTitle("Tipo").withOption("defaultContent","").withOption("width",200)];var m=function(){$("#dtAgent a.editRow").on("click",function(){var t=$(this).data("id");s.go("app.asesores.edit",{agentId:t})}),$("#dtAgent a.viewRow").on("click",function(){var t=$(this).data("id");s.go("app.asesores.view",{agentId:t})}),$("#dtAgent a.delRow").on("click",function(){var e=$(this).data("id");p.info("intenta eliminar el registro: "+e),d.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(i){if(i){var o={};o.id=e,u({method:"POST",url:"api/customer/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){n.error(t),d.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){t.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};t.createAgent=function(){s.go("app.asesores.create")},t.reloadData=function(){p.info("reloading..."),t.dtOptions.reloadData()}}]);
"use strict";app.controller("agentTabsCtrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout","$state","$filter","flowFactory","$http",function(e,t,a,n,o,i,r,s,l,c){var g=a;r.is("app.asesores.view")?e.agent_title_tab="view":r.is("app.asesores.create")?e.agent_title_tab="create":e.agent_title_tab="edit",e.isCreate=r.is("app.asesores.create"),e.profileTab="basic",e.isAgent="agent"==o.currentUser().wg_type,e.isAdmin="system"==o.currentUser().wg_type,e.isCustomer="customerAdmin"==o.currentUser().wg_type||"customerUser"==o.currentUser().wg_type,e.isAgent?r.go("app.clientes.list"):e.isCustomer&&(g.info("Step 1"),r.go("app.clientes.view",{customerId:o.currentUser().company})),e.agent={},e.agent.id=e.iscreate?0:t.agentId,e.flowConfig={target:"/api/agent/upload",singleFile:!0},e.uploader=new Flow,e.noImage=!0,e.tabsloaded=["profile"],e.tabname="profile",e.titletab=e.agent_title_tab,e.onLoadRecord=function(){if(e.agent.id){g.info("editando cliente con código: "+e.agent.id);var t={id:e.agent.id};c({method:"GET",url:"api/agent",params:t})["catch"](function(e,t){if(403==t){var a=null!==e.message&&void 0!==e.message?e.message:"app.asesores.list";SweetAlert.swal("No Autorizado","No estas autorizado para ver esta información.","error"),i(function(){r.go(a)},3e3)}else 404==t?(SweetAlert.swal("Información no disponible","Cliente no encontrado","error"),i(function(){r.go("app.clientes.list")})):SweetAlert.swal("Error","Se ha presentado un error al intentar acceder a la información del cliente","error")}).then(function(t){i(function(){e.agent=t.data.result,null!=e.agent.logo&&null!=e.agent.logo.path?e.noImage=!1:e.noImage=!0})})["finally"](function(){})}else g.info("creacion de nuevo asesor agentTabsCtrl"),e.loading=!1},e.onLoadRecord(),e.switchTab=function(t,a){i(function(){e.tabname=t,e.titletab=a,e.tabsloaded.push(t)})},e.switchSubTab=function(t){i(function(){e.subtab=t})}}]);
"use strict";app.controller("agentEditCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","SweetAlert","$rootScope","$http","$timeout","$uibModal","flowFactory","cfpLoadingBar","$filter","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder",function(e,n,a,t,o,i,l,r,s,c,u,g,d,p,f,m,w){var v=a;if(e.flowConfig={target:"/api/agent/upload",singleFile:!0},e.loading=!0,e.isView=s.is("app.asesores.view"),e.isCreate=s.is("app.asesores.create"),e.currentYear={id:"0",item:"-- Seleccionar --",value:(new Date).getFullYear()},e.agent={id:e.isCreate?0:n.agentId,logo:"",signature:"",signatureText:"",contacts:[],occupations:[],skills:[],legalType:null,gender:null,documentType:null,type:null,isActive:!1},e.isSelected=!0,e.tiposdoc=u.parameters("tipodoc"),e.genders=u.parameters("gender"),e.types=u.parameters("agent_type"),e.extrainfo=u.parameters("extrainfo"),e.agent_occupations=u.parameters("agent_occupation"),e.agent_skills=u.parameters("agent_skill"),e.legalTypes=u.parameters("agent_legal_type"),e.agentRoleList=u.parameters("agent_role_list"),e.uploader=new Flow,e.uploaderSignature=new Flow,""==e.agent.logo&&(e.noImage=!0),""==e.agent.signature&&(e.noSignatureImage=!0),e.agent.id){v.info("editando cliente con código: "+e.agent.id);var C={id:e.agent.id};g({method:"GET",url:"api/agent",params:C})["catch"](function(e,n){if(403==n){var a=null!==e.message&&void 0!==e.message?e.message:"app.asesores.list";c.swal("No Autorizado","No estas autorizado para ver esta información.","error"),d(function(){s.go(a)},3e3)}else 404==n?(c.swal("Información no disponible","Cliente no encontrado","error"),d(function(){s.go("app.clientes.list")})):c.swal("Error","Se ha presentado un error al intentar acceder a la información del cliente","error")}).then(function(n){console.log(n),d(function(){e.agent=n.data.result,null!=e.agent.contacts&&0!=e.agent.contacts.length||(e.agent.contacts=[{id:0,value:"",type:null}]),null!=e.agent.occupations&&0!=e.agent.occupations.length||(e.agent.occupations=[{id:0,description:"",type:null,license:""}]),null!=e.agent.skills&&0!=e.agent.skills.length||(e.agent.skills=[{id:0,skill:null}]),null!=e.agent.logo&&null!=e.agent.logo.path?e.noImage=!1:e.noImage=!0,null!=e.agent.signature&&null!=e.agent.signature.path?e.noSignatureImage=!1:e.noSignatureImage=!0})})["finally"](function(){})}else v.info("creacion de nuevo asesor "),e.loading=!1;e.removeImage=function(){e.noImage=!0},e.removeSignatureImage=function(){e.noSignatureImage=!0},e.master=e.agent,e.form={submit:function(n){var a=null;if(n.$invalid){var t=null,a=null;for(t in n)"$"!=t[0]&&(null!==a||n[t].$valid||(a=n[t].$name),n[t].$pristine&&(n[t].$dirty=!0));return v.info(e.agent),angular.element(".ng-invalid[name="+a+"]").focus(),void c.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}B()},reset:function(n){e.agent=angular.copy(e.master),n.$setPristine(!0)}};var B=function(){var n={},t=JSON.stringify(e.agent);return n.data=Base64.encode(t),g({method:"POST",url:"api/agent/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(n){void 0!==e.uploader.flow&&null!==e.uploader.flow&&(e.uploader.flow.opts.query.id=n.data.result.id,e.uploader.flow.resume()),void 0!==e.uploaderSignature.flow&&null!==e.uploaderSignature.flow&&(e.uploaderSignature.flow.opts.query.id=n.data.result.id,e.uploaderSignature.flow.resume()),d(function(){c.swal("Registro","La información ha sido guardada satisfactoriamente","success"),e.isCreate?s.go("app.asesores.edit",{agentId:n.data.result.id}):e.agent=n.data.result})})["catch"](function(e){a.error(e);var n=e.data&&e.data.message?e.data.message:"Error guardando el registro. Por favor verifique los datos ingresados!";c.swal("Error de guardado",n,"error")})["finally"](function(){})};e.cancelEdition=function(){e.isView?s.go("app.asesores.list"):c.swal({title:"Está seguro?",text:"Perderá todos los cambios realizados en esta vista.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, cancelar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(e){e?d(function(){s.go("app.asesores.list")}):swal("Cancelación","La operación ha sido cancelada","error")})},e.onAddContact=function(){e.agent.contacts.push({id:0,value:"",type:null})},e.removeContact=function(n){c.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(a){a?d(function(){e.agent.contacts.splice(n,1)}):swal("Cancelación","La operación ha sido cancelada","error")})},e.onAddOccupation=function(){e.agent.occupations.push({id:0,description:"",type:null,license:""})},e.removeOccupation=function(n){c.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(a){a?d(function(){e.agent.occupations.splice(n,1)}):swal("Cancelación","La operación ha sido cancelada","error")})},e.onAddSkill=function(){e.agent.skills.push({id:0,skill:null})},e.removeSkill=function(n){c.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(a){a?d(function(){e.agent.skills.splice(n,1)}):swal("Cancelación","La operación ha sido cancelada","error")})}}]);
"use strict";app.controller("agentDocumentCtrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout",function(t,e,n,o,c,a){var i=n;i.info("loading..customerDocumentCtrl!!! "),t.attachment_section="list",t.currentAttachment=0,t.modeDsp="edit",t.navToSection=function(e,n,o){a(function(){t.attachment_section=e,t.modeDsp=n,t.$parent.switchSubTab(n),t.currentAttachment=o})}}]);
"use strict";app.controller("agentDocumentListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","SweetAlert","$http","$filter","$document","FileUploader","$localStorage","$ngConfirm","ngNotify",function(t,e,n,a,o,i,r,l,c,s,d,u,m,f,p,h,w,g,C){var v=n,D=0;v.info("loading..customerDocumentListCtrl "),t.$storage=w.$default({hideAgentAttachmentCanceled:!0}),t.agents=s.agents(),t.documentType=s.parameters("agent_document_type"),t.documentClassification=s.parameters("agent_document_classification"),t.documentStatus=s.parameters("agent_document_status"),t.isView="view"==t.$parent.modeDsp,t.customerId=e.customerId,t.downloadUrl="";var A=function(){t.attachment={id:0,created_at:f("date")(new Date,"dd/MM/yyyy HH:mm"),agentId:e.agentId,isSelected:1,agent:null,type:null,classification:null,status:t.documentStatus.length>0?t.documentStatus[0]:null,startDate:null,endDate:null,version:1,description:""}};A();var b=function(e){var n={id:e};m({method:"GET",url:"api/agent/document",params:n})["catch"](function(t,e){if(403==e){var n=null!==t.message&&void 0!==t.message?t.message:"app.clientes.list";u.swal("No Autorizado","No estas autorizado para ver esta información.","error"),d(function(){c.go(n)},3e3)}else 404==e?(u.swal("Información no disponible","Anexo no encontrado","error"),d(function(){c.go("app.clientes.list")})):u.swal("Error","Se ha presentado un error al intentar acceder a la información del anexo","error")}).then(function(e){d(function(){t.attachment=e.data.result,t.attachment.version=parseInt(t.attachment.version)+1,O()})})["finally"](function(){d(function(){afterInit(),t.loading=!1},400)})},O=function(){null!=t.attachment.startDate&&""!=t.attachment.startDate&&(t.attachment.startDate=new Date(t.attachment.startDate.date)),null!=t.attachment.endDate&&""!=t.attachment.endDate&&(t.attachment.endDate=new Date(t.attachment.endDate.date))};t.master=t.attachment,t.form={submit:function(t){var e=null;if(t.$invalid){var n=null,e=null;for(n in t)"$"!=n[0]&&(null!==e||t[n].$valid||(e=t[n].$name),t[n].$pristine&&(t[n].$dirty=!0));return angular.element(".ng-invalid[name="+e+"]").focus(),void u.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}I()},reset:function(e){t.attachment=angular.copy(t.master),e.$setPristine(!0)}};var I=function(){var e={},a=JSON.stringify(t.attachment);return e.data=Base64.encode(a),m({method:"POST",url:"api/agent/document/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){d(function(){y.queue.length>0?(D=e.data.result.id,y.uploadAll()):(u.swal("Registro","La información se ha guardado satisfactoriamente","success"),t.reloadData(),t.onClear())})})["catch"](function(t){n.error(t),u.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})},y=t.uploader=new h({url:"api/agent/document/upload",formData:[],removeAfterUpload:!0});y.filters.push({name:"customFilter",fn:function(t,e){return this.queue.length<10}}),y.onWhenAddingFileFailed=function(t,e,n){console.info("onWhenAddingFileFailed",t,e,n)},y.onAfterAddingFile=function(t){console.info("onAfterAddingFile",t)},y.onAfterAddingAll=function(t){console.info("onAfterAddingAll",t)},y.onBeforeUploadItem=function(t){console.info("onBeforeUploadItem",t);var e={id:D};t.formData.push(e)},y.onProgressItem=function(t,e){console.info("onProgressItem",t,e)},y.onProgressAll=function(t){console.info("onProgressAll",t)},y.onSuccessItem=function(t,e,n,a){console.info("onSuccessItem",t,e,n,a)},y.onErrorItem=function(t,e,n,a){console.info("onErrorItem",t,e,n,a)},y.onCancelItem=function(t,e,n,a){console.info("onCancelItem",t,e,n,a)},y.onCompleteItem=function(t,e,n,a){console.info("onCompleteItem",t,e,n,a)},y.onCompleteAll=function(){u.swal("Registro","La información se ha guardado satisfactoriamente","success"),t.reloadData(),t.onClear()},t.onClear=function(){A(),t.isView=!1},t.dtInstanceDocument={},t.dtOptionsDocument=a.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(n){return n.operation="document",n.agent_id=e.agentId,n.hideCanceled=t.$storage.hideAgentAttachmentCanceled?1:0,n},url:"api/agent/documents",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){T()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,n,a){r(angular.element(e).contents())(t)}),t.dtColumnsDocument=[o.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,e,n,a){var o=null!=t.document?t.document.path:"",i="api/agent/document/download?id="+t.id,r="",l='<a target="_self" class="btn btn-primary btn-xs editRow lnk" href="'+i+'" uib-tooltip="Descargar anexo" data-id="'+t.id+'" >   <i class="fa fa-download"></i></a> ',c='<a class="btn btn-info btn-xs viewRow lnk" target="_blank" href="'+o+'" uib-tooltip="Abrir anexo" data-id="'+t.id+'" >   <i class="fa fa-folder-open-o"></i></a> ',s='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Anular anexo" data-id="'+t.id+'" >   <i class="fa fa-ban"></i></a> ';return""!=o&&(r+=c),""!=o&&(r+=l),r+=s}),o.newColumn("type.item").withTitle("Tipo de documento").withOption("width",200).withOption("defaultContent",""),o.newColumn("classification.item").withTitle("Clasificación").withOption("width",200).withOption("defaultContent",""),o.newColumn("description").withTitle("Descripción").withOption("width",200).withOption("defaultContent",""),o.newColumn("startDateText").withTitle("Fecha de Inicio Vigencia").withOption("width",200).withOption("defaultContent",""),o.newColumn("endDateText").withTitle("Fecha de Finalización Vigencia").withOption("width",200).withOption("defaultContent",""),o.newColumn("version").withTitle("Versión").withOption("width",200).withOption("defaultContent",""),o.newColumn("status.item").withTitle("Estado").withOption("width",200).renderWith(function(t,e,n,a){var o="";switch(t){case"Vigente":o="label label-success";break;case"Anulado":o="label label-danger"}var i='<span class="'+o+'">'+t+"</span>";return i})];var T=function(){angular.element("#dtDocument a.editRow").on("click",function(){var t=angular.element(this).data("id");jQuery("#download")[0].src="api/document/download?id="+t}),angular.element("#dtDocument a.delRow").on("click",function(){var e=angular.element(this).data("id");g({boxWidth:"35%",useBootstrap:!1,animation:"bottom",closeAnimation:"scale",title:"Está seguro?",content:"<strong>Anulará</strong> el anexo seleccionado",scope:t,type:"red",typeAnimated:!0,buttons:{cancel:{text:"Anular y cambiar versión",btnClass:"btn-primary",action:function(n,a){t.attachment.id=e,t.isView=!1,b(e),l.pop("info","Anulación Anexo","El anexo se cargó satisfactoriamente, seleccione una nueva versión del documento")}},fullCancel:{text:"Anular definitivamente",btnClass:"btn-red",action:function(a,o){var i={};i.id=e,m({method:"POST",url:"api/customer/contract-detail-document/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(e){swal("Eliminado","Anexo anulado satisfactoriamente","info"),t.reloadData()})["catch"](function(t){n.error(t),u.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}},closeAll:{text:"Cancelar",btnClass:"btn-default",action:function(t,e){}}}})})};t.dtInstanceDocumentCallback=function(e){t.dtInstanceDocument=e},t.reloadData=function(){t.dtInstanceDocument.reloadData()},t.onEdit=function(e){t.attachment.id=e,t.isView=!1,b(e)},t.onShowCancelledChange=function(){request.hideCanceled=t.$storage.hideAgentAttachmentCanceled?1:0,t.reloadData()}}]);
"use strict";app.controller("agentCustomerListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","SweetAlert","$http","$aside","ListService",function(e,t,n,o,a,i,l,r,c,s,u,d,p,f,g){e.dtOptionsCustomerRelation=o.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.agentId=t.agentId,JSON.stringify(e)},url:"api/customer-agent/v2",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){m()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,n,o){l(angular.element(t).contents())(e)}),e.dtColumnsCustomerRelation=[a.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,t,n,o){var a="",i='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar"  data-id="'+e.id+'" >   <i class="fa fa-edit"></i></a> ',l='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+e.id+'" >   <i class="fa fa-ban"></i></a> ';return a+=i,a+=l}),a.newColumn("documentType").withTitle("Tipo de Documento").withOption("width",200).withOption("defaultContent",""),a.newColumn("documentNumber").withTitle("Nro Documento").withOption("width",200).withOption("defaultContent",""),a.newColumn("businessName").withTitle("Razón Social").withOption("width",200).withOption("defaultContent",""),a.newColumn("type").withTitle("Tipo Relación").withOption("width",200).withOption("defaultContent",""),a.newColumn("status").withTitle("Estado").withOption("width",200).renderWith(function(e,t,n,o){var a="";switch(e){case"Activo":a="label label-success";break;case"Inactivo":a="label label-danger";break;case"Retirado":a="label label-warning"}var i='<span class="'+a+'">'+e+"</span>";return i})];var m=function(){angular.element("#dtCustomerRelation a.editRow").on("click",function(){var e=angular.element(this).data("id");h(e)}),angular.element("#dtCustomerRelation a.delRow").on("click",function(){var t=angular.element(this).data("id");d.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(o){if(o){var a={};a.id=t,p({method:"POST",url:"api/customer-agent/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){n.error(e),d.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){e.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};e.dtInstanceCustomerRelationCallback=function(t){e.dtInstanceCustomerRelation=t},e.reloadData=function(){e.dtInstanceCustomerRelation.reloadData()},e.onEdit=function(t){e.attachment.id=t,e.isView=!1,loadRecord(t)},e.onAddCustomer=function(){h(0)};var h=function(t){var n={id:t,isEdit:t>0},o=f.open({templateUrl:s.app.views.urlRoot+"modules/agents/tabs/customer/agent_customer_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideAgentCustomerCtrl",scope:e,resolve:{entity:function(){return n}}});o.result.then(function(){e.reloadData()},function(){e.reloadData()})}}]),app.controller("ModalInstanceSideAgentCustomerCtrl",["$rootScope","$stateParams","$scope","$uibModalInstance","entity","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile",function(e,t,n,o,a,i,l,r,c,s,u,d,p,f,g){n.canShowDataTable=!1,n.typeList=e.parameters("bunit"),n.filter={selectedType:null},n.toggle={isChecked:!1,selectAll:!1},n.records={hasSelected:!1,countSelected:0,countSelectedAll:0},n.isEdit=a.isEdit;var m=function(){n.entity={id:a.id?a.id:0,agentId:t.agentId,type:null,customerUIds:[]}};m();var h={},w={},C={},v=null,b=function(){if(n.entity.id){var e={id:n.entity.id};c({method:"GET",url:"api/customer-agent/get",params:e})["catch"](function(e,t){if(403==t){var n=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";r.swal("No Autorizado","No estas autorizado para ver esta información.","error"),l(function(){$state.go(n)},3e3)}else 404==t?(r.swal("Información no disponible","Anexo no encontrado","error"),l(function(){$state.go("app.clientes.list")})):r.swal("Error","Se ha presentado un error al intentar acceder a la información del anexo","error")}).then(function(e){l(function(){n.entity=e.data.result})})["finally"](function(){l(function(){n.loading=!1},400)})}};b();var O=function(){var e=[p.newColumn(null).withOption("width",30).notSortable().withClass("center").renderWith(function(e,t,n,o){var a="",i=h[e.id].selected,l=i?"checked":"";return a='<div class="checkbox clip-check check-danger "><input class="selectedRow" type="checkbox" id="chk_employee_document_select_'+e.id+'" data-id="'+e.id+'" '+l+' ><label class="padding-left-10" for="chk_employee_document_select_'+e.id+'"> </label></div>'})];return e.push(S("documentType","Tipo de Documento","",200)),e.push(S("documentNumber","Nro Documento","",200)),e.push(S("businessName","Razón Social","",200)),e.push(S("type","Tipo de Cliente","",200)),e.push(S("classification","Clasificación","",200)),e.push(S("status","Estado","",200).notSortable().renderWith(function(e,t,n,o){var a="";switch(e){case"Activo":a="label label-success";break;case"Inactivo":a="label label-danger";break;case"Retirado":a="label label-warning"}var i='<span class="'+a+'">'+e+"</span>";return i})),e},S=function(e,t,n,o){return p.newColumn(e).withTitle(t).withOption("defaultContent",n).withOption("width",o)},k=function(){n.canShowDataTable=!0;var e="";n.dtOptionsCustomerAgentRelation=f.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return e.agentId=t.agentId,v=e,JSON.stringify(e)},dataSrc:function(t){return C=t.data.map(function(e,t,n){return e.id}),w=t.extra,angular.forEach(w,function(e,t){void 0!==h[e]&&null!==h[e]||(h[e]={selected:!1})}),n.records.currentPage=C.length,n.records.total=w.length,e!==v.search.value&&(n.toggle.isChecked=!1,n.toggle.selectAll=!1,y(w,n.toggle.isChecked,!0),e=v.search.value),t.data},url:"api/customer-agent/available",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){T()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,t,o){g(angular.element(e).contents())(n)}),n.dtColumnsCustomerAgentRelation=O()};n.onCloseModal=function(){o.close(1)},n.onCancelModal=function(){o.dismiss("cancel")},n.form={submit:function(e){var t=null;if(e.$invalid){var o=null,t=null;for(o in e)"$"!=o[0]&&(null!==t||e[o].$valid||(t=e[o].$name),e[o].$pristine&&(e[o].$dirty=!0));return angular.element(".ng-invalid[name="+t+"]").focus(),void l(function(){s.pop("error","Error","Por favor verifique los datos requeridos del formulario y vuelva a intentarlo")},500)}return n.isEdit||n.records.hasSelected?void n.onSave():void r.swal("El formulario contiene errores!","Por favor seleccione una o varias empresas.","error")},reset:function(e){e.$setPristine(!0)}},n.onSave=function(){var e={};n.entity.customerUIds=Object.keys(h).filter(function(e){return h[e].selected}).map(function(e){return e});var t=JSON.stringify(n.entity);return e.data=Base64.encode(t),c({method:"POST",url:n.isEdit?"api/customer-agent/save":"api/customer-agent/bulk",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){l(function(){s.pop("success","Operación Exitosa","La información ha sido guardada satisfactoriamente"),n.onCloseModal()})})["catch"](function(e){i.error(e),s.pop("error","Error","Por favor ingrese los campos requeridos.")})["finally"](function(){})};var T=function(){angular.element("#dtCustomerAgentRelation input.selectedRow").on("change",function(){var e=angular.element(this).data("id");"selectedRow"==this.className&&(h[e].selected=this.checked),l(function(){var e=0;angular.forEach(h,function(t,n){e+=t.selected?1:0}),n.records.hasSelected=e>0,n.records.countSelected=e},100)})};n.dtInstanceCustomerAgentRelationCallback=function(e){n.dtInstanceCustomerAgentRelation=e,n.dtInstanceCustomerAgentRelation.DataTable.on("page",function(){l(function(){n.toggle.isChecked=n.toggle.selectAll},300)}),n.dtInstanceCustomerAgentRelation.DataTable.on("order",function(){l(function(){n.toggle.isChecked=n.toggle.selectAll},300)})},n.reloadData=function(){null!=n.dtInstanceCustomerAgentRelation&&n.dtInstanceCustomerAgentRelation.reloadData(null,!1)},n.onCancel=function(){n.onToggleShowList()},n.onToggle=function(){n.toggle.isChecked=!n.toggle.isChecked,y(C,n.toggle.isChecked)},n.onSelectCurrentPage=function(){n.toggle.isChecked=!0,n.toggle.selectAll&&(y(w,!1),n.toggle.selectAll=!1),y(C,n.toggle.isChecked)},n.onSelectAll=function(){n.toggle.isChecked=!0,n.toggle.selectAll=!0,y(w,n.toggle.selectAll)},n.onDeselectAll=function(){n.toggle.isChecked=!1,n.toggle.selectAll=!1,y(w,n.toggle.selectAll)};var y=function(e,t,o){var a=0;angular.forEach(h,function(n,i){void 0!==o&&o&&(h[i].selected=!1),e.indexOf(parseInt(i))!==-1&&(h[i].selected=t),a+=h[i].selected?1:0});var i=angular.element(".selectedRow");angular.forEach(i,function(e,t){var n=angular.element(e).data("id");angular.element(e).prop("checked",h[n].selected)}),n.records.hasSelected=a>0,n.records.countSelected=a};k()}]);
"use strict";app.controller("termConditionCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$aside","$document","$location","$window",function(e,t,r,o,n,a,i,l,u,s,c,d,p,f,m,g,v){e.loading=!0,e.isView=!1,e.terms=s.parameters("wg_term_condition");var w=function(){e.request={},e.parameter={id:e.terms.length>0?e.terms[0].id:0,namespace:"wgroup",group:"wg_term_condition",item:"",value:"",type:null},e.privacy={id:e.terms.length>0?e.terms[0].id:0,namespace:"wgroup",group:"wg_term_condition",item:"",value:"",type:null}};w(),e.onLoadRecord=function(){d({method:"GET",url:"api/system-parameter/term-condition"})["catch"](function(e,t){}).then(function(t){c(function(){e.parameter=t.data.result})})["finally"](function(){c(function(){e.loading=!1},400),c(function(){m.scrollTop(40,2e3)})})},e.onLoadRecord();var y=function(){d({method:"GET",url:"api/system-parameter/privacy-policy"})["catch"](function(e,t){}).then(function(t){c(function(){e.privacy=t.data.result})})["finally"](function(){c(function(){e.loading=!1},400),c(function(){m.scrollTop(40,2e3)})})};y(),e.form={submit:function(e){var t=null;if(e.$invalid){var r=null,t=null;for(r in e)"$"!=r[0]&&(null!==t||e[r].$valid||(t=e[r].$name),e[r].$pristine&&(e[r].$dirty=!0));return angular.element(".ng-invalid[name="+t+"]").focus(),void p.swal("Error guardando","Se han encontrado errores en el proceso de validación por favor verifique los datos del formulario y vuelva a intentarlo","error")}p.swal("Validación exitosa","Guardando información de los terminos y condiciones","success"),h()},reset:function(e){e.$setPristine(!0)}};var h=function(){var t={},o=JSON.stringify(e.parameter);return t.data=Base64.encode(o),d({method:"POST",url:"api/system-parameter/agree",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(e){c(function(){if("logout"==e.data.result)v.location.href=s.app.rootUrl+"logout";else if("app/clientes/list"==e.data.result)v.location.href=e.data.result;else if(e.data.result.indexOf("/view")!=-1){var t=e.data.result.substring(e.data.result.lastIndexOf("/")+1);s.app.supportHelp&&(s.app.supportHelp.isTermAndCondition=!0),s.currentUser().wg_term_condition="1",u.go("app.clientes.view",{customerId:t})}})})["catch"](function(e){r.error(e),p.swal("Error de guardado","Error guardando el proceso por favor verifique los datos ingresados!","error")})["finally"](function(){})}}]);
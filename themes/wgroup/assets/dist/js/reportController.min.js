"use strict";app.controller("reportCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","SweetAlert","$http",function(t,e,n,i,a,r,o,l,c,s,d,p){var u=n;s.module=c.current.data.module,t.isAgent="agent"==s.currentUser().wg_type,t.isAdmin="system"==s.currentUser().wg_type,t.isCustomer="customerAdmin"==s.currentUser().wg_type||"customerUser"==s.currentUser().wg_type,t.dtOptions=i.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.module=c.current.data.module,JSON.stringify(t)},url:"api/report/v2",contentType:"json/application",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){w()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,n,i){o(angular.element(e).contents())(t)}),t.dtColumns=[a.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,e,n,i){var a="",r='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar"  data-id="'+t.id+'" >   <i class="fa fa-edit"></i></a> ',o='<a class="btn btn-info btn-xs viewRow lnk" href="#" uib-tooltip="Generar" data-id="'+t.id+'" >   <i class="fa fa-play-circle"></i></a> ',l='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+t.id+'" >   <i class="fa fa-trash-o"></i></a> ';return s.can("reportes_generate")&&(a+=o),s.can("reportes_edit")&&(a+=r),s.can("reportes_delete")&&(a+=l),a}),a.newColumn("name").withTitle("Nombre").withOption("width",200),a.newColumn("description").withTitle("Descripción"),a.newColumn(null).withTitle("Estado").withOption("width",200).renderWith(function(t,e,n,i){var a=t.status,r=t.isActive?"label label-success":"label label-danger",o='<span class="'+r+'">'+a+"</span>";return o})];var w=function(){$("#dtReport a.editRow").on("click",function(){var t=$(this).data("id");c.go("app.report.edit",{reportId:t})}),$("#dtReport a.viewRow").on("click",function(){var t=$(this).data("id");c.go("app.report.generate",{reportId:t})}),$("#dtReport a.delRow").on("click",function(){var e=$(this).data("id");u.info("intenta eliminar el registro: "+e),d.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(i){if(i){var a={};a.id=e,p({method:"POST",url:"api/customer-report-delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){n.error(t),d.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){t.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};t.onCreate=function(){c.go("app.report.create")},t.onGenerateDynamically=function(){c.go("app.report.dynamically")},t.dtInstanceCallBack=function(e){t.dtInstance=e},t.reloadData=function(){u.info("reloading..."),t.dtInstance.reloadData()}}]);
"use strict";app.controller("reportTabsCtrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout","$state","$filter","flowFactory","$http",function(t,e,r,a,o,i,p,s,n,c){p.is("app.report.generate")?t.report_title_tab="generate":p.is("app.report.create")?t.report_title_tab="create":p.is("app.report.dynamically")?t.report_title_tab="dynamically":t.report_title_tab="edit";o.currentUser().company;t.isAgent="agent"==o.currentUser().wg_type,t.isAdmin="system"==o.currentUser().wg_type,t.isCustomer="customerAdmin"==o.currentUser().wg_type||"customerUser"==o.currentUser().wg_type,t.report={},t.report.id=t.iscreate?0:e.reportId,t.tabsloaded=["profile"],t.tabname="profile",t.titletab=t.report_title_tab,t.switchTab=function(e,r){i(function(){t.tabname=e,t.titletab=r,t.tabsloaded.push(e)})},t.switchSubTab=function(e){i(function(){t.subtab=e})}}]);
"use strict";app.controller("reportEditCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","SweetAlert","$rootScope","$http","$timeout","$uibModal","flowFactory","cfpLoadingBar","$filter","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder",function(e,o,r,t,a,n,i,l,s,c,d,p,u,f,m,v,g){var w=r;if(e.loading=!0,e.isview=s.is("app.report.view"),e.isCreate=s.is("app.report.create"),e.format="dd-MM-yyyy",e.minDate=new Date-1,e.customers=[],e.collections=[],e.collectionsReport=[],e.collectionsChart=[],e.report={id:e.isCreate?0:o.reportId,collection:null,collectionChart:null,fields:[],name:"",description:"",isActive:!0,allowAgent:!1,allowCustomer:!1,isQueue:!1,requireFilter:!1},e.statusQuote=d.parameters("report_status"),e.open=function(o){o.preventDefault(),o.stopPropagation(),e.opened=!0},e.dateOptions={formatYear:"yy",startingDay:1},e.report.id){w.info("editando cliente con código: "+e.report.id);var C={id:e.report.id};p({method:"GET",url:"api/report",params:C})["catch"](function(e,o){if(403==o){var r=null!==e.message&&void 0!==e.message?e.message:"app.asesores.list";c.swal("No Autorizado","No estas autorizado para ver esta información.","error"),u(function(){s.go(r)},3e3)}else 404==o?(c.swal("Información no disponible","Cotización no encontrada","error"),u(function(){})):c.swal("Error","Se ha presentado un error al intentar acceder a la información del cliente","error")}).then(function(o){console.log(o),u(function(){e.report=o.data.result,void 0==e.report.collectionChart.id&&(e.report.collectionChart=null)})})["finally"](function(){u(function(){y(),e.loading=!1},400)})}else w.info("creacion de nuevo asesor "),e.loading=!1;e.removeImage=function(){e.noImage=!0},e.master=e.report,e.form={submit:function(o){var r=null;if(o.$invalid){var t=null,r=null;for(t in o)"$"!=t[0]&&(null!==r||o[t].$valid||(r=o[t].$name),o[t].$pristine&&(o[t].$dirty=!0));return w.info(e.report),angular.element(".ng-invalid[name="+r+"]").focus(),void c.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}c.swal("Validación exitosa","Guardando información del asesor...","success"),w.info(e.report),h()},reset:function(o){e.report=angular.copy(e.master),o.$setPristine(!0)}};var h=function(){var o={},t=JSON.stringify(e.report);return o.data=Base64.encode(t),p({method:"POST",url:"api/report/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(e){u(function(){s.go("app.report.edit",{reportId:e.data.result.id})})})["catch"](function(e){r.error(e),c.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};e.onCancel=function(){e.isview||c.swal({title:"Está seguro?",text:"Perderá todos los cambios realizados en este formulario.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, cancelar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(e){e?u(function(){s.go("app.report.list")}):swal("Cancelación","La operación ha sido cancelada","error")})};var y=function(){var r={};r.report_id=o.reportId?o.reportId:0,p({method:"POST",url:"api/collection-data",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(r)})["catch"](function(e,o){}).then(function(o){u(function(){e.collections=o.data.data,e.collectionsReport=g("filter")(e.collections,{type:"report"}),e.collectionsChart=g("filter")(e.collections,{type:"chart"})})})["finally"](function(){})};y(),e.settings={bootstrap2:!1,filterClear:"Mostrar todo!",filterPlaceHolder:"Filtrar!",moveSelectedLabel:"Mover seleccionados solamente",moveAllLabel:"Mover todos!",removeSelectedLabel:"Remover seleccionados solamente",removeAllLabel:"Remover todos!",moveOnSelect:!0,preserveSelection:"movido",selectedListLabel:'<span class="label label-success">Campos seleccionados</span>',nonSelectedListLabel:'<span class="label label-info">Campos disponibles</span>',postfix:"_helperz",selectMinHeight:130,filter:!0,filterNonSelected:"",filterSelected:"",infoAll:"Mostrando todos {0}!",infoFiltered:'<span class="label label-warning">Filtered</span> {0} from {1}!',infoEmpty:"Lista vacia!",filterValues:!0}}]);
"use strict";app.controller("reportCalculatedCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","SweetAlert","$rootScope","$http","$timeout","$uibModal","flowFactory","cfpLoadingBar","$filter","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder",function(e,t,a,i,n,o,l,r,c,d,u,s,f,p,w,m,h){var C=a;e.calculatedField={id:0,report:e.report,name:"",title:"",expression:"",isActive:!0,field:null},e.clear=function(){f(function(){e.calculatedField={id:0,report:e.report,name:"",title:"",expression:"",isActive:!0,field:null}})},e.form={submit:function(t){var a=null;if(t.$invalid){var i=null,a=null;for(i in t)"$"!=i[0]&&(null!==a||t[i].$valid||(a=t[i].$name),t[i].$pristine&&(t[i].$dirty=!0));return C.info(e.report),angular.element(".ng-invalid[name="+a+"]").focus(),void d.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}d.swal("Validación exitosa","Guardando información del asesor...","success"),C.info(e.report),v()},reset:function(t){e.calculatedField=angular.copy(e.master),t.$setPristine(!0)}};var v=function(){var t={},i=JSON.stringify(e.calculatedField);return t.data=Base64.encode(i),s({method:"POST",url:"api/report-calculated/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){f(function(){e.reloadData(),e.clear()})})["catch"](function(e){a.error(e),d.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){e.reloadData(),e.clear()})};e.onCancel=function(){e.isview?c.go("app.report.list"):d.swal({title:"Está seguro?",text:"Perderá todos los cambios realizados en este formulario.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, cancelar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(e){e?f(function(){c.go("app.report.list")}):swal("Cancelación","La operación ha sido cancelada","error")})},e.onLoadRecord=function(){if(0!=e.calculatedField.id){C.info("editando campo calculado : "+e.calculatedField.id);var t={id:e.calculatedField.id,report_id:e.calculatedField.report.id};s({method:"GET",url:"api/report-calculated",params:t})["catch"](function(e,t){}).then(function(t){f(function(){e.calculatedField=t.data.result})})["finally"](function(){f(function(){e.loading=!1},400),f(function(){$document.scrollTop(40,2e3)})})}else C.info("creacion de nuevo cliente"),e.loading=!1};var g={};g.operation="report-calculated",g.report_id=t.reportId,e.dtInstanceCalculated={},e.dtOptionsCalculated=i.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:g,url:"api/report-calculated",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){O()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,a,i){l(angular.element(t).contents())(e)}),e.dtColumnsCalculated=[n.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,t,a,i){var n="",o="",l='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar"  data-id="'+e.id+'"'+o+' >   <i class="fa fa-edit"></i></a> ',r=('<a class="btn btn-info btn-xs viewRow lnk" href="#"  uib-tooltip="Ver" data-id="'+e.id+'" >   <i class="fa fa-eye"></i></a> ','<a class="btn btn-danger btn-xs delRow lnk" href="#"  uib-tooltip="Eliminar" data-id="'+e.id+'"'+o+' >   <i class="fa fa-trash-o"></i></a> ');return u.can("reportes_edit")&&(n+=l),u.can("reportes_delete")&&(n+=r),n}),n.newColumn("name").withTitle("Nombre").withOption("width",200),n.newColumn("title").withTitle("Título").withOption("width",200),n.newColumn("expression").withTitle("Fórmula").withOption("width",200),n.newColumn(null).withTitle("Estado").withOption("width",200).renderWith(function(e,t,a,i){var n="",o="";e.isActive?(n="label label-success",o="Activo"):(n="label label-danger",o="Inactivo");var l='<span class="'+n+'">'+o+"</span>";return l})];var O=function(){$("#dtOptionsCalculated a.editRow").on("click",function(){var t=$(this).data("id");e.editCalculatedField(t)}),$("#dtOptionsCalculated a.delRow").on("click",function(){var t=$(this).data("id");C.info("intenta eliminar el registro: "+t),d.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(i){if(i){var n={};n.id=t,s({method:"POST",url:"api/customer-report-calculated-delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){a.error(e),d.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){e.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};e.onAddField=function(){null!=e.calculatedField.field&&(e.calculatedField.expression=e.calculatedField.expression+e.calculatedField.field.table+"."+e.calculatedField.field.name)},e.dtInstanceCalculatedCallback=function(t){e.dtInstanceCalculated=t},e.reloadData=function(){e.dtInstanceCalculated.reloadData()},e.editCalculatedField=function(t){e.clear(),e.calculatedField.id=t,e.onLoadRecord()}}]);
"use strict";app.controller("reportChartCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","SweetAlert","$rootScope","$http","$timeout","$uibModal","flowFactory","cfpLoadingBar","$filter","$document",function(r,e,o,t,a,n,i,l,c,d,p,s,u,f,h,m,C,v){var g=o;r.fields=[],r.reportChart={id:0,report:r.report,chartType:"",fieldX:null,fieldY:null},r.clear=function(){u(function(){r.reportChart={id:0,report:r.report,chartType:"",fieldX:{},fieldY:{}}})},r.form={submit:function(e){var o=null;if(e.$invalid){var t=null,o=null;for(t in e)"$"!=t[0]&&(null!==o||e[t].$valid||(o=e[t].$name),e[t].$pristine&&(e[t].$dirty=!0));return g.info(r.report),angular.element(".ng-invalid[name="+o+"]").focus(),void d.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}d.swal("Validación exitosa","Guardando información del asesor...","success"),g.info(r.report),w()},reset:function(e){r.reportChart=angular.copy(r.master),e.$setPristine(!0)}};var w=function(){var e={};r.reportChart.report=r.report;var t=JSON.stringify(r.reportChart);return e.data=Base64.encode(t),s({method:"POST",url:"api/report-chart/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){u(function(){r.onLoadRecord()})})["catch"](function(r){o.error(r),d.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};r.onCancel=function(){r.isview?c.go("app.report.list"):d.swal({title:"Está seguro?",text:"Perderá todos los cambios realizados en este formulario.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, cancelar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(r){r?u(function(){c.go("app.report.list")}):swal("Cancelación","La operación ha sido cancelada","error")})},r.onLoadRecord=function(){if(0!=r.reportChart.report.id){g.info("editando campo calculado : "+r.reportChart.id);var e={id:r.reportChart.id,report_id:r.reportChart.report.id};s({method:"POST",url:"api/report-chart",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)})["catch"](function(r,e){}).then(function(e){u(function(){r.fields=e.data.result,r.reportChart.fieldX=C("filter")(r.fields,{axisType:"x"}),r.reportChart.fieldY=C("filter")(r.fields,{axisType:"y"})})})["finally"](function(){u(function(){r.loading=!1},400),u(function(){v.scrollTop(40,2e3)})})}else g.info("creacion de nuevo cliente"),r.loading=!1},r.onLoadRecord(),r.onAddField=function(){null!=r.reportChart.field&&(r.reportChart.expression=r.reportChart.expression+r.reportChart.field.table+"."+r.reportChart.field.name)}}]);
"use strict";app.controller("reportDynamicallyCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","SweetAlert","$rootScope","$http","$timeout","$uibModal","flowFactory","cfpLoadingBar","$filter","$sce","ListService","ngNotify",function(e,t,i,a,o,l,n,r,s,c,d,u,f,p,m,v,b,g,h,y){function w(){var t=[{name:"criteria_operators",value:null},{name:"criteria_conditions",value:null},{name:"export_url",value:null}];h.getDataList(t).then(function(t){L=t.data.data.exportUrl.item,e.criteria=t.data.data.criteriaOperatorList,e.conditions=t.data.data.criteriaConditionList},function(t){e.status="Unable to load customer data: "+t.message})}var C=i,L="";e.settings={bootstrap2:!1,filterClear:"Mostrar todo!",filterPlaceHolder:"Filtrar!",moveSelectedLabel:"Mover seleccionados solamente",moveAllLabel:"Mover todos!",removeSelectedLabel:"Remover seleccionados solamente",removeAllLabel:"Remover todos!",moveOnSelect:!0,preserveSelection:"movido",selectedListLabel:'<span class="label label-success">Campos seleccionados</span>',nonSelectedListLabel:'<span class="label label-info">Campos disponibles</span>',postfix:"_helperz",selectMinHeight:130,filter:!0,filterNonSelected:"",filterSelected:"",infoAll:"Mostrando todos {0}!",infoFiltered:'<span class="label label-warning">Filtered</span> {0} from {1}!',infoEmpty:"Lista vacia!",filterValues:!0},e.loading=!0,e.isView=s.is("app.report.view"),e.isCreate=s.is("app.report.create"),e.audit={fields:[],filters:[],hideButtons:!0},w();var S=function(){u({method:"POST",url:"api/collection-data",headers:{"Content-Type":"application/x-www-form-urlencoded"}})["catch"](function(e,t){}).then(function(t){f(function(){e.collections=t.data.data,e.collectionReportList=b("filter")(e.collections,{type:"report"}),e.loading=!1})})["finally"](function(){})};S();var D=function(){e.report={collection:null,fields:[]}};D(),e.form={submit:function(t){var i=null;if(t.$invalid){var a=null,i=null;for(a in t)"$"!=a[0]&&(null!==i||t[a].$valid||(i=t[a].$name),t[a].$pristine&&(t[a].$dirty=!0));return C.info(e.report),angular.element(".ng-invalid[name="+i+"]").focus(),void c.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}x()},reset:function(e){e.$setPristine(!0)}};var x=function(){var t="";if(null!=e.report.fields&&0!=e.report.fields.length||(t+="Debe seleccionar al menos un campo disponible de la colección \n"),""!=t)return void c.swal({html:!1,title:"Error de validación",text:t,type:"error"});y.set('<div class="row"><div class="col-sm-5"><div class="loader-spinner pull-right"></div> </div> <div class="col-sm-6 text-left">El reporte se está generando. Por favor espere!</div> </div>',{position:"bottom",sticky:!0,button:!1,html:!0});var i={id:e.report.collection.id,isQueue:e.report.isQueue,fields:e.report.fields.map(function(e,t,i){return{name:e.name,alias:e.alias}}),userId:d.currentUser().id};angular.isDefined(e.audit)&&angular.isDefined(e.audit.filters)&&(i.filter={filters:e.audit.filters.filter(function(e){return null!=e&&null!=e.field}).map(function(e,t,i){return{field:e.field.value,operator:e.criteria.value,value:e.value,condition:e.condition.value}})});var a={data:Base64.encode(JSON.stringify(i))};return u({method:"POST",url:L+"api/v1/report-export-dynamically",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(e){var t=L+"storage/"+e.data.filename,i='<a class="btn btn-wide btn-default" href="'+t+'" target="_self"><i class="glyphicon glyphicon-download"></i> Descargar el reporte</a>';e.data.isQueue&&(t="app/user/messages",i=e.data.message+' <a  class="btn btn-wide btn-default" href="'+t+'" translate="Ver mensajes"> Ver mensajes </a>'),y.set(i,{position:"bottom",sticky:!0,type:e.data.isQueue?"info":"success",button:!0,html:!0})})["catch"](function(e){null!=e.data&&void 0!==e.data.message?y.set(e.data.message,{position:"bottom",sticky:!0,type:"error",button:!0,html:!0}):y.set("Lo sentimos, ha ocurrido un error en la generación del reporte",{position:"bottom",sticky:!0,type:"error",button:!0,html:!0})})["finally"](function(){})};e.onCancel=function(){e.isView||c.swal({title:"Está seguro?",text:"Se perderán todos los cambios realizados en esta vista.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, cancelar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(e){e?f(function(){s.go("app.report.list")}):swal("Cancelación","La operación ha sido cancelada","error")})},e.addFilter=function(){null==e.audit.filters&&(e.audit.filters=[]),e.audit.filters.push({id:0,field:null,criteria:e.criteria.length>0?e.criteria[1]:null,condition:e.conditions.length>0?e.conditions[0]:null,value:""})},e.removeFilter=function(t){e.audit.filters.splice(t,1)},e.onSelectCollection=function(){e.audit.filters=e.audit.filters.map(function(e,t,i){return e.field=null,e}),e.audit.fields=e.report.collection.fields.map(function(e,t,i){return{alias:e.alias,value:e.name}})}}]);
"use strict";app.controller("reportDynamicallyTabsCtrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout","$state","$filter","flowFactory","$http",function(t,e,r,a,o,i,p,s,n,c){var l=r;l.info("loading..reportDynamicallyTabsCtrl!!! ");var l=r;p.is("app.report.generate")?t.report_title_tab="generate":p.is("app.report.create")?t.report_title_tab="create":p.is("app.report.dynamically")?t.report_title_tab="dynamically":t.report_title_tab="edit";o.currentUser().company;t.isAgent="agent"==o.currentUser().wg_type,t.isAdmin="system"==o.currentUser().wg_type,t.isCustomer="customerAdmin"==o.currentUser().wg_type||"customerUser"==o.currentUser().wg_type,t.report={},t.report.id=t.iscreate?0:e.reportId,t.tabsloaded=["profile"],t.tabname="profile",t.titletab=t.report_title_tab,t.switchTab=function(e,r){i(function(){t.tabname=e,t.titletab=r,t.tabsloaded.push(e)})},t.switchSubTab=function(e){i(function(){t.subtab=e})}}]);
"use strict";app.controller("reportGenerateCtrl",["$scope","$stateParams","$log","$compile","toaster","$state","SweetAlert","$rootScope","$http","$timeout","$uibModal","flowFactory","cfpLoadingBar","$filter","ListService","ngNotify","$sce",function(e,t,r,i,a,o,n,l,s,u,c,d,f,p,m,v,g){function h(){var t=[{name:"criteria_operators",value:null},{name:"criteria_conditions",value:null},{name:"export_url",value:null}];m.getDataList(t).then(function(t){b=t.data.data.exportUrl.item,e.criteria=t.data.data.criteriaOperatorList,e.conditions=t.data.data.criteriaConditionList},function(t){e.status="Unable to load customer data: "+t.message})}var w=r,b="",y=l.isCustomer();l.isAgent(),l.isAdmin();e.loading=!0,e.isView=o.is("app.report.view"),e.isCreate=o.is("app.report.create"),e.audit={fields:[],filters:[],hideButtons:!0},h(),e.report={id:e.isCreate?0:t.reportId,collection:null,collectionChart:null,name:"",description:"",isActive:!0,allowAgent:!1,allowCustomer:!1};var C=function(){if(e.report.id){w.info("editando cliente con código: "+e.report.id);var t={id:e.report.id};s({method:"GET",url:"api/report",params:t})["catch"](function(e,t){if(403==t){var r=null!==e.message&&void 0!==e.message?e.message:"app.asesores.list";n.swal("No Autorizado","No estas autorizado para ver esta informaci�n.","error"),u(function(){o.go(r)},3e3)}else 404==t?(n.swal("Información no disponible","Reporte no encontrada","error"),u(function(){})):n.swal("Error","Se ha presentado un error al intentar acceder a la información del reporte","error")}).then(function(t){u(function(){e.report=t.data.result,e.report.requireFilter&&!y&&e.addFilter(),e.audit.fields=e.report.fields.map(function(e,t,r){return{alias:e.alias,value:e.name}})})})["finally"](function(){e.loading=!1})}else e.loading=!1};C(),e.form={submit:function(t){var r=null;if(t.$invalid){var i=null,r=null;for(i in t)"$"!=i[0]&&(null!==r||t[i].$valid||(r=t[i].$name),t[i].$pristine&&(t[i].$dirty=!0));return w.info(e.report),angular.element(".ng-invalid[name="+r+"]").focus(),void n.swal("El formulario contiene errores!","Lo sentimos, este reporte requiere de al menos 1 filtro.","error")}L()},reset:function(e){e.$setPristine(!0)}};var L=function(){if(e.report.requireFilter&&!y){var t=e.audit.filters.filter(function(e){return null!=e&&null!=e.field});if(0==t.length)return void v.set("Lo sentimos, este reporte requiere de al menos 1 filtro.",{position:"bottom",sticky:!0,type:"error",button:!0,html:!0})}v.set('<div class="row"><div class="col-sm-5"><div class="loader-spinner pull-right"></div> </div> <div class="col-sm-6 text-left">El reporte se está generando. Por favor espere!</div> </div>',{position:"bottom",sticky:!0,button:!1,html:!0});var r={id:e.report.id,userId:l.currentUser().id};angular.isDefined(e.audit)&&angular.isDefined(e.audit.filters)&&(r.filter={filters:e.audit.filters.filter(function(e){return null!=e&&null!=e.field}).map(function(e,t,r){return{field:e.field.value,operator:e.criteria.value,value:e.value,condition:e.condition.value}})});var i={data:Base64.encode(JSON.stringify(r))};return s({method:"POST",url:b+"api/v1/report-export",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(e){var t=b+"storage/"+e.data.filename,r='<a class="btn btn-wide btn-default" href="'+t+'" target="_self"><i class="glyphicon glyphicon-download"></i> Descargar el reporte</a>';e.data.isQueue&&(t="app/user/messages",r=e.data.message+' <a  class="btn btn-wide btn-default" href="'+t+'" translate="Ver mensajes"> Ver mensajes </a>'),v.set(r,{position:"bottom",sticky:!0,type:e.data.isQueue?"info":"success",button:!0,html:!0})})["catch"](function(e){null!=e.data&&void 0!==e.data.message?v.set(e.data.message,{position:"bottom",sticky:!0,type:"error",button:!0,html:!0}):v.set("Lo sentimos, ha ocurrido un error en la generación del reporte",{position:"bottom",sticky:!0,type:"error",button:!0,html:!0})})["finally"](function(){})};e.onCancel=function(){e.isView||n.swal({title:"Está seguro?",text:"Se perderán todos los cambios realizados en esta vista.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, cancelar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(e){e?u(function(){o.go("app.report.list")}):swal("Cancelación","La operación ha sido cancelada","error")})},e.addFilter=function(){null==e.audit.filters&&(e.audit.filters=[]),e.audit.filters.push({id:0,field:null,criteria:e.criteria.length>0?e.criteria[1]:null,condition:e.conditions.length>0?e.conditions[0]:null,value:""})},e.removeFilter=function(t){e.audit.filters.splice(t,1)}}]);
"use strict";app.controller("reportGenerateTabsCtrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout","$state","$filter","flowFactory","$http",function(t,e,r,a,o,i,p,s,n,c){var l=r;l.info("loading..reportDynamicallyTabsCtrl!!! ");var l=r;p.is("app.report.generate")?t.report_title_tab="generate":p.is("app.report.create")?t.report_title_tab="create":p.is("app.report.dynamically")?t.report_title_tab="dynamically":t.report_title_tab="edit";o.currentUser().company;t.isAgent="agent"==o.currentUser().wg_type,t.isAdmin="system"==o.currentUser().wg_type,t.isCustomer="customerAdmin"==o.currentUser().wg_type||"customerUser"==o.currentUser().wg_type,t.report={},t.report.id=t.iscreate?0:e.reportId,t.tabsloaded=["profile"],t.tabname="profile",t.titletab=t.report_title_tab,t.switchTab=function(e,r){i(function(){t.tabname=e,t.titletab=r,t.tabsloaded.push(e)})},t.switchSubTab=function(e){i(function(){t.subtab=e})}}]);
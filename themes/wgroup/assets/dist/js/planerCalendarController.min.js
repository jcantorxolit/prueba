"use strict";app.controller("planerCalendarCtrl",["$scope","$aside","SweetAlert","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","$filter","calendarConfig",function(e,r,o,t,a,n,i,l,s,c,d,u,p,f,m,g){var v=new Date,y=v.getDate(),w=v.getMonth(),h=v.getFullYear();e.IsEdited=!1,e.events=[],e.isAgent="agent"==u.currentUser().wg_type,e.isAdmin="system"==u.currentUser().wg_type,e.isCustomer="customerAdmin"==u.currentUser().wg_type||"customerUser"==u.currentUser().wg_type,e.calendarView="month",e.calendarDay=new Date,e.calendarDate=new Date,e.calendarTitle=null,e.eventClicked=function(o){e.IsEdited=!0;var t=r.open({templateUrl:u.app.views.urlRoot+"modules/planer/planer_calendar_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideTaskPlanerCtrl",scope:e,resolve:{event:function(){return o},isView:function(){return e.isView}}});t.result.then(function(e,r){T()},function(){a.info("Modal dismissed at: "+new Date)})},e.addEvent=function(){e.IsEdited=!1;var o={title:"",startsAt:new Date(h,w,y,10,0),endsAt:new Date(h,w,y,11,0),type:"job"},t=r.open({templateUrl:u.app.views.urlRoot+"modules/planer/planer_calendar_customer_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideTaskPlanerCustomerCtrl",scope:e,resolve:{event:function(){return o},isView:function(){return e.isView}}});t.result.then(function(e,r){T()},function(){a.info("Modal dismissed at: "+new Date)})},e.toggle=function(e,r,o){e.preventDefault(),e.stopPropagation(),o[r]=!o[r]};var T=function(){var r={},t=JSON.stringify(e.customer);return r.data=t,f({method:"POST",url:"api/project/task",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(r)}).then(function(r){p(function(){e.events=r.data.data,e.events.forEach(function(e){switch(e.startsAt=new Date(e.startsAt.date),e.endsAt=new Date(e.endsAt.date),e.color={},e.type){case"job":e.color.primary=g.colorTypes.job,e.color.secondary=g.colorTypes.jobSec;break;case"home":e.color.primary=g.colorTypes.home,e.color.secondary=g.colorTypes.homeSec;break;case"off-site-work":e.color.primary=g.colorTypes.offSiteWork,e.color.secondary=g.colorTypes.offSiteWorkSec;break;case"cancelled":e.color.primary=g.colorTypes.cancelled,e.color.secondary=g.colorTypes.cancelledSec;break;case"generic":e.color.primary=g.colorTypes.generic,e.color.secondary=g.colorTypes.genericSec;break;case"to-do":e.color.primary=g.colorTypes.toDo,e.color.secondary=g.colorTypes.toDoSec}})})})["catch"](function(e){a.error(e),o.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};T()}]),app.controller("ModalInstanceSideTaskPlanerCtrl",["$scope","$rootScope","$uibModalInstance","event","$log","$timeout","SweetAlert","isView","$http","toaster",function(e,r,o,t,a,n,i,l,s,c){e.event=t,e.isView=!0,e.onClose=function(){o.close(1)},e.cancel=function(){o.dismiss("cancel")},e.cancelTask=function(e){e.status="cancelado",d(e)},e.completeTask=function(e){"agentTask"==e.tableName?e.status="inactivo":"actionPlan"!=e.tableName&&"tracking"!=e.tableName||(e.status="completado"),d(e)},e.reloadlTask=function(e){};var d=function(r){var o={},t=JSON.stringify(r);return o.data=Base64.encode(t),s({method:"POST",url:"api/project/event/update",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(r){n(function(){c.pop("success","Calendario","La información ha sido guardada satisfactoriamente."),e.onClose()})})["catch"](function(e){a.error(e),i.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})}}]),app.controller("ModalInstanceSideTaskPlanerCustomerCtrl",["$scope","$rootScope","$uibModalInstance","event","$log","$timeout","SweetAlert","isView","$http","$filter","toaster",function(e,r,o,t,a,n,i,l,s,c,d){e.agents=r.agents(),e.typesTraking=r.parameters("tracking_tiposeg"),e.event={id:0,created_at:c("date")(new Date,"dd/MM/yyyy HH:mm"),customerId:r.currentUser().company,agent:null,type:null,isVisible:!0,isEventSchedule:!0,isCustomer:!0,module:"planner",observation:"",eventDate:new Date,status:{value:"iniciado"},alerts:[{id:0,type:null,timeType:null,time:0,preference:null,sent:0,status:null}]},e.onClose=function(){o.close(1)},e.onCancel=function(){o.dismiss("cancel")},e.form={submit:function(r){var o=null;if(r.$invalid){var t=null,o=null;for(t in r)"$"!=t[0]&&(null!==o||r[t].$valid||(o=r[t].$name),r[t].$pristine&&(r[t].$dirty=!0));return angular.element(".ng-invalid[name="+o+"]").focus(),void d.pop("error","El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.")}return null==e.event.eventDate?void d.pop("error","El formulario contiene errores!","Por favor seleccione la fecha."):void u()},reset:function(e){e.$setPristine(!0)}},e.reloadlTask=function(e){};var u=function(){var r={},o=JSON.stringify(e.event);return r.data=Base64.encode(o),s({method:"POST",url:"api/tracking/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(r)}).then(function(r){n(function(){d.pop("success","Calendario","La información ha sido guardada satisfactoriamente."),e.onClose()})})["catch"](function(e){a.error(e),i.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})},p=function(){var o={};return o.customerId=r.currentUser().company,s({method:"POST",url:"api/tracking/agent",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(r){n(function(){r.data.data.length>0&&(e.agents=r.data.data)})})["catch"](function(e){a.error(e),i.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};p()}]);
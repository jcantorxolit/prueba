"use strict";app.controller("internalProjectCtrl",["$scope","flowFactory","$aside","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$filter","$uibModal","ListService","ChartService",function(e,t,r,n,o,a,l,i,c,u,s,d,m,f,p,h,g,v,C){function w(){var t=[{name:"customer_internal_project_year",value:null},{name:"project_type",value:null},{name:"month_options",value:null},{name:"current_year",value:null},{name:"current_month",value:null},{name:"current_customer",value:e.currentCustomerId}];v.getDataList(t).then(function(t){e.years=t.data.data.yearList,e.months=t.data.data.monthOptions,e.currentCustomer=t.data.data.currentCustomer,e.typeList=t.data.data.project_type,e.years.length>0?e.filter.selectedYear=e.years[0]:e.filter.selectedYear={id:t.data.data.currentYear,item:t.data.data.currentYear,value:t.data.data.currentYear};var r=h("filter")(e.months,{value:t.data.data.currentMonth});r.length>0&&(e.filter.selectedMonth=r[0])},function(t){e.status="Unable to load customer data: "+t.message})}function y(){var t=[{name:"chart_doughnut_options",criteria:null}];C.getDataChart(t).then(function(t){e.chart.doughnut.options=t.data.data.chartDoughnutOptions,e.chart.doughnut.options.legend.position="top",e.chart.doughnut.options.maintainAspectRatio=!1,e.chart.doughnut.options.responsive=!1},function(t){e.status="Unable to load customer data: "+t.message})}function j(t,n){var o=r.open({templateUrl:d.app.views.urlRoot+"modules/internalproject/project_edit_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInternalProjectInstanceSideCtrl",scope:e,resolve:{customer:function(){return e.currentCustomer?e.currentCustomer:e.filter.selectedCustomer},project:function(){return t},isView:function(){return n}}});o.result.then(function(t,r){e.currentProjectAgentId=0,_(),S(),A()},function(){})}e.currentProjectAgentId=0,e.isCustomerAgent=d.isCustomerUser(),e.isCustomerAdmin=d.isCustomerAdmin(),e.isAdmin=d.isAdmin(),e.isAgent=d.isAgent(),e.customerList=[],e.currentCustomerId=d.isCustomer()?d.currentUser().company:0,e.filter={selectedCustomer:null,selectedAgent:"",selectedMonth:null,selectedYear:null,selectedOS:null,selectedType:null},e.typeList=d.parameters("project_type"),e.chart={bar:{options:null},doughnut:{options:null},programs:{data:null},summary:{data:null,total:0}},w(),y(),e.onAddProject=function(){j({id:0})},e.onEditProject=function(t){j(t,e.isView)},e.onViewProject=function(e){j(e,!0)},e.onViewProjectTask=function(t){var n=r.open({templateUrl:d.app.views.urlRoot+"modules/internalproject/project_task_view_modal.htm",placement:"bottom",size:"lg",backdrop:!0,controller:"ModalInternalProjectTaskViewInstanceSideCtrl",scope:e,resolve:{project:function(){return t},isView:function(){return e.isView}}});n.result.then(function(t,r){e.currentProjectAgentId=0,_(),S(),A()},function(){})},e.onAddProjectTask=function(t){var n=r.open({templateUrl:d.app.views.urlRoot+"modules/internalproject/project_task_edit_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideInternalProjectTaskCtrl",scope:e,resolve:{customer:function(){return e.currentCustomer?e.currentCustomer:e.filter.selectedCustomer},project:function(){return t},isView:function(){return e.isView}}});n.result.then(function(t,r){e.currentProjectAgentId=0,_(),S(),A()},function(){})};var S=function(){e.customer={};var t=e.currentCustomerId;(e.isAdmin||e.isAgent)&&(t=0!=e.currentCustomerId?e.currentCustomerId:-1);var r={data:Base64.encode(JSON.stringify(e.customer)),customer_id:t,agent_id:null!=e.filter.selectedAgent?e.filter.selectedAgent.id:0,month:null!=e.filter.selectedMonth?e.filter.selectedMonth.value:0,year:null!=e.filter.selectedYear?e.filter.selectedYear.value:0,os:""!=e.filter.selectedOS?e.filter.selectedOS:"",type:null!=e.filter.selectedType?e.filter.selectedType.id:""};return f({method:"POST",url:"api/internal-project/summary",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(r)}).then(function(t){m(function(){e.projects=t.data.data})})["catch"](function(e){o.error(e),p.swal("Error de Aplicación","Error cargando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})},_=function(){var t={};e.customer={};var r=JSON.stringify(e.customer);return t.data=Base64.encode(r),e.isAdmin||e.isAgent?t.customer_id=0!=e.currentCustomerId?e.currentCustomerId:-1:t.customer_id=e.currentCustomerId,t.agent_id=null!=e.filter.selectedAgent?e.filter.selectedAgent.id:0,t.month=null!=e.filter.selectedMonth?e.filter.selectedMonth.value:0,t.year=null!=e.filter.selectedYear?e.filter.selectedYear.value:0,t.os=""!=e.filter.selectedOS?e.filter.selectedOS:"",t.type=null!=e.filter.selectedType?e.filter.selectedType.id:"",f({method:"POST",url:"api/internal-project/setting",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){m(function(){t.data.data.length>0?e.summaryProject=t.data.data[0]:e.summaryProject={assignedHours:0,scheduledHours:0,runningHours:0,total:0,data:[{value:0,color:"#46BFBD",highlight:"#5AD3D1",label:"Asignadas"},{value:0,color:"#FDB45C",highlight:"#FFC870",label:"Ejecutadas"}]}})})["catch"](function(e){o.error(e),p.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};e.onSelectAgent=function(e,t){m(function(){S(),_()})},e.onClearAgent=function(){m(function(){e.filter.selectedAgent=null,S(),_()})},e.onSelectMonth=function(e,t){m(function(){S(),_()})},e.onClearMonth=function(){m(function(){e.filter.selectedMonth=null,S(),_()})},e.onSelectYear=function(){m(function(){S(),_()})},e.onClearYear=function(){m(function(){e.filter.selectedYear=null,S(),_()})},e.onSearchOS=function(){m(function(){S(),_()})},e.onClearOS=function(){m(function(){e.filter.selectedOS="",S(),_()})},e.onSelectType=function(e,t){m(function(){S(),_()})},e.onClearType=function(){m(function(){e.filter.selectedType=null,S(),_()})},e.onSendStatus=function(){var t={id:0,status:"sendStatus",tracking:{action:"",description:""}},r=g.open({templateUrl:d.app.views.urlRoot+"modules/internalproject/project_status_modal.htm",controller:"ModalInstanceInternalProjectTrackingCtrl",windowTopClass:"top-modal",resolve:{project:function(){return t},action:function(){return"Enviar Estado Proyectos"},filters:function(){return e.filter},customerId:function(){return e.currentCustomerId}}});r.result.then(function(e){},function(){})},e.onAddAttachment=function(t){var n=r.open({templateUrl:d.app.views.urlRoot+"modules/customer/common/modals/customer_document_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInternalProjectAttachmentInstanceSideCtrl",scope:e,resolve:{item:function(){return t},customer:function(){return e.currentCustomer?e.currentCustomer:e.filter.selectedCustomer},isView:function(){return e.isView}}});n.result.then(function(){},function(){o.info("Modal dismissed at: "+new Date)})},e.onAddComment=function(t){var n=r.open({templateUrl:d.app.views.urlRoot+"modules/customer/common/modals/customer_questions_comment_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInternalProjecCommentInstanceSideCtrl",scope:e,resolve:{item:function(){return t},isView:function(){return e.isView}}});n.result.then(function(){e.reloadData()},function(){o.info("Modal dismissed at: "+new Date)})},e.onExportPdf=function(){kendo.drawing.drawDOM($(".internal-project-export-pdf")).then(function(e){return kendo.drawing.exportPDF(e,{paperSize:"auto",margin:{left:"1cm",top:"1cm",right:"1cm",bottom:"1cm"}})}).done(function(e){kendo.saveAs({dataURI:e,fileName:"PLANES_DE_TRABAJO_INTERNOS.pdf",proxyURL:"//demos.telerik.com/kendo-ui/service/export"})})};var A=function(){var t={};e.customer={};var r=JSON.stringify(e.customer);return t.data=Base64.encode(r),f({method:"POST",url:"api/internal-project/report",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){m(function(){t.data.data.length>0&&(e.recentTasks=t.data.data)})})["catch"](function(e){o.error(e),p.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})},I=function(){var t={};return t.customerId=e.currentCustomerId,f({method:"POST",url:"api/internal-project/listCustomer",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){m(function(){e.agentsFilter=t.data.data.users,e.typeList=t.data.data.projectTypes})})["catch"](function(e){o.error(e),p.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})},P=function(){var t={},r=JSON.stringify(e.customer);return t.data=r,f({method:"POST",url:"api/internal-project/task",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){m(function(){e.events=t.data.data,e.events.forEach(function(e){e.starts_at=new Date(e.starts_at.date),e.ends_at=new Date(e.ends_at.date)})})})["catch"](function(e){o.error(e),p.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};_(),S(),A(),I(),P(),e.refresAll=function(){_(),S(),A()},e.onSelectCustomer=function(){e.currentCustomerId=e.filter.selectedCustomer.value,I(),S(),_()},e.onClearCustomer=function(){e.filter.selectedCustomer=null,e.currentCustomerId=0,I(),S(),_()},e.onSearchCustomer=function(){var t=r.open({templateUrl:d.app.views.urlRoot+"modules/common/modals/data_table_list_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideProjectInternalSearchCustomerCtrl",scope:e,windowTopClass:"top-modal",resolve:{}});t.result.then(function(t){var r=h("filter")(e.customerList,{id:t.id});0==r.length&&e.customerList.push(t),e.filter.selectedCustomer=t,e.onSelectCustomer()},function(){})}}]);
app.controller("ModalInternalProjectInstanceSideCtrl",["$rootScope","$scope","$uibModalInstance","project","customer","$log","$timeout","SweetAlert","isView","$http","$filter","toaster","ListService",function(e,r,t,a,o,n,i,c,s,l,d,u,p){r.types=e.parameters("project_type"),r.isView=s,r.datePickerConfig={culture:"es-CO",format:"dd/MM/yyyy hh:mm tt"};var f=function(){r.project={id:a.id,customer:o,name:null,deliveryDate:new Date,estimatedHours:0,isRecurrent:!1,serviceOrder:"",isBilled:!1,invoiceNumber:"",type:null,status:null,defaultSkill:null,agents:[]},r.project.projectTask={id:0,projectAgentId:0,type:null,task:"",observation:"",startDateTime:new Date,endDateTime:new Date,status:"activo"}};f();var m=function(){if(r.project.id){var e={id:a.id};l({method:"GET",url:"api/internal-project",params:e})["catch"](function(e,r){if(403==r){var t=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";c.swal("No Autorizado","No estas autorizado para ver esta información.","error"),i(function(){$state.go(t)},3e3)}else 404==r?(c.swal("Información no disponible","Aporte no encontrado","error"),i(function(){$state.go("app.clientes.list")})):c.swal("Error","Se ha presentado un error al intentar acceder a la información del aporte","error")}).then(function(e){i(function(){r.project=e.data.result,r.project.deliveryDate&&(r.project.deliveryDate=new Date(r.project.deliveryDate.date)),r.project.customer=r.project.customer[0],h(r.project.defaultSkill.id)})})["finally"](function(){i(function(){r.loading=!1},400)})}};m(),r.onClose=function(){t.close(1)},r.onCancel=function(){t.dismiss("cancel")},r.form={submit:function(e){var t=null;if(e.$invalid){var a=null,t=null;for(a in e)"$"!=a[0]&&(null!==t||e[a].$valid||(t=e[a].$name),e[a].$pristine&&(e[a].$dirty=!0));return angular.element(".ng-invalid[name="+t+"]").focus(),void i(function(){u.pop("error","Error","Por favor verifique los datos requeridos del formulario y vuelva a intentarlo")},500)}return 0==r.project.agents.length?void u.pop("error","Error","Debe adicionar al menos un recurso"):void g()},reset:function(e){e.$setPristine(!0)}};var g=function(){var e={};if(null!=r.project.deliveryDate){r.project.event_date=r.project.deliveryDate.toISOString();var t=JSON.stringify(r.project);return e.data=Base64.encode(t),l({method:"POST",url:"api/internal-project/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){i(function(){i(function(){u.pop("success","Operación Exitosa","La información ha sido guardada satisfactoriamente")},500),r.projectTask=e.data.result,r.onClose()})})["catch"](function(e){n.error(e),c.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})}c.swal("Error de guardado","Error guardando el cliente por favor verifique la fecha ingresada!","error")},v=function(){var e={};return e.customerId=o.id,l({method:"POST",url:"api/internal-project/listCustomer",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){i(function(){r.agentsFilter=e.data.data.users,r.types=e.data.data.projectTypes,r.skills=e.data.data.userSkills})})["catch"](function(e){n.error(e),c.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};v();var h=function(e){var t={};t.skill=e;var a=JSON.stringify(r.customer);return t.data=a,t.customerId=o.id,l({method:"POST",url:"api/internal-project/agent",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(e){i(function(){r.agentList=e.data.data})})["catch"](function(e){n.error(e),c.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};r.addAgent=function(e){c.swal({title:"Está seguro?",text:"Confirmas adicionar este recurso al proyecto?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, adicionar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(t){t?i(function(){var t=d("filter")(r.project.agents,{agentId:e.id});0==t.length?r.project.agents.push({id:0,agentId:e.id,projectId:0,scheduledHours:e.scheduledHours,notAssignedHours:e.notAssignedHours,name:e.name}):t[0].scheduledHours=parseInt(t[0].scheduledHours)+parseInt(e.scheduledHours)}):swal("Cancelación","La operación ha sido cancelada","error")})},r.removeAgentProject=function(e){c.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, adicionar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(t){t?i(function(){var t=r.project.agents[e];if(t.id){var a={};a.id=t.id,l({method:"POST",url:"api/internal-project/agent/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){n.error(e),c.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){r.project.agents.splice(e,1)})}else r.project.agents.splice(e,1)}):swal("Cancelación","La operación ha sido cancelada","error")})},r.changeSkill=function(e,t){r.project.agents=[],h(e.id)}}]);
app.controller("ModalInstanceSideInternalProjectTaskCtrl",["$rootScope","$scope","$uibModalInstance","customer","project","$log","$uibModal","$timeout","SweetAlert","isView","$http","DTOptionsBuilder","DTColumnBuilder","$compile","toaster",function(t,e,a,n,i,r,o,s,c,l,d,u,p,f,m){var w=null;e.taskTypes=t.parameters("project_task_type"),e.project=i,e.maxDate=new Date,e.datePickerConfig={culture:"es-CO",format:"dd/MM/yyyy"};var h=function(){e.entity={id:0,projectAgentId:i.projectAgentId,type:null,task:"",observation:"",startDateTime:new Date,endDateTime:new Date,duration:null,status:"activo"},e.entity.tracking={action:"",description:""},w&&w.$setPristine(!0)};h(),e.isView=l,e.reschedule=!1;var g=function(){var t={};return t.customerId=n.id,d({method:"POST",url:"api/internal-project/listCustomer",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){s(function(){e.taskTypes=t.data.data.taskType})})["catch"](function(t){r.error(t),c.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};g(),e.ok=function(){a.close(1)},e.cancel=function(){a.dismiss("cancel")},e.cancelTask=function(a){var n={id:a,status:"cancelador",tracking:{action:"",description:""}},i=o.open({templateUrl:t.app.views.urlRoot+"modules/internalproject/project_task_tracking_modal.htm",controller:"ModalInstanceTrackingCtrl",windowTopClass:"top-modal",resolve:{task:function(){return n},action:function(){return"Cancelar"}}});i.result.then(function(t){e.selected=t,e.reloadData()},function(){r.info("Modal dismissed at: "+new Date),e.reloadData()})},e.completeTask=function(t){var e={id:t,status:"inactivo",tracking:{action:"",description:""}};v(e)},e.reloadlTask=function(t){e.reschedule=!0;var a={id:t,status:"inactivo",tracking:{action:"Reprogramar",description:""}};y(a.id)},e.onChangeStartDate=function(t){e.entity.endDateTime=new Date(e.entity.startDateTime),e.maxDate=new Date(e.entity.startDateTime)},e.form={submit:function(t){w=t;var e=null;if(t.$invalid){var a=null,e=null;for(a in t)"$"!=a[0]&&(null!==e||t[a].$valid||(e=t[a].$name),t[a].$pristine&&(t[a].$dirty=!0));return angular.element(".ng-invalid[name="+e+"]").focus(),void s(function(){m.pop("error","Error","Por favor verifique los datos requeridos del formulario y vuelva a intentarlo")},500)}T()},reset:function(t){t.$setPristine(!0)}};var T=function(){var t={};e.entity.startDateTime=e.entity.startDateTime.toISOString(),e.entity.endDateTime=e.entity.endDateTime.toISOString();var a=JSON.stringify(e.entity);return t.data=Base64.encode(a),d({method:"POST",url:"api/internal-project/task/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){s(function(){c.swal("Registro","La información ha sido guardada satisfactoriamente","success"),e.entity=t.data.result,k(),e.refresAll(),e.ok()})})["catch"](function(t){r.error(t),c.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})},v=function(t){var a={},n=JSON.stringify(t);return a.data=Base64.encode(n),d({method:"POST",url:"api/internal-project/task/update",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(t){s(function(){c.swal("Validación exitosa","Procediendo con el guardado...","success"),e.entity=t.data.result,e.refresAll(),e.reloadData(),e.ok()})})["catch"](function(t){r.error(t),c.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})},y=function(t){var a={id:t};d({method:"GET",url:"api/internal-project/task",params:a})["catch"](function(t,e){if(403==e){var a=null!==t.message&&void 0!==t.message?t.message:"app.clientes.list";c.swal("No Autorizado","No estas autorizado para ver esta información.","error"),s(function(){$state.go(a)},3e3)}else 404==e?(c.swal("Información no disponible","Seguimiento no encontrado","error"),s(function(){$state.go("app.clientes.list")})):c.swal("Error","Se ha presentado un error al intentar acceder a la información del seguimiento","error")}).then(function(t){s(function(){e.entity=t.data.result,k(),e.reschedule&&(e.entity.tracking={action:"Reprogramar",description:""})})})["finally"](function(){s(function(){e.loading=!1,e.isView=!0},400)})},k=function(){e.entity.startDateTime&&(e.entity.startDateTime=new Date(e.entity.startDateTime.date)),e.entity.endDateTime&&(e.entity.endDateTime=new Date(e.entity.endDateTime.date))};e.dtInstanceTask={},e.dtOptionsTask=u.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.projectAgentId=i.projectAgentId,JSON.stringify(t)},url:"api/customer-internal-project-user-task-agent",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,a,n){f(angular.element(t).contents())(e)}),e.dtColumnsTask=[p.newColumn(null).withTitle("Acciones").withOption("width",80).notSortable().renderWith(function(t,e,a,n){var i="",r='<a class="btn btn-primary btn-xs" href="#" uib-tooltip="Completar tarea" ng-click="completeTask('+t.id+')" >   <i class="fa fa-check-circle-o"></i></a> ',o='<a class="btn btn-info btn-xs" href="#" tooltip-placement="right" uib-tooltip="Reprogramar tarea" ng-click="reloadlTask('+t.id+')" >   <i class="fa fa-clock-o"></i></a> ',s='<a class="btn btn-danger btn-xs" href="#" uib-tooltip="Cancelar tarea" ng-click="cancelTask('+t.id+')">   <i class="fa fa-trash-o"></i></a> ';return"activo"==t.statusCode&&(i+=o,i+=r,i+=s),i}),p.newColumn("task").withTitle("Tarea").withOption("width",100),p.newColumn("type").withTitle("Tipo").withOption("width",100),p.newColumn("startDateTime").withTitle("Fecha Inicio").withOption("width",100),p.newColumn("endDateTime").withTitle("Fecha Fin").withOption("width",100),p.newColumn(null).withTitle("Estado").withOption("width",80).renderWith(function(t,e,a,n){var i="",r=t.status;switch(t.statusCode){case"activo":i="label label-success";break;case"cancelador":i="label label-danger";break;case"inactivo":i="label label-warning"}var o='<span class="'+i+'">'+r+"</span>";return o})],e.reloadData=function(){e.dtInstanceTask.reloadData()}}]);
app.controller("ModalInstanceTrackingCtrl",["$scope","$uibModalInstance","task","action","$log","$timeout","SweetAlert","$http",function(a,n,o,t,e,r,c,i){a.task=o,a.task.tracking={action:t,description:""},a.ok=function(){n.close(1)},a.cancel=function(){n.dismiss("cancel")},a.saveTracking=function(){s()};var s=function(){var o={},t=JSON.stringify(a.task);return o.data=Base64.encode(t),i({method:"POST",url:"api/internal-project/task/update",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(a){r(function(){c.swal("Validación exitosa","Procediendo con el guardado...","success"),n.close(1)})})["catch"](function(a){e.error(a),c.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})}}]);
app.controller("ModalInternalProjectTaskViewInstanceSideCtrl",["$scope","$uibModalInstance","project","$log","$uibModal","$timeout","SweetAlert","isView","$http","DTOptionsBuilder","DTColumnBuilder","$compile",function(t,i,n,e,a,o,l,r,c,s,w,p){t.project=n,t.ok=function(){i.close(1)},t.cancel=function(){i.dismiss("cancel")};var u={};u.operation="tracking",u.project_id=t.project.id,t.dtInstanceTask={},t.dtOptionsTask=s.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(i){return i.projectId=t.project.id,JSON.stringify(i)},url:"api/customer-internal-project-user-task",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(i,n,e){p(angular.element(i).contents())(t)}),t.dtColumnsTask=[w.newColumn("task").withTitle("Tarea"),w.newColumn("shortObservation").withTitle("Descriptión"),w.newColumn("type").withTitle("Tipo").withOption("width",200),w.newColumn("startDateTime").withTitle("Fecha Inicio").withOption("width",150),w.newColumn("endDateTime").withTitle("Fecha Fin").withOption("width",150),w.newColumn("duration").withTitle("Duración").withOption("width",150),w.newColumn("agent").withTitle("Asesor").withOption("width",400),w.newColumn(null).withTitle("Estado").withOption("width",80).renderWith(function(t,i,n,e){var a="",o=t.status;switch(t.statusCode){case"activo":a="label label-success";break;case"cancelador":a="label label-danger";break;case"inactivo":a="label label-warning"}var l='<span class="'+a+'">'+o+"</span>";return l})],t.reloadData=function(){t.dtInstanceTask.reloadData()}}]);
app.controller("ModalInstanceInternalProjectTrackingCtrl",["$scope","$uibModalInstance","project","action","filters","customerId","$log","$timeout","SweetAlert","$http",function(e,r,t,o,n,a,c,l,s,i){e.report=t,e.report.tracking={action:o,description:""},e.onClose=function(){r.close(1)},e.onCancel=function(){r.dismiss("cancel")},e.saveTracking=function(){d()};var d=function(){var t={};e.report.customerId=a,e.report.agentId=null!=n.selectedAgent?n.selectedAgent.id:0,e.report.month=null!=n.selectedMonth?n.selectedMonth.value:0,e.report.year=null!=n.selectedYear?n.selectedYear.value:0,e.report.arl=0,e.report.os=""!=n.selectedOS?n.selectedOS:"";var o=JSON.stringify(e.report);return t.data=Base64.encode(o),i({method:"POST",url:"api/internal-project/send-status",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(e){l(function(){s.swal("Validación exitosa","Procediendo con el guardado...","success"),r.close(1)})})["catch"](function(e){c.error(e),s.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})}}]);
"use strict";app.controller("internalProjectAttachmentCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","SweetAlert","$http","$filter","$document","$aside","FileUploader","$localStorage","$ngConfirm","ngNotify","ListService",function(e,t,n,o,a,r,i,l,s,c,u,d,m,f,p,h,w,C,g,v,b){function A(){var t=[{name:"customer_document_type",value:e.currentCustomerId},{name:"current_customer",value:e.currentCustomerId}];b.getDataList(t).then(function(t){e.documentType=t.data.data.customerDocumentType,e.currentCustomer=t.data.data.currentCustomer},function(t){e.status="Unable to load customer data: "+t.message})}var I=0,D=null;e.customerList=[],e.currentCustomerId=c.isCustomer()?c.currentUser().company:0,e.$storage=C.$default({hideCustomerInternalProjectAttachmentCanceled:!0}),e.isAgent="agent"==c.currentUser().wg_type,e.isAdmin="system"==c.currentUser().wg_type,e.isCustomer="customerAdmin"==c.currentUser().wg_type||"customerUser"==c.currentUser().wg_type,e.documentClassification=c.parameters("customer_document_classification"),e.documentStatus=c.parameters("customer_document_status"),e.isView="view"==e.$parent.modeDsp,e.filter={selectedCustomer:null},e.downloadUrl="",A();var y=function(){e.attachment={id:0,customerInternalProjectId:0,type:null,classification:null,status:e.documentStatus?e.documentStatus[0]:null,version:1,description:null},D&&D.$setPristine(!0)};y();var O=function(t){m({method:"GET",url:"api/customer-internal-project-document/get",params:{id:t}})["catch"](function(e,t){if(403==t){var n=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";d.swal("No Autorizado","No estas autorizado para ver esta información.","error"),u(function(){s.go(n)},3e3)}else 404==t?(d.swal("Información no disponible","Anexo no encontrado","error"),u(function(){s.go("app.clientes.list")})):d.swal("Error","Se ha presentado un error al intentar acceder a la información del anexo","error")}).then(function(t){u(function(){e.attachment=t.data.result,e.attachment.version=parseInt(e.attachment.version)+1})})["finally"](function(){u(function(){e.loading=!1},400)})};e.onSelectCustomer=function(){e.currentCustomerId=e.filter.selectedCustomer.value,y(),e.reloadData()},e.onSearchCustomer=function(){var t=h.open({templateUrl:c.app.views.urlRoot+"modules/common/modals/data_table_list_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideProjectInternalSearchCustomerCtrl",scope:e,windowTopClass:"top-modal",resolve:{}});t.result.then(function(t){var n=f("filter")(e.customerList,{id:t.id});0==n.length&&e.customerList.push(t),e.filter.selectedCustomer=t,e.onSelectCustomer()},function(){})},e.onClearCustomer=function(){e.filter.selectedCustomer=null,e.currentCustomerId=0,y(),e.reloadData()},e.form={submit:function(e){D=e;var t=null;if(e.$invalid){var n=null,t=null;for(n in e)"$"!=n[0]&&(null!==t||e[n].$valid||(t=e[n].$name),e[n].$pristine&&(e[n].$dirty=!0));return angular.element(".ng-invalid[name="+t+"]").focus(),void d.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}P()},reset:function(e){e.$setPristine(!0)}};var P=function(){var t={},o=JSON.stringify(e.attachment);return t.data=Base64.encode(o),m({method:"POST",url:"api/customer-internal-project-document/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){u(function(){T.queue.length>0?(I=t.data.result.id,T.uploadAll()):(d.swal("Registro","La información ha sido guardada satisfactoriamente","success"),e.reloadData(),e.onClear())})})["catch"](function(e){n.error(e),d.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})},T=e.uploader=new w({url:"api/customer-internal-project-document/upload",formData:[],removeAfterUpload:!0});T.filters.push({name:"customFilter",fn:function(e,t){return this.queue.length<10}}),T.onWhenAddingFileFailed=function(e,t,n){console.info("onWhenAddingFileFailed",e,t,n)},T.onAfterAddingFile=function(e){console.info("onAfterAddingFile",e)},T.onAfterAddingAll=function(e){console.info("onAfterAddingAll",e)},T.onBeforeUploadItem=function(e){console.info("onBeforeUploadItem",e);var t={id:I};e.formData.push(t)},T.onProgressItem=function(e,t){console.info("onProgressItem",e,t)},T.onProgressAll=function(e){console.info("onProgressAll",e)},T.onSuccessItem=function(e,t,n,o){console.info("onSuccessItem",e,t,n,o)},T.onErrorItem=function(e,t,n,o){console.info("onErrorItem",e,t,n,o)},T.onCancelItem=function(e,t,n,o){console.info("onCancelItem",e,t,n,o)},T.onCompleteItem=function(e,t,n,o){console.info("onCompleteItem",e,t,n,o)},T.onCompleteAll=function(){console.info("onCompleteAll"),e.reloadData(),e.onClear(),d.swal("Registro","La información ha sido guardada satisfactoriamente","success")},e.dtInstanceCustomerInternalProjectDocument={},e.dtOptionsCustomerInternalProjectDocument=o.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.operation="document",t.customerId=e.filter.selectedCustomer?e.filter.selectedCustomer.id:e.currentCustomerId,e.$storage.hideCustomerInternalProjectAttachmentCanceled&&(t.statusCode="2"),JSON.stringify(t)},url:"api/customer-internal-project-document",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){S()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,n,o){i(angular.element(t).contents())(e)}),e.dtColumnsCustomerInternalProjectDocument=[a.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,t,n,o){var a=e.documentUrl?e.documentUrl:"",r="api/customer-internal-project-document/download?id="+e.id,i="",l='<a target="_self" class="btn btn-primary btn-xs downloadDocumentRow lnk" href="'+r+'" uib-tooltip="Descargar anexo" data-id="'+e.id+'" >   <i class="fa fa-download"></i></a> ',s='<a class="btn btn-info btn-xs openDocumentRow lnk" target="_blank" href="'+a+'" uib-tooltip="Abrir anexo" data-id="'+e.id+'" >   <i class="fa fa-folder-open-o"></i></a> ',u='<a class="btn btn-danger btn-xs delDocumentRow lnk" href="#" uib-tooltip="Anular anexo" data-id="'+e.id+'" >   <i class="fa fa-ban"></i></a> ',d=!1;return null==e.protectionType?d=!0:"public"==e.protectionType?d=!0:"private"==e.protectionType&&1==e.hasPermission&&(d=!0),c.can("clientes_anexo_open")&&""!=a&&(i+=s),c.can("clientes_anexo_download")&&""!=a&&(i+=l),c.can("clientes_anexo_invalidate")&&(i+=u),d?i:""}),a.newColumn("documentType").withTitle("Tipo de documento").withOption("width",200).withOption("defaultContent",""),a.newColumn("classification").withTitle("Clasificación").withOption("width",200).withOption("defaultContent",""),a.newColumn("description").withTitle("Descripción").withOption("width",200).withOption("defaultContent",""),a.newColumn("version").withTitle("Versión").withOption("width",200).withOption("defaultContent",""),a.newColumn("createdAt").withTitle("Fecha Creación").withOption("width",200).withOption("defaultContent",""),a.newColumn("createdBy").withTitle("Usuario").withOption("width",200).withOption("defaultContent",""),a.newColumn("status").withTitle("Estado").withOption("width",200).renderWith(function(e,t,n,o){var a="";switch(e){case"Vigente":a="label label-success";break;case"Anulado":a="label label-danger"}var r='<span class="'+a+'">'+e+"</span>";return r})];var S=function(){angular.element("#dtCustomerInternalProjectDocument a.delDocumentRow").on("click",function(){var t=angular.element(this).data("id");g({boxWidth:"35%",useBootstrap:!1,animation:"bottom",closeAnimation:"scale",title:"Está seguro?",content:"<strong>Anulará</strong> el anexo seleccionado",scope:e,type:"red",typeAnimated:!0,buttons:{cancel:{text:"Anular y cambiar versión",btnClass:"btn-primary",action:function(n,o){e.attachment.id=t,e.isView=!1,O(t),l.pop("info","Anulación Anexo","El anexo se cargó satisfactoriamente, seleccione una nueva versión del documento")}},fullCancel:{text:"Anular definitivamente",btnClass:"btn-red",action:function(o,a){var r={};r.id=t,m({method:"POST",url:"api/customer-internal-project-document/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(r)}).then(function(t){swal("Eliminado","Anexo anulado satisfactoriamente","info"),e.reloadData()})["catch"](function(e){n.error(e),d.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}},closeAll:{text:"Cancelar",btnClass:"btn-default",action:function(e,t){}}}})})};e.dtInstanceCustomerInternalProjectDocumentCallback=function(t){e.dtInstanceCustomerInternalProjectDocument=t},e.reloadData=function(){e.dtInstanceCustomerInternalProjectDocument.reloadData()},e.onEdit=function(t){e.isView=!1,O(t)},e.onShowCancelledChange=function(){e.reloadData()},e.onClear=function(){y()}}]);
app.controller("ModalInternalProjectAttachmentInstanceSideCtrl",["$stateParams","$rootScope","$scope","$uibModalInstance","$log","$timeout","SweetAlert","isView","item","customer","$filter","FileUploader","$http","DTColumnBuilder","DTOptionsBuilder","$compile","ListService","toaster",function(t,n,e,o,i,a,r,l,c,s,u,d,m,f,p,w,h,C){function g(){var t=[{name:"customer_document_type",value:s.id}];h.getDataList(t).then(function(t){e.documentType=t.data.data.customerDocumentType},function(t){e.status="Unable to load customer data: "+t.message})}var v=null,O=0;e.documentClassification=n.parameters("customer_document_classification"),e.documentStatus=n.parameters("customer_document_status"),e.isView=l,g();var b=function(){e.attachment={id:0,customerInternalProjectId:c.id,type:null,classification:null,status:e.documentStatus?e.documentStatus[0]:null,version:1,description:null},v&&v.$setPristine(!0)};b(),e.onCloseModal=function(){o.close(1)},e.onCancel=function(){o.dismiss("cancel")},e.onClear=function(){b()};var A=e.uploader=new d({url:"api/customer-internal-project-document/upload",formData:[],removeAfterUpload:!0});A.filters.push({name:"customFilter",fn:function(t,n){return this.queue.length<10}}),A.onWhenAddingFileFailed=function(t,n,e){console.info("onWhenAddingFileFailed",t,n,e)},A.onAfterAddingFile=function(t){console.info("onAfterAddingFile",t)},A.onAfterAddingAll=function(t){console.info("onAfterAddingAll",t)},A.onBeforeUploadItem=function(t){console.info("onBeforeUploadItem",t);var n={id:O};t.formData.push(n)},A.onProgressItem=function(t,n){console.info("onProgressItem",t,n)},A.onProgressAll=function(t){console.info("onProgressAll",t)},A.onSuccessItem=function(t,n,e,o){console.info("onSuccessItem",t,n,e,o)},A.onErrorItem=function(t,n,e,o){console.info("onErrorItem",t,n,e,o)},A.onCancelItem=function(t,n,e,o){console.info("onCancelItem",t,n,e,o)},A.onCompleteItem=function(t,n,e,o){console.info("onCompleteItem",t,n,e,o)},A.onCompleteAll=function(){console.info("onCompleteAll"),C.pop("success","Operación Exitosa","La información ha sido guardada satisfactoriamente"),e.reloadData(),e.onClear()},e.form={submit:function(t){v=t;var n=null;if(t.$invalid){var e=null,n=null;for(e in t)"$"!=e[0]&&(null!==n||t[e].$valid||(n=t[e].$name),t[e].$pristine&&(t[e].$dirty=!0));return angular.element(".ng-invalid[name="+n+"]").focus(),void r.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}D()},reset:function(t){t.$setPristine(!0)}};var D=function(){var t={},n=JSON.stringify(e.attachment);return t.data=Base64.encode(n),m({method:"POST",url:"api/customer-internal-project-document/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){a(function(){A.queue.length>0?(O=t.data.result.id,A.uploadAll()):(C.pop("success","Operación Exitosa","La información ha sido guardada satisfactoriamente"),e.reloadData(),e.onClear())})})["catch"](function(t){r.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};e.dtInstanceCustomerDocumentModal={},e.dtOptionsCustomerDocumentModal=p.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.customerInternalProjectId=c.id,t.statusCode="2",JSON.stringify(t)},url:"api/customer-internal-project-document",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){I()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,n,o){w(angular.element(t).contents())(e)}),e.dtColumnsCustomerDocumentModal=[f.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,e,o,i){var a=t.documentUrl?t.documentUrl:"",r="api/customer-internal-project-document/download?id="+t.id,l="",c='<a target="_self" class="btn btn-primary btn-xs downloadDocumentRow lnk" href="'+r+'" uib-tooltip="Descargar anexo" data-id="'+t.id+'" >   <i class="fa fa-download"></i></a> ',s='<a class="btn btn-info btn-xs openDocumentRow lnk" target="_blank" href="'+a+'" uib-tooltip="Abrir anexo" data-id="'+t.id+'" >   <i class="fa fa-folder-open-o"></i></a> ',u=!1;return null==t.protectionType?u=!0:"public"==t.protectionType?u=!0:"private"==t.protectionType&&1==t.hasPermission&&(u=!0),n.can("clientes_anexo_open")&&""!=a&&(l+=s),n.can("clientes_anexo_download")&&""!=a&&(l+=c),u?l:""}),f.newColumn("documentType").withTitle("Tipo de documento").withOption("width",200).withOption("defaultContent",""),f.newColumn("classification").withTitle("Clasificación").withOption("width",200).withOption("defaultContent",""),f.newColumn("description").withTitle("Descripción").withOption("width",200).withOption("defaultContent",""),f.newColumn("version").withTitle("Versión").withOption("width",200).withOption("defaultContent",""),f.newColumn("createdAt").withTitle("Fecha Creación").withOption("width",200).withOption("defaultContent",""),f.newColumn("status").withTitle("Estado").withOption("width",200).renderWith(function(t,n,e,o){var i="";switch(t){case"Vigente":i="label label-success";break;case"Anulado":i="label label-danger"}var a='<span class="'+i+'">'+t+"</span>";return a})];var I=function(){$("#dtCustomerDocumentModal a.editRow").on("click",function(){$(this).data("id"),$(this).data("url")})};e.dtInstanceCustomerDocumentModalCallback=function(t){e.dtInstanceCustomerDocumentModal=t},e.reloadData=function(){e.dtInstanceCustomerDocumentModal.reloadData()}}]);
app.controller("ModalInternalProjecCommentInstanceSideCtrl",["$stateParams","$rootScope","$scope","$uibModalInstance","item","isView","$timeout","$http","toaster","DTColumnBuilder","DTOptionsBuilder","$compile",function(n,t,e,o,i,a,r,c,l,u,s,d){e.isView=a;var m=function(){e.entity={id:0,customerInternalProjectId:i.id,comment:null,type:"M"}};m(),e.onCloseModal=function(){o.close(1)},e.onCancel=function(){o.dismiss("cancel")},e.onClear=function(){m()},e.form={submit:function(n){var t=null;if(n.$invalid){var o=null,t=null;for(o in n)"$"!=o[0]&&(null!==t||n[o].$valid||(t=n[o].$name),n[o].$pristine&&(n[o].$dirty=!0));return angular.element(".ng-invalid[name="+t+"]").focus(),void r(function(){l.pop("error","Error","Por favor verifique los datos requeridos del formulario y vuelva a intentarlo")},500)}e.onSave()},reset:function(n){n.$setPristine(!0)}},e.onSave=function(){var n={},t=JSON.stringify(e.entity);return n.data=Base64.encode(t),c({method:"POST",url:"api/customer-internal-project-comment/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(n){r(function(){l.pop("success","Operación Exitosa","La información ha sido guardada satisfactoriamente."),e.onClear(),e.reloadData()})})["catch"](function(n){l.pop("Error","Error inesperado",n)})["finally"](function(){})},e.dtOptionsQuestionComment=s.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(n){return n.customerInternalProjectId=i.id,JSON.stringify(n)},url:"api/customer-internal-project-comment",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(n,t,o){d(angular.element(n).contents())(e)}),e.dtColumnsQuestionComment=[u.newColumn("comment").withTitle("Comentario"),u.newColumn("createdBy").withTitle("Usuario").withOption("width",200).withOption("defaultContent",200),u.newColumn("createdAt").withTitle("Fecha").withOption("width",200)],e.dtInstanceQuestionCommentCallback=function(n){e.dtInstanceQuestionComment=n},e.reloadData=function(){e.dtInstanceQuestionComment.reloadData()}}]);
app.controller("ModalInstanceSideProjectInternalSearchCustomerCtrl",["$rootScope","$stateParams","$scope","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile",function(t,n,e,i,a,o,l,r,s,c,u,d,p,m){e.title="CLIENTES DISPONIBLES";var w=t.isAgent(),h=w?"api/customer-agent":"api/customer";e.entity={id:0},e.onCloseModal=function(){var t={id:e.entity.id,item:e.entity.businessName,value:e.entity.id,arl:e.entity.arl?e.entity.arl.item:null};i.close(t)},e.onCancel=function(){i.dismiss("cancel")};var f=function(t){if(0!=t){var n={id:t};r({method:"GET",url:"api/customer",params:n})["catch"](function(t,n){if(403==n){var e=null!==t.message&&void 0!==t.message?t.message:"app.clientes.list";l.swal("No Autorizado","No estas autorizado para ver esta información.","error"),o(function(){$state.go(e)},3e3)}else 404==n?l.swal("Información no disponible","Diagnóstico no encontrado","error"):l.swal("Error","Se ha presentado un error al intentar acceder a la información del proceso","error")}).then(function(t){o(function(){e.entity=t.data.result})})["finally"](function(){o(function(){e.onCloseModal()},400)})}else e.loading=!1};e.dtOptionsCommonDataTableList=p.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return t.operation="customer",JSON.stringify(t)},url:h,contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){b()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,n,i){m(angular.element(t).contents())(e)}),e.dtColumnsCommonDataTableList=[d.newColumn(null).withTitle("Acciones").withOption("width",80).notSortable().renderWith(function(t,n,e,i){var a="",o="",l='<a class="btn btn-success btn-xs editRow lnk" href="#" uib-tooltip="Adicionar causa"  data-id="'+t.id+'"'+o+' >   <i class="fa fa-plus-square"></i></a> ';return a+=l}),d.newColumn("documentType").withTitle("Tipo de Documento").withOption("width",200),d.newColumn("documentNumber").withTitle("Nro Documento").withOption("width",200),d.newColumn("businessName").withTitle("Razón Social").withOption("width",200),d.newColumn("type").withTitle("Tipo de Cliente").withOption("width",200),d.newColumn("classification").withTitle("Clasificación").withOption("width",200).renderWith(function(t,n,e,i){return null==t||void 0==t?"":t}),d.newColumn("status").withTitle("Estado").withOption("width",200).renderWith(function(t,n,e,i){var a="";switch(t){case"Activo":a="label label-success";break;case"Inactivo":a="label label-danger";break;case"Retirado":a="label label-warning"}var o='<span class="'+a+'">'+t+"</span>";return o})];var b=function(){angular.element("#dtCommonDataTableList a.editRow").on("click",function(){var t=angular.element(this).data("id");f(t)})};e.dtInstanceCommonDataTableListCallback=function(t){e.dtInstanceCommonDataTableList=t},e.reloadData=function(){e.dtInstanceCommonDataTableList.reloadData()}}]);
"use strict";app.controller("internalProjectPlanningCtrl",["$scope","flowFactory","$aside","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","$timeout","$http","SweetAlert","$filter",function(e,t,r,a,n,o,i,s,c,l,d,u,p,f,m,g){function h(t,a){var n=r.open({placement:"right",size:"lg",backdrop:!0,controller:"PlanningInternalProjectInstanceModalSideCtrl",scope:e,resolve:{project:function(){return a},isview:function(){return e.isview}}});n.result.then(function(t,r){e.currentProjectAgentId=0,e.refreshGantt()})}function v(t,a){var n=r.open({placement:"right",size:"lg",backdrop:!0,controller:"PlanningInternalProjectTaskInstanceModalSideCtrl",scope:e,resolve:{project:function(){return a},isview:function(){return e.isview}}});n.result.then(function(){e.currentProjectAgentId=0,e.refreshGantt()})}e.currentProjectAgentId=0,e.isCustomerAgent=u.isCustomerUser(),e.isCustomerAdmin=u.isCustomerAdmin(),e.isAdmin=u.isAdmin(),e.isAgent=u.isAgent(),e.canCreateTask=!1,e.canCreateProject=!1,e.currentTask=null,e.currentCustomerId=u.currentUser().company,e.currentAgentId=0,e.currentMonth=0,e.currentYear=0,e.customer=null,e.filter={selectedType:{id:"1",item:"Grupo Económico",value:"GE"},selectedCustomer:null,selectedAgent:null,selectedMonth:null,selectedYear:null},e.project={id:0,name:"",deliveryDate:new Date,estimatedHours:0,isRecurrent:!1,serviceOrder:"",isBilled:!1,invoiceNumber:""},e.project.type=null,e.project.customer=null,e.project.status=null,e.project.defaultSkill=null,e.project.agents=[],e.project.projectTask={id:0,projectAgentId:0,type:null,task:"",observation:"",startDateTime:new Date,endDateTime:new Date,status:"activo"},e.projectTypes=u.parameters("project_type"),e.taskTypes=u.parameters("project_task_type"),e.arls=u.parameters("arl"),e.skills=u.parameters("agent_skill"),e.agents=[],e.agentsFilter=[],e.customers=[],e.customersList=[],e.types=[{id:"1",item:"Grupo Económico",value:"GE"},{id:"2",item:"Cliente",value:"CU"}],e.months=[{id:"1",item:"Enero",value:"1"},{id:"2",item:"Febrero",value:"2"},{id:"3",item:"Marzo",value:"3"},{id:"4",item:"Abril",value:"4"},{id:"5",item:"Mayo",value:"5"},{id:"6",item:"Junio",value:"6"},{id:"7",item:"Julio",value:"7"},{id:"8",item:"Agosto",value:"8"},{id:"9",item:"Septiembre",value:"9"},{id:"10",item:"Octubre",value:"10"},{id:"11",item:"Noviembre",value:"11"},{id:"12",item:"Diciembre",value:"12"}],e.years=[{id:"2015",item:"2015",value:"2015"},{id:"2016",item:"2016",value:"2016"},{id:"2017",item:"2017",value:"2017"},{id:"2018",item:"2018",value:"2018"},{id:"2019",item:"2019",value:"2019"}];var w=new kendo.data.GanttDataSource({batch:!1,type:"odata",transport:{read:{url:function(){var t={customerId:e.currentCustomerId,currentAgentId:e.currentAgentId,month:e.currentMonth,year:e.currentYear,type:e.filter.selectedType.value};return"api/internal-project/gantt?data="+Base64.encode(JSON.stringify(t))},dataType:"json",type:"GET"},parameterMap:function(e,t){if("read"!==t)return{models:kendo.stringify(e.models||[e])}}},schema:{model:{id:"id",fields:{id:{from:"id",type:"string"},parentId:{from:"parentId",type:"string",defaultValue:null,validation:{required:!0}},start:{from:"startDate",type:"date"},end:{from:"endDateTime",type:"date"},title:{from:"businessName",defaultValue:"",type:"string"},originalId:{from:"originalId",defaultValue:"0",type:"number"},assignedHours:{from:"assignedHours",defaultValue:"0",type:"number"},scheduledHours:{from:"scheduledHours",defaultValue:"0",type:"number"},runningHours:{from:"runningHours",defaultValue:"0",type:"number"},percentComplete:{from:"percentage",defaultValue:"0",type:"number"},amount:{from:"amount",defaultValue:"0",type:"number"},classification:{from:"classification",defaultValue:"",type:"string"},summary:{from:"summary",type:"boolean"},expanded:{from:"expanded",type:"boolean",defaultValue:!0}}},data:function(e){return e.data||e},total:function(e){return e.recordsTotal||e.data.length||0}}});e.ganttOptions={dataSource:w,resources:{field:"resources",dataColorField:"Color",dataTextField:"Name",dataSource:{type:"odata",transport:{read:{url:function(){var t={customerId:e.currentCustomerId,currentAgentId:e.currentAgentId,month:e.currentMonth,year:e.currentYear,type:e.filter.selectedType.value};return"api/internal-project/gantt-resource?data="+Base64.encode(JSON.stringify(t))},dataType:"json",type:"GET"},parameterMap:function(e,t){if("read"!==t)return{models:kendo.stringify(e.models||[e])}}},schema:{model:{id:"id",fields:{id:{from:"ID",type:"number"}}},data:function(e){return e.data||e},total:function(e){return e.recordsTotal||e.data.length||0}}}},assignments:{dataTaskIdField:"TaskID",dataResourceIdField:"ResourceID",dataValueField:"Units",dataSource:{type:"odata",transport:{read:{url:function(){var t={customerId:e.currentCustomerId,currentAgentId:e.currentAgentId,month:e.currentMonth,year:e.currentYear,type:e.filter.selectedType.value};return"api/internal-project/gantt-resource-assignment?data="+Base64.encode(JSON.stringify(t))},dataType:"json",type:"GET"},parameterMap:function(e,t){if("read"!==t)return{models:kendo.stringify(e.models||[e])}}},schema:{model:{id:"ID",fields:{ID:{type:"number"},ResourceID:{type:"number"},Units:{type:"number"},TaskID:{type:"string"}}},data:function(e){return e.data||e},total:function(e){return e.recordsTotal||e.data.length||0}}}},views:["day",{type:"week",selected:!0},"month"],messages:{views:{day:"Día",week:"Semana",month:"Mes",Year:"Año"}},toolbar:[{name:"pdf",text:"Exportar a PDF"}],pdf:{fileName:"Plan de Trabajo Interno Planeacion",proxyURL:"//demos.telerik.com/kendo-ui/service/export"},change:function(t){var r,a=this.select();a&&(r=this.dataItem(a),p(function(){e.canCreateTask=!1,e.canCreateProject=!1,null!=r&&"undefined"!=typeof r.classification&&(e.currentTask=r,"CLIENTE GRUPO"==r.classification||"CLIENTE"==r.classification?e.canCreateProject=e.isAdmin:"PROYECTO"==r.classification&&(e.canCreateTask=!0))},300))},columns:[{field:"title",title:"Titulo",editable:!0,width:350},{field:"classification",title:"Tipo",width:100},{field:"start",title:"F Inicial",format:"{0:dd/MM/yyyy}",width:80},{field:"end",title:"F Final",format:"{0:dd/MM/yyyy}",width:80},{field:"assignedHours",title:"H. Asignadas",width:80},{field:"scheduledHours",title:"H. Programadas",width:80},{field:"runningHours",title:"H. Ejecutadas",width:80},{field:"amount",title:"Valor Tarea",width:100,format:"{0:c}"},{field:"resources",title:"Asesores",width:200}],height:700,showWorkHours:!1,showWorkDays:!1,editable:!1},e.projectTasks=[],e.events=[],e.summaryProject={assignedHours:0,scheduledHours:0,runningHours:0,total:0,data:[{value:0,color:"#46BFBD",highlight:"#5AD3D1",label:"Asignadas"},{value:0,color:"#FDB45C",highlight:"#FFC870",label:"Ejecutadas"}]},e.projects=[],e.recentTasks=[],e.addProject=function(){e.project={id:0,name:"",deliveryDate:new Date,estimatedHours:0,isRecurrent:!1,serviceOrder:"",isBilled:!1,invoiceNumber:""};var t=g("filter")(e.customers,{id:e.currentTask.originalId.toString()},!0);e.project.customer=t.length>0?t[0]:null,e.project.type=null,e.project.status=null,e.project.defaultSkill=null,e.project.agents=[],e.project.projectTask={id:0,projectAgentId:0,type:null,task:"",observation:"",startDateTime:new Date,endDateTime:new Date,status:"activo"},e.agents=[],e.projectEdited(e.project)},e.editProject=function(t){var r={id:t.id};f({method:"GET",url:"api/internal-project",params:r})["catch"](function(e,t){if(403==t){var r=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";m.swal("No Autorizado","No estas autorizado para ver esta información.","error"),p(function(){d.go(r)},3e3)}else 404==t?(m.swal("Información no disponible","Aporte no encontrado","error"),p(function(){d.go("app.clientes.list")})):m.swal("Error","Se ha presentado un error al intentar acceder a la información del aporte","error")}).then(function(t){p(function(){e.project=t.data.result,e.project.deliveryDate=new Date(e.project.deliveryDate.date),e.project.customer=e.project.customer[0],e.loadAgent(e.project.defaultSkill.id),e.projectEdited(e.project)})})["finally"](function(){p(function(){e.loading=!1},400),p(function(){})})},e.addTask=function(t){if(e.isAdmin||e.isAgent){var r={id:t.originalId};f({method:"GET",url:"api/internal-project",params:r})["catch"](function(e,t){}).then(function(t){p(function(){e.project=t.data.result,e.project.deliveryDate=new Date(e.project.deliveryDate.date),e.project.customer=e.project.customer[0],e.projectTaskResponsible=e.project.agents,e.project.projectTask={id:0,projectAgentId:0,customerName:e.project.customerId.businessName,name:e.project.name,description:e.project.description,assignedHours:e.project.estimatedHours,type:null,task:"",observation:"",startDateTime:new Date,endDateTime:new Date,status:"activo"},e.taskEdited(e.project)})})["finally"](function(){})}},e.taskEdited=function(e){v("Edited",e)},e.projectEdited=function(e){h("Edited",e)},e.changeAgent=function(t,r){p(function(){e.currentAgentId=t.id,e.refreshGantt()})},e.clearAgent=function(){p(function(){e.currentAgentId=0,e.filter.selectedAgent=null,e.refreshGantt()})},e.changeMonth=function(t,r){p(function(){e.currentMonth=t.id,e.refreshGantt()})},e.clearMonth=function(){p(function(){e.currentMonth=0,e.filter.selectedMonth=null,e.refreshGantt()})},e.changeYear=function(t,r){p(function(){e.currentYear=t.id,e.refreshGantt()})},e.clearYear=function(){p(function(){e.currentYear=0,e.filter.selectedYear=null,e.refreshGantt()})},e.changeType=function(t,r){p(function(){e.filterCustomers="GE"==e.filter.selectedType.value?e.economicGroups:e.customers,e.refreshGantt()})},e.refreshGantt=function(){var e=$("div [kendo-gantt]").data("kendoGantt");e&&(e.dataSource.read(),e.resources.dataSource.read(),e.assignments.dataSource.read())},e.loadAgent=function(t){var r={};r.skill=t;var a=JSON.stringify(e.customer);return r.data=a,f({method:"POST",url:"api/internal-project/agent",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(r)}).then(function(t){p(function(){e.agents=t.data.data})})["catch"](function(e){n.error(e),m.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};var T=function(){var t={};return t.customerId=e.currentCustomerId,f({method:"POST",url:"api/internal-project/listCustomer",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){p(function(){e.agentsFilter=t.data.data.users,e.projectTypes=t.data.data.projectTypes,e.skills=t.data.data.userSkills,e.taskTypes=t.data.data.taskType})})["catch"](function(e){n.error(e),m.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})},j=function(){var t={},r=JSON.stringify(e.customer);return t.data=r,f({method:"POST",url:"api/internal-project/customer",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){p(function(){e.customers=t.data.data})})["catch"](function(e){n.error(e),m.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};j(),T(),e.changeSkill=function(t,r){e.project.agents=[],e.loadAgent(t.id)};var y=function(){var t={},r=JSON.stringify(e.customer);return t.data=r,f({method:"POST",url:"api/internal-project/task",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){p(function(){e.events=t.data.data,e.events.forEach(function(e){e.starts_at=new Date(e.starts_at.date),e.ends_at=new Date(e.ends_at.date)})})})["catch"](function(e){n.error(e),m.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};y()}]),app.controller("PlanningInternalProjectInstanceModalSideCtrl",["$scope","$uibModalInstance","project","$log","$timeout","SweetAlert","isview","$http","$filter","toaster",function(e,t,r,a,n,o,i,s,c,l){e.project=r,e.isview=i,e.datePickerConfig={culture:"es-CO",format:"dd/MM/yyyy hh:mm tt"},e.onClose=function(){t.close(1)},e.onCancel=function(){t.dismiss("cancel")},e.form={submit:function(t){var r=null;if(t.$invalid){var a=null,r=null;for(a in t)"$"!=a[0]&&(null!==r||t[a].$valid||(r=t[a].$name),t[a].$pristine&&(t[a].$dirty=!0));return angular.element(".ng-invalid[name="+r+"]").focus(),void n(function(){l.pop("error","Error","Por favor verifique los datos requeridos del formulario y vuelva a intentarlo")},500)}return 0==e.project.agents.length?void l.pop("error","Error","Debe adicionar al menos un recurso"):(n(function(){l.pop("success","Operación Exitosa","Procediendo con el guardado...")},500),void e.onSaveProject())},reset:function(e){e.$setPristine(!0)}},e.onSaveProject=function(){var t={};if(null!=e.project.deliveryDate){e.project.event_date=e.project.deliveryDate.toISOString();var r=JSON.stringify(e.project);return t.data=Base64.encode(r),s({method:"POST",url:"api/internal-project/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){n(function(){o.swal("Validación exitosa","Procediendo con el guardado...","success"),e.projectTask=t.data.result,e.onClose()})})["catch"](function(e){a.error(e),o.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})}o.swal("Error de guardado","Error guardando el cliente por favor verifique la fecha ingresada!","error")},e.removeAgent=function(t){o.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(r){r?n(function(){e.mainContact.info.splice(t,1)}):swal("Cancelación","La operación ha sido cancelada","error")})},e.addAgent=function(t){o.swal({title:"Está seguro?",text:"Confirmas adicionar este recurso al plan de trabajo?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, adicionar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(r){r?n(function(){var r=c("filter")(e.project.agents,{agentId:e.agents[t].id});0==r.length?e.project.agents.push({id:0,agentId:e.agents[t].id,projectId:0,scheduledHours:e.agents[t].scheduledHours,notAssignedHours:e.agents[t].notAssignedHours,name:e.agents[t].name}):r[0].scheduledHours=parseInt(r[0].scheduledHours)+parseInt(e.agents[t].scheduledHours)}):swal("Cancelación","La operación ha sido cancelada","error")})},e.removeAgentProject=function(t){o.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, adicionar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(r){r?n(function(){var r=e.project.agents[t],n={};n.id=r.id,s({method:"POST",url:"api/internal-project/agent/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){a.error(e),o.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){e.project.agents.splice(t,1)})}):swal("Cancelación","La operación ha sido cancelada","error")})}}]),app.controller("PlanningInternalProjectTaskInstanceModalSideCtrl",["$scope","$uibModalInstance","project","$log","$uibModal","$timeout","SweetAlert","isview","$http","DTOptionsBuilder","DTColumnBuilder","$compile","toaster",function(e,t,r,a,n,o,i,s,c,l,d,u,p){e.project=r,e.projectTask=r.projectTask,e.projectTask.tracking={action:"",description:""},e.isview=s,e.reschedule=!1,e.onCLose=function(){t.close()},e.onCancel=function(){t.dismiss("cancel")},e.form={submit:function(t){var r=null;if(t.$invalid){var a=null,r=null;for(a in t)"$"!=a[0]&&(null!==r||t[a].$valid||(r=t[a].$name),t[a].$pristine&&(t[a].$dirty=!0));return angular.element(".ng-invalid[name="+r+"]").focus(),void o(function(){p.pop("error","Error","Por favor verifique los datos requeridos del formulario y vuelva a intentarlo")},500)}return null==e.projectTask.startDateTime||null==e.projectTask.endDateTime?void o(function(){p.pop("error","Error","Las fechas son requeridas. Por favor diligencia los datos del formulario y vuelva a intentarlo")},500):(o(function(){p.pop("success","Operación Exitosa","Procediendo con el guardado...")},500),void f())},reset:function(e){e.$setPristine(!0)}},e.cancelTask=function(t){var r={id:t,status:"cancelador",tracking:{action:"",description:""}},o=n.open({controller:"ModalInstanceTrackingCtrl",windowTopClass:"top-modal",resolve:{task:function(){return r},action:function(){return"Cancelar"}}});o.result.then(function(t){e.selected=t},function(){a.info("Modal dismissed at: "+new Date),e.reloadData()})},e.completeTask=function(e){var t={id:e,status:"inactivo",tracking:{action:"",description:""}};m(t)},e.reloadlTask=function(t){e.reschedule=!0;var r={id:t,status:"inactivo",tracking:{action:"Reprogramar",description:""}};g(r.id)},e.$watch("projectTask.endDateTime - projectTask.startDateTime",function(){var t=new moment(e.projectTask.endDateTime),r=new moment(e.projectTask.startDateTime);e.projectTask.duration=moment.duration(t.diff(r)).hours()});var f=function(){var t={};e.projectTask.startDateTime=e.projectTask.startDateTime.toISOString(),e.projectTask.endDateTime=e.projectTask.endDateTime.toISOString();var r=JSON.stringify(e.projectTask);return t.data=Base64.encode(r),c({method:"POST",url:"api/internal-project/task/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){o(function(){i.swal("Validación exitosa","Procediendo con el guardado...","success"),e.onCLose()})})["catch"](function(e){a.error(e),i.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})},m=function(t){var r={},n=JSON.stringify(t);return r.data=Base64.encode(n),c({method:"POST",url:"api/internal-project/task/update",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(r)}).then(function(t){o(function(){i.swal("Validación exitosa","Procediendo con el guardado...","success"),e.projectTask=t.data.result,e.onCLose()})})["catch"](function(e){a.error(e),i.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})},g=function(t){var r={id:t};c({method:"GET",url:"api/internal-project/task",params:r})["catch"](function(e,t){if(403==t){var r=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";i.swal("No Autorizado","No estas autorizado para ver esta información.","error"),o(function(){$state.go(r)},3e3)}else 404==t?(i.swal("Información no disponible","Seguimiento no encontrado","error"),o(function(){$state.go("app.clientes.list")})):i.swal("Error","Se ha presentado un error al intentar acceder a la información del seguimiento","error")}).then(function(t){o(function(){e.projectTask=t.data.result,e.projectTask.startDateTime=new Date(e.projectTask.startDateTime.date),e.projectTask.endDateTime=new Date(e.projectTask.endDateTime.date),e.reschedule&&(e.projectTask.tracking={action:"Reprogramar",description:""})})})["finally"](function(){o(function(){e.loading=!1,e.isview=!0},400)})};e.request={},e.request.operation="tracking",e.request.project_agent_id=e.currentProjectAgentId,e.changeResponsible=function(t,r){o(function(){e.currentProjectAgentId=t.id,e.projectTask.projectAgentId=e.currentProjectAgentId,e.request.project_agent_id=e.currentProjectAgentId,e.reloadData()})},e.dtInstanceTask={},e.dtOptionsTask=l.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:e.request,url:"api/internal-project/tasks",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,r,a){u(angular.element(t).contents())(e)}),e.dtColumnsTask=[d.newColumn(null).withTitle("Acciones").withOption("width",80).notSortable().renderWith(function(e,t,r,a){var n="",o='<a class="btn btn-primary btn-xs" href="#" uib-tooltip="Completar tarea" ng-click="completeTask('+e.id+')" >   <i class="fa fa-check-circle-o"></i></a> ',i='<a class="btn btn-info btn-xs" href="#" uib-tooltip="Reprogramar tarea" ng-click="reloadlTask('+e.id+')" >   <i class="fa fa-clock-o"></i></a> ',s='<a class="btn btn-danger btn-xs" href="#" uib-tooltip="Cancelar tarea" ng-click="cancelTask('+e.id+')">   <i class="fa fa-trash-o"></i></a> ';return"activo"==e.status&&(n+=i,n+=o,n+=s),n}),d.newColumn("task").withTitle("Tarea").withOption("width",100),d.newColumn("type").withTitle("Tipo").withOption("width",100),d.newColumn("startDateTime").withTitle("Fecha Inicio").withOption("width",100),d.newColumn("endDateTime").withTitle("Fecha Fin").withOption("width",100),d.newColumn("status").withTitle("Estado").withOption("width",80).renderWith(function(e,t,r,a){var n="",o="";switch(e){case"activo":n="label label-success",o="Programada";break;case"cancelador":n="label label-danger",o="Cancelada";break;case"inactivo":n="label label-warning",o="Completada"}var i='<span class="'+n+'">'+o+"</span>";return i})],e.reloadData=function(){e.dtInstanceTask.reloadData()}}]);
"use strict";app.controller("certificateCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","SweetAlert","$http","$timeout",function(e,a,r,t,i,o,n,c,d,l,s,f,u){e.showIframe=!1,e.currentURL="",e.certificate={validateCode:""},e.onValidateCode=function(){if(""==e.certificate.validateCode)return void c.pop("error","Error","Por favor digite el código de validacion");var a={};a.id=e.certificate.validateCode,f({method:"POST",url:"api/certificate-grade-participant/validate",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)})["catch"](function(e,a){if(403==a){var r=null!==e.message&&void 0!==e.message?e.message:"app.asesores.list";s.swal("No Autorizado","No estas autorizado para ver esta información.","error"),u(function(){d.go(r)},3e3)}else 404==a?s.swal("Información no disponible","Código no encontrada","error"):s.swal("Error","Se ha presentado un error al intentar acceder a la información del cliente","error")}).then(function(a){null!=a&&u(function(){e.showIframe=!0,e.currentURL="",e.currentURL="api/certificate-grade-participant-certificate/stream?id="+a.data.result.id})})["finally"](function(){})},e.onDownloadCertificate=function(){if(""==e.certificate.validateCode)return void c.pop("error","Error","Por favor digite la cedula de ciudadania");var a={};a.id=e.certificate.validateCode,f({method:"POST",url:"api/certificate-grade-participant/download",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)})["catch"](function(e,a){if(403==a){var r=null!==e.message&&void 0!==e.message?e.message:"app.asesores.list";s.swal("No Autorizado","No estas autorizado para ver esta informaci�n.","error"),u(function(){d.go(r)},3e3)}else 404==a?s.swal("Información no disponible","Cedula no encontrada","error"):s.swal("Error","Se ha presentado un error al intentar acceder a la información del certificado","error")}).then(function(a){null!=a&&u(function(){e.showIframe=!0,e.currentURL="api/certificate-grade-participant-certificate/stream?id="+a.data.result.id})})["finally"](function(){})},e.onCancel=function(){e.showIframe=!1,e.currentURL=""}}]);
"use strict";app.controller("certificateAdminTabsCtrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout","$state","$filter","flowFactory","$http",function(t,e,i,a,r,c,n,s,o,m){n.is("app.certificate.admin.view")?t.certificate_admin_title_tab="view":n.is("app.certificate.admin.create")?t.certificate_admin_title_tab="create":t.certificate_admin_title_tab="edit",t.isAgent="agent"==r.currentUser().wg_type,t.isAdmin="system"==r.currentUser().wg_type,t.isCustomer="customerAdmin"==r.currentUser().wg_type||"customerUser"==r.currentUser().wg_type,t.tabsloaded=["program"],t.tabname="program",t.titletab=t.certificate_admin_title_tab,t.switchTab=function(e,i){c(function(){t.tabname=e,t.titletab=i,t.tabsloaded.push(e)})},t.switchSubTab=function(e){c(function(){t.subtab=e})}}]);
"use strict";app.controller("certificateAdminProgramCtrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout",function(o,t,r,e,i,c){var n=r;n.info("loading..certificateAdminProgramCtrl!!! "),o.program_section="list",o.currentId=0,o.formMode="edit",o.navToSection=function(t,r,e){c(function(){o.program_section=t,o.formMode=r,o.$parent.switchSubTab(r),o.currentId=e})}}]);
"use strict";app.controller("certificateAdminProgramListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","SweetAlert","$http",function(t,e,i,n,a,r,o,l,c,s,d,u){var m=i,p={};m.info("entrando en... certificateAdminProgramCtrl"),t.isAgent="agent"==s.currentUser().wg_type,t.isAdmin="system"==s.currentUser().wg_type,t.isCustomer="customerAdmin"==s.currentUser().wg_type||"customerUser"==s.currentUser().wg_type,t.isAgent?c.go("app.clientes.list"):t.isCustomer&&(m.info("Step 3"),c.go("app.clientes.view",{customerId:s.currentUser().company})),p.operation="program",t.dtProgramOptions=n.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:p,url:"api/certificate-program",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){w()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,i,n){o(angular.element(e).contents())(t)}),t.dtProgramColumns=[a.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,e,i,n){var a="",r='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar"  data-id="'+t.id+'" >   <i class="fa fa-edit"></i></a> ',o='<a class="btn btn-info btn-xs viewRow lnk" href="#" uib-tooltip="Ver" data-id="'+t.id+'" >   <i class="fa fa-eye"></i></a> ',l='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+t.id+'" >   <i class="fa fa-trash-o"></i></a> ';return s.can("certificate_program_view")&&(a+=o),s.can("certificate_program_edit")&&(a+=r),s.can("certificate_program_delete")&&(a+=l),a}),a.newColumn("name").withTitle("Nombre").withOption("width",200),a.newColumn("category.item").withTitle("Categoría"),a.newColumn("capacity").withTitle("Capacidad",200),a.newColumn("hourDuration").withTitle("Duración (Hora)",200),a.newColumn("authorizationResolution").withTitle("Resolución",200),a.newColumn(null).withTitle("Estado").withOption("width",200).renderWith(function(t,e,i,n){var a="",r="";t.isActive?(a="label label-success",r="Activo"):(a="label label-danger",r="Inactivo");var o='<span class="'+a+'">'+r+"</span>";return o})];var w=function(){$("#dtCertificateProgram a.editRow").on("click",function(){var e=$(this).data("id");t.onEditProgram(e)}),$("#dtCertificateProgram a.viewRow").on("click",function(){var e=$(this).data("id");t.onViewProgram(e)}),$("#dtCertificateProgram a.delRow").on("click",function(){var e=$(this).data("id");m.info("intenta eliminar el registro: "+e),d.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(n){if(n){var a={};a.id=e,u({method:"POST",url:"api/certificate-program/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){i.error(t),d.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){t.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};t.onCreateProgram=function(){null!=t.$parent&&t.$parent.navToSection("form","edit",0)},t.onEditProgram=function(e){null!=t.$parent&&t.$parent.navToSection("form","edit",e)},t.onViewProgram=function(e){null!=t.$parent&&t.$parent.navToSection("form","view",e)},t.reloadData=function(){m.info("reloading..."),t.dtProgramOptions.reloadData()}}]);
"use strict";app.controller("certificateAdminProgramEditCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","SweetAlert","$rootScope","$http","$timeout","$uibModal","flowFactory","cfpLoadingBar","$filter","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder",function(e,r,a,i,o,n,t,l,c,s,u,d,m,p,f,g,v){var y=a;if(e.loading=!0,e.isView="view"==e.$parent.formMode,e.isCreate="create"==e.$parent.formMode,e.currencies=u.parameters("certificate_program_currency"),e.categories=u.parameters("certificate_program_category"),e.specialities=u.parameters("agent_skill"),e.validities=u.parameters("certificate_program_validity_type"),e.specialityCategories=u.parameters("certificate_program_speciality_category"),e.requirements=u.parameters("certificate_program_requirement"),e.program={id:e.isCreate?0:e.$parent.currentId,code:"",name:"",amount:0,currency:null,category:null,speciality:null,capacity:0,hourDuration:0,validityNumber:0,validityType:null,authorizationResolution:"",authorizingEntity:"",captionHeader:"",captionFooter:"",description:"",isActive:!0,specialities:[],requirements:[],isMandatory:!1},0!=e.program.id){y.info("editando cliente con código: "+e.program.id);var w={id:e.program.id};d({method:"GET",url:"api/certificate-program",params:w})["catch"](function(e,r){if(403==r){var a=null!==e.message&&void 0!==e.message?e.message:"app.certificate.admin";s.swal("No Autorizado","No estas autorizado para ver esta información.","error"),m(function(){c.go(a)},3e3)}else 404==r?(s.swal("Información no disponible","Encuesta no encontrada","error"),m(function(){})):s.swal("Error","Se ha presentado un error al intentar acceder a la información del cliente","error")}).then(function(r){m(function(){e.program=r.data.result})})["finally"](function(){m(function(){C(),e.loading=!1},400)})}else y.info("creacion de nuevo asesor "),e.loading=!1;e.removeImage=function(){e.noImage=!0},e.master=e.program,e.form={submit:function(r){var a=null;if(r.$invalid){var i=null,a=null;for(i in r)"$"!=i[0]&&(null!==a||r[i].$valid||(a=r[i].$name),r[i].$pristine&&(r[i].$dirty=!0));return y.info(e.poll),angular.element(".ng-invalid[name="+a+"]").focus(),void s.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}s.swal("Validación exitosa","Guardando información de la encuesta...","success"),y.info(e.program),h()},reset:function(r){e.program=angular.copy(e.master),r.$setPristine(!0)}};var h=function(){var r={},i=JSON.stringify(e.program);return r.data=Base64.encode(i),d({method:"POST",url:"api/certificate-program/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(r)}).then(function(r){m(function(){null!=e.$parent&&e.$parent.navToSection("list","list")})})["catch"](function(e){a.error(e),s.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};e.onCancel=function(){e.isView?null!=e.$parent&&e.$parent.navToSection("list","list"):s.swal({title:"Está seguro?",text:"Perderá todos los cambios realizados en este formulario.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, cancelar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(r){r?m(function(){null!=e.$parent&&e.$parent.navToSection("list","list")}):swal("Cancelación","La operación ha sido cancelada","error")})};var C=function(){var a={};a.program_id=r.id?r.id:0,d({method:"POST",url:"api/collection-data",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)})["catch"](function(e,r){}).then(function(r){m(function(){e.collections=r.data.data,e.collectionsReport=v("filter")(e.collections,{type:"quote"})})})["finally"](function(){})};e.onAddSpeciality=function(){if(null==e.program.specialityCategory)s.swal("Error","Debe seleccionar la especialidad. Por favor verifique! !","error");else{var r=v("filter")(e.program.specialities,{categoryId:e.program.specialityCategory.id});if(0==r.length){var a={id:0,certificateProgramId:e.isCreate?0:e.$parent.currentId,categoryId:e.program.specialityCategory.id,category:e.program.specialityCategory};e.program.specialities.push(a)}}},e.onRemoveSpeciality=function(r){s.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(i){i?m(function(){var i=e.program.specialities[r];if(e.program.specialities.splice(r,1),0!=i.id){var o={};o.id=i.id,d({method:"POST",url:"api/certificate-program-speciality/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){a.error(e),s.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})},e.onAddRequirement=function(){if(null==e.program.requirement)s.swal("Error","Debe seleccionar el requerimiento. Por favor verifique! !","error");else{var r=v("filter")(e.program.requirements,{requirementId:e.program.requirement.id});if(0==r.length){var a={id:0,certificateProgramId:e.isCreate?0:e.$parent.currentId,requirementId:e.program.requirement.value,requirement:e.program.requirement,isMandatory:void 0!=e.program.isMandatory&&e.program.isMandatory};e.program.requirements.push(a)}}},e.onRemoveRequirement=function(r){s.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(i){i?m(function(){var i=e.program.requirements[r];if(e.program.requirements.splice(r,1),0!=i.id){var o={};o.id=i.id,d({method:"POST",url:"api/certificate-program-requirement/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){a.error(e),s.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})}}]);
"use strict";app.controller("certificateAdminGradeCtrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout",function(t,e,o,r,i,c){var n=o;n.info("loading..certificateAdminGradeCtrl!!! "),t.grade_section="list",t.currentId=0,t.formMode="edit",t.navToSection=function(e,o,r){c(function(){t.grade_section=e,t.formMode=o,t.$parent.switchSubTab(o),t.currentId=r})}}]);
"use strict";app.controller("certificateAdminGradeListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","SweetAlert","$http","$timeout",function(e,t,a,n,i,r,o,l,c,s,d,u,f){var p=a;p.info("entrando en... certificateAdminGradeListCtrl"),e.isAgent="agent"==s.currentUser().wg_type,e.isAdmin="system"==s.currentUser().wg_type,e.isCustomer="customerAdmin"==s.currentUser().wg_type||"customerUser"==s.currentUser().wg_type,e.status=s.parameters("certificate_grade_status"),e.locations=s.parameters("certificate_grade_location"),e.agents=s.agents(),e.filter={selectedStatus:null,selectedAgent:null,selectedLocation:null,startDate:null,endDate:null,selectedProgram:null},e.request={status:"",agentId:"",location:"",startDate:"",endDate:"",program:""},e.isAgent?c.go("app.clientes.list"):e.isCustomer&&(p.info("Step 2"),c.go("app.clientes.view",{customerId:s.currentUser().company}));var m=function(){var t={};t.operation="program",u({method:"POST",url:"api/certificate-program",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)})["catch"](function(e,t){}).then(function(t){f(function(){e.programs=t.data.data})})["finally"](function(){})};m(),e.request.operation="program",e.dtGradeOptions=n.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:e.request,url:"api/certificate-grade",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){w()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,a,n){o(angular.element(t).contents())(e)}),e.dtGradeColumns=[i.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,t,a,n){var i="",r='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar"  data-id="'+e.id+'" >   <i class="fa fa-edit"></i></a> ',o='<a class="btn btn-info btn-xs viewRow lnk" href="#" uib-tooltip="Ver" data-id="'+e.id+'" >   <i class="fa fa-eye"></i></a> ',l='<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Eliminar" data-id="'+e.id+'" >   <i class="fa fa-trash-o"></i></a> ';return s.can("certificate_program_view")&&(i+=o),s.can("certificate_program_edit")&&(i+=r),s.can("certificate_program_delete")&&(i+=l),i}),i.newColumn("name").withTitle("Nombre").withOption("width",200),i.newColumn("program").withTitle("Programa").withOption("width",200),i.newColumn("category").withTitle("Categoría"),i.newColumn("capacity").withTitle("Capacidad",200),i.newColumn("registered").withTitle("Inscritos",200),i.newColumn("quota").withTitle("Cupos",200),i.newColumn(null).withTitle("Estado").withOption("width",200).renderWith(function(e,t,a,n){var i="";switch(e.status){case"Registro":i="label label-success";break;case"Cerrado":i="label label-danger";break;case"Ejecución":i="label label-warning";break;case"Cancelado":i="label label-default"}var r='<span class="'+i+'">'+e.status+"</span>";return r})];var w=function(){$("#dtCertificateGrade a.editRow").on("click",function(){var t=$(this).data("id");e.onEditGrade(t)}),$("#dtCertificateGrade a.viewRow").on("click",function(){var t=$(this).data("id");e.onViewGrade(t)}),$("#dtCertificateGrade a.delRow").on("click",function(){var t=$(this).data("id");p.info("intenta eliminar el registro: "+t),d.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(n){if(n){var i={};i.id=t,u({method:"POST",url:"api/certificate-program/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){a.error(e),d.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){e.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};e.onCreateGrade=function(){null!=e.$parent&&e.$parent.navToSection("form","edit",0)},e.onEditGrade=function(t){null!=e.$parent&&e.$parent.navToSection("form","edit",t)},e.onViewGrade=function(t){null!=e.$parent&&e.$parent.navToSection("form","view",t)},e.reloadData=function(){p.info("reloading..."),e.dtGradeOptions.reloadData()},e.onSearch=function(t,a){f(function(){e.request.location=null!=e.filter.selectedLocation?e.filter.selectedLocation.value:"",e.request.status=null!=e.filter.selectedStatus?e.filter.selectedStatus.value:"",e.request.program=null!=e.filter.selectedProgram?e.filter.selectedProgram.id:"",e.request.agentId=null!=e.filter.selectedAgent?e.filter.selectedAgent.id:0,e.request.startDate=null!=e.filter.startDate?kendo.toString(e.filter.startDate,"yyyy-MM-dd"):"",e.request.endDate=null!=e.filter.endDate?kendo.toString(e.filter.endDate,"yyyy-MM-dd"):"",e.reloadData()})},e.clearLocation=function(){f(function(){e.request.location="",e.filter.selectedLocation=null,e.reloadData()})},e.clearStatus=function(){f(function(){e.request.status="",e.filter.selectedStatus=null,e.reloadData()})},e.clearProgram=function(){f(function(){e.request.program="",e.filter.selectedProgram=null,e.reloadData()})},e.clearAgent=function(){f(function(){e.request.agentId=0,e.filter.selectedAgent=null,e.reloadData()})},e.clearStartDate=function(){f(function(){e.request.startDate="",e.filter.startDate=null,e.reloadData()})},e.clearEndDate=function(){f(function(){e.request.endDate="",e.filter.endDate=null,e.reloadData()})}}]);
"use strict";app.controller("certificateAdminGradeEditCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","SweetAlert","$rootScope","$http","$timeout","$uibModal","flowFactory","cfpLoadingBar","$filter","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder",function(e,a,r,n,t,o,i,l,c,s,d,u,f,g,m,p,h){var v=r;if(e.loading=!0,e.isView="view"==e.$parent.formMode,e.isCreate="create"==e.$parent.formMode,e.programs=[],e.status=d.parameters("certificate_grade_status"),e.locations=d.parameters("certificate_grade_location"),e.workCenters=d.parameters("certificate_grade_work_center"),e.channels=d.parameters("certificate_grade_channel"),e.validities=d.parameters("certificate_program_validity_type"),e.specialities=d.parameters("agent_skill"),e.agents=[],e.totalHourDuration=0,e.grade={id:e.isCreate?0:e.$parent.currentId,program:null,code:"",name:"",location:null,description:"",status:null,calendar:[],agents:[]},e.grade.id>0){v.info("editando cliente con código: "+e.grade.id);var w={id:e.grade.id};u({method:"GET",url:"api/certificate-grade",params:w})["catch"](function(e,a){if(403==a){var r=null!==e.message&&void 0!==e.message?e.message:"app.asesores.list";s.swal("No Autorizado","No estas autorizado para ver esta información.","error"),f(function(){c.go(r)},3e3)}else 404==a?(s.swal("Información no disponible","Encuesta no encontrada","error"),f(function(){})):s.swal("Error","Se ha presentado un error al intentar acceder a la información del cliente","error")}).then(function(a){f(function(){e.grade=a.data.result,e.grade.defaultSpeciality=e.grade.program.speciality,e.loadAgents(e.grade.defaultSpeciality.value)})})["finally"](function(){f(function(){D(),e.loading=!1},400)})}else v.info("creacion de nuevo asesor "),e.loading=!1;e.removeImage=function(){e.noImage=!0},e.master=e.grade,e.form={submit:function(a){var r=null;if(a.$invalid){var n=null,r=null;for(n in a)"$"!=n[0]&&(null!==r||a[n].$valid||(r=a[n].$name),a[n].$pristine&&(a[n].$dirty=!0));return v.info(e.grade),angular.element(".ng-invalid[name="+r+"]").focus(),void s.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}s.swal("Validación exitosa","Guardando información de la encuesta...","success"),v.info(e.grade),C()},reset:function(a){e.grade=angular.copy(e.master),a.$setPristine(!0)}};var C=function(){var a={},n=JSON.stringify(e.grade);return a.data=Base64.encode(n),u({method:"POST",url:"api/certificate-grade/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(a){f(function(){null!=e.$parent&&e.$parent.navToSection("list","list")})})["catch"](function(e){r.error(e),s.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};e.onCancel=function(){e.isview||s.swal({title:"Está seguro?",text:"Perderá todos los cambios realizados en este formulario.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, cancelar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(a){a?f(function(){null!=e.$parent&&e.$parent.navToSection("list","list")}):swal("Cancelación","La operación ha sido cancelada","error")})};var D=function(){var a={};a.operation="program-list",u({method:"POST",url:"api/certificate-program",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)})["catch"](function(e,a){}).then(function(a){f(function(){e.programs=a.data.data})})["finally"](function(){})};D(),e.onAddCalendarDate=function(){if(null==e.grade.startDateTime||null==e.grade.hourDuration||0==e.grade.hourDuration)s.swal("Error","Debe ingresar la información requerida. Por favor verifique! !","error");else{if(e.grade.hourDuration>24)return void l.pop("error","Error","La duración supera las horas disponibles por fecha.");if(e.totalHourDuration+parseInt(e.grade.hourDuration)>parseInt(e.grade.program.hourDuration))return void l.pop("error","Error","La duración total supera las horas asignadas al program.");var a=h("filter")(e.grade.calendar,{startDate:e.grade.startDateTime.id});if(0==a.length){var r={id:0,certificateGradeId:e.isCreate?0:e.$parent.currentId,startDateFormat:h("date")(e.grade.startDateTime,"dd/MM/yyyy"),startDate:e.grade.startDateTime,hourDuration:e.grade.hourDuration};e.grade.calendar.push(r)}}},e.$watch("grade.calendar",function(){r.info(e.grade.calendar.length),e.totalHourDuration=0,e.grade.calendar.length>0&&angular.forEach(e.grade.calendar,function(a){e.totalHourDuration+=parseInt(a.hourDuration)})},!0),e.onRemoveCalendarDate=function(a){s.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(n){n?f(function(){var n=e.grade.calendar[a];if(e.grade.calendar.splice(a,1),0!=n.id){var t={};t.id=n.id,u({method:"POST",url:"api/certificate-grade-calendar/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){r.error(e),s.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})},e.changeSkill=function(a,r){e.grade.agents=[],e.loadAgents(a.value)},e.changeProgram=function(a,r){e.grade.defaultSpeciality=a.speciality,e.loadAgents(a.speciality.value)},e.loadAgents=function(a){var n={};n.skill=a;var t=JSON.stringify(e.customer);return n.data=t,u({method:"POST",url:"api/project/agent",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(a){f(function(){e.agents=a.data.data})})["catch"](function(e){r.error(e),s.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})},e.onAddAgent=function(a){s.swal({title:"Está seguro?",text:"Confirmas adicionar este recurso al proyecto?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, adicionar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(r){r?f(function(){var r=h("filter")(e.grade.agents,{agentId:e.agents[a].id});0==r.length&&e.grade.agents.push({id:0,agentId:e.agents[a].id,certificateGradeId:e.isCreate?0:e.$parent.currentId,estimatedHours:e.agents[a].estimatedHours,notAssignedHours:e.agents[a].notAssignedHours,name:e.agents[a].name})}):swal("Cancelación","La operación ha sido cancelada","error")})},e.onRemoveAgent=function(a){s.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(n){n?f(function(){var n=e.grade.agents[a];if(e.grade.agents.splice(a,1),0!=n.id){var t={};t.id=n.id,u({method:"POST",url:"api/certificate-grade-agent/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){r.error(e),s.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})}}]);
"use strict";app.controller("certificateAdminGradeParticipantEditCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","SweetAlert","$rootScope","$http","$timeout","$uibModal","flowFactory","cfpLoadingBar","$filter","$aside","$document",function(t,n,e,a,i,o,r,c,l,s,u,d,p,f,m,w,h,g,v){var C=e,y={};t.flowConfig={target:"/api/certificate-grade-participant/upload",singleFile:!0},t.customerId=0,t.grade={},t.loading=!0,t.isView="view"==t.$parent.formMode,t.isCreate="create"==t.$parent.formMode,t.currentId=0,t.customers=[],t.workCenters=u.parameters("certificate_grade_work_center"),t.channels=u.parameters("certificate_grade_channel"),t.countries=u.countries(),t.documentTypes=u.parameters("tipodoc"),t.extrainfo=u.parameters("extrainfo"),t.agents=[],t.prices=[],t.participant={id:t.isCreate?0:t.currentId,certificateGradeId:t.$parent.currentId,logo:"",customer:null,documentType:null,identificationNumber:"",name:"",lastName:"",workCenter:null,price:null,channel:null,countryOrigin:null,countryResidence:null,isApproved:!1,contacts:[]},t.uploader=new Flow,""==t.participant.logo&&(t.noImage=!0);t.removeImage=function(){t.noImage=!0},t.master=t.participant,t.form={submit:function(n){var e=null;if(n.$invalid){var a=null,e=null;for(a in n)"$"!=a[0]&&(null!==e||n[a].$valid||(e=n[a].$name),n[a].$pristine&&(n[a].$dirty=!0));return C.info(t.participant),angular.element(".ng-invalid[name="+e+"]").focus(),void s.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}s.swal("Validación exitosa","Guardando información de la encuesta...","success"),C.info(t.participant),b()},reset:function(n){t.participant=angular.copy(t.master),n.$setPristine(!0)}};var b=function(){var n={},a=JSON.stringify(t.participant);return n.data=Base64.encode(a),d({method:"POST",url:"api/certificate-grade-participant/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(n){t.uploader.flow.opts.query.id=n.data.result.id,t.uploader.flow.resume(),p(function(){null!=t.$parent&&t.reloadData()})})["catch"](function(t){e.error(t),s.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){t.onClear()})};t.onCancel=function(){t.isview||s.swal({title:"Está seguro?",text:"Perderá todos los cambios realizados en este formulario.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, cancelar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(n){n?p(function(){null!=t.$parent&&t.$parent.navToSection("list","list")}):swal("Cancelación","La operación ha sido cancelada","error")})},t.changeProgram=function(n,e){t.participant.defaultSpeciality=n.speciality,t.loadAgents(n.speciality.value)},p(function(){T(),P()},10);var T=function(){};t.onAddInfoDetail=function(){p(function(){null==t.participant.contacts&&(t.participant.contacts=[]),t.participant.contacts.push({id:0,value:"",type:null})})},t.onLoadRecord=function(){if(t.participant.id){C.info("editando cliente con código: "+t.participant.id);var n={id:t.participant.id};d({method:"GET",url:"api/certificate-grade-participant",params:n})["catch"](function(t,n){if(403==n){var e=null!==t.message&&void 0!==t.message?t.message:"app.asesores.list";s.swal("No Autorizado","No estas autorizado para ver esta información.","error"),p(function(){l.go(e)},3e3)}else 404==n?(s.swal("Información no disponible","Encuesta no encontrada","error"),p(function(){})):s.swal("Error","Se ha presentado un error al intentar acceder a la información del cliente","error")}).then(function(n){p(function(){t.participant=n.data.result,t.customerId=t.participant.customer.id,O(),null!=t.participant.logo&&null!=t.participant.logo.path?t.noImage=!1:t.noImage=!0})})["finally"](function(){p(function(){T(),t.loading=!1},400),p(function(){v.scrollTop(40,2e3)})})}else C.info("creacion de nuevo asesor "),t.loading=!1},t.removeImage=function(){t.noImage=!0};var O=function(){var n={};return n.customer_id=t.customerId,d({method:"POST",url:"api/customer/certificate-program",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(n){p(function(){var e=n.data.data;if(0==e.length){t.prices=[];var a={id:0,amount:t.grade.program.amount};t.prices.push(a)}else{t.prices=[];var a={id:0,amount:t.grade.program.amount};t.prices.push(a),angular.forEach(e,function(n,e){if(n.program.id==t.grade.program.id){var a={id:n.id,amount:n.amount};t.prices.push(a)}})}})})["catch"](function(t){e.error(t),s.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})},P=function(){if(t.$parent.currentId>0){var n={id:t.$parent.currentId};d({method:"GET",url:"api/certificate-grade",params:n})["catch"](function(t,n){if(403==n){var e=null!==t.message&&void 0!==t.message?t.message:"app.asesores.list";s.swal("No Autorizado","No estas autorizado para ver esta información.","error"),p(function(){l.go(e)},3e3)}else 404==n?(s.swal("Información no disponible","Encuesta no encontrada","error"),p(function(){})):s.swal("Error","Se ha presentado un error al intentar acceder a la información del cliente","error")}).then(function(n){p(function(){t.grade=n.data.result,O()})})["finally"](function(){p(function(){t.loading=!1},400)})}};t.changeCustomer=function(n,e){t.customerId=n.id,t.participant.price=null,O()},t.onRemoveContact=function(n){s.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(a){a?p(function(){var a=t.participant.contacts[n];if(t.participant.contacts.splice(n,1),0!=a.id){var i={};i.id=a.id,d({method:"POST",url:"api/certificate-grade-participant-contact/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){e.error(t),s.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})};var D=function(){var n={},a=JSON.stringify(t.customer);return n.data=a,d({method:"POST",url:"api/project/customer",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(n)}).then(function(n){p(function(){t.customers=n.data.data})})["catch"](function(t){e.error(t),s.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};D(),y.operation="participant",y.certificate_grade_id=t.$parent.currentId,t.dtInstanceParticipant={},t.dtOptionsParticipant=a.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:y,url:"api/certificate-grade-participant",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){I()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(n,e,a){r(angular.element(n).contents())(t)}),t.dtColumnsParticipant=[i.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,n,e,a){var i="",o="",r='<a class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar"  data-id="'+t.id+'"'+o+' >   <i class="fa fa-edit"></i></a> ',c='<a class="btn btn-info btn-xs viewRow lnk" href="#"  uib-tooltip="Ver" data-id="'+t.id+'" >   <i class="fa fa-eye"></i></a> ',l='<a class="btn btn-danger btn-xs delRow lnk" href="#"  uib-tooltip="Eliminar" data-id="'+t.id+'"'+o+' >   <i class="fa fa-trash-o"></i></a> ',s='<a class="btn btn-success btn-xs uploadRow lnk" href="#"  uib-tooltip="Adicionar anexo" data-id="'+t.id+'"'+o+' >   <i class="fa fa-paperclip"></i></a> ';return u.can("certificate_program_view")&&(i+=c),u.can("certificate_program_edit")&&(i+=r),u.can("certificate_program_delete")&&(i+=l),u.can("certificate_program_edit")&&(i+=s),i}),i.newColumn("documentType.item").withTitle("Tipo de Identificación").withOption("width",200),i.newColumn("identificationNumber").withTitle("Identificación").withOption("width",200),i.newColumn("name").withTitle("Nombres").withOption("width",200),i.newColumn("lastName").withTitle("Apellidos").withOption("width",200),i.newColumn(null).withTitle("Empresa").withOption("width",200).renderWith(function(t,n,e,a){return t.customer.length>0?t.customer[0].item:t.customer.item}),i.newColumn("price.amount").withTitle("Precio").withOption("width",200),i.newColumn(null).withTitle("Anexos").withOption("width",200).renderWith(function(t,n,e,a){var i="label label-warning",o=0;null==t.attachment&&void 0==t.attachment||(o=t.attachment);var r='<span class="'+i+'">'+o+" Anexos </span>";return r}),i.newColumn(null).withTitle("Cumple requisitos").withOption("width",200).renderWith(function(t,n,e,a){var i="label label-danger",o="Inactivo";null==t.isApproved&&void 0==t.isApproved||(t.isApproved?(i="label label-success",o="Si cumple"):(i="label label-danger",o="No Cumple"));var r='<span class="'+i+'">'+o+"</span>";return r})],t.onViewParticipant=function(n){t.currentId=n,t.participant.id=n,t.isView=!0,t.onLoadRecord()},t.onEditParticipant=function(n){t.currentId=n,t.participant.id=n,t.isView=!1,t.onLoadRecord()},t.cancelEdition=function(n){null!=t.$parent&&t.$parent.navToSection("list","list",0)},t.onClear=function(){p(function(){t.participant={id:t.isCreate?0:t.currentId,certificateGradeId:t.$parent.currentId,logo:"",customer:null,documentType:null,identificationNumber:"",name:"",lastName:"",workCenter:"",price:null,channel:null,countryOrigin:null,countryResidence:null,isApproved:!1,contacts:[]}}),p(function(){t.noImage=!0,v.scrollTop(40,2e3)}),t.isView=!1};var I=function(){$("#dtParticipants a.editRow").on("click",function(){var n=$(this).data("id");t.onEditParticipant(n)}),$("#dtParticipants a.viewRow").on("click",function(){var n=$(this).data("id");t.participant.id=n,t.onViewParticipant(n)}),$("#dtParticipants a.uploadRow").on("click",function(){var n=$(this).data("id");t.participant.id=n,t.onAddDocument()}),$("#dtParticipants a.delRow").on("click",function(){var n=$(this).data("id");C.info("intenta eliminar el registro: "+n),s.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(a){if(a){var i={};i.id=n,d({method:"POST",url:"api/certificate-grade-participant/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(i)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){e.error(t),s.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){t.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};t.onAddDocument=function(){var n=g.open({templateUrl:u.app.views.urlRoot+"modules/certificate/certificateadmingrade/app_modal_certificate_grade_participant_document.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideParticipantDocumentCtrl",scope:t,resolve:{participant:function(){return t.participant},grade:function(){return t.grade}}});n.result.then(function(){t.reloadData()})},t.reloadData=function(){t.dtInstanceParticipant.reloadData()},t.onAddCustomer=function(){var n=g.open({templateUrl:u.app.views.urlRoot+"modules/certificate/certificateadmingrade/certificate_grade_participant_modal_customer.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideCustomerCtrl",scope:t,resolve:{participant:function(){return t.participant}}});n.result.then(function(){D()})}}]),app.controller("ModalInstanceSideCustomerCtrl",["$rootScope","$scope","$uibModalInstance","participant","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile",function(t,n,e,a,i,o,r,c,l,s,u,d,p,f){n.documentTypes=t.parameters("tipodoc"),n.extrainfo=t.parameters("extrainfo"),n.countries=t.countries(),n.types=t.parameters("tipocliente"),n.participant=a,n.customer={id:0,logo:"",businessName:"",economicActivity:"",documentNumber:"",documentType:null,type:null,country:null,state:null,town:null,status:null,webSite:"http://www.stioweb.com",contacts:[]},n.onCloseModal=function(){e.close(1)},n.onCancelCustomer=function(){e.dismiss("cancel")},n.form={submit:function(t){var e=null;if(t.$invalid){var a=null,e=null;for(a in t)"$"!=a[0]&&(null!==e||t[a].$valid||(e=t[a].$name),t[a].$pristine&&(t[a].$dirty=!0));return angular.element(".ng-invalid[name="+e+"]").focus(),void o(function(){l.pop("error","Error","Por favor verifique los datos requeridos del formulario y vuelva a intentarlo")},500)}o(function(){l.pop("success","Operación Exitosa","Procediendo con el guardado...")},500),n.onSaveCustomer()},reset:function(t){t.$setPristine(!0)}},n.onSaveCustomer=function(){var t={},e=JSON.stringify(n.customer);return t.data=Base64.encode(e),c({method:"POST",url:"api/customer/saveQuick",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){o(function(){n.customer=t.data.result,r.swal("Validación exitosa","Procediendo con el guardado...","success"),n.onCloseModal()})})["catch"](function(t){i.error(t),r.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})},o(function(){m()},10);var m=function(){var t=s("filter")(n.types,{value:"PA"});t.length>0&&(n.customer.type=t[0]),$(".panel").off("panel-clone").on("panel-clone",function(t,e){o(function(){null==n.customer.contacts&&(n.customer.contacts=[]),n.customer.contacts.push({id:0,value:"",type:null})})})};n.onRemoveContact=function(t){r.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(e){e?o(function(){n.customer.contacts.splice(t,1)}):swal("Cancelación","La operación ha sido cancelada","error")})},n.changeCountry=function(t,e){n.states=[],n.towns=[],n.customer.state=null,n.customer.town=null;var a={cid:t.id};c({method:"GET",url:"api/states",params:a})["catch"](function(t,n){}).then(function(t){n.states=t.data.result,n.towns=[]})["finally"](function(){})},n.changeState=function(t,e){n.towns=[];var a={sid:t.id};n.customer.town=null,c({method:"GET",url:"api/towns",params:a}).then(function(t){n.towns=t.data.result})["finally"](function(){})}}]),app.controller("ModalInstanceSideParticipantDocumentCtrl",["$rootScope","$scope","$uibModalInstance","participant","grade","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile",function(t,n,e,a,i,o,r,c,l,s,u,d,p,f,m){var w=0;n.participantDocumentType=[],angular.forEach(i.program.requirements,function(t,e){n.participantDocumentType.push(t.requirement)}),n.participant=a,n.attachment={id:0,created_at:u("date")(new Date,"dd/MM/yyyy HH:mm"),certificateGradeParticipantId:n.participant.id,agent:{id:0,name:"- Seleccionar - "},requirement:null,classification:null,status:null,version:1,description:""};var h=n.uploader=new d({url:"api/certificate-grade-participant-document/upload",formData:[]});h.filters.push({name:"customFilter",fn:function(t,n){return this.queue.length<10}}),h.onWhenAddingFileFailed=function(t,n,e){console.info("onWhenAddingFileFailed",t,n,e)},h.onAfterAddingFile=function(t){console.info("onAfterAddingFile",t)},h.onAfterAddingAll=function(t){console.info("onAfterAddingAll",t)},h.onBeforeUploadItem=function(t){console.info("onBeforeUploadItem",t);var n={id:w};t.formData.push(n)},h.onProgressItem=function(t,n){console.info("onProgressItem",t,n)},h.onProgressAll=function(t){console.info("onProgressAll",t)},h.onSuccessItem=function(t,n,e,a){console.info("onSuccessItem",t,n,e,a)},h.onErrorItem=function(t,n,e,a){console.info("onErrorItem",t,n,e,a)},h.onCancelItem=function(t,n,e,a){console.info("onCancelItem",t,n,e,a)},h.onCompleteItem=function(t,n,e,a){console.info("onCompleteItem",t,n,e,a)},h.onCompleteAll=function(){console.info("onCompleteAll"),n.clear()},n.onCloseModal=function(){e.close(1)},n.onCancelDocument=function(){e.dismiss("cancel")},n.onSaveDocument=function(){var t={},e=JSON.stringify(n.attachment);return t.data=Base64.encode(e),l({method:"POST",url:"api/certificate-grade-participant-document/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){r(function(){n.attachment=t.data.result,w=t.data.result.id,h.uploadAll(),c.swal("Validación exitosa","Procediendo con el guardado...","success"),n.attachment={id:0,created_at:u("date")(new Date,"dd/MM/yyyy HH:mm"),certificateGradeParticipantId:n.participant.id,agent:{id:0,name:"- Seleccionar - "},requirement:null,classification:null,status:null,version:1,description:""}})})["catch"](function(t){o.error(t),c.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};var g={};g.operation="document",g.certificate_grade_participant_id=n.participant.id,n.dtInstanceCertificateParticipantDocumentAtt={},n.dtOptionsCertificateParticipantDocumentAtt=f.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:g,url:"api/certificate-grade-participant-document",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){v()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,e,a){m(angular.element(t).contents())(n)}),n.dtColumnsCertificateParticipantDocumentAtt=[p.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(n,e,a,i){var o=null!=n.document?n.document.path:"",r="",c='<a target="_self" class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Descargar anexo" data-id="'+n.id+'" data-url="'+o+'" >   <i class="fa fa-download"></i></a> ';'<a class="btn btn-info btn-xs viewRow lnk" target="_blank" href="'+o+'" uib-tooltip="Abrir anexo" data-id="'+n.id+'" >   <i class="fa fa-folder-open-o"></i></a> ','<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Anular anexo" data-id="'+n.id+'" >   <i class="fa fa-ban"></i></a> ';return t.can("seguimiento_view"),t.can("seguimiento_edit")&&(r+=c),t.can("seguimiento_delete"),r}),p.newColumn("requirement").withTitle("Tipo de documento").withOption("width",200),p.newColumn("description").withTitle("Descripción").withOption("width",200),p.newColumn("date").withTitle("Fecha Creación").withOption("width",200),p.newColumn(null).withTitle("Usuario").withOption("width",200).renderWith(function(t,n,e,a){var i="";return null!=t.agent&&(i=t.agent),i})];var v=function(){$("#dtDisabilityDocumentAtt a.editRow").on("click",function(){var t=$(this).data("id"),n=$(this).data("url");""==n?c.swal("Error en la descarga","No existe un anexo para descargar","error"):jQuery("#downloadDocument")[0].src="api/certificate-grade-participant-document/download?id="+t}),$("#dtDisabilityDocumentAtt a.delRow").on("click",function(){var t=$(this).data("id");log.info("intenta eliminar el registro: "+t),c.swal({title:"Está seguro?",text:"Anularás el anexo seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, anular!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(t){t||swal("Cancelación","La operación ha sido cancelada","error")})})};n.reloadData=function(){n.dtInstanceDocument.reloadData()}}]);
"use strict";app.controller("certificateAdminGradeParticipantCertificateListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","SweetAlert","$rootScope","$http","$timeout","$uibModal","flowFactory","cfpLoadingBar","$filter","$aside",function(e,t,n,i,a,r,o,c,l,s,d,u,p,f,m,w,h,g){var C=n,v={};e.customerId=0,e.grade={},e.loading=!0,e.isView="view"==e.$parent.formMode,e.isCreate="create"==e.$parent.formMode,e.currentId=0,e.participant={id:e.isCreate?0:e.currentId,certificateGradeId:e.$parent.currentId,customer:null,documentType:null,identificationNumber:"",name:"",lastName:"",workCenter:null,price:null,channel:null,countryOrigin:null,countryResidence:null,isApproved:!1,contacts:[]};e.removeImage=function(){e.noImage=!0},e.onCancel=function(){e.isView||s.swal({title:"Está seguro?",text:"Perderá todos los cambios realizados en este formulario.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, cancelar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(t){t?p(function(){null!=e.$parent&&e.$parent.navToSection("list","list")}):swal("Cancelación","La operación ha sido cancelada","error")})},e.changeProgram=function(t,n){e.participant.defaultSpeciality=t.speciality,e.loadAgents(t.speciality.value)},p(function(){O()},10);var O=function(){if(e.$parent.currentId>0){var t={id:e.$parent.currentId};u({method:"GET",url:"api/certificate-grade",params:t})["catch"](function(e,t){if(403==t){var n=null!==e.message&&void 0!==e.message?e.message:"app.asesores.list";s.swal("No Autorizado","No estas autorizado para ver esta información.","error"),p(function(){l.go(n)},3e3)}else 404==t?(s.swal("Información no disponible","Encuesta no encontrada","error"),p(function(){})):s.swal("Error","Se ha presentado un error al intentar acceder a la información del cliente","error")}).then(function(t){p(function(){e.grade=t.data.result})})["finally"](function(){p(function(){e.loading=!1},400)})}};e.onRemoveContact=function(t){s.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(i){i?p(function(){var i=e.participant.contacts[t];if(e.participant.contacts.splice(t,1),0!=i.id){var a={};a.id=i.id,u({method:"POST",url:"api/certificate-grade-participant-contact/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){n.error(e),s.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){})}}):swal("Cancelación","La operación ha sido cancelada","error")})};var T=function(){var t={},i=JSON.stringify(e.customer);return t.data=i,u({method:"POST",url:"api/project/customer",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){p(function(){e.customers=t.data.data})})["catch"](function(e){n.error(e),s.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){})};T(),v.operation="participant",v.certificate_grade_id=e.$parent.currentId,e.dtInstanceCertificateParticipant={},e.dtOptionsCertificateParticipant=i.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:v,url:"api/certificate-grade-participant",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){b()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,n,i){o(angular.element(t).contents())(e)}),e.dtColumnsCertificateParticipant=[a.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,t,n,i){var a="",r=e.hasCertificate?"":"disabled",o='<a target="_self" class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Descargar certificado" data-id="'+e.id+'" '+r+'  >   <i class="fa fa-download"></i></a> ';'<a class="btn btn-info btn-xs viewRow lnk" href="#"  uib-tooltip="Ver participante" data-id="'+e.id+'" >   <i class="fa fa-eye"></i></a> ','<a class="btn btn-danger btn-xs delRow lnk" href="#"  uib-tooltip="Eliminar participante" data-id="'+e.id+'"'+r+' >   <i class="fa fa-trash-o"></i></a> ';return d.can("clientes_view"),d.can("clientes_edit")&&(a+=o),d.can("clientes_delete"),a}),a.newColumn("documentType.item").withTitle("Tipo de Identificación").withOption("width",200),a.newColumn("identificationNumber").withTitle("Identificación").withOption("width",200),a.newColumn("name").withTitle("Nombres").withOption("width",200),a.newColumn("lastName").withTitle("Apellidos").withOption("width",200),a.newColumn(null).withTitle("Empresa").withOption("width",200).renderWith(function(e,t,n,i){return e.customer.length>0?e.customer[0].item:e.customer.item}),a.newColumn("price.amount").withTitle("Precio").withOption("width",200),a.newColumn(null).withTitle("Anexos").withOption("width",200).renderWith(function(e,t,n,i){var a="label label-warning",r=0;null==e.attachment&&void 0==e.attachment||(r=e.attachment);var o='<span class="'+a+'">'+r+" Anexos </span>";return o}),a.newColumn(null).withTitle("Cumple requisitos").withOption("width",200).renderWith(function(e,t,n,i){var a="label label-danger",r="Inactivo";null==e.isApproved&&void 0==e.isApproved||(e.isApproved?(a="label label-success",r="Si cumple"):(a="label label-danger",r="No Cumple"));var o='<span class="'+a+'">'+r+"</span>";return o})],e.onViewParticipant=function(t){e.currentId=t,e.participant.id=t,e.isView=!0,e.onLoadRecord()},e.onEditParticipant=function(t){e.workplace.id=t,e.isview=!1,e.onLoadRecord()},e.cancelEdition=function(t){null!=e.$parent&&e.$parent.navToSection("list","list",0)},e.onGenerate=function(){var t={};t.id=e.$parent.currentId,u({method:"POST",url:"api/certificate-grade/generate",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(e){swal("Generacion Certificados","Certificados generados satisfactoriamente","info")})["catch"](function(e){n.error(e),s.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){e.reloadData()})},e.onClear=function(){p(function(){e.participant={id:e.isCreate?0:e.currentId,certificateGradeId:e.$parent.currentId,customer:null,documentType:null,identificationNumber:"",name:"",lastName:"",workCenter:null,price:null,channel:null,countryOrigin:null,countryResidence:null,isApproved:!1,contacts:[]}}),e.isView=!1};var b=function(){$("#dtCertificateParticipants a.editRow").on("click",function(){var e=$(this).data("id"),t=$(this).data("url");""==t?s.swal("Error en la descarga","No existe un anexo para descargar","error"):jQuery("#downloadDocument")[0].src="api/certificate-grade-participant-certificate/download?id="+e}),$("#dtCertificateParticipants a.viewRow").on("click",function(){var t=$(this).data("id");e.participant.id=t,e.onViewParticipant(t)}),$("#dtCertificateParticipants a.delRow").on("click",function(){var t=$(this).data("id");C.info("intenta eliminar el registro: "+t),s.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(i){if(i){var a={};a.id=t,u({method:"POST",url:"api/certificate-grade-participant/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){n.error(e),s.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){e.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};e.reloadData=function(){e.dtInstanceCertificateParticipant.reloadData()},e.onAddCustomer=function(){var t=g.open({templateUrl:"app_modal_certificate_grade_participant_customer.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideCustomerCtrl",scope:e,resolve:{participant:function(){return e.participant}}});t.result.then(function(){T()})}}]);
"use strict";app.controller("certificateReportTabsCtrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout","$state","$filter","flowFactory","$http",function(t,e,r,i,c,a,o,s,p,n){o.is("app.certificate.report.view")?t.certificate_report_title_tab="view":o.is("app.certificate.report.create")?t.certificate_report_title_tab="create":t.certificate_report_title_tab="edit",t.isAgent="agent"==c.currentUser().wg_type,t.isAdmin="system"==c.currentUser().wg_type,t.isCustomer="customerAdmin"==c.currentUser().wg_type||"customerUser"==c.currentUser().wg_type,t.tabsloaded=["certificate"],t.tabname="certificate",t.titletab=t.certificate_report_title_tab,t.switchTab=function(e,r){a(function(){t.tabname=e,t.titletab=r,t.tabsloaded.push(e)})},t.switchSubTab=function(e){a(function(){t.subtab=e})}}]);
"use strict";app.controller("certificateReportCtrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout",function(t,e,o,c,i,r){var n=o;n.info("loading..certificateReportCtrl!!! "),t.certificate_section="list",t.currentId=0,t.formMode="edit",t.navToSection=function(e,o,c){r(function(){t.certificate_section=e,t.formMode=o,t.$parent.switchSubTab(o),t.currentId=c})}}]);
"use strict";app.controller("certificateReportExpirationCtrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout",function(t,o,i,e,r,n){var c=i;c.info("loading..certificateReportExpirationCtrl!!! "),t.expiration_section="list",t.currentId=0,t.formMode="edit",t.navToSection=function(o,i,e){n(function(){t.expiration_section=o,t.formMode=i,t.$parent.switchSubTab(i),t.currentId=e})}}]);
"use strict";app.controller("certificateReportListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","SweetAlert","$http","$aside","ListService",function(e,t,n,i,o,a,r,l,c,u,d,s,f,p){function m(){var t=[{name:"criteria_operators",value:null},{name:"criteria_conditions",value:null},{name:"certificate_search_custom_filter_field",value:null}];p.getDataList(t).then(function(t){e.criteria=t.data.data.criteriaOperatorList,e.conditions=t.data.data.criteriaConditionList,e.audit.fields=t.data.data.certificateSearchCustomFilterField},function(t){e.status="Unable to load customer data: "+t.message})}var w=n;w.info("entrando en... certificateAdminProgramCtrl"),e.isAgent="agent"==u.currentUser().wg_type,e.isAdmin="system"==u.currentUser().wg_type,e.isCustomer="customerAdmin"==u.currentUser().wg_type||"customerUser"==u.currentUser().wg_type,e.currentCustomerId=u.currentUser().company,e.isAgent?c.go("app.clientes.list"):e.isCustomer,e.audit={fields:[],filters:[]},m(),e.dtOptionsCertificate=i.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return angular.isDefined(e.audit)&&angular.isDefined(e.audit.filters)&&(t.filter={filters:e.audit.filters.filter(function(e){return null!=e&&null!=e.field&&null!=e.criteria}).map(function(e,t,n){return{field:e.field.name,operator:e.criteria.value,value:e.value,condition:{value:"and"}}})}),JSON.stringify(t)},url:"api/certificate-grade-participant/search-v2",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){h()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,n,i){r(angular.element(t).contents())(e)}),e.dtColumnsCertificate=[o.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,t,n,i){var o="",a="",r='<a target="_self" class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Descargar certificado" data-origin="'+e.origin+'" data-id="'+e.id+'" '+a+'  >   <i class="fa fa-download"></i></a> ',l=('<a class="btn btn-info btn-xs viewRow lnk" href="#"  uib-tooltip="Ver participante" data-id="'+e.id+'" >   <i class="fa fa-eye"></i></a> ','<a class="btn btn-danger btn-xs delRow lnk" href="#"  uib-tooltip="Eliminar certificado externo" data-id="'+e.id+'"'+a+' >   <i class="fa fa-trash-o"></i></a> ');return u.can("clientes_view"),u.can("clientes_edit")&&(o+=r),"Externo"==e.origin&&(o+=l),o}),o.newColumn("documentType").withTitle("Tipo de Identificación").withOption("width",200),o.newColumn("identificationNumber").withTitle("Identificación").withOption("width",200),o.newColumn("name").withTitle("Nombres").withOption("width",200),o.newColumn("lastName").withTitle("Apellidos").withOption("width",200),o.newColumn("customer").withTitle("Empresa").withOption("width",200),o.newColumn("grade").withTitle("Curso").withOption("width",200),o.newColumn(null).withTitle("Fecha").withOption("width",200).renderWith(function(e,t,n,i){return null!=e.certificateCreatedAt?moment(e.certificateCreatedAt).format("DD/MM/YYYY"):""}),o.newColumn(null).withTitle("Fecha Vencimiento").withOption("width",200).renderWith(function(e,t,n,i){return null!=e.certificateExpirationAt?moment(e.certificateExpirationAt).format("DD/MM/YYYY"):""}),o.newColumn("origin").withTitle("Origen").withOption("width",200)];var h=function(){angular.element("#dtCertificate a.editRow").on("click",function(){var e=angular.element(this).data("id"),t=(angular.element(this).data("url"),angular.element(this).data("origin"));"Externo"==t?jQuery("#downloadDocument")[0].src="api/certificate-external/download?id="+e:jQuery("#downloadDocument")[0].src="api/certificate-grade-participant-certificate/download?id="+e}),angular.element("#dtCertificate a.delRow").on("click",function(){var t=angular.element(this).data("id");w.info("intenta eliminar el registro: "+t),d.swal({title:"Está seguro?",text:"Eliminara el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(i){if(i){var o={};o.id=t,s({method:"POST",url:"api/certificate-external/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(o)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){n.error(e),d.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){e.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};e.dtInstanceCertificateCallback=function(t){e.dtInstanceCertificate=t},e.reloadData=function(){w.info("reloading..."),e.dtInstanceCertificate.reloadData()},e.onCreateProgram=function(){null!=e.$parent&&e.$parent.navToSection("form","edit",0)},e.onEditProgram=function(t){null!=e.$parent&&e.$parent.navToSection("form","edit",t)},e.onViewProgram=function(t){null!=e.$parent&&e.$parent.navToSection("form","view",t)},e.addFilter=function(){null==e.audit.filters&&(e.audit.filters=[]),e.audit.filters.push({id:0,field:null,criteria:null,condition:null,value:""})},e.onFilter=function(){e.reloadData()},e.removeFilter=function(t){e.audit.filters.splice(t,1),0==e.audit.filters.length&&e.reloadData()},e.onCleanFilter=function(){e.audit.filters=[],e.reloadData()},e.onAddExternalCertificate=function(){var t=f.open({templateUrl:"app_modal_certificate_external.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideExternalCertificateCtrl",scope:e});t.result.then(function(){e.reloadData()})}}]),app.controller("ModalInstanceSideExternalCertificateCtrl",["$rootScope","$stateParams","$scope","$uibModalInstance","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile",function(e,t,n,i,o,a,r,l,c,u,d,s,f,p){var m=0;n.documentTypes=e.parameters("tipodoc");var w=function(){n.participant={id:0,customerId:n.currentCustomerId,documentType:null,identificationNumber:"",name:"",lastName:"",company:"",grade:"",expeditionDate:null,expirationDate:null}};w();var h=n.uploader=new d({url:"api/certificate-external/upload",formData:[]});h.filters.push({name:"customFilter",fn:function(e,t){return this.queue.length<10}}),h.onWhenAddingFileFailed=function(e,t,n){console.info("onWhenAddingFileFailed",e,t,n)},h.onAfterAddingFile=function(e){console.info("onAfterAddingFile",e)},h.onAfterAddingAll=function(e){console.info("onAfterAddingAll",e)},h.onBeforeUploadItem=function(e){console.info("onBeforeUploadItem",e);var t={id:m};e.formData.push(t)},h.onProgressItem=function(e,t){console.info("onProgressItem",e,t)},h.onProgressAll=function(e){console.info("onProgressAll",e)},h.onSuccessItem=function(e,t,n,i){console.info("onSuccessItem",e,t,n,i)},h.onErrorItem=function(e,t,n,i){console.info("onErrorItem",e,t,n,i)},h.onCancelItem=function(e,t,n,i){console.info("onCancelItem",e,t,n,i)},h.onCompleteItem=function(e,t,n,i){console.info("onCompleteItem",e,t,n,i)},h.onCompleteAll=function(){console.info("onCompleteAll"),n.onCloseModal()},n.onCloseModal=function(){i.close(1)},n.onCancelCertificate=function(){i.dismiss("cancel")},n.form={submit:function(e){var t=null;if(e.$invalid){var i=null,t=null;for(i in e)"$"!=i[0]&&(null!==t||e[i].$valid||(t=e[i].$name),e[i].$pristine&&(e[i].$dirty=!0));return angular.element(".ng-invalid[name="+t+"]").focus(),void a(function(){c.pop("error","Error","Por favor verifique los datos requeridos del formulario y vuelva a intentarlo")},500)}return 0==n.uploader.queue.length?void r.swal("El formulario contiene errores!","Por favor seleccione un certificado e Intentalo de nuevo.","error"):void n.onSave()},reset:function(e){e.$setPristine(!0)}},n.onSave=function(){var e={};n.participant.expeditionDate=n.participant.expeditionDate.toISOString(),n.participant.expirationDate=n.participant.expirationDate.toISOString();var t=JSON.stringify(n.participant);return e.data=Base64.encode(t),l({method:"POST",url:"api/certificate-external/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){a(function(){n.attachment=e.data.result,m=e.data.result.id,h.uploadAll(),c.pop("success","Operación Exitosa","Registro guardado"),n.onCloseModal()})})["catch"](function(e){o.error(e),c.pop("error","Error","Por favor ingrese los campos requeridos.")})["finally"](function(){})}}]);
"use strict";app.controller("certificateReportExpirationListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","SweetAlert","$http","$timeout","ListService",function(t,e,i,n,a,o,r,l,c,d,s,u,p,w){function f(){var e=[{name:"month",value:null},{name:"certificate_grade_participant_year",value:null}];w.getDataList(e).then(function(e){t.months=e.data.data.month,t.years=e.data.data.certificateGradeParticipantYear},function(e){t.status="Unable to load customer data: "+e.message})}var h=i;h.info("certificateReportExpirationListCtrl"),t.isAgent=d.isAgent(),t.isAdmin=d.isAdmin(),t.isCustomer=d.isCustomer(),t.isAgent?c.go("app.clientes.list"):t.isCustomer,t.filter={selectedMonth:null,selectedYear:null},f(),t.dtOptionsCertificateExpiration=n.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(e){return t.isCustomer&&(e.customerId=d.currentUser().company),e.year=t.filter.selectedYear?t.filter.selectedYear.value:null,e.month=t.filter.selectedMonth?t.filter.selectedMonth.value:null,JSON.stringify(e)},url:"api/certificate-grade-participant/expiration-v2",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){m()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,i,n){r(angular.element(e).contents())(t)}),t.dtColumnsCertificateExpiration=[a.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,e,i,n){var a="",o="",r='<a target="_self" class="btn btn-primary btn-xs downloadRow lnk" href="#" uib-tooltip="Descargar certificado" data-id="'+t.id+'" '+o+'  >   <i class="fa fa-download"></i></a> ';return a+=r}),a.newColumn("documentType").withTitle("Tipo de Identificación").withOption("width",200),a.newColumn("identificationNumber").withTitle("Identificación").withOption("width",200),a.newColumn("name").withTitle("Nombres").withOption("width",200),a.newColumn("lastName").withTitle("Apellidos").withOption("width",200),a.newColumn("customer").withTitle("Empresa").withOption("width",200),a.newColumn("grade").withTitle("Curso").withOption("width",200),a.newColumn("certificateCreatedAt").withTitle("Fecha").withOption("width",200),a.newColumn("certificateExpirationAt").withTitle("Fecha Vencimiento").withOption("width",200)];var m=function(){angular.element("#dtCertificateExpiration a.downloadRow").on("click",function(){var t=angular.element(this).data("id");angular.element("#downloadDocument")[0].src="api/certificate-grade-participant-certificate/download?id="+t})};t.dtInstanceCertificateExpirationCallback=function(e){t.dtInstanceCertificateExpiration=e},t.reloadData=function(){t.dtInstanceCertificateExpiration.reloadData()},t.onSelectYear=function(){t.reloadData()},t.onClearYear=function(){t.filter.selectedYear=null,t.reloadData()},t.onSelectMonth=function(){t.reloadData()},t.onClearMonth=function(){t.filter.selectedMonth=null,t.reloadData()}}]);
"use strict";app.controller("certificateLogBookTabsCtrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout","$state","$filter","flowFactory","$http",function(t,e,r,i,c,a,o,s,n,p){o.is("app.certificate.report.view")?t.certificate_report_title_tab="view":o.is("app.certificate.report.create")?t.certificate_report_title_tab="create":t.certificate_report_title_tab="edit",t.isAgent="agent"==c.currentUser().wg_type,t.isAdmin="system"==c.currentUser().wg_type,t.isCustomer="customerAdmin"==c.currentUser().wg_type||"customerUser"==c.currentUser().wg_type,t.tabsloaded=["certificate"],t.tabname="certificate",t.titletab=t.certificate_report_title_tab,t.switchTab=function(e,r){a(function(){t.tabname=e,t.titletab=r,t.tabsloaded.push(e)})},t.switchSubTab=function(e){a(function(){t.subtab=e})}}]);
"use strict";app.controller("certificateLogBookCtrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout",function(t,o,e,c,i,r){var n=e;n.info("loading..certificateReportCtrl!!! "),t.certificate_section="list",t.currentId=0,t.formMode="edit",t.navToSection=function(o,e,c){r(function(){t.certificate_section=o,t.formMode=e,t.$parent.switchSubTab(e),t.currentId=c})}}]);
"use strict";app.controller("certificateLogBookCourseCtrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout",function(o,t,e,i,r,n){var c=e;c.info("loading..certificateReportExpirationCtrl!!! "),o.expiration_section="list",o.currentId=0,o.formMode="edit",o.navToSection=function(t,e,i){n(function(){o.expiration_section=t,o.formMode=e,o.$parent.switchSubTab(e),o.currentId=i})}}]);
"use strict";app.controller("certificateLogBookListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","SweetAlert","$http","FileUploader","$filter","$timeout",function(e,t,n,o,i,a,r,l,c,d,s,u,f,m,p){var w=n,g=0;w.info("entrando en... certificateAdminProgramCtrl"),e.isAgent="agent"==d.currentUser().wg_type,e.isAdmin="system"==d.currentUser().wg_type,e.isCustomer="customerAdmin"==d.currentUser().wg_type||"customerUser"==d.currentUser().wg_type,e.isAgent?c.go("app.clientes.list"):e.isCustomer&&(w.info("Step 5"),c.go("app.clientes.view",{customerId:d.currentUser().company})),e.attachment={id:0,created_at:m("date")(new Date,"dd/MM/yyyy HH:mm"),certificateGradeParticipantId:0,agent:{id:0,name:"- Seleccionar - "},eventDate:new Date,company:"",description:"",location:"",hourWorked:0,maxHeightWorked:0,category:"experience",courseTitle:"",certificateNumber:"",trainingOrganization:"",status:null,version:1};var h=e.uploader=new f({url:"api/certificate-logbook-document/upload",formData:[]});h.filters.push({name:"customFilter",fn:function(e,t){return this.queue.length<10}}),h.onWhenAddingFileFailed=function(e,t,n){console.info("onWhenAddingFileFailed",e,t,n)},h.onAfterAddingFile=function(e){console.info("onAfterAddingFile",e)},h.onAfterAddingAll=function(e){console.info("onAfterAddingAll",e)},h.onBeforeUploadItem=function(e){console.info("onBeforeUploadItem",e);var t={id:g};e.formData.push(t)},h.onProgressItem=function(e,t){console.info("onProgressItem",e,t)},h.onProgressAll=function(e){console.info("onProgressAll",e)},h.onSuccessItem=function(e,t,n,o){console.info("onSuccessItem",e,t,n,o)},h.onErrorItem=function(e,t,n,o){console.info("onErrorItem",e,t,n,o)},h.onCancelItem=function(e,t,n,o){console.info("onCancelItem",e,t,n,o)},h.onCompleteItem=function(e,t,n,o){console.info("onCompleteItem",e,t,n,o)},h.onCompleteAll=function(){e.reloadData(),e.onClear()},e.onCloseModal=function(){$uibModalInstance.close(1)},e.onCancelDocument=function(){$uibModalInstance.dismiss("cancel")},e.master=e.attachment,e.form={submit:function(t){var n=null;if(t.$invalid){var o=null,n=null;for(o in t)"$"!=o[0]&&(null!==n||t[o].$valid||(n=t[o].$name),t[o].$pristine&&(t[o].$dirty=!0));return w.info(e.attachment),angular.element(".ng-invalid[name="+n+"]").focus(),void s.swal("El formulario contiene errores!","Por favor corrige los errores del formulario e Intentalo de nuevo.","error")}s.swal("Validación exitosa","Guardando información de la encuesta...","success"),w.info(e.attachment),C()},reset:function(t){e.attachment=angular.copy(e.master),t.$setPristine(!0)}};var C=function(){var t={},o=JSON.stringify(e.attachment);return t.data=Base64.encode(o),u({method:"POST",url:"api/certificate-logbook-document/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(t){e.attachment=t.data.result,g=t.data.result.id,h.uploadAll(),s.swal("Validación exitosa","Procediendo con el guardado...","success")})["catch"](function(e){n.error(e),s.swal("Error de guardado","Error guardando el registro. Por favor verifique los datos ingresados!","error")})["finally"](function(){e.onClear()})};e.onClear=function(){p(function(){e.attachment={id:0,created_at:m("date")(new Date,"dd/MM/yyyy HH:mm"),certificateGradeParticipantId:0,agent:{id:0,name:"- Seleccionar - "},eventDate:m("date")(new Date,"dd/MM/yyyy HH:mm"),company:"",description:"",location:"",hourWorked:0,maxHeightWorked:0,category:"experience",courseTitle:"",certificateNumber:"",trainingOrganization:"",status:null,version:1}}),p(function(){e.noImage=!0,$document.scrollTop(40,2e3)}),e.isView=!1};var v={};v.operation="document",v.certificate_grade_participant_id=0,e.dtInstanceCertificate={},e.dtOptionsCertificate=o.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:v,url:"api/certificate-logbook-document",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){y()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,n,o){r(angular.element(t).contents())(e)}),e.dtColumnsCertificate=[i.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,t,n,o){var i=null!=e.document?e.document.path:"",a="",r='<a target="_self" class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Descargar anexo" data-id="'+e.id+'" data-url="'+i+'" >   <i class="fa fa-download"></i></a> ';'<a class="btn btn-info btn-xs viewRow lnk" target="_blank" href="'+i+'" uib-tooltip="Abrir anexo" data-id="'+e.id+'" >   <i class="fa fa-folder-open-o"></i></a> ','<a class="btn btn-danger btn-xs delRow lnk" href="#" uib-tooltip="Anular anexo" data-id="'+e.id+'" >   <i class="fa fa-ban"></i></a> ';return d.can("seguimiento_view"),d.can("seguimiento_edit")&&(a+=r),d.can("seguimiento_delete"),a}),i.newColumn("eventDate").withTitle("Fecha").withOption("width",200),i.newColumn("company").withTitle("Empresa").withOption("width",200),i.newColumn("location").withTitle("Lugar").withOption("width",200),i.newColumn("hourWorked").withTitle("Horas Trabajadas").withOption("width",200),i.newColumn("maxHeightWorked").withTitle("Máxima Altura Trabajada").withOption("width",200)];var y=function(){$("#dtCertificate a.editRow").on("click",function(){var e=$(this).data("id"),t=$(this).data("url");""==t?s.swal("Error en la descarga","No existe un anexo para descargar","error"):jQuery("#downloadDocument")[0].src="api/certificate-logbook-document/download?id="+e}),$("#dtCertificate a.delRow").on("click",function(){var e=$(this).data("id");w.info("intenta eliminar el registro: "+e),s.swal({title:"Está seguro?",text:"Anularás el anexo seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, anular!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(e){e||swal("Cancelación","La operación ha sido cancelada","error")})})};e.onCreateProgram=function(){null!=e.$parent&&e.$parent.navToSection("form","edit",0)},e.onEditProgram=function(t){null!=e.$parent&&e.$parent.navToSection("form","edit",t)},e.onViewProgram=function(t){null!=e.$parent&&e.$parent.navToSection("form","view",t)},e.reloadData=function(){w.info("reloading..."),e.dtInstanceCertificate.reloadData()},e.addFilter=function(){null==e.audit.filters&&(e.audit.filters=[]),e.audit.filters.push({id:0,field:null,criteria:null,condition:null,value:""})},e.onFilter=function(){e.request.data=Base64.encode(JSON.stringify(e.audit)),e.reloadData()},e.removeFilter=function(t){e.audit.filters.splice(t,1)}}]);
"use strict";app.controller("certificateLogBookCourseListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","SweetAlert","$http","$timeout",function(t,e,i,n,a,r,o,c,l,u,d,s,p){var m=i;m.info("entrando en... certificateAdminProgramCtrl"),t.isAgent="agent"==u.currentUser().wg_type,t.isAdmin="system"==u.currentUser().wg_type,t.isCustomer="customerAdmin"==u.currentUser().wg_type||"customerUser"==u.currentUser().wg_type,t.isAgent?l.go("app.clientes.list"):t.isCustomer&&(m.info("Step 4"),l.go("app.clientes.view",{customerId:u.currentUser().company})),t.currentMonth=0,t.currentYear=0,t.filter={selectedMonth:null,selectedYear:null},t.request={},t.months=[{id:"1",item:"Enero",value:"1"},{id:"2",item:"Febrero",value:"2"},{id:"3",item:"Marzo",value:"3"},{id:"4",item:"Abril",value:"4"},{id:"5",item:"Mayo",value:"5"},{id:"6",item:"Junio",value:"6"},{id:"7",item:"Julio",value:"7"},{id:"8",item:"Agosto",value:"8"},{id:"9",item:"Septiembre",value:"9"},{id:"10",item:"Octubre",value:"10"},{id:"11",item:"Noviembre",value:"11"},{id:"12",item:"Diciembre",value:"12"}],t.years=[{id:2014,item:"2014",value:"2014"},{id:2015,item:"2015",value:"2015"},{id:2016,item:"2016",value:"2016"}],t.request.operation="expiration",t.request.data="",t.dtInstanceCertificateExpiration={},t.dtOptionsCertificateExpiration=n.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:t.request,url:"api/certificate-grade-participant/expiration",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){w()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(e,i,n){o(angular.element(e).contents())(t)}),t.dtColumnsCertificateExpiration=[a.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(t,e,i,n){var a="",r="",o='<a target="_self" class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Descargar certificado" data-id="'+t.id+'" '+r+'  >   <i class="fa fa-download"></i></a> ';'<a class="btn btn-info btn-xs viewRow lnk" href="#"  uib-tooltip="Ver participante" data-id="'+t.id+'" >   <i class="fa fa-eye"></i></a> ','<a class="btn btn-danger btn-xs delRow lnk" href="#"  uib-tooltip="Eliminar participante" data-id="'+t.id+'"'+r+' >   <i class="fa fa-trash-o"></i></a> ';return u.can("clientes_view"),u.can("clientes_edit")&&(a+=o),u.can("clientes_delete"),a}),a.newColumn("documentType").withTitle("Tipo de Identificación").withOption("width",200),a.newColumn("identificationNumber").withTitle("Identificación").withOption("width",200),a.newColumn("name").withTitle("Nombres").withOption("width",200),a.newColumn("lastName").withTitle("Apellidos").withOption("width",200),a.newColumn("customer").withTitle("Empresa").withOption("width",200),a.newColumn("grade").withTitle("Curso").withOption("width",200),a.newColumn("certificateCreatedAt").withTitle("Fecha").withOption("width",200),a.newColumn("certificateExpirationAt").withTitle("Fecha Vencimiento").withOption("width",200)];var w=function(){$("#dtCertificateExpiration a.editRow").on("click",function(){var t=$(this).data("id"),e=$(this).data("url");""==e?d.swal("Error en la descarga","No existe un anexo para descargar","error"):jQuery("#downloadDocument")[0].src="api/certificate-grade-participant-certificate/download?id="+t}),$("#dtCertificateExpiration a.viewRow").on("click",function(){var e=$(this).data("id");t.onViewProgram(e)}),$("#dtCertificateExpiration a.delRow").on("click",function(){var e=$(this).data("id");m.info("intenta eliminar el registro: "+e),d.swal({title:"Está seguro?",text:"Eliminará el registro seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, continuar!",closeOnConfirm:!0,closeOnCancel:!0},function(n){if(n){var a={};a.id=e,s({method:"POST",url:"api/certificate-program/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(a)}).then(function(t){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(t){i.error(t),d.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){t.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};t.changeMonth=function(e,i){p(function(){t.currentMonth=e.id,f()})},t.clearMonth=function(){p(function(){t.currentMonth=0,t.filter.selectedMonth=null,f()})},t.changeYear=function(e,i){p(function(){t.currentYear=e.id,f()})},t.clearYear=function(){p(function(){t.currentYear=0,t.filter.selectedYear=null,f()})};var f=function(){t.request.year=t.currentYear,t.request.month=t.currentMonth,t.reloadData()};t.onCreateProgram=function(){null!=t.$parent&&t.$parent.navToSection("form","edit",0)},t.onEditProgram=function(e){null!=t.$parent&&t.$parent.navToSection("form","edit",e)},t.onViewProgram=function(e){null!=t.$parent&&t.$parent.navToSection("form","view",e)},t.reloadData=function(){m.info("reloading..."),t.dtInstanceCertificateExpiration.reloadData()}}]);
"use strict";app.controller("resourceLibraryTabsCtrl",["$scope","$stateParams","$log","$compile","$rootScope","$timeout","$state","$filter","flowFactory","$http",function(t,e,r,i,a,c,s,o,n,p){s.is("app.certificate.report.view")?t.certificate_report_title_tab="view":s.is("app.certificate.report.create")?t.certificate_report_title_tab="create":t.certificate_report_title_tab="edit",t.isAgent="agent"==a.currentUser().wg_type,t.isAdmin="system"==a.currentUser().wg_type,t.isCustomer="customerAdmin"==a.currentUser().wg_type||"customerUser"==a.currentUser().wg_type,t.tabsloaded=["certificate"],t.tabname="certificate",t.titletab=t.certificate_report_title_tab,t.switchTab=function(e,r){c(function(){t.tabname=e,t.titletab=r,t.tabsloaded.push(e)})},t.switchSubTab=function(e){c(function(){t.subtab=e})}}]);
"use strict";app.controller("resourceLibraryListCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","SweetAlert","$http","$aside","moment","ListService",function(e,t,n,o,r,i,a,l,s,c,u,d,f,p,m){function w(){var t=[{name:"criteria_operators",value:null},{name:"criteria_conditions",value:null},{name:"resource_library_custom_filter_field",value:null}];m.getDataList(t).then(function(t){e.criteria=t.data.data.criteriaOperatorList,e.conditions=t.data.data.criteriaConditionList,e.audit.fields=t.data.data.resourceLibraryCustomFilterField},function(t){e.status="Unable to load customer data: "+t.message})}var h=n;h.info("entrando en... certificateAdminProgramCtrl"),e.isAgent="agent"==c.currentUser().wg_type,e.isAdmin="system"==c.currentUser().wg_type,e.isCustomer="customerAdmin"==c.currentUser().wg_type||"customerUser"==c.currentUser().wg_type,e.currentCustomerId=c.currentUser().company,e.audit={fields:[],filters:[]},w(),e.dtOptionsResourceLibrary=o.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return angular.isDefined(e.audit)&&angular.isDefined(e.audit.filters)&&(t.filter={filters:e.audit.filters.filter(function(e){return null!=e&&null!=e.field&&null!=e.criteria}).map(function(e,t,n){return{field:e.field.name,operator:e.criteria.value,value:e.value,condition:{value:"and"}}})}),JSON.stringify(t)},url:"api/resource-library",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[3,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){g()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,n,o){a(angular.element(t).contents())(e)}),e.dtColumnsResourceLibrary=[r.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,t,n,o){var r=e.documentUrl?e.documentUrl:"",i="api/resource-library/download?id="+e.id,a="",l="",s='<a target="_self" class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+e.id+'" '+l+'  >   <i class="fa fa-edit"></i></a> ',c='<a target="_self" class="btn btn-info btn-xs downloadDocumentRow lnk" href="'+i+'" uib-tooltip="Descargar recurso" data-id="'+e.id+'" >   <i class="fa fa-download"></i></a> ',u='<a class="btn btn-danger btn-xs delRow lnk" href="#"  uib-tooltip="Eliminar" data-id="'+e.id+'"'+l+' >   <i class="fa fa-trash-o"></i></a> ';return a+=s,""!=r&&(a+=c),a+=u}),r.newColumn("createdAt").withTitle("Fecha Creación").withOption("type","date").withOption("width",200).renderWith(function(e,t,n,o){return p(e.date).format("DD/MM/YYYY")}),r.newColumn("type").withTitle("Tipo").withOption("width",200).withOption("defaultContent",""),r.newColumn("dateOf").withTitle("Fecha Recurso").withOption("type","date").withOption("width",200).renderWith(function(e,t,n,o){return p(e).format("DD/MM/YYYY")}),r.newColumn("name").withTitle("Nombre").withOption("width",200).withOption("defaultContent",""),r.newColumn("author").withTitle("Autor/Emisor").withOption("width",200).withOption("defaultContent",""),r.newColumn("subject").withTitle("Asunto").withOption("width",200).withOption("defaultContent",""),r.newColumn("description").withTitle("Descripción").withOption("width",200).withOption("defaultContent",""),r.newColumn(null).withTitle("Estado").withOption("width",200).renderWith(function(e,t,n,o){var r="label label-success",i=e.status;e.isActive||(r="label label-danger");var a='<span class="'+r+'">'+i+"</span>";return a})];var g=function(){$("#dtResourceLibrary a.editRow").on("click",function(){var t=$(this).data("id");e.onAddResourceLibrary(t)}),$("#dtResourceLibrary a.downloadRow").on("click",function(){var e=$(this).data("id");jQuery("#downloadDocument")[0].src="api/resource-library/download?id="+e}),$("#dtResourceLibrary a.delRow").on("click",function(){var t=$(this).data("id");h.info("intenta eliminar el registro: "+t),u.swal({title:"Está seguro?",text:"Eliminara el recurso de la biblioteca seleccionado.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(o){if(o){var r={};r.id=t,d({method:"POST",url:"api/resource-library/delete",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(r)}).then(function(e){swal("Eliminado","Registro eliminado satisfactoriamente","info")})["catch"](function(e){n.error(e),u.swal("Error en la eliminación","Se ha presentado un error durante la eliminación del registro. Por favor inténtelo de nuevo, si el error persiste, comuníquese con el administrador del sistema","error")})["finally"](function(){e.reloadData()})}else swal("Cancelación","La operación ha sido cancelada","error")})})};e.dtInstanceResourceLibraryCallback=function(t){e.dtInstanceResourceLibrary=t},e.reloadData=function(){e.dtInstanceResourceLibrary.reloadData()},e.onCreate=function(){e.onAddResourceLibrary(0)},e.addFilter=function(){null==e.audit.filters&&(e.audit.filters=[]),e.audit.filters.push({id:0,field:null,criteria:null,condition:null,value:""})},e.onFilter=function(){e.reloadData()},e.removeFilter=function(t){e.audit.filters.splice(t,1),0==e.audit.filters.length&&e.reloadData()},e.onCleanFilter=function(){e.audit.filters=[],e.reloadData()},e.onAddResourceLibrary=function(t){var n={id:t},o=f.open({templateUrl:c.app.views.urlRoot+"modules/configuration/resource-library/resource_library_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideResourceLibraryCtrl",scope:e,resolve:{resource:function(){return n}}});o.result.then(function(){e.reloadData()},function(){e.reloadData()})}}]),app.controller("ModalInstanceSideResourceLibraryCtrl",["$rootScope","$stateParams","$scope","$uibModalInstance","resource","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile",function(e,t,n,o,r,i,a,l,s,c,u,d,f,p,m){n.flowConfig={target:"/api/resource-library/upload-cover",singleFile:!0},n.uploader=new Flow,n.resourceLibraryTypeList=e.parameters("resource_library_type"),n.noImage=!0;var w=0,h=function(){n.resource={id:r.id?r.id:0,type:null,dateOf:null,name:"",author:"",subject:"",description:"",isActive:!0,keywords:[]}};h();var g=function(){if(n.resource.id){var e={id:n.resource.id};s({method:"GET",url:"api/resource-library",params:e})["catch"](function(e,t){if(403==t){var n=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";l.swal("No Autorizado","No estas autorizado para ver esta información.","error"),a(function(){$state.go(n)},3e3)}else 404==t?(l.swal("Información no disponible","Anexo no encontrado","error"),a(function(){$state.go("app.clientes.list")})):l.swal("Error","Se ha presentado un error al intentar acceder a la información del anexo","error")}).then(function(e){a(function(){n.resource=e.data.result,n.noImage=""==n.resource.cover,v()})})["finally"](function(){a(function(){n.loading=!1},400)})}};g();var v=function(){null!=n.resource.dateOf&&(n.resource.dateOf=new Date(n.resource.dateOf.date))};n.removeImage=function(){n.noImage=!0};var y=n.uploaderResource=new d({url:"api/resource-library/upload",formData:[]});y.filters.push({name:"customFilter",fn:function(e,t){return this.queue.length<10}}),y.onWhenAddingFileFailed=function(e,t,n){console.info("onWhenAddingFileFailed",e,t,n)},y.onAfterAddingFile=function(e){console.info("onAfterAddingFile",e)},y.onAfterAddingAll=function(e){console.info("onAfterAddingAll",e)},y.onBeforeUploadItem=function(e){console.info("onBeforeUploadItem",e);var t={id:w};e.formData.push(t)},y.onProgressItem=function(e,t){console.info("onProgressItem",e,t)},y.onProgressAll=function(e){console.info("onProgressAll",e)},y.onSuccessItem=function(e,t,n,o){console.info("onSuccessItem",e,t,n,o)},y.onErrorItem=function(e,t,n,o){console.info("onErrorItem",e,t,n,o)},y.onCancelItem=function(e,t,n,o){console.info("onCancelItem",e,t,n,o)},y.onCompleteItem=function(e,t,n,o){console.info("onCompleteItem",e,t,n,o)},y.onCompleteAll=function(){console.info("onCompleteAll"),c.pop("success","Operación Exitosa","La información ha sido guardada satisfactoriamente"),n.onCloseModal()},n.onCloseModal=function(){o.close(1)},n.onCancel=function(){o.dismiss("cancel")},n.form={submit:function(e){var t=null;if(e.$invalid){var o=null,t=null;for(o in e)"$"!=o[0]&&(null!==t||e[o].$valid||(t=e[o].$name),e[o].$pristine&&(e[o].$dirty=!0));return angular.element(".ng-invalid[name="+t+"]").focus(),void a(function(){c.pop("error","Error","Por favor verifique los datos requeridos del formulario y vuelva a intentarlo")},500)}return 0==n.resource.id&&0==n.uploaderResource.queue.length?void l.swal("El formulario contiene errores!","Por favor seleccione un archivo e Intentalo de nuevo.","error"):void n.onSave()},reset:function(e){e.$setPristine(!0)}},n.onSave=function(){var e="";if(null!=n.resource.dateOf&&""!=n.resource.dateOf||(e+="Debe ingresar la fecha \n"),""!=e)return void l.swal({html:!1,title:"Error de validación",text:e,type:"error"});var t={},o=JSON.stringify(n.resource);return t.data=Base64.encode(o),s({method:"POST",url:"api/resource-library/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(t)}).then(function(e){a(function(){n.uploader.flow.opts.query.id=e.data.result.id,n.uploader.flow.resume(),y.queue.length>0?(w=e.data.result.id,y.uploadAll()):(c.pop("success","Operación Exitosa","La información ha sido guardada satisfactoriamente"),n.onCloseModal())})})["catch"](function(e){i.error(e),c.pop("error","Error","Por favor ingrese los campos requeridos.")})["finally"](function(){})},n.onAddKeyword=function(){a(function(){null==n.resource.keywords&&(n.resource.keywords=[]),n.resource.keywords.push({text:""})})},n.onRemoveKeyword=function(e){l.swal({title:"Está seguro?",text:"Desea confirmar la eliminación de este registro ?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(t){t?a(function(){n.resource.keywords.splice(e,1)}):swal("Cancelación","La operación ha sido cancelada","error")})}}]);
"use strict";app.controller("resourceLibrarySearchCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","SweetAlert","$http","$aside","ListService","moment",function(e,t,n,o,r,i,a,l,u,s,c,d,f,p,m){function w(){var t=[{name:"criteria_operators",value:null},{name:"criteria_conditions",value:null},{name:"resource_library_custom_filter_field",value:null}];p.getDataList(t).then(function(t){e.criteria=t.data.data.criteriaOperatorList,e.conditions=t.data.data.criteriaConditionList,e.audit.fields=t.data.data.resourceLibraryCustomFilterField},function(t){e.status="Unable to load customer data: "+t.message})}e.isAgent="agent"==s.currentUser().wg_type,e.isAdmin="system"==s.currentUser().wg_type,e.isCustomer="customerAdmin"==s.currentUser().wg_type||"customerUser"==s.currentUser().wg_type,e.currentCustomerId=s.currentUser().company,e.audit={fields:[],filters:[]},w(),e.dtOptionsResourceLibrarySearch=o.newOptions().withBootstrap().withOption("responsive",!0).withOption("ajax",{data:function(t){return angular.isDefined(e.audit)&&angular.isDefined(e.audit.filters)&&(t.filter={filters:e.audit.filters.filter(function(e){return null!=e&&null!=e.field&&null!=e.criteria}).map(function(e,t,n){return{field:e.field.name,operator:e.criteria.value,value:e.value,condition:{value:"and"}}})}),JSON.stringify(t)},url:"api/resource-library",contentType:"application/json",type:"POST",beforeSend:function(){},complete:function(){}}).withDataProp("data").withOption("order",[[0,"desc"]]).withOption("serverSide",!0).withOption("processing",!0).withOption("fnPreDrawCallback",function(){return!0}).withOption("fnDrawCallback",function(){h()}).withOption("language",{}).withPaginationType("full_numbers").withOption("createdRow",function(t,n,o){a(angular.element(t).contents())(e)}),e.dtColumnsResourceLibrarySearch=[r.newColumn(null).withTitle("Acciones").withOption("width",150).notSortable().renderWith(function(e,t,n,o){var r=e.documentUrl?e.documentUrl:"",i="api/resource-library/download?id="+e.id,a="",l="",u='<a target="_self" class="btn btn-primary btn-xs editRow lnk" href="#" uib-tooltip="Editar" data-id="'+e.id+'" '+l+'  >   <i class="fa fa-edit"></i></a> ',s='<a target="_self" class="btn btn-info btn-xs downloadDocumentRow lnk" href="'+i+'" uib-tooltip="Descargar recurso" data-id="'+e.id+'" >   <i class="fa fa-download"></i></a> ';return a+=u,""!=r&&(a+=s),a}),r.newColumn("createdAt").withTitle("Fecha Creación").withOption("type","date").withOption("width",200).renderWith(function(e,t,n,o){return m(e.date).format("DD/MM/YYYY")}),r.newColumn("type").withTitle("Tipo").withOption("width",200).withOption("defaultContent",""),r.newColumn("dateOf").withTitle("Fecha Recurso").withOption("type","date").withOption("width",200).renderWith(function(e,t,n,o){return m(e).format("DD/MM/YYYY")}),r.newColumn("name").withTitle("Nombre").withOption("width",200).withOption("defaultContent",""),r.newColumn("author").withTitle("Autor/Emisor").withOption("width",200).withOption("defaultContent",""),r.newColumn("subject").withTitle("Asunto").withOption("width",200).withOption("defaultContent",""),r.newColumn("description").withTitle("Descripción").withOption("width",200).withOption("defaultContent",""),r.newColumn(null).withTitle("Estado").withOption("width",200).renderWith(function(e,t,n,o){var r="label label-success",i=e.status;e.isActive||(r="label label-danger");var a='<span class="'+r+'">'+i+"</span>";return a})];var h=function(){$("#dtResourceLibrarySearch a.editRow").on("click",function(){var t=$(this).data("id");e.onAddResourceLibrary(t)}),$("#dtResourceLibrarySearch a.downloadRow").on("click",function(){var e=$(this).data("id");jQuery("#downloadDocument")[0].src="api/resource-library/download?id="+e})};e.dtInstanceResourceLibrarySearchCallback=function(t){e.dtInstanceResourceLibrarySearch=t},e.reloadData=function(){e.dtInstanceResourceLibrarySearch.reloadData()},e.onCreate=function(){e.onAddResourceLibrary(0)},e.addFilter=function(){null==e.audit.filters&&(e.audit.filters=[]),e.audit.filters.push({id:0,field:null,criteria:e.criteria.length>0?e.criteria[1]:null,condition:e.criteria.length>0?e.conditions[0]:null,value:""})},e.onFilter=function(){e.reloadData()},e.removeFilter=function(t){e.audit.filters.splice(t,1),0==e.audit.filters.length&&e.reloadData()},e.onCleanFilter=function(){e.audit.filters=[],e.reloadData()},e.onAddResourceLibrary=function(t){var n={id:t},o=f.open({templateUrl:s.app.views.urlRoot+"modules/resource-library/resource_library_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideResourceLibraryViewCtrl",scope:e,resolve:{resource:function(){return n}}});o.result.then(function(){e.reloadData()})}}]),app.controller("ModalInstanceSideResourceLibraryViewCtrl",["$rootScope","$stateParams","$scope","$uibModalInstance","resource","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile",function(e,t,n,o,r,i,a,l,u,s,c,d,f,p,m){n.flowConfig={target:"/api/resource-library/upload-cover",singleFile:!0},n.uploader=new Flow,n.resourceLibraryTypeList=e.parameters("resource_library_type"),n.isView=!0;var w=0,h=function(){n.resource={id:r.id?r.id:0,type:null,dateOf:null,name:"",author:"",subject:"",description:"",isActive:!0,keywords:[]}};h();var g=function(){if(n.resource.id){var e={id:n.resource.id};u({method:"GET",url:"api/resource-library",params:e})["catch"](function(e,t){if(403==t){var n=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";l.swal("No Autorizado","No estas autorizado para ver esta información.","error"),a(function(){$state.go(n)},3e3)}else 404==t?(l.swal("Información no disponible","Anexo no encontrado","error"),a(function(){$state.go("app.clientes.list")})):l.swal("Error","Se ha presentado un error al intentar acceder a la información del anexo","error")}).then(function(e){a(function(){n.resource=e.data.result,null!=n.resource.dateOf&&(n.resource.dateOf=new Date(n.resource.dateOf.date))})})["finally"](function(){a(function(){n.loading=!1},400)})}};g(),""==n.resource.cover&&(n.noImage=!0),n.removeImage=function(){n.noImage=!0};var y=n.uploaderResource=new d({url:"api/resource-library/upload",formData:[]});y.filters.push({name:"customFilter",fn:function(e,t){return this.queue.length<10}}),y.onWhenAddingFileFailed=function(e,t,n){console.info("onWhenAddingFileFailed",e,t,n)},y.onAfterAddingFile=function(e){console.info("onAfterAddingFile",e)},y.onAfterAddingAll=function(e){console.info("onAfterAddingAll",e)},y.onBeforeUploadItem=function(e){console.info("onBeforeUploadItem",e);var t={id:w};e.formData.push(t)},y.onProgressItem=function(e,t){console.info("onProgressItem",e,t)},y.onProgressAll=function(e){console.info("onProgressAll",e)},y.onSuccessItem=function(e,t,n,o){console.info("onSuccessItem",e,t,n,o)},y.onErrorItem=function(e,t,n,o){console.info("onErrorItem",e,t,n,o)},y.onCancelItem=function(e,t,n,o){console.info("onCancelItem",e,t,n,o)},y.onCompleteItem=function(e,t,n,o){console.info("onCompleteItem",e,t,n,o)},y.onCompleteAll=function(){console.info("onCompleteAll"),n.onCloseModal()},n.onCloseModal=function(){o.close(1)},n.onCancel=function(){o.dismiss("cancel")},n.form={submit:function(e){var t=null;if(e.$invalid){var o=null,t=null;for(o in e)"$"!=o[0]&&(null!==t||e[o].$valid||(t=e[o].$name),e[o].$pristine&&(e[o].$dirty=!0));return angular.element(".ng-invalid[name="+t+"]").focus(),void a(function(){s.pop("error","Error","Por favor verifique los datos requeridos del formulario y vuelva a intentarlo")},500)}return 0==n.uploaderResource.queue.length?void l.swal("El formulario contiene errores!","Por favor seleccione un archivo e Intentalo de nuevo.","error"):void n.onSave()},reset:function(e){e.$setPristine(!0)}},n.onSave=function(){var e={},t=JSON.stringify(n.resource);return e.data=Base64.encode(t),u({method:"POST",url:"api/resource-library/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){a(function(){n.resource=e.data.result,n.uploader.flow.opts.query.id=e.data.result.id,n.uploader.flow.resume(),w=e.data.result.id,y.uploadAll(),s.pop("success","Operación Exitosa","Registro guardado"),n.onCloseModal()})})["catch"](function(e){i.error(e),s.pop("error","Error","Por favor ingrese los campos requeridos.")})["finally"](function(){})},n.onAddKeyword=function(){a(function(){null==n.resource.keywords&&(n.resource.keywords=[]),n.resource.keywords.push({text:""})})},n.onRemoveKeyword=function(e){l.swal({title:"Está seguro?",text:"Desea confirmar la eliminación de este registro ?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(t){t?a(function(){n.resource.keywords.splice(e,1)}):swal("Cancelación","La operación ha sido cancelada","error")})}}]);
"use strict";app.controller("resourceLibraryCategoryCtrl",["$scope","$stateParams","$log","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$compile","toaster","$state","$rootScope","SweetAlert","$http","$timeout","$aside",function(e,r,o,n,t,a,i,l,c,s,u,d,f,p){var m=o;e.resourceLibraryTypeList=s.parameters("resource_library_type"),m.info("entrando en... certificateAdminProgramCtrl"),e.isAgent="agent"==s.currentUser().wg_type,e.isAdmin="system"==s.currentUser().wg_type,e.isCustomer="customerAdmin"==s.currentUser().wg_type||"customerUser"==s.currentUser().wg_type,e.isAgent||e.isCustomer,e.currentMonth=0,e.currentYear=0,e.filter={selectedMonth:null,selectedYear:null},e.request={},e.pageSizeList=[{item:"10 registros",value:10},{item:"50 registros",value:50},{item:"100 registros",value:100}],e.criteria={itemsPerPage:e.pageSizeList[0],currentPage:1,keyword:"",selectedType:null},e.totalItems=0,e.pageChanged=function(){g(e.currentProgramId)},e.$watch("criteria.itemsPerPage",function(){e.criteria.itemsPerPage&&g()}),e.maxSize=5;var g=function(){var r={};r.type=e.criteria.selectedType?e.criteria.selectedType.value:"",r.keyword=e.criteria.keyword,r.page_size=e.criteria.itemsPerPage.value,r.current_page=e.criteria.currentPage,d({method:"POST",url:"api/resource-library-category",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(r)}).then(function(r){e.resources=r.data.data.data,e.totalItems=r.data.data.totalItems})["catch"](function(e){u.swal("Error Consultando Preguntas","Se ha presentado un error durante la consulta del cuestionario, por favor intentelo de nuevo.","error")})["finally"](function(){})};e.changeType=function(e,r){f(function(){g()})},e.clearType=function(){f(function(){e.criteria.selectedType=null,g()})},e.changeKeyword=function(e,r){f(function(){g()})},e.clearKeyword=function(){f(function(){e.criteria.keyword="",g()})},e.onDownload=function(e){jQuery("#downloadDocument")[0].src="api/resource-library/download?id="+e},e.onView=function(r){e.onAddResourceLibrary(r)},e.onAddResourceLibrary=function(r){var o={id:r},n=p.open({templateUrl:s.app.views.urlRoot+"modules/resource-library/resource_library_modal.htm",placement:"right",size:"lg",backdrop:!0,controller:"ModalInstanceSideResourceLibraryCategoryViewCtrl",scope:e,resolve:{resource:function(){return o}}});n.result.then(function(){e.reloadData()})}}]),app.controller("ModalInstanceSideResourceLibraryCategoryViewCtrl",["$rootScope","$stateParams","$scope","$uibModalInstance","resource","$log","$timeout","SweetAlert","$http","toaster","$filter","FileUploader","DTColumnBuilder","DTOptionsBuilder","$compile",function(e,r,o,n,t,a,i,l,c,s,u,d,f,p,m){o.flowConfig={target:"/api/resource-library/upload-cover",singleFile:!0},o.uploader=new Flow,o.resourceLibraryTypeList=e.parameters("resource_library_type"),o.isView=!0;var g=0,y=function(){o.resource={id:t.id?t.id:0,type:null,dateOf:null,name:"",author:"",subject:"",description:"",isActive:!0,keywords:[]}};y();var w=function(){if(o.resource.id){var e={id:o.resource.id};c({method:"GET",url:"api/resource-library",params:e})["catch"](function(e,r){if(403==r){var o=null!==e.message&&void 0!==e.message?e.message:"app.clientes.list";l.swal("No Autorizado","No estas autorizado para ver esta información.","error"),i(function(){$state.go(o)},3e3)}else 404==r?(l.swal("Información no disponible","Anexo no encontrado","error"),i(function(){$state.go("app.clientes.list")})):l.swal("Error","Se ha presentado un error al intentar acceder a la información del anexo","error")}).then(function(e){i(function(){o.resource=e.data.result,null!=o.resource.dateOf&&(o.resource.dateOf=new Date(o.resource.dateOf.date))})})["finally"](function(){i(function(){o.loading=!1},400)})}};w(),""==o.resource.cover&&(o.noImage=!0),o.removeImage=function(){o.noImage=!0};var v=o.uploaderResource=new d({url:"api/resource-library/upload",formData:[]});v.filters.push({name:"customFilter",fn:function(e,r){return this.queue.length<10}}),v.onWhenAddingFileFailed=function(e,r,o){console.info("onWhenAddingFileFailed",e,r,o)},v.onAfterAddingFile=function(e){console.info("onAfterAddingFile",e)},v.onAfterAddingAll=function(e){console.info("onAfterAddingAll",e)},v.onBeforeUploadItem=function(e){console.info("onBeforeUploadItem",e);var r={id:g};e.formData.push(r)},v.onProgressItem=function(e,r){console.info("onProgressItem",e,r)},v.onProgressAll=function(e){console.info("onProgressAll",e)},v.onSuccessItem=function(e,r,o,n){console.info("onSuccessItem",e,r,o,n)},v.onErrorItem=function(e,r,o,n){console.info("onErrorItem",e,r,o,n)},v.onCancelItem=function(e,r,o,n){console.info("onCancelItem",e,r,o,n)},v.onCompleteItem=function(e,r,o,n){console.info("onCompleteItem",e,r,o,n)},v.onCompleteAll=function(){console.info("onCompleteAll"),o.onCloseModal()},o.onCloseModal=function(){n.close(1)},o.onCancel=function(){n.dismiss("cancel")},o.form={submit:function(e){var r=null;if(e.$invalid){var n=null,r=null;for(n in e)"$"!=n[0]&&(null!==r||e[n].$valid||(r=e[n].$name),e[n].$pristine&&(e[n].$dirty=!0));return angular.element(".ng-invalid[name="+r+"]").focus(),void i(function(){s.pop("error","Error","Por favor verifique los datos requeridos del formulario y vuelva a intentarlo")},500)}return 0==o.uploaderResource.queue.length?void l.swal("El formulario contiene errores!","Por favor seleccione un archivo e Intentalo de nuevo.","error"):void o.onSave()},reset:function(e){e.$setPristine(!0)}},o.onSave=function(){var e={},r=JSON.stringify(o.resource);return e.data=Base64.encode(r),c({method:"POST",url:"api/resource-library/save",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)}).then(function(e){i(function(){o.resource=e.data.result,o.uploader.flow.opts.query.id=e.data.result.id,o.uploader.flow.resume(),g=e.data.result.id,v.uploadAll(),s.pop("success","Operación Exitosa","Registro guardado"),o.onCloseModal()})})["catch"](function(e){a.error(e),s.pop("error","Error","Por favor ingrese los campos requeridos.")})["finally"](function(){})},o.onAddKeyword=function(){i(function(){null==o.resource.keywords&&(o.resource.keywords=[]),o.resource.keywords.push({text:""})})},o.onRemoveKeyword=function(e){l.swal({title:"Está seguro?",text:"Desea confirmar la eliminación de este registro ?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",closeOnConfirm:!0,closeOnCancel:!0},function(r){r?i(function(){o.resource.keywords.splice(e,1)}):swal("Cancelación","La operación ha sido cancelada","error")})}}]);